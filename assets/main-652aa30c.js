var Kb=Object.defineProperty;var $b=(r,e,n)=>e in r?Kb(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n;var lh=(r,e,n)=>($b(r,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const h of a)if(h.type==="childList")for(const m of h.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function n(a){const h={};return a.integrity&&(h.integrity=a.integrity),a.referrerPolicy&&(h.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?h.credentials="include":a.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function s(a){if(a.ep)return;a.ep=!0;const h=n(a);fetch(a.href,h)}})();function tt(){}function Yb(r,e){for(const n in e)r[n]=e[n];return r}function Jb(r){return!!r&&(typeof r=="object"||typeof r=="function")&&typeof r.then=="function"}function K0(r){return r()}function jg(){return Object.create(null)}function $i(r){r.forEach(K0)}function iu(r){return typeof r=="function"}function an(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let gf;function Yr(r,e){return r===e?!0:(gf||(gf=document.createElement("a")),gf.href=e,r===gf.href)}function Qb(r){return Object.keys(r).length===0}function $0(r,...e){if(r==null){for(const s of e)s(void 0);return tt}const n=r.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Df(r){let e;return $0(r,n=>e=n)(),e}function zt(r,e,n){r.$$.on_destroy.push($0(e,n))}function Zi(r,e,n,s){if(r){const a=Y0(r,e,n,s);return r[0](a)}}function Y0(r,e,n,s){return r[1]&&s?Yb(n.ctx.slice(),r[1](s(e))):n.ctx}function Hi(r,e,n,s){if(r[2]&&s){const a=r[2](s(n));if(e.dirty===void 0)return a;if(typeof a=="object"){const h=[],m=Math.max(e.dirty.length,a.length);for(let l=0;l<m;l+=1)h[l]=e.dirty[l]|a[l];return h}return e.dirty|a}return e.dirty}function Xi(r,e,n,s,a,h){if(a){const m=Y0(e,n,s,h);r.p(m,a)}}function Wi(r){if(r.ctx.length>32){const e=[],n=r.ctx.length/32;for(let s=0;s<n;s++)e[s]=-1;return e}return-1}function ex(r){const e={};for(const n in r)e[n]=!0;return e}function Nf(r){return r??""}function Dn(r,e,n){return r.set(n),e}function dp(r){return r&&iu(r.destroy)?r.destroy:tt}const J0=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Z(r,e){r.appendChild(e)}function ae(r,e,n){r.insertBefore(e,n||null)}function oe(r){r.parentNode&&r.parentNode.removeChild(r)}function Er(r,e){for(let n=0;n<r.length;n+=1)r[n]&&r[n].d(e)}function le(r){return document.createElement(r)}function Da(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function ze(r){return document.createTextNode(r)}function Oe(){return ze(" ")}function ii(){return ze("")}function Rt(r,e,n,s){return r.addEventListener(e,n,s),()=>r.removeEventListener(e,n,s)}function Nh(r){return function(e){return e.preventDefault(),r.call(this,e)}}function tp(r){return function(e){return e.stopPropagation(),r.call(this,e)}}function Ze(r,e,n){n==null?r.removeAttribute(e):r.getAttribute(e)!==n&&r.setAttribute(e,n)}function qg(r){let e;return{p(...n){e=n,e.forEach(s=>r.push(s))},r(){e.forEach(n=>r.splice(r.indexOf(n),1))}}}function tx(r){return Array.from(r.childNodes)}function Ct(r,e){e=""+e,r.data!==e&&(r.data=e)}function ki(r,e){r.value=e??""}function Rn(r,e,n,s){n==null?r.style.removeProperty(e):r.style.setProperty(e,n,s?"important":"")}function ds(r,e,n){for(let s=0;s<r.options.length;s+=1){const a=r.options[s];if(a.__value===e){a.selected=!0;return}}(!n||e!==void 0)&&(r.selectedIndex=-1)}function yl(r){const e=r.querySelector(":checked");return e&&e.__value}function Sr(r,e,n){r.classList.toggle(e,!!n)}function nx(r,e,{bubbles:n=!1,cancelable:s=!1}={}){return new CustomEvent(r,{detail:e,bubbles:n,cancelable:s})}let Th;function Pa(r){Th=r}function uc(){if(!Th)throw new Error("Function called outside component initialization");return Th}function cc(r){uc().$$.on_mount.push(r)}function vo(r){uc().$$.on_destroy.push(r)}function hc(){const r=uc();return(e,n,{cancelable:s=!1}={})=>{const a=r.$$.callbacks[e];if(a){const h=nx(e,n,{cancelable:s});return a.slice().forEach(m=>{m.call(r,h)}),!h.defaultPrevented}return!0}}function Q0(r,e){return uc().$$.context.set(r,e),e}function ev(r){return uc().$$.context.get(r)}function ur(r,e){const n=r.$$.callbacks[e.type];n&&n.slice().forEach(s=>s.call(this,e))}const Wu=[],$n=[];let ec=[];const pp=[],tv=Promise.resolve();let mp=!1;function nv(){mp||(mp=!0,tv.then(Up))}function ix(){return nv(),tv}function Ro(r){ec.push(r)}function mr(r){pp.push(r)}const np=new Set;let qu=0;function Up(){if(qu!==0)return;const r=Th;do{try{for(;qu<Wu.length;){const e=Wu[qu];qu++,Pa(e),rx(e.$$)}}catch(e){throw Wu.length=0,qu=0,e}for(Pa(null),Wu.length=0,qu=0;$n.length;)$n.pop()();for(let e=0;e<ec.length;e+=1){const n=ec[e];np.has(n)||(np.add(n),n())}ec.length=0}while(Wu.length);for(;pp.length;)pp.pop()();mp=!1,np.clear(),Pa(r)}function rx(r){if(r.fragment!==null){r.update(),$i(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(Ro)}}function sx(r){const e=[],n=[];ec.forEach(s=>r.indexOf(s)===-1?e.push(s):n.push(s)),n.forEach(s=>s()),ec=e}const Af=new Set;let tu;function zn(){tu={r:0,c:[],p:tu}}function Fn(){tu.r||$i(tu.c),tu=tu.p}function ge(r,e){r&&r.i&&(Af.delete(r),r.i(e))}function Se(r,e,n,s){if(r&&r.o){if(Af.has(r))return;Af.add(r),tu.c.push(()=>{Af.delete(r),s&&(n&&r.d(1),s())}),r.o(e)}else s&&s()}function gs(r,e){const n=e.token={};function s(a,h,m,l){if(e.token!==n)return;e.resolved=l;let x=e.ctx;m!==void 0&&(x=x.slice(),x[m]=l);const S=a&&(e.current=a)(x);let T=!1;e.block&&(e.blocks?e.blocks.forEach((C,N)=>{N!==h&&C&&(zn(),Se(C,1,1,()=>{e.blocks[N]===C&&(e.blocks[N]=null)}),Fn())}):e.block.d(1),S.c(),ge(S,1),S.m(e.mount(),e.anchor),T=!0),e.block=S,e.blocks&&(e.blocks[h]=S),T&&Up()}if(Jb(r)){const a=uc();if(r.then(h=>{Pa(a),s(e.then,1,e.value,h),Pa(null)},h=>{if(Pa(a),s(e.catch,2,e.error,h),Pa(null),!e.hasCatch)throw h}),e.current!==e.pending)return s(e.pending,0),!0}else{if(e.current!==e.then)return s(e.then,1,e.value,r),!0;e.resolved=r}}function Il(r,e,n){const s=e.slice(),{resolved:a}=r;r.current===r.then&&(s[r.value]=a),r.current===r.catch&&(s[r.error]=a),r.block.p(s,n)}function Vn(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function ox(r,e){Se(r,1,1,()=>{e.delete(r.key)})}function ax(r,e,n,s,a,h,m,l,x,S,T,C){let N=r.length,B=h.length,U=N;const ee={};for(;U--;)ee[r[U].key]=U;const ie=[],se=new Map,Q=new Map,Y=[];for(U=B;U--;){const ce=C(a,h,U),xe=n(ce);let be=m.get(xe);be?s&&Y.push(()=>be.p(ce,e)):(be=S(xe,ce),be.c()),se.set(xe,ie[U]=be),xe in ee&&Q.set(xe,Math.abs(U-ee[xe]))}const _e=new Set,ve=new Set;function Ae(ce){ge(ce,1),ce.m(l,T),m.set(ce.key,ce),T=ce.first,B--}for(;N&&B;){const ce=ie[B-1],xe=r[N-1],be=ce.key,Le=xe.key;ce===xe?(T=ce.first,N--,B--):se.has(Le)?!m.has(be)||_e.has(be)?Ae(ce):ve.has(Le)?N--:Q.get(be)>Q.get(Le)?(ve.add(be),Ae(ce)):(_e.add(Le),N--):(x(xe,m),N--)}for(;N--;){const ce=r[N];se.has(ce.key)||x(ce,m)}for(;B;)Ae(ie[B-1]);return $i(Y),ie}function gr(r,e,n){const s=r.$$.props[e];s!==void 0&&(r.$$.bound[s]=n,n(r.$$.ctx[s]))}function ot(r){r&&r.c()}function it(r,e,n){const{fragment:s,after_update:a}=r.$$;s&&s.m(e,n),Ro(()=>{const h=r.$$.on_mount.map(K0).filter(iu);r.$$.on_destroy?r.$$.on_destroy.push(...h):$i(h),r.$$.on_mount=[]}),a.forEach(Ro)}function rt(r,e){const n=r.$$;n.fragment!==null&&(sx(n.after_update),$i(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function lx(r,e){r.$$.dirty[0]===-1&&(Wu.push(r),nv(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function hn(r,e,n,s,a,h,m=null,l=[-1]){const x=Th;Pa(r);const S=r.$$={fragment:null,ctx:[],props:h,update:tt,not_equal:a,bound:jg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(x?x.$$.context:[])),callbacks:jg(),dirty:l,skip_bound:!1,root:e.target||x.$$.root};m&&m(S.root);let T=!1;if(S.ctx=n?n(r,e.props||{},(C,N,...B)=>{const U=B.length?B[0]:N;return S.ctx&&a(S.ctx[C],S.ctx[C]=U)&&(!S.skip_bound&&S.bound[C]&&S.bound[C](U),T&&lx(r,C)),N}):[],S.update(),T=!0,$i(S.before_update),S.fragment=s?s(S.ctx):!1,e.target){if(e.hydrate){const C=tx(e.target);S.fragment&&S.fragment.l(C),C.forEach(oe)}else S.fragment&&S.fragment.c();e.intro&&ge(r.$$.fragment),it(r,e.target,e.anchor),Up()}Pa(x)}class fn{constructor(){lh(this,"$$");lh(this,"$$set")}$destroy(){rt(this,1),this.$destroy=tt}$on(e,n){if(!iu(n))return tt;const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(n),()=>{const a=s.indexOf(n);a!==-1&&s.splice(a,1)}}$set(e){this.$$set&&!Qb(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ux="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ux);var cx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hx(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var iv={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.0/LICENSE.txt
 */(function(r,e){(function(n,s){r.exports=s()})(cx,function(){var n={},s={};function a(m,l,x){if(s[m]=x,m==="index"){var S="var sharedModule = {}; ("+s.shared+")(sharedModule); ("+s.worker+")(sharedModule);",T={};return s.shared(T),s.index(n,T),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([S],{type:"text/javascript"}))),n}}a("shared",["exports"],function(m){function l(o,i,u,g){return new(u||(u=Promise))(function(v,E){function A(F){try{P(g.next(F))}catch(j){E(j)}}function M(F){try{P(g.throw(F))}catch(j){E(j)}}function P(F){var j;F.done?v(F.value):(j=F.value,j instanceof u?j:new u(function(G){G(j)})).then(A,M)}P((g=g.apply(o,i||[])).next())})}function x(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}typeof SuppressedError=="function"&&SuppressedError;var S=T;function T(o,i){this.x=o,this.y=i}T.prototype={clone:function(){return new T(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,i){return this.clone()._rotateAround(o,i)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var i=o.x-this.x,u=o.y-this.y;return i*i+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,i){return Math.atan2(this.x*i-this.y*o,this.x*o+this.y*i)},_matMult:function(o){var i=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=i,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var i=Math.cos(o),u=Math.sin(o),g=u*this.x+i*this.y;return this.x=i*this.x-u*this.y,this.y=g,this},_rotateAround:function(o,i){var u=Math.cos(o),g=Math.sin(o),v=i.y+g*(this.x-i.x)+u*(this.y-i.y);return this.x=i.x+u*(this.x-i.x)-g*(this.y-i.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},T.convert=function(o){return o instanceof T?o:Array.isArray(o)?new T(o[0],o[1]):o};var C=x(S),N=B;function B(o,i,u,g){this.cx=3*o,this.bx=3*(u-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(g-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=i,this.p2x=u,this.p2y=g}B.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,i){if(i===void 0&&(i=1e-6),o<0)return 0;if(o>1)return 1;for(var u=o,g=0;g<8;g++){var v=this.sampleCurveX(u)-o;if(Math.abs(v)<i)return u;var E=this.sampleCurveDerivativeX(u);if(Math.abs(E)<1e-6)break;u-=v/E}var A=0,M=1;for(u=o,g=0;g<20&&(v=this.sampleCurveX(u),!(Math.abs(v-o)<i));g++)o>v?A=u:M=u,u=.5*(M-A)+A;return u},solve:function(o,i){return this.sampleCurveY(this.solveCurveX(o,i))}};var U=x(N);let ee,ie;function se(){return ee==null&&(ee=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ee}function Q(){if(ie==null&&(ie=!1,se())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let g=0;g<5*5;g++){const v=4*g;i.fillStyle=`rgb(${v},${v+1},${v+2})`,i.fillRect(g%5,Math.floor(g/5),1,1)}const u=i.getImageData(0,0,5,5).data;for(let g=0;g<5*5*4;g++)if(g%4!=3&&u[g]!==g){ie=!0;break}}}return ie||!1}function Y(o,i,u,g){const v=new U(o,i,u,g);return E=>v.solve(E)}const _e=Y(.25,.1,.25,1);function ve(o,i,u){return Math.min(u,Math.max(i,o))}function Ae(o,i,u){const g=u-i,v=((o-i)%g+g)%g+i;return v===i?u:v}function ce(o,...i){for(const u of i)for(const g in u)o[g]=u[g];return o}let xe=1;function be(o,i,u){const g={};for(const v in o)g[v]=i.call(this,o[v],v,o);return g}function Le(o,i,u){const g={};for(const v in o)i.call(this,o[v],v,o)&&(g[v]=o[v]);return g}function ke(o){return Array.isArray(o)?o.map(ke):typeof o=="object"&&o?be(o,ke):o}const ye={};function Ue(o){ye[o]||(typeof console<"u"&&console.warn(o),ye[o]=!0)}function qe(o,i,u){return(u.y-o.y)*(i.x-o.x)>(i.y-o.y)*(u.x-o.x)}function pt(o){return typeof WorkerGlobalScope<"u"&&o!==void 0&&o instanceof WorkerGlobalScope}let St=null;function dt(o){return typeof ImageBitmap<"u"&&o instanceof ImageBitmap}const ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ut(o,i,u,g,v){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const E=new VideoFrame(o,{timestamp:0});try{const A=E==null?void 0:E.format;if(!A||!A.startsWith("BGR")&&!A.startsWith("RGB"))throw new Error(`Unrecognized format ${A}`);const M=A.startsWith("BGR"),P=new Uint8ClampedArray(g*v*4);if(yield E.copyTo(P,function(F,j,G,W,te){const re=4*Math.max(-j,0),de=(Math.max(0,G)-G)*W*4+re,Ce=4*W,De=Math.max(0,j),nt=Math.max(0,G);return{rect:{x:De,y:nt,width:Math.min(F.width,j+W)-De,height:Math.min(F.height,G+te)-nt},layout:[{offset:de,stride:Ce}]}}(o,i,u,g,v)),M)for(let F=0;F<P.length;F+=4){const j=P[F];P[F]=P[F+2],P[F+2]=j}return P}finally{E.close()}})}let vt,kt;const ft="AbortError";function wt(){return new Error(ft)}const It={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function $t(o){return It.REGISTERED_PROTOCOLS[o.substring(0,o.indexOf("://"))]}const pn="global-dispatcher";class Pn extends Error{constructor(i,u,g,v){super(`AJAXError: ${u} (${i}): ${g}`),this.status=i,this.statusText=u,this.url=g,this.body=v}}const We=()=>pt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Wn=function(o,i){if(/:\/\//.test(o.url)&&!/^https?:|^file:/.test(o.url)){const g=$t(o.url);if(g)return g(o,i);if(pt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,targetMapId:pn},i)}if(!(/^file:/.test(u=o.url)||/^file:/.test(We())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(g,v){return l(this,void 0,void 0,function*(){const E=new Request(g.url,{method:g.method||"GET",body:g.body,credentials:g.credentials,headers:g.headers,cache:g.cache,referrer:We(),signal:v.signal});g.type!=="json"||E.headers.has("Accept")||E.headers.set("Accept","application/json");const A=yield fetch(E);if(!A.ok){const F=yield A.blob();throw new Pn(A.status,A.statusText,g.url,F)}let M;M=g.type==="arrayBuffer"||g.type==="image"?A.arrayBuffer():g.type==="json"?A.json():A.text();const P=yield M;if(v.signal.aborted)throw wt();return{data:P,cacheControl:A.headers.get("Cache-Control"),expires:A.headers.get("Expires")}})}(o,i);if(pt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,mustQueue:!0,targetMapId:pn},i)}var u;return function(g,v){return new Promise((E,A)=>{var M;const P=new XMLHttpRequest;P.open(g.method||"GET",g.url,!0),g.type!=="arrayBuffer"&&g.type!=="image"||(P.responseType="arraybuffer");for(const F in g.headers)P.setRequestHeader(F,g.headers[F]);g.type==="json"&&(P.responseType="text",!((M=g.headers)===null||M===void 0)&&M.Accept||P.setRequestHeader("Accept","application/json")),P.withCredentials=g.credentials==="include",P.onerror=()=>{A(new Error(P.statusText))},P.onload=()=>{if(!v.signal.aborted)if((P.status>=200&&P.status<300||P.status===0)&&P.response!==null){let F=P.response;if(g.type==="json")try{F=JSON.parse(P.response)}catch(j){return void A(j)}E({data:F,cacheControl:P.getResponseHeader("Cache-Control"),expires:P.getResponseHeader("Expires")})}else{const F=new Blob([P.response],{type:P.getResponseHeader("Content-Type")});A(new Pn(P.status,P.statusText,g.url,F))}},v.signal.addEventListener("abort",()=>{P.abort(),A(wt())}),P.send(g.body)})}(o,i)};function dn(o){if(!o||o.indexOf("://")<=0||o.indexOf("data:image/")===0||o.indexOf("blob:")===0)return!0;const i=new URL(o),u=window.location;return i.protocol===u.protocol&&i.host===u.host}function Ot(o,i,u){u[o]&&u[o].indexOf(i)!==-1||(u[o]=u[o]||[],u[o].push(i))}function Ee(o,i,u){if(u&&u[o]){const g=u[o].indexOf(i);g!==-1&&u[o].splice(g,1)}}class lt{constructor(i,u={}){ce(this,u),this.type=i}}class Ye extends lt{constructor(i,u={}){super("error",ce({error:i},u))}}class Lt{on(i,u){return this._listeners=this._listeners||{},Ot(i,u,this._listeners),this}off(i,u){return Ee(i,u,this._listeners),Ee(i,u,this._oneTimeListeners),this}once(i,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},Ot(i,u,this._oneTimeListeners),this):new Promise(g=>this.once(i,g))}fire(i,u){typeof i=="string"&&(i=new lt(i,u||{}));const g=i.type;if(this.listens(g)){i.target=this;const v=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(const M of v)M.call(this,i);const E=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(const M of E)Ee(g,M,this._oneTimeListeners),M.call(this,i);const A=this._eventedParent;A&&(ce(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),A.fire(i))}else i instanceof Ye&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,u){return this._eventedParent=i,this._eventedParentData=u,this}}var Ke={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const On=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function bt(o,i){const u={};for(const g in o)g!=="ref"&&(u[g]=o[g]);return On.forEach(g=>{g in i&&(u[g]=i[g])}),u}function Ie(o,i){if(Array.isArray(o)){if(!Array.isArray(i)||o.length!==i.length)return!1;for(let u=0;u<o.length;u++)if(!Ie(o[u],i[u]))return!1;return!0}if(typeof o=="object"&&o!==null&&i!==null){if(typeof i!="object"||Object.keys(o).length!==Object.keys(i).length)return!1;for(const u in o)if(!Ie(o[u],i[u]))return!1;return!0}return o===i}function Bt(o,i){o.push(i)}function Mn(o,i,u){Bt(u,{command:"addSource",args:[o,i[o]]})}function Nn(o,i,u){Bt(i,{command:"removeSource",args:[o]}),u[o]=!0}function Qn(o,i,u,g){Nn(o,u,g),Mn(o,i,u)}function Jt(o,i,u){let g;for(g in o[u])if(Object.prototype.hasOwnProperty.call(o[u],g)&&g!=="data"&&!Ie(o[u][g],i[u][g]))return!1;for(g in i[u])if(Object.prototype.hasOwnProperty.call(i[u],g)&&g!=="data"&&!Ie(o[u][g],i[u][g]))return!1;return!0}function Ri(o,i,u,g,v,E){o=o||{},i=i||{};for(const A in o)Object.prototype.hasOwnProperty.call(o,A)&&(Ie(o[A],i[A])||u.push({command:E,args:[g,A,i[A],v]}));for(const A in i)Object.prototype.hasOwnProperty.call(i,A)&&!Object.prototype.hasOwnProperty.call(o,A)&&(Ie(o[A],i[A])||u.push({command:E,args:[g,A,i[A],v]}))}function Yi(o){return o.id}function Jr(o,i){return o[i.id]=i,o}class ct{constructor(i,u,g,v){this.message=(i?`${i}: `:"")+g,v&&(this.identifier=v),u!=null&&u.__line__&&(this.line=u.__line__)}}function yr(o,...i){for(const u of i)for(const g in u)o[g]=u[g];return o}class xn extends Error{constructor(i,u){super(u),this.message=u,this.key=i}}class mn{constructor(i,u=[]){this.parent=i,this.bindings={};for(const[g,v]of u)this.bindings[g]=v}concat(i){return new mn(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Ms={kind:"null"},Mt={kind:"number"},An={kind:"string"},At={kind:"boolean"},vr={kind:"color"},Gr={kind:"object"},bn={kind:"value"},Pi={kind:"collator"},Ar={kind:"formatted"},Ji={kind:"padding"},Zr={kind:"resolvedImage"},Re={kind:"variableAnchorOffsetCollection"};function J(o,i){return{kind:"array",itemType:o,N:i}}function $(o){if(o.kind==="array"){const i=$(o.itemType);return typeof o.N=="number"?`array<${i}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${i}>`}return o.kind}const he=[Ms,Mt,An,At,vr,Ar,Gr,J(bn),Ji,Zr,Re];function ue(o,i){if(i.kind==="error")return null;if(o.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!ue(o.itemType,i.itemType))&&(typeof o.N!="number"||o.N===i.N))return null}else{if(o.kind===i.kind)return null;if(o.kind==="value"){for(const u of he)if(!ue(u,i))return null}}return`Expected ${$(o)} but found ${$(i)} instead.`}function fe(o,i){return i.some(u=>u.kind===o.kind)}function je(o,i){return i.some(u=>u==="null"?o===null:u==="array"?Array.isArray(o):u==="object"?o&&!Array.isArray(o)&&typeof o=="object":u===typeof o)}function Xe(o,i){return o.kind==="array"&&i.kind==="array"?o.itemType.kind===i.itemType.kind&&typeof o.N=="number":o.kind===i.kind}const Pe=.96422,et=.82521,gt=4/29,at=6/29,Dt=3*at*at,en=at*at*at,ln=Math.PI/180,Gn=180/Math.PI;function Tn(o){return(o%=360)<0&&(o+=360),o}function Cn([o,i,u,g]){let v,E;const A=Ii((.2225045*(o=Un(o))+.7168786*(i=Un(i))+.0606169*(u=Un(u)))/1);o===i&&i===u?v=E=A:(v=Ii((.4360747*o+.3850649*i+.1430804*u)/Pe),E=Ii((.0139322*o+.0971045*i+.7141733*u)/et));const M=116*A-16;return[M<0?0:M,500*(v-A),200*(A-E),g]}function Un(o){return o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Ii(o){return o>en?Math.pow(o,1/3):o/Dt+gt}function ci([o,i,u,g]){let v=(o+16)/116,E=isNaN(i)?v:v+i/500,A=isNaN(u)?v:v-u/200;return v=1*ri(v),E=Pe*ri(E),A=et*ri(A),[En(3.1338561*E-1.6168667*v-.4906146*A),En(-.9787684*E+1.9161415*v+.033454*A),En(.0719453*E-.2289914*v+1.4052427*A),g]}function En(o){return(o=o<=.00304?12.92*o:1.055*Math.pow(o,1/2.4)-.055)<0?0:o>1?1:o}function ri(o){return o>at?o*o*o:Dt*(o-gt)}function fi(o){return parseInt(o.padEnd(2,o),16)/255}function Di(o,i){return Kn(i?o/100:o,0,1)}function Kn(o,i,u){return Math.min(Math.max(i,o),u)}function Tr(o){return!o.some(Number.isNaN)}const No={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ei{constructor(i,u,g,v=1,E=!0){this.r=i,this.g=u,this.b=g,this.a=v,E||(this.r*=v,this.g*=v,this.b*=v,v||this.overwriteGetter("rgb",[i,u,g,v]))}static parse(i){if(i instanceof ei)return i;if(typeof i!="string")return;const u=function(g){if((g=g.toLowerCase().trim())==="transparent")return[0,0,0,0];const v=No[g];if(v){const[A,M,P]=v;return[A/255,M/255,P/255,1]}if(g.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(g)){const A=g.length<6?1:2;let M=1;return[fi(g.slice(M,M+=A)),fi(g.slice(M,M+=A)),fi(g.slice(M,M+=A)),fi(g.slice(M,M+A)||"ff")]}if(g.startsWith("rgb")){const A=g.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(A){const[M,P,F,j,G,W,te,re,de,Ce,De,nt]=A,Ge=[j||" ",te||" ",Ce].join("");if(Ge==="  "||Ge==="  /"||Ge===",,"||Ge===",,,"){const Qe=[F,W,de].join(""),ht=Qe==="%%%"?100:Qe===""?255:0;if(ht){const Et=[Kn(+P/ht,0,1),Kn(+G/ht,0,1),Kn(+re/ht,0,1),De?Di(+De,nt):1];if(Tr(Et))return Et}}return}}const E=g.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[A,M,P,F,j,G,W,te,re]=E,de=[P||" ",j||" ",W].join("");if(de==="  "||de==="  /"||de===",,"||de===",,,"){const Ce=[+M,Kn(+F,0,100),Kn(+G,0,100),te?Di(+te,re):1];if(Tr(Ce))return function([De,nt,Ge,Qe]){function ht(Et){const Wt=(Et+De/30)%12,_n=nt*Math.min(Ge,1-Ge);return Ge-_n*Math.max(-1,Math.min(Wt-3,9-Wt,1))}return De=Tn(De),nt/=100,Ge/=100,[ht(0),ht(8),ht(4),Qe]}(Ce)}}}(i);return u?new ei(...u,!1):void 0}get rgb(){const{r:i,g:u,b:g,a:v}=this,E=v||1/0;return this.overwriteGetter("rgb",[i/E,u/E,g/E,v])}get hcl(){return this.overwriteGetter("hcl",function(i){const[u,g,v,E]=Cn(i),A=Math.sqrt(g*g+v*v);return[Math.round(1e4*A)?Tn(Math.atan2(v,g)*Gn):NaN,A,u,E]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Cn(this.rgb))}overwriteGetter(i,u){return Object.defineProperty(this,i,{value:u}),u}toString(){const[i,u,g,v]=this.rgb;return`rgba(${[i,u,g].map(E=>Math.round(255*E)).join(",")},${v})`}}ei.black=new ei(0,0,0,1),ei.white=new ei(1,1,1,1),ei.transparent=new ei(0,0,0,0),ei.red=new ei(1,0,0,1);class bo{constructor(i,u,g){this.sensitivity=i?u?"variant":"case":u?"accent":"base",this.locale=g,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,u){return this.collator.compare(i,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class aa{constructor(i,u,g,v,E){this.text=i,this.image=u,this.scale=g,this.fontStack=v,this.textColor=E}}class Cr{constructor(i){this.sections=i}static fromString(i){return new Cr([new aa(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof Cr?i:Cr.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class Nr{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Nr)return i;if(typeof i=="number")return new Nr([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const u of i)if(typeof u!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new Nr(i)}}toString(){return JSON.stringify(this.values)}}const yc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ni{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Ni)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let u=0;u<i.length;u+=2){const g=i[u],v=i[u+1];if(typeof g!="string"||!yc.has(g)||!Array.isArray(v)||v.length!==2||typeof v[0]!="number"||typeof v[1]!="number")return}return new Ni(i)}}toString(){return JSON.stringify(this.values)}}class or{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new or({name:i,available:!1}):null}}function no(o,i,u,g){return typeof o=="number"&&o>=0&&o<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof u=="number"&&u>=0&&u<=255?g===void 0||typeof g=="number"&&g>=0&&g<=1?null:`Invalid rgba value [${[o,i,u,g].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof g=="number"?[o,i,u,g]:[o,i,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Qr(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof ei||o instanceof bo||o instanceof Cr||o instanceof Nr||o instanceof Ni||o instanceof or)return!0;if(Array.isArray(o)){for(const i of o)if(!Qr(i))return!1;return!0}if(typeof o=="object"){for(const i in o)if(!Qr(o[i]))return!1;return!0}return!1}function zi(o){if(o===null)return Ms;if(typeof o=="string")return An;if(typeof o=="boolean")return At;if(typeof o=="number")return Mt;if(o instanceof ei)return vr;if(o instanceof bo)return Pi;if(o instanceof Cr)return Ar;if(o instanceof Nr)return Ji;if(o instanceof Ni)return Re;if(o instanceof or)return Zr;if(Array.isArray(o)){const i=o.length;let u;for(const g of o){const v=zi(g);if(u){if(u===v)continue;u=bn;break}u=v}return J(u||bn,i)}return Gr}function la(o){const i=typeof o;return o===null?"":i==="string"||i==="number"||i==="boolean"?String(o):o instanceof ei||o instanceof Cr||o instanceof Nr||o instanceof Ni||o instanceof or?o.toString():JSON.stringify(o)}class _s{constructor(i,u){this.type=i,this.value=u}static parse(i,u){if(i.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Qr(i[1]))return u.error("invalid value");const g=i[1];let v=zi(g);const E=u.expectedType;return v.kind!=="array"||v.N!==0||!E||E.kind!=="array"||typeof E.N=="number"&&E.N!==0||(v=E),new _s(v,g)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ui{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const ua={string:An,number:Mt,boolean:At,object:Gr};class es{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");let g,v=1;const E=i[0];if(E==="array"){let M,P;if(i.length>2){const F=i[1];if(typeof F!="string"||!(F in ua)||F==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);M=ua[F],v++}else M=bn;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return u.error('The length argument to "array" must be a positive integer literal',2);P=i[2],v++}g=J(M,P)}else{if(!ua[E])throw new Error(`Types doesn't contain name = ${E}`);g=ua[E]}const A=[];for(;v<i.length;v++){const M=u.parse(i[v],v,bn);if(!M)return null;A.push(M)}return new es(g,A)}evaluate(i){for(let u=0;u<this.args.length;u++){const g=this.args[u].evaluate(i);if(!ue(this.type,zi(g)))return g;if(u===this.args.length-1)throw new Ui(`Expected value to be of type ${$(this.type)}, but found ${$(zi(g))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const zo={"to-boolean":At,"to-color":vr,"to-number":Mt,"to-string":An};class Qi{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");const g=i[0];if(!zo[g])throw new Error(`Can't parse ${g} as it is not part of the known types`);if((g==="to-boolean"||g==="to-string")&&i.length!==2)return u.error("Expected one argument.");const v=zo[g],E=[];for(let A=1;A<i.length;A++){const M=u.parse(i[A],A,bn);if(!M)return null;E.push(M)}return new Qi(v,E)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let u,g;for(const v of this.args){if(u=v.evaluate(i),g=null,u instanceof ei)return u;if(typeof u=="string"){const E=i.parseColor(u);if(E)return E}else if(Array.isArray(u)&&(g=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:no(u[0],u[1],u[2],u[3]),!g))return new ei(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new Ui(g||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const g of this.args){u=g.evaluate(i);const v=Nr.parse(u);if(v)return v}throw new Ui(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const g of this.args){u=g.evaluate(i);const v=Ni.parse(u);if(v)return v}throw new Ui(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const g of this.args){if(u=g.evaluate(i),u===null)return 0;const v=Number(u);if(!isNaN(v))return v}throw new Ui(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return Cr.fromString(la(this.args[0].evaluate(i)));case"resolvedImage":return or.fromString(la(this.args[0].evaluate(i)));default:return la(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const io=["Unknown","Point","LineString","Polygon"];class ca{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?io[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let u=this._parseColorCache[i];return u||(u=this._parseColorCache[i]=ei.parse(i)),u}}class ts{constructor(i,u,g=[],v,E=new mn,A=[]){this.registry=i,this.path=g,this.key=g.map(M=>`[${M}]`).join(""),this.scope=E,this.errors=A,this.expectedType=v,this._isConstant=u}parse(i,u,g,v,E={}){return u?this.concat(u,g,v)._parse(i,E):this._parse(i,E)}_parse(i,u){function g(v,E,A){return A==="assert"?new es(E,[v]):A==="coerce"?new Qi(E,[v]):v}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=i[0];if(typeof v!="string")return this.error(`Expression name must be a string, but found ${typeof v} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const E=this.registry[v];if(E){let A=E.parse(i,this);if(!A)return null;if(this.expectedType){const M=this.expectedType,P=A.type;if(M.kind!=="string"&&M.kind!=="number"&&M.kind!=="boolean"&&M.kind!=="object"&&M.kind!=="array"||P.kind!=="value")if(M.kind!=="color"&&M.kind!=="formatted"&&M.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string")if(M.kind!=="padding"||P.kind!=="value"&&P.kind!=="number"&&P.kind!=="array")if(M.kind!=="variableAnchorOffsetCollection"||P.kind!=="value"&&P.kind!=="array"){if(this.checkSubtype(M,P))return null}else A=g(A,M,u.typeAnnotation||"coerce");else A=g(A,M,u.typeAnnotation||"coerce");else A=g(A,M,u.typeAnnotation||"coerce");else A=g(A,M,u.typeAnnotation||"assert")}if(!(A instanceof _s)&&A.type.kind!=="resolvedImage"&&this._isConstant(A)){const M=new ca;try{A=new _s(A.type,A.evaluate(M))}catch(P){return this.error(P.message),null}}return A}return this.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,u,g){const v=typeof i=="number"?this.path.concat(i):this.path,E=g?this.scope.concat(g):this.scope;return new ts(this.registry,this._isConstant,v,u||null,E,this.errors)}error(i,...u){const g=`${this.key}${u.map(v=>`[${v}]`).join("")}`;this.errors.push(new xn(g,i))}checkSubtype(i,u){const g=ue(i,u);return g&&this.error(g),g}}class ro{constructor(i,u){this.type=u.type,this.bindings=[].concat(i),this.result=u}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const u of this.bindings)i(u[1]);i(this.result)}static parse(i,u){if(i.length<4)return u.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const g=[];for(let E=1;E<i.length-1;E+=2){const A=i[E];if(typeof A!="string")return u.error(`Expected string, but found ${typeof A} instead.`,E);if(/[^a-zA-Z0-9_]/.test(A))return u.error("Variable names must contain only alphanumeric characters or '_'.",E);const M=u.parse(i[E+1],E+1);if(!M)return null;g.push([A,M])}const v=u.parse(i[i.length-1],i.length-1,u.expectedType,g);return v?new ro(g,v):null}outputDefined(){return this.result.outputDefined()}}class ti{constructor(i,u){this.type=u.type,this.name=i,this.boundExpression=u}static parse(i,u){if(i.length!==2||typeof i[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const g=i[1];return u.scope.has(g)?new ti(g,u.scope.get(g)):u.error(`Unknown variable "${g}". Make sure "${g}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class El{constructor(i,u,g){this.type=i,this.index=u,this.input=g}static parse(i,u){if(i.length!==3)return u.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const g=u.parse(i[1],1,Mt),v=u.parse(i[2],2,J(u.expectedType||bn));return g&&v?new El(v.type.itemType,g,v):null}evaluate(i){const u=this.index.evaluate(i),g=this.input.evaluate(i);if(u<0)throw new Ui(`Array index out of bounds: ${u} < 0.`);if(u>=g.length)throw new Ui(`Array index out of bounds: ${u} > ${g.length-1}.`);if(u!==Math.floor(u))throw new Ui(`Array index must be an integer, but found ${u} instead.`);return g[u]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class Al{constructor(i,u){this.type=At,this.needle=i,this.haystack=u}static parse(i,u){if(i.length!==3)return u.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const g=u.parse(i[1],1,bn),v=u.parse(i[2],2,bn);return g&&v?fe(g.type,[At,An,Mt,Ms,bn])?new Al(g,v):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${$(g.type)} instead`):null}evaluate(i){const u=this.needle.evaluate(i),g=this.haystack.evaluate(i);if(!g)return!1;if(!je(u,["boolean","string","number","null"]))throw new Ui(`Expected first argument to be of type boolean, string, number or null, but found ${$(zi(u))} instead.`);if(!je(g,["string","array"]))throw new Ui(`Expected second argument to be of type array or string, but found ${$(zi(g))} instead.`);return g.indexOf(u)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class xo{constructor(i,u,g){this.type=Mt,this.needle=i,this.haystack=u,this.fromIndex=g}static parse(i,u){if(i.length<=2||i.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const g=u.parse(i[1],1,bn),v=u.parse(i[2],2,bn);if(!g||!v)return null;if(!fe(g.type,[At,An,Mt,Ms,bn]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${$(g.type)} instead`);if(i.length===4){const E=u.parse(i[3],3,Mt);return E?new xo(g,v,E):null}return new xo(g,v)}evaluate(i){const u=this.needle.evaluate(i),g=this.haystack.evaluate(i);if(!je(u,["boolean","string","number","null"]))throw new Ui(`Expected first argument to be of type boolean, string, number or null, but found ${$(zi(u))} instead.`);let v;if(this.fromIndex&&(v=this.fromIndex.evaluate(i)),je(g,["string"])){const E=g.indexOf(u,v);return E===-1?-1:[...g.slice(0,E)].length}if(je(g,["array"]))return g.indexOf(u,v);throw new Ui(`Expected second argument to be of type array or string, but found ${$(zi(g))} instead.`)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class wo{constructor(i,u,g,v,E,A){this.inputType=i,this.type=u,this.input=g,this.cases=v,this.outputs=E,this.otherwise=A}static parse(i,u){if(i.length<5)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return u.error("Expected an even number of arguments.");let g,v;u.expectedType&&u.expectedType.kind!=="value"&&(v=u.expectedType);const E={},A=[];for(let F=2;F<i.length-1;F+=2){let j=i[F];const G=i[F+1];Array.isArray(j)||(j=[j]);const W=u.concat(F);if(j.length===0)return W.error("Expected at least one branch label.");for(const re of j){if(typeof re!="number"&&typeof re!="string")return W.error("Branch labels must be numbers or strings.");if(typeof re=="number"&&Math.abs(re)>Number.MAX_SAFE_INTEGER)return W.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof re=="number"&&Math.floor(re)!==re)return W.error("Numeric branch labels must be integer values.");if(g){if(W.checkSubtype(g,zi(re)))return null}else g=zi(re);if(E[String(re)]!==void 0)return W.error("Branch labels must be unique.");E[String(re)]=A.length}const te=u.parse(G,F,v);if(!te)return null;v=v||te.type,A.push(te)}const M=u.parse(i[1],1,bn);if(!M)return null;const P=u.parse(i[i.length-1],i.length-1,v);return P?M.type.kind!=="value"&&u.concat(1).checkSubtype(g,M.type)?null:new wo(g,v,M,E,A,P):null}evaluate(i){const u=this.input.evaluate(i);return(zi(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class ha{constructor(i,u,g){this.type=i,this.branches=u,this.otherwise=g}static parse(i,u){if(i.length<4)return u.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return u.error("Expected an odd number of arguments.");let g;u.expectedType&&u.expectedType.kind!=="value"&&(g=u.expectedType);const v=[];for(let A=1;A<i.length-1;A+=2){const M=u.parse(i[A],A,At);if(!M)return null;const P=u.parse(i[A+1],A+1,g);if(!P)return null;v.push([M,P]),g=g||P.type}const E=u.parse(i[i.length-1],i.length-1,g);if(!E)return null;if(!g)throw new Error("Can't infer output type");return new ha(g,v,E)}evaluate(i){for(const[u,g]of this.branches)if(u.evaluate(i))return g.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[u,g]of this.branches)i(u),i(g);i(this.otherwise)}outputDefined(){return this.branches.every(([i,u])=>u.outputDefined())&&this.otherwise.outputDefined()}}class fa{constructor(i,u,g,v){this.type=i,this.input=u,this.beginIndex=g,this.endIndex=v}static parse(i,u){if(i.length<=2||i.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const g=u.parse(i[1],1,bn),v=u.parse(i[2],2,Mt);if(!g||!v)return null;if(!fe(g.type,[J(bn),An,bn]))return u.error(`Expected first argument to be of type array or string, but found ${$(g.type)} instead`);if(i.length===4){const E=u.parse(i[3],3,Mt);return E?new fa(g.type,g,v,E):null}return new fa(g.type,g,v)}evaluate(i){const u=this.input.evaluate(i),g=this.beginIndex.evaluate(i);let v;if(this.endIndex&&(v=this.endIndex.evaluate(i)),je(u,["string"]))return[...u].slice(g,v).join("");if(je(u,["array"]))return u.slice(g,v);throw new Ui(`Expected first argument to be of type array or string, but found ${$(zi(u))} instead.`)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function da(o,i){const u=o.length-1;let g,v,E=0,A=u,M=0;for(;E<=A;)if(M=Math.floor((E+A)/2),g=o[M],v=o[M+1],g<=i){if(M===u||i<v)return M;E=M+1}else{if(!(g>i))throw new Ui("Input is not a number.");A=M-1}return 0}class Fo{constructor(i,u,g){this.type=i,this.input=u,this.labels=[],this.outputs=[];for(const[v,E]of g)this.labels.push(v),this.outputs.push(E)}static parse(i,u){if(i.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return u.error("Expected an even number of arguments.");const g=u.parse(i[1],1,Mt);if(!g)return null;const v=[];let E=null;u.expectedType&&u.expectedType.kind!=="value"&&(E=u.expectedType);for(let A=1;A<i.length;A+=2){const M=A===1?-1/0:i[A],P=i[A+1],F=A,j=A+1;if(typeof M!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(v.length&&v[v.length-1][0]>=M)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);const G=u.parse(P,j,E);if(!G)return null;E=E||G.type,v.push([M,G])}return new Fo(E,g,v)}evaluate(i){const u=this.labels,g=this.outputs;if(u.length===1)return g[0].evaluate(i);const v=this.input.evaluate(i);if(v<=u[0])return g[0].evaluate(i);const E=u.length;return v>=u[E-1]?g[E-1].evaluate(i):g[da(u,v)].evaluate(i)}eachChild(i){i(this.input);for(const u of this.outputs)i(u)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function za(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Si=so;function so(o,i,u,g){this.cx=3*o,this.bx=3*(u-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(g-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=i,this.p2x=u,this.p2y=g}so.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,i){if(i===void 0&&(i=1e-6),o<0)return 0;if(o>1)return 1;for(var u=o,g=0;g<8;g++){var v=this.sampleCurveX(u)-o;if(Math.abs(v)<i)return u;var E=this.sampleCurveDerivativeX(u);if(Math.abs(E)<1e-6)break;u-=v/E}var A=0,M=1;for(u=o,g=0;g<20&&(v=this.sampleCurveX(u),!(Math.abs(v-o)<i));g++)o>v?A=u:M=u,u=.5*(M-A)+A;return u},solve:function(o,i){return this.sampleCurveY(this.solveCurveX(o,i))}};var vc=za(Si);function qs(o,i,u){return o+u*(i-o)}function br(o,i,u){return o.map((g,v)=>qs(g,i[v],u))}const xi={number:qs,color:function(o,i,u,g="rgb"){switch(g){case"rgb":{const[v,E,A,M]=br(o.rgb,i.rgb,u);return new ei(v,E,A,M,!1)}case"hcl":{const[v,E,A,M]=o.hcl,[P,F,j,G]=i.hcl;let W,te;if(isNaN(v)||isNaN(P))isNaN(v)?isNaN(P)?W=NaN:(W=P,A!==1&&A!==0||(te=F)):(W=v,j!==1&&j!==0||(te=E));else{let nt=P-v;P>v&&nt>180?nt-=360:P<v&&v-P>180&&(nt+=360),W=v+u*nt}const[re,de,Ce,De]=function([nt,Ge,Qe,ht]){return nt=isNaN(nt)?0:nt*ln,ci([Qe,Math.cos(nt)*Ge,Math.sin(nt)*Ge,ht])}([W,te??qs(E,F,u),qs(A,j,u),qs(M,G,u)]);return new ei(re,de,Ce,De,!1)}case"lab":{const[v,E,A,M]=ci(br(o.lab,i.lab,u));return new ei(v,E,A,M,!1)}}},array:br,padding:function(o,i,u){return new Nr(br(o.values,i.values,u))},variableAnchorOffsetCollection:function(o,i,u){const g=o.values,v=i.values;if(g.length!==v.length)throw new Ui(`Cannot interpolate values of different length. from: ${o.toString()}, to: ${i.toString()}`);const E=[];for(let A=0;A<g.length;A+=2){if(g[A]!==v[A])throw new Ui(`Cannot interpolate values containing mismatched anchors. from[${A}]: ${g[A]}, to[${A}]: ${v[A]}`);E.push(g[A]);const[M,P]=g[A+1],[F,j]=v[A+1];E.push([qs(M,F,u),qs(P,j,u)])}return new Ni(E)}};class cr{constructor(i,u,g,v,E){this.type=i,this.operator=u,this.interpolation=g,this.input=v,this.labels=[],this.outputs=[];for(const[A,M]of E)this.labels.push(A),this.outputs.push(M)}static interpolationFactor(i,u,g,v){let E=0;if(i.name==="exponential")E=Fa(u,i.base,g,v);else if(i.name==="linear")E=Fa(u,1,g,v);else if(i.name==="cubic-bezier"){const A=i.controlPoints;E=new vc(A[0],A[1],A[2],A[3]).solve(Fa(u,1,g,v))}return E}static parse(i,u){let[g,v,E,...A]=i;if(!Array.isArray(v)||v.length===0)return u.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const F=v[1];if(typeof F!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:F}}else{if(v[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const F=v.slice(1);if(F.length!==4||F.some(j=>typeof j!="number"||j<0||j>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:F}}}if(i.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(E=u.parse(E,2,Mt),!E)return null;const M=[];let P=null;g==="interpolate-hcl"||g==="interpolate-lab"?P=vr:u.expectedType&&u.expectedType.kind!=="value"&&(P=u.expectedType);for(let F=0;F<A.length;F+=2){const j=A[F],G=A[F+1],W=F+3,te=F+4;if(typeof j!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',W);if(M.length&&M[M.length-1][0]>=j)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',W);const re=u.parse(G,te,P);if(!re)return null;P=P||re.type,M.push([j,re])}return Xe(P,Mt)||Xe(P,vr)||Xe(P,Ji)||Xe(P,Re)||Xe(P,J(Mt))?new cr(P,g,v,E,M):u.error(`Type ${$(P)} is not interpolatable.`)}evaluate(i){const u=this.labels,g=this.outputs;if(u.length===1)return g[0].evaluate(i);const v=this.input.evaluate(i);if(v<=u[0])return g[0].evaluate(i);const E=u.length;if(v>=u[E-1])return g[E-1].evaluate(i);const A=da(u,v),M=cr.interpolationFactor(this.interpolation,v,u[A],u[A+1]),P=g[A].evaluate(i),F=g[A+1].evaluate(i);switch(this.operator){case"interpolate":return xi[this.type.kind](P,F,M);case"interpolate-hcl":return xi.color(P,F,M,"hcl");case"interpolate-lab":return xi.color(P,F,M,"lab")}}eachChild(i){i(this.input);for(const u of this.outputs)i(u)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Fa(o,i,u,g){const v=g-u,E=o-u;return v===0?0:i===1?E/v:(Math.pow(i,E)-1)/(Math.pow(i,v)-1)}class Oa{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expectected at least one argument.");let g=null;const v=u.expectedType;v&&v.kind!=="value"&&(g=v);const E=[];for(const M of i.slice(1)){const P=u.parse(M,1+E.length,g,void 0,{typeAnnotation:"omit"});if(!P)return null;g=g||P.type,E.push(P)}if(!g)throw new Error("No output type");const A=v&&E.some(M=>ue(v,M.type));return new Oa(A?bn:g,E)}evaluate(i){let u,g=null,v=0;for(const E of this.args)if(v++,g=E.evaluate(i),g&&g instanceof or&&!g.available&&(u||(u=g.name),g=null,v===this.args.length&&(g=u)),g!==null)break;return g}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}function pa(o,i){return o==="=="||o==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function ma(o,i,u,g){return g.compare(i,u)===0}function Oo(o,i,u){const g=o!=="=="&&o!=="!=";return class rv{constructor(E,A,M){this.type=At,this.lhs=E,this.rhs=A,this.collator=M,this.hasUntypedArgument=E.type.kind==="value"||A.type.kind==="value"}static parse(E,A){if(E.length!==3&&E.length!==4)return A.error("Expected two or three arguments.");const M=E[0];let P=A.parse(E[1],1,bn);if(!P)return null;if(!pa(M,P.type))return A.concat(1).error(`"${M}" comparisons are not supported for type '${$(P.type)}'.`);let F=A.parse(E[2],2,bn);if(!F)return null;if(!pa(M,F.type))return A.concat(2).error(`"${M}" comparisons are not supported for type '${$(F.type)}'.`);if(P.type.kind!==F.type.kind&&P.type.kind!=="value"&&F.type.kind!=="value")return A.error(`Cannot compare types '${$(P.type)}' and '${$(F.type)}'.`);g&&(P.type.kind==="value"&&F.type.kind!=="value"?P=new es(F.type,[P]):P.type.kind!=="value"&&F.type.kind==="value"&&(F=new es(P.type,[F])));let j=null;if(E.length===4){if(P.type.kind!=="string"&&F.type.kind!=="string"&&P.type.kind!=="value"&&F.type.kind!=="value")return A.error("Cannot use collator to compare non-string types.");if(j=A.parse(E[3],3,Pi),!j)return null}return new rv(P,F,j)}evaluate(E){const A=this.lhs.evaluate(E),M=this.rhs.evaluate(E);if(g&&this.hasUntypedArgument){const P=zi(A),F=zi(M);if(P.kind!==F.kind||P.kind!=="string"&&P.kind!=="number")throw new Ui(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${P.kind}, ${F.kind}) instead.`)}if(this.collator&&!g&&this.hasUntypedArgument){const P=zi(A),F=zi(M);if(P.kind!=="string"||F.kind!=="string")return i(E,A,M)}return this.collator?u(E,A,M,this.collator.evaluate(E)):i(E,A,M)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}}}const au=Oo("==",function(o,i,u){return i===u},ma),si=Oo("!=",function(o,i,u){return i!==u},function(o,i,u,g){return!ma(0,i,u,g)}),ys=Oo("<",function(o,i,u){return i<u},function(o,i,u,g){return g.compare(i,u)<0}),Tl=Oo(">",function(o,i,u){return i>u},function(o,i,u,g){return g.compare(i,u)>0}),lu=Oo("<=",function(o,i,u){return i<=u},function(o,i,u,g){return g.compare(i,u)<=0}),Bo=Oo(">=",function(o,i,u){return i>=u},function(o,i,u,g){return g.compare(i,u)>=0});class Uo{constructor(i,u,g){this.type=Pi,this.locale=g,this.caseSensitive=i,this.diacriticSensitive=u}static parse(i,u){if(i.length!==2)return u.error("Expected one argument.");const g=i[1];if(typeof g!="object"||Array.isArray(g))return u.error("Collator options argument must be an object.");const v=u.parse(g["case-sensitive"]!==void 0&&g["case-sensitive"],1,At);if(!v)return null;const E=u.parse(g["diacritic-sensitive"]!==void 0&&g["diacritic-sensitive"],1,At);if(!E)return null;let A=null;return g.locale&&(A=u.parse(g.locale,1,An),!A)?null:new Uo(v,E,A)}evaluate(i){return new bo(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}class hr{constructor(i,u,g,v,E){this.type=An,this.number=i,this.locale=u,this.currency=g,this.minFractionDigits=v,this.maxFractionDigits=E}static parse(i,u){if(i.length!==3)return u.error("Expected two arguments.");const g=u.parse(i[1],1,Mt);if(!g)return null;const v=i[2];if(typeof v!="object"||Array.isArray(v))return u.error("NumberFormat options argument must be an object.");let E=null;if(v.locale&&(E=u.parse(v.locale,1,An),!E))return null;let A=null;if(v.currency&&(A=u.parse(v.currency,1,An),!A))return null;let M=null;if(v["min-fraction-digits"]&&(M=u.parse(v["min-fraction-digits"],1,Mt),!M))return null;let P=null;return v["max-fraction-digits"]&&(P=u.parse(v["max-fraction-digits"],1,Mt),!P)?null:new hr(g,E,A,M,P)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class ga{constructor(i){this.type=Ar,this.sections=i}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");const g=i[1];if(!Array.isArray(g)&&typeof g=="object")return u.error("First argument must be an image or text section.");const v=[];let E=!1;for(let A=1;A<=i.length-1;++A){const M=i[A];if(E&&typeof M=="object"&&!Array.isArray(M)){E=!1;let P=null;if(M["font-scale"]&&(P=u.parse(M["font-scale"],1,Mt),!P))return null;let F=null;if(M["text-font"]&&(F=u.parse(M["text-font"],1,J(An)),!F))return null;let j=null;if(M["text-color"]&&(j=u.parse(M["text-color"],1,vr),!j))return null;const G=v[v.length-1];G.scale=P,G.font=F,G.textColor=j}else{const P=u.parse(i[A],1,bn);if(!P)return null;const F=P.type.kind;if(F!=="string"&&F!=="value"&&F!=="null"&&F!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,v.push({content:P,scale:null,font:null,textColor:null})}}return new ga(v)}evaluate(i){return new Cr(this.sections.map(u=>{const g=u.content.evaluate(i);return zi(g)===Zr?new aa("",g,null,null,null):new aa(la(g),null,u.scale?u.scale.evaluate(i):null,u.font?u.font.evaluate(i).join(","):null,u.textColor?u.textColor.evaluate(i):null)}))}eachChild(i){for(const u of this.sections)i(u.content),u.scale&&i(u.scale),u.font&&i(u.font),u.textColor&&i(u.textColor)}outputDefined(){return!1}}class _a{constructor(i){this.type=Zr,this.input=i}static parse(i,u){if(i.length!==2)return u.error("Expected two arguments.");const g=u.parse(i[1],1,An);return g?new _a(g):u.error("No image name provided.")}evaluate(i){const u=this.input.evaluate(i),g=or.fromString(u);return g&&i.availableImages&&(g.available=i.availableImages.indexOf(u)>-1),g}eachChild(i){i(this.input)}outputDefined(){return!1}}class Ba{constructor(i){this.type=Mt,this.input=i}static parse(i,u){if(i.length!==2)return u.error(`Expected 1 argument, but found ${i.length-1} instead.`);const g=u.parse(i[1],1);return g?g.type.kind!=="array"&&g.type.kind!=="string"&&g.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${$(g.type)} instead.`):new Ba(g):null}evaluate(i){const u=this.input.evaluate(i);if(typeof u=="string")return[...u].length;if(Array.isArray(u))return u.length;throw new Ui(`Expected value to be of type string or array, but found ${$(zi(u))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const vs=8192;function bc(o,i){const u=(180+o[0])/360,g=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,v=Math.pow(2,i.z);return[Math.round(u*v*vs),Math.round(g*v*vs)]}function Ua(o,i){const u=Math.pow(2,i.z);return[(v=(o[0]/vs+i.x)/u,360*v-180),(g=(o[1]/vs+i.y)/u,360/Math.PI*Math.atan(Math.exp((180-360*g)*Math.PI/180))-90)];var g,v}function Lr(o,i){o[0]=Math.min(o[0],i[0]),o[1]=Math.min(o[1],i[1]),o[2]=Math.max(o[2],i[0]),o[3]=Math.max(o[3],i[1])}function bs(o,i){return!(o[0]<=i[0]||o[2]>=i[2]||o[1]<=i[1]||o[3]>=i[3])}function oi(o,i,u){const g=o[0]-i[0],v=o[1]-i[1],E=o[0]-u[0],A=o[1]-u[1];return g*A-E*v==0&&g*E<=0&&v*A<=0}function Mr(o,i,u,g){return(v=[g[0]-u[0],g[1]-u[1]])[0]*(E=[i[0]-o[0],i[1]-o[1]])[1]-v[1]*E[0]!=0&&!(!uu(o,i,u,g)||!uu(u,g,o,i));var v,E}function jo(o,i,u){for(const g of u)for(let v=0;v<g.length-1;++v)if(Mr(o,i,g[v],g[v+1]))return!0;return!1}function qo(o,i,u=!1){let g=!1;for(const M of i)for(let P=0;P<M.length-1;P++){if(oi(o,M[P],M[P+1]))return u;(E=M[P])[1]>(v=o)[1]!=(A=M[P+1])[1]>v[1]&&v[0]<(A[0]-E[0])*(v[1]-E[1])/(A[1]-E[1])+E[0]&&(g=!g)}var v,E,A;return g}function Vo(o,i){for(const u of i)if(qo(o,u))return!0;return!1}function Cl(o,i){for(const u of o)if(!qo(u,i))return!1;for(let u=0;u<o.length-1;++u)if(jo(o[u],o[u+1],i))return!1;return!0}function Go(o,i){for(const u of i)if(Cl(o,u))return!0;return!1}function uu(o,i,u,g){const v=g[0]-u[0],E=g[1]-u[1],A=(o[0]-u[0])*E-v*(o[1]-u[1]),M=(i[0]-u[0])*E-v*(i[1]-u[1]);return A>0&&M<0||A<0&&M>0}function ns(o,i,u){const g=[];for(let v=0;v<o.length;v++){const E=[];for(let A=0;A<o[v].length;A++){const M=bc(o[v][A],u);Lr(i,M),E.push(M)}g.push(E)}return g}function Ll(o,i,u){const g=[];for(let v=0;v<o.length;v++){const E=ns(o[v],i,u);g.push(E)}return g}function cu(o,i,u,g){if(o[0]<u[0]||o[0]>u[2]){const v=.5*g;let E=o[0]-u[0]>v?-g:u[0]-o[0]>v?g:0;E===0&&(E=o[0]-u[2]>v?-g:u[2]-o[0]>v?g:0),o[0]+=E}Lr(i,o)}function hu(o,i,u,g){const v=Math.pow(2,g.z)*vs,E=[g.x*vs,g.y*vs],A=[];for(const M of o)for(const P of M){const F=[P.x+E[0],P.y+E[1]];cu(F,i,u,v),A.push(F)}return A}function fu(o,i,u,g){const v=Math.pow(2,g.z)*vs,E=[g.x*vs,g.y*vs],A=[];for(const P of o){const F=[];for(const j of P){const G=[j.x+E[0],j.y+E[1]];Lr(i,G),F.push(G)}A.push(F)}if(i[2]-i[0]<=v/2){(M=i)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const P of A)for(const F of P)cu(F,i,u,v)}var M;return A}class ko{constructor(i,u){this.type=At,this.geojson=i,this.geometries=u}static parse(i,u){if(i.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Qr(i[1])){const g=i[1];if(g.type==="FeatureCollection"){const v=[];for(const E of g.features){const{type:A,coordinates:M}=E.geometry;A==="Polygon"&&v.push(M),A==="MultiPolygon"&&v.push(...M)}if(v.length)return new ko(g,{type:"MultiPolygon",coordinates:v})}else if(g.type==="Feature"){const v=g.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new ko(g,g.geometry)}else if(g.type==="Polygon"||g.type==="MultiPolygon")return new ko(g,g)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(u,g){const v=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],A=u.canonicalID();if(g.type==="Polygon"){const M=ns(g.coordinates,E,A),P=hu(u.geometry(),v,E,A);if(!bs(v,E))return!1;for(const F of P)if(!qo(F,M))return!1}if(g.type==="MultiPolygon"){const M=Ll(g.coordinates,E,A),P=hu(u.geometry(),v,E,A);if(!bs(v,E))return!1;for(const F of P)if(!Vo(F,M))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(u,g){const v=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],A=u.canonicalID();if(g.type==="Polygon"){const M=ns(g.coordinates,E,A),P=fu(u.geometry(),v,E,A);if(!bs(v,E))return!1;for(const F of P)if(!Cl(F,M))return!1}if(g.type==="MultiPolygon"){const M=Ll(g.coordinates,E,A),P=fu(u.geometry(),v,E,A);if(!bs(v,E))return!1;for(const F of P)if(!Go(F,M))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let du=class{constructor(o=[],i=(u,g)=>u<g?-1:u>g?1:0){if(this.data=o,this.length=this.data.length,this.compare=i,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:i,compare:u}=this,g=i[o];for(;o>0;){const v=o-1>>1,E=i[v];if(u(g,E)>=0)break;i[o]=E,o=v}i[o]=g}_down(o){const{data:i,compare:u}=this,g=this.length>>1,v=i[o];for(;o<g;){let E=1+(o<<1);const A=E+1;if(A<this.length&&u(i[A],i[E])<0&&(E=A),u(i[E],v)>=0)break;i[o]=i[E],o=E}i[o]=v}};function xc(o,i,u,g,v){pu(o,i,u,g||o.length-1,v||Hr)}function pu(o,i,u,g,v){for(;g>u;){if(g-u>600){var E=g-u+1,A=i-u+1,M=Math.log(E),P=.5*Math.exp(2*M/3),F=.5*Math.sqrt(M*P*(E-P)/E)*(A-E/2<0?-1:1);pu(o,i,Math.max(u,Math.floor(i-A*P/E+F)),Math.min(g,Math.floor(i+(E-A)*P/E+F)),v)}var j=o[i],G=u,W=g;for(xs(o,u,i),v(o[g],j)>0&&xs(o,u,g);G<W;){for(xs(o,G,W),G++,W--;v(o[G],j)<0;)G++;for(;v(o[W],j)>0;)W--}v(o[u],j)===0?xs(o,u,W):xs(o,++W,g),W<=i&&(u=W+1),i<=W&&(g=W-1)}}function xs(o,i,u){var g=o[i];o[i]=o[u],o[u]=g}function Hr(o,i){return o<i?-1:o>i?1:0}function ja(o,i){if(o.length<=1)return[o];const u=[];let g,v;for(const E of o){const A=wc(E);A!==0&&(E.area=Math.abs(A),v===void 0&&(v=A<0),v===A<0?(g&&u.push(g),g=[E]):g.push(E))}if(g&&u.push(g),i>1)for(let E=0;E<u.length;E++)u[E].length<=i||(xc(u[E],i,1,u[E].length-1,mu),u[E]=u[E].slice(0,i));return u}function mu(o,i){return i.area-o.area}function wc(o){let i=0;for(let u,g,v=0,E=o.length,A=E-1;v<E;A=v++)u=o[v],g=o[A],i+=(g.x-u.x)*(u.y+g.y);return i}const qa=1/298.257223563,Ml=qa*(2-qa),Va=Math.PI/180;class Ga{constructor(i){const u=6378.137*Va*1e3,g=Math.cos(i*Va),v=1/(1-Ml*(1-g*g)),E=Math.sqrt(v);this.kx=u*E*g,this.ky=u*E*v*(1-Ml)}distance(i,u){const g=this.wrap(i[0]-u[0])*this.kx,v=(i[1]-u[1])*this.ky;return Math.sqrt(g*g+v*v)}pointOnLine(i,u){let g,v,E,A,M=1/0;for(let P=0;P<i.length-1;P++){let F=i[P][0],j=i[P][1],G=this.wrap(i[P+1][0]-F)*this.kx,W=(i[P+1][1]-j)*this.ky,te=0;G===0&&W===0||(te=(this.wrap(u[0]-F)*this.kx*G+(u[1]-j)*this.ky*W)/(G*G+W*W),te>1?(F=i[P+1][0],j=i[P+1][1]):te>0&&(F+=G/this.kx*te,j+=W/this.ky*te)),G=this.wrap(u[0]-F)*this.kx,W=(u[1]-j)*this.ky;const re=G*G+W*W;re<M&&(M=re,g=F,v=j,E=P,A=te)}return{point:[g,v],index:E,t:Math.max(0,Math.min(1,A))}}wrap(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}}function is(o,i){return i[0]-o[0]}function ya(o){return o[1]-o[0]+1}function ji(o,i){return o[1]>=o[0]&&o[1]<i}function Io(o,i){if(o[0]>o[1])return[null,null];const u=ya(o);if(i){if(u===2)return[o,null];const v=Math.floor(u/2);return[[o[0],o[0]+v],[o[0]+v,o[1]]]}if(u===1)return[o,null];const g=Math.floor(u/2)-1;return[[o[0],o[0]+g],[o[0]+g+1,o[1]]]}function Rl(o,i){if(!ji(i,o.length))return[1/0,1/0,-1/0,-1/0];const u=[1/0,1/0,-1/0,-1/0];for(let g=i[0];g<=i[1];++g)Lr(u,o[g]);return u}function Za(o){const i=[1/0,1/0,-1/0,-1/0];for(const u of o)for(const g of u)Lr(i,g);return i}function va(o){return o[0]!==-1/0&&o[1]!==-1/0&&o[2]!==1/0&&o[3]!==1/0}function Ha(o,i,u){if(!va(o)||!va(i))return NaN;let g=0,v=0;return o[2]<i[0]&&(g=i[0]-o[2]),o[0]>i[2]&&(g=o[0]-i[2]),o[1]>i[3]&&(v=o[1]-i[3]),o[3]<i[1]&&(v=i[1]-o[3]),u.distance([0,0],[g,v])}function Vs(o,i,u){const g=u.pointOnLine(i,o);return u.distance(o,g.point)}function Pl(o,i,u,g,v){const E=Math.min(Vs(o,[u,g],v),Vs(i,[u,g],v)),A=Math.min(Vs(u,[o,i],v),Vs(g,[o,i],v));return Math.min(E,A)}function kc(o,i,u,g,v){if(!ji(i,o.length)||!ji(g,u.length))return 1/0;let E=1/0;for(let A=i[0];A<i[1];++A){const M=o[A],P=o[A+1];for(let F=g[0];F<g[1];++F){const j=u[F],G=u[F+1];if(Mr(M,P,j,G))return 0;E=Math.min(E,Pl(M,P,j,G,v))}}return E}function Fi(o,i,u,g,v){if(!ji(i,o.length)||!ji(g,u.length))return NaN;let E=1/0;for(let A=i[0];A<=i[1];++A)for(let M=g[0];M<=g[1];++M)if(E=Math.min(E,v.distance(o[A],u[M])),E===0)return E;return E}function Ic(o,i,u){if(qo(o,i,!0))return 0;let g=1/0;for(const v of i){const E=v[0],A=v[v.length-1];if(E!==A&&(g=Math.min(g,Vs(o,[A,E],u)),g===0))return g;const M=u.pointOnLine(v,o);if(g=Math.min(g,u.distance(o,M.point)),g===0)return g}return g}function jn(o,i,u,g){if(!ji(i,o.length))return NaN;for(let E=i[0];E<=i[1];++E)if(qo(o[E],u,!0))return 0;let v=1/0;for(let E=i[0];E<i[1];++E){const A=o[E],M=o[E+1];for(const P of u)for(let F=0,j=P.length,G=j-1;F<j;G=F++){const W=P[G],te=P[F];if(Mr(A,M,W,te))return 0;v=Math.min(v,Pl(A,M,W,te,g))}}return v}function Xa(o,i){for(const u of o)for(const g of u)if(qo(g,i,!0))return!0;return!1}function mi(o,i,u,g=1/0){const v=Za(o),E=Za(i);if(g!==1/0&&Ha(v,E,u)>=g)return g;if(bs(v,E)){if(Xa(o,i))return 0}else if(Xa(i,o))return 0;let A=1/0;for(const M of o)for(let P=0,F=M.length,j=F-1;P<F;j=P++){const G=M[j],W=M[P];for(const te of i)for(let re=0,de=te.length,Ce=de-1;re<de;Ce=re++){const De=te[Ce],nt=te[re];if(Mr(G,W,De,nt))return 0;A=Math.min(A,Pl(G,W,De,nt,u))}}return A}function hi(o,i,u,g,v,E){if(!E)return;const A=Ha(Rl(g,E),v,u);A<i&&o.push([A,E,[0,0]])}function oo(o,i,u,g,v,E,A){if(!E||!A)return;const M=Ha(Rl(g,E),Rl(v,A),u);M<i&&o.push([M,E,A])}function ba(o,i,u,g,v=1/0){let E=Math.min(g.distance(o[0],u[0][0]),v);if(E===0)return E;const A=new du([[0,[0,o.length-1],[0,0]]],is),M=Za(u);for(;A.length>0;){const P=A.pop();if(P[0]>=E)continue;const F=P[1],j=i?50:100;if(ya(F)<=j){if(!ji(F,o.length))return NaN;if(i){const G=jn(o,F,u,g);if(isNaN(G)||G===0)return G;E=Math.min(E,G)}else for(let G=F[0];G<=F[1];++G){const W=Ic(o[G],u,g);if(E=Math.min(E,W),E===0)return 0}}else{const G=Io(F,i);hi(A,E,g,o,M,G[0]),hi(A,E,g,o,M,G[1])}}return E}function Zo(o,i,u,g,v,E=1/0){let A=Math.min(E,v.distance(o[0],u[0]));if(A===0)return A;const M=new du([[0,[0,o.length-1],[0,u.length-1]]],is);for(;M.length>0;){const P=M.pop();if(P[0]>=A)continue;const F=P[1],j=P[2],G=i?50:100,W=g?50:100;if(ya(F)<=G&&ya(j)<=W){if(!ji(F,o.length)&&ji(j,u.length))return NaN;let te;if(i&&g)te=kc(o,F,u,j,v),A=Math.min(A,te);else if(i&&!g){const re=o.slice(F[0],F[1]+1);for(let de=j[0];de<=j[1];++de)if(te=Vs(u[de],re,v),A=Math.min(A,te),A===0)return A}else if(!i&&g){const re=u.slice(j[0],j[1]+1);for(let de=F[0];de<=F[1];++de)if(te=Vs(o[de],re,v),A=Math.min(A,te),A===0)return A}else te=Fi(o,F,u,j,v),A=Math.min(A,te)}else{const te=Io(F,i),re=Io(j,g);oo(M,A,v,o,u,te[0],re[0]),oo(M,A,v,o,u,te[0],re[1]),oo(M,A,v,o,u,te[1],re[0]),oo(M,A,v,o,u,te[1],re[1])}}return A}function Dl(o){return o.type==="MultiPolygon"?o.coordinates.map(i=>({type:"Polygon",coordinates:i})):o.type==="MultiLineString"?o.coordinates.map(i=>({type:"LineString",coordinates:i})):o.type==="MultiPoint"?o.coordinates.map(i=>({type:"Point",coordinates:i})):[o]}class So{constructor(i,u){this.type=Mt,this.geojson=i,this.geometries=u}static parse(i,u){if(i.length!==2)return u.error(`'distance' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Qr(i[1])){const g=i[1];if(g.type==="FeatureCollection")return new So(g,g.features.map(v=>Dl(v.geometry)).flat());if(g.type==="Feature")return new So(g,Dl(g.geometry));if("type"in g&&"coordinates"in g)return new So(g,Dl(g))}return u.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(u,g){const v=u.geometry(),E=v.flat().map(P=>Ua([P.x,P.y],u.canonical));if(v.length===0)return NaN;const A=new Ga(E[0][1]);let M=1/0;for(const P of g){switch(P.type){case"Point":M=Math.min(M,Zo(E,!1,[P.coordinates],!1,A,M));break;case"LineString":M=Math.min(M,Zo(E,!1,P.coordinates,!0,A,M));break;case"Polygon":M=Math.min(M,ba(E,!1,P.coordinates,A,M))}if(M===0)return M}return M}(i,this.geometries);if(i.geometryType()==="LineString")return function(u,g){const v=u.geometry(),E=v.flat().map(P=>Ua([P.x,P.y],u.canonical));if(v.length===0)return NaN;const A=new Ga(E[0][1]);let M=1/0;for(const P of g){switch(P.type){case"Point":M=Math.min(M,Zo(E,!0,[P.coordinates],!1,A,M));break;case"LineString":M=Math.min(M,Zo(E,!0,P.coordinates,!0,A,M));break;case"Polygon":M=Math.min(M,ba(E,!0,P.coordinates,A,M))}if(M===0)return M}return M}(i,this.geometries);if(i.geometryType()==="Polygon")return function(u,g){const v=u.geometry();if(v.length===0||v[0].length===0)return NaN;const E=ja(v,0).map(P=>P.map(F=>F.map(j=>Ua([j.x,j.y],u.canonical)))),A=new Ga(E[0][0][0][1]);let M=1/0;for(const P of g)for(const F of E){switch(P.type){case"Point":M=Math.min(M,ba([P.coordinates],!1,F,A,M));break;case"LineString":M=Math.min(M,ba(P.coordinates,!0,F,A,M));break;case"Polygon":M=Math.min(M,mi(F,P.coordinates,A,M))}if(M===0)return M}return M}(i,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Ho={"==":au,"!=":si,">":Tl,"<":ys,">=":Bo,"<=":lu,array:es,at:El,boolean:es,case:ha,coalesce:Oa,collator:Uo,format:ga,image:_a,in:Al,"index-of":xo,interpolate:cr,"interpolate-hcl":cr,"interpolate-lab":cr,length:Ba,let:ro,literal:_s,match:wo,number:es,"number-format":hr,object:es,slice:fa,step:Fo,string:es,"to-boolean":Qi,"to-color":Qi,"to-number":Qi,"to-string":Qi,var:ti,within:ko,distance:So};class rs{constructor(i,u,g,v){this.name=i,this.type=u,this._evaluate=g,this.args=v}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,u){const g=i[0],v=rs.definitions[g];if(!v)return u.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0);const E=Array.isArray(v)?v[0]:v.type,A=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,M=A.filter(([F])=>!Array.isArray(F)||F.length===i.length-1);let P=null;for(const[F,j]of M){P=new ts(u.registry,Xo,u.path,null,u.scope);const G=[];let W=!1;for(let te=1;te<i.length;te++){const re=i[te],de=Array.isArray(F)?F[te-1]:F.type,Ce=P.parse(re,1+G.length,de);if(!Ce){W=!0;break}G.push(Ce)}if(!W)if(Array.isArray(F)&&F.length!==G.length)P.error(`Expected ${F.length} arguments, but found ${G.length} instead.`);else{for(let te=0;te<G.length;te++){const re=Array.isArray(F)?F[te]:F.type,de=G[te];P.concat(te+1).checkSubtype(re,de.type)}if(P.errors.length===0)return new rs(g,E,j,G)}}if(M.length===1)u.errors.push(...P.errors);else{const F=(M.length?M:A).map(([G])=>{return W=G,Array.isArray(W)?`(${W.map($).join(", ")})`:`(${$(W.type)}...)`;var W}).join(" | "),j=[];for(let G=1;G<i.length;G++){const W=u.parse(i[G],1+j.length);if(!W)return null;j.push($(W.type))}u.error(`Expected arguments of type ${F}, but found (${j.join(", ")}) instead.`)}return null}static register(i,u){rs.definitions=u;for(const g in u)i[g]=rs}}function Nl(o,[i,u,g,v]){i=i.evaluate(o),u=u.evaluate(o),g=g.evaluate(o);const E=v?v.evaluate(o):1,A=no(i,u,g,E);if(A)throw new Ui(A);return new ei(i/255,u/255,g/255,E,!1)}function zl(o,i){return o in i}function Fl(o,i){const u=i[o];return u===void 0?null:u}function ao(o){return{type:o}}function Xo(o){if(o instanceof ti)return Xo(o.boundExpression);if(o instanceof rs&&o.name==="error"||o instanceof Uo||o instanceof ko||o instanceof So)return!1;const i=o instanceof Qi||o instanceof es;let u=!0;return o.eachChild(g=>{u=i?u&&Xo(g):u&&g instanceof _s}),!!u&&Wo(o)&&$o(o,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Wo(o){if(o instanceof rs&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof ko||o instanceof So)return!1;let i=!0;return o.eachChild(u=>{i&&!Wo(u)&&(i=!1)}),i}function Ko(o){if(o instanceof rs&&o.name==="feature-state")return!1;let i=!0;return o.eachChild(u=>{i&&!Ko(u)&&(i=!1)}),i}function $o(o,i){if(o instanceof rs&&i.indexOf(o.name)>=0)return!1;let u=!0;return o.eachChild(g=>{u&&!$o(g,i)&&(u=!1)}),u}function Yo(o){return{result:"success",value:o}}function Jo(o){return{result:"error",value:o}}function Eo(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function Ol(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Bl(o){return!!o.expression&&o.expression.interpolated}function Yn(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function Gs(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function Sc(o){return o}function Ul(o,i){const u=i.type==="color",g=o.stops&&typeof o.stops[0][0]=="object",v=g||!(g||o.property!==void 0),E=o.type||(Bl(i)?"exponential":"interval");if(u||i.type==="padding"){const j=u?ei.parse:Nr.parse;(o=yr({},o)).stops&&(o.stops=o.stops.map(G=>[G[0],j(G[1])])),o.default=j(o.default?o.default:i.default)}if(o.colorSpace&&(A=o.colorSpace)!=="rgb"&&A!=="hcl"&&A!=="lab")throw new Error(`Unknown color space: "${o.colorSpace}"`);var A;let M,P,F;if(E==="exponential")M=c;else if(E==="interval")M=I;else if(E==="categorical"){M=ws,P=Object.create(null);for(const j of o.stops)P[j[0]]=j[1];F=typeof o.stops[0][0]}else{if(E!=="identity")throw new Error(`Unknown function type "${E}"`);M=d}if(g){const j={},G=[];for(let re=0;re<o.stops.length;re++){const de=o.stops[re],Ce=de[0].zoom;j[Ce]===void 0&&(j[Ce]={zoom:Ce,type:o.type,property:o.property,default:o.default,stops:[]},G.push(Ce)),j[Ce].stops.push([de[0].value,de[1]])}const W=[];for(const re of G)W.push([j[re].zoom,Ul(j[re],i)]);const te={name:"linear"};return{kind:"composite",interpolationType:te,interpolationFactor:cr.interpolationFactor.bind(void 0,te),zoomStops:W.map(re=>re[0]),evaluate:({zoom:re},de)=>c({stops:W,base:o.base},i,re).evaluate(re,de)}}if(v){const j=E==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:j,interpolationFactor:cr.interpolationFactor.bind(void 0,j),zoomStops:o.stops.map(G=>G[0]),evaluate:({zoom:G})=>M(o,i,G,P,F)}}return{kind:"source",evaluate(j,G){const W=G&&G.properties?G.properties[o.property]:void 0;return W===void 0?fr(o.default,i.default):M(o,i,W,P,F)}}}function fr(o,i,u){return o!==void 0?o:i!==void 0?i:u!==void 0?u:void 0}function ws(o,i,u,g,v){return fr(typeof u===v?g[u]:void 0,o.default,i.default)}function I(o,i,u){if(Yn(u)!=="number")return fr(o.default,i.default);const g=o.stops.length;if(g===1||u<=o.stops[0][0])return o.stops[0][1];if(u>=o.stops[g-1][0])return o.stops[g-1][1];const v=da(o.stops.map(E=>E[0]),u);return o.stops[v][1]}function c(o,i,u){const g=o.base!==void 0?o.base:1;if(Yn(u)!=="number")return fr(o.default,i.default);const v=o.stops.length;if(v===1||u<=o.stops[0][0])return o.stops[0][1];if(u>=o.stops[v-1][0])return o.stops[v-1][1];const E=da(o.stops.map(j=>j[0]),u),A=function(j,G,W,te){const re=te-W,de=j-W;return re===0?0:G===1?de/re:(Math.pow(G,de)-1)/(Math.pow(G,re)-1)}(u,g,o.stops[E][0],o.stops[E+1][0]),M=o.stops[E][1],P=o.stops[E+1][1],F=xi[i.type]||Sc;return typeof M.evaluate=="function"?{evaluate(...j){const G=M.evaluate.apply(void 0,j),W=P.evaluate.apply(void 0,j);if(G!==void 0&&W!==void 0)return F(G,W,A,o.colorSpace)}}:F(M,P,A,o.colorSpace)}function d(o,i,u){switch(i.type){case"color":u=ei.parse(u);break;case"formatted":u=Cr.fromString(u.toString());break;case"resolvedImage":u=or.fromString(u.toString());break;case"padding":u=Nr.parse(u);break;default:Yn(u)===i.type||i.type==="enum"&&i.values[u]||(u=void 0)}return fr(u,o.default,i.default)}rs.register(Ho,{error:[{kind:"error"},[An],(o,[i])=>{throw new Ui(i.evaluate(o))}],typeof:[An,[bn],(o,[i])=>$(zi(i.evaluate(o)))],"to-rgba":[J(Mt,4),[vr],(o,[i])=>{const[u,g,v,E]=i.evaluate(o).rgb;return[255*u,255*g,255*v,E]}],rgb:[vr,[Mt,Mt,Mt],Nl],rgba:[vr,[Mt,Mt,Mt,Mt],Nl],has:{type:At,overloads:[[[An],(o,[i])=>zl(i.evaluate(o),o.properties())],[[An,Gr],(o,[i,u])=>zl(i.evaluate(o),u.evaluate(o))]]},get:{type:bn,overloads:[[[An],(o,[i])=>Fl(i.evaluate(o),o.properties())],[[An,Gr],(o,[i,u])=>Fl(i.evaluate(o),u.evaluate(o))]]},"feature-state":[bn,[An],(o,[i])=>Fl(i.evaluate(o),o.featureState||{})],properties:[Gr,[],o=>o.properties()],"geometry-type":[An,[],o=>o.geometryType()],id:[bn,[],o=>o.id()],zoom:[Mt,[],o=>o.globals.zoom],"heatmap-density":[Mt,[],o=>o.globals.heatmapDensity||0],"line-progress":[Mt,[],o=>o.globals.lineProgress||0],accumulated:[bn,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[Mt,ao(Mt),(o,i)=>{let u=0;for(const g of i)u+=g.evaluate(o);return u}],"*":[Mt,ao(Mt),(o,i)=>{let u=1;for(const g of i)u*=g.evaluate(o);return u}],"-":{type:Mt,overloads:[[[Mt,Mt],(o,[i,u])=>i.evaluate(o)-u.evaluate(o)],[[Mt],(o,[i])=>-i.evaluate(o)]]},"/":[Mt,[Mt,Mt],(o,[i,u])=>i.evaluate(o)/u.evaluate(o)],"%":[Mt,[Mt,Mt],(o,[i,u])=>i.evaluate(o)%u.evaluate(o)],ln2:[Mt,[],()=>Math.LN2],pi:[Mt,[],()=>Math.PI],e:[Mt,[],()=>Math.E],"^":[Mt,[Mt,Mt],(o,[i,u])=>Math.pow(i.evaluate(o),u.evaluate(o))],sqrt:[Mt,[Mt],(o,[i])=>Math.sqrt(i.evaluate(o))],log10:[Mt,[Mt],(o,[i])=>Math.log(i.evaluate(o))/Math.LN10],ln:[Mt,[Mt],(o,[i])=>Math.log(i.evaluate(o))],log2:[Mt,[Mt],(o,[i])=>Math.log(i.evaluate(o))/Math.LN2],sin:[Mt,[Mt],(o,[i])=>Math.sin(i.evaluate(o))],cos:[Mt,[Mt],(o,[i])=>Math.cos(i.evaluate(o))],tan:[Mt,[Mt],(o,[i])=>Math.tan(i.evaluate(o))],asin:[Mt,[Mt],(o,[i])=>Math.asin(i.evaluate(o))],acos:[Mt,[Mt],(o,[i])=>Math.acos(i.evaluate(o))],atan:[Mt,[Mt],(o,[i])=>Math.atan(i.evaluate(o))],min:[Mt,ao(Mt),(o,i)=>Math.min(...i.map(u=>u.evaluate(o)))],max:[Mt,ao(Mt),(o,i)=>Math.max(...i.map(u=>u.evaluate(o)))],abs:[Mt,[Mt],(o,[i])=>Math.abs(i.evaluate(o))],round:[Mt,[Mt],(o,[i])=>{const u=i.evaluate(o);return u<0?-Math.round(-u):Math.round(u)}],floor:[Mt,[Mt],(o,[i])=>Math.floor(i.evaluate(o))],ceil:[Mt,[Mt],(o,[i])=>Math.ceil(i.evaluate(o))],"filter-==":[At,[An,bn],(o,[i,u])=>o.properties()[i.value]===u.value],"filter-id-==":[At,[bn],(o,[i])=>o.id()===i.value],"filter-type-==":[At,[An],(o,[i])=>o.geometryType()===i.value],"filter-<":[At,[An,bn],(o,[i,u])=>{const g=o.properties()[i.value],v=u.value;return typeof g==typeof v&&g<v}],"filter-id-<":[At,[bn],(o,[i])=>{const u=o.id(),g=i.value;return typeof u==typeof g&&u<g}],"filter->":[At,[An,bn],(o,[i,u])=>{const g=o.properties()[i.value],v=u.value;return typeof g==typeof v&&g>v}],"filter-id->":[At,[bn],(o,[i])=>{const u=o.id(),g=i.value;return typeof u==typeof g&&u>g}],"filter-<=":[At,[An,bn],(o,[i,u])=>{const g=o.properties()[i.value],v=u.value;return typeof g==typeof v&&g<=v}],"filter-id-<=":[At,[bn],(o,[i])=>{const u=o.id(),g=i.value;return typeof u==typeof g&&u<=g}],"filter->=":[At,[An,bn],(o,[i,u])=>{const g=o.properties()[i.value],v=u.value;return typeof g==typeof v&&g>=v}],"filter-id->=":[At,[bn],(o,[i])=>{const u=o.id(),g=i.value;return typeof u==typeof g&&u>=g}],"filter-has":[At,[bn],(o,[i])=>i.value in o.properties()],"filter-has-id":[At,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[At,[J(An)],(o,[i])=>i.value.indexOf(o.geometryType())>=0],"filter-id-in":[At,[J(bn)],(o,[i])=>i.value.indexOf(o.id())>=0],"filter-in-small":[At,[An,J(bn)],(o,[i,u])=>u.value.indexOf(o.properties()[i.value])>=0],"filter-in-large":[At,[An,J(bn)],(o,[i,u])=>function(g,v,E,A){for(;E<=A;){const M=E+A>>1;if(v[M]===g)return!0;v[M]>g?A=M-1:E=M+1}return!1}(o.properties()[i.value],u.value,0,u.value.length-1)],all:{type:At,overloads:[[[At,At],(o,[i,u])=>i.evaluate(o)&&u.evaluate(o)],[ao(At),(o,i)=>{for(const u of i)if(!u.evaluate(o))return!1;return!0}]]},any:{type:At,overloads:[[[At,At],(o,[i,u])=>i.evaluate(o)||u.evaluate(o)],[ao(At),(o,i)=>{for(const u of i)if(u.evaluate(o))return!0;return!1}]]},"!":[At,[At],(o,[i])=>!i.evaluate(o)],"is-supported-script":[At,[An],(o,[i])=>{const u=o.globals&&o.globals.isSupportedScript;return!u||u(i.evaluate(o))}],upcase:[An,[An],(o,[i])=>i.evaluate(o).toUpperCase()],downcase:[An,[An],(o,[i])=>i.evaluate(o).toLowerCase()],concat:[An,ao(bn),(o,i)=>i.map(u=>la(u.evaluate(o))).join("")],"resolved-locale":[An,[Pi],(o,[i])=>i.evaluate(o).resolvedLocale()]});class p{constructor(i,u){var g;this.expression=i,this._warningHistory={},this._evaluator=new ca,this._defaultValue=u?(g=u).type==="color"&&Gs(g.default)?new ei(0,0,0,0):g.type==="color"?ei.parse(g.default)||null:g.type==="padding"?Nr.parse(g.default)||null:g.type==="variableAnchorOffsetCollection"?Ni.parse(g.default)||null:g.default===void 0?null:g.default:null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(i,u,g,v,E,A){return this._evaluator.globals=i,this._evaluator.feature=u,this._evaluator.featureState=g,this._evaluator.canonical=v,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=A,this.expression.evaluate(this._evaluator)}evaluate(i,u,g,v,E,A){this._evaluator.globals=i,this._evaluator.feature=u||null,this._evaluator.featureState=g||null,this._evaluator.canonical=v,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=A||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Ui(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function b(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Ho}function L(o,i){const u=new ts(Ho,Xo,[],i?function(v){const E={color:vr,string:An,number:Mt,enum:An,boolean:At,formatted:Ar,padding:Ji,resolvedImage:Zr,variableAnchorOffsetCollection:Re};return v.type==="array"?J(E[v.value]||bn,v.length):E[v.type]}(i):void 0),g=u.parse(o,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?Yo(new p(g,i)):Jo(u.errors)}class O{constructor(i,u){this.kind=i,this._styleExpression=u,this.isStateDependent=i!=="constant"&&!Ko(u.expression)}evaluateWithoutErrorHandling(i,u,g,v,E,A){return this._styleExpression.evaluateWithoutErrorHandling(i,u,g,v,E,A)}evaluate(i,u,g,v,E,A){return this._styleExpression.evaluate(i,u,g,v,E,A)}}class V{constructor(i,u,g,v){this.kind=i,this.zoomStops=g,this._styleExpression=u,this.isStateDependent=i!=="camera"&&!Ko(u.expression),this.interpolationType=v}evaluateWithoutErrorHandling(i,u,g,v,E,A){return this._styleExpression.evaluateWithoutErrorHandling(i,u,g,v,E,A)}evaluate(i,u,g,v,E,A){return this._styleExpression.evaluate(i,u,g,v,E,A)}interpolationFactor(i,u,g){return this.interpolationType?cr.interpolationFactor(this.interpolationType,i,u,g):0}}function K(o,i){const u=L(o,i);if(u.result==="error")return u;const g=u.value.expression,v=Wo(g);if(!v&&!Eo(i))return Jo([new xn("","data expressions not supported")]);const E=$o(g,["zoom"]);if(!E&&!Ol(i))return Jo([new xn("","zoom expressions not supported")]);const A=Be(g);return A||E?A instanceof xn?Jo([A]):A instanceof cr&&!Bl(i)?Jo([new xn("",'"interpolate" expressions cannot be used with this property')]):Yo(A?new V(v?"camera":"composite",u.value,A.labels,A instanceof cr?A.interpolation:void 0):new O(v?"constant":"source",u.value)):Jo([new xn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class pe{constructor(i,u){this._parameters=i,this._specification=u,yr(this,Ul(this._parameters,this._specification))}static deserialize(i){return new pe(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Be(o){let i=null;if(o instanceof ro)i=Be(o.result);else if(o instanceof Oa){for(const u of o.args)if(i=Be(u),i)break}else(o instanceof Fo||o instanceof cr)&&o.input instanceof rs&&o.input.name==="zoom"&&(i=o);return i instanceof xn||o.eachChild(u=>{const g=Be(u);g instanceof xn?i=g:!i&&g?i=new xn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&g&&i!==g&&(i=new xn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function $e(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const i of o.slice(1))if(!$e(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const mt={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ft(o){if(o==null)return{filter:()=>!0,needGeometry:!1};$e(o)||(o=vn(o));const i=L(o,mt);if(i.result==="error")throw new Error(i.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,g,v)=>i.value.evaluate(u,g,{},v),needGeometry:gn(o)}}function Nt(o,i){return o<i?-1:o>i?1:0}function gn(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let i=1;i<o.length;i++)if(gn(o[i]))return!0;return!1}function vn(o){if(!o)return!0;const i=o[0];return o.length<=1?i!=="any":i==="=="?Ln(o[1],o[2],"=="):i==="!="?ui(Ln(o[1],o[2],"==")):i==="<"||i===">"||i==="<="||i===">="?Ln(o[1],o[2],i):i==="any"?(u=o.slice(1),["any"].concat(u.map(vn))):i==="all"?["all"].concat(o.slice(1).map(vn)):i==="none"?["all"].concat(o.slice(1).map(vn).map(ui)):i==="in"?ni(o[1],o.slice(2)):i==="!in"?ui(ni(o[1],o.slice(2))):i==="has"?gi(o[1]):i!=="!has"||ui(gi(o[1]));var u}function Ln(o,i,u){switch(o){case"$type":return[`filter-type-${u}`,i];case"$id":return[`filter-id-${u}`,i];default:return[`filter-${u}`,o,i]}}function ni(o,i){if(i.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(u=>typeof u!=typeof i[0])?["filter-in-large",o,["literal",i.sort(Nt)]]:["filter-in-small",o,["literal",i]]}}function gi(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function ui(o){return["!",o]}function er(o){const i=typeof o;if(i==="number"||i==="boolean"||i==="string"||o==null)return JSON.stringify(o);if(Array.isArray(o)){let v="[";for(const E of o)v+=`${er(E)},`;return`${v}]`}const u=Object.keys(o).sort();let g="{";for(let v=0;v<u.length;v++)g+=`${JSON.stringify(u[v])}:${er(o[u[v]])},`;return`${g}}`}function ss(o){let i="";for(const u of On)i+=`/${er(o[u])}`;return i}function Rs(o){const i=o.value;return i?[new ct(o.key,i,"constants have been deprecated as of v8")]:[]}function di(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Rr(o){if(Array.isArray(o))return o.map(Rr);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const i={};for(const u in o)i[u]=Rr(o[u]);return i}return di(o)}function dr(o){const i=o.key,u=o.value,g=o.valueSpec||{},v=o.objectElementValidators||{},E=o.style,A=o.styleSpec,M=o.validateSpec;let P=[];const F=Yn(u);if(F!=="object")return[new ct(i,u,`object expected, ${F} found`)];for(const j in u){const G=j.split(".")[0],W=g[G]||g["*"];let te;if(v[G])te=v[G];else if(g[G])te=M;else if(v["*"])te=v["*"];else{if(!g["*"]){P.push(new ct(i,u[j],`unknown property "${j}"`));continue}te=M}P=P.concat(te({key:(i&&`${i}.`)+j,value:u[j],valueSpec:W,style:E,styleSpec:A,object:u,objectKey:j,validateSpec:M},u))}for(const j in g)v[j]||g[j].required&&g[j].default===void 0&&u[j]===void 0&&P.push(new ct(i,u,`missing required property "${j}"`));return P}function Ps(o){const i=o.value,u=o.valueSpec,g=o.style,v=o.styleSpec,E=o.key,A=o.arrayElementValidator||o.validateSpec;if(Yn(i)!=="array")return[new ct(E,i,`array expected, ${Yn(i)} found`)];if(u.length&&i.length!==u.length)return[new ct(E,i,`array length ${u.length} expected, length ${i.length} found`)];if(u["min-length"]&&i.length<u["min-length"])return[new ct(E,i,`array length at least ${u["min-length"]} expected, length ${i.length} found`)];let M={type:u.value,values:u.values};v.$version<7&&(M.function=u.function),Yn(u.value)==="object"&&(M=u.value);let P=[];for(let F=0;F<i.length;F++)P=P.concat(A({array:i,arrayIndex:F,value:i[F],valueSpec:M,validateSpec:o.validateSpec,style:g,styleSpec:v,key:`${E}[${F}]`}));return P}function Wa(o){const i=o.key,u=o.value,g=o.valueSpec;let v=Yn(u);return v==="number"&&u!=u&&(v="NaN"),v!=="number"?[new ct(i,u,`number expected, ${v} found`)]:"minimum"in g&&u<g.minimum?[new ct(i,u,`${u} is less than the minimum value ${g.minimum}`)]:"maximum"in g&&u>g.maximum?[new ct(i,u,`${u} is greater than the maximum value ${g.maximum}`)]:[]}function xa(o){const i=o.valueSpec,u=di(o.value.type);let g,v,E,A={};const M=u!=="categorical"&&o.value.property===void 0,P=!M,F=Yn(o.value.stops)==="array"&&Yn(o.value.stops[0])==="array"&&Yn(o.value.stops[0][0])==="object",j=dr({key:o.key,value:o.value,valueSpec:o.styleSpec.function,validateSpec:o.validateSpec,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(te){if(u==="identity")return[new ct(te.key,te.value,'identity function may not have a "stops" property')];let re=[];const de=te.value;return re=re.concat(Ps({key:te.key,value:de,valueSpec:te.valueSpec,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec,arrayElementValidator:G})),Yn(de)==="array"&&de.length===0&&re.push(new ct(te.key,de,"array must have at least one stop")),re},default:function(te){return te.validateSpec({key:te.key,value:te.value,valueSpec:i,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec})}}});return u==="identity"&&M&&j.push(new ct(o.key,o.value,'missing required property "property"')),u==="identity"||o.value.stops||j.push(new ct(o.key,o.value,'missing required property "stops"')),u==="exponential"&&o.valueSpec.expression&&!Bl(o.valueSpec)&&j.push(new ct(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(P&&!Eo(o.valueSpec)?j.push(new ct(o.key,o.value,"property functions not supported")):M&&!Ol(o.valueSpec)&&j.push(new ct(o.key,o.value,"zoom functions not supported"))),u!=="categorical"&&!F||o.value.property!==void 0||j.push(new ct(o.key,o.value,'"property" property is required')),j;function G(te){let re=[];const de=te.value,Ce=te.key;if(Yn(de)!=="array")return[new ct(Ce,de,`array expected, ${Yn(de)} found`)];if(de.length!==2)return[new ct(Ce,de,`array length 2 expected, length ${de.length} found`)];if(F){if(Yn(de[0])!=="object")return[new ct(Ce,de,`object expected, ${Yn(de[0])} found`)];if(de[0].zoom===void 0)return[new ct(Ce,de,"object stop key must have zoom")];if(de[0].value===void 0)return[new ct(Ce,de,"object stop key must have value")];if(E&&E>di(de[0].zoom))return[new ct(Ce,de[0].zoom,"stop zoom values must appear in ascending order")];di(de[0].zoom)!==E&&(E=di(de[0].zoom),v=void 0,A={}),re=re.concat(dr({key:`${Ce}[0]`,value:de[0],valueSpec:{zoom:{}},validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec,objectElementValidators:{zoom:Wa,value:W}}))}else re=re.concat(W({key:`${Ce}[0]`,value:de[0],valueSpec:{},validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec},de));return b(Rr(de[1]))?re.concat([new ct(`${Ce}[1]`,de[1],"expressions are not allowed in function stops.")]):re.concat(te.validateSpec({key:`${Ce}[1]`,value:de[1],valueSpec:i,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec}))}function W(te,re){const de=Yn(te.value),Ce=di(te.value),De=te.value!==null?te.value:re;if(g){if(de!==g)return[new ct(te.key,De,`${de} stop domain type must match previous stop domain type ${g}`)]}else g=de;if(de!=="number"&&de!=="string"&&de!=="boolean")return[new ct(te.key,De,"stop domain value must be a number, string, or boolean")];if(de!=="number"&&u!=="categorical"){let nt=`number expected, ${de} found`;return Eo(i)&&u===void 0&&(nt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ct(te.key,De,nt)]}return u!=="categorical"||de!=="number"||isFinite(Ce)&&Math.floor(Ce)===Ce?u!=="categorical"&&de==="number"&&v!==void 0&&Ce<v?[new ct(te.key,De,"stop domain values must appear in ascending order")]:(v=Ce,u==="categorical"&&Ce in A?[new ct(te.key,De,"stop domain values must be unique")]:(A[Ce]=!0,[])):[new ct(te.key,De,`integer expected, found ${Ce}`)]}}function lo(o){const i=(o.expressionContext==="property"?K:L)(Rr(o.value),o.valueSpec);if(i.result==="error")return i.value.map(g=>new ct(`${o.key}${g.key}`,o.value,g.message));const u=i.value.expression||i.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!u.outputDefined())return[new ct(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!Ko(u))return[new ct(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!Ko(u))return[new ct(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!$o(u,["zoom","feature-state"]))return[new ct(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!Wo(u))return[new ct(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ks(o){const i=o.key,u=o.value,g=o.valueSpec,v=[];return Array.isArray(g.values)?g.values.indexOf(di(u))===-1&&v.push(new ct(i,u,`expected one of [${g.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(g.values).indexOf(di(u))===-1&&v.push(new ct(i,u,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(u)} found`)),v}function Ec(o){return $e(Rr(o.value))?lo(yr({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):gu(o)}function gu(o){const i=o.value,u=o.key;if(Yn(i)!=="array")return[new ct(u,i,`array expected, ${Yn(i)} found`)];const g=o.styleSpec;let v,E=[];if(i.length<1)return[new ct(u,i,"filter array must have at least 1 element")];switch(E=E.concat(ks({key:`${u}[0]`,value:i[0],valueSpec:g.filter_operator,style:o.style,styleSpec:o.styleSpec})),di(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&di(i[1])==="$type"&&E.push(new ct(u,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&E.push(new ct(u,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(v=Yn(i[1]),v!=="string"&&E.push(new ct(`${u}[1]`,i[1],`string expected, ${v} found`)));for(let A=2;A<i.length;A++)v=Yn(i[A]),di(i[1])==="$type"?E=E.concat(ks({key:`${u}[${A}]`,value:i[A],valueSpec:g.geometry_type,style:o.style,styleSpec:o.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&E.push(new ct(`${u}[${A}]`,i[A],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let A=1;A<i.length;A++)E=E.concat(gu({key:`${u}[${A}]`,value:i[A],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":v=Yn(i[1]),i.length!==2?E.push(new ct(u,i,`filter array for "${i[0]}" operator must have 2 elements`)):v!=="string"&&E.push(new ct(`${u}[1]`,i[1],`string expected, ${v} found`))}return E}function Ac(o,i){const u=o.key,g=o.validateSpec,v=o.style,E=o.styleSpec,A=o.value,M=o.objectKey,P=E[`${i}_${o.layerType}`];if(!P)return[];const F=M.match(/^(.*)-transition$/);if(i==="paint"&&F&&P[F[1]]&&P[F[1]].transition)return g({key:u,value:A,valueSpec:E.transition,style:v,styleSpec:E});const j=o.valueSpec||P[M];if(!j)return[new ct(u,A,`unknown property "${M}"`)];let G;if(Yn(A)==="string"&&Eo(j)&&!j.tokens&&(G=/^{([^}]+)}$/.exec(A)))return[new ct(u,A,`"${M}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(G[1])} }\`.`)];const W=[];return o.layerType==="symbol"&&(M==="text-field"&&v&&!v.glyphs&&W.push(new ct(u,A,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&Gs(Rr(A))&&di(A.type)==="identity"&&W.push(new ct(u,A,'"text-font" does not support identity functions'))),W.concat(g({key:o.key,value:A,valueSpec:j,style:v,styleSpec:E,expressionContext:"property",propertyType:i,propertyKey:M}))}function _u(o){return Ac(o,"paint")}function Tc(o){return Ac(o,"layout")}function Cc(o){let i=[];const u=o.value,g=o.key,v=o.style,E=o.styleSpec;u.type||u.ref||i.push(new ct(g,u,'either "type" or "ref" is required'));let A=di(u.type);const M=di(u.ref);if(u.id){const P=di(u.id);for(let F=0;F<o.arrayIndex;F++){const j=v.layers[F];di(j.id)===P&&i.push(new ct(g,u.id,`duplicate layer id "${u.id}", previously used at line ${j.id.__line__}`))}}if("ref"in u){let P;["type","source","source-layer","filter","layout"].forEach(F=>{F in u&&i.push(new ct(g,u[F],`"${F}" is prohibited for ref layers`))}),v.layers.forEach(F=>{di(F.id)===M&&(P=F)}),P?P.ref?i.push(new ct(g,u.ref,"ref cannot reference another ref layer")):A=di(P.type):i.push(new ct(g,u.ref,`ref layer "${M}" not found`))}else if(A!=="background")if(u.source){const P=v.sources&&v.sources[u.source],F=P&&di(P.type);P?F==="vector"&&A==="raster"?i.push(new ct(g,u.source,`layer "${u.id}" requires a raster source`)):F!=="raster-dem"&&A==="hillshade"?i.push(new ct(g,u.source,`layer "${u.id}" requires a raster-dem source`)):F==="raster"&&A!=="raster"?i.push(new ct(g,u.source,`layer "${u.id}" requires a vector source`)):F!=="vector"||u["source-layer"]?F==="raster-dem"&&A!=="hillshade"?i.push(new ct(g,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):A!=="line"||!u.paint||!u.paint["line-gradient"]||F==="geojson"&&P.lineMetrics||i.push(new ct(g,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new ct(g,u,`layer "${u.id}" must specify a "source-layer"`)):i.push(new ct(g,u.source,`source "${u.source}" not found`))}else i.push(new ct(g,u,'missing required property "source"'));return i=i.concat(dr({key:g,value:u,valueSpec:E.layer,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,objectElementValidators:{"*":()=>[],type:()=>o.validateSpec({key:`${g}.type`,value:u.type,valueSpec:E.layer.type,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,object:u,objectKey:"type"}),filter:Ec,layout:P=>dr({layer:u,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":F=>Tc(yr({layerType:A},F))}}),paint:P=>dr({layer:u,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":F=>_u(yr({layerType:A},F))}})}})),i}function wa(o){const i=o.value,u=o.key,g=Yn(i);return g!=="string"?[new ct(u,i,`string expected, ${g} found`)]:[]}const yu={promoteId:function({key:o,value:i}){if(Yn(i)==="string")return wa({key:o,value:i});{const u=[];for(const g in i)u.push(...wa({key:`${o}.${g}`,value:i[g]}));return u}}};function jl(o){const i=o.value,u=o.key,g=o.styleSpec,v=o.style,E=o.validateSpec;if(!i.type)return[new ct(u,i,'"type" is required')];const A=di(i.type);let M;switch(A){case"vector":case"raster":return M=dr({key:u,value:i,valueSpec:g[`source_${A.replace("-","_")}`],style:o.style,styleSpec:g,objectElementValidators:yu,validateSpec:E}),M;case"raster-dem":return M=function(P){var F;const j=(F=P.sourceName)!==null&&F!==void 0?F:"",G=P.value,W=P.styleSpec,te=W.source_raster_dem,re=P.style;let de=[];const Ce=Yn(G);if(G===void 0)return de;if(Ce!=="object")return de.push(new ct("source_raster_dem",G,`object expected, ${Ce} found`)),de;const De=di(G.encoding)==="custom",nt=["redFactor","greenFactor","blueFactor","baseShift"],Ge=P.value.encoding?`"${P.value.encoding}"`:"Default";for(const Qe in G)!De&&nt.includes(Qe)?de.push(new ct(Qe,G[Qe],`In "${j}": "${Qe}" is only valid when "encoding" is set to "custom". ${Ge} encoding found`)):te[Qe]?de=de.concat(P.validateSpec({key:Qe,value:G[Qe],valueSpec:te[Qe],validateSpec:P.validateSpec,style:re,styleSpec:W})):de.push(new ct(Qe,G[Qe],`unknown property "${Qe}"`));return de}({sourceName:u,value:i,style:o.style,styleSpec:g,validateSpec:E}),M;case"geojson":if(M=dr({key:u,value:i,valueSpec:g.source_geojson,style:v,styleSpec:g,validateSpec:E,objectElementValidators:yu}),i.cluster)for(const P in i.clusterProperties){const[F,j]=i.clusterProperties[P],G=typeof F=="string"?[F,["accumulated"],["get",P]]:F;M.push(...lo({key:`${u}.${P}.map`,value:j,validateSpec:E,expressionContext:"cluster-map"})),M.push(...lo({key:`${u}.${P}.reduce`,value:G,validateSpec:E,expressionContext:"cluster-reduce"}))}return M;case"video":return dr({key:u,value:i,valueSpec:g.source_video,style:v,validateSpec:E,styleSpec:g});case"image":return dr({key:u,value:i,valueSpec:g.source_image,style:v,validateSpec:E,styleSpec:g});case"canvas":return[new ct(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ks({key:`${u}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,validateSpec:E,styleSpec:g})}}function Lc(o){const i=o.value,u=o.styleSpec,g=u.light,v=o.style;let E=[];const A=Yn(i);if(i===void 0)return E;if(A!=="object")return E=E.concat([new ct("light",i,`object expected, ${A} found`)]),E;for(const M in i){const P=M.match(/^(.*)-transition$/);E=E.concat(P&&g[P[1]]&&g[P[1]].transition?o.validateSpec({key:M,value:i[M],valueSpec:u.transition,validateSpec:o.validateSpec,style:v,styleSpec:u}):g[M]?o.validateSpec({key:M,value:i[M],valueSpec:g[M],validateSpec:o.validateSpec,style:v,styleSpec:u}):[new ct(M,i[M],`unknown property "${M}"`)])}return E}function Mc(o){const i=o.value,u=o.styleSpec,g=u.sky,v=o.style,E=Yn(i);if(i===void 0)return[];if(E!=="object")return[new ct("sky",i,`object expected, ${E} found`)];let A=[];for(const M in i)A=A.concat(g[M]?o.validateSpec({key:M,value:i[M],valueSpec:g[M],style:v,styleSpec:u}):[new ct(M,i[M],`unknown property "${M}"`)]);return A}function Rc(o){const i=o.value,u=o.styleSpec,g=u.terrain,v=o.style;let E=[];const A=Yn(i);if(i===void 0)return E;if(A!=="object")return E=E.concat([new ct("terrain",i,`object expected, ${A} found`)]),E;for(const M in i)E=E.concat(g[M]?o.validateSpec({key:M,value:i[M],valueSpec:g[M],validateSpec:o.validateSpec,style:v,styleSpec:u}):[new ct(M,i[M],`unknown property "${M}"`)]);return E}function Pc(o){let i=[];const u=o.value,g=o.key;if(Array.isArray(u)){const v=[],E=[];for(const A in u)u[A].id&&v.includes(u[A].id)&&i.push(new ct(g,u,`all the sprites' ids must be unique, but ${u[A].id} is duplicated`)),v.push(u[A].id),u[A].url&&E.includes(u[A].url)&&i.push(new ct(g,u,`all the sprites' URLs must be unique, but ${u[A].url} is duplicated`)),E.push(u[A].url),i=i.concat(dr({key:`${g}[${A}]`,value:u[A],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:o.validateSpec}));return i}return wa({key:g,value:u})}const vu={"*":()=>[],array:Ps,boolean:function(o){const i=o.value,u=o.key,g=Yn(i);return g!=="boolean"?[new ct(u,i,`boolean expected, ${g} found`)]:[]},number:Wa,color:function(o){const i=o.key,u=o.value,g=Yn(u);return g!=="string"?[new ct(i,u,`color expected, ${g} found`)]:ei.parse(String(u))?[]:[new ct(i,u,`color expected, "${u}" found`)]},constants:Rs,enum:ks,filter:Ec,function:xa,layer:Cc,object:dr,source:jl,light:Lc,sky:Mc,terrain:Rc,projection:function(o){const i=o.value,u=o.styleSpec,g=u.projection,v=o.style,E=Yn(i);if(i===void 0)return[];if(E!=="object")return[new ct("projection",i,`object expected, ${E} found`)];let A=[];for(const M in i)A=A.concat(g[M]?o.validateSpec({key:M,value:i[M],valueSpec:g[M],style:v,styleSpec:u}):[new ct(M,i[M],`unknown property "${M}"`)]);return A},string:wa,formatted:function(o){return wa(o).length===0?[]:lo(o)},resolvedImage:function(o){return wa(o).length===0?[]:lo(o)},padding:function(o){const i=o.key,u=o.value;if(Yn(u)==="array"){if(u.length<1||u.length>4)return[new ct(i,u,`padding requires 1 to 4 values; ${u.length} values found`)];const g={type:"number"};let v=[];for(let E=0;E<u.length;E++)v=v.concat(o.validateSpec({key:`${i}[${E}]`,value:u[E],validateSpec:o.validateSpec,valueSpec:g}));return v}return Wa({key:i,value:u,valueSpec:{}})},variableAnchorOffsetCollection:function(o){const i=o.key,u=o.value,g=Yn(u),v=o.styleSpec;if(g!=="array"||u.length<1||u.length%2!=0)return[new ct(i,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let E=[];for(let A=0;A<u.length;A+=2)E=E.concat(ks({key:`${i}[${A}]`,value:u[A],valueSpec:v.layout_symbol["text-anchor"]})),E=E.concat(Ps({key:`${i}[${A+1}]`,value:u[A+1],valueSpec:{length:2,value:"number"},validateSpec:o.validateSpec,style:o.style,styleSpec:v}));return E},sprite:Pc};function Ka(o){const i=o.value,u=o.valueSpec,g=o.styleSpec;return o.validateSpec=Ka,u.expression&&Gs(di(i))?xa(o):u.expression&&b(Rr(i))?lo(o):u.type&&vu[u.type]?vu[u.type](o):dr(yr({},o,{valueSpec:u.type?g[u.type]:u}))}function Bh(o){const i=o.value,u=o.key,g=wa(o);return g.length||(i.indexOf("{fontstack}")===-1&&g.push(new ct(u,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&g.push(new ct(u,i,'"glyphs" url must include a "{range}" token'))),g}function Ds(o,i=Ke){let u=[];return u=u.concat(Ka({key:"",value:o,valueSpec:i.$root,styleSpec:i,style:o,validateSpec:Ka,objectElementValidators:{glyphs:Bh,"*":()=>[]}})),o.constants&&(u=u.concat(Rs({key:"constants",value:o.constants,style:o,styleSpec:i,validateSpec:Ka}))),Dc(u)}function uo(o){return function(i){return o({...i,validateSpec:Ka})}}function Dc(o){return[].concat(o).sort((i,u)=>i.line-u.line)}function Zs(o){return function(...i){return Dc(o.apply(this,i))}}Ds.source=Zs(uo(jl)),Ds.sprite=Zs(uo(Pc)),Ds.glyphs=Zs(uo(Bh)),Ds.light=Zs(uo(Lc)),Ds.sky=Zs(uo(Mc)),Ds.terrain=Zs(uo(Rc)),Ds.layer=Zs(uo(Cc)),Ds.filter=Zs(uo(Ec)),Ds.paintProperty=Zs(uo(_u)),Ds.layoutProperty=Zs(uo(Tc));const ka=Ds,sd=ka.light,od=ka.sky,Uh=ka.paintProperty,jh=ka.layoutProperty;function Nc(o,i){let u=!1;if(i&&i.length)for(const g of i)o.fire(new Ye(new Error(g.message))),u=!0;return u}class $a{constructor(i,u,g){const v=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const A=new Int32Array(this.arrayBuffer);i=A[0],this.d=(u=A[1])+2*(g=A[2]);for(let P=0;P<this.d*this.d;P++){const F=A[3+P],j=A[3+P+1];v.push(F===j?null:A.subarray(F,j))}const M=A[3+v.length+1];this.keys=A.subarray(A[3+v.length],M),this.bboxes=A.subarray(M),this.insert=this._insertReadonly}else{this.d=u+2*g;for(let A=0;A<this.d*this.d;A++)v.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=i,this.padding=g,this.scale=u/i,this.uid=0;const E=g/u*i;this.min=-E,this.max=i+E}insert(i,u,g,v,E){this._forEachCell(u,g,v,E,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(E)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,u,g,v,E,A){this.cells[E].push(A)}query(i,u,g,v,E){const A=this.min,M=this.max;if(i<=A&&u<=A&&M<=g&&M<=v&&!E)return Array.prototype.slice.call(this.keys);{const P=[];return this._forEachCell(i,u,g,v,this._queryCell,P,{},E),P}}_queryCell(i,u,g,v,E,A,M,P){const F=this.cells[E];if(F!==null){const j=this.keys,G=this.bboxes;for(let W=0;W<F.length;W++){const te=F[W];if(M[te]===void 0){const re=4*te;(P?P(G[re+0],G[re+1],G[re+2],G[re+3]):i<=G[re+2]&&u<=G[re+3]&&g>=G[re+0]&&v>=G[re+1])?(M[te]=!0,A.push(j[te])):M[te]=!1}}}}_forEachCell(i,u,g,v,E,A,M,P){const F=this._convertToCellCoord(i),j=this._convertToCellCoord(u),G=this._convertToCellCoord(g),W=this._convertToCellCoord(v);for(let te=F;te<=G;te++)for(let re=j;re<=W;re++){const de=this.d*re+te;if((!P||P(this._convertFromCellCoord(te),this._convertFromCellCoord(re),this._convertFromCellCoord(te+1),this._convertFromCellCoord(re+1)))&&E.call(this,i,u,g,v,de,A,M,P))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,u=3+this.cells.length+1+1;let g=0;for(let A=0;A<this.cells.length;A++)g+=this.cells[A].length;const v=new Int32Array(u+g+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;let E=u;for(let A=0;A<i.length;A++){const M=i[A];v[3+A]=E,v.set(M,E),E+=M.length}return v[3+i.length]=E,v.set(this.keys,E),E+=this.keys.length,v[3+i.length+1]=E,v.set(this.bboxes,E),E+=this.bboxes.length,v.buffer}static serialize(i,u){const g=i.toArrayBuffer();return u&&u.push(g),{buffer:g}}static deserialize(i){return new $a(i.buffer)}}const Ns={};function Qt(o,i,u={}){if(Ns[o])throw new Error(`${o} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:o,writeable:!1}),Ns[o]={klass:i,omit:u.omit||[],shallow:u.shallow||[]}}Qt("Object",Object),Qt("TransferableGridIndex",$a),Qt("Color",ei),Qt("Error",Error),Qt("AJAXError",Pn),Qt("ResolvedImage",or),Qt("StylePropertyFunction",pe),Qt("StyleExpression",p,{omit:["_evaluator"]}),Qt("ZoomDependentExpression",V),Qt("ZoomConstantExpression",O),Qt("CompoundExpression",rs,{omit:["_evaluate"]});for(const o in Ho)Ho[o]._classRegistryKey||Qt(`Expression_${o}`,Ho[o]);function bu(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function zc(o){return o.$name||o.constructor._classRegistryKey}function qh(o){return!function(i){if(i===null||typeof i!="object")return!1;const u=zc(i);return!(!u||u==="Object")}(o)&&(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob||o instanceof Error||bu(o)||dt(o)||ArrayBuffer.isView(o)||o instanceof ImageData)}function Ya(o,i){if(qh(o))return(bu(o)||dt(o))&&i&&i.push(o),ArrayBuffer.isView(o)&&i&&i.push(o.buffer),o instanceof ImageData&&i&&i.push(o.data.buffer),o;if(Array.isArray(o)){const E=[];for(const A of o)E.push(Ya(A,i));return E}if(typeof o!="object")throw new Error("can't serialize object of type "+typeof o);const u=zc(o);if(!u)throw new Error(`can't serialize object of unregistered class ${o.constructor.name}`);if(!Ns[u])throw new Error(`${u} is not registered.`);const{klass:g}=Ns[u],v=g.serialize?g.serialize(o,i):{};if(g.serialize){if(i&&v===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const E in o){if(!o.hasOwnProperty(E)||Ns[u].omit.indexOf(E)>=0)continue;const A=o[E];v[E]=Ns[u].shallow.indexOf(E)>=0?A:Ya(A,i)}o instanceof Error&&(v.message=o.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(v.$name=u),v}function Ja(o){if(qh(o))return o;if(Array.isArray(o))return o.map(Ja);if(typeof o!="object")throw new Error("can't deserialize object of type "+typeof o);const i=zc(o)||"Object";if(!Ns[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:u}=Ns[i];if(!u)throw new Error(`can't deserialize unregistered class ${i}`);if(u.deserialize)return u.deserialize(o);const g=Object.create(u.prototype);for(const v of Object.keys(o)){if(v==="$name")continue;const E=o[v];g[v]=Ns[i].shallow.indexOf(v)>=0?E:Ja(E)}return g}class Fc{constructor(){this.first=!0}update(i,u){const g=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=g,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=g,!0):(this.lastFloorZoom>g?(this.lastIntegerZoom=g+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<g&&(this.lastIntegerZoom=g,this.lastIntegerZoomTime=u),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=g,!0))}}const Zn={"Latin-1 Supplement":o=>o>=128&&o<=255,"Hangul Jamo":o=>o>=4352&&o<=4607,Khmer:o=>o>=6016&&o<=6143,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Katakana:o=>o>=12448&&o<=12543,Kanbun:o=>o>=12688&&o<=12703,"CJK Strokes":o=>o>=12736&&o<=12783,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"Private Use Area":o=>o>=57344&&o<=63743,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function Oc(o){for(const i of o)if(Uc(i.charCodeAt(0)))return!0;return!1}function ad(o){for(const i of o)if(!Qa(i.charCodeAt(0)))return!1;return!0}function Bc(o){const i=o.map(u=>{try{return new RegExp(`\\p{sc=${u}}`,"u").source}catch{return null}}).filter(u=>u);return new RegExp(i.join("|"),"u")}const ld=Bc(["Arab","Dupl","Mong","Ougr","Syrc"]);function Qa(o){return!ld.test(String.fromCodePoint(o))}const Vh=Bc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Uc(o){return!(o!==746&&o!==747&&(o<4352||!(Zn["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||Zn["CJK Compatibility"](o)||Zn["CJK Strokes"](o)||!(!Zn["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||Zn["Enclosed CJK Letters and Months"](o)||Zn["Ideographic Description Characters"](o)||Zn.Kanbun(o)||Zn.Katakana(o)&&o!==12540||!(!Zn["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!Zn["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||Zn["Vertical Forms"](o)||Zn["Yijing Hexagram Symbols"](o)||/\p{sc=Cans}/u.test(String.fromCodePoint(o))||/\p{sc=Hang}/u.test(String.fromCodePoint(o))||Vh.test(String.fromCodePoint(o)))))}function Gh(o){return!(Uc(o)||function(i){return!!(Zn["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||Zn["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||Zn["Letterlike Symbols"](i)||Zn["Number Forms"](i)||Zn["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||Zn["Control Pictures"](i)&&i!==9251||Zn["Optical Character Recognition"](i)||Zn["Enclosed Alphanumerics"](i)||Zn["Geometric Shapes"](i)||Zn["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||Zn["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Zn["CJK Symbols and Punctuation"](i)||Zn.Katakana(i)||Zn["Private Use Area"](i)||Zn["CJK Compatibility Forms"](i)||Zn["Small Form Variants"](i)||Zn["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(o))}const ud=Bc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function jc(o){return ud.test(String.fromCodePoint(o))}function cd(o,i){return!(!i&&jc(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||Zn.Khmer(o))}function hd(o){for(const i of o)if(jc(i.charCodeAt(0)))return!0;return!1}const Is=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(o){this.pluginStatus=o.pluginStatus,this.pluginURL=o.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(o){this.applyArabicShaping=o.applyArabicShaping,this.processBidirectionalText=o.processBidirectionalText,this.processStyledBidirectionalText=o.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ei{constructor(i,u){this.zoom=i,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Fc,this.transition={})}isSupportedScript(i){return function(u,g){for(const v of u)if(!cd(v.charCodeAt(0),g))return!1;return!0}(i,Is.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,u=i-Math.floor(i),g=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*g}:{fromScale:.5,toScale:1,t:1-(1-g)*u}}}class el{constructor(i,u){this.property=i,this.value=u,this.expression=function(g,v){if(Gs(g))return new pe(g,v);if(b(g)){const E=K(g,v);if(E.result==="error")throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));return E.value}{let E=g;return v.type==="color"&&typeof g=="string"?E=ei.parse(g):v.type!=="padding"||typeof g!="number"&&!Array.isArray(g)?v.type==="variableAnchorOffsetCollection"&&Array.isArray(g)&&(E=Ni.parse(g)):E=Nr.parse(g),{kind:"constant",evaluate:()=>E}}}(u===void 0?i.specification.default:u,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,u,g){return this.property.possiblyEvaluate(this,i,u,g)}}class xu{constructor(i){this.property=i,this.value=new el(i,void 0)}transitioned(i,u){return new Zh(this.property,this.value,u,ce({},i.transition,this.transition),i.now)}untransitioned(){return new Zh(this.property,this.value,null,{},0)}}class wu{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return ke(this._values[i].value.value)}setValue(i,u){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new xu(this._values[i].property)),this._values[i].value=new el(this._values[i].property,u===null?void 0:ke(u))}getTransition(i){return ke(this._values[i].transition)}setTransition(i,u){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new xu(this._values[i].property)),this._values[i].transition=ke(u)||void 0}serialize(){const i={};for(const u of Object.keys(this._values)){const g=this.getValue(u);g!==void 0&&(i[u]=g);const v=this.getTransition(u);v!==void 0&&(i[`${u}-transition`]=v)}return i}transitioned(i,u){const g=new ql(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].transitioned(i,u._values[v]);return g}untransitioned(){const i=new ql(this._properties);for(const u of Object.keys(this._values))i._values[u]=this._values[u].untransitioned();return i}}class Zh{constructor(i,u,g,v,E){this.property=i,this.value=u,this.begin=E+v.delay||0,this.end=this.begin+v.duration||0,i.specification.transition&&(v.delay||v.duration)&&(this.prior=g)}possiblyEvaluate(i,u,g){const v=i.now||0,E=this.value.possiblyEvaluate(i,u,g),A=this.prior;if(A){if(v>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(v<this.begin)return A.possiblyEvaluate(i,u,g);{const M=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(A.possiblyEvaluate(i,u,g),E,function(P){if(P<=0)return 0;if(P>=1)return 1;const F=P*P,j=F*P;return 4*(P<.5?j:3*(P-F)+j-.75)}(M))}}return E}}class ql{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,u,g){const v=new Gl(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].possiblyEvaluate(i,u,g);return v}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Vl{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return ke(this._values[i].value)}setValue(i,u){this._values[i]=new el(this._values[i].property,u===null?void 0:ke(u))}serialize(){const i={};for(const u of Object.keys(this._values)){const g=this.getValue(u);g!==void 0&&(i[u]=g)}return i}possiblyEvaluate(i,u,g){const v=new Gl(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].possiblyEvaluate(i,u,g);return v}}class co{constructor(i,u,g){this.property=i,this.value=u,this.parameters=g}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,u,g,v){return this.property.evaluate(this.value,this.parameters,i,u,g,v)}}class Gl{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class nn{constructor(i){this.specification=i}possiblyEvaluate(i,u){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(u)}interpolate(i,u,g){const v=xi[this.specification.type];return v?v(i,u,g):i}}class yn{constructor(i,u){this.specification=i,this.overrides=u}possiblyEvaluate(i,u,g,v){return new co(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(u,null,{},g,v)}:i.expression,u)}interpolate(i,u,g){if(i.value.kind!=="constant"||u.value.kind!=="constant")return i;if(i.value.value===void 0||u.value.value===void 0)return new co(this,{kind:"constant",value:void 0},i.parameters);const v=xi[this.specification.type];if(v){const E=v(i.value.value,u.value.value,g);return new co(this,{kind:"constant",value:E},i.parameters)}return i}evaluate(i,u,g,v,E,A){return i.kind==="constant"?i.value:i.evaluate(u,g,v,E,A)}}class ku extends yn{possiblyEvaluate(i,u,g,v){if(i.value===void 0)return new co(this,{kind:"constant",value:void 0},u);if(i.expression.kind==="constant"){const E=i.expression.evaluate(u,null,{},g,v),A=i.property.specification.type==="resolvedImage"&&typeof E!="string"?E.name:E,M=this._calculate(A,A,A,u);return new co(this,{kind:"constant",value:M},u)}if(i.expression.kind==="camera"){const E=this._calculate(i.expression.evaluate({zoom:u.zoom-1}),i.expression.evaluate({zoom:u.zoom}),i.expression.evaluate({zoom:u.zoom+1}),u);return new co(this,{kind:"constant",value:E},u)}return new co(this,i.expression,u)}evaluate(i,u,g,v,E,A){if(i.kind==="source"){const M=i.evaluate(u,g,v,E,A);return this._calculate(M,M,M,u)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(u.zoom)-1},g,v),i.evaluate({zoom:Math.floor(u.zoom)},g,v),i.evaluate({zoom:Math.floor(u.zoom)+1},g,v),u):i.value}_calculate(i,u,g,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:i,to:u}:{from:g,to:u}}interpolate(i){return i}}class Iu{constructor(i){this.specification=i}possiblyEvaluate(i,u,g,v){if(i.value!==void 0){if(i.expression.kind==="constant"){const E=i.expression.evaluate(u,null,{},g,v);return this._calculate(E,E,E,u)}return this._calculate(i.expression.evaluate(new Ei(Math.floor(u.zoom-1),u)),i.expression.evaluate(new Ei(Math.floor(u.zoom),u)),i.expression.evaluate(new Ei(Math.floor(u.zoom+1),u)),u)}}_calculate(i,u,g,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:i,to:u}:{from:g,to:u}}interpolate(i){return i}}class qc{constructor(i){this.specification=i}possiblyEvaluate(i,u,g,v){return!!i.expression.evaluate(u,null,{},g,v)}interpolate(){return!1}}class k{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in i){const g=i[u];g.specification.overridable&&this.overridableProperties.push(u);const v=this.defaultPropertyValues[u]=new el(g,void 0),E=this.defaultTransitionablePropertyValues[u]=new xu(g);this.defaultTransitioningPropertyValues[u]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=v.possiblyEvaluate({})}}}Qt("DataDrivenProperty",yn),Qt("DataConstantProperty",nn),Qt("CrossFadedDataDrivenProperty",ku),Qt("CrossFadedProperty",Iu),Qt("ColorRampProperty",qc);const t="-transition";class f extends Lt{constructor(i,u){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),u.layout&&(this._unevaluatedLayout=new Vl(u.layout)),u.paint)){this._transitionablePaint=new wu(u.paint);for(const g in i.paint)this.setPaintProperty(g,i.paint[g],{validate:!1});for(const g in i.layout)this.setLayoutProperty(g,i.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Gl(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,u,g={}){u!=null&&this._validate(jh,`layers.${this.id}.layout.${i}`,i,u,g)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,u):this.visibility=u)}getPaintProperty(i){return i.endsWith(t)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,u,g={}){if(u!=null&&this._validate(Uh,`layers.${this.id}.paint.${i}`,i,u,g))return!1;if(i.endsWith(t))return this._transitionablePaint.setTransition(i.slice(0,-11),u||void 0),!1;{const v=this._transitionablePaint._values[i],E=v.property.specification["property-type"]==="cross-faded-data-driven",A=v.value.isDataDriven(),M=v.value;this._transitionablePaint.setValue(i,u),this._handleSpecialPaintPropertyUpdate(i);const P=this._transitionablePaint._values[i].value;return P.isDataDriven()||A||E||this._handleOverridablePaintPropertyUpdate(i,M,P)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,u,g){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,u){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,u)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Le(i,(u,g)=>!(u===void 0||g==="layout"&&!Object.keys(u).length||g==="paint"&&!Object.keys(u).length))}_validate(i,u,g,v,E={}){return(!E||E.validate!==!1)&&Nc(this,i.call(ka,{key:u,layerType:this.type,objectKey:g,value:v,styleSpec:Ke,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const u=this.paint.get(i);if(u instanceof co&&Eo(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const _={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class y{constructor(i,u){this._structArray=i,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class w{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,u){return i._trim(),u&&(i.isTransferred=!0,u.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const u=Object.create(this.prototype);return u.arrayBuffer=i.arrayBuffer,u.length=i.length,u.capacity=i.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function R(o,i=1){let u=0,g=0;return{members:o.map(v=>{const E=_[v.type].BYTES_PER_ELEMENT,A=u=D(u,Math.max(i,E)),M=v.components||1;return g=Math.max(g,E),u+=E*M,{name:v.name,type:v.type,components:M,offset:A}}),size:D(u,Math.max(g,i)),alignment:i}}function D(o,i){return Math.ceil(o/i)*i}class z extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u){const g=this.length;return this.resize(g+1),this.emplace(g,i,u)}emplace(i,u,g){const v=2*i;return this.int16[v+0]=u,this.int16[v+1]=g,i}}z.prototype.bytesPerElement=4,Qt("StructArrayLayout2i4",z);class q extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=3*i;return this.int16[E+0]=u,this.int16[E+1]=g,this.int16[E+2]=v,i}}q.prototype.bytesPerElement=6,Qt("StructArrayLayout3i6",q);class H extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v){const E=this.length;return this.resize(E+1),this.emplace(E,i,u,g,v)}emplace(i,u,g,v,E){const A=4*i;return this.int16[A+0]=u,this.int16[A+1]=g,this.int16[A+2]=v,this.int16[A+3]=E,i}}H.prototype.bytesPerElement=8,Qt("StructArrayLayout4i8",H);class X extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A){const M=this.length;return this.resize(M+1),this.emplace(M,i,u,g,v,E,A)}emplace(i,u,g,v,E,A,M){const P=6*i;return this.int16[P+0]=u,this.int16[P+1]=g,this.int16[P+2]=v,this.int16[P+3]=E,this.int16[P+4]=A,this.int16[P+5]=M,i}}X.prototype.bytesPerElement=12,Qt("StructArrayLayout2i4i12",X);class ne extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A){const M=this.length;return this.resize(M+1),this.emplace(M,i,u,g,v,E,A)}emplace(i,u,g,v,E,A,M){const P=4*i,F=8*i;return this.int16[P+0]=u,this.int16[P+1]=g,this.uint8[F+4]=v,this.uint8[F+5]=E,this.uint8[F+6]=A,this.uint8[F+7]=M,i}}ne.prototype.bytesPerElement=8,Qt("StructArrayLayout2i4ub8",ne);class me extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u){const g=this.length;return this.resize(g+1),this.emplace(g,i,u)}emplace(i,u,g){const v=2*i;return this.float32[v+0]=u,this.float32[v+1]=g,i}}me.prototype.bytesPerElement=8,Qt("StructArrayLayout2f8",me);class we extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A,M,P,F,j){const G=this.length;return this.resize(G+1),this.emplace(G,i,u,g,v,E,A,M,P,F,j)}emplace(i,u,g,v,E,A,M,P,F,j,G){const W=10*i;return this.uint16[W+0]=u,this.uint16[W+1]=g,this.uint16[W+2]=v,this.uint16[W+3]=E,this.uint16[W+4]=A,this.uint16[W+5]=M,this.uint16[W+6]=P,this.uint16[W+7]=F,this.uint16[W+8]=j,this.uint16[W+9]=G,i}}we.prototype.bytesPerElement=20,Qt("StructArrayLayout10ui20",we);class Me extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A,M,P,F,j,G,W){const te=this.length;return this.resize(te+1),this.emplace(te,i,u,g,v,E,A,M,P,F,j,G,W)}emplace(i,u,g,v,E,A,M,P,F,j,G,W,te){const re=12*i;return this.int16[re+0]=u,this.int16[re+1]=g,this.int16[re+2]=v,this.int16[re+3]=E,this.uint16[re+4]=A,this.uint16[re+5]=M,this.uint16[re+6]=P,this.uint16[re+7]=F,this.int16[re+8]=j,this.int16[re+9]=G,this.int16[re+10]=W,this.int16[re+11]=te,i}}Me.prototype.bytesPerElement=24,Qt("StructArrayLayout4i4ui4i24",Me);class Ne extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=3*i;return this.float32[E+0]=u,this.float32[E+1]=g,this.float32[E+2]=v,i}}Ne.prototype.bytesPerElement=12,Qt("StructArrayLayout3f12",Ne);class Fe extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.uint32[1*i+0]=u,i}}Fe.prototype.bytesPerElement=4,Qt("StructArrayLayout1ul4",Fe);class Ve extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A,M,P,F){const j=this.length;return this.resize(j+1),this.emplace(j,i,u,g,v,E,A,M,P,F)}emplace(i,u,g,v,E,A,M,P,F,j){const G=10*i,W=5*i;return this.int16[G+0]=u,this.int16[G+1]=g,this.int16[G+2]=v,this.int16[G+3]=E,this.int16[G+4]=A,this.int16[G+5]=M,this.uint32[W+3]=P,this.uint16[G+8]=F,this.uint16[G+9]=j,i}}Ve.prototype.bytesPerElement=20,Qt("StructArrayLayout6i1ul2ui20",Ve);class Te extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A){const M=this.length;return this.resize(M+1),this.emplace(M,i,u,g,v,E,A)}emplace(i,u,g,v,E,A,M){const P=6*i;return this.int16[P+0]=u,this.int16[P+1]=g,this.int16[P+2]=v,this.int16[P+3]=E,this.int16[P+4]=A,this.int16[P+5]=M,i}}Te.prototype.bytesPerElement=12,Qt("StructArrayLayout2i2i2i12",Te);class He extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E){const A=this.length;return this.resize(A+1),this.emplace(A,i,u,g,v,E)}emplace(i,u,g,v,E,A){const M=4*i,P=8*i;return this.float32[M+0]=u,this.float32[M+1]=g,this.float32[M+2]=v,this.int16[P+6]=E,this.int16[P+7]=A,i}}He.prototype.bytesPerElement=16,Qt("StructArrayLayout2f1f2i16",He);class Je extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A){const M=this.length;return this.resize(M+1),this.emplace(M,i,u,g,v,E,A)}emplace(i,u,g,v,E,A,M){const P=16*i,F=4*i,j=8*i;return this.uint8[P+0]=u,this.uint8[P+1]=g,this.float32[F+1]=v,this.float32[F+2]=E,this.int16[j+6]=A,this.int16[j+7]=M,i}}Je.prototype.bytesPerElement=16,Qt("StructArrayLayout2ub2f2i16",Je);class st extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=3*i;return this.uint16[E+0]=u,this.uint16[E+1]=g,this.uint16[E+2]=v,i}}st.prototype.bytesPerElement=6,Qt("StructArrayLayout3ui6",st);class xt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A,M,P,F,j,G,W,te,re,de,Ce,De){const nt=this.length;return this.resize(nt+1),this.emplace(nt,i,u,g,v,E,A,M,P,F,j,G,W,te,re,de,Ce,De)}emplace(i,u,g,v,E,A,M,P,F,j,G,W,te,re,de,Ce,De,nt){const Ge=24*i,Qe=12*i,ht=48*i;return this.int16[Ge+0]=u,this.int16[Ge+1]=g,this.uint16[Ge+2]=v,this.uint16[Ge+3]=E,this.uint32[Qe+2]=A,this.uint32[Qe+3]=M,this.uint32[Qe+4]=P,this.uint16[Ge+10]=F,this.uint16[Ge+11]=j,this.uint16[Ge+12]=G,this.float32[Qe+7]=W,this.float32[Qe+8]=te,this.uint8[ht+36]=re,this.uint8[ht+37]=de,this.uint8[ht+38]=Ce,this.uint32[Qe+10]=De,this.int16[Ge+22]=nt,i}}xt.prototype.bytesPerElement=48,Qt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",xt);class Pt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,A,M,P,F,j,G,W,te,re,de,Ce,De,nt,Ge,Qe,ht,Et,Wt,_n,Ht,Gt,on,tn){const Yt=this.length;return this.resize(Yt+1),this.emplace(Yt,i,u,g,v,E,A,M,P,F,j,G,W,te,re,de,Ce,De,nt,Ge,Qe,ht,Et,Wt,_n,Ht,Gt,on,tn)}emplace(i,u,g,v,E,A,M,P,F,j,G,W,te,re,de,Ce,De,nt,Ge,Qe,ht,Et,Wt,_n,Ht,Gt,on,tn,Yt){const yt=32*i,cn=16*i;return this.int16[yt+0]=u,this.int16[yt+1]=g,this.int16[yt+2]=v,this.int16[yt+3]=E,this.int16[yt+4]=A,this.int16[yt+5]=M,this.int16[yt+6]=P,this.int16[yt+7]=F,this.uint16[yt+8]=j,this.uint16[yt+9]=G,this.uint16[yt+10]=W,this.uint16[yt+11]=te,this.uint16[yt+12]=re,this.uint16[yt+13]=de,this.uint16[yt+14]=Ce,this.uint16[yt+15]=De,this.uint16[yt+16]=nt,this.uint16[yt+17]=Ge,this.uint16[yt+18]=Qe,this.uint16[yt+19]=ht,this.uint16[yt+20]=Et,this.uint16[yt+21]=Wt,this.uint16[yt+22]=_n,this.uint32[cn+12]=Ht,this.float32[cn+13]=Gt,this.float32[cn+14]=on,this.uint16[yt+30]=tn,this.uint16[yt+31]=Yt,i}}Pt.prototype.bytesPerElement=64,Qt("StructArrayLayout8i15ui1ul2f2ui64",Pt);class Zt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.float32[1*i+0]=u,i}}Zt.prototype.bytesPerElement=4,Qt("StructArrayLayout1f4",Zt);class Kt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=3*i;return this.uint16[6*i+0]=u,this.float32[E+1]=g,this.float32[E+2]=v,i}}Kt.prototype.bytesPerElement=12,Qt("StructArrayLayout1ui2f12",Kt);class qt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=4*i;return this.uint32[2*i+0]=u,this.uint16[E+2]=g,this.uint16[E+3]=v,i}}qt.prototype.bytesPerElement=8,Qt("StructArrayLayout1ul2ui8",qt);class jt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u){const g=this.length;return this.resize(g+1),this.emplace(g,i,u)}emplace(i,u,g){const v=2*i;return this.uint16[v+0]=u,this.uint16[v+1]=g,i}}jt.prototype.bytesPerElement=4,Qt("StructArrayLayout2ui4",jt);class rn extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.uint16[1*i+0]=u,i}}rn.prototype.bytesPerElement=2,Qt("StructArrayLayout1ui2",rn);class Sn extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g,v){const E=this.length;return this.resize(E+1),this.emplace(E,i,u,g,v)}emplace(i,u,g,v,E){const A=4*i;return this.float32[A+0]=u,this.float32[A+1]=g,this.float32[A+2]=v,this.float32[A+3]=E,i}}Sn.prototype.bytesPerElement=16,Qt("StructArrayLayout4f16",Sn);class Vt extends y{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new C(this.anchorPointX,this.anchorPointY)}}Vt.prototype.size=20;class Xt extends Ve{get(i){return new Vt(this,i)}}Qt("CollisionBoxArray",Xt);class wn extends y{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}wn.prototype.size=48;class Ai extends xt{get(i){return new wn(this,i)}}Qt("PlacedSymbolArray",Ai);class Bn extends y{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Bn.prototype.size=64;class qn extends Pt{get(i){return new Bn(this,i)}}Qt("SymbolInstanceArray",qn);class Ti extends Zt{getoffsetX(i){return this.float32[1*i+0]}}Qt("GlyphOffsetArray",Ti);class zr extends q{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Qt("SymbolLineVertexArray",zr);class Hs extends y{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Hs.prototype.size=12;class Ci extends Kt{get(i){return new Hs(this,i)}}Qt("TextAnchorOffsetArray",Ci);class os extends y{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}os.prototype.size=8;class Xr extends qt{get(i){return new os(this,i)}}Qt("FeatureIndexArray",Xr);class Fr extends z{}class Wr extends z{}class ho extends z{}class tl extends X{}class Su extends ne{}class nl extends me{}class zs extends we{}class Eu extends Me{}class Vc extends Ne{}class Fs extends Fe{}class Os extends Te{}class Qo extends Je{}class Xs extends st{}class Pr extends jt{}const Or=R([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ss}=Or;class Hn{constructor(i=[]){this.segments=i}prepareSegment(i,u,g,v){let E=this.segments[this.segments.length-1];return i>Hn.MAX_VERTEX_ARRAY_LENGTH&&Ue(`Max vertices per segment is ${Hn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!E||E.vertexLength+i>Hn.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==v)&&(E={vertexOffset:u.length,primitiveOffset:g.length,vertexLength:0,primitiveLength:0},v!==void 0&&(E.sortKey=v),this.segments.push(E)),E}get(){return this.segments}destroy(){for(const i of this.segments)for(const u in i.vaos)i.vaos[u].destroy()}static simpleSegment(i,u,g,v){return new Hn([{vertexOffset:i,primitiveOffset:u,vertexLength:g,primitiveLength:v,vaos:{},sortKey:0}])}}function Ia(o,i){return 256*(o=ve(Math.floor(o),0,255))+ve(Math.floor(i),0,255)}Hn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Qt("SegmentVector",Hn);const il=R([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var rl={exports:{}},Hh={exports:{}};Hh.exports=function(o,i){var u,g,v,E,A,M,P,F;for(g=o.length-(u=3&o.length),v=i,A=3432918353,M=461845907,F=0;F<g;)P=255&o.charCodeAt(F)|(255&o.charCodeAt(++F))<<8|(255&o.charCodeAt(++F))<<16|(255&o.charCodeAt(++F))<<24,++F,v=27492+(65535&(E=5*(65535&(v=(v^=P=(65535&(P=(P=(65535&P)*A+(((P>>>16)*A&65535)<<16)&4294967295)<<15|P>>>17))*M+(((P>>>16)*M&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(P=0,u){case 3:P^=(255&o.charCodeAt(F+2))<<16;case 2:P^=(255&o.charCodeAt(F+1))<<8;case 1:v^=P=(65535&(P=(P=(65535&(P^=255&o.charCodeAt(F)))*A+(((P>>>16)*A&65535)<<16)&4294967295)<<15|P>>>17))*M+(((P>>>16)*M&65535)<<16)&4294967295}return v^=o.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0};var fd=Hh.exports,Xh={exports:{}};Xh.exports=function(o,i){for(var u,g=o.length,v=i^g,E=0;g>=4;)u=1540483477*(65535&(u=255&o.charCodeAt(E)|(255&o.charCodeAt(++E))<<8|(255&o.charCodeAt(++E))<<16|(255&o.charCodeAt(++E))<<24))+((1540483477*(u>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),g-=4,++E;switch(g){case 3:v^=(255&o.charCodeAt(E+2))<<16;case 2:v^=(255&o.charCodeAt(E+1))<<8;case 1:v=1540483477*(65535&(v^=255&o.charCodeAt(E)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0};var ea=fd,Wh=Xh.exports;rl.exports=ea,rl.exports.murmur3=ea,rl.exports.murmur2=Wh;var Au=x(rl.exports);class Zl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,u,g,v){this.ids.push(Tu(i)),this.positions.push(u,g,v)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=Tu(i);let g=0,v=this.ids.length-1;for(;g<v;){const A=g+v>>1;this.ids[A]>=u?v=A:g=A+1}const E=[];for(;this.ids[g]===u;)E.push({index:this.positions[3*g],start:this.positions[3*g+1],end:this.positions[3*g+2]}),g++;return E}static serialize(i,u){const g=new Float64Array(i.ids),v=new Uint32Array(i.positions);return Cu(g,v,0,g.length-1),u&&u.push(g.buffer,v.buffer),{ids:g,positions:v}}static deserialize(i){const u=new Zl;return u.ids=i.ids,u.positions=i.positions,u.indexed=!0,u}}function Tu(o){const i=+o;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:Au(String(o))}function Cu(o,i,u,g){for(;u<g;){const v=o[u+g>>1];let E=u-1,A=g+1;for(;;){do E++;while(o[E]<v);do A--;while(o[A]>v);if(E>=A)break;sl(o,E,A),sl(i,3*E,3*A),sl(i,3*E+1,3*A+1),sl(i,3*E+2,3*A+2)}A-u<g-A?(Cu(o,i,u,A),u=A+1):(Cu(o,i,A+1,g),g=A)}}function sl(o,i,u){const g=o[i];o[i]=o[u],o[u]=g}Qt("FeaturePositionMap",Zl);class Hl{constructor(i,u){this.gl=i.gl,this.location=u}}class Kh extends Hl{constructor(i,u){super(i,u),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class rm extends Hl{constructor(i,u){super(i,u),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class sm extends Hl{constructor(i,u){super(i,u),this.current=ei.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const i1=new Float32Array(16);function dd(o){return[Ia(255*o.r,255*o.g),Ia(255*o.b,255*o.a)]}class Gc{constructor(i,u,g){this.value=i,this.uniformNames=u.map(v=>`u_${v}`),this.type=g}setUniform(i,u,g){i.set(g.constantOr(this.value))}getBinding(i,u,g){return this.type==="color"?new sm(i,u):new Kh(i,u)}}class Lu{constructor(i,u){this.uniformNames=u.map(g=>`u_${g}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=i.tlbr}setUniform(i,u,g,v){const E=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;E&&i.set(E)}getBinding(i,u,g){return g.substr(0,9)==="u_pattern"?new rm(i,u):new Kh(i,u)}}class Sa{constructor(i,u,g,v){this.expression=i,this.type=g,this.maxValue=0,this.paintVertexAttributes=u.map(E=>({name:`a_${E}`,type:"Float32",components:g==="color"?2:1,offset:0})),this.paintVertexArray=new v}populatePaintArray(i,u,g,v,E){const A=this.paintVertexArray.length,M=this.expression.evaluate(new Ei(0),u,{},v,[],E);this.paintVertexArray.resize(i),this._setPaintValue(A,i,M)}updatePaintArray(i,u,g,v){const E=this.expression.evaluate({zoom:0},g,v);this._setPaintValue(i,u,E)}_setPaintValue(i,u,g){if(this.type==="color"){const v=dd(g);for(let E=i;E<u;E++)this.paintVertexArray.emplace(E,v[0],v[1])}else{for(let v=i;v<u;v++)this.paintVertexArray.emplace(v,g);this.maxValue=Math.max(this.maxValue,Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ao{constructor(i,u,g,v,E,A){this.expression=i,this.uniformNames=u.map(M=>`u_${M}_t`),this.type=g,this.useIntegerZoom=v,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=u.map(M=>({name:`a_${M}`,type:"Float32",components:g==="color"?4:2,offset:0})),this.paintVertexArray=new A}populatePaintArray(i,u,g,v,E){const A=this.expression.evaluate(new Ei(this.zoom),u,{},v,[],E),M=this.expression.evaluate(new Ei(this.zoom+1),u,{},v,[],E),P=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(P,i,A,M)}updatePaintArray(i,u,g,v){const E=this.expression.evaluate({zoom:this.zoom},g,v),A=this.expression.evaluate({zoom:this.zoom+1},g,v);this._setPaintValue(i,u,E,A)}_setPaintValue(i,u,g,v){if(this.type==="color"){const E=dd(g),A=dd(v);for(let M=i;M<u;M++)this.paintVertexArray.emplace(M,E[0],E[1],A[0],A[1])}else{for(let E=i;E<u;E++)this.paintVertexArray.emplace(E,g,v);this.maxValue=Math.max(this.maxValue,Math.abs(g),Math.abs(v))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,u){const g=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,v=ve(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);i.set(v)}getBinding(i,u,g){return new Kh(i,u)}}class ol{constructor(i,u,g,v,E,A){this.expression=i,this.type=u,this.useIntegerZoom=g,this.zoom=v,this.layerId=A,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E}populatePaintArray(i,u,g){const v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(v,i,u.patterns&&u.patterns[this.layerId],g)}updatePaintArray(i,u,g,v,E){this._setPaintValues(i,u,g.patterns&&g.patterns[this.layerId],E)}_setPaintValues(i,u,g,v){if(!v||!g)return;const{min:E,mid:A,max:M}=g,P=v[E],F=v[A],j=v[M];if(P&&F&&j)for(let G=i;G<u;G++)this.zoomInPaintVertexArray.emplace(G,F.tl[0],F.tl[1],F.br[0],F.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],F.pixelRatio,P.pixelRatio),this.zoomOutPaintVertexArray.emplace(G,F.tl[0],F.tl[1],F.br[0],F.br[1],j.tl[0],j.tl[1],j.br[0],j.br[1],F.pixelRatio,j.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,il.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,il.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class om{constructor(i,u,g){this.binders={},this._buffers=[];const v=[];for(const E in i.paint._values){if(!g(E))continue;const A=i.paint.get(E);if(!(A instanceof co&&Eo(A.property.specification)))continue;const M=r1(E,i.type),P=A.value,F=A.property.specification.type,j=A.property.useIntegerZoom,G=A.property.specification["property-type"],W=G==="cross-faded"||G==="cross-faded-data-driven";if(P.kind==="constant")this.binders[E]=W?new Lu(P.value,M):new Gc(P.value,M,F),v.push(`/u_${E}`);else if(P.kind==="source"||W){const te=am(E,F,"source");this.binders[E]=W?new ol(P,F,j,u,te,i.id):new Sa(P,M,F,te),v.push(`/a_${E}`)}else{const te=am(E,F,"composite");this.binders[E]=new Ao(P,M,F,j,u,te),v.push(`/z_${E}`)}}this.cacheKey=v.sort().join("")}getMaxValue(i){const u=this.binders[i];return u instanceof Sa||u instanceof Ao?u.maxValue:0}populatePaintArrays(i,u,g,v,E){for(const A in this.binders){const M=this.binders[A];(M instanceof Sa||M instanceof Ao||M instanceof ol)&&M.populatePaintArray(i,u,g,v,E)}}setConstantPatternPositions(i,u){for(const g in this.binders){const v=this.binders[g];v instanceof Lu&&v.setConstantPatternPositions(i,u)}}updatePaintArrays(i,u,g,v,E){let A=!1;for(const M in i){const P=u.getPositions(M);for(const F of P){const j=g.feature(F.index);for(const G in this.binders){const W=this.binders[G];if((W instanceof Sa||W instanceof Ao||W instanceof ol)&&W.expression.isStateDependent===!0){const te=v.paint.get(G);W.expression=te.value,W.updatePaintArray(F.start,F.end,j,i[M],E),A=!0}}}}return A}defines(){const i=[];for(const u in this.binders){const g=this.binders[u];(g instanceof Gc||g instanceof Lu)&&i.push(...g.uniformNames.map(v=>`#define HAS_UNIFORM_${v}`))}return i}getBinderAttributes(){const i=[];for(const u in this.binders){const g=this.binders[u];if(g instanceof Sa||g instanceof Ao)for(let v=0;v<g.paintVertexAttributes.length;v++)i.push(g.paintVertexAttributes[v].name);else if(g instanceof ol)for(let v=0;v<il.members.length;v++)i.push(il.members[v].name)}return i}getBinderUniforms(){const i=[];for(const u in this.binders){const g=this.binders[u];if(g instanceof Gc||g instanceof Lu||g instanceof Ao)for(const v of g.uniformNames)i.push(v)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,u){const g=[];for(const v in this.binders){const E=this.binders[v];if(E instanceof Gc||E instanceof Lu||E instanceof Ao){for(const A of E.uniformNames)if(u[A]){const M=E.getBinding(i,u[A],A);g.push({name:A,property:v,binding:M})}}}return g}setUniforms(i,u,g,v){for(const{name:E,property:A,binding:M}of u)this.binders[A].setUniform(M,v,g.get(A),E)}updatePaintBuffers(i){this._buffers=[];for(const u in this.binders){const g=this.binders[u];if(i&&g instanceof ol){const v=i.fromScale===2?g.zoomInPaintVertexBuffer:g.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(g instanceof Sa||g instanceof Ao)&&g.paintVertexBuffer&&this._buffers.push(g.paintVertexBuffer)}}upload(i){for(const u in this.binders){const g=this.binders[u];(g instanceof Sa||g instanceof Ao||g instanceof ol)&&g.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const u=this.binders[i];(u instanceof Sa||u instanceof Ao||u instanceof ol)&&u.destroy()}}}class Xl{constructor(i,u,g=()=>!0){this.programConfigurations={};for(const v of i)this.programConfigurations[v.id]=new om(v,u,g);this.needsUpload=!1,this._featureMap=new Zl,this._bufferOffset=0}populatePaintArrays(i,u,g,v,E,A){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(i,u,v,E,A);u.id!==void 0&&this._featureMap.add(u.id,g,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,u,g,v){for(const E of g)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(i,this._featureMap,u,E,v)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function r1(o,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(`${i}-`,"").replace(/-/g,"_")]}function am(o,i,u){const g={color:{source:me,composite:Sn},number:{source:Zt,composite:me}},v=function(E){return{"line-pattern":{source:zs,composite:zs},"fill-pattern":{source:zs,composite:zs},"fill-extrusion-pattern":{source:zs,composite:zs}}[E]}(o);return v&&v[u]||g[i][u]}Qt("ConstantBinder",Gc),Qt("CrossFadedConstantBinder",Lu),Qt("SourceExpressionBinder",Sa),Qt("CrossFadedCompositeBinder",ol),Qt("CompositeExpressionBinder",Ao),Qt("ProgramConfiguration",om,{omit:["_buffers"]}),Qt("ProgramConfigurationSet",Xl);const ar=8192,pd=Math.pow(2,14)-1,lm=-pd-1;function Wl(o){const i=ar/o.extent,u=o.loadGeometry();for(let g=0;g<u.length;g++){const v=u[g];for(let E=0;E<v.length;E++){const A=v[E],M=Math.round(A.x*i),P=Math.round(A.y*i);A.x=ve(M,lm,pd),A.y=ve(P,lm,pd),(M<A.x||M>A.x+1||P<A.y||P>A.y+1)&&Ue("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function Kl(o,i){return{type:o.type,id:o.id,properties:o.properties,geometry:i?Wl(o):[]}}function $h(o,i,u,g,v){o.emplaceBack(2*i+(g+1)/2,2*u+(v+1)/2)}class md{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Wr,this.indexArray=new Xs,this.segments=new Hn,this.programConfigurations=new Xl(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,g){const v=this.layers[0],E=[];let A=null,M=!1;v.type==="circle"&&(A=v.layout.get("circle-sort-key"),M=!A.isConstant());for(const{feature:P,id:F,index:j,sourceLayerIndex:G}of i){const W=this.layers[0]._featureFilter.needGeometry,te=Kl(P,W);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),te,g))continue;const re=M?A.evaluate(te,{},g):void 0,de={id:F,properties:P.properties,type:P.type,sourceLayerIndex:G,index:j,geometry:W?te.geometry:Wl(P),patterns:{},sortKey:re};E.push(de)}M&&E.sort((P,F)=>P.sortKey-F.sortKey);for(const P of E){const{geometry:F,index:j,sourceLayerIndex:G}=P,W=i[j].feature;this.addFeature(P,F,j,g),u.featureIndex.insert(W,F,j,G,this.index)}}update(i,u,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Ss),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,u,g,v){for(const E of u)for(const A of E){const M=A.x,P=A.y;if(M<0||M>=ar||P<0||P>=ar)continue;const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),j=F.vertexLength;$h(this.layoutVertexArray,M,P,-1,-1),$h(this.layoutVertexArray,M,P,1,-1),$h(this.layoutVertexArray,M,P,1,1),$h(this.layoutVertexArray,M,P,-1,1),this.indexArray.emplaceBack(j,j+1,j+2),this.indexArray.emplaceBack(j,j+3,j+2),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,g,{},v)}}function um(o,i){for(let u=0;u<o.length;u++)if(Mu(i,o[u]))return!0;for(let u=0;u<i.length;u++)if(Mu(o,i[u]))return!0;return!!gd(o,i)}function s1(o,i,u){return!!Mu(o,i)||!!_d(i,o,u)}function cm(o,i){if(o.length===1)return fm(i,o[0]);for(let u=0;u<i.length;u++){const g=i[u];for(let v=0;v<g.length;v++)if(Mu(o,g[v]))return!0}for(let u=0;u<o.length;u++)if(fm(i,o[u]))return!0;for(let u=0;u<i.length;u++)if(gd(o,i[u]))return!0;return!1}function o1(o,i,u){if(o.length>1){if(gd(o,i))return!0;for(let g=0;g<i.length;g++)if(_d(i[g],o,u))return!0}for(let g=0;g<o.length;g++)if(_d(o[g],i,u))return!0;return!1}function gd(o,i){if(o.length===0||i.length===0)return!1;for(let u=0;u<o.length-1;u++){const g=o[u],v=o[u+1];for(let E=0;E<i.length-1;E++)if(a1(g,v,i[E],i[E+1]))return!0}return!1}function a1(o,i,u,g){return qe(o,u,g)!==qe(i,u,g)&&qe(o,i,u)!==qe(o,i,g)}function _d(o,i,u){const g=u*u;if(i.length===1)return o.distSqr(i[0])<g;for(let v=1;v<i.length;v++)if(hm(o,i[v-1],i[v])<g)return!0;return!1}function hm(o,i,u){const g=i.distSqr(u);if(g===0)return o.distSqr(i);const v=((o.x-i.x)*(u.x-i.x)+(o.y-i.y)*(u.y-i.y))/g;return o.distSqr(v<0?i:v>1?u:u.sub(i)._mult(v)._add(i))}function fm(o,i){let u,g,v,E=!1;for(let A=0;A<o.length;A++){u=o[A];for(let M=0,P=u.length-1;M<u.length;P=M++)g=u[M],v=u[P],g.y>i.y!=v.y>i.y&&i.x<(v.x-g.x)*(i.y-g.y)/(v.y-g.y)+g.x&&(E=!E)}return E}function Mu(o,i){let u=!1;for(let g=0,v=o.length-1;g<o.length;v=g++){const E=o[g],A=o[v];E.y>i.y!=A.y>i.y&&i.x<(A.x-E.x)*(i.y-E.y)/(A.y-E.y)+E.x&&(u=!u)}return u}function l1(o,i,u){const g=u[0],v=u[2];if(o.x<g.x&&i.x<g.x||o.x>v.x&&i.x>v.x||o.y<g.y&&i.y<g.y||o.y>v.y&&i.y>v.y)return!1;const E=qe(o,i,u[0]);return E!==qe(o,i,u[1])||E!==qe(o,i,u[2])||E!==qe(o,i,u[3])}function Zc(o,i,u){const g=i.paint.get(o).value;return g.kind==="constant"?g.value:u.programConfigurations.get(i.id).getMaxValue(o)}function Yh(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Jh(o,i,u,g,v){if(!i[0]&&!i[1])return o;const E=C.convert(i)._mult(v);u==="viewport"&&E._rotate(-g);const A=[];for(let M=0;M<o.length;M++)A.push(o[M].sub(E));return A}let dm,pm;Qt("CircleBucket",md,{omit:["layers"]});var u1={get paint(){return pm=pm||new k({"circle-radius":new yn(Ke.paint_circle["circle-radius"]),"circle-color":new yn(Ke.paint_circle["circle-color"]),"circle-blur":new yn(Ke.paint_circle["circle-blur"]),"circle-opacity":new yn(Ke.paint_circle["circle-opacity"]),"circle-translate":new nn(Ke.paint_circle["circle-translate"]),"circle-translate-anchor":new nn(Ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new nn(Ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new nn(Ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new yn(Ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new yn(Ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new yn(Ke.paint_circle["circle-stroke-opacity"])})},get layout(){return dm=dm||new k({"circle-sort-key":new yn(Ke.layout_circle["circle-sort-key"])})}},as=1e-6,Ru=typeof Float32Array<"u"?Float32Array:Array;function yd(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function mm(o,i,u){var g=i[0],v=i[1],E=i[2],A=i[3],M=i[4],P=i[5],F=i[6],j=i[7],G=i[8],W=i[9],te=i[10],re=i[11],de=i[12],Ce=i[13],De=i[14],nt=i[15],Ge=u[0],Qe=u[1],ht=u[2],Et=u[3];return o[0]=Ge*g+Qe*M+ht*G+Et*de,o[1]=Ge*v+Qe*P+ht*W+Et*Ce,o[2]=Ge*E+Qe*F+ht*te+Et*De,o[3]=Ge*A+Qe*j+ht*re+Et*nt,o[4]=(Ge=u[4])*g+(Qe=u[5])*M+(ht=u[6])*G+(Et=u[7])*de,o[5]=Ge*v+Qe*P+ht*W+Et*Ce,o[6]=Ge*E+Qe*F+ht*te+Et*De,o[7]=Ge*A+Qe*j+ht*re+Et*nt,o[8]=(Ge=u[8])*g+(Qe=u[9])*M+(ht=u[10])*G+(Et=u[11])*de,o[9]=Ge*v+Qe*P+ht*W+Et*Ce,o[10]=Ge*E+Qe*F+ht*te+Et*De,o[11]=Ge*A+Qe*j+ht*re+Et*nt,o[12]=(Ge=u[12])*g+(Qe=u[13])*M+(ht=u[14])*G+(Et=u[15])*de,o[13]=Ge*v+Qe*P+ht*W+Et*Ce,o[14]=Ge*E+Qe*F+ht*te+Et*De,o[15]=Ge*A+Qe*j+ht*re+Et*nt,o}Math.hypot||(Math.hypot=function(){for(var o=0,i=arguments.length;i--;)o+=arguments[i]*arguments[i];return Math.sqrt(o)});var Hc,c1=mm;function Qh(o,i,u){var g=i[0],v=i[1],E=i[2],A=i[3];return o[0]=u[0]*g+u[4]*v+u[8]*E+u[12]*A,o[1]=u[1]*g+u[5]*v+u[9]*E+u[13]*A,o[2]=u[2]*g+u[6]*v+u[10]*E+u[14]*A,o[3]=u[3]*g+u[7]*v+u[11]*E+u[15]*A,o}Hc=new Ru(4),Ru!=Float32Array&&(Hc[0]=0,Hc[1]=0,Hc[2]=0,Hc[3]=0);class h1 extends f{constructor(i){super(i,u1)}createBucket(i){return new md(i)}queryRadius(i){const u=i;return Zc("circle-radius",this,u)+Zc("circle-stroke-width",this,u)+Yh(this.paint.get("circle-translate"))}queryIntersectsFeature(i,u,g,v,E,A,M,P){const F=Jh(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),A.angle,M),j=this.paint.get("circle-radius").evaluate(u,g)+this.paint.get("circle-stroke-width").evaluate(u,g),G=this.paint.get("circle-pitch-alignment")==="map",W=G?F:function(re,de){return re.map(Ce=>gm(Ce,de))}(F,P),te=G?j*M:j;for(const re of v)for(const de of re){const Ce=G?de:gm(de,P);let De=te;const nt=Qh([],[de.x,de.y,0,1],P);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?De*=nt[3]/A.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(De*=A.cameraToCenterDistance/nt[3]),s1(W,Ce,De))return!0}return!1}}function gm(o,i){const u=Qh([],[o.x,o.y,0,1],i);return new C(u[0]/u[3],u[1]/u[3])}class _m extends md{}let ym;Qt("HeatmapBucket",_m,{omit:["layers"]});var f1={get paint(){return ym=ym||new k({"heatmap-radius":new yn(Ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new yn(Ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new nn(Ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new qc(Ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new nn(Ke.paint_heatmap["heatmap-opacity"])})}};function vd(o,{width:i,height:u},g,v){if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==i*u*g)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${i*u*g}`)}else v=new Uint8Array(i*u*g);return o.width=i,o.height=u,o.data=v,o}function vm(o,{width:i,height:u},g){if(i===o.width&&u===o.height)return;const v=vd({},{width:i,height:u},g);bd(o,v,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,i),height:Math.min(o.height,u)},g),o.width=i,o.height=u,o.data=v.data}function bd(o,i,u,g,v,E){if(v.width===0||v.height===0)return i;if(v.width>o.width||v.height>o.height||u.x>o.width-v.width||u.y>o.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>i.width||v.height>i.height||g.x>i.width-v.width||g.y>i.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const A=o.data,M=i.data;if(A===M)throw new Error("srcData equals dstData, so image is already copied");for(let P=0;P<v.height;P++){const F=((u.y+P)*o.width+u.x)*E,j=((g.y+P)*i.width+g.x)*E;for(let G=0;G<v.width*E;G++)M[j+G]=A[F+G]}return i}class Xc{constructor(i,u){vd(this,i,1,u)}resize(i){vm(this,i,1)}clone(){return new Xc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,u,g,v,E){bd(i,u,g,v,E,1)}}class Ws{constructor(i,u){vd(this,i,4,u)}resize(i){vm(this,i,4)}replace(i,u){u?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Ws({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,u,g,v,E){bd(i,u,g,v,E,4)}}function bm(o){const i={},u=o.resolution||256,g=o.clips?o.clips.length:1,v=o.image||new Ws({width:u,height:g});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const E=(A,M,P)=>{i[o.evaluationKey]=P;const F=o.expression.evaluate(i);v.data[A+M+0]=Math.floor(255*F.r/F.a),v.data[A+M+1]=Math.floor(255*F.g/F.a),v.data[A+M+2]=Math.floor(255*F.b/F.a),v.data[A+M+3]=Math.floor(255*F.a)};if(o.clips)for(let A=0,M=0;A<g;++A,M+=4*u)for(let P=0,F=0;P<u;P++,F+=4){const j=P/(u-1),{start:G,end:W}=o.clips[A];E(M,F,G*(1-j)+W*j)}else for(let A=0,M=0;A<u;A++,M+=4)E(0,M,A/(u-1));return v}Qt("AlphaImage",Xc),Qt("RGBAImage",Ws);const xd="big-fb";class d1 extends f{createBucket(i){return new _m(i)}constructor(i){super(i,f1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=bm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(xd)&&this.heatmapFbos.delete(xd)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let xm;var p1={get paint(){return xm=xm||new k({"hillshade-illumination-direction":new nn(Ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new nn(Ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new nn(Ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new nn(Ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new nn(Ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new nn(Ke.paint_hillshade["hillshade-accent-color"])})}};class m1 extends f{constructor(i){super(i,p1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const g1=R([{name:"a_pos",components:2,type:"Int16"}],4),{members:_1}=g1;function wm(o,i,u=2){const g=i&&i.length,v=g?i[0]*u:o.length;let E=km(o,0,v,u,!0);const A=[];if(!E||E.next===E.prev)return A;let M,P,F;if(g&&(E=function(j,G,W,te){const re=[];for(let de=0,Ce=G.length;de<Ce;de++){const De=km(j,G[de]*te,de<Ce-1?G[de+1]*te:j.length,te,!1);De===De.next&&(De.steiner=!0),re.push(S1(De))}re.sort(w1);for(let de=0;de<re.length;de++)W=k1(re[de],W);return W}(o,i,E,u)),o.length>80*u){M=1/0,P=1/0;let j=-1/0,G=-1/0;for(let W=u;W<v;W+=u){const te=o[W],re=o[W+1];te<M&&(M=te),re<P&&(P=re),te>j&&(j=te),re>G&&(G=re)}F=Math.max(j-M,G-P),F=F!==0?32767/F:0}return Wc(E,A,u,M,P,F,0),A}function km(o,i,u,g,v){let E;if(v===function(A,M,P,F){let j=0;for(let G=M,W=P-F;G<P;G+=F)j+=(A[W]-A[G])*(A[G+1]+A[W+1]),W=G;return j}(o,i,u,g)>0)for(let A=i;A<u;A+=g)E=Em(A/g|0,o[A],o[A+1],E);else for(let A=u-g;A>=i;A-=g)E=Em(A/g|0,o[A],o[A+1],E);return E&&ef(E,E.next)&&($c(E),E=E.next),E}function $l(o,i){if(!o)return o;i||(i=o);let u,g=o;do if(u=!1,g.steiner||!ef(g,g.next)&&tr(g.prev,g,g.next)!==0)g=g.next;else{if($c(g),g=i=g.prev,g===g.next)break;u=!0}while(u||g!==i);return i}function Wc(o,i,u,g,v,E,A){if(!o)return;!A&&E&&function(P,F,j,G){let W=P;do W.z===0&&(W.z=wd(W.x,W.y,F,j,G)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next;while(W!==P);W.prevZ.nextZ=null,W.prevZ=null,function(te){let re,de=1;do{let Ce,De=te;te=null;let nt=null;for(re=0;De;){re++;let Ge=De,Qe=0;for(let Et=0;Et<de&&(Qe++,Ge=Ge.nextZ,Ge);Et++);let ht=de;for(;Qe>0||ht>0&&Ge;)Qe!==0&&(ht===0||!Ge||De.z<=Ge.z)?(Ce=De,De=De.nextZ,Qe--):(Ce=Ge,Ge=Ge.nextZ,ht--),nt?nt.nextZ=Ce:te=Ce,Ce.prevZ=nt,nt=Ce;De=Ge}nt.nextZ=null,de*=2}while(re>1)}(W)}(o,g,v,E);let M=o;for(;o.prev!==o.next;){const P=o.prev,F=o.next;if(E?v1(o,g,v,E):y1(o))i.push(P.i,o.i,F.i),$c(o),o=F.next,M=F.next;else if((o=F)===M){A?A===1?Wc(o=b1($l(o),i),i,u,g,v,E,2):A===2&&x1(o,i,u,g,v,E):Wc($l(o),i,u,g,v,E,1);break}}}function y1(o){const i=o.prev,u=o,g=o.next;if(tr(i,u,g)>=0)return!1;const v=i.x,E=u.x,A=g.x,M=i.y,P=u.y,F=g.y,j=v<E?v<A?v:A:E<A?E:A,G=M<P?M<F?M:F:P<F?P:F,W=v>E?v>A?v:A:E>A?E:A,te=M>P?M>F?M:F:P>F?P:F;let re=g.next;for(;re!==i;){if(re.x>=j&&re.x<=W&&re.y>=G&&re.y<=te&&Pu(v,M,E,P,A,F,re.x,re.y)&&tr(re.prev,re,re.next)>=0)return!1;re=re.next}return!0}function v1(o,i,u,g){const v=o.prev,E=o,A=o.next;if(tr(v,E,A)>=0)return!1;const M=v.x,P=E.x,F=A.x,j=v.y,G=E.y,W=A.y,te=M<P?M<F?M:F:P<F?P:F,re=j<G?j<W?j:W:G<W?G:W,de=M>P?M>F?M:F:P>F?P:F,Ce=j>G?j>W?j:W:G>W?G:W,De=wd(te,re,i,u,g),nt=wd(de,Ce,i,u,g);let Ge=o.prevZ,Qe=o.nextZ;for(;Ge&&Ge.z>=De&&Qe&&Qe.z<=nt;){if(Ge.x>=te&&Ge.x<=de&&Ge.y>=re&&Ge.y<=Ce&&Ge!==v&&Ge!==A&&Pu(M,j,P,G,F,W,Ge.x,Ge.y)&&tr(Ge.prev,Ge,Ge.next)>=0||(Ge=Ge.prevZ,Qe.x>=te&&Qe.x<=de&&Qe.y>=re&&Qe.y<=Ce&&Qe!==v&&Qe!==A&&Pu(M,j,P,G,F,W,Qe.x,Qe.y)&&tr(Qe.prev,Qe,Qe.next)>=0))return!1;Qe=Qe.nextZ}for(;Ge&&Ge.z>=De;){if(Ge.x>=te&&Ge.x<=de&&Ge.y>=re&&Ge.y<=Ce&&Ge!==v&&Ge!==A&&Pu(M,j,P,G,F,W,Ge.x,Ge.y)&&tr(Ge.prev,Ge,Ge.next)>=0)return!1;Ge=Ge.prevZ}for(;Qe&&Qe.z<=nt;){if(Qe.x>=te&&Qe.x<=de&&Qe.y>=re&&Qe.y<=Ce&&Qe!==v&&Qe!==A&&Pu(M,j,P,G,F,W,Qe.x,Qe.y)&&tr(Qe.prev,Qe,Qe.next)>=0)return!1;Qe=Qe.nextZ}return!0}function b1(o,i){let u=o;do{const g=u.prev,v=u.next.next;!ef(g,v)&&Im(g,u,u.next,v)&&Kc(g,v)&&Kc(v,g)&&(i.push(g.i,u.i,v.i),$c(u),$c(u.next),u=o=v),u=u.next}while(u!==o);return $l(u)}function x1(o,i,u,g,v,E){let A=o;do{let M=A.next.next;for(;M!==A.prev;){if(A.i!==M.i&&E1(A,M)){let P=Sm(A,M);return A=$l(A,A.next),P=$l(P,P.next),Wc(A,i,u,g,v,E,0),void Wc(P,i,u,g,v,E,0)}M=M.next}A=A.next}while(A!==o)}function w1(o,i){return o.x-i.x}function k1(o,i){const u=function(v,E){let A=E;const M=v.x,P=v.y;let F,j=-1/0;do{if(P<=A.y&&P>=A.next.y&&A.next.y!==A.y){const de=A.x+(P-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(de<=M&&de>j&&(j=de,F=A.x<A.next.x?A:A.next,de===M))return F}A=A.next}while(A!==E);if(!F)return null;const G=F,W=F.x,te=F.y;let re=1/0;A=F;do{if(M>=A.x&&A.x>=W&&M!==A.x&&Pu(P<te?M:j,P,W,te,P<te?j:M,P,A.x,A.y)){const de=Math.abs(P-A.y)/(M-A.x);Kc(A,v)&&(de<re||de===re&&(A.x>F.x||A.x===F.x&&I1(F,A)))&&(F=A,re=de)}A=A.next}while(A!==G);return F}(o,i);if(!u)return i;const g=Sm(u,o);return $l(g,g.next),$l(u,u.next)}function I1(o,i){return tr(o.prev,o,i.prev)<0&&tr(i.next,o,o.next)<0}function wd(o,i,u,g,v){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-u)*v|0)|o<<8))|o<<4))|o<<2))|o<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-g)*v|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function S1(o){let i=o,u=o;do(i.x<u.x||i.x===u.x&&i.y<u.y)&&(u=i),i=i.next;while(i!==o);return u}function Pu(o,i,u,g,v,E,A,M){return(v-A)*(i-M)>=(o-A)*(E-M)&&(o-A)*(g-M)>=(u-A)*(i-M)&&(u-A)*(E-M)>=(v-A)*(g-M)}function E1(o,i){return o.next.i!==i.i&&o.prev.i!==i.i&&!function(u,g){let v=u;do{if(v.i!==u.i&&v.next.i!==u.i&&v.i!==g.i&&v.next.i!==g.i&&Im(v,v.next,u,g))return!0;v=v.next}while(v!==u);return!1}(o,i)&&(Kc(o,i)&&Kc(i,o)&&function(u,g){let v=u,E=!1;const A=(u.x+g.x)/2,M=(u.y+g.y)/2;do v.y>M!=v.next.y>M&&v.next.y!==v.y&&A<(v.next.x-v.x)*(M-v.y)/(v.next.y-v.y)+v.x&&(E=!E),v=v.next;while(v!==u);return E}(o,i)&&(tr(o.prev,o,i.prev)||tr(o,i.prev,i))||ef(o,i)&&tr(o.prev,o,o.next)>0&&tr(i.prev,i,i.next)>0)}function tr(o,i,u){return(i.y-o.y)*(u.x-i.x)-(i.x-o.x)*(u.y-i.y)}function ef(o,i){return o.x===i.x&&o.y===i.y}function Im(o,i,u,g){const v=nf(tr(o,i,u)),E=nf(tr(o,i,g)),A=nf(tr(u,g,o)),M=nf(tr(u,g,i));return v!==E&&A!==M||!(v!==0||!tf(o,u,i))||!(E!==0||!tf(o,g,i))||!(A!==0||!tf(u,o,g))||!(M!==0||!tf(u,i,g))}function tf(o,i,u){return i.x<=Math.max(o.x,u.x)&&i.x>=Math.min(o.x,u.x)&&i.y<=Math.max(o.y,u.y)&&i.y>=Math.min(o.y,u.y)}function nf(o){return o>0?1:o<0?-1:0}function Kc(o,i){return tr(o.prev,o,o.next)<0?tr(o,i,o.next)>=0&&tr(o,o.prev,i)>=0:tr(o,i,o.prev)<0||tr(o,o.next,i)<0}function Sm(o,i){const u=kd(o.i,o.x,o.y),g=kd(i.i,i.x,i.y),v=o.next,E=i.prev;return o.next=i,i.prev=o,u.next=v,v.prev=u,g.next=u,u.prev=g,E.next=g,g.prev=E,g}function Em(o,i,u,g){const v=kd(o,i,u);return g?(v.next=g.next,v.prev=g,g.next.prev=v,g.next=v):(v.prev=v,v.next=v),v}function $c(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function kd(o,i,u){return{i:o,x:i,y:u,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Id(o,i,u){const g=u.patternDependencies;let v=!1;for(const E of i){const A=E.paint.get(`${o}-pattern`);A.isConstant()||(v=!0);const M=A.constantOr(null);M&&(v=!0,g[M.to]=!0,g[M.from]=!0)}return v}function Sd(o,i,u,g,v){const E=v.patternDependencies;for(const A of i){const M=A.paint.get(`${o}-pattern`).value;if(M.kind!=="constant"){let P=M.evaluate({zoom:g-1},u,{},v.availableImages),F=M.evaluate({zoom:g},u,{},v.availableImages),j=M.evaluate({zoom:g+1},u,{},v.availableImages);P=P&&P.name?P.name:P,F=F&&F.name?F.name:F,j=j&&j.name?j.name:j,E[P]=!0,E[F]=!0,E[j]=!0,u.patterns[A.id]={min:P,mid:F,max:j}}}return u}class Ed{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ho,this.indexArray=new Xs,this.indexArray2=new Pr,this.programConfigurations=new Xl(i.layers,i.zoom),this.segments=new Hn,this.segments2=new Hn,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,g){this.hasPattern=Id("fill",this.layers,u);const v=this.layers[0].layout.get("fill-sort-key"),E=!v.isConstant(),A=[];for(const{feature:M,id:P,index:F,sourceLayerIndex:j}of i){const G=this.layers[0]._featureFilter.needGeometry,W=Kl(M,G);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),W,g))continue;const te=E?v.evaluate(W,{},g,u.availableImages):void 0,re={id:P,properties:M.properties,type:M.type,sourceLayerIndex:j,index:F,geometry:G?W.geometry:Wl(M),patterns:{},sortKey:te};A.push(re)}E&&A.sort((M,P)=>M.sortKey-P.sortKey);for(const M of A){const{geometry:P,index:F,sourceLayerIndex:j}=M;if(this.hasPattern){const G=Sd("fill",this.layers,M,this.zoom,u);this.patternFeatures.push(G)}else this.addFeature(M,P,F,g,{});u.featureIndex.insert(i[F].feature,P,F,j,this.index)}}update(i,u,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,g)}addFeatures(i,u,g){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,u,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,_1),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,u,g,v,E){for(const A of ja(u,500)){let M=0;for(const te of A)M+=te.length;const P=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),F=P.vertexLength,j=[],G=[];for(const te of A){if(te.length===0)continue;te!==A[0]&&G.push(j.length/2);const re=this.segments2.prepareSegment(te.length,this.layoutVertexArray,this.indexArray2),de=re.vertexLength;this.layoutVertexArray.emplaceBack(te[0].x,te[0].y),this.indexArray2.emplaceBack(de+te.length-1,de),j.push(te[0].x),j.push(te[0].y);for(let Ce=1;Ce<te.length;Ce++)this.layoutVertexArray.emplaceBack(te[Ce].x,te[Ce].y),this.indexArray2.emplaceBack(de+Ce-1,de+Ce),j.push(te[Ce].x),j.push(te[Ce].y);re.vertexLength+=te.length,re.primitiveLength+=te.length}const W=wm(j,G);for(let te=0;te<W.length;te+=3)this.indexArray.emplaceBack(F+W[te],F+W[te+1],F+W[te+2]);P.vertexLength+=M,P.primitiveLength+=W.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,g,E,v)}}let Am,Tm;Qt("FillBucket",Ed,{omit:["layers","patternFeatures"]});var A1={get paint(){return Tm=Tm||new k({"fill-antialias":new nn(Ke.paint_fill["fill-antialias"]),"fill-opacity":new yn(Ke.paint_fill["fill-opacity"]),"fill-color":new yn(Ke.paint_fill["fill-color"]),"fill-outline-color":new yn(Ke.paint_fill["fill-outline-color"]),"fill-translate":new nn(Ke.paint_fill["fill-translate"]),"fill-translate-anchor":new nn(Ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new ku(Ke.paint_fill["fill-pattern"])})},get layout(){return Am=Am||new k({"fill-sort-key":new yn(Ke.layout_fill["fill-sort-key"])})}};class T1 extends f{constructor(i){super(i,A1)}recalculate(i,u){super.recalculate(i,u);const g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Ed(i)}queryRadius(){return Yh(this.paint.get("fill-translate"))}queryIntersectsFeature(i,u,g,v,E,A,M){return cm(Jh(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),A.angle,M),v)}isTileClipped(){return!0}}const C1=R([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),L1=R([{name:"a_centroid",components:2,type:"Int16"}],4),{members:M1}=C1;var al={},R1=S,Cm=Du;function Du(o,i,u,g,v){this.properties={},this.extent=u,this.type=0,this._pbf=o,this._geometry=-1,this._keys=g,this._values=v,o.readFields(P1,this,i)}function P1(o,i,u){o==1?i.id=u.readVarint():o==2?function(g,v){for(var E=g.readVarint()+g.pos;g.pos<E;){var A=v._keys[g.readVarint()],M=v._values[g.readVarint()];v.properties[A]=M}}(u,i):o==3?i.type=u.readVarint():o==4&&(i._geometry=u.pos)}function D1(o){for(var i,u,g=0,v=0,E=o.length,A=E-1;v<E;A=v++)g+=((u=o[A]).x-(i=o[v]).x)*(i.y+u.y);return g}Du.types=["Unknown","Point","LineString","Polygon"],Du.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var i,u=o.readVarint()+o.pos,g=1,v=0,E=0,A=0,M=[];o.pos<u;){if(v<=0){var P=o.readVarint();g=7&P,v=P>>3}if(v--,g===1||g===2)E+=o.readSVarint(),A+=o.readSVarint(),g===1&&(i&&M.push(i),i=[]),i.push(new R1(E,A));else{if(g!==7)throw new Error("unknown command "+g);i&&i.push(i[0].clone())}}return i&&M.push(i),M},Du.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var i=o.readVarint()+o.pos,u=1,g=0,v=0,E=0,A=1/0,M=-1/0,P=1/0,F=-1/0;o.pos<i;){if(g<=0){var j=o.readVarint();u=7&j,g=j>>3}if(g--,u===1||u===2)(v+=o.readSVarint())<A&&(A=v),v>M&&(M=v),(E+=o.readSVarint())<P&&(P=E),E>F&&(F=E);else if(u!==7)throw new Error("unknown command "+u)}return[A,P,M,F]},Du.prototype.toGeoJSON=function(o,i,u){var g,v,E=this.extent*Math.pow(2,u),A=this.extent*o,M=this.extent*i,P=this.loadGeometry(),F=Du.types[this.type];function j(te){for(var re=0;re<te.length;re++){var de=te[re];te[re]=[360*(de.x+A)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(de.y+M)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(g=0;g<P.length;g++)G[g]=P[g][0];j(P=G);break;case 2:for(g=0;g<P.length;g++)j(P[g]);break;case 3:for(P=function(te){var re=te.length;if(re<=1)return[te];for(var de,Ce,De=[],nt=0;nt<re;nt++){var Ge=D1(te[nt]);Ge!==0&&(Ce===void 0&&(Ce=Ge<0),Ce===Ge<0?(de&&De.push(de),de=[te[nt]]):de.push(te[nt]))}return de&&De.push(de),De}(P),g=0;g<P.length;g++)for(v=0;v<P[g].length;v++)j(P[g][v])}P.length===1?P=P[0]:F="Multi"+F;var W={type:"Feature",geometry:{type:F,coordinates:P},properties:this.properties};return"id"in this&&(W.id=this.id),W};var N1=Cm,Lm=Mm;function Mm(o,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(z1,this,i),this.length=this._features.length}function z1(o,i,u){o===15?i.version=u.readVarint():o===1?i.name=u.readString():o===5?i.extent=u.readVarint():o===2?i._features.push(u.pos):o===3?i._keys.push(u.readString()):o===4&&i._values.push(function(g){for(var v=null,E=g.readVarint()+g.pos;g.pos<E;){var A=g.readVarint()>>3;v=A===1?g.readString():A===2?g.readFloat():A===3?g.readDouble():A===4?g.readVarint64():A===5?g.readVarint():A===6?g.readSVarint():A===7?g.readBoolean():null}return v}(u))}Mm.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var i=this._pbf.readVarint()+this._pbf.pos;return new N1(this._pbf,i,this.extent,this._keys,this._values)};var F1=Lm;function O1(o,i,u){if(o===3){var g=new F1(u,u.readVarint()+u.pos);g.length&&(i[g.name]=g)}}al.VectorTile=function(o,i){this.layers=o.readFields(O1,{},i)},al.VectorTileFeature=Cm,al.VectorTileLayer=Lm;const B1=al.VectorTileFeature.types,Ad=Math.pow(2,13);function Yc(o,i,u,g,v,E,A,M){o.emplaceBack(i,u,2*Math.floor(g*Ad)+A,v*Ad*2,E*Ad*2,Math.round(M))}class Td{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new tl,this.centroidVertexArray=new Fr,this.indexArray=new Xs,this.programConfigurations=new Xl(i.layers,i.zoom),this.segments=new Hn,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,g){this.features=[],this.hasPattern=Id("fill-extrusion",this.layers,u);for(const{feature:v,id:E,index:A,sourceLayerIndex:M}of i){const P=this.layers[0]._featureFilter.needGeometry,F=Kl(v,P);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),F,g))continue;const j={id:E,sourceLayerIndex:M,index:A,geometry:P?F.geometry:Wl(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(Sd("fill-extrusion",this.layers,j,this.zoom,u)):this.addFeature(j,j.geometry,A,g,{}),u.featureIndex.insert(v,j.geometry,A,M,this.index,!0)}}addFeatures(i,u,g){for(const v of this.features){const{geometry:E}=v;this.addFeature(v,E,v.index,u,g)}}update(i,u,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,M1),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,L1.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,u,g,v,E){for(const A of ja(u,500)){const M={x:0,y:0,vertexCount:0};let P=0;for(const re of A)P+=re.length;let F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const re of A){if(re.length===0||j1(re))continue;let de=0;for(let Ce=0;Ce<re.length;Ce++){const De=re[Ce];if(Ce>=1){const nt=re[Ce-1];if(!U1(De,nt)){F.vertexLength+4>Hn.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ge=De.sub(nt)._perp()._unit(),Qe=nt.dist(De);de+Qe>32768&&(de=0),Yc(this.layoutVertexArray,De.x,De.y,Ge.x,Ge.y,0,0,de),Yc(this.layoutVertexArray,De.x,De.y,Ge.x,Ge.y,0,1,de),M.x+=2*De.x,M.y+=2*De.y,M.vertexCount+=2,de+=Qe,Yc(this.layoutVertexArray,nt.x,nt.y,Ge.x,Ge.y,0,0,de),Yc(this.layoutVertexArray,nt.x,nt.y,Ge.x,Ge.y,0,1,de),M.x+=2*nt.x,M.y+=2*nt.y,M.vertexCount+=2;const ht=F.vertexLength;this.indexArray.emplaceBack(ht,ht+2,ht+1),this.indexArray.emplaceBack(ht+1,ht+2,ht+3),F.vertexLength+=4,F.primitiveLength+=2}}}}if(F.vertexLength+P>Hn.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray)),B1[i.type]!=="Polygon")continue;const j=[],G=[],W=F.vertexLength;for(const re of A)if(re.length!==0){re!==A[0]&&G.push(j.length/2);for(let de=0;de<re.length;de++){const Ce=re[de];Yc(this.layoutVertexArray,Ce.x,Ce.y,0,0,1,1,0),M.x+=Ce.x,M.y+=Ce.y,M.vertexCount+=1,j.push(Ce.x),j.push(Ce.y)}}const te=wm(j,G);for(let re=0;re<te.length;re+=3)this.indexArray.emplaceBack(W+te[re],W+te[re+2],W+te[re+1]);F.primitiveLength+=te.length/3,F.vertexLength+=P;for(let re=0;re<M.vertexCount;re++){const de=Math.floor(M.x/M.vertexCount),Ce=Math.floor(M.y/M.vertexCount);this.centroidVertexArray.emplaceBack(de,Ce)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,g,E,v)}}function U1(o,i){return o.x===i.x&&(o.x<0||o.x>ar)||o.y===i.y&&(o.y<0||o.y>ar)}function j1(o){return o.every(i=>i.x<0)||o.every(i=>i.x>ar)||o.every(i=>i.y<0)||o.every(i=>i.y>ar)}let Rm;Qt("FillExtrusionBucket",Td,{omit:["layers","features"]});var q1={get paint(){return Rm=Rm||new k({"fill-extrusion-opacity":new nn(Ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new yn(Ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new nn(Ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new nn(Ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ku(Ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new yn(Ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new yn(Ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new nn(Ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class V1 extends f{constructor(i){super(i,q1)}createBucket(i){return new Td(i)}queryRadius(){return Yh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,u,g,v,E,A,M,P){const F=Jh(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),A.angle,M),j=this.paint.get("fill-extrusion-height").evaluate(u,g),G=this.paint.get("fill-extrusion-base").evaluate(u,g),W=function(re,de,Ce,De){const nt=[];for(const Ge of re){const Qe=[Ge.x,Ge.y,0,1];Qh(Qe,Qe,de),nt.push(new C(Qe[0]/Qe[3],Qe[1]/Qe[3]))}return nt}(F,P),te=function(re,de,Ce,De){const nt=[],Ge=[],Qe=De[8]*de,ht=De[9]*de,Et=De[10]*de,Wt=De[11]*de,_n=De[8]*Ce,Ht=De[9]*Ce,Gt=De[10]*Ce,on=De[11]*Ce;for(const tn of re){const Yt=[],yt=[];for(const cn of tn){const sn=cn.x,kn=cn.y,bi=De[0]*sn+De[4]*kn+De[12],yi=De[1]*sn+De[5]*kn+De[13],xr=De[2]*sn+De[6]*kn+De[14],fo=De[3]*sn+De[7]*kn+De[15],Ur=xr+Et,wr=fo+Wt,ls=bi+_n,us=yi+Ht,cs=xr+Gt,Ki=fo+on,kr=new C((bi+Qe)/wr,(yi+ht)/wr);kr.z=Ur/wr,Yt.push(kr);const Kr=new C(ls/Ki,us/Ki);Kr.z=cs/Ki,yt.push(Kr)}nt.push(Yt),Ge.push(yt)}return[nt,Ge]}(v,G,j,P);return function(re,de,Ce){let De=1/0;cm(Ce,de)&&(De=Pm(Ce,de[0]));for(let nt=0;nt<de.length;nt++){const Ge=de[nt],Qe=re[nt];for(let ht=0;ht<Ge.length-1;ht++){const Et=Ge[ht],Wt=[Et,Ge[ht+1],Qe[ht+1],Qe[ht],Et];um(Ce,Wt)&&(De=Math.min(De,Pm(Ce,Wt)))}}return De!==1/0&&De}(te[0],te[1],W)}}function Jc(o,i){return o.x*i.x+o.y*i.y}function Pm(o,i){if(o.length===1){let u=0;const g=i[u++];let v;for(;!v||g.equals(v);)if(v=i[u++],!v)return 1/0;for(;u<i.length;u++){const E=i[u],A=o[0],M=v.sub(g),P=E.sub(g),F=A.sub(g),j=Jc(M,M),G=Jc(M,P),W=Jc(P,P),te=Jc(F,M),re=Jc(F,P),de=j*W-G*G,Ce=(W*te-G*re)/de,De=(j*re-G*te)/de,nt=g.z*(1-Ce-De)+v.z*Ce+E.z*De;if(isFinite(nt))return nt}return 1/0}{let u=1/0;for(const g of i)u=Math.min(u,g.z);return u}}const G1=R([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Z1}=G1,H1=R([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:X1}=H1,W1=al.VectorTileFeature.types,K1=Math.cos(Math.PI/180*37.5),Dm=Math.pow(2,14)/.5;class Cd{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new Su,this.layoutVertexArray2=new nl,this.indexArray=new Xs,this.programConfigurations=new Xl(i.layers,i.zoom),this.segments=new Hn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,g){this.hasPattern=Id("line",this.layers,u);const v=this.layers[0].layout.get("line-sort-key"),E=!v.isConstant(),A=[];for(const{feature:M,id:P,index:F,sourceLayerIndex:j}of i){const G=this.layers[0]._featureFilter.needGeometry,W=Kl(M,G);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),W,g))continue;const te=E?v.evaluate(W,{},g):void 0,re={id:P,properties:M.properties,type:M.type,sourceLayerIndex:j,index:F,geometry:G?W.geometry:Wl(M),patterns:{},sortKey:te};A.push(re)}E&&A.sort((M,P)=>M.sortKey-P.sortKey);for(const M of A){const{geometry:P,index:F,sourceLayerIndex:j}=M;if(this.hasPattern){const G=Sd("line",this.layers,M,this.zoom,u);this.patternFeatures.push(G)}else this.addFeature(M,P,F,g,{});u.featureIndex.insert(i[F].feature,P,F,j,this.index)}}update(i,u,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,g)}addFeatures(i,u,g){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,u,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,X1)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Z1),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,u,g,v,E){const A=this.layers[0].layout,M=A.get("line-join").evaluate(i,{}),P=A.get("line-cap"),F=A.get("line-miter-limit"),j=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const G of u)this.addLine(G,i,M,P,F,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,g,E,v)}addLine(i,u,g,v,E,A){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let De=0;De<i.length-1;De++)this.totalDistance+=i[De].dist(i[De+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=W1[u.type]==="Polygon";let P=i.length;for(;P>=2&&i[P-1].equals(i[P-2]);)P--;let F=0;for(;F<P-1&&i[F].equals(i[F+1]);)F++;if(P<(M?3:2))return;g==="bevel"&&(E=1.05);const j=this.overscaling<=16?15*ar/(512*this.overscaling):0,G=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let W,te,re,de,Ce;this.e1=this.e2=-1,M&&(W=i[P-2],Ce=i[F].sub(W)._unit()._perp());for(let De=F;De<P;De++){if(re=De===P-1?M?i[F+1]:void 0:i[De+1],re&&i[De].equals(re))continue;Ce&&(de=Ce),W&&(te=W),W=i[De],Ce=re?re.sub(W)._unit()._perp():de,de=de||Ce;let nt=de.add(Ce);nt.x===0&&nt.y===0||nt._unit();const Ge=de.x*Ce.x+de.y*Ce.y,Qe=nt.x*Ce.x+nt.y*Ce.y,ht=Qe!==0?1/Qe:1/0,Et=2*Math.sqrt(2-2*Qe),Wt=Qe<K1&&te&&re,_n=de.x*Ce.y-de.y*Ce.x>0;if(Wt&&De>F){const on=W.dist(te);if(on>2*j){const tn=W.sub(W.sub(te)._mult(j/on)._round());this.updateDistance(te,tn),this.addCurrentVertex(tn,de,0,0,G),te=tn}}const Ht=te&&re;let Gt=Ht?g:M?"butt":v;if(Ht&&Gt==="round"&&(ht<A?Gt="miter":ht<=2&&(Gt="fakeround")),Gt==="miter"&&ht>E&&(Gt="bevel"),Gt==="bevel"&&(ht>2&&(Gt="flipbevel"),ht<E&&(Gt="miter")),te&&this.updateDistance(te,W),Gt==="miter")nt._mult(ht),this.addCurrentVertex(W,nt,0,0,G);else if(Gt==="flipbevel"){if(ht>100)nt=Ce.mult(-1);else{const on=ht*de.add(Ce).mag()/de.sub(Ce).mag();nt._perp()._mult(on*(_n?-1:1))}this.addCurrentVertex(W,nt,0,0,G),this.addCurrentVertex(W,nt.mult(-1),0,0,G)}else if(Gt==="bevel"||Gt==="fakeround"){const on=-Math.sqrt(ht*ht-1),tn=_n?on:0,Yt=_n?0:on;if(te&&this.addCurrentVertex(W,de,tn,Yt,G),Gt==="fakeround"){const yt=Math.round(180*Et/Math.PI/20);for(let cn=1;cn<yt;cn++){let sn=cn/yt;if(sn!==.5){const bi=sn-.5;sn+=sn*bi*(sn-1)*((1.0904+Ge*(Ge*(3.55645-1.43519*Ge)-3.2452))*bi*bi+(.848013+Ge*(.215638*Ge-1.06021)))}const kn=Ce.sub(de)._mult(sn)._add(de)._unit()._mult(_n?-1:1);this.addHalfVertex(W,kn.x,kn.y,!1,_n,0,G)}}re&&this.addCurrentVertex(W,Ce,-tn,-Yt,G)}else if(Gt==="butt")this.addCurrentVertex(W,nt,0,0,G);else if(Gt==="square"){const on=te?1:-1;this.addCurrentVertex(W,nt,on,on,G)}else Gt==="round"&&(te&&(this.addCurrentVertex(W,de,0,0,G),this.addCurrentVertex(W,de,1,1,G,!0)),re&&(this.addCurrentVertex(W,Ce,-1,-1,G,!0),this.addCurrentVertex(W,Ce,0,0,G)));if(Wt&&De<P-1){const on=W.dist(re);if(on>2*j){const tn=W.add(re.sub(W)._mult(j/on)._round());this.updateDistance(W,tn),this.addCurrentVertex(tn,Ce,0,0,G),W=tn}}}}addCurrentVertex(i,u,g,v,E,A=!1){const M=u.y*v-u.x,P=-u.y-u.x*v;this.addHalfVertex(i,u.x+u.y*g,u.y-u.x*g,A,!1,g,E),this.addHalfVertex(i,M,P,A,!0,-v,E),this.distance>Dm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,u,g,v,E,A))}addHalfVertex({x:i,y:u},g,v,E,A,M,P){const F=.5*(this.lineClips?this.scaledDistance*(Dm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(E?1:0),(u<<1)+(A?1:0),Math.round(63*g)+128,Math.round(63*v)+128,1+(M===0?0:M<0?-1:1)|(63&F)<<2,F>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const j=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,j),P.primitiveLength++),A?this.e2=j:this.e1=j}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,u){this.distance+=i.dist(u),this.updateScaledDistance()}}let Nm,zm;Qt("LineBucket",Cd,{omit:["layers","patternFeatures"]});var Fm={get paint(){return zm=zm||new k({"line-opacity":new yn(Ke.paint_line["line-opacity"]),"line-color":new yn(Ke.paint_line["line-color"]),"line-translate":new nn(Ke.paint_line["line-translate"]),"line-translate-anchor":new nn(Ke.paint_line["line-translate-anchor"]),"line-width":new yn(Ke.paint_line["line-width"]),"line-gap-width":new yn(Ke.paint_line["line-gap-width"]),"line-offset":new yn(Ke.paint_line["line-offset"]),"line-blur":new yn(Ke.paint_line["line-blur"]),"line-dasharray":new Iu(Ke.paint_line["line-dasharray"]),"line-pattern":new ku(Ke.paint_line["line-pattern"]),"line-gradient":new qc(Ke.paint_line["line-gradient"])})},get layout(){return Nm=Nm||new k({"line-cap":new nn(Ke.layout_line["line-cap"]),"line-join":new yn(Ke.layout_line["line-join"]),"line-miter-limit":new nn(Ke.layout_line["line-miter-limit"]),"line-round-limit":new nn(Ke.layout_line["line-round-limit"]),"line-sort-key":new yn(Ke.layout_line["line-sort-key"])})}};class $1 extends yn{possiblyEvaluate(i,u){return u=new Ei(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(i,u)}evaluate(i,u,g,v){return u=ce({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(i,u,g,v)}}let rf;class Y1 extends f{constructor(i){super(i,Fm),this.gradientVersion=0,rf||(rf=new $1(Fm.paint.properties["line-width"].specification),rf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!function(g){return g._styleExpression!==void 0}(u)&&u._styleExpression.expression instanceof Fo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,u){super.recalculate(i,u),this.paint._values["line-floorwidth"]=rf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Cd(i)}queryRadius(i){const u=i,g=Om(Zc("line-width",this,u),Zc("line-gap-width",this,u)),v=Zc("line-offset",this,u);return g/2+Math.abs(v)+Yh(this.paint.get("line-translate"))}queryIntersectsFeature(i,u,g,v,E,A,M){const P=Jh(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),A.angle,M),F=M/2*Om(this.paint.get("line-width").evaluate(u,g),this.paint.get("line-gap-width").evaluate(u,g)),j=this.paint.get("line-offset").evaluate(u,g);return j&&(v=function(G,W){const te=[];for(let re=0;re<G.length;re++){const de=G[re],Ce=[];for(let De=0;De<de.length;De++){const nt=de[De-1],Ge=de[De],Qe=de[De+1],ht=De===0?new C(0,0):Ge.sub(nt)._unit()._perp(),Et=De===de.length-1?new C(0,0):Qe.sub(Ge)._unit()._perp(),Wt=ht._add(Et)._unit(),_n=Wt.x*Et.x+Wt.y*Et.y;_n!==0&&Wt._mult(1/_n),Ce.push(Wt._mult(W)._add(Ge))}te.push(Ce)}return te}(v,j*M)),function(G,W,te){for(let re=0;re<W.length;re++){const de=W[re];if(G.length>=3){for(let Ce=0;Ce<de.length;Ce++)if(Mu(G,de[Ce]))return!0}if(o1(G,de,te))return!0}return!1}(P,v,F)}isTileClipped(){return!0}}function Om(o,i){return i>0?i+2*o:o}const J1=R([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Q1=R([{name:"a_projected_pos",components:3,type:"Float32"}],4);R([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const eb=R([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);R([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Bm=R([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),tb=R([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function nb(o,i,u){return o.sections.forEach(g=>{g.text=function(v,E,A){const M=E.layout.get("text-transform").evaluate(A,{});return M==="uppercase"?v=v.toLocaleUpperCase():M==="lowercase"&&(v=v.toLocaleLowerCase()),Is.applyArabicShaping&&(v=Is.applyArabicShaping(v)),v}(g.text,i,u)}),o}R([{name:"triangle",components:3,type:"Uint16"}]),R([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),R([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),R([{type:"Float32",name:"offsetX"}]),R([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),R([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Qc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var pr=24,Um=_i,jm=function(o,i,u,g,v){var E,A,M=8*v-g-1,P=(1<<M)-1,F=P>>1,j=-7,G=u?v-1:0,W=u?-1:1,te=o[i+G];for(G+=W,E=te&(1<<-j)-1,te>>=-j,j+=M;j>0;E=256*E+o[i+G],G+=W,j-=8);for(A=E&(1<<-j)-1,E>>=-j,j+=g;j>0;A=256*A+o[i+G],G+=W,j-=8);if(E===0)E=1-F;else{if(E===P)return A?NaN:1/0*(te?-1:1);A+=Math.pow(2,g),E-=F}return(te?-1:1)*A*Math.pow(2,E-g)},qm=function(o,i,u,g,v,E){var A,M,P,F=8*E-v-1,j=(1<<F)-1,G=j>>1,W=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,te=g?0:E-1,re=g?1:-1,de=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(M=isNaN(i)?1:0,A=j):(A=Math.floor(Math.log(i)/Math.LN2),i*(P=Math.pow(2,-A))<1&&(A--,P*=2),(i+=A+G>=1?W/P:W*Math.pow(2,1-G))*P>=2&&(A++,P/=2),A+G>=j?(M=0,A=j):A+G>=1?(M=(i*P-1)*Math.pow(2,v),A+=G):(M=i*Math.pow(2,G-1)*Math.pow(2,v),A=0));v>=8;o[u+te]=255&M,te+=re,M/=256,v-=8);for(A=A<<v|M,F+=v;F>0;o[u+te]=255&A,te+=re,A/=256,F-=8);o[u+te-re]|=128*de};function _i(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}_i.Varint=0,_i.Fixed64=1,_i.Bytes=2,_i.Fixed32=5;var Ld=4294967296,Vm=1/Ld,Gm=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Ea(o){return o.type===_i.Bytes?o.readVarint()+o.pos:o.pos+1}function Nu(o,i,u){return u?4294967296*i+(o>>>0):4294967296*(i>>>0)+(o>>>0)}function Zm(o,i,u){var g=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));u.realloc(g);for(var v=u.pos-1;v>=o;v--)u.buf[v+g]=u.buf[v]}function ib(o,i){for(var u=0;u<o.length;u++)i.writeVarint(o[u])}function rb(o,i){for(var u=0;u<o.length;u++)i.writeSVarint(o[u])}function sb(o,i){for(var u=0;u<o.length;u++)i.writeFloat(o[u])}function ob(o,i){for(var u=0;u<o.length;u++)i.writeDouble(o[u])}function ab(o,i){for(var u=0;u<o.length;u++)i.writeBoolean(o[u])}function lb(o,i){for(var u=0;u<o.length;u++)i.writeFixed32(o[u])}function ub(o,i){for(var u=0;u<o.length;u++)i.writeSFixed32(o[u])}function cb(o,i){for(var u=0;u<o.length;u++)i.writeFixed64(o[u])}function hb(o,i){for(var u=0;u<o.length;u++)i.writeSFixed64(o[u])}function sf(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+16777216*o[i+3]}function zu(o,i,u){o[u]=i,o[u+1]=i>>>8,o[u+2]=i>>>16,o[u+3]=i>>>24}function Hm(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+(o[i+3]<<24)}_i.prototype={destroy:function(){this.buf=null},readFields:function(o,i,u){for(u=u||this.length;this.pos<u;){var g=this.readVarint(),v=g>>3,E=this.pos;this.type=7&g,o(v,i,this),this.pos===E&&this.skip(g)}return i},readMessage:function(o,i){return this.readFields(o,i,this.readVarint()+this.pos)},readFixed32:function(){var o=sf(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=Hm(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=sf(this.buf,this.pos)+sf(this.buf,this.pos+4)*Ld;return this.pos+=8,o},readSFixed64:function(){var o=sf(this.buf,this.pos)+Hm(this.buf,this.pos+4)*Ld;return this.pos+=8,o},readFloat:function(){var o=jm(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=jm(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var i,u,g=this.buf;return i=127&(u=g[this.pos++]),u<128?i:(i|=(127&(u=g[this.pos++]))<<7,u<128?i:(i|=(127&(u=g[this.pos++]))<<14,u<128?i:(i|=(127&(u=g[this.pos++]))<<21,u<128?i:function(v,E,A){var M,P,F=A.buf;if(M=(112&(P=F[A.pos++]))>>4,P<128||(M|=(127&(P=F[A.pos++]))<<3,P<128)||(M|=(127&(P=F[A.pos++]))<<10,P<128)||(M|=(127&(P=F[A.pos++]))<<17,P<128)||(M|=(127&(P=F[A.pos++]))<<24,P<128)||(M|=(1&(P=F[A.pos++]))<<31,P<128))return Nu(v,M,E);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(u=g[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,i=this.pos;return this.pos=o,o-i>=12&&Gm?function(u,g,v){return Gm.decode(u.subarray(g,v))}(this.buf,i,o):function(u,g,v){for(var E="",A=g;A<v;){var M,P,F,j=u[A],G=null,W=j>239?4:j>223?3:j>191?2:1;if(A+W>v)break;W===1?j<128&&(G=j):W===2?(192&(M=u[A+1]))==128&&(G=(31&j)<<6|63&M)<=127&&(G=null):W===3?(P=u[A+2],(192&(M=u[A+1]))==128&&(192&P)==128&&((G=(15&j)<<12|(63&M)<<6|63&P)<=2047||G>=55296&&G<=57343)&&(G=null)):W===4&&(P=u[A+2],F=u[A+3],(192&(M=u[A+1]))==128&&(192&P)==128&&(192&F)==128&&((G=(15&j)<<18|(63&M)<<12|(63&P)<<6|63&F)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,W=1):G>65535&&(G-=65536,E+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),E+=String.fromCharCode(G),A+=W}return E}(this.buf,i,o)},readBytes:function(){var o=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,o);return this.pos=o,i},readPackedVarint:function(o,i){if(this.type!==_i.Bytes)return o.push(this.readVarint(i));var u=Ea(this);for(o=o||[];this.pos<u;)o.push(this.readVarint(i));return o},readPackedSVarint:function(o){if(this.type!==_i.Bytes)return o.push(this.readSVarint());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==_i.Bytes)return o.push(this.readBoolean());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==_i.Bytes)return o.push(this.readFloat());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==_i.Bytes)return o.push(this.readDouble());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==_i.Bytes)return o.push(this.readFixed32());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==_i.Bytes)return o.push(this.readSFixed32());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==_i.Bytes)return o.push(this.readFixed64());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==_i.Bytes)return o.push(this.readSFixed64());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed64());return o},skip:function(o){var i=7&o;if(i===_i.Varint)for(;this.buf[this.pos++]>127;);else if(i===_i.Bytes)this.pos=this.readVarint()+this.pos;else if(i===_i.Fixed32)this.pos+=4;else{if(i!==_i.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(o,i){this.writeVarint(o<<3|i)},realloc:function(o){for(var i=this.length||16;i<this.pos+o;)i*=2;if(i!==this.length){var u=new Uint8Array(i);u.set(this.buf),this.buf=u,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),zu(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),zu(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),zu(this.buf,-1&o,this.pos),zu(this.buf,Math.floor(o*Vm),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),zu(this.buf,-1&o,this.pos),zu(this.buf,Math.floor(o*Vm),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(i,u){var g,v;if(i>=0?(g=i%4294967296|0,v=i/4294967296|0):(v=~(-i/4294967296),4294967295^(g=~(-i%4294967296))?g=g+1|0:(g=0,v=v+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(E,A,M){M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,E>>>=7,M.buf[M.pos++]=127&E|128,M.buf[M.pos]=127&(E>>>=7)}(g,0,u),function(E,A){var M=(7&E)<<4;A.buf[A.pos++]|=M|((E>>>=3)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E)))))}(v,u)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var i=this.pos;this.pos=function(g,v,E){for(var A,M,P=0;P<v.length;P++){if((A=v.charCodeAt(P))>55295&&A<57344){if(!M){A>56319||P+1===v.length?(g[E++]=239,g[E++]=191,g[E++]=189):M=A;continue}if(A<56320){g[E++]=239,g[E++]=191,g[E++]=189,M=A;continue}A=M-55296<<10|A-56320|65536,M=null}else M&&(g[E++]=239,g[E++]=191,g[E++]=189,M=null);A<128?g[E++]=A:(A<2048?g[E++]=A>>6|192:(A<65536?g[E++]=A>>12|224:(g[E++]=A>>18|240,g[E++]=A>>12&63|128),g[E++]=A>>6&63|128),g[E++]=63&A|128)}return E}(this.buf,o,this.pos);var u=this.pos-i;u>=128&&Zm(i,u,this),this.pos=i-1,this.writeVarint(u),this.pos+=u},writeFloat:function(o){this.realloc(4),qm(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),qm(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var i=o.length;this.writeVarint(i),this.realloc(i);for(var u=0;u<i;u++)this.buf[this.pos++]=o[u]},writeRawMessage:function(o,i){this.pos++;var u=this.pos;o(i,this);var g=this.pos-u;g>=128&&Zm(u,g,this),this.pos=u-1,this.writeVarint(g),this.pos+=g},writeMessage:function(o,i,u){this.writeTag(o,_i.Bytes),this.writeRawMessage(i,u)},writePackedVarint:function(o,i){i.length&&this.writeMessage(o,ib,i)},writePackedSVarint:function(o,i){i.length&&this.writeMessage(o,rb,i)},writePackedBoolean:function(o,i){i.length&&this.writeMessage(o,ab,i)},writePackedFloat:function(o,i){i.length&&this.writeMessage(o,sb,i)},writePackedDouble:function(o,i){i.length&&this.writeMessage(o,ob,i)},writePackedFixed32:function(o,i){i.length&&this.writeMessage(o,lb,i)},writePackedSFixed32:function(o,i){i.length&&this.writeMessage(o,ub,i)},writePackedFixed64:function(o,i){i.length&&this.writeMessage(o,cb,i)},writePackedSFixed64:function(o,i){i.length&&this.writeMessage(o,hb,i)},writeBytesField:function(o,i){this.writeTag(o,_i.Bytes),this.writeBytes(i)},writeFixed32Field:function(o,i){this.writeTag(o,_i.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(o,i){this.writeTag(o,_i.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(o,i){this.writeTag(o,_i.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(o,i){this.writeTag(o,_i.Fixed64),this.writeSFixed64(i)},writeVarintField:function(o,i){this.writeTag(o,_i.Varint),this.writeVarint(i)},writeSVarintField:function(o,i){this.writeTag(o,_i.Varint),this.writeSVarint(i)},writeStringField:function(o,i){this.writeTag(o,_i.Bytes),this.writeString(i)},writeFloatField:function(o,i){this.writeTag(o,_i.Fixed32),this.writeFloat(i)},writeDoubleField:function(o,i){this.writeTag(o,_i.Fixed64),this.writeDouble(i)},writeBooleanField:function(o,i){this.writeVarintField(o,!!i)}};var Md=x(Um);const Rd=3;function fb(o,i,u){o===1&&u.readMessage(db,i)}function db(o,i,u){if(o===3){const{id:g,bitmap:v,width:E,height:A,left:M,top:P,advance:F}=u.readMessage(pb,{});i.push({id:g,bitmap:new Xc({width:E+2*Rd,height:A+2*Rd},v),metrics:{width:E,height:A,left:M,top:P,advance:F}})}}function pb(o,i,u){o===1?i.id=u.readVarint():o===2?i.bitmap=u.readBytes():o===3?i.width=u.readVarint():o===4?i.height=u.readVarint():o===5?i.left=u.readSVarint():o===6?i.top=u.readSVarint():o===7&&(i.advance=u.readVarint())}const Xm=Rd;function Wm(o){let i=0,u=0;for(const A of o)i+=A.w*A.h,u=Math.max(u,A.w);o.sort((A,M)=>M.h-A.h);const g=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),u),h:1/0}];let v=0,E=0;for(const A of o)for(let M=g.length-1;M>=0;M--){const P=g[M];if(!(A.w>P.w||A.h>P.h)){if(A.x=P.x,A.y=P.y,E=Math.max(E,A.y+A.h),v=Math.max(v,A.x+A.w),A.w===P.w&&A.h===P.h){const F=g.pop();M<g.length&&(g[M]=F)}else A.h===P.h?(P.x+=A.w,P.w-=A.w):A.w===P.w?(P.y+=A.h,P.h-=A.h):(g.push({x:P.x+A.w,y:P.y,w:P.w-A.w,h:A.h}),P.y+=A.h,P.h-=A.h);break}}return{w:v,h:E,fill:i/(v*E)||0}}const Es=1;class Pd{constructor(i,{pixelRatio:u,version:g,stretchX:v,stretchY:E,content:A,textFitWidth:M,textFitHeight:P}){this.paddedRect=i,this.pixelRatio=u,this.stretchX=v,this.stretchY=E,this.content=A,this.version=g,this.textFitWidth=M,this.textFitHeight=P}get tl(){return[this.paddedRect.x+Es,this.paddedRect.y+Es]}get br(){return[this.paddedRect.x+this.paddedRect.w-Es,this.paddedRect.y+this.paddedRect.h-Es]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Es)/this.pixelRatio,(this.paddedRect.h-2*Es)/this.pixelRatio]}}class Km{constructor(i,u){const g={},v={};this.haveRenderCallbacks=[];const E=[];this.addImages(i,g,E),this.addImages(u,v,E);const{w:A,h:M}=Wm(E),P=new Ws({width:A||1,height:M||1});for(const F in i){const j=i[F],G=g[F].paddedRect;Ws.copy(j.data,P,{x:0,y:0},{x:G.x+Es,y:G.y+Es},j.data)}for(const F in u){const j=u[F],G=v[F].paddedRect,W=G.x+Es,te=G.y+Es,re=j.data.width,de=j.data.height;Ws.copy(j.data,P,{x:0,y:0},{x:W,y:te},j.data),Ws.copy(j.data,P,{x:0,y:de-1},{x:W,y:te-1},{width:re,height:1}),Ws.copy(j.data,P,{x:0,y:0},{x:W,y:te+de},{width:re,height:1}),Ws.copy(j.data,P,{x:re-1,y:0},{x:W-1,y:te},{width:1,height:de}),Ws.copy(j.data,P,{x:0,y:0},{x:W+re,y:te},{width:1,height:de})}this.image=P,this.iconPositions=g,this.patternPositions=v}addImages(i,u,g){for(const v in i){const E=i[v],A={x:0,y:0,w:E.data.width+2*Es,h:E.data.height+2*Es};g.push(A),u[v]=new Pd(A,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(v)}}patchUpdatedImages(i,u){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const g in i.updatedImages)this.patchUpdatedImage(this.iconPositions[g],i.getImage(g),u),this.patchUpdatedImage(this.patternPositions[g],i.getImage(g),u)}patchUpdatedImage(i,u,g){if(!i||!u||i.version===u.version)return;i.version=u.version;const[v,E]=i.tl;g.update(u.data,void 0,{x:v,y:E})}}var ll;Qt("ImagePosition",Pd),Qt("ImageAtlas",Km),m.ah=void 0,(ll=m.ah||(m.ah={}))[ll.none=0]="none",ll[ll.horizontal=1]="horizontal",ll[ll.vertical=2]="vertical",ll[ll.horizontalOnly=3]="horizontalOnly";const eh=-17;class th{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,u){const g=new th;return g.scale=i||1,g.fontStack=u,g}static forImage(i){const u=new th;return u.imageName=i,u}}class Fu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,u){const g=new Fu;for(let v=0;v<i.sections.length;v++){const E=i.sections[v];E.image?g.addImageSection(E):g.addTextSection(E,u)}return g}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let u="";for(let g=0;g<i.length;g++){const v=i.charCodeAt(g+1)||null,E=i.charCodeAt(g-1)||null;u+=v&&Gh(v)&&!Qc[i[g+1]]||E&&Gh(E)&&!Qc[i[g-1]]||!Qc[i[g]]?i[g]:Qc[i[g]]}return u}(this.text)}trim(){let i=0;for(let g=0;g<this.text.length&&af[this.text.charCodeAt(g)];g++)i++;let u=this.text.length;for(let g=this.text.length-1;g>=0&&g>=i&&af[this.text.charCodeAt(g)];g--)u--;this.text=this.text.substring(i,u),this.sectionIndex=this.sectionIndex.slice(i,u)}substring(i,u){const g=new Fu;return g.text=this.text.substring(i,u),g.sectionIndex=this.sectionIndex.slice(i,u),g.sections=this.sections,g}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,u)=>Math.max(i,this.sections[u].scale),0)}addTextSection(i,u){this.text+=i.text,this.sections.push(th.forText(i.scale,i.fontStack||u));const g=this.sections.length-1;for(let v=0;v<i.text.length;++v)this.sectionIndex.push(g)}addImageSection(i){const u=i.image?i.image.name:"";if(u.length===0)return void Ue("Can't add FormattedSection with an empty image.");const g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCharCode(g),this.sections.push(th.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Ue("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function of(o,i,u,g,v,E,A,M,P,F,j,G,W,te,re){const de=Fu.fromFeature(o,v);let Ce;G===m.ah.vertical&&de.verticalizePunctuation();const{processBidirectionalText:De,processStyledBidirectionalText:nt}=Is;if(De&&de.sections.length===1){Ce=[];const ht=De(de.toString(),Dd(de,F,E,i,g,te));for(const Et of ht){const Wt=new Fu;Wt.text=Et,Wt.sections=de.sections;for(let _n=0;_n<Et.length;_n++)Wt.sectionIndex.push(0);Ce.push(Wt)}}else if(nt){Ce=[];const ht=nt(de.text,de.sectionIndex,Dd(de,F,E,i,g,te));for(const Et of ht){const Wt=new Fu;Wt.text=Et[0],Wt.sectionIndex=Et[1],Wt.sections=de.sections,Ce.push(Wt)}}else Ce=function(ht,Et){const Wt=[],_n=ht.text;let Ht=0;for(const Gt of Et)Wt.push(ht.substring(Ht,Gt)),Ht=Gt;return Ht<_n.length&&Wt.push(ht.substring(Ht,_n.length)),Wt}(de,Dd(de,F,E,i,g,te));const Ge=[],Qe={positionedLines:Ge,text:de.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:G,iconsInText:!1,verticalizable:!1};return function(ht,Et,Wt,_n,Ht,Gt,on,tn,Yt,yt,cn,sn){let kn=0,bi=eh,yi=0,xr=0;const fo=tn==="right"?1:tn==="left"?0:.5;let Ur=0;for(const Ki of Ht){Ki.trim();const kr=Ki.getMaxScale(),Kr=(kr-1)*pr,jr={positionedGlyphs:[],lineOffset:0};ht.positionedLines[Ur]=jr;const hs=jr.positionedGlyphs;let qr=0;if(!Ki.length()){bi+=Gt,++Ur;continue}for(let As=0;As<Ki.length();As++){const ai=Ki.getSection(As),wi=Ki.getSectionIndex(As),Li=Ki.getCharCode(As);let Bs=0,qi=null,ju=null,na=null,ia=pr;const po=!(Yt===m.ah.horizontal||!cn&&!Uc(Li)||cn&&(af[Li]||(wr=Li,/\p{sc=Arab}/u.test(String.fromCodePoint(wr)))));if(ai.imageName){const Ys=_n[ai.imageName];if(!Ys)continue;na=ai.imageName,ht.iconsInText=ht.iconsInText||!0,ju=Ys.paddedRect;const Dr=Ys.displaySize;ai.scale=ai.scale*pr/sn,qi={width:Dr[0],height:Dr[1],left:Es,top:-Xm,advance:po?Dr[1]:Dr[0]},Bs=Kr+(pr-Dr[1]*ai.scale),ia=qi.advance;const Aa=po?Dr[0]*ai.scale-pr*kr:Dr[1]*ai.scale-pr*kr;Aa>0&&Aa>qr&&(qr=Aa)}else{const Ys=Wt[ai.fontStack],Dr=Ys&&Ys[Li];if(Dr&&Dr.rect)ju=Dr.rect,qi=Dr.metrics;else{const Aa=Et[ai.fontStack],ah=Aa&&Aa[Li];if(!ah)continue;qi=ah.metrics}Bs=(kr-ai.scale)*pr}po?(ht.verticalizable=!0,hs.push({glyph:Li,imageName:na,x:kn,y:bi+Bs,vertical:po,scale:ai.scale,fontStack:ai.fontStack,sectionIndex:wi,metrics:qi,rect:ju}),kn+=ia*ai.scale+yt):(hs.push({glyph:Li,imageName:na,x:kn,y:bi+Bs,vertical:po,scale:ai.scale,fontStack:ai.fontStack,sectionIndex:wi,metrics:qi,rect:ju}),kn+=qi.advance*ai.scale+yt)}hs.length!==0&&(yi=Math.max(kn-yt,yi),yb(hs,0,hs.length-1,fo,qr)),kn=0;const $s=Gt*kr+qr;jr.lineOffset=Math.max(qr,Kr),bi+=$s,xr=Math.max($s,xr),++Ur}var wr;const ls=bi-eh,{horizontalAlign:us,verticalAlign:cs}=Nd(on);(function(Ki,kr,Kr,jr,hs,qr,$s,As,ai){const wi=(kr-Kr)*hs;let Li=0;Li=qr!==$s?-As*jr-eh:(-jr*ai+.5)*$s;for(const Bs of Ki)for(const qi of Bs.positionedGlyphs)qi.x+=wi,qi.y+=Li})(ht.positionedLines,fo,us,cs,yi,xr,Gt,ls,Ht.length),ht.top+=-cs*ls,ht.bottom=ht.top+ls,ht.left+=-us*yi,ht.right=ht.left+yi}(Qe,i,u,g,Ce,A,M,P,G,F,W,re),!function(ht){for(const Et of ht)if(Et.positionedGlyphs.length!==0)return!1;return!0}(Ge)&&Qe}const af={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},mb={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},gb={40:!0};function $m(o,i,u,g,v,E){if(i.imageName){const A=g[i.imageName];return A?A.displaySize[0]*i.scale*pr/E+v:0}{const A=u[i.fontStack],M=A&&A[o];return M?M.metrics.advance*i.scale+v:0}}function Ym(o,i,u,g){const v=Math.pow(o-i,2);return g?o<i?v/2:2*v:v+Math.abs(u)*u}function _b(o,i,u){let g=0;return o===10&&(g-=1e4),u&&(g+=150),o!==40&&o!==65288||(g+=50),i!==41&&i!==65289||(g+=50),g}function Jm(o,i,u,g,v,E){let A=null,M=Ym(i,u,v,E);for(const P of g){const F=Ym(i-P.x,u,v,E)+P.badness;F<=M&&(A=P,M=F)}return{index:o,x:i,priorBreak:A,badness:M}}function Qm(o){return o?Qm(o.priorBreak).concat(o.index):[]}function Dd(o,i,u,g,v,E){if(!o)return[];const A=[],M=function(G,W,te,re,de,Ce){let De=0;for(let nt=0;nt<G.length();nt++){const Ge=G.getSection(nt);De+=$m(G.getCharCode(nt),Ge,re,de,W,Ce)}return De/Math.max(1,Math.ceil(De/te))}(o,i,u,g,v,E),P=o.text.indexOf("​")>=0;let F=0;for(let G=0;G<o.length();G++){const W=o.getSection(G),te=o.getCharCode(G);if(af[te]||(F+=$m(te,W,g,v,i,E)),G<o.length()-1){const re=!((j=te)<11904)&&(!!Zn["CJK Compatibility Forms"](j)||!!Zn["CJK Compatibility"](j)||!!Zn["CJK Strokes"](j)||!!Zn["CJK Symbols and Punctuation"](j)||!!Zn["Enclosed CJK Letters and Months"](j)||!!Zn["Halfwidth and Fullwidth Forms"](j)||!!Zn["Ideographic Description Characters"](j)||!!Zn["Vertical Forms"](j)||Vh.test(String.fromCodePoint(j)));(mb[te]||re||W.imageName||G!==o.length()-2&&gb[o.getCharCode(G+1)])&&A.push(Jm(G+1,F,M,A,_b(te,o.getCharCode(G+1),re&&P),!1))}}var j;return Qm(Jm(o.length(),F,M,A,0,!0))}function Nd(o){let i=.5,u=.5;switch(o){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:i,verticalAlign:u}}function yb(o,i,u,g,v){if(!g&&!v)return;const E=o[u],A=(o[u].x+E.metrics.advance*E.scale)*g;for(let M=i;M<=u;M++)o[M].x-=A,o[M].y+=v}function vb(o,i,u){const{horizontalAlign:g,verticalAlign:v}=Nd(u),E=i[0]-o.displaySize[0]*g,A=i[1]-o.displaySize[1]*v;return{image:o,top:A,bottom:A+o.displaySize[1],left:E,right:E+o.displaySize[0]}}function eg(o){var i,u;let g=o.left,v=o.top,E=o.right-g,A=o.bottom-v;const M=(i=o.image.textFitWidth)!==null&&i!==void 0?i:"stretchOrShrink",P=(u=o.image.textFitHeight)!==null&&u!==void 0?u:"stretchOrShrink",F=(o.image.content[2]-o.image.content[0])/(o.image.content[3]-o.image.content[1]);if(P==="proportional"){if(M==="stretchOnly"&&E/A<F||M==="proportional"){const j=Math.ceil(A*F);g*=j/E,E=j}}else if(M==="proportional"&&P==="stretchOnly"&&F!==0&&E/A>F){const j=Math.ceil(E/F);v*=j/A,A=j}return{x1:g,y1:v,x2:g+E,y2:v+A}}function tg(o,i,u,g,v,E){const A=o.image;let M;if(A.content){const Ce=A.content,De=A.pixelRatio||1;M=[Ce[0]/De,Ce[1]/De,A.displaySize[0]-Ce[2]/De,A.displaySize[1]-Ce[3]/De]}const P=i.left*E,F=i.right*E;let j,G,W,te;u==="width"||u==="both"?(te=v[0]+P-g[3],G=v[0]+F+g[1]):(te=v[0]+(P+F-A.displaySize[0])/2,G=te+A.displaySize[0]);const re=i.top*E,de=i.bottom*E;return u==="height"||u==="both"?(j=v[1]+re-g[0],W=v[1]+de+g[2]):(j=v[1]+(re+de-A.displaySize[1])/2,W=j+A.displaySize[1]),{image:A,top:j,right:G,bottom:W,left:te,collisionPadding:M}}const nh=255,ta=128,ul=nh*ta;function ng(o,i){const{expression:u}=i;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Ei(o+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:g,interpolationType:v}=u;let E=0;for(;E<g.length&&g[E]<=o;)E++;E=Math.max(0,E-1);let A=E;for(;A<g.length&&g[A]<o+1;)A++;A=Math.min(g.length-1,A);const M=g[E],P=g[A];return u.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:P,interpolationType:v}:{kind:"camera",minZoom:M,maxZoom:P,minSize:u.evaluate(new Ei(M)),maxSize:u.evaluate(new Ei(P)),interpolationType:v}}}function zd(o,i,u){let g="never";const v=o.get(i);return v?g=v:o.get(u)&&(g="always"),g}const bb=al.VectorTileFeature.types,xb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function lf(o,i,u,g,v,E,A,M,P,F,j,G,W){const te=M?Math.min(ul,Math.round(M[0])):0,re=M?Math.min(ul,Math.round(M[1])):0;o.emplaceBack(i,u,Math.round(32*g),Math.round(32*v),E,A,(te<<1)+(P?1:0),re,16*F,16*j,256*G,256*W)}function Fd(o,i,u){o.emplaceBack(i.x,i.y,u),o.emplaceBack(i.x,i.y,u),o.emplaceBack(i.x,i.y,u),o.emplaceBack(i.x,i.y,u)}function wb(o){for(const i of o.sections)if(hd(i.text))return!0;return!1}class Od{constructor(i){this.layoutVertexArray=new Eu,this.indexArray=new Xs,this.programConfigurations=i,this.segments=new Hn,this.dynamicLayoutVertexArray=new Vc,this.opacityVertexArray=new Fs,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ai}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,u,g,v){this.isEmpty()||(g&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,J1.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,Q1.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,xb,!0),this.opacityVertexBuffer.itemSize=1),(g||v)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Qt("SymbolBuffers",Od);class Bd{constructor(i,u,g){this.layoutVertexArray=new i,this.layoutAttributes=u,this.indexArray=new g,this.segments=new Hn,this.collisionVertexArray=new Qo}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,eb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Qt("CollisionBuffers",Bd);class Ou{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(A=>A.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=yd([]),this.placementViewportMatrix=yd([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ng(this.zoom,u["text-size"]),this.iconSizeData=ng(this.zoom,u["icon-size"]);const g=this.layers[0].layout,v=g.get("symbol-sort-key"),E=g.get("symbol-z-order");this.canOverlap=zd(g,"text-overlap","text-allow-overlap")!=="never"||zd(g,"icon-overlap","icon-allow-overlap")!=="never"||g.get("text-ignore-placement")||g.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&!v.isConstant(),this.sortFeaturesByY=(E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,g.get("symbol-placement")==="point"&&(this.writingModes=g.get("text-writing-mode").map(A=>m.ah[A])),this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id),this.sourceID=i.sourceID}createArrays(){this.text=new Od(new Xl(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Od(new Xl(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new Ti,this.lineVertexArray=new zr,this.symbolInstances=new qn,this.textAnchorOffsets=new Ci}calculateGlyphDependencies(i,u,g,v,E){for(let A=0;A<i.length;A++)if(u[i.charCodeAt(A)]=!0,(g||v)&&E){const M=Qc[i.charAt(A)];M&&(u[M.charCodeAt(0)]=!0)}}populate(i,u,g){const v=this.layers[0],E=v.layout,A=E.get("text-font"),M=E.get("text-field"),P=E.get("icon-image"),F=(M.value.kind!=="constant"||M.value.value instanceof Cr&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),j=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,G=E.get("symbol-sort-key");if(this.features=[],!F&&!j)return;const W=u.iconDependencies,te=u.glyphDependencies,re=u.availableImages,de=new Ei(this.zoom);for(const{feature:Ce,id:De,index:nt,sourceLayerIndex:Ge}of i){const Qe=v._featureFilter.needGeometry,ht=Kl(Ce,Qe);if(!v._featureFilter.filter(de,ht,g))continue;let Et,Wt;if(Qe||(ht.geometry=Wl(Ce)),F){const Ht=v.getValueAndResolveTokens("text-field",ht,g,re),Gt=Cr.factory(Ht),on=this.hasRTLText=this.hasRTLText||wb(Gt);(!on||Is.getRTLTextPluginStatus()==="unavailable"||on&&Is.isParsed())&&(Et=nb(Gt,v,ht))}if(j){const Ht=v.getValueAndResolveTokens("icon-image",ht,g,re);Wt=Ht instanceof or?Ht:or.fromString(Ht)}if(!Et&&!Wt)continue;const _n=this.sortFeaturesByKey?G.evaluate(ht,{},g):void 0;if(this.features.push({id:De,text:Et,icon:Wt,index:nt,sourceLayerIndex:Ge,geometry:ht.geometry,properties:Ce.properties,type:bb[Ce.type],sortKey:_n}),Wt&&(W[Wt.name]=!0),Et){const Ht=A.evaluate(ht,{},g).join(","),Gt=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(m.ah.vertical)>=0;for(const on of Et.sections)if(on.image)W[on.image.name]=!0;else{const tn=Oc(Et.toString()),Yt=on.fontStack||Ht,yt=te[Yt]=te[Yt]||{};this.calculateGlyphDependencies(on.text,yt,Gt,this.allowVerticalPlacement,tn)}}}E.get("symbol-placement")==="line"&&(this.features=function(Ce){const De={},nt={},Ge=[];let Qe=0;function ht(Ht){Ge.push(Ce[Ht]),Qe++}function Et(Ht,Gt,on){const tn=nt[Ht];return delete nt[Ht],nt[Gt]=tn,Ge[tn].geometry[0].pop(),Ge[tn].geometry[0]=Ge[tn].geometry[0].concat(on[0]),tn}function Wt(Ht,Gt,on){const tn=De[Gt];return delete De[Gt],De[Ht]=tn,Ge[tn].geometry[0].shift(),Ge[tn].geometry[0]=on[0].concat(Ge[tn].geometry[0]),tn}function _n(Ht,Gt,on){const tn=on?Gt[0][Gt[0].length-1]:Gt[0][0];return`${Ht}:${tn.x}:${tn.y}`}for(let Ht=0;Ht<Ce.length;Ht++){const Gt=Ce[Ht],on=Gt.geometry,tn=Gt.text?Gt.text.toString():null;if(!tn){ht(Ht);continue}const Yt=_n(tn,on),yt=_n(tn,on,!0);if(Yt in nt&&yt in De&&nt[Yt]!==De[yt]){const cn=Wt(Yt,yt,on),sn=Et(Yt,yt,Ge[cn].geometry);delete De[Yt],delete nt[yt],nt[_n(tn,Ge[sn].geometry,!0)]=sn,Ge[cn].geometry=null}else Yt in nt?Et(Yt,yt,on):yt in De?Wt(Yt,yt,on):(ht(Ht),De[Yt]=Qe-1,nt[yt]=Qe-1)}return Ge.filter(Ht=>Ht.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ce,De)=>Ce.sortKey-De.sortKey)}update(i,u,g){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,u,this.layers,g),this.icon.programConfigurations.updatePaintArrays(i,u,this.layers,g))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,u){const g=this.lineVertexArray.length;if(i.segment!==void 0){let v=i.dist(u[i.segment+1]),E=i.dist(u[i.segment]);const A={};for(let M=i.segment+1;M<u.length;M++)A[M]={x:u[M].x,y:u[M].y,tileUnitDistanceFromAnchor:v},M<u.length-1&&(v+=u[M+1].dist(u[M]));for(let M=i.segment||0;M>=0;M--)A[M]={x:u[M].x,y:u[M].y,tileUnitDistanceFromAnchor:E},M>0&&(E+=u[M-1].dist(u[M]));for(let M=0;M<u.length;M++){const P=A[M];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:g,lineLength:this.lineVertexArray.length-g}}addSymbols(i,u,g,v,E,A,M,P,F,j,G,W){const te=i.indexArray,re=i.layoutVertexArray,de=i.segments.prepareSegment(4*u.length,re,te,this.canOverlap?A.sortKey:void 0),Ce=this.glyphOffsetArray.length,De=de.vertexLength,nt=this.allowVerticalPlacement&&M===m.ah.vertical?Math.PI/2:0,Ge=A.text&&A.text.sections;for(let Qe=0;Qe<u.length;Qe++){const{tl:ht,tr:Et,bl:Wt,br:_n,tex:Ht,pixelOffsetTL:Gt,pixelOffsetBR:on,minFontScaleX:tn,minFontScaleY:Yt,glyphOffset:yt,isSDF:cn,sectionIndex:sn}=u[Qe],kn=de.vertexLength,bi=yt[1];lf(re,P.x,P.y,ht.x,bi+ht.y,Ht.x,Ht.y,g,cn,Gt.x,Gt.y,tn,Yt),lf(re,P.x,P.y,Et.x,bi+Et.y,Ht.x+Ht.w,Ht.y,g,cn,on.x,Gt.y,tn,Yt),lf(re,P.x,P.y,Wt.x,bi+Wt.y,Ht.x,Ht.y+Ht.h,g,cn,Gt.x,on.y,tn,Yt),lf(re,P.x,P.y,_n.x,bi+_n.y,Ht.x+Ht.w,Ht.y+Ht.h,g,cn,on.x,on.y,tn,Yt),Fd(i.dynamicLayoutVertexArray,P,nt),te.emplaceBack(kn,kn+1,kn+2),te.emplaceBack(kn+1,kn+2,kn+3),de.vertexLength+=4,de.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(yt[0]),Qe!==u.length-1&&sn===u[Qe+1].sectionIndex||i.programConfigurations.populatePaintArrays(re.length,A,A.index,{},W,Ge&&Ge[sn])}i.placedSymbolArray.emplaceBack(P.x,P.y,Ce,this.glyphOffsetArray.length-Ce,De,F,j,P.segment,g?g[0]:0,g?g[1]:0,v[0],v[1],M,0,!1,0,G)}_addCollisionDebugVertex(i,u,g,v,E,A){return u.emplaceBack(0,0),i.emplaceBack(g.x,g.y,v,E,Math.round(A.x),Math.round(A.y))}addCollisionDebugVertices(i,u,g,v,E,A,M){const P=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),F=P.vertexLength,j=E.layoutVertexArray,G=E.collisionVertexArray,W=M.anchorX,te=M.anchorY;this._addCollisionDebugVertex(j,G,A,W,te,new C(i,u)),this._addCollisionDebugVertex(j,G,A,W,te,new C(g,u)),this._addCollisionDebugVertex(j,G,A,W,te,new C(g,v)),this._addCollisionDebugVertex(j,G,A,W,te,new C(i,v)),P.vertexLength+=4;const re=E.indexArray;re.emplaceBack(F,F+1),re.emplaceBack(F+1,F+2),re.emplaceBack(F+2,F+3),re.emplaceBack(F+3,F),P.primitiveLength+=4}addDebugCollisionBoxes(i,u,g,v){for(let E=i;E<u;E++){const A=this.collisionBoxArray.get(E);this.addCollisionDebugVertices(A.x1,A.y1,A.x2,A.y2,v?this.textCollisionBox:this.iconCollisionBox,A.anchorPoint,g)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Bd(Os,Bm.members,Pr),this.iconCollisionBox=new Bd(Os,Bm.members,Pr);for(let i=0;i<this.symbolInstances.length;i++){const u=this.symbolInstances.get(i);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(i,u,g,v,E,A,M,P,F){const j={};for(let G=u;G<g;G++){const W=i.get(G);j.textBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},j.textFeatureIndex=W.featureIndex;break}for(let G=v;G<E;G++){const W=i.get(G);j.verticalTextBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},j.verticalTextFeatureIndex=W.featureIndex;break}for(let G=A;G<M;G++){const W=i.get(G);j.iconBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},j.iconFeatureIndex=W.featureIndex;break}for(let G=P;G<F;G++){const W=i.get(G);j.verticalIconBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},j.verticalIconFeatureIndex=W.featureIndex;break}return j}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const g=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,g.textBoxStartIndex,g.textBoxEndIndex,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g.iconBoxStartIndex,g.iconBoxEndIndex,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,u){const g=i.placedSymbolArray.get(u),v=g.vertexStartIndex+4*g.numGlyphs;for(let E=g.vertexStartIndex;E<v;E+=4)i.indexArray.emplaceBack(E,E+1,E+2),i.indexArray.emplaceBack(E+1,E+2,E+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(i),g=Math.cos(i),v=[],E=[],A=[];for(let M=0;M<this.symbolInstances.length;++M){A.push(M);const P=this.symbolInstances.get(M);v.push(0|Math.round(u*P.anchorX+g*P.anchorY)),E.push(P.featureIndex)}return A.sort((M,P)=>v[M]-v[P]||E[P]-E[M]),A}addToSortKeyRanges(i,u){const g=this.sortKeyRanges[this.sortKeyRanges.length-1];g&&g.sortKey===u?g.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const g=this.symbolInstances.get(u);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach((v,E,A)=>{v>=0&&A.indexOf(v)===E&&this.addIndicesForPlacedSymbol(this.text,v)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ig,rg;Qt("SymbolBucket",Ou,{omit:["layers","collisionBoxArray","features","compareText"]}),Ou.MAX_GLYPHS=65535,Ou.addDynamicAttributes=Fd;var Ud={get paint(){return rg=rg||new k({"icon-opacity":new yn(Ke.paint_symbol["icon-opacity"]),"icon-color":new yn(Ke.paint_symbol["icon-color"]),"icon-halo-color":new yn(Ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new yn(Ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new yn(Ke.paint_symbol["icon-halo-blur"]),"icon-translate":new nn(Ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new nn(Ke.paint_symbol["icon-translate-anchor"]),"text-opacity":new yn(Ke.paint_symbol["text-opacity"]),"text-color":new yn(Ke.paint_symbol["text-color"],{runtimeType:vr,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new yn(Ke.paint_symbol["text-halo-color"]),"text-halo-width":new yn(Ke.paint_symbol["text-halo-width"]),"text-halo-blur":new yn(Ke.paint_symbol["text-halo-blur"]),"text-translate":new nn(Ke.paint_symbol["text-translate"]),"text-translate-anchor":new nn(Ke.paint_symbol["text-translate-anchor"])})},get layout(){return ig=ig||new k({"symbol-placement":new nn(Ke.layout_symbol["symbol-placement"]),"symbol-spacing":new nn(Ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new nn(Ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new yn(Ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new nn(Ke.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new nn(Ke.layout_symbol["icon-allow-overlap"]),"icon-overlap":new nn(Ke.layout_symbol["icon-overlap"]),"icon-ignore-placement":new nn(Ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new nn(Ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new nn(Ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new yn(Ke.layout_symbol["icon-size"]),"icon-text-fit":new nn(Ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new nn(Ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new yn(Ke.layout_symbol["icon-image"]),"icon-rotate":new yn(Ke.layout_symbol["icon-rotate"]),"icon-padding":new yn(Ke.layout_symbol["icon-padding"]),"icon-keep-upright":new nn(Ke.layout_symbol["icon-keep-upright"]),"icon-offset":new yn(Ke.layout_symbol["icon-offset"]),"icon-anchor":new yn(Ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new nn(Ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new nn(Ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new nn(Ke.layout_symbol["text-rotation-alignment"]),"text-field":new yn(Ke.layout_symbol["text-field"]),"text-font":new yn(Ke.layout_symbol["text-font"]),"text-size":new yn(Ke.layout_symbol["text-size"]),"text-max-width":new yn(Ke.layout_symbol["text-max-width"]),"text-line-height":new nn(Ke.layout_symbol["text-line-height"]),"text-letter-spacing":new yn(Ke.layout_symbol["text-letter-spacing"]),"text-justify":new yn(Ke.layout_symbol["text-justify"]),"text-radial-offset":new yn(Ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new nn(Ke.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new yn(Ke.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new yn(Ke.layout_symbol["text-anchor"]),"text-max-angle":new nn(Ke.layout_symbol["text-max-angle"]),"text-writing-mode":new nn(Ke.layout_symbol["text-writing-mode"]),"text-rotate":new yn(Ke.layout_symbol["text-rotate"]),"text-padding":new nn(Ke.layout_symbol["text-padding"]),"text-keep-upright":new nn(Ke.layout_symbol["text-keep-upright"]),"text-transform":new yn(Ke.layout_symbol["text-transform"]),"text-offset":new yn(Ke.layout_symbol["text-offset"]),"text-allow-overlap":new nn(Ke.layout_symbol["text-allow-overlap"]),"text-overlap":new nn(Ke.layout_symbol["text-overlap"]),"text-ignore-placement":new nn(Ke.layout_symbol["text-ignore-placement"]),"text-optional":new nn(Ke.layout_symbol["text-optional"])})}};class sg{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:Ms,this.defaultValue=i}evaluate(i){if(i.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(i.formattedSection))return u.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Qt("FormatSectionOverride",sg,{omit:["defaultValue"]});class uf extends f{constructor(i){super(i,Ud)}recalculate(i,u){if(super.recalculate(i,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const g=this.layout.get("text-writing-mode");if(g){const v=[];for(const E of g)v.indexOf(E)<0&&v.push(E);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,u,g,v){const E=this.layout.get(i).evaluate(u,{},g,v),A=this._unevaluatedLayout._values[i];return A.isDataDriven()||b(A.value)||!E?E:function(M,P){return P.replace(/{([^{}]+)}/g,(F,j)=>M&&j in M?String(M[j]):"")}(u.properties,E)}createBucket(i){return new Ou(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of Ud.paint.overridableProperties){if(!uf.hasPaintOverride(this.layout,i))continue;const u=this.paint.get(i),g=new sg(u),v=new p(g,u.property.specification);let E=null;E=u.value.kind==="constant"||u.value.kind==="source"?new O("source",v):new V("composite",v,u.value.zoomStops),this.paint._values[i]=new co(u.property,E,u.parameters)}}_handleOverridablePaintPropertyUpdate(i,u,g){return!(!this.layout||u.isDataDriven()||g.isDataDriven())&&uf.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,u){const g=i.get("text-field"),v=Ud.paint.properties[u];let E=!1;const A=M=>{for(const P of M)if(v.overrides&&v.overrides.hasOverride(P))return void(E=!0)};if(g.value.kind==="constant"&&g.value.value instanceof Cr)A(g.value.value.sections);else if(g.value.kind==="source"){const M=F=>{E||(F instanceof _s&&zi(F.value)===Ar?A(F.value.sections):F instanceof ga?A(F.sections):F.eachChild(M))},P=g.value;P._styleExpression&&M(P._styleExpression.expression)}return E}}let og;var kb={get paint(){return og=og||new k({"background-color":new nn(Ke.paint_background["background-color"]),"background-pattern":new Iu(Ke.paint_background["background-pattern"]),"background-opacity":new nn(Ke.paint_background["background-opacity"])})}};class Ib extends f{constructor(i){super(i,kb)}}let ag;var Sb={get paint(){return ag=ag||new k({"raster-opacity":new nn(Ke.paint_raster["raster-opacity"]),"raster-hue-rotate":new nn(Ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new nn(Ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new nn(Ke.paint_raster["raster-brightness-max"]),"raster-saturation":new nn(Ke.paint_raster["raster-saturation"]),"raster-contrast":new nn(Ke.paint_raster["raster-contrast"]),"raster-resampling":new nn(Ke.paint_raster["raster-resampling"]),"raster-fade-duration":new nn(Ke.paint_raster["raster-fade-duration"])})}};class Eb extends f{constructor(i){super(i,Sb)}}class Ab extends f{constructor(i){super(i,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Tb{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const jd=63710088e-1;class cl{constructor(i,u){if(isNaN(i)||isNaN(u))throw new Error(`Invalid LngLat object: (${i}, ${u})`);if(this.lng=+i,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new cl(Ae(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const u=Math.PI/180,g=this.lat*u,v=i.lat*u,E=Math.sin(g)*Math.sin(v)+Math.cos(g)*Math.cos(v)*Math.cos((i.lng-this.lng)*u);return jd*Math.acos(Math.min(E,1))}static convert(i){if(i instanceof cl)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new cl(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new cl(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const lg=2*Math.PI*jd;function ug(o){return lg*Math.cos(o*Math.PI/180)}function cg(o){return(180+o)/360}function hg(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function fg(o,i){return o/ug(i)}function qd(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}class ih{constructor(i,u,g=0){this.x=+i,this.y=+u,this.z=+g}static fromLngLat(i,u=0){const g=cl.convert(i);return new ih(cg(g.lng),hg(g.lat),fg(u,g.lat))}toLngLat(){return new cl(360*this.x-180,qd(this.y))}toAltitude(){return this.z*ug(qd(this.y))}meterInMercatorCoordinateUnits(){return 1/lg*(i=qd(this.y),1/Math.cos(i*Math.PI/180));var i}}function dg(o,i,u){var g=2*Math.PI*6378137/256/Math.pow(2,u);return[o*g-2*Math.PI*6378137/2,i*g-2*Math.PI*6378137/2]}class Vd{constructor(i,u,g){if(!function(v,E,A){return!(v<0||v>25||A<0||A>=Math.pow(2,v)||E<0||E>=Math.pow(2,v))}(i,u,g))throw new Error(`x=${u}, y=${g}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=u,this.y=g,this.key=rh(0,i,i,u,g)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,u,g){const v=(A=this.y,M=this.z,P=dg(256*(E=this.x),256*(A=Math.pow(2,M)-A-1),M),F=dg(256*(E+1),256*(A+1),M),P[0]+","+P[1]+","+F[0]+","+F[1]);var E,A,M,P,F;const j=function(G,W,te){let re,de="";for(let Ce=G;Ce>0;Ce--)re=1<<Ce-1,de+=(W&re?1:0)+(te&re?2:0);return de}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(g==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,j).replace(/{bbox-epsg-3857}/g,v)}isChildOf(i){const u=this.z-i.z;return u>0&&i.x===this.x>>u&&i.y===this.y>>u}getTilePoint(i){const u=Math.pow(2,this.z);return new C((i.x*u-this.x)*ar,(i.y*u-this.y)*ar)}toString(){return`${this.z}/${this.x}/${this.y}`}}class pg{constructor(i,u){this.wrap=i,this.canonical=u,this.key=rh(i,u.z,u.z,u.x,u.y)}}class Ks{constructor(i,u,g,v,E){if(i<g)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${g}`);this.overscaledZ=i,this.wrap=u,this.canonical=new Vd(g,+v,+E),this.key=rh(u,i,g,v,E)}clone(){return new Ks(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-i;return i>this.canonical.z?new Ks(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ks(i,this.wrap,i,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(i,u){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const g=this.canonical.z-i;return i>this.canonical.z?rh(this.wrap*+u,i,this.canonical.z,this.canonical.x,this.canonical.y):rh(this.wrap*+u,i,i,this.canonical.x>>g,this.canonical.y>>g)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const u=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>u&&i.canonical.y===this.canonical.y>>u}children(i){if(this.overscaledZ>=i)return[new Ks(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,g=2*this.canonical.x,v=2*this.canonical.y;return[new Ks(u,this.wrap,u,g,v),new Ks(u,this.wrap,u,g+1,v),new Ks(u,this.wrap,u,g,v+1),new Ks(u,this.wrap,u,g+1,v+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Ks(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Ks(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new pg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new ih(i.x-this.wrap,i.y))}}function rh(o,i,u,g,v){(o*=2)<0&&(o=-1*o-1);const E=1<<u;return(E*E*o+E*v+g).toString(36)+u.toString(36)+i.toString(36)}Qt("CanonicalTileID",Vd),Qt("OverscaledTileID",Ks,{omit:["posMatrix"]});class mg{constructor(i,u,g,v=1,E=1,A=1,M=0){if(this.uid=i,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(g&&!["mapbox","terrarium","custom"].includes(g))return void Ue(`"${g}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const P=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),g){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=v,this.greenFactor=E,this.blueFactor=A,this.baseShift=M;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let F=0;F<P;F++)this.data[this._idx(-1,F)]=this.data[this._idx(0,F)],this.data[this._idx(P,F)]=this.data[this._idx(P-1,F)],this.data[this._idx(F,-1)]=this.data[this._idx(F,0)],this.data[this._idx(F,P)]=this.data[this._idx(F,P-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(P,-1)]=this.data[this._idx(P-1,0)],this.data[this._idx(-1,P)]=this.data[this._idx(0,P-1)],this.data[this._idx(P,P)]=this.data[this._idx(P-1,P-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let F=0;F<P;F++)for(let j=0;j<P;j++){const G=this.get(F,j);G>this.max&&(this.max=G),G<this.min&&(this.min=G)}}get(i,u){const g=new Uint8Array(this.data.buffer),v=4*this._idx(i,u);return this.unpack(g[v],g[v+1],g[v+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,u){if(i<-1||i>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(i+1)}unpack(i,u,g){return i*this.redFactor+u*this.greenFactor+g*this.blueFactor-this.baseShift}getPixels(){return new Ws({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,u,g){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let v=u*this.dim,E=u*this.dim+this.dim,A=g*this.dim,M=g*this.dim+this.dim;switch(u){case-1:v=E-1;break;case 1:E=v+1}switch(g){case-1:A=M-1;break;case 1:M=A+1}const P=-u*this.dim,F=-g*this.dim;for(let j=A;j<M;j++)for(let G=v;G<E;G++)this.data[this._idx(G,j)]=i.data[this._idx(G+P,j+F)]}}Qt("DEMData",mg);class gg{constructor(i){this._stringToNumber={},this._numberToString=[];for(let u=0;u<i.length;u++){const g=i[u];this._stringToNumber[g]=u,this._numberToString[u]=g}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class _g{constructor(i,u,g,v,E){this.type="Feature",this._vectorTileFeature=i,i._z=u,i._x=g,i._y=v,this.properties=i.properties,this.id=E}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(i[u]=this[u]);return i}}class yg{constructor(i,u){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new $a(ar,16,0),this.grid3D=new $a(ar,16,0),this.featureIndexArray=new Xr,this.promoteId=u}insert(i,u,g,v,E,A){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(g,v,E);const P=A?this.grid3D:this.grid;for(let F=0;F<u.length;F++){const j=u[F],G=[1/0,1/0,-1/0,-1/0];for(let W=0;W<j.length;W++){const te=j[W];G[0]=Math.min(G[0],te.x),G[1]=Math.min(G[1],te.y),G[2]=Math.max(G[2],te.x),G[3]=Math.max(G[3],te.y)}G[0]<ar&&G[1]<ar&&G[2]>=0&&G[3]>=0&&P.insert(M,G[0],G[1],G[2],G[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new al.VectorTile(new Md(this.rawTileData)).layers,this.sourceLayerCoder=new gg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,u,g,v){this.loadVTLayers();const E=i.params||{},A=ar/i.tileSize/i.scale,M=Ft(E.filter),P=i.queryGeometry,F=i.queryPadding*A,j=bg(P),G=this.grid.query(j.minX-F,j.minY-F,j.maxX+F,j.maxY+F),W=bg(i.cameraQueryGeometry),te=this.grid3D.query(W.minX-F,W.minY-F,W.maxX+F,W.maxY+F,(Ce,De,nt,Ge)=>function(Qe,ht,Et,Wt,_n){for(const Gt of Qe)if(ht<=Gt.x&&Et<=Gt.y&&Wt>=Gt.x&&_n>=Gt.y)return!0;const Ht=[new C(ht,Et),new C(ht,_n),new C(Wt,_n),new C(Wt,Et)];if(Qe.length>2){for(const Gt of Ht)if(Mu(Qe,Gt))return!0}for(let Gt=0;Gt<Qe.length-1;Gt++)if(l1(Qe[Gt],Qe[Gt+1],Ht))return!0;return!1}(i.cameraQueryGeometry,Ce-F,De-F,nt+F,Ge+F));for(const Ce of te)G.push(Ce);G.sort(Cb);const re={};let de;for(let Ce=0;Ce<G.length;Ce++){const De=G[Ce];if(De===de)continue;de=De;const nt=this.featureIndexArray.get(De);let Ge=null;this.loadMatchingFeature(re,nt.bucketIndex,nt.sourceLayerIndex,nt.featureIndex,M,E.layers,E.availableImages,u,g,v,(Qe,ht,Et)=>(Ge||(Ge=Wl(Qe)),ht.queryIntersectsFeature(P,Qe,Et,Ge,this.z,i.transform,A,i.pixelPosMatrix)))}return re}loadMatchingFeature(i,u,g,v,E,A,M,P,F,j,G){const W=this.bucketLayerIDs[u];if(A&&!function(Ce,De){for(let nt=0;nt<Ce.length;nt++)if(De.indexOf(Ce[nt])>=0)return!0;return!1}(A,W))return;const te=this.sourceLayerCoder.decode(g),re=this.vtLayers[te].feature(v);if(E.needGeometry){const Ce=Kl(re,!0);if(!E.filter(new Ei(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!E.filter(new Ei(this.tileID.overscaledZ),re))return;const de=this.getId(re,te);for(let Ce=0;Ce<W.length;Ce++){const De=W[Ce];if(A&&A.indexOf(De)<0)continue;const nt=P[De];if(!nt)continue;let Ge={};de&&j&&(Ge=j.getState(nt.sourceLayer||"_geojsonTileLayer",de));const Qe=ce({},F[De]);Qe.paint=vg(Qe.paint,nt.paint,re,Ge,M),Qe.layout=vg(Qe.layout,nt.layout,re,Ge,M);const ht=!G||G(re,nt,Ge);if(!ht)continue;const Et=new _g(re,this.z,this.x,this.y,de);Et.layer=Qe;let Wt=i[De];Wt===void 0&&(Wt=i[De]=[]),Wt.push({featureIndex:v,feature:Et,intersectionZ:ht})}}lookupSymbolFeatures(i,u,g,v,E,A,M,P){const F={};this.loadVTLayers();const j=Ft(E);for(const G of i)this.loadMatchingFeature(F,g,v,G,j,A,M,P,u);return F}hasLayer(i){for(const u of this.bucketLayerIDs)for(const g of u)if(i===g)return!0;return!1}getId(i,u){let g=i.id;return this.promoteId&&(g=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof g=="boolean"&&(g=Number(g))),g}}function vg(o,i,u,g,v){return be(o,(E,A)=>{const M=i instanceof Gl?i.get(A):null;return M&&M.evaluate?M.evaluate(u,g,v):M})}function bg(o){let i=1/0,u=1/0,g=-1/0,v=-1/0;for(const E of o)i=Math.min(i,E.x),u=Math.min(u,E.y),g=Math.max(g,E.x),v=Math.max(v,E.y);return{minX:i,minY:u,maxX:g,maxY:v}}function Cb(o,i){return i-o}function xg(o,i,u,g,v){const E=[];for(let A=0;A<o.length;A++){const M=o[A];let P;for(let F=0;F<M.length-1;F++){let j=M[F],G=M[F+1];j.x<i&&G.x<i||(j.x<i?j=new C(i,j.y+(i-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x<i&&(G=new C(i,j.y+(i-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y<u&&G.y<u||(j.y<u?j=new C(j.x+(u-j.y)/(G.y-j.y)*(G.x-j.x),u)._round():G.y<u&&(G=new C(j.x+(u-j.y)/(G.y-j.y)*(G.x-j.x),u)._round()),j.x>=g&&G.x>=g||(j.x>=g?j=new C(g,j.y+(g-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x>=g&&(G=new C(g,j.y+(g-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y>=v&&G.y>=v||(j.y>=v?j=new C(j.x+(v-j.y)/(G.y-j.y)*(G.x-j.x),v)._round():G.y>=v&&(G=new C(j.x+(v-j.y)/(G.y-j.y)*(G.x-j.x),v)._round()),P&&j.equals(P[P.length-1])||(P=[j],E.push(P)),P.push(G)))))}}return E}Qt("FeatureIndex",yg,{omit:["rawTileData","sourceLayerCoder"]});class hl extends C{constructor(i,u,g,v){super(i,u),this.angle=g,v!==void 0&&(this.segment=v)}clone(){return new hl(this.x,this.y,this.angle,this.segment)}}function wg(o,i,u,g,v){if(i.segment===void 0||u===0)return!0;let E=i,A=i.segment+1,M=0;for(;M>-u/2;){if(A--,A<0)return!1;M-=o[A].dist(E),E=o[A]}M+=o[A].dist(o[A+1]),A++;const P=[];let F=0;for(;M<u/2;){const j=o[A],G=o[A+1];if(!G)return!1;let W=o[A-1].angleTo(j)-j.angleTo(G);for(W=Math.abs((W+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:M,angleDelta:W}),F+=W;M-P[0].distance>g;)F-=P.shift().angleDelta;if(F>v)return!1;A++,M+=j.dist(G)}return!0}function kg(o){let i=0;for(let u=0;u<o.length-1;u++)i+=o[u].dist(o[u+1]);return i}function Ig(o,i,u){return o?.6*i*u:0}function Sg(o,i){return Math.max(o?o.right-o.left:0,i?i.right-i.left:0)}function Lb(o,i,u,g,v,E){const A=Ig(u,v,E),M=Sg(u,g)*E;let P=0;const F=kg(o)/2;for(let j=0;j<o.length-1;j++){const G=o[j],W=o[j+1],te=G.dist(W);if(P+te>F){const re=(F-P)/te,de=xi.number(G.x,W.x,re),Ce=xi.number(G.y,W.y,re),De=new hl(de,Ce,W.angleTo(G),j);return De._round(),!A||wg(o,De,M,A,i)?De:void 0}P+=te}}function Mb(o,i,u,g,v,E,A,M,P){const F=Ig(g,E,A),j=Sg(g,v),G=j*A,W=o[0].x===0||o[0].x===P||o[0].y===0||o[0].y===P;return i-G<i/4&&(i=G+i/4),Eg(o,W?i/2*M%i:(j/2+2*E)*A*M%i,i,F,u,G,W,!1,P)}function Eg(o,i,u,g,v,E,A,M,P){const F=E/2,j=kg(o);let G=0,W=i-u,te=[];for(let re=0;re<o.length-1;re++){const de=o[re],Ce=o[re+1],De=de.dist(Ce),nt=Ce.angleTo(de);for(;W+u<G+De;){W+=u;const Ge=(W-G)/De,Qe=xi.number(de.x,Ce.x,Ge),ht=xi.number(de.y,Ce.y,Ge);if(Qe>=0&&Qe<P&&ht>=0&&ht<P&&W-F>=0&&W+F<=j){const Et=new hl(Qe,ht,nt,re);Et._round(),g&&!wg(o,Et,E,g,v)||te.push(Et)}}G+=De}return M||te.length||A||(te=Eg(o,G/2,u,g,v,E,A,!0,P)),te}Qt("Anchor",hl);const Bu=Es;function Ag(o,i,u,g){const v=[],E=o.image,A=E.pixelRatio,M=E.paddedRect.w-2*Bu,P=E.paddedRect.h-2*Bu;let F={x1:o.left,y1:o.top,x2:o.right,y2:o.bottom};const j=E.stretchX||[[0,M]],G=E.stretchY||[[0,P]],W=(yt,cn)=>yt+cn[1]-cn[0],te=j.reduce(W,0),re=G.reduce(W,0),de=M-te,Ce=P-re;let De=0,nt=te,Ge=0,Qe=re,ht=0,Et=de,Wt=0,_n=Ce;if(E.content&&g){const yt=E.content,cn=yt[2]-yt[0],sn=yt[3]-yt[1];(E.textFitWidth||E.textFitHeight)&&(F=eg(o)),De=cf(j,0,yt[0]),Ge=cf(G,0,yt[1]),nt=cf(j,yt[0],yt[2]),Qe=cf(G,yt[1],yt[3]),ht=yt[0]-De,Wt=yt[1]-Ge,Et=cn-nt,_n=sn-Qe}const Ht=F.x1,Gt=F.y1,on=F.x2-Ht,tn=F.y2-Gt,Yt=(yt,cn,sn,kn)=>{const bi=hf(yt.stretch-De,nt,on,Ht),yi=ff(yt.fixed-ht,Et,yt.stretch,te),xr=hf(cn.stretch-Ge,Qe,tn,Gt),fo=ff(cn.fixed-Wt,_n,cn.stretch,re),Ur=hf(sn.stretch-De,nt,on,Ht),wr=ff(sn.fixed-ht,Et,sn.stretch,te),ls=hf(kn.stretch-Ge,Qe,tn,Gt),us=ff(kn.fixed-Wt,_n,kn.stretch,re),cs=new C(bi,xr),Ki=new C(Ur,xr),kr=new C(Ur,ls),Kr=new C(bi,ls),jr=new C(yi/A,fo/A),hs=new C(wr/A,us/A),qr=i*Math.PI/180;if(qr){const ai=Math.sin(qr),wi=Math.cos(qr),Li=[wi,-ai,ai,wi];cs._matMult(Li),Ki._matMult(Li),Kr._matMult(Li),kr._matMult(Li)}const $s=yt.stretch+yt.fixed,As=cn.stretch+cn.fixed;return{tl:cs,tr:Ki,bl:Kr,br:kr,tex:{x:E.paddedRect.x+Bu+$s,y:E.paddedRect.y+Bu+As,w:sn.stretch+sn.fixed-$s,h:kn.stretch+kn.fixed-As},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:jr,pixelOffsetBR:hs,minFontScaleX:Et/A/on,minFontScaleY:_n/A/tn,isSDF:u}};if(g&&(E.stretchX||E.stretchY)){const yt=Tg(j,de,te),cn=Tg(G,Ce,re);for(let sn=0;sn<yt.length-1;sn++){const kn=yt[sn],bi=yt[sn+1];for(let yi=0;yi<cn.length-1;yi++)v.push(Yt(kn,cn[yi],bi,cn[yi+1]))}}else v.push(Yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:P+1}));return v}function cf(o,i,u){let g=0;for(const v of o)g+=Math.max(i,Math.min(u,v[1]))-Math.max(i,Math.min(u,v[0]));return g}function Tg(o,i,u){const g=[{fixed:-Bu,stretch:0}];for(const[v,E]of o){const A=g[g.length-1];g.push({fixed:v-A.stretch,stretch:A.stretch}),g.push({fixed:v-A.stretch,stretch:A.stretch+(E-v)})}return g.push({fixed:i+Bu,stretch:u}),g}function hf(o,i,u,g){return o/i*u+g}function ff(o,i,u,g){return o-i*u/g}class df{constructor(i,u,g,v,E,A,M,P,F,j){var G;if(this.boxStartIndex=i.length,F){let W=A.top,te=A.bottom;const re=A.collisionPadding;re&&(W-=re[1],te+=re[3]);let de=te-W;de>0&&(de=Math.max(10,de),this.circleDiameter=de)}else{const W=!((G=A.image)===null||G===void 0)&&G.content&&(A.image.textFitWidth||A.image.textFitHeight)?eg(A):{x1:A.left,y1:A.top,x2:A.right,y2:A.bottom};W.y1=W.y1*M-P[0],W.y2=W.y2*M+P[2],W.x1=W.x1*M-P[3],W.x2=W.x2*M+P[1];const te=A.collisionPadding;if(te&&(W.x1-=te[0]*M,W.y1-=te[1]*M,W.x2+=te[2]*M,W.y2+=te[3]*M),j){const re=new C(W.x1,W.y1),de=new C(W.x2,W.y1),Ce=new C(W.x1,W.y2),De=new C(W.x2,W.y2),nt=j*Math.PI/180;re._rotate(nt),de._rotate(nt),Ce._rotate(nt),De._rotate(nt),W.x1=Math.min(re.x,de.x,Ce.x,De.x),W.x2=Math.max(re.x,de.x,Ce.x,De.x),W.y1=Math.min(re.y,de.y,Ce.y,De.y),W.y2=Math.max(re.y,de.y,Ce.y,De.y)}i.emplaceBack(u.x,u.y,W.x1,W.y1,W.x2,W.y2,g,v,E)}this.boxEndIndex=i.length}}class Rb{constructor(i=[],u=(g,v)=>g<v?-1:g>v?1:0){if(this.data=i,this.length=this.data.length,this.compare=u,this.length>0)for(let g=(this.length>>1)-1;g>=0;g--)this._down(g)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],u=this.data.pop();return--this.length>0&&(this.data[0]=u,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:u,compare:g}=this,v=u[i];for(;i>0;){const E=i-1>>1,A=u[E];if(g(v,A)>=0)break;u[i]=A,i=E}u[i]=v}_down(i){const{data:u,compare:g}=this,v=this.length>>1,E=u[i];for(;i<v;){let A=1+(i<<1);const M=A+1;if(M<this.length&&g(u[M],u[A])<0&&(A=M),g(u[A],E)>=0)break;u[i]=u[A],i=A}u[i]=E}}function Pb(o,i=1,u=!1){let g=1/0,v=1/0,E=-1/0,A=-1/0;const M=o[0];for(let te=0;te<M.length;te++){const re=M[te];(!te||re.x<g)&&(g=re.x),(!te||re.y<v)&&(v=re.y),(!te||re.x>E)&&(E=re.x),(!te||re.y>A)&&(A=re.y)}const P=Math.min(E-g,A-v);let F=P/2;const j=new Rb([],Db);if(P===0)return new C(g,v);for(let te=g;te<E;te+=P)for(let re=v;re<A;re+=P)j.push(new Uu(te+F,re+F,F,o));let G=function(te){let re=0,de=0,Ce=0;const De=te[0];for(let nt=0,Ge=De.length,Qe=Ge-1;nt<Ge;Qe=nt++){const ht=De[nt],Et=De[Qe],Wt=ht.x*Et.y-Et.x*ht.y;de+=(ht.x+Et.x)*Wt,Ce+=(ht.y+Et.y)*Wt,re+=3*Wt}return new Uu(de/re,Ce/re,0,te)}(o),W=j.length;for(;j.length;){const te=j.pop();(te.d>G.d||!G.d)&&(G=te,u&&console.log("found best %d after %d probes",Math.round(1e4*te.d)/1e4,W)),te.max-G.d<=i||(F=te.h/2,j.push(new Uu(te.p.x-F,te.p.y-F,F,o)),j.push(new Uu(te.p.x+F,te.p.y-F,F,o)),j.push(new Uu(te.p.x-F,te.p.y+F,F,o)),j.push(new Uu(te.p.x+F,te.p.y+F,F,o)),W+=4)}return u&&(console.log(`num probes: ${W}`),console.log(`best distance: ${G.d}`)),G.p}function Db(o,i){return i.max-o.max}function Uu(o,i,u,g){this.p=new C(o,i),this.h=u,this.d=function(v,E){let A=!1,M=1/0;for(let P=0;P<E.length;P++){const F=E[P];for(let j=0,G=F.length,W=G-1;j<G;W=j++){const te=F[j],re=F[W];te.y>v.y!=re.y>v.y&&v.x<(re.x-te.x)*(v.y-te.y)/(re.y-te.y)+te.x&&(A=!A),M=Math.min(M,hm(v,te,re))}}return(A?1:-1)*Math.sqrt(M)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}var Br;m.aq=void 0,(Br=m.aq||(m.aq={}))[Br.center=1]="center",Br[Br.left=2]="left",Br[Br.right=3]="right",Br[Br.top=4]="top",Br[Br.bottom=5]="bottom",Br[Br["top-left"]=6]="top-left",Br[Br["top-right"]=7]="top-right",Br[Br["bottom-left"]=8]="bottom-left",Br[Br["bottom-right"]=9]="bottom-right";const fl=7,Gd=Number.POSITIVE_INFINITY;function Cg(o,i){return i[1]!==Gd?function(u,g,v){let E=0,A=0;switch(g=Math.abs(g),v=Math.abs(v),u){case"top-right":case"top-left":case"top":A=v-fl;break;case"bottom-right":case"bottom-left":case"bottom":A=-v+fl}switch(u){case"top-right":case"bottom-right":case"right":E=-g;break;case"top-left":case"bottom-left":case"left":E=g}return[E,A]}(o,i[0],i[1]):function(u,g){let v=0,E=0;g<0&&(g=0);const A=g/Math.SQRT2;switch(u){case"top-right":case"top-left":E=A-fl;break;case"bottom-right":case"bottom-left":E=-A+fl;break;case"bottom":E=-g+fl;break;case"top":E=g-fl}switch(u){case"top-right":case"bottom-right":v=-A;break;case"top-left":case"bottom-left":v=A;break;case"left":v=g;break;case"right":v=-g}return[v,E]}(o,i[0])}function Lg(o,i,u){var g;const v=o.layout,E=(g=v.get("text-variable-anchor-offset"))===null||g===void 0?void 0:g.evaluate(i,{},u);if(E){const M=E.values,P=[];for(let F=0;F<M.length;F+=2){const j=P[F]=M[F],G=M[F+1].map(W=>W*pr);j.startsWith("top")?G[1]-=fl:j.startsWith("bottom")&&(G[1]+=fl),P[F+1]=G}return new Ni(P)}const A=v.get("text-variable-anchor");if(A){let M;M=o._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[v.get("text-radial-offset").evaluate(i,{},u)*pr,Gd]:v.get("text-offset").evaluate(i,{},u).map(F=>F*pr);const P=[];for(const F of A)P.push(F,Cg(F,M));return new Ni(P)}return null}function Zd(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Nb(o,i,u,g,v,E,A,M,P,F,j){let G=E.textMaxSize.evaluate(i,{});G===void 0&&(G=A);const W=o.layers[0].layout,te=W.get("icon-offset").evaluate(i,{},j),re=Rg(u.horizontal),de=A/24,Ce=o.tilePixelRatio*de,De=o.tilePixelRatio*G/24,nt=o.tilePixelRatio*M,Ge=o.tilePixelRatio*W.get("symbol-spacing"),Qe=W.get("text-padding")*o.tilePixelRatio,ht=function(yt,cn,sn,kn=1){const bi=yt.get("icon-padding").evaluate(cn,{},sn),yi=bi&&bi.values;return[yi[0]*kn,yi[1]*kn,yi[2]*kn,yi[3]*kn]}(W,i,j,o.tilePixelRatio),Et=W.get("text-max-angle")/180*Math.PI,Wt=W.get("text-rotation-alignment")!=="viewport"&&W.get("symbol-placement")!=="point",_n=W.get("icon-rotation-alignment")==="map"&&W.get("symbol-placement")!=="point",Ht=W.get("symbol-placement"),Gt=Ge/2,on=W.get("icon-text-fit");let tn;g&&on!=="none"&&(o.allowVerticalPlacement&&u.vertical&&(tn=tg(g,u.vertical,on,W.get("icon-text-fit-padding"),te,de)),re&&(g=tg(g,re,on,W.get("icon-text-fit-padding"),te,de)));const Yt=(yt,cn)=>{cn.x<0||cn.x>=ar||cn.y<0||cn.y>=ar||function(sn,kn,bi,yi,xr,fo,Ur,wr,ls,us,cs,Ki,kr,Kr,jr,hs,qr,$s,As,ai,wi,Li,Bs,qi,ju){const na=sn.addToLineVertexArray(kn,bi);let ia,po,Ys,Dr,Aa=0,ah=0,zg=0,Fg=0,Qd=-1,ep=-1;const Ta={};let Og=Au("");if(sn.allowVerticalPlacement&&yi.vertical){const $r=wr.layout.get("text-rotate").evaluate(wi,{},qi)+90;Ys=new df(ls,kn,us,cs,Ki,yi.vertical,kr,Kr,jr,$r),Ur&&(Dr=new df(ls,kn,us,cs,Ki,Ur,qr,$s,jr,$r))}if(xr){const $r=wr.layout.get("icon-rotate").evaluate(wi,{}),Js=wr.layout.get("icon-text-fit")!=="none",Yl=Ag(xr,$r,Bs,Js),Co=Ur?Ag(Ur,$r,Bs,Js):void 0;po=new df(ls,kn,us,cs,Ki,xr,qr,$s,!1,$r),Aa=4*Yl.length;const Jl=sn.iconSizeData;let ra=null;Jl.kind==="source"?(ra=[ta*wr.layout.get("icon-size").evaluate(wi,{})],ra[0]>ul&&Ue(`${sn.layerIds[0]}: Value for "icon-size" is >= ${nh}. Reduce your "icon-size".`)):Jl.kind==="composite"&&(ra=[ta*Li.compositeIconSizes[0].evaluate(wi,{},qi),ta*Li.compositeIconSizes[1].evaluate(wi,{},qi)],(ra[0]>ul||ra[1]>ul)&&Ue(`${sn.layerIds[0]}: Value for "icon-size" is >= ${nh}. Reduce your "icon-size".`)),sn.addSymbols(sn.icon,Yl,ra,ai,As,wi,m.ah.none,kn,na.lineStartIndex,na.lineLength,-1,qi),Qd=sn.icon.placedSymbolArray.length-1,Co&&(ah=4*Co.length,sn.addSymbols(sn.icon,Co,ra,ai,As,wi,m.ah.vertical,kn,na.lineStartIndex,na.lineLength,-1,qi),ep=sn.icon.placedSymbolArray.length-1)}const Bg=Object.keys(yi.horizontal);for(const $r of Bg){const Js=yi.horizontal[$r];if(!ia){Og=Au(Js.text);const Co=wr.layout.get("text-rotate").evaluate(wi,{},qi);ia=new df(ls,kn,us,cs,Ki,Js,kr,Kr,jr,Co)}const Yl=Js.positionedLines.length===1;if(zg+=Mg(sn,kn,Js,fo,wr,jr,wi,hs,na,yi.vertical?m.ah.horizontal:m.ah.horizontalOnly,Yl?Bg:[$r],Ta,Qd,Li,qi),Yl)break}yi.vertical&&(Fg+=Mg(sn,kn,yi.vertical,fo,wr,jr,wi,hs,na,m.ah.vertical,["vertical"],Ta,ep,Li,qi));const Ob=ia?ia.boxStartIndex:sn.collisionBoxArray.length,Bb=ia?ia.boxEndIndex:sn.collisionBoxArray.length,Ub=Ys?Ys.boxStartIndex:sn.collisionBoxArray.length,jb=Ys?Ys.boxEndIndex:sn.collisionBoxArray.length,qb=po?po.boxStartIndex:sn.collisionBoxArray.length,Vb=po?po.boxEndIndex:sn.collisionBoxArray.length,Gb=Dr?Dr.boxStartIndex:sn.collisionBoxArray.length,Zb=Dr?Dr.boxEndIndex:sn.collisionBoxArray.length;let To=-1;const mf=($r,Js)=>$r&&$r.circleDiameter?Math.max($r.circleDiameter,Js):Js;To=mf(ia,To),To=mf(Ys,To),To=mf(po,To),To=mf(Dr,To);const Ug=To>-1?1:0;Ug&&(To*=ju/pr),sn.glyphOffsetArray.length>=Ou.MAX_GLYPHS&&Ue("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wi.sortKey!==void 0&&sn.addToSortKeyRanges(sn.symbolInstances.length,wi.sortKey);const Hb=Lg(wr,wi,qi),[Xb,Wb]=function($r,Js){const Yl=$r.length,Co=Js==null?void 0:Js.values;if((Co==null?void 0:Co.length)>0)for(let Jl=0;Jl<Co.length;Jl+=2){const ra=Co[Jl+1];$r.emplaceBack(m.aq[Co[Jl]],ra[0],ra[1])}return[Yl,$r.length]}(sn.textAnchorOffsets,Hb);sn.symbolInstances.emplaceBack(kn.x,kn.y,Ta.right>=0?Ta.right:-1,Ta.center>=0?Ta.center:-1,Ta.left>=0?Ta.left:-1,Ta.vertical||-1,Qd,ep,Og,Ob,Bb,Ub,jb,qb,Vb,Gb,Zb,us,zg,Fg,Aa,ah,Ug,0,kr,To,Xb,Wb)}(o,cn,yt,u,g,v,tn,o.layers[0],o.collisionBoxArray,i.index,i.sourceLayerIndex,o.index,Ce,[Qe,Qe,Qe,Qe],Wt,P,nt,ht,_n,te,i,E,F,j,A)};if(Ht==="line")for(const yt of xg(i.geometry,0,0,ar,ar)){const cn=Mb(yt,Ge,Et,u.vertical||re,g,24,De,o.overscaling,ar);for(const sn of cn)re&&zb(o,re.text,Gt,sn)||Yt(yt,sn)}else if(Ht==="line-center"){for(const yt of i.geometry)if(yt.length>1){const cn=Lb(yt,Et,u.vertical||re,g,24,De);cn&&Yt(yt,cn)}}else if(i.type==="Polygon")for(const yt of ja(i.geometry,0)){const cn=Pb(yt,16);Yt(yt[0],new hl(cn.x,cn.y,0))}else if(i.type==="LineString")for(const yt of i.geometry)Yt(yt,new hl(yt[0].x,yt[0].y,0));else if(i.type==="Point")for(const yt of i.geometry)for(const cn of yt)Yt([cn],new hl(cn.x,cn.y,0))}function Mg(o,i,u,g,v,E,A,M,P,F,j,G,W,te,re){const de=function(nt,Ge,Qe,ht,Et,Wt,_n,Ht){const Gt=ht.layout.get("text-rotate").evaluate(Wt,{})*Math.PI/180,on=[];for(const tn of Ge.positionedLines)for(const Yt of tn.positionedGlyphs){if(!Yt.rect)continue;const yt=Yt.rect||{};let cn=Xm+1,sn=!0,kn=1,bi=0;const yi=(Et||Ht)&&Yt.vertical,xr=Yt.metrics.advance*Yt.scale/2;if(Ht&&Ge.verticalizable&&(bi=tn.lineOffset/2-(Yt.imageName?-(pr-Yt.metrics.width*Yt.scale)/2:(Yt.scale-1)*pr)),Yt.imageName){const ai=_n[Yt.imageName];sn=ai.sdf,kn=ai.pixelRatio,cn=Es/kn}const fo=Et?[Yt.x+xr,Yt.y]:[0,0];let Ur=Et?[0,0]:[Yt.x+xr+Qe[0],Yt.y+Qe[1]-bi],wr=[0,0];yi&&(wr=Ur,Ur=[0,0]);const ls=Yt.metrics.isDoubleResolution?2:1,us=(Yt.metrics.left-cn)*Yt.scale-xr+Ur[0],cs=(-Yt.metrics.top-cn)*Yt.scale+Ur[1],Ki=us+yt.w/ls*Yt.scale/kn,kr=cs+yt.h/ls*Yt.scale/kn,Kr=new C(us,cs),jr=new C(Ki,cs),hs=new C(us,kr),qr=new C(Ki,kr);if(yi){const ai=new C(-xr,xr-eh),wi=-Math.PI/2,Li=pr/2-xr,Bs=new C(5-eh-Li,-(Yt.imageName?Li:0)),qi=new C(...wr);Kr._rotateAround(wi,ai)._add(Bs)._add(qi),jr._rotateAround(wi,ai)._add(Bs)._add(qi),hs._rotateAround(wi,ai)._add(Bs)._add(qi),qr._rotateAround(wi,ai)._add(Bs)._add(qi)}if(Gt){const ai=Math.sin(Gt),wi=Math.cos(Gt),Li=[wi,-ai,ai,wi];Kr._matMult(Li),jr._matMult(Li),hs._matMult(Li),qr._matMult(Li)}const $s=new C(0,0),As=new C(0,0);on.push({tl:Kr,tr:jr,bl:hs,br:qr,tex:yt,writingMode:Ge.writingMode,glyphOffset:fo,sectionIndex:Yt.sectionIndex,isSDF:sn,pixelOffsetTL:$s,pixelOffsetBR:As,minFontScaleX:0,minFontScaleY:0})}return on}(0,u,M,v,E,A,g,o.allowVerticalPlacement),Ce=o.textSizeData;let De=null;Ce.kind==="source"?(De=[ta*v.layout.get("text-size").evaluate(A,{})],De[0]>ul&&Ue(`${o.layerIds[0]}: Value for "text-size" is >= ${nh}. Reduce your "text-size".`)):Ce.kind==="composite"&&(De=[ta*te.compositeTextSizes[0].evaluate(A,{},re),ta*te.compositeTextSizes[1].evaluate(A,{},re)],(De[0]>ul||De[1]>ul)&&Ue(`${o.layerIds[0]}: Value for "text-size" is >= ${nh}. Reduce your "text-size".`)),o.addSymbols(o.text,de,De,M,E,A,F,i,P.lineStartIndex,P.lineLength,W,re);for(const nt of j)G[nt]=o.text.placedSymbolArray.length-1;return 4*de.length}function Rg(o){for(const i in o)return o[i];return null}function zb(o,i,u,g){const v=o.compareText;if(i in v){const E=v[i];for(let A=E.length-1;A>=0;A--)if(g.dist(E[A])<u)return!0}else v[i]=[];return v[i].push(g),!1}const Pg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Hd{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,g]=new Uint8Array(i,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const v=g>>4;if(v!==1)throw new Error(`Got v${v} data when expected v1.`);const E=Pg[15&g];if(!E)throw new Error("Unrecognized array type.");const[A]=new Uint16Array(i,2,1),[M]=new Uint32Array(i,4,1);return new Hd(M,A,E,i)}constructor(i,u=64,g=Float64Array,v){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=g,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const E=Pg.indexOf(this.ArrayType),A=2*i*this.ArrayType.BYTES_PER_ELEMENT,M=i*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-M%8)%8;if(E<0)throw new Error(`Unexpected typed array class: ${g}.`);v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+M+P,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+A+M+P),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+M+P,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+E]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=i)}add(i,u){const g=this._pos>>1;return this.ids[g]=g,this.coords[this._pos++]=i,this.coords[this._pos++]=u,g}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return Xd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,u,g,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:E,coords:A,nodeSize:M}=this,P=[0,E.length-1,0],F=[];for(;P.length;){const j=P.pop()||0,G=P.pop()||0,W=P.pop()||0;if(G-W<=M){for(let Ce=W;Ce<=G;Ce++){const De=A[2*Ce],nt=A[2*Ce+1];De>=i&&De<=g&&nt>=u&&nt<=v&&F.push(E[Ce])}continue}const te=W+G>>1,re=A[2*te],de=A[2*te+1];re>=i&&re<=g&&de>=u&&de<=v&&F.push(E[te]),(j===0?i<=re:u<=de)&&(P.push(W),P.push(te-1),P.push(1-j)),(j===0?g>=re:v>=de)&&(P.push(te+1),P.push(G),P.push(1-j))}return F}within(i,u,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:E,nodeSize:A}=this,M=[0,v.length-1,0],P=[],F=g*g;for(;M.length;){const j=M.pop()||0,G=M.pop()||0,W=M.pop()||0;if(G-W<=A){for(let Ce=W;Ce<=G;Ce++)Ng(E[2*Ce],E[2*Ce+1],i,u)<=F&&P.push(v[Ce]);continue}const te=W+G>>1,re=E[2*te],de=E[2*te+1];Ng(re,de,i,u)<=F&&P.push(v[te]),(j===0?i-g<=re:u-g<=de)&&(M.push(W),M.push(te-1),M.push(1-j)),(j===0?i+g>=re:u+g>=de)&&(M.push(te+1),M.push(G),M.push(1-j))}return P}}function Xd(o,i,u,g,v,E){if(v-g<=u)return;const A=g+v>>1;Dg(o,i,A,g,v,E),Xd(o,i,u,g,A-1,1-E),Xd(o,i,u,A+1,v,1-E)}function Dg(o,i,u,g,v,E){for(;v>g;){if(v-g>600){const F=v-g+1,j=u-g+1,G=Math.log(F),W=.5*Math.exp(2*G/3),te=.5*Math.sqrt(G*W*(F-W)/F)*(j-F/2<0?-1:1);Dg(o,i,u,Math.max(g,Math.floor(u-j*W/F+te)),Math.min(v,Math.floor(u+(F-j)*W/F+te)),E)}const A=i[2*u+E];let M=g,P=v;for(sh(o,i,g,u),i[2*v+E]>A&&sh(o,i,g,v);M<P;){for(sh(o,i,M,P),M++,P--;i[2*M+E]<A;)M++;for(;i[2*P+E]>A;)P--}i[2*g+E]===A?sh(o,i,g,P):(P++,sh(o,i,P,v)),P<=u&&(g=P+1),u<=P&&(v=P-1)}}function sh(o,i,u,g){Wd(o,u,g),Wd(i,2*u,2*g),Wd(i,2*u+1,2*g+1)}function Wd(o,i,u){const g=o[i];o[i]=o[u],o[u]=g}function Ng(o,i,u,g){const v=o-u,E=i-g;return v*v+E*E}var Kd;m.bg=void 0,(Kd=m.bg||(m.bg={})).create="create",Kd.load="load",Kd.fullLoad="fullLoad";let pf=null,oh=[];const $d=1e3/60,Yd="loadTime",Jd="fullLoadTime",Fb={mark(o){performance.mark(o)},frame(o){const i=o;pf!=null&&oh.push(i-pf),pf=i},clearMetrics(){pf=null,oh=[],performance.clearMeasures(Yd),performance.clearMeasures(Jd);for(const o in m.bg)performance.clearMarks(m.bg[o])},getPerformanceMetrics(){performance.measure(Yd,m.bg.create,m.bg.load),performance.measure(Jd,m.bg.create,m.bg.fullLoad);const o=performance.getEntriesByName(Yd)[0].duration,i=performance.getEntriesByName(Jd)[0].duration,u=oh.length,g=1/(oh.reduce((E,A)=>E+A,0)/u/1e3),v=oh.filter(E=>E>$d).reduce((E,A)=>E+(A-$d)/$d,0);return{loadTime:o,fullLoadTime:i,fps:g,percentDroppedFrames:v/(u+v)*100,totalFrames:u}}};m.$=class extends H{},m.A=Ru,m.B=od,m.C=function(o){if(St==null){const i=o.navigator?o.navigator.userAgent:null;St=!!o.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return St},m.D=nn,m.E=Lt,m.F=class{constructor(o,i){this.target=o,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Tb(()=>this.process()),this.subscription=function(u,g,v,E){return u.addEventListener(g,v,!1),{unsubscribe:()=>{u.removeEventListener(g,v,!1)}}}(this.target,"message",u=>this.receive(u)),this.globalScope=pt(self)?o:window}registerMessageHandler(o,i){this.messageHandlers[o]=i}sendAsync(o,i){return new Promise((u,g)=>{const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[v]={resolve:u,reject:g},i&&i.signal.addEventListener("abort",()=>{delete this.resolveRejects[v];const M={id:v,type:"<cancel>",origin:location.origin,targetMapId:o.targetMapId,sourceMapId:this.mapId};this.target.postMessage(M)},{once:!0});const E=[],A=Object.assign(Object.assign({},o),{id:v,sourceMapId:this.mapId,origin:location.origin,data:Ya(o.data,E)});this.target.postMessage(A,{transfer:E})})}receive(o){const i=o.data,u=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!=="resource://android"&&location.origin!=="resource://android"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[u];const g=this.abortControllers[u];return delete this.abortControllers[u],void(g&&g.abort())}if(pt(self)||i.mustQueue)return this.tasks[u]=i,this.taskQueue.push(u),void this.invoker.trigger();this.processTask(u,i)}}process(){if(this.taskQueue.length===0)return;const o=this.taskQueue.shift(),i=this.tasks[o];delete this.tasks[o],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(o,i)}processTask(o,i){return l(this,void 0,void 0,function*(){if(i.type==="<response>"){const v=this.resolveRejects[o];return delete this.resolveRejects[o],v?void(i.error?v.reject(Ja(i.error)):v.resolve(Ja(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(o,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const u=Ja(i.data),g=new AbortController;this.abortControllers[o]=g;try{const v=yield this.messageHandlers[i.type](i.sourceMapId,u,g);this.completeTask(o,null,v)}catch(v){this.completeTask(o,v)}})}completeTask(o,i,u){const g=[];delete this.abortControllers[o];const v={id:o,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?Ya(i):null,data:Ya(u,g)};this.target.postMessage(v,{transfer:g})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},m.G=pn,m.H=function(){var o=new Ru(16);return Ru!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},m.I=Pd,m.J=function(o,i,u){var g,v,E,A,M,P,F,j,G,W,te,re,de=u[0],Ce=u[1],De=u[2];return i===o?(o[12]=i[0]*de+i[4]*Ce+i[8]*De+i[12],o[13]=i[1]*de+i[5]*Ce+i[9]*De+i[13],o[14]=i[2]*de+i[6]*Ce+i[10]*De+i[14],o[15]=i[3]*de+i[7]*Ce+i[11]*De+i[15]):(v=i[1],E=i[2],A=i[3],M=i[4],P=i[5],F=i[6],j=i[7],G=i[8],W=i[9],te=i[10],re=i[11],o[0]=g=i[0],o[1]=v,o[2]=E,o[3]=A,o[4]=M,o[5]=P,o[6]=F,o[7]=j,o[8]=G,o[9]=W,o[10]=te,o[11]=re,o[12]=g*de+M*Ce+G*De+i[12],o[13]=v*de+P*Ce+W*De+i[13],o[14]=E*de+F*Ce+te*De+i[14],o[15]=A*de+j*Ce+re*De+i[15]),o},m.K=function(o,i,u){var g=u[0],v=u[1],E=u[2];return o[0]=i[0]*g,o[1]=i[1]*g,o[2]=i[2]*g,o[3]=i[3]*g,o[4]=i[4]*v,o[5]=i[5]*v,o[6]=i[6]*v,o[7]=i[7]*v,o[8]=i[8]*E,o[9]=i[9]*E,o[10]=i[10]*E,o[11]=i[11]*E,o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o},m.L=mm,m.M=function(o,i){const u={};for(let g=0;g<i.length;g++){const v=i[g];v in o&&(u[v]=o[v])}return u},m.N=cl,m.O=cg,m.P=C,m.Q=hg,m.R=Ws,m.S=Ks,m.T=wu,m.U=se,m.V=Q,m.W=Ut,m.X=ar,m.Y=R,m.Z=ih,m._=l,m.a=It,m.a$=function(o,i){var u=o[0],g=o[1],v=o[2],E=o[3],A=o[4],M=o[5],P=o[6],F=o[7],j=o[8],G=o[9],W=o[10],te=o[11],re=o[12],de=o[13],Ce=o[14],De=o[15],nt=i[0],Ge=i[1],Qe=i[2],ht=i[3],Et=i[4],Wt=i[5],_n=i[6],Ht=i[7],Gt=i[8],on=i[9],tn=i[10],Yt=i[11],yt=i[12],cn=i[13],sn=i[14],kn=i[15];return Math.abs(u-nt)<=as*Math.max(1,Math.abs(u),Math.abs(nt))&&Math.abs(g-Ge)<=as*Math.max(1,Math.abs(g),Math.abs(Ge))&&Math.abs(v-Qe)<=as*Math.max(1,Math.abs(v),Math.abs(Qe))&&Math.abs(E-ht)<=as*Math.max(1,Math.abs(E),Math.abs(ht))&&Math.abs(A-Et)<=as*Math.max(1,Math.abs(A),Math.abs(Et))&&Math.abs(M-Wt)<=as*Math.max(1,Math.abs(M),Math.abs(Wt))&&Math.abs(P-_n)<=as*Math.max(1,Math.abs(P),Math.abs(_n))&&Math.abs(F-Ht)<=as*Math.max(1,Math.abs(F),Math.abs(Ht))&&Math.abs(j-Gt)<=as*Math.max(1,Math.abs(j),Math.abs(Gt))&&Math.abs(G-on)<=as*Math.max(1,Math.abs(G),Math.abs(on))&&Math.abs(W-tn)<=as*Math.max(1,Math.abs(W),Math.abs(tn))&&Math.abs(te-Yt)<=as*Math.max(1,Math.abs(te),Math.abs(Yt))&&Math.abs(re-yt)<=as*Math.max(1,Math.abs(re),Math.abs(yt))&&Math.abs(de-cn)<=as*Math.max(1,Math.abs(de),Math.abs(cn))&&Math.abs(Ce-sn)<=as*Math.max(1,Math.abs(Ce),Math.abs(sn))&&Math.abs(De-kn)<=as*Math.max(1,Math.abs(De),Math.abs(kn))},m.a0=Hn,m.a1=Vd,m.a2=ct,m.a3=o=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(u=>{i.onloadstart=()=>{u(i)};for(const g of o){const v=window.document.createElement("source");dn(g)||(i.crossOrigin="Anonymous"),v.src=g,i.appendChild(v)}})},m.a4=function(){return xe++},m.a5=Xt,m.a6=Ou,m.a7=Ft,m.a8=Kl,m.a9=_g,m.aA=function(o){if(o.type==="custom")return new Ab(o);switch(o.type){case"background":return new Ib(o);case"circle":return new h1(o);case"fill":return new T1(o);case"fill-extrusion":return new V1(o);case"heatmap":return new d1(o);case"hillshade":return new m1(o);case"line":return new Y1(o);case"raster":return new Eb(o);case"symbol":return new uf(o)}},m.aB=ke,m.aC=function(o,i){if(!o)return[{command:"setStyle",args:[i]}];let u=[];try{if(!Ie(o.version,i.version))return[{command:"setStyle",args:[i]}];Ie(o.center,i.center)||u.push({command:"setCenter",args:[i.center]}),Ie(o.zoom,i.zoom)||u.push({command:"setZoom",args:[i.zoom]}),Ie(o.bearing,i.bearing)||u.push({command:"setBearing",args:[i.bearing]}),Ie(o.pitch,i.pitch)||u.push({command:"setPitch",args:[i.pitch]}),Ie(o.sprite,i.sprite)||u.push({command:"setSprite",args:[i.sprite]}),Ie(o.glyphs,i.glyphs)||u.push({command:"setGlyphs",args:[i.glyphs]}),Ie(o.transition,i.transition)||u.push({command:"setTransition",args:[i.transition]}),Ie(o.light,i.light)||u.push({command:"setLight",args:[i.light]}),Ie(o.terrain,i.terrain)||u.push({command:"setTerrain",args:[i.terrain]}),Ie(o.sky,i.sky)||u.push({command:"setSky",args:[i.sky]}),Ie(o.projection,i.projection)||u.push({command:"setProjection",args:[i.projection]});const g={},v=[];(function(A,M,P,F){let j;for(j in M=M||{},A=A||{})Object.prototype.hasOwnProperty.call(A,j)&&(Object.prototype.hasOwnProperty.call(M,j)||Nn(j,P,F));for(j in M)Object.prototype.hasOwnProperty.call(M,j)&&(Object.prototype.hasOwnProperty.call(A,j)?Ie(A[j],M[j])||(A[j].type==="geojson"&&M[j].type==="geojson"&&Jt(A,M,j)?Bt(P,{command:"setGeoJSONSourceData",args:[j,M[j].data]}):Qn(j,M,P,F)):Mn(j,M,P))})(o.sources,i.sources,v,g);const E=[];o.layers&&o.layers.forEach(A=>{"source"in A&&g[A.source]?u.push({command:"removeLayer",args:[A.id]}):E.push(A)}),u=u.concat(v),function(A,M,P){M=M||[];const F=(A=A||[]).map(Yi),j=M.map(Yi),G=A.reduce(Jr,{}),W=M.reduce(Jr,{}),te=F.slice(),re=Object.create(null);let de,Ce,De,nt,Ge;for(let Qe=0,ht=0;Qe<F.length;Qe++)de=F[Qe],Object.prototype.hasOwnProperty.call(W,de)?ht++:(Bt(P,{command:"removeLayer",args:[de]}),te.splice(te.indexOf(de,ht),1));for(let Qe=0,ht=0;Qe<j.length;Qe++)de=j[j.length-1-Qe],te[te.length-1-Qe]!==de&&(Object.prototype.hasOwnProperty.call(G,de)?(Bt(P,{command:"removeLayer",args:[de]}),te.splice(te.lastIndexOf(de,te.length-ht),1)):ht++,nt=te[te.length-Qe],Bt(P,{command:"addLayer",args:[W[de],nt]}),te.splice(te.length-Qe,0,de),re[de]=!0);for(let Qe=0;Qe<j.length;Qe++)if(de=j[Qe],Ce=G[de],De=W[de],!re[de]&&!Ie(Ce,De))if(Ie(Ce.source,De.source)&&Ie(Ce["source-layer"],De["source-layer"])&&Ie(Ce.type,De.type)){for(Ge in Ri(Ce.layout,De.layout,P,de,null,"setLayoutProperty"),Ri(Ce.paint,De.paint,P,de,null,"setPaintProperty"),Ie(Ce.filter,De.filter)||Bt(P,{command:"setFilter",args:[de,De.filter]}),Ie(Ce.minzoom,De.minzoom)&&Ie(Ce.maxzoom,De.maxzoom)||Bt(P,{command:"setLayerZoomRange",args:[de,De.minzoom,De.maxzoom]}),Ce)Object.prototype.hasOwnProperty.call(Ce,Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?Ri(Ce[Ge],De[Ge],P,de,Ge.slice(6),"setPaintProperty"):Ie(Ce[Ge],De[Ge])||Bt(P,{command:"setLayerProperty",args:[de,Ge,De[Ge]]}));for(Ge in De)Object.prototype.hasOwnProperty.call(De,Ge)&&!Object.prototype.hasOwnProperty.call(Ce,Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?Ri(Ce[Ge],De[Ge],P,de,Ge.slice(6),"setPaintProperty"):Ie(Ce[Ge],De[Ge])||Bt(P,{command:"setLayerProperty",args:[de,Ge,De[Ge]]}))}else Bt(P,{command:"removeLayer",args:[de]}),nt=te[te.lastIndexOf(de)+1],Bt(P,{command:"addLayer",args:[De,nt]})}(E,i.layers,u)}catch(g){console.warn("Unable to compute style diff:",g),u=[{command:"setStyle",args:[i]}]}return u},m.aD=function(o){const i=[],u=o.id;return u===void 0&&i.push({message:`layers.${u}: missing required property "id"`}),o.render===void 0&&i.push({message:`layers.${u}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&i.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),i},m.aE=function o(i,u){if(Array.isArray(i)){if(!Array.isArray(u)||i.length!==u.length)return!1;for(let g=0;g<i.length;g++)if(!o(i[g],u[g]))return!1;return!0}if(typeof i=="object"&&i!==null&&u!==null){if(typeof u!="object"||Object.keys(i).length!==Object.keys(u).length)return!1;for(const g in i)if(!o(i[g],u[g]))return!1;return!0}return i===u},m.aF=be,m.aG=Le,m.aH=class extends Hl{constructor(o,i){super(o,i),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},m.aI=Kh,m.aJ=class extends Hl{constructor(o,i){super(o,i),this.current=i1}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let i=1;i<16;i++)if(o[i]!==this.current[i]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},m.aK=rm,m.aL=sm,m.aM=ei,m.aN=class extends Hl{constructor(o,i){super(o,i),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},m.aO=class extends Hl{constructor(o,i){super(o,i),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},m.aP=function(o,i,u,g,v,E,A){var M=1/(i-u),P=1/(g-v),F=1/(E-A);return o[0]=-2*M,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*P,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*F,o[11]=0,o[12]=(i+u)*M,o[13]=(v+g)*P,o[14]=(A+E)*F,o[15]=1,o},m.aQ=c1,m.aR=class extends He{},m.aS=tb,m.aT=class extends st{},m.aU=xd,m.aV=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},m.aW=bm,m.aX=Fr,m.aY=Xs,m.aZ=class extends rn{},m.a_=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]&&o[4]===i[4]&&o[5]===i[5]&&o[6]===i[6]&&o[7]===i[7]&&o[8]===i[8]&&o[9]===i[9]&&o[10]===i[10]&&o[11]===i[11]&&o[12]===i[12]&&o[13]===i[13]&&o[14]===i[14]&&o[15]===i[15]},m.aa=function(o){const i={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,g,v,E)=>{const A=v||E;return i[g]=!A||A.toLowerCase(),""}),i["max-age"]){const u=parseInt(i["max-age"],10);isNaN(u)?delete i["max-age"]:i["max-age"]=u}return i},m.ab=function(o,i){const u=[];for(const g in o)g in i||u.push(g);return u},m.ac=ve,m.ad=function(o,i,u){var g=Math.sin(u),v=Math.cos(u),E=i[0],A=i[1],M=i[2],P=i[3],F=i[4],j=i[5],G=i[6],W=i[7];return i!==o&&(o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=E*v+F*g,o[1]=A*v+j*g,o[2]=M*v+G*g,o[3]=P*v+W*g,o[4]=F*v-E*g,o[5]=j*v-A*g,o[6]=G*v-M*g,o[7]=W*v-P*g,o},m.ae=function(o){var i=new Ru(16);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i[9]=o[9],i[10]=o[10],i[11]=o[11],i[12]=o[12],i[13]=o[13],i[14]=o[14],i[15]=o[15],i},m.af=Qh,m.ag=function(o,i){let u=0,g=0;if(o.kind==="constant")g=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:v,minZoom:E,maxZoom:A}=o,M=v?ve(cr.interpolationFactor(v,i,E,A),0,1):0;o.kind==="camera"?g=xi.number(o.minSize,o.maxSize,M):u=M}return{uSizeT:u,uSize:g}},m.ai=function(o,{uSize:i,uSizeT:u},{lowerSize:g,upperSize:v}){return o.kind==="source"?g/ta:o.kind==="composite"?xi.number(g/ta,v/ta,u):i},m.aj=Fd,m.ak=function(o,i,u,g){const v=i.y-o.y,E=i.x-o.x,A=g.y-u.y,M=g.x-u.x,P=A*E-M*v;if(P===0)return null;const F=(M*(o.y-u.y)-A*(o.x-u.x))/P;return new C(o.x+F*E,o.y+F*v)},m.al=xg,m.am=um,m.an=yd,m.ao=function(o){let i=1/0,u=1/0,g=-1/0,v=-1/0;for(const E of o)i=Math.min(i,E.x),u=Math.min(u,E.y),g=Math.max(g,E.x),v=Math.max(v,E.y);return[i,u,g,v]},m.ap=pr,m.ar=zd,m.as=function(o,i){var u=i[0],g=i[1],v=i[2],E=i[3],A=i[4],M=i[5],P=i[6],F=i[7],j=i[8],G=i[9],W=i[10],te=i[11],re=i[12],de=i[13],Ce=i[14],De=i[15],nt=u*M-g*A,Ge=u*P-v*A,Qe=u*F-E*A,ht=g*P-v*M,Et=g*F-E*M,Wt=v*F-E*P,_n=j*de-G*re,Ht=j*Ce-W*re,Gt=j*De-te*re,on=G*Ce-W*de,tn=G*De-te*de,Yt=W*De-te*Ce,yt=nt*Yt-Ge*tn+Qe*on+ht*Gt-Et*Ht+Wt*_n;return yt?(o[0]=(M*Yt-P*tn+F*on)*(yt=1/yt),o[1]=(v*tn-g*Yt-E*on)*yt,o[2]=(de*Wt-Ce*Et+De*ht)*yt,o[3]=(W*Et-G*Wt-te*ht)*yt,o[4]=(P*Gt-A*Yt-F*Ht)*yt,o[5]=(u*Yt-v*Gt+E*Ht)*yt,o[6]=(Ce*Qe-re*Wt-De*Ge)*yt,o[7]=(j*Wt-W*Qe+te*Ge)*yt,o[8]=(A*tn-M*Gt+F*_n)*yt,o[9]=(g*Gt-u*tn-E*_n)*yt,o[10]=(re*Et-de*Qe+De*nt)*yt,o[11]=(G*Qe-j*Et-te*nt)*yt,o[12]=(M*Ht-A*on-P*_n)*yt,o[13]=(u*on-g*Ht+v*_n)*yt,o[14]=(de*Ge-re*ht-Ce*nt)*yt,o[15]=(j*ht-G*Ge+W*nt)*yt,o):null},m.at=Zd,m.au=Nd,m.av=Hd,m.aw=function(){const o={},i=Ke.$version;for(const u in Ke.$root){const g=Ke.$root[u];if(g.required){let v=null;v=u==="version"?i:g.type==="array"?[]:{},v!=null&&(o[u]=v)}}return o},m.ax=Fc,m.ay=We,m.az=function(o){o=o.slice();const i=Object.create(null);for(let u=0;u<o.length;u++)i[o[u].id]=o[u];for(let u=0;u<o.length;u++)"ref"in o[u]&&(o[u]=bt(o[u],i[o[u].ref]));return o},m.b=dt,m.b0=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o},m.b1=function(o,i,u){return o[0]=i[0]*u[0],o[1]=i[1]*u[1],o[2]=i[2]*u[2],o[3]=i[3]*u[3],o},m.b2=function(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]+o[3]*i[3]},m.b3=Ae,m.b4=pg,m.b5=fg,m.b6=function(o,i,u,g,v){var E,A=1/Math.tan(i/2);return o[0]=A/u,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=A,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,v!=null&&v!==1/0?(o[10]=(v+g)*(E=1/(g-v)),o[14]=2*v*g*E):(o[10]=-1,o[14]=-2*g),o},m.b7=function(o,i,u){var g=Math.sin(u),v=Math.cos(u),E=i[4],A=i[5],M=i[6],P=i[7],F=i[8],j=i[9],G=i[10],W=i[11];return i!==o&&(o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[4]=E*v+F*g,o[5]=A*v+j*g,o[6]=M*v+G*g,o[7]=P*v+W*g,o[8]=F*v-E*g,o[9]=j*v-A*g,o[10]=G*v-M*g,o[11]=W*v-P*g,o},m.b8=Y,m.b9=_e,m.bA=Um,m.bB=function(o){return o.message===ft},m.bC=L,m.bD=Is,m.ba=function(o){return o*Math.PI/180},m.bb=function(o,i){const{x:u,y:g}=ih.fromLngLat(i);return!(o<0||o>25||g<0||g>=1||u<0||u>=1)},m.bc=function(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=i[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},m.bd=class extends q{},m.be=jd,m.bf=Fb,m.bh=Pn,m.bi=function(o,i){It.REGISTERED_PROTOCOLS[o]=i},m.bj=function(o){delete It.REGISTERED_PROTOCOLS[o]},m.bk=function(o,i){const u={};for(let v=0;v<o.length;v++){const E=i&&i[o[v].id]||ss(o[v]);i&&(i[o[v].id]=E);let A=u[E];A||(A=u[E]=[]),A.push(o[v])}const g=[];for(const v in u)g.push(u[v]);return g},m.bl=Qt,m.bm=gg,m.bn=yg,m.bo=Km,m.bp=function(o){o.bucket.createArrays(),o.bucket.tilePixelRatio=ar/(512*o.bucket.overscaling),o.bucket.compareText={},o.bucket.iconsNeedLinear=!1;const i=o.bucket.layers[0],u=i.layout,g=i._unevaluatedLayout._values,v={layoutIconSize:g["icon-size"].possiblyEvaluate(new Ei(o.bucket.zoom+1),o.canonical),layoutTextSize:g["text-size"].possiblyEvaluate(new Ei(o.bucket.zoom+1),o.canonical),textMaxSize:g["text-size"].possiblyEvaluate(new Ei(18))};if(o.bucket.textSizeData.kind==="composite"){const{minZoom:F,maxZoom:j}=o.bucket.textSizeData;v.compositeTextSizes=[g["text-size"].possiblyEvaluate(new Ei(F),o.canonical),g["text-size"].possiblyEvaluate(new Ei(j),o.canonical)]}if(o.bucket.iconSizeData.kind==="composite"){const{minZoom:F,maxZoom:j}=o.bucket.iconSizeData;v.compositeIconSizes=[g["icon-size"].possiblyEvaluate(new Ei(F),o.canonical),g["icon-size"].possiblyEvaluate(new Ei(j),o.canonical)]}const E=u.get("text-line-height")*pr,A=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point",M=u.get("text-keep-upright"),P=u.get("text-size");for(const F of o.bucket.features){const j=u.get("text-font").evaluate(F,{},o.canonical).join(","),G=P.evaluate(F,{},o.canonical),W=v.layoutTextSize.evaluate(F,{},o.canonical),te=v.layoutIconSize.evaluate(F,{},o.canonical),re={horizontal:{},vertical:void 0},de=F.text;let Ce,De=[0,0];if(de){const Qe=de.toString(),ht=u.get("text-letter-spacing").evaluate(F,{},o.canonical)*pr,Et=ad(Qe)?ht:0,Wt=u.get("text-anchor").evaluate(F,{},o.canonical),_n=Lg(i,F,o.canonical);if(!_n){const tn=u.get("text-radial-offset").evaluate(F,{},o.canonical);De=tn?Cg(Wt,[tn*pr,Gd]):u.get("text-offset").evaluate(F,{},o.canonical).map(Yt=>Yt*pr)}let Ht=A?"center":u.get("text-justify").evaluate(F,{},o.canonical);const Gt=u.get("symbol-placement")==="point"?u.get("text-max-width").evaluate(F,{},o.canonical)*pr:1/0,on=()=>{o.bucket.allowVerticalPlacement&&Oc(Qe)&&(re.vertical=of(de,o.glyphMap,o.glyphPositions,o.imagePositions,j,Gt,E,Wt,"left",Et,De,m.ah.vertical,!0,W,G))};if(!A&&_n){const tn=new Set;if(Ht==="auto")for(let yt=0;yt<_n.values.length;yt+=2)tn.add(Zd(_n.values[yt]));else tn.add(Ht);let Yt=!1;for(const yt of tn)if(!re.horizontal[yt])if(Yt)re.horizontal[yt]=re.horizontal[0];else{const cn=of(de,o.glyphMap,o.glyphPositions,o.imagePositions,j,Gt,E,"center",yt,Et,De,m.ah.horizontal,!1,W,G);cn&&(re.horizontal[yt]=cn,Yt=cn.positionedLines.length===1)}on()}else{Ht==="auto"&&(Ht=Zd(Wt));const tn=of(de,o.glyphMap,o.glyphPositions,o.imagePositions,j,Gt,E,Wt,Ht,Et,De,m.ah.horizontal,!1,W,G);tn&&(re.horizontal[Ht]=tn),on(),Oc(Qe)&&A&&M&&(re.vertical=of(de,o.glyphMap,o.glyphPositions,o.imagePositions,j,Gt,E,Wt,Ht,Et,De,m.ah.vertical,!1,W,G))}}let nt=!1;if(F.icon&&F.icon.name){const Qe=o.imageMap[F.icon.name];Qe&&(Ce=vb(o.imagePositions[F.icon.name],u.get("icon-offset").evaluate(F,{},o.canonical),u.get("icon-anchor").evaluate(F,{},o.canonical)),nt=!!Qe.sdf,o.bucket.sdfIcons===void 0?o.bucket.sdfIcons=nt:o.bucket.sdfIcons!==nt&&Ue("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Qe.pixelRatio!==o.bucket.pixelRatio||u.get("icon-rotate").constantOr(1)!==0)&&(o.bucket.iconsNeedLinear=!0))}const Ge=Rg(re.horizontal)||re.vertical;o.bucket.iconsInText=!!Ge&&Ge.iconsInText,(Ge||Ce)&&Nb(o.bucket,F,re,Ce,o.imageMap,v,W,te,De,nt,o.canonical)}o.showCollisionBoxes&&o.bucket.generateCollisionDebugBuffers()},m.bq=Cd,m.br=Ed,m.bs=Td,m.bt=al,m.bu=Md,m.bv=class{constructor(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let o=performance.getEntriesByName(this._marks.measure);return o.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),o=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),o}},m.bw=function(o,i,u,g,v){return l(this,void 0,void 0,function*(){if(Q())try{return yield Ut(o,i,u,g,v)}catch{}return function(E,A,M,P,F){const j=E.width,G=E.height;vt&&kt||(vt=new OffscreenCanvas(j,G),kt=vt.getContext("2d",{willReadFrequently:!0})),vt.width=j,vt.height=G,kt.drawImage(E,0,0,j,G);const W=kt.getImageData(A,M,P,F);return kt.clearRect(0,0,j,G),W.data}(o,i,u,g,v)})},m.bx=mg,m.by=x,m.bz=S,m.c=wt,m.d=o=>l(void 0,void 0,void 0,function*(){if(o.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(o)],{type:"image/png"});try{return createImageBitmap(i)}catch(u){throw new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),m.e=ce,m.f=o=>new Promise((i,u)=>{const g=new Image;g.onload=()=>{i(g),URL.revokeObjectURL(g.src),g.onload=null,window.requestAnimationFrame(()=>{g.src=ut})},g.onerror=()=>u(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(o)],{type:"image/png"});g.src=o.byteLength?URL.createObjectURL(v):ut}),m.g=$t,m.h=(o,i)=>Wn(ce(o,{type:"json"}),i),m.i=pt,m.j=Ye,m.k=lt,m.l=(o,i)=>Wn(ce(o,{type:"arrayBuffer"}),i),m.m=Wn,m.n=function(o){return new Md(o).readFields(fb,[])},m.o=Xc,m.p=Wm,m.q=k,m.r=sd,m.s=dn,m.t=Nc,m.u=ka,m.v=Ke,m.w=Ue,m.x=function([o,i,u]){return i+=90,i*=Math.PI/180,u*=Math.PI/180,{x:o*Math.cos(i)*Math.sin(u),y:o*Math.sin(i)*Math.sin(u),z:o*Math.cos(u)}},m.y=xi,m.z=Ei}),a("worker",["./shared"],function(m){class l{constructor(J){this.keyCache={},J&&this.replace(J)}replace(J){this._layerConfigs={},this._layers={},this.update(J,[])}update(J,$){for(const ue of J){this._layerConfigs[ue.id]=ue;const fe=this._layers[ue.id]=m.aA(ue);fe._featureFilter=m.a7(fe.filter),this.keyCache[ue.id]&&delete this.keyCache[ue.id]}for(const ue of $)delete this.keyCache[ue],delete this._layerConfigs[ue],delete this._layers[ue];this.familiesBySource={};const he=m.bk(Object.values(this._layerConfigs),this.keyCache);for(const ue of he){const fe=ue.map(at=>this._layers[at.id]),je=fe[0];if(je.visibility==="none")continue;const Xe=je.source||"";let Pe=this.familiesBySource[Xe];Pe||(Pe=this.familiesBySource[Xe]={});const et=je.sourceLayer||"_geojsonTileLayer";let gt=Pe[et];gt||(gt=Pe[et]=[]),gt.push(fe)}}}class x{constructor(J){const $={},he=[];for(const Xe in J){const Pe=J[Xe],et=$[Xe]={};for(const gt in Pe){const at=Pe[+gt];if(!at||at.bitmap.width===0||at.bitmap.height===0)continue;const Dt={x:0,y:0,w:at.bitmap.width+2,h:at.bitmap.height+2};he.push(Dt),et[gt]={rect:Dt,metrics:at.metrics}}}const{w:ue,h:fe}=m.p(he),je=new m.o({width:ue||1,height:fe||1});for(const Xe in J){const Pe=J[Xe];for(const et in Pe){const gt=Pe[+et];if(!gt||gt.bitmap.width===0||gt.bitmap.height===0)continue;const at=$[Xe][et].rect;m.o.copy(gt.bitmap,je,{x:0,y:0},{x:at.x+1,y:at.y+1},gt.bitmap)}}this.image=je,this.positions=$}}m.bl("GlyphAtlas",x);class S{constructor(J){this.tileID=new m.S(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.uid=J.uid,this.zoom=J.zoom,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.collectResourceTiming,this.returnDependencies=!!J.returnDependencies,this.promoteId=J.promoteId,this.inFlightDependencies=[]}parse(J,$,he,ue){return m._(this,void 0,void 0,function*(){this.status="parsing",this.data=J,this.collisionBoxArray=new m.a5;const fe=new m.bm(Object.keys(J.layers).sort()),je=new m.bn(this.tileID,this.promoteId);je.bucketLayerIDs=[];const Xe={},Pe={featureIndex:je,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:he},et=$.familiesBySource[this.source];for(const En in et){const ri=J.layers[En];if(!ri)continue;ri.version===1&&m.w(`Vector tile source "${this.source}" layer "${En}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const fi=fe.encode(En),Di=[];for(let Kn=0;Kn<ri.length;Kn++){const Tr=ri.feature(Kn),No=je.getId(Tr,En);Di.push({feature:Tr,id:No,index:Kn,sourceLayerIndex:fi})}for(const Kn of et[En]){const Tr=Kn[0];Tr.source!==this.source&&m.w(`layer.source = ${Tr.source} does not equal this.source = ${this.source}`),Tr.minzoom&&this.zoom<Math.floor(Tr.minzoom)||Tr.maxzoom&&this.zoom>=Tr.maxzoom||Tr.visibility!=="none"&&(T(Kn,this.zoom,he),(Xe[Tr.id]=Tr.createBucket({index:je.bucketLayerIDs.length,layers:Kn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:fi,sourceID:this.source})).populate(Di,Pe,this.tileID.canonical),je.bucketLayerIDs.push(Kn.map(No=>No.id)))}}const gt=m.aF(Pe.glyphDependencies,En=>Object.keys(En).map(Number));this.inFlightDependencies.forEach(En=>En==null?void 0:En.abort()),this.inFlightDependencies=[];let at=Promise.resolve({});if(Object.keys(gt).length){const En=new AbortController;this.inFlightDependencies.push(En),at=ue.sendAsync({type:"GG",data:{stacks:gt,source:this.source,tileID:this.tileID,type:"glyphs"}},En)}const Dt=Object.keys(Pe.iconDependencies);let en=Promise.resolve({});if(Dt.length){const En=new AbortController;this.inFlightDependencies.push(En),en=ue.sendAsync({type:"GI",data:{icons:Dt,source:this.source,tileID:this.tileID,type:"icons"}},En)}const ln=Object.keys(Pe.patternDependencies);let Gn=Promise.resolve({});if(ln.length){const En=new AbortController;this.inFlightDependencies.push(En),Gn=ue.sendAsync({type:"GI",data:{icons:ln,source:this.source,tileID:this.tileID,type:"patterns"}},En)}const[Tn,Cn,Un]=yield Promise.all([at,en,Gn]),Ii=new x(Tn),ci=new m.bo(Cn,Un);for(const En in Xe){const ri=Xe[En];ri instanceof m.a6?(T(ri.layers,this.zoom,he),m.bp({bucket:ri,glyphMap:Tn,glyphPositions:Ii.positions,imageMap:Cn,imagePositions:ci.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ri.hasPattern&&(ri instanceof m.bq||ri instanceof m.br||ri instanceof m.bs)&&(T(ri.layers,this.zoom,he),ri.addFeatures(Pe,this.tileID.canonical,ci.patternPositions))}return this.status="done",{buckets:Object.values(Xe).filter(En=>!En.isEmpty()),featureIndex:je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ii.image,imageAtlas:ci,glyphMap:this.returnDependencies?Tn:null,iconMap:this.returnDependencies?Cn:null,glyphPositions:this.returnDependencies?Ii.positions:null}})}}function T(Re,J,$){const he=new m.z(J);for(const ue of Re)ue.recalculate(he,$)}class C{constructor(J,$,he){this.actor=J,this.layerIndex=$,this.availableImages=he,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(J,$){return m._(this,void 0,void 0,function*(){const he=yield m.l(J.request,$);try{return{vectorTile:new m.bt.VectorTile(new m.bu(he.data)),rawData:he.data,cacheControl:he.cacheControl,expires:he.expires}}catch(ue){const fe=new Uint8Array(he.data);let je=`Unable to parse the tile at ${J.request.url}, `;throw je+=fe[0]===31&&fe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ue.message}`,new Error(je)}})}loadTile(J){return m._(this,void 0,void 0,function*(){const $=J.uid,he=!!(J&&J.request&&J.request.collectResourceTiming)&&new m.bv(J.request),ue=new S(J);this.loading[$]=ue;const fe=new AbortController;ue.abort=fe;try{const je=yield this.loadVectorTile(J,fe);if(delete this.loading[$],!je)return null;const Xe=je.rawData,Pe={};je.expires&&(Pe.expires=je.expires),je.cacheControl&&(Pe.cacheControl=je.cacheControl);const et={};if(he){const at=he.finish();at&&(et.resourceTiming=JSON.parse(JSON.stringify(at)))}ue.vectorTile=je.vectorTile;const gt=ue.parse(je.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[$]=ue,this.fetching[$]={rawTileData:Xe,cacheControl:Pe,resourceTiming:et};try{const at=yield gt;return m.e({rawTileData:Xe.slice(0)},at,Pe,et)}finally{delete this.fetching[$]}}catch(je){throw delete this.loading[$],ue.status="done",this.loaded[$]=ue,je}})}reloadTile(J){return m._(this,void 0,void 0,function*(){const $=J.uid;if(!this.loaded||!this.loaded[$])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const he=this.loaded[$];if(he.showCollisionBoxes=J.showCollisionBoxes,he.status==="parsing"){const ue=yield he.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor);let fe;if(this.fetching[$]){const{rawTileData:je,cacheControl:Xe,resourceTiming:Pe}=this.fetching[$];delete this.fetching[$],fe=m.e({rawTileData:je.slice(0)},ue,Xe,Pe)}else fe=ue;return fe}if(he.status==="done"&&he.vectorTile)return he.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(J){return m._(this,void 0,void 0,function*(){const $=this.loading,he=J.uid;$&&$[he]&&$[he].abort&&($[he].abort.abort(),delete $[he])})}removeTile(J){return m._(this,void 0,void 0,function*(){this.loaded&&this.loaded[J.uid]&&delete this.loaded[J.uid]})}}class N{constructor(){this.loaded={}}loadTile(J){return m._(this,void 0,void 0,function*(){const{uid:$,encoding:he,rawImageData:ue,redFactor:fe,greenFactor:je,blueFactor:Xe,baseShift:Pe}=J,et=ue.width+2,gt=ue.height+2,at=m.b(ue)?new m.R({width:et,height:gt},yield m.bw(ue,-1,-1,et,gt)):ue,Dt=new m.bx($,at,he,fe,je,Xe,Pe);return this.loaded=this.loaded||{},this.loaded[$]=Dt,Dt})}removeTile(J){const $=this.loaded,he=J.uid;$&&$[he]&&delete $[he]}}function B(Re,J){if(Re.length!==0){U(Re[0],J);for(var $=1;$<Re.length;$++)U(Re[$],!J)}}function U(Re,J){for(var $=0,he=0,ue=0,fe=Re.length,je=fe-1;ue<fe;je=ue++){var Xe=(Re[ue][0]-Re[je][0])*(Re[je][1]+Re[ue][1]),Pe=$+Xe;he+=Math.abs($)>=Math.abs(Xe)?$-Pe+Xe:Xe-Pe+$,$=Pe}$+he>=0!=!!J&&Re.reverse()}var ee=m.by(function Re(J,$){var he,ue=J&&J.type;if(ue==="FeatureCollection")for(he=0;he<J.features.length;he++)Re(J.features[he],$);else if(ue==="GeometryCollection")for(he=0;he<J.geometries.length;he++)Re(J.geometries[he],$);else if(ue==="Feature")Re(J.geometry,$);else if(ue==="Polygon")B(J.coordinates,$);else if(ue==="MultiPolygon")for(he=0;he<J.coordinates.length;he++)B(J.coordinates[he],$);return J});const ie=m.bt.VectorTileFeature.prototype.toGeoJSON;var se={exports:{}},Q=m.bz,Y=m.bt.VectorTileFeature,_e=ve;function ve(Re,J){this.options=J||{},this.features=Re,this.length=Re.length}function Ae(Re,J){this.id=typeof Re.id=="number"?Re.id:void 0,this.type=Re.type,this.rawGeometry=Re.type===1?[Re.geometry]:Re.geometry,this.properties=Re.tags,this.extent=J||4096}ve.prototype.feature=function(Re){return new Ae(this.features[Re],this.options.extent)},Ae.prototype.loadGeometry=function(){var Re=this.rawGeometry;this.geometry=[];for(var J=0;J<Re.length;J++){for(var $=Re[J],he=[],ue=0;ue<$.length;ue++)he.push(new Q($[ue][0],$[ue][1]));this.geometry.push(he)}return this.geometry},Ae.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Re=this.geometry,J=1/0,$=-1/0,he=1/0,ue=-1/0,fe=0;fe<Re.length;fe++)for(var je=Re[fe],Xe=0;Xe<je.length;Xe++){var Pe=je[Xe];J=Math.min(J,Pe.x),$=Math.max($,Pe.x),he=Math.min(he,Pe.y),ue=Math.max(ue,Pe.y)}return[J,he,$,ue]},Ae.prototype.toGeoJSON=Y.prototype.toGeoJSON;var ce=m.bA,xe=_e;function be(Re){var J=new ce;return function($,he){for(var ue in $.layers)he.writeMessage(3,Le,$.layers[ue])}(Re,J),J.finish()}function Le(Re,J){var $;J.writeVarintField(15,Re.version||1),J.writeStringField(1,Re.name||""),J.writeVarintField(5,Re.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for($=0;$<Re.length;$++)he.feature=Re.feature($),J.writeMessage(2,ke,he);var ue=he.keys;for($=0;$<ue.length;$++)J.writeStringField(3,ue[$]);var fe=he.values;for($=0;$<fe.length;$++)J.writeMessage(4,St,fe[$])}function ke(Re,J){var $=Re.feature;$.id!==void 0&&J.writeVarintField(1,$.id),J.writeMessage(2,ye,Re),J.writeVarintField(3,$.type),J.writeMessage(4,pt,$)}function ye(Re,J){var $=Re.feature,he=Re.keys,ue=Re.values,fe=Re.keycache,je=Re.valuecache;for(var Xe in $.properties){var Pe=$.properties[Xe],et=fe[Xe];if(Pe!==null){et===void 0&&(he.push(Xe),fe[Xe]=et=he.length-1),J.writeVarint(et);var gt=typeof Pe;gt!=="string"&&gt!=="boolean"&&gt!=="number"&&(Pe=JSON.stringify(Pe));var at=gt+":"+Pe,Dt=je[at];Dt===void 0&&(ue.push(Pe),je[at]=Dt=ue.length-1),J.writeVarint(Dt)}}}function Ue(Re,J){return(J<<3)+(7&Re)}function qe(Re){return Re<<1^Re>>31}function pt(Re,J){for(var $=Re.loadGeometry(),he=Re.type,ue=0,fe=0,je=$.length,Xe=0;Xe<je;Xe++){var Pe=$[Xe],et=1;he===1&&(et=Pe.length),J.writeVarint(Ue(1,et));for(var gt=he===3?Pe.length-1:Pe.length,at=0;at<gt;at++){at===1&&he!==1&&J.writeVarint(Ue(2,gt-1));var Dt=Pe[at].x-ue,en=Pe[at].y-fe;J.writeVarint(qe(Dt)),J.writeVarint(qe(en)),ue+=Dt,fe+=en}he===3&&J.writeVarint(Ue(7,1))}}function St(Re,J){var $=typeof Re;$==="string"?J.writeStringField(1,Re):$==="boolean"?J.writeBooleanField(7,Re):$==="number"&&(Re%1!=0?J.writeDoubleField(3,Re):Re<0?J.writeSVarintField(6,Re):J.writeVarintField(5,Re))}se.exports=be,se.exports.fromVectorTileJs=be,se.exports.fromGeojsonVt=function(Re,J){J=J||{};var $={};for(var he in Re)$[he]=new xe(Re[he].features,J),$[he].name=he,$[he].version=J.version,$[he].extent=J.extent;return be({layers:$})},se.exports.GeoJSONWrapper=xe;var dt=m.by(se.exports);const ut={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Re=>Re},Ut=Math.fround||(vt=new Float32Array(1),Re=>(vt[0]=+Re,vt[0]));var vt;const kt=3,ft=5,wt=6;class It{constructor(J){this.options=Object.assign(Object.create(ut),J),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(J){const{log:$,minZoom:he,maxZoom:ue}=this.options;$&&console.time("total time");const fe=`prepare ${J.length} points`;$&&console.time(fe),this.points=J;const je=[];for(let Pe=0;Pe<J.length;Pe++){const et=J[Pe];if(!et.geometry)continue;const[gt,at]=et.geometry.coordinates,Dt=Ut(Pn(gt)),en=Ut(We(at));je.push(Dt,en,1/0,Pe,-1,1),this.options.reduce&&je.push(0)}let Xe=this.trees[ue+1]=this._createTree(je);$&&console.timeEnd(fe);for(let Pe=ue;Pe>=he;Pe--){const et=+Date.now();Xe=this.trees[Pe]=this._createTree(this._cluster(Xe,Pe)),$&&console.log("z%d: %d clusters in %dms",Pe,Xe.numItems,+Date.now()-et)}return $&&console.timeEnd("total time"),this}getClusters(J,$){let he=((J[0]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,J[1]));let fe=J[2]===180?180:((J[2]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)he=-180,fe=180;else if(he>fe){const at=this.getClusters([he,ue,180,je],$),Dt=this.getClusters([-180,ue,fe,je],$);return at.concat(Dt)}const Xe=this.trees[this._limitZoom($)],Pe=Xe.range(Pn(he),We(je),Pn(fe),We(ue)),et=Xe.data,gt=[];for(const at of Pe){const Dt=this.stride*at;gt.push(et[Dt+ft]>1?$t(et,Dt,this.clusterProps):this.points[et[Dt+kt]])}return gt}getChildren(J){const $=this._getOriginId(J),he=this._getOriginZoom(J),ue="No cluster with the specified id.",fe=this.trees[he];if(!fe)throw new Error(ue);const je=fe.data;if($*this.stride>=je.length)throw new Error(ue);const Xe=this.options.radius/(this.options.extent*Math.pow(2,he-1)),Pe=fe.within(je[$*this.stride],je[$*this.stride+1],Xe),et=[];for(const gt of Pe){const at=gt*this.stride;je[at+4]===J&&et.push(je[at+ft]>1?$t(je,at,this.clusterProps):this.points[je[at+kt]])}if(et.length===0)throw new Error(ue);return et}getLeaves(J,$,he){const ue=[];return this._appendLeaves(ue,J,$=$||10,he=he||0,0),ue}getTile(J,$,he){const ue=this.trees[this._limitZoom(J)],fe=Math.pow(2,J),{extent:je,radius:Xe}=this.options,Pe=Xe/je,et=(he-Pe)/fe,gt=(he+1+Pe)/fe,at={features:[]};return this._addTileFeatures(ue.range(($-Pe)/fe,et,($+1+Pe)/fe,gt),ue.data,$,he,fe,at),$===0&&this._addTileFeatures(ue.range(1-Pe/fe,et,1,gt),ue.data,fe,he,fe,at),$===fe-1&&this._addTileFeatures(ue.range(0,et,Pe/fe,gt),ue.data,-1,he,fe,at),at.features.length?at:null}getClusterExpansionZoom(J){let $=this._getOriginZoom(J)-1;for(;$<=this.options.maxZoom;){const he=this.getChildren(J);if($++,he.length!==1)break;J=he[0].properties.cluster_id}return $}_appendLeaves(J,$,he,ue,fe){const je=this.getChildren($);for(const Xe of je){const Pe=Xe.properties;if(Pe&&Pe.cluster?fe+Pe.point_count<=ue?fe+=Pe.point_count:fe=this._appendLeaves(J,Pe.cluster_id,he,ue,fe):fe<ue?fe++:J.push(Xe),J.length===he)break}return fe}_createTree(J){const $=new m.av(J.length/this.stride|0,this.options.nodeSize,Float32Array);for(let he=0;he<J.length;he+=this.stride)$.add(J[he],J[he+1]);return $.finish(),$.data=J,$}_addTileFeatures(J,$,he,ue,fe,je){for(const Xe of J){const Pe=Xe*this.stride,et=$[Pe+ft]>1;let gt,at,Dt;if(et)gt=pn($,Pe,this.clusterProps),at=$[Pe],Dt=$[Pe+1];else{const Gn=this.points[$[Pe+kt]];gt=Gn.properties;const[Tn,Cn]=Gn.geometry.coordinates;at=Pn(Tn),Dt=We(Cn)}const en={type:1,geometry:[[Math.round(this.options.extent*(at*fe-he)),Math.round(this.options.extent*(Dt*fe-ue))]],tags:gt};let ln;ln=et||this.options.generateId?$[Pe+kt]:this.points[$[Pe+kt]].id,ln!==void 0&&(en.id=ln),je.features.push(en)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(Math.floor(+J),this.options.maxZoom+1))}_cluster(J,$){const{radius:he,extent:ue,reduce:fe,minPoints:je}=this.options,Xe=he/(ue*Math.pow(2,$)),Pe=J.data,et=[],gt=this.stride;for(let at=0;at<Pe.length;at+=gt){if(Pe[at+2]<=$)continue;Pe[at+2]=$;const Dt=Pe[at],en=Pe[at+1],ln=J.within(Pe[at],Pe[at+1],Xe),Gn=Pe[at+ft];let Tn=Gn;for(const Cn of ln){const Un=Cn*gt;Pe[Un+2]>$&&(Tn+=Pe[Un+ft])}if(Tn>Gn&&Tn>=je){let Cn,Un=Dt*Gn,Ii=en*Gn,ci=-1;const En=((at/gt|0)<<5)+($+1)+this.points.length;for(const ri of ln){const fi=ri*gt;if(Pe[fi+2]<=$)continue;Pe[fi+2]=$;const Di=Pe[fi+ft];Un+=Pe[fi]*Di,Ii+=Pe[fi+1]*Di,Pe[fi+4]=En,fe&&(Cn||(Cn=this._map(Pe,at,!0),ci=this.clusterProps.length,this.clusterProps.push(Cn)),fe(Cn,this._map(Pe,fi)))}Pe[at+4]=En,et.push(Un/Tn,Ii/Tn,1/0,En,-1,Tn),fe&&et.push(ci)}else{for(let Cn=0;Cn<gt;Cn++)et.push(Pe[at+Cn]);if(Tn>1)for(const Cn of ln){const Un=Cn*gt;if(!(Pe[Un+2]<=$)){Pe[Un+2]=$;for(let Ii=0;Ii<gt;Ii++)et.push(Pe[Un+Ii])}}}}return et}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,$,he){if(J[$+ft]>1){const je=this.clusterProps[J[$+wt]];return he?Object.assign({},je):je}const ue=this.points[J[$+kt]].properties,fe=this.options.map(ue);return he&&fe===ue?Object.assign({},fe):fe}}function $t(Re,J,$){return{type:"Feature",id:Re[J+kt],properties:pn(Re,J,$),geometry:{type:"Point",coordinates:[(he=Re[J],360*(he-.5)),Wn(Re[J+1])]}};var he}function pn(Re,J,$){const he=Re[J+ft],ue=he>=1e4?`${Math.round(he/1e3)}k`:he>=1e3?Math.round(he/100)/10+"k":he,fe=Re[J+wt],je=fe===-1?{}:Object.assign({},$[fe]);return Object.assign(je,{cluster:!0,cluster_id:Re[J+kt],point_count:he,point_count_abbreviated:ue})}function Pn(Re){return Re/360+.5}function We(Re){const J=Math.sin(Re*Math.PI/180),$=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return $<0?0:$>1?1:$}function Wn(Re){const J=(180-360*Re)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}function dn(Re,J,$,he){let ue=he;const fe=J+($-J>>1);let je,Xe=$-J;const Pe=Re[J],et=Re[J+1],gt=Re[$],at=Re[$+1];for(let Dt=J+3;Dt<$;Dt+=3){const en=Ot(Re[Dt],Re[Dt+1],Pe,et,gt,at);if(en>ue)je=Dt,ue=en;else if(en===ue){const ln=Math.abs(Dt-fe);ln<Xe&&(je=Dt,Xe=ln)}}ue>he&&(je-J>3&&dn(Re,J,je,he),Re[je+2]=ue,$-je>3&&dn(Re,je,$,he))}function Ot(Re,J,$,he,ue,fe){let je=ue-$,Xe=fe-he;if(je!==0||Xe!==0){const Pe=((Re-$)*je+(J-he)*Xe)/(je*je+Xe*Xe);Pe>1?($=ue,he=fe):Pe>0&&($+=je*Pe,he+=Xe*Pe)}return je=Re-$,Xe=J-he,je*je+Xe*Xe}function Ee(Re,J,$,he){const ue={id:Re??null,type:J,geometry:$,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(J==="Point"||J==="MultiPoint"||J==="LineString")lt(ue,$);else if(J==="Polygon")lt(ue,$[0]);else if(J==="MultiLineString")for(const fe of $)lt(ue,fe);else if(J==="MultiPolygon")for(const fe of $)lt(ue,fe[0]);return ue}function lt(Re,J){for(let $=0;$<J.length;$+=3)Re.minX=Math.min(Re.minX,J[$]),Re.minY=Math.min(Re.minY,J[$+1]),Re.maxX=Math.max(Re.maxX,J[$]),Re.maxY=Math.max(Re.maxY,J[$+1])}function Ye(Re,J,$,he){if(!J.geometry)return;const ue=J.geometry.coordinates;if(ue&&ue.length===0)return;const fe=J.geometry.type,je=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2);let Xe=[],Pe=J.id;if($.promoteId?Pe=J.properties[$.promoteId]:$.generateId&&(Pe=he||0),fe==="Point")Lt(ue,Xe);else if(fe==="MultiPoint")for(const et of ue)Lt(et,Xe);else if(fe==="LineString")Ke(ue,Xe,je,!1);else if(fe==="MultiLineString"){if($.lineMetrics){for(const et of ue)Xe=[],Ke(et,Xe,je,!1),Re.push(Ee(Pe,"LineString",Xe,J.properties));return}On(ue,Xe,je,!1)}else if(fe==="Polygon")On(ue,Xe,je,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(const et of J.geometry.geometries)Ye(Re,{id:Pe,geometry:et,properties:J.properties},$,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const et of ue){const gt=[];On(et,gt,je,!0),Xe.push(gt)}}Re.push(Ee(Pe,fe,Xe,J.properties))}function Lt(Re,J){J.push(bt(Re[0]),Ie(Re[1]),0)}function Ke(Re,J,$,he){let ue,fe,je=0;for(let Pe=0;Pe<Re.length;Pe++){const et=bt(Re[Pe][0]),gt=Ie(Re[Pe][1]);J.push(et,gt,0),Pe>0&&(je+=he?(ue*gt-et*fe)/2:Math.sqrt(Math.pow(et-ue,2)+Math.pow(gt-fe,2))),ue=et,fe=gt}const Xe=J.length-3;J[2]=1,dn(J,0,Xe,$),J[Xe+2]=1,J.size=Math.abs(je),J.start=0,J.end=J.size}function On(Re,J,$,he){for(let ue=0;ue<Re.length;ue++){const fe=[];Ke(Re[ue],fe,$,he),J.push(fe)}}function bt(Re){return Re/360+.5}function Ie(Re){const J=Math.sin(Re*Math.PI/180),$=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return $<0?0:$>1?1:$}function Bt(Re,J,$,he,ue,fe,je,Xe){if(he/=J,fe>=($/=J)&&je<he)return Re;if(je<$||fe>=he)return null;const Pe=[];for(const et of Re){const gt=et.geometry;let at=et.type;const Dt=ue===0?et.minX:et.minY,en=ue===0?et.maxX:et.maxY;if(Dt>=$&&en<he){Pe.push(et);continue}if(en<$||Dt>=he)continue;let ln=[];if(at==="Point"||at==="MultiPoint")Mn(gt,ln,$,he,ue);else if(at==="LineString")Nn(gt,ln,$,he,ue,!1,Xe.lineMetrics);else if(at==="MultiLineString")Jt(gt,ln,$,he,ue,!1);else if(at==="Polygon")Jt(gt,ln,$,he,ue,!0);else if(at==="MultiPolygon")for(const Gn of gt){const Tn=[];Jt(Gn,Tn,$,he,ue,!0),Tn.length&&ln.push(Tn)}if(ln.length){if(Xe.lineMetrics&&at==="LineString"){for(const Gn of ln)Pe.push(Ee(et.id,at,Gn,et.tags));continue}at!=="LineString"&&at!=="MultiLineString"||(ln.length===1?(at="LineString",ln=ln[0]):at="MultiLineString"),at!=="Point"&&at!=="MultiPoint"||(at=ln.length===3?"Point":"MultiPoint"),Pe.push(Ee(et.id,at,ln,et.tags))}}return Pe.length?Pe:null}function Mn(Re,J,$,he,ue){for(let fe=0;fe<Re.length;fe+=3){const je=Re[fe+ue];je>=$&&je<=he&&Ri(J,Re[fe],Re[fe+1],Re[fe+2])}}function Nn(Re,J,$,he,ue,fe,je){let Xe=Qn(Re);const Pe=ue===0?Yi:Jr;let et,gt,at=Re.start;for(let Tn=0;Tn<Re.length-3;Tn+=3){const Cn=Re[Tn],Un=Re[Tn+1],Ii=Re[Tn+2],ci=Re[Tn+3],En=Re[Tn+4],ri=ue===0?Cn:Un,fi=ue===0?ci:En;let Di=!1;je&&(et=Math.sqrt(Math.pow(Cn-ci,2)+Math.pow(Un-En,2))),ri<$?fi>$&&(gt=Pe(Xe,Cn,Un,ci,En,$),je&&(Xe.start=at+et*gt)):ri>he?fi<he&&(gt=Pe(Xe,Cn,Un,ci,En,he),je&&(Xe.start=at+et*gt)):Ri(Xe,Cn,Un,Ii),fi<$&&ri>=$&&(gt=Pe(Xe,Cn,Un,ci,En,$),Di=!0),fi>he&&ri<=he&&(gt=Pe(Xe,Cn,Un,ci,En,he),Di=!0),!fe&&Di&&(je&&(Xe.end=at+et*gt),J.push(Xe),Xe=Qn(Re)),je&&(at+=et)}let Dt=Re.length-3;const en=Re[Dt],ln=Re[Dt+1],Gn=ue===0?en:ln;Gn>=$&&Gn<=he&&Ri(Xe,en,ln,Re[Dt+2]),Dt=Xe.length-3,fe&&Dt>=3&&(Xe[Dt]!==Xe[0]||Xe[Dt+1]!==Xe[1])&&Ri(Xe,Xe[0],Xe[1],Xe[2]),Xe.length&&J.push(Xe)}function Qn(Re){const J=[];return J.size=Re.size,J.start=Re.start,J.end=Re.end,J}function Jt(Re,J,$,he,ue,fe){for(const je of Re)Nn(je,J,$,he,ue,fe,!1)}function Ri(Re,J,$,he){Re.push(J,$,he)}function Yi(Re,J,$,he,ue,fe){const je=(fe-J)/(he-J);return Ri(Re,fe,$+(ue-$)*je,1),je}function Jr(Re,J,$,he,ue,fe){const je=(fe-$)/(ue-$);return Ri(Re,J+(he-J)*je,fe,1),je}function ct(Re,J){const $=[];for(let he=0;he<Re.length;he++){const ue=Re[he],fe=ue.type;let je;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")je=yr(ue.geometry,J);else if(fe==="MultiLineString"||fe==="Polygon"){je=[];for(const Xe of ue.geometry)je.push(yr(Xe,J))}else if(fe==="MultiPolygon"){je=[];for(const Xe of ue.geometry){const Pe=[];for(const et of Xe)Pe.push(yr(et,J));je.push(Pe)}}$.push(Ee(ue.id,fe,je,ue.tags))}return $}function yr(Re,J){const $=[];$.size=Re.size,Re.start!==void 0&&($.start=Re.start,$.end=Re.end);for(let he=0;he<Re.length;he+=3)$.push(Re[he]+J,Re[he+1],Re[he+2]);return $}function xn(Re,J){if(Re.transformed)return Re;const $=1<<Re.z,he=Re.x,ue=Re.y;for(const fe of Re.features){const je=fe.geometry,Xe=fe.type;if(fe.geometry=[],Xe===1)for(let Pe=0;Pe<je.length;Pe+=2)fe.geometry.push(mn(je[Pe],je[Pe+1],J,$,he,ue));else for(let Pe=0;Pe<je.length;Pe++){const et=[];for(let gt=0;gt<je[Pe].length;gt+=2)et.push(mn(je[Pe][gt],je[Pe][gt+1],J,$,he,ue));fe.geometry.push(et)}}return Re.transformed=!0,Re}function mn(Re,J,$,he,ue,fe){return[Math.round($*(Re*he-ue)),Math.round($*(J*he-fe))]}function Ms(Re,J,$,he,ue){const fe=J===ue.maxZoom?0:ue.tolerance/((1<<J)*ue.extent),je={features:[],numPoints:0,numSimplified:0,numFeatures:Re.length,source:null,x:$,y:he,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Xe of Re)Mt(je,Xe,fe,ue);return je}function Mt(Re,J,$,he){const ue=J.geometry,fe=J.type,je=[];if(Re.minX=Math.min(Re.minX,J.minX),Re.minY=Math.min(Re.minY,J.minY),Re.maxX=Math.max(Re.maxX,J.maxX),Re.maxY=Math.max(Re.maxY,J.maxY),fe==="Point"||fe==="MultiPoint")for(let Xe=0;Xe<ue.length;Xe+=3)je.push(ue[Xe],ue[Xe+1]),Re.numPoints++,Re.numSimplified++;else if(fe==="LineString")An(je,ue,Re,$,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(let Xe=0;Xe<ue.length;Xe++)An(je,ue[Xe],Re,$,fe==="Polygon",Xe===0);else if(fe==="MultiPolygon")for(let Xe=0;Xe<ue.length;Xe++){const Pe=ue[Xe];for(let et=0;et<Pe.length;et++)An(je,Pe[et],Re,$,!0,et===0)}if(je.length){let Xe=J.tags||null;if(fe==="LineString"&&he.lineMetrics){Xe={};for(const et in J.tags)Xe[et]=J.tags[et];Xe.mapbox_clip_start=ue.start/ue.size,Xe.mapbox_clip_end=ue.end/ue.size}const Pe={geometry:je,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:Xe};J.id!==null&&(Pe.id=J.id),Re.features.push(Pe)}}function An(Re,J,$,he,ue,fe){const je=he*he;if(he>0&&J.size<(ue?je:he))return void($.numPoints+=J.length/3);const Xe=[];for(let Pe=0;Pe<J.length;Pe+=3)(he===0||J[Pe+2]>je)&&($.numSimplified++,Xe.push(J[Pe],J[Pe+1])),$.numPoints++;ue&&function(Pe,et){let gt=0;for(let at=0,Dt=Pe.length,en=Dt-2;at<Dt;en=at,at+=2)gt+=(Pe[at]-Pe[en])*(Pe[at+1]+Pe[en+1]);if(gt>0===et)for(let at=0,Dt=Pe.length;at<Dt/2;at+=2){const en=Pe[at],ln=Pe[at+1];Pe[at]=Pe[Dt-2-at],Pe[at+1]=Pe[Dt-1-at],Pe[Dt-2-at]=en,Pe[Dt-1-at]=ln}}(Xe,fe),Re.push(Xe)}const At={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class vr{constructor(J,$){const he=($=this.options=function(fe,je){for(const Xe in je)fe[Xe]=je[Xe];return fe}(Object.create(At),$)).debug;if(he&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");let ue=function(fe,je){const Xe=[];if(fe.type==="FeatureCollection")for(let Pe=0;Pe<fe.features.length;Pe++)Ye(Xe,fe.features[Pe],je,Pe);else Ye(Xe,fe.type==="Feature"?fe:{geometry:fe},je);return Xe}(J,$);this.tiles={},this.tileCoords=[],he&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ue=function(fe,je){const Xe=je.buffer/je.extent;let Pe=fe;const et=Bt(fe,1,-1-Xe,Xe,0,-1,2,je),gt=Bt(fe,1,1-Xe,2+Xe,0,-1,2,je);return(et||gt)&&(Pe=Bt(fe,1,-Xe,1+Xe,0,-1,2,je)||[],et&&(Pe=ct(et,1).concat(Pe)),gt&&(Pe=Pe.concat(ct(gt,-1)))),Pe}(ue,$),ue.length&&this.splitTile(ue,0,0,0),he&&(ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(J,$,he,ue,fe,je,Xe){const Pe=[J,$,he,ue],et=this.options,gt=et.debug;for(;Pe.length;){ue=Pe.pop(),he=Pe.pop(),$=Pe.pop(),J=Pe.pop();const at=1<<$,Dt=Gr($,he,ue);let en=this.tiles[Dt];if(!en&&(gt>1&&console.time("creation"),en=this.tiles[Dt]=Ms(J,$,he,ue,et),this.tileCoords.push({z:$,x:he,y:ue}),gt)){gt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,he,ue,en.numFeatures,en.numPoints,en.numSimplified),console.timeEnd("creation"));const Di=`z${$}`;this.stats[Di]=(this.stats[Di]||0)+1,this.total++}if(en.source=J,fe==null){if($===et.indexMaxZoom||en.numPoints<=et.indexMaxPoints)continue}else{if($===et.maxZoom||$===fe)continue;if(fe!=null){const Di=fe-$;if(he!==je>>Di||ue!==Xe>>Di)continue}}if(en.source=null,J.length===0)continue;gt>1&&console.time("clipping");const ln=.5*et.buffer/et.extent,Gn=.5-ln,Tn=.5+ln,Cn=1+ln;let Un=null,Ii=null,ci=null,En=null,ri=Bt(J,at,he-ln,he+Tn,0,en.minX,en.maxX,et),fi=Bt(J,at,he+Gn,he+Cn,0,en.minX,en.maxX,et);J=null,ri&&(Un=Bt(ri,at,ue-ln,ue+Tn,1,en.minY,en.maxY,et),Ii=Bt(ri,at,ue+Gn,ue+Cn,1,en.minY,en.maxY,et),ri=null),fi&&(ci=Bt(fi,at,ue-ln,ue+Tn,1,en.minY,en.maxY,et),En=Bt(fi,at,ue+Gn,ue+Cn,1,en.minY,en.maxY,et),fi=null),gt>1&&console.timeEnd("clipping"),Pe.push(Un||[],$+1,2*he,2*ue),Pe.push(Ii||[],$+1,2*he,2*ue+1),Pe.push(ci||[],$+1,2*he+1,2*ue),Pe.push(En||[],$+1,2*he+1,2*ue+1)}}getTile(J,$,he){J=+J,$=+$,he=+he;const ue=this.options,{extent:fe,debug:je}=ue;if(J<0||J>24)return null;const Xe=1<<J,Pe=Gr(J,$=$+Xe&Xe-1,he);if(this.tiles[Pe])return xn(this.tiles[Pe],fe);je>1&&console.log("drilling down to z%d-%d-%d",J,$,he);let et,gt=J,at=$,Dt=he;for(;!et&&gt>0;)gt--,at>>=1,Dt>>=1,et=this.tiles[Gr(gt,at,Dt)];return et&&et.source?(je>1&&(console.log("found parent tile z%d-%d-%d",gt,at,Dt),console.time("drilling down")),this.splitTile(et.source,gt,at,Dt,J,$,he),je>1&&console.timeEnd("drilling down"),this.tiles[Pe]?xn(this.tiles[Pe],fe):null):null}}function Gr(Re,J,$){return 32*((1<<Re)*$+J)+Re}function bn(Re,J){return J?Re.properties[J]:Re.id}function Pi(Re,J){if(Re==null)return!0;if(Re.type==="Feature")return bn(Re,J)!=null;if(Re.type==="FeatureCollection"){const $=new Set;for(const he of Re.features){const ue=bn(he,J);if(ue==null||$.has(ue))return!1;$.add(ue)}return!0}return!1}function Ar(Re,J){const $=new Map;if(Re!=null)if(Re.type==="Feature")$.set(bn(Re,J),Re);else for(const he of Re.features)$.set(bn(he,J),he);return $}class Ji extends C{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(J,$){return m._(this,void 0,void 0,function*(){const he=J.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ue=this._geoJSONIndex.getTile(he.z,he.x,he.y);if(!ue)return null;const fe=new class{constructor(Xe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.X,this.length=Xe.length,this._features=Xe}feature(Xe){return new class{constructor(Pe){this._feature=Pe,this.extent=m.X,this.type=Pe.type,this.properties=Pe.tags,"id"in Pe&&!isNaN(Pe.id)&&(this.id=parseInt(Pe.id,10))}loadGeometry(){if(this._feature.type===1){const Pe=[];for(const et of this._feature.geometry)Pe.push([new m.P(et[0],et[1])]);return Pe}{const Pe=[];for(const et of this._feature.geometry){const gt=[];for(const at of et)gt.push(new m.P(at[0],at[1]));Pe.push(gt)}return Pe}}toGeoJSON(Pe,et,gt){return ie.call(this,Pe,et,gt)}}(this._features[Xe])}}(ue.features);let je=dt(fe);return je.byteOffset===0&&je.byteLength===je.buffer.byteLength||(je=new Uint8Array(je)),{vectorTile:fe,rawData:je.buffer}})}loadData(J){return m._(this,void 0,void 0,function*(){var $;($=this._pendingRequest)===null||$===void 0||$.abort();const he=!!(J&&J.request&&J.request.collectResourceTiming)&&new m.bv(J.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(J,this._pendingRequest),this._geoJSONIndex=J.cluster?new It(function({superclusterOptions:je,clusterProperties:Xe}){if(!Xe||!je)return je;const Pe={},et={},gt={accumulated:null,zoom:0},at={properties:null},Dt=Object.keys(Xe);for(const en of Dt){const[ln,Gn]=Xe[en],Tn=m.bC(Gn),Cn=m.bC(typeof ln=="string"?[ln,["accumulated"],["get",en]]:ln);Pe[en]=Tn.value,et[en]=Cn.value}return je.map=en=>{at.properties=en;const ln={};for(const Gn of Dt)ln[Gn]=Pe[Gn].evaluate(gt,at);return ln},je.reduce=(en,ln)=>{at.properties=ln;for(const Gn of Dt)gt.accumulated=en[Gn],en[Gn]=et[Gn].evaluate(gt,at)},je}(J)).load((yield this._pendingData).features):(ue=yield this._pendingData,new vr(ue,J.geojsonVtOptions)),this.loaded={};const fe={};if(he){const je=he.finish();je&&(fe.resourceTiming={},fe.resourceTiming[J.source]=JSON.parse(JSON.stringify(je)))}return fe}catch(fe){if(delete this._pendingRequest,m.bB(fe))return{abandoned:!0};throw fe}var ue})}getData(){return m._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(J){const $=this.loaded;return $&&$[J.uid]?super.reloadTile(J):this.loadTile(J)}loadAndProcessGeoJSON(J,$){return m._(this,void 0,void 0,function*(){let he=yield this.loadGeoJSON(J,$);if(delete this._pendingRequest,typeof he!="object")throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`);if(ee(he,!0),J.filter){const ue=m.bC(J.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ue.result==="error")throw new Error(ue.value.map(je=>`${je.key}: ${je.message}`).join(", "));he={type:"FeatureCollection",features:he.features.filter(je=>ue.value.evaluate({zoom:0},je))}}return he})}loadGeoJSON(J,$){return m._(this,void 0,void 0,function*(){const{promoteId:he}=J;if(J.request){const ue=yield m.h(J.request,$);return this._dataUpdateable=Pi(ue.data,he)?Ar(ue.data,he):void 0,ue.data}if(typeof J.data=="string")try{const ue=JSON.parse(J.data);return this._dataUpdateable=Pi(ue,he)?Ar(ue,he):void 0,ue}catch{throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`)}if(!J.dataDiff)throw new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${J.source}`);return function(ue,fe,je){var Xe,Pe,et,gt;if(fe.removeAll&&ue.clear(),fe.remove)for(const at of fe.remove)ue.delete(at);if(fe.add)for(const at of fe.add){const Dt=bn(at,je);Dt!=null&&ue.set(Dt,at)}if(fe.update)for(const at of fe.update){let Dt=ue.get(at.id);if(Dt==null)continue;const en=!at.removeAllProperties&&(((Xe=at.removeProperties)===null||Xe===void 0?void 0:Xe.length)>0||((Pe=at.addOrUpdateProperties)===null||Pe===void 0?void 0:Pe.length)>0);if((at.newGeometry||at.removeAllProperties||en)&&(Dt=Object.assign({},Dt),ue.set(at.id,Dt),en&&(Dt.properties=Object.assign({},Dt.properties))),at.newGeometry&&(Dt.geometry=at.newGeometry),at.removeAllProperties)Dt.properties={};else if(((et=at.removeProperties)===null||et===void 0?void 0:et.length)>0)for(const ln of at.removeProperties)Object.prototype.hasOwnProperty.call(Dt.properties,ln)&&delete Dt.properties[ln];if(((gt=at.addOrUpdateProperties)===null||gt===void 0?void 0:gt.length)>0)for(const{key:ln,value:Gn}of at.addOrUpdateProperties)Dt.properties[ln]=Gn}}(this._dataUpdateable,J.dataDiff,he),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(J){return m._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(J){return this._geoJSONIndex.getClusterExpansionZoom(J.clusterId)}getClusterChildren(J){return this._geoJSONIndex.getChildren(J.clusterId)}getClusterLeaves(J){return this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset)}}class Zr{constructor(J){this.self=J,this.actor=new m.F(J),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=($,he)=>{if(this.externalWorkerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.externalWorkerSourceTypes[$]=he},this.self.addProtocol=m.bi,this.self.removeProtocol=m.bj,this.self.registerRTLTextPlugin=$=>{if(m.bD.isParsed())throw new Error("RTL text plugin already registered.");m.bD.setMethods($)},this.actor.registerMessageHandler("LDT",($,he)=>this._getDEMWorkerSource($,he.source).loadTile(he)),this.actor.registerMessageHandler("RDT",($,he)=>m._(this,void 0,void 0,function*(){this._getDEMWorkerSource($,he.source).removeTile(he)})),this.actor.registerMessageHandler("GCEZ",($,he)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource($,he.type,he.source).getClusterExpansionZoom(he)})),this.actor.registerMessageHandler("GCC",($,he)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource($,he.type,he.source).getClusterChildren(he)})),this.actor.registerMessageHandler("GCL",($,he)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource($,he.type,he.source).getClusterLeaves(he)})),this.actor.registerMessageHandler("LD",($,he)=>this._getWorkerSource($,he.type,he.source).loadData(he)),this.actor.registerMessageHandler("GD",($,he)=>this._getWorkerSource($,he.type,he.source).getData()),this.actor.registerMessageHandler("LT",($,he)=>this._getWorkerSource($,he.type,he.source).loadTile(he)),this.actor.registerMessageHandler("RT",($,he)=>this._getWorkerSource($,he.type,he.source).reloadTile(he)),this.actor.registerMessageHandler("AT",($,he)=>this._getWorkerSource($,he.type,he.source).abortTile(he)),this.actor.registerMessageHandler("RMT",($,he)=>this._getWorkerSource($,he.type,he.source).removeTile(he)),this.actor.registerMessageHandler("RS",($,he)=>m._(this,void 0,void 0,function*(){if(!this.workerSources[$]||!this.workerSources[$][he.type]||!this.workerSources[$][he.type][he.source])return;const ue=this.workerSources[$][he.type][he.source];delete this.workerSources[$][he.type][he.source],ue.removeSource!==void 0&&ue.removeSource(he)})),this.actor.registerMessageHandler("RM",$=>m._(this,void 0,void 0,function*(){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$]})),this.actor.registerMessageHandler("SR",($,he)=>m._(this,void 0,void 0,function*(){this.referrer=he})),this.actor.registerMessageHandler("SRPS",($,he)=>this._syncRTLPluginState($,he)),this.actor.registerMessageHandler("IS",($,he)=>m._(this,void 0,void 0,function*(){this.self.importScripts(he)})),this.actor.registerMessageHandler("SI",($,he)=>this._setImages($,he)),this.actor.registerMessageHandler("UL",($,he)=>m._(this,void 0,void 0,function*(){this._getLayerIndex($).update(he.layers,he.removedIds)})),this.actor.registerMessageHandler("SL",($,he)=>m._(this,void 0,void 0,function*(){this._getLayerIndex($).replace(he)}))}_setImages(J,$){return m._(this,void 0,void 0,function*(){this.availableImages[J]=$;for(const he in this.workerSources[J]){const ue=this.workerSources[J][he];for(const fe in ue)ue[fe].availableImages=$}})}_syncRTLPluginState(J,$){return m._(this,void 0,void 0,function*(){if(m.bD.isParsed())return m.bD.getState();if($.pluginStatus!=="loading")return m.bD.setState($),$;const he=$.pluginURL;if(this.self.importScripts(he),m.bD.isParsed()){const ue={pluginStatus:"loaded",pluginURL:he};return m.bD.setState(ue),ue}throw m.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${he}`)})}_getAvailableImages(J){let $=this.availableImages[J];return $||($=[]),$}_getLayerIndex(J){let $=this.layerIndexes[J];return $||($=this.layerIndexes[J]=new l),$}_getWorkerSource(J,$,he){if(this.workerSources[J]||(this.workerSources[J]={}),this.workerSources[J][$]||(this.workerSources[J][$]={}),!this.workerSources[J][$][he]){const ue={sendAsync:(fe,je)=>(fe.targetMapId=J,this.actor.sendAsync(fe,je))};switch($){case"vector":this.workerSources[J][$][he]=new C(ue,this._getLayerIndex(J),this._getAvailableImages(J));break;case"geojson":this.workerSources[J][$][he]=new Ji(ue,this._getLayerIndex(J),this._getAvailableImages(J));break;default:this.workerSources[J][$][he]=new this.externalWorkerSourceTypes[$](ue,this._getLayerIndex(J),this._getAvailableImages(J))}}return this.workerSources[J][$][he]}_getDEMWorkerSource(J,$){return this.demWorkerSources[J]||(this.demWorkerSources[J]={}),this.demWorkerSources[J][$]||(this.demWorkerSources[J][$]=new N),this.demWorkerSources[J][$]}}return m.i(self)&&(self.worker=new Zr(self)),Zr}),a("index",["exports","./shared"],function(m,l){var x="4.7.0";let S,T;const C={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:k=>new Promise((t,f)=>{const _=requestAnimationFrame(t);k.signal.addEventListener("abort",()=>{cancelAnimationFrame(_),f(l.c())})}),getImageData(k,t=0){return this.getImageCanvasContext(k).getImageData(-t,-t,k.width+2*t,k.height+2*t)},getImageCanvasContext(k){const t=window.document.createElement("canvas"),f=t.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return t.width=k.width,t.height=k.height,f.drawImage(k,0,0,k.width,k.height),f},resolveURL:k=>(S||(S=document.createElement("a")),S.href=k,S.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(T==null&&(T=matchMedia("(prefers-reduced-motion: reduce)")),T.matches)}};class N{static testProp(t){if(!N.docStyle)return t[0];for(let f=0;f<t.length;f++)if(t[f]in N.docStyle)return t[f];return t[0]}static create(t,f,_){const y=window.document.createElement(t);return f!==void 0&&(y.className=f),_&&_.appendChild(y),y}static createNS(t,f){return window.document.createElementNS(t,f)}static disableDrag(){N.docStyle&&N.selectProp&&(N.userSelect=N.docStyle[N.selectProp],N.docStyle[N.selectProp]="none")}static enableDrag(){N.docStyle&&N.selectProp&&(N.docStyle[N.selectProp]=N.userSelect)}static setTransform(t,f){t.style[N.transformProp]=f}static addEventListener(t,f,_,y={}){t.addEventListener(f,_,"passive"in y?y:y.capture)}static removeEventListener(t,f,_,y={}){t.removeEventListener(f,_,"passive"in y?y:y.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",N.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",N.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",N.suppressClickInternal,!0)},0)}static getScale(t){const f=t.getBoundingClientRect();return{x:f.width/t.offsetWidth||1,y:f.height/t.offsetHeight||1,boundingClientRect:f}}static getPoint(t,f,_){const y=f.boundingClientRect;return new l.P((_.clientX-y.left)/f.x-t.clientLeft,(_.clientY-y.top)/f.y-t.clientTop)}static mousePos(t,f){const _=N.getScale(t);return N.getPoint(t,_,f)}static touchPos(t,f){const _=[],y=N.getScale(t);for(let w=0;w<f.length;w++)_.push(N.getPoint(t,y,f[w]));return _}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}N.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,N.selectProp=N.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),N.transformProp=N.testProp(["transform","WebkitTransform"]);const B={supported:!1,testSupport:function(k){!ie&&ee&&(se?Q(k):U=k)}};let U,ee,ie=!1,se=!1;function Q(k){const t=k.createTexture();k.bindTexture(k.TEXTURE_2D,t);try{if(k.texImage2D(k.TEXTURE_2D,0,k.RGBA,k.RGBA,k.UNSIGNED_BYTE,ee),k.isContextLost())return;B.supported=!0}catch{}k.deleteTexture(t),ie=!0}var Y;typeof document<"u"&&(ee=document.createElement("img"),ee.onload=()=>{U&&Q(U),U=null,se=!0},ee.onerror=()=>{ie=!0,U=null},ee.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(k){let t,f,_,y;k.resetRequestQueue=()=>{t=[],f=0,_=0,y={}},k.addThrottleControl=z=>{const q=_++;return y[q]=z,q},k.removeThrottleControl=z=>{delete y[z],R()},k.getImage=(z,q,H=!0)=>new Promise((X,ne)=>{B.supported&&(z.headers||(z.headers={}),z.headers.accept="image/webp,*/*"),l.e(z,{type:"image"}),t.push({abortController:q,requestParameters:z,supportImageRefresh:H,state:"queued",onError:me=>{ne(me)},onSuccess:me=>{X(me)}}),R()});const w=z=>l._(this,void 0,void 0,function*(){z.state="running";const{requestParameters:q,supportImageRefresh:H,onError:X,onSuccess:ne,abortController:me}=z,we=H===!1&&!l.i(self)&&!l.g(q.url)&&(!q.headers||Object.keys(q.headers).reduce((Fe,Ve)=>Fe&&Ve==="accept",!0));f++;const Me=we?D(q,me):l.m(q,me);try{const Fe=yield Me;delete z.abortController,z.state="completed",Fe.data instanceof HTMLImageElement||l.b(Fe.data)?ne(Fe):Fe.data&&ne({data:yield(Ne=Fe.data,typeof createImageBitmap=="function"?l.d(Ne):l.f(Ne)),cacheControl:Fe.cacheControl,expires:Fe.expires})}catch(Fe){delete z.abortController,X(Fe)}finally{f--,R()}var Ne}),R=()=>{const z=(()=>{for(const q of Object.keys(y))if(y[q]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let q=f;q<z&&t.length>0;q++){const H=t.shift();H.abortController.signal.aborted?q--:w(H)}},D=(z,q)=>new Promise((H,X)=>{const ne=new Image,me=z.url,we=z.credentials;we&&we==="include"?ne.crossOrigin="use-credentials":(we&&we==="same-origin"||!l.s(me))&&(ne.crossOrigin="anonymous"),q.signal.addEventListener("abort",()=>{ne.src="",X(l.c())}),ne.fetchPriority="high",ne.onload=()=>{ne.onerror=ne.onload=null,H({data:ne})},ne.onerror=()=>{ne.onerror=ne.onload=null,q.signal.aborted||X(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ne.src=me})}(Y||(Y={})),Y.resetRequestQueue();class _e{constructor(t){this._transformRequestFn=t}transformRequest(t,f){return this._transformRequestFn&&this._transformRequestFn(t,f)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function ve(k){var t=new l.A(3);return t[0]=k[0],t[1]=k[1],t[2]=k[2],t}var Ae,ce=function(k,t,f){return k[0]=t[0]-f[0],k[1]=t[1]-f[1],k[2]=t[2]-f[2],k};Ae=new l.A(3),l.A!=Float32Array&&(Ae[0]=0,Ae[1]=0,Ae[2]=0);var xe=function(k){var t=k[0],f=k[1];return t*t+f*f};function be(k){const t=[];if(typeof k=="string")t.push({id:"default",url:k});else if(k&&k.length>0){const f=[];for(const{id:_,url:y}of k){const w=`${_}${y}`;f.indexOf(w)===-1&&(f.push(w),t.push({id:_,url:y}))}}return t}function Le(k,t,f){const _=k.split("?");return _[0]+=`${t}${f}`,_.join("?")}(function(){var k=new l.A(2);l.A!=Float32Array&&(k[0]=0,k[1]=0)})();class ke{constructor(t,f,_,y){this.context=t,this.format=_,this.texture=t.gl.createTexture(),this.update(f,y)}update(t,f,_){const{width:y,height:w}=t,R=!(this.size&&this.size[0]===y&&this.size[1]===w||_),{context:D}=this,{gl:z}=D;if(this.useMipmap=!!(f&&f.useMipmap),z.bindTexture(z.TEXTURE_2D,this.texture),D.pixelStoreUnpackFlipY.set(!1),D.pixelStoreUnpack.set(1),D.pixelStoreUnpackPremultiplyAlpha.set(this.format===z.RGBA&&(!f||f.premultiply!==!1)),R)this.size=[y,w],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.b(t)?z.texImage2D(z.TEXTURE_2D,0,this.format,this.format,z.UNSIGNED_BYTE,t):z.texImage2D(z.TEXTURE_2D,0,this.format,y,w,0,this.format,z.UNSIGNED_BYTE,t.data);else{const{x:q,y:H}=_||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.b(t)?z.texSubImage2D(z.TEXTURE_2D,0,q,H,z.RGBA,z.UNSIGNED_BYTE,t):z.texSubImage2D(z.TEXTURE_2D,0,q,H,y,w,z.RGBA,z.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&z.generateMipmap(z.TEXTURE_2D)}bind(t,f,_){const{context:y}=this,{gl:w}=y;w.bindTexture(w.TEXTURE_2D,this.texture),_!==w.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_=w.LINEAR),t!==this.filter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,t),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,_||t),this.filter=t),f!==this.wrap&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,f),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,f),this.wrap=f)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function ye(k){const{userImage:t}=k;return!!(t&&t.render&&t.render())&&(k.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ue extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:f,promiseResolve:_}of this.requestors)_(this._getImagesForIds(f));this.requestors=[]}}getImage(t){const f=this.images[t];if(f&&!f.data&&f.spriteData){const _=f.spriteData;f.data=new l.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),f.spriteData=null}return f}addImage(t,f){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,f)&&(this.images[t]=f)}_validate(t,f){let _=!0;const y=f.data||f.spriteData;return this._validateStretch(f.stretchX,y&&y.width)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "stretchX" value`))),_=!1),this._validateStretch(f.stretchY,y&&y.height)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "stretchY" value`))),_=!1),this._validateContent(f.content,f)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "content" value`))),_=!1),_}_validateStretch(t,f){if(!t)return!0;let _=0;for(const y of t){if(y[0]<_||y[1]<y[0]||f<y[1])return!1;_=y[1]}return!0}_validateContent(t,f){if(!t)return!0;if(t.length!==4)return!1;const _=f.spriteData,y=_&&_.width||f.data.width,w=_&&_.height||f.data.height;return!(t[0]<0||y<t[0]||t[1]<0||w<t[1]||t[2]<0||y<t[2]||t[3]<0||w<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,f,_=!0){const y=this.getImage(t);if(_&&(y.data.width!==f.data.width||y.data.height!==f.data.height))throw new Error(`size mismatch between old image (${y.data.width}x${y.data.height}) and new image (${f.data.width}x${f.data.height}).`);f.version=y.version+1,this.images[t]=f,this.updatedImages[t]=!0}removeImage(t){const f=this.images[t];delete this.images[t],delete this.patterns[t],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((f,_)=>{let y=!0;if(!this.isLoaded())for(const w of t)this.images[w]||(y=!1);this.isLoaded()||y?f(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:f})})}_getImagesForIds(t){const f={};for(const _ of t){let y=this.getImage(_);y||(this.fire(new l.k("styleimagemissing",{id:_})),y=this.getImage(_)),y?f[_]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,textFitWidth:y.textFitWidth,textFitHeight:y.textFitHeight,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:l.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return f}getPixelSize(){const{width:t,height:f}=this.atlasImage;return{width:t,height:f}}getPattern(t){const f=this.patterns[t],_=this.getImage(t);if(!_)return null;if(f&&f.position.version===_.version)return f.position;if(f)f.position.version=_.version;else{const y={w:_.data.width+2,h:_.data.height+2,x:0,y:0},w=new l.I(y,_);this.patterns[t]={bin:y,position:w}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const f=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ke(t,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const w in this.patterns)t.push(this.patterns[w].bin);const{w:f,h:_}=l.p(t),y=this.atlasImage;y.resize({width:f||1,height:_||1});for(const w in this.patterns){const{bin:R}=this.patterns[w],D=R.x+1,z=R.y+1,q=this.getImage(w).data,H=q.width,X=q.height;l.R.copy(q,y,{x:0,y:0},{x:D,y:z},{width:H,height:X}),l.R.copy(q,y,{x:0,y:X-1},{x:D,y:z-1},{width:H,height:1}),l.R.copy(q,y,{x:0,y:0},{x:D,y:z+X},{width:H,height:1}),l.R.copy(q,y,{x:H-1,y:0},{x:D-1,y:z},{width:1,height:X}),l.R.copy(q,y,{x:0,y:0},{x:D+H,y:z},{width:1,height:X})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const f of t){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const _=this.getImage(f);_||l.w(`Image with ID: "${f}" was not found`),ye(_)&&this.updateImage(f,_)}}}const qe=1e20;function pt(k,t,f,_,y,w,R,D,z){for(let q=t;q<t+_;q++)St(k,f*w+q,w,y,R,D,z);for(let q=f;q<f+y;q++)St(k,q*w+t,1,_,R,D,z)}function St(k,t,f,_,y,w,R){w[0]=0,R[0]=-qe,R[1]=qe,y[0]=k[t];for(let D=1,z=0,q=0;D<_;D++){y[D]=k[t+D*f];const H=D*D;do{const X=w[z];q=(y[D]-y[X]+H-X*X)/(D-X)/2}while(q<=R[z]&&--z>-1);z++,w[z]=D,R[z]=q,R[z+1]=qe}for(let D=0,z=0;D<_;D++){for(;R[z+1]<D;)z++;const q=w[z],H=D-q;k[t+D*f]=y[q]+H*H}}class dt{constructor(t,f){this.requestManager=t,this.localIdeographFontFamily=f,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return l._(this,void 0,void 0,function*(){const f=[];for(const w in t)for(const R of t[w])f.push(this._getAndCacheGlyphsPromise(w,R));const _=yield Promise.all(f),y={};for(const{stack:w,id:R,glyph:D}of _)y[w]||(y[w]={}),y[w][R]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics};return y})}_getAndCacheGlyphsPromise(t,f){return l._(this,void 0,void 0,function*(){let _=this.entries[t];_||(_=this.entries[t]={glyphs:{},requests:{},ranges:{}});let y=_.glyphs[f];if(y!==void 0)return{stack:t,id:f,glyph:y};if(y=this._tinySDF(_,t,f),y)return _.glyphs[f]=y,{stack:t,id:f,glyph:y};const w=Math.floor(f/256);if(256*w>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[w])return{stack:t,id:f,glyph:y};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[w]){const D=dt.loadGlyphRange(t,w,this.url,this.requestManager);_.requests[w]=D}const R=yield _.requests[w];for(const D in R)this._doesCharSupportLocalGlyph(+D)||(_.glyphs[+D]=R[+D]);return _.ranges[w]=!0,{stack:t,id:f,glyph:R[f]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(t))}_tinySDF(t,f,_){const y=this.localIdeographFontFamily;if(!y||!this._doesCharSupportLocalGlyph(_))return;let w=t.tinySDF;if(!w){let D="400";/bold/i.test(f)?D="900":/medium/i.test(f)?D="500":/light/i.test(f)&&(D="200"),w=t.tinySDF=new dt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:y,fontWeight:D})}const R=w.draw(String.fromCharCode(_));return{id:_,bitmap:new l.o({width:R.width||60,height:R.height||60},R.data),metrics:{width:R.glyphWidth/2||24,height:R.glyphHeight/2||24,left:R.glyphLeft/2+.5||0,top:R.glyphTop/2-27.5||-8,advance:R.glyphAdvance/2||24,isDoubleResolution:!0}}}}dt.loadGlyphRange=function(k,t,f,_){return l._(this,void 0,void 0,function*(){const y=256*t,w=y+255,R=_.transformRequest(f.replace("{fontstack}",k).replace("{range}",`${y}-${w}`),"Glyphs"),D=yield l.l(R,new AbortController);if(!D||!D.data)throw new Error(`Could not load glyph range. range: ${t}, ${y}-${w}`);const z={};for(const q of l.n(D.data))z[q.id]=q;return z})},dt.TinySDF=class{constructor({fontSize:k=24,buffer:t=3,radius:f=8,cutoff:_=.25,fontFamily:y="sans-serif",fontWeight:w="normal",fontStyle:R="normal"}={}){this.buffer=t,this.cutoff=_,this.radius=f;const D=this.size=k+4*t,z=this._createCanvas(D),q=this.ctx=z.getContext("2d",{willReadFrequently:!0});q.font=`${R} ${w} ${k}px ${y}`,q.textBaseline="alphabetic",q.textAlign="left",q.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(k){const t=document.createElement("canvas");return t.width=t.height=k,t}draw(k){const{width:t,actualBoundingBoxAscent:f,actualBoundingBoxDescent:_,actualBoundingBoxLeft:y,actualBoundingBoxRight:w}=this.ctx.measureText(k),R=Math.ceil(f),D=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(w-y))),z=Math.min(this.size-this.buffer,R+Math.ceil(_)),q=D+2*this.buffer,H=z+2*this.buffer,X=Math.max(q*H,0),ne=new Uint8ClampedArray(X),me={data:ne,width:q,height:H,glyphWidth:D,glyphHeight:z,glyphTop:R,glyphLeft:0,glyphAdvance:t};if(D===0||z===0)return me;const{ctx:we,buffer:Me,gridInner:Ne,gridOuter:Fe}=this;we.clearRect(Me,Me,D,z),we.fillText(k,Me,Me+R);const Ve=we.getImageData(Me,Me,D,z);Fe.fill(qe,0,X),Ne.fill(0,0,X);for(let Te=0;Te<z;Te++)for(let He=0;He<D;He++){const Je=Ve.data[4*(Te*D+He)+3]/255;if(Je===0)continue;const st=(Te+Me)*q+He+Me;if(Je===1)Fe[st]=0,Ne[st]=qe;else{const xt=.5-Je;Fe[st]=xt>0?xt*xt:0,Ne[st]=xt<0?xt*xt:0}}pt(Fe,0,0,q,H,q,this.f,this.v,this.z),pt(Ne,Me,Me,D,z,q,this.f,this.v,this.z);for(let Te=0;Te<X;Te++){const He=Math.sqrt(Fe[Te])-Math.sqrt(Ne[Te]);ne[Te]=Math.round(255-255*(He/this.radius+this.cutoff))}return me}};class ut{constructor(){this.specification=l.v.light.position}possiblyEvaluate(t,f){return l.x(t.expression.evaluate(f))}interpolate(t,f,_){return{x:l.y.number(t.x,f.x,_),y:l.y.number(t.y,f.y,_),z:l.y.number(t.z,f.z,_)}}}let Ut;class vt extends l.E{constructor(t){super(),Ut=Ut||new l.q({anchor:new l.D(l.v.light.anchor),position:new ut,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(Ut),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,f={}){if(!this._validate(l.r,t,f))for(const _ in t){const y=t[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),y):this._transitionable.setValue(_,y)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,f,_){return(!_||_.validate!==!1)&&l.t(this,t.call(l.u,{value:f,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}const kt=new l.q({"sky-color":new l.D(l.v.sky["sky-color"]),"horizon-color":new l.D(l.v.sky["horizon-color"]),"fog-color":new l.D(l.v.sky["fog-color"]),"fog-ground-blend":new l.D(l.v.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.v.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.v.sky["atmosphere-blend"])});class ft extends l.E{constructor(t){super(),this._transitionable=new l.T(kt),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.z(0))}setSky(t,f={}){if(!this._validate(l.B,t,f)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const _ in t){const y=t[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),y):this._transitionable.setValue(_,y)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,f,_={}){return(_==null?void 0:_.validate)!==!1&&l.t(this,t.call(l.u,l.e({value:f,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class wt{constructor(t,f){this.width=t,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,f){const _=t.join(",")+String(f);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(t,f)),this.dashEntry[_]}getDashRanges(t,f,_){const y=[];let w=t.length%2==1?-t[t.length-1]*_:0,R=t[0]*_,D=!0;y.push({left:w,right:R,isDash:D,zeroLength:t[0]===0});let z=t[0];for(let q=1;q<t.length;q++){D=!D;const H=t[q];w=z*_,z+=H,R=z*_,y.push({left:w,right:R,isDash:D,zeroLength:H===0})}return y}addRoundDash(t,f,_){const y=f/2;for(let w=-_;w<=_;w++){const R=this.width*(this.nextRow+_+w);let D=0,z=t[D];for(let q=0;q<this.width;q++){q/z.right>1&&(z=t[++D]);const H=Math.abs(q-z.left),X=Math.abs(q-z.right),ne=Math.min(H,X);let me;const we=w/_*(y+1);if(z.isDash){const Me=y-Math.abs(we);me=Math.sqrt(ne*ne+Me*Me)}else me=y-Math.sqrt(ne*ne+we*we);this.data[R+q]=Math.max(0,Math.min(255,me+128))}}}addRegularDash(t){for(let D=t.length-1;D>=0;--D){const z=t[D],q=t[D+1];z.zeroLength?t.splice(D,1):q&&q.isDash===z.isDash&&(q.left=z.left,t.splice(D,1))}const f=t[0],_=t[t.length-1];f.isDash===_.isDash&&(f.left=_.left-this.width,_.right=f.right+this.width);const y=this.width*this.nextRow;let w=0,R=t[w];for(let D=0;D<this.width;D++){D/R.right>1&&(R=t[++w]);const z=Math.abs(D-R.left),q=Math.abs(D-R.right),H=Math.min(z,q);this.data[y+D]=Math.max(0,Math.min(255,(R.isDash?H:-H)+128))}}addDash(t,f){const _=f?7:0,y=2*_+1;if(this.nextRow+y>this.height)return l.w("LineAtlas out of space"),null;let w=0;for(let D=0;D<t.length;D++)w+=t[D];if(w!==0){const D=this.width/w,z=this.getDashRanges(t,this.width,D);f?this.addRoundDash(z,D,_):this.addRegularDash(z)}const R={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:w};return this.nextRow+=y,this.dirty=!0,R}bind(t){const f=t.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))}}const It="maplibre_preloaded_worker_pool";class $t{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<$t.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[It]}numActive(){return Object.keys(this.active).length}}const pn=Math.floor(C.hardwareConcurrency/2);let Pn,We;function Wn(){return Pn||(Pn=new $t),Pn}$t.workerCount=l.C(globalThis)?Math.max(Math.min(pn,3),1):1;class dn{constructor(t,f){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=f;const _=this.workerPool.acquire(f);for(let y=0;y<_.length;y++){const w=new l.F(_[y],f);w.name=`Worker ${y}`,this.actors.push(w)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,f){const _=[];for(const y of this.actors)_.push(y.sendAsync({type:t,data:f}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(f=>{f.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,f){for(const _ of this.actors)_.registerMessageHandler(t,f)}}function Ot(){return We||(We=new dn(Wn(),l.G),We.registerMessageHandler("GR",(k,t,f)=>l.m(t,f))),We}function Ee(k,t){const f=l.H();return l.J(f,f,[1,1,0]),l.K(f,f,[.5*k.width,.5*k.height,1]),l.L(f,f,k.calculatePosMatrix(t.toUnwrapped()))}function lt(k,t,f,_,y,w){const R=function(X,ne,me){if(X)for(const we of X){const Me=ne[we];if(Me&&Me.source===me&&Me.type==="fill-extrusion")return!0}else for(const we in ne){const Me=ne[we];if(Me.source===me&&Me.type==="fill-extrusion")return!0}return!1}(y&&y.layers,t,k.id),D=w.maxPitchScaleFactor(),z=k.tilesIn(_,D,R);z.sort(Ye);const q=[];for(const X of z)q.push({wrappedTileID:X.tileID.wrapped().key,queryResults:X.tile.queryRenderedFeatures(t,f,k._state,X.queryGeometry,X.cameraQueryGeometry,X.scale,y,w,D,Ee(k.transform,X.tileID))});const H=function(X){const ne={},me={};for(const we of X){const Me=we.queryResults,Ne=we.wrappedTileID,Fe=me[Ne]=me[Ne]||{};for(const Ve in Me){const Te=Me[Ve],He=Fe[Ve]=Fe[Ve]||{},Je=ne[Ve]=ne[Ve]||[];for(const st of Te)He[st.featureIndex]||(He[st.featureIndex]=!0,Je.push(st))}}return ne}(q);for(const X in H)H[X].forEach(ne=>{const me=ne.feature,we=k.getFeatureState(me.layer["source-layer"],me.id);me.source=me.layer.source,me.layer["source-layer"]&&(me.sourceLayer=me.layer["source-layer"]),me.state=we});return H}function Ye(k,t){const f=k.tileID,_=t.tileID;return f.overscaledZ-_.overscaledZ||f.canonical.y-_.canonical.y||f.wrap-_.wrap||f.canonical.x-_.canonical.x}function Lt(k,t,f){return l._(this,void 0,void 0,function*(){let _=k;if(k.url?_=(yield l.h(t.transformRequest(k.url,"Source"),f)).data:yield C.frameAsync(f),!_)return null;const y=l.M(l.e(_,k),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(y.vectorLayerIds=_.vector_layers.map(w=>w.id)),y})}class Ke{constructor(t,f){t&&(f?this.setSouthWest(t).setNorthEast(f):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof l.N?new l.N(t.lng,t.lat):l.N.convert(t),this}setSouthWest(t){return this._sw=t instanceof l.N?new l.N(t.lng,t.lat):l.N.convert(t),this}extend(t){const f=this._sw,_=this._ne;let y,w;if(t instanceof l.N)y=t,w=t;else{if(!(t instanceof Ke))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ke.convert(t)):this.extend(l.N.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(l.N.convert(t)):this;if(y=t._sw,w=t._ne,!y||!w)return this}return f||_?(f.lng=Math.min(y.lng,f.lng),f.lat=Math.min(y.lat,f.lat),_.lng=Math.max(w.lng,_.lng),_.lat=Math.max(w.lat,_.lat)):(this._sw=new l.N(y.lng,y.lat),this._ne=new l.N(w.lng,w.lat)),this}getCenter(){return new l.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.N(this.getWest(),this.getNorth())}getSouthEast(){return new l.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:f,lat:_}=l.N.convert(t);let y=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&y}static convert(t){return t instanceof Ke?t:t&&new Ke(t)}static fromLngLat(t,f=0){const _=360*f/40075017,y=_/Math.cos(Math.PI/180*t.lat);return new Ke(new l.N(t.lng-y,t.lat-_),new l.N(t.lng+y,t.lat+_))}adjustAntiMeridian(){const t=new l.N(this._sw.lng,this._sw.lat),f=new l.N(this._ne.lng,this._ne.lat);return new Ke(t,t.lng>f.lng?new l.N(f.lng+360,f.lat):f)}}class On{constructor(t,f,_){this.bounds=Ke.convert(this.validateBounds(t)),this.minzoom=f||0,this.maxzoom=_||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const f=Math.pow(2,t.z),_=Math.floor(l.O(this.bounds.getWest())*f),y=Math.floor(l.Q(this.bounds.getNorth())*f),w=Math.ceil(l.O(this.bounds.getEast())*f),R=Math.ceil(l.Q(this.bounds.getSouth())*f);return t.x>=_&&t.x<w&&t.y>=y&&t.y<R}}class bt extends l.E{constructor(t,f,_,y){if(super(),this.id=t,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.M(f,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Lt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(l.e(this,t),t.bounds&&(this.tileBounds=new On(t.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new l.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(t){return l._(this,void 0,void 0,function*(){const f=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(f,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};_.request.collectResourceTiming=this._collectResourceTiming;let y="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((w,R)=>{t.reloadPromise={resolve:w,reject:R}})}else t.actor=this.dispatcher.getActor(),y="LT";t.abortController=new AbortController;try{const w=yield t.actor.sendAsync({type:y,data:_},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,w)}catch(w){if(delete t.abortController,t.aborted)return;if(w&&w.status!==404)throw w;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,f){if(f&&f.resourceTiming&&(t.resourceTiming=f.resourceTiming),f&&this.map._refreshExpiredTiles&&t.setExpiryData(f),t.loadVectorData(f,this.map.painter),t.reloadPromise){const _=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(_.resolve).catch(_.reject)}}abortTile(t){return l._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return l._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ie extends l.E{constructor(t,f,_,y){super(),this.id=t,this.dispatcher=_,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},f),l.e(this,l.M(f,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Lt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(l.e(this,t),t.bounds&&(this.tileBounds=new On(t.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new l.j(t))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return l.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return l._(this,void 0,void 0,function*(){const f=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const _=yield Y.getImage(this.map._requestManager.transformRequest(f,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&t.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const y=this.map.painter.context,w=y.gl,R=_.data;t.texture=this.map.painter.getTileTexture(R.width),t.texture?t.texture.update(R,{useMipmap:!0}):(t.texture=new ke(y,R,w.RGBA,{useMipmap:!0}),t.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(_){if(delete t.abortController,t.aborted)t.state="unloaded";else if(_)throw t.state="errored",_}})}abortTile(t){return l._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return l._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class Bt extends Ie{constructor(t,f,_,y){super(t,f,_,y),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox",this.redFactor=f.redFactor,this.greenFactor=f.greenFactor,this.blueFactor=f.blueFactor,this.baseShift=f.baseShift}loadTile(t){return l._(this,void 0,void 0,function*(){const f=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(f,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const y=yield Y.getImage(_,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(y&&y.data){const w=y.data;this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&t.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const R=l.b(w)&&l.U()?w:yield this.readImageNow(w),D={type:this.type,uid:t.uid,source:this.id,rawImageData:R,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const z=yield t.actor.sendAsync({type:"LDT",data:D});t.dem=z,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(y){if(delete t.abortController,t.aborted)t.state="unloaded";else if(y)throw t.state="errored",y}})}readImageNow(t){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.V()){const f=t.width+2,_=t.height+2;try{return new l.R({width:f,height:_},yield l.W(t,-1,-1,f,_))}catch{}}return C.getImageData(t,1)})}_getNeighboringTiles(t){const f=t.canonical,_=Math.pow(2,f.z),y=(f.x-1+_)%_,w=f.x===0?t.wrap-1:t.wrap,R=(f.x+1+_)%_,D=f.x+1===_?t.wrap+1:t.wrap,z={};return z[new l.S(t.overscaledZ,w,f.z,y,f.y).key]={backfilled:!1},z[new l.S(t.overscaledZ,D,f.z,R,f.y).key]={backfilled:!1},f.y>0&&(z[new l.S(t.overscaledZ,w,f.z,y,f.y-1).key]={backfilled:!1},z[new l.S(t.overscaledZ,t.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},z[new l.S(t.overscaledZ,D,f.z,R,f.y-1).key]={backfilled:!1}),f.y+1<_&&(z[new l.S(t.overscaledZ,w,f.z,y,f.y+1).key]={backfilled:!1},z[new l.S(t.overscaledZ,t.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},z[new l.S(t.overscaledZ,D,f.z,R,f.y+1).key]={backfilled:!1}),z}unloadTile(t){return l._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class Mn extends l.E{constructor(t,f,_,y){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_.getActor(),this.setEventedParent(y),this._data=f.data,this._options=l.e({},f),this._collectResourceTiming=f.collectResourceTiming,f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId;const w=l.X/this.tileSize;f.clusterMaxZoom!==void 0&&this.maxzoom<=f.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${f.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*w,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*w,extent:l.X,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?f.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:l.X,radius:(f.clusterRadius||50)*w,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return l._(this,void 0,void 0,function*(){const t=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,f,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:f,offset:_}})}_updateWorkerData(t){return l._(this,void 0,void 0,function*(){const f=l.e({type:this.type},this.workerOptions);t?f.dataDiff=t:typeof this._data=="string"?(f.request=this.map._requestManager.transformRequest(C.resolveURL(this._data),"Source"),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const _=yield this.actor.sendAsync({type:"LD",data:f});if(this._pendingLoads--,this._removed||_.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let y=null;_.resourceTiming&&_.resourceTiming[this.id]&&(y=_.resourceTiming[this.id].slice(0));const w={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&l.e(w,{resourceTiming:y}),this.fire(new l.k("data",Object.assign(Object.assign({},w),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},w),{sourceDataType:"content"})))}catch(_){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(_))}})}loaded(){return this._pendingLoads===0}loadTile(t){return l._(this,void 0,void 0,function*(){const f=t.actor?"RT":"LT";t.actor=this.actor;const _={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const y=yield this.actor.sendAsync({type:f,data:_},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(y,this.map.painter,f==="RT")})}abortTile(t){return l._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return l._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Nn=l.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Qn extends l.E{constructor(t,f,_,y){super(),this.id=t,this.dispatcher=_,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=f}load(t){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const f=yield Y.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,f&&f.data&&(this.image=f.data,t&&(this.coordinates=t),this._finishLoading())}catch(f){this._request=null,this._loaded=!0,this.fire(new l.j(f))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const f=t.map(l.Z.fromLngLat);this.tileID=function(y){let w=1/0,R=1/0,D=-1/0,z=-1/0;for(const ne of y)w=Math.min(w,ne.x),R=Math.min(R,ne.y),D=Math.max(D,ne.x),z=Math.max(z,ne.y);const q=Math.max(D-w,z-R),H=Math.max(0,Math.floor(-Math.log(q)/Math.LN2)),X=Math.pow(2,H);return new l.a1(H,Math.floor((w+D)/2*X),Math.floor((R+z)/2*X))}(f),this.minzoom=this.maxzoom=this.tileID.z;const _=f.map(y=>this.tileID.getTilePoint(y)._round());return this._boundsArray=new l.$,this._boundsArray.emplaceBack(_[0].x,_[0].y,0,0),this._boundsArray.emplaceBack(_[1].x,_[1].y,l.X,0),this._boundsArray.emplaceBack(_[3].x,_[3].y,0,l.X),this._boundsArray.emplaceBack(_[2].x,_[2].y,l.X,l.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,f=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Nn.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ke(t,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let _=!1;for(const y in this.tiles){const w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,_=!0)}_&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Jt extends Qn{constructor(t,f,_,y){super(t,f,_,y),this.roundZoom=!0,this.type="video",this.options=f}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const f of t.urls)this.urls.push(this.map._requestManager.transformRequest(f,"Source").url);try{const f=yield l.a3(this.urls);if(this._loaded=!0,!f)return;this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(f){this.fire(new l.j(f))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const f=this.video.seekable;t<f.start(0)||t>f.end(0)?this.fire(new l.j(new l.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${f.start(0)} and ${f.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,f=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Nn.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new ke(t,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let _=!1;for(const y in this.tiles){const w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,_=!0)}_&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ri extends Qn{constructor(t,f,_,y){super(t,f,_,y),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(R=>typeof R!="number"))||this.fire(new l.j(new l.a2(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a2(`sources.${t}`,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new l.j(new l.a2(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a2(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a2(`sources.${t}`,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const f=this.map.painter.context,_=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,Nn.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ke(f,this.canvas,_.RGBA,{premultiply:!0});let y=!1;for(const w in this.tiles){const R=this.tiles[w];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture,y=!0)}y&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Yi={},Jr=k=>{switch(k){case"geojson":return Mn;case"image":return Qn;case"raster":return Ie;case"raster-dem":return Bt;case"vector":return bt;case"video":return Jt;case"canvas":return Ri}return Yi[k]},ct="RTLPluginLoaded";class yr extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ot()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(f=>{throw this.status="error",f})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return l._(this,arguments,void 0,function*(f,_=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=C.resolveURL(f),!this.url)throw new Error(`requested url ${f} is invalid`);if(this.status==="unavailable"){if(!_)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(ct))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let xn=null;function mn(){return xn||(xn=new yr),xn}class Ms{constructor(t,f){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=l.a4(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const f=t+this.timeAdded;f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,f,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(y,w){const R={};if(!w)return R;for(const D of y){const z=D.layerIds.map(q=>w.getLayer(q)).filter(Boolean);if(z.length!==0){D.layers=z,D.stateDependentLayerIds&&(D.stateDependentLayers=D.stateDependentLayerIds.map(q=>z.filter(H=>H.id===q)[0]));for(const q of z)R[q.id]=D}}return R}(t.buckets,f.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const w=this.buckets[y];if(w instanceof l.a6){if(this.hasSymbolBuckets=!0,!_)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const w=this.buckets[y];if(w instanceof l.a6&&w.hasRTLText){this.hasRTLText=!0,mn().lazyLoad();break}}this.queryPadding=0;for(const y in this.buckets){const w=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,f.style.getLayer(y).queryRadius(w))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new l.a5}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const _ in this.buckets){const y=this.buckets[_];y.uploadPending()&&y.upload(t)}const f=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ke(t,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ke(t,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,f,_,y,w,R,D,z,q,H){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:y,cameraQueryGeometry:w,scale:R,tileSize:this.tileSize,pixelPosMatrix:H,transform:z,params:D,queryPadding:this.queryPadding*q},t,f,_):{}}querySourceFeatures(t,f){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const y=_.loadVTLayers(),w=f&&f.sourceLayer?f.sourceLayer:"",R=y._geojsonTileLayer||y[w];if(!R)return;const D=l.a7(f&&f.filter),{z,x:q,y:H}=this.tileID.canonical,X={z,x:q,y:H};for(let ne=0;ne<R.length;ne++){const me=R.feature(ne);if(D.needGeometry){const Ne=l.a8(me,!0);if(!D.filter(new l.z(this.tileID.overscaledZ),Ne,this.tileID.canonical))continue}else if(!D.filter(new l.z(this.tileID.overscaledZ),me))continue;const we=_.getId(me,w),Me=new l.a9(me,z,q,H,we);Me.tile=X,t.push(Me)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const f=this.expirationTime;if(t.cacheControl){const _=l.aa(t.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const _=Date.now();let y=!1;if(this.expirationTime>_)y=!1;else if(f)if(this.expirationTime<f)y=!0;else{const w=this.expirationTime-f;w?this.expirationTime=_+Math.max(w,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,f){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const y in this.buckets){if(!f.style.hasLayer(y))continue;const w=this.buckets[y],R=w.layers[0].sourceLayer||"_geojsonTileLayer",D=_[R],z=t[R];if(!D||!z||Object.keys(z).length===0)continue;w.update(z,D,this.imageAtlas&&this.imageAtlas.patternPositions||{});const q=f&&f.style&&f.style.getLayer(y);q&&(this.queryPadding=Math.max(this.queryPadding,q.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<C.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=C.now()+t}setDependencies(t,f){const _={};for(const y of f)_[y]=!0;this.dependencies[t]=_}hasDependency(t,f){for(const _ of t){const y=this.dependencies[_];if(y){for(const w of f)if(y[w])return!0}}return!1}}class Mt{constructor(t,f){this.max=t,this.onRemove=f,this.reset()}reset(){for(const t in this.data)for(const f of this.data[t])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(t,f,_){const y=t.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const w={value:f,timeout:void 0};if(_!==void 0&&(w.timeout=setTimeout(()=>{this.remove(t,w)},_)),this.data[y].push(w),this.order.push(y),this.order.length>this.max){const R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const f=this.data[t].shift();return f.timeout&&clearTimeout(f.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),f.value}getByKey(t){const f=this.data[t];return f?f[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,f){if(!this.has(t))return this;const _=t.wrapped().key,y=f===void 0?0:this.data[_].indexOf(f),w=this.data[_][y];return this.data[_].splice(y,1),w.timeout&&clearTimeout(w.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(w.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(t){const f=[];for(const _ in this.data)for(const y of this.data[_])t(y.value)||f.push(y);for(const _ of f)this.remove(_.value.tileID,_)}}class An{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,f,_){const y=String(f);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][y]=this.stateChanges[t][y]||{},l.e(this.stateChanges[t][y],_),this.deletedStates[t]===null){this.deletedStates[t]={};for(const w in this.state[t])w!==y&&(this.deletedStates[t][w]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][y]===null){this.deletedStates[t][y]={};for(const w in this.state[t][y])_[w]||(this.deletedStates[t][y][w]=null)}else for(const w in _)this.deletedStates[t]&&this.deletedStates[t][y]&&this.deletedStates[t][y][w]===null&&delete this.deletedStates[t][y][w]}removeFeatureState(t,f,_){if(this.deletedStates[t]===null)return;const y=String(f);if(this.deletedStates[t]=this.deletedStates[t]||{},_&&f!==void 0)this.deletedStates[t][y]!==null&&(this.deletedStates[t][y]=this.deletedStates[t][y]||{},this.deletedStates[t][y][_]=null);else if(f!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][y])for(_ in this.deletedStates[t][y]={},this.stateChanges[t][y])this.deletedStates[t][y][_]=null;else this.deletedStates[t][y]=null;else this.deletedStates[t]=null}getState(t,f){const _=String(f),y=l.e({},(this.state[t]||{})[_],(this.stateChanges[t]||{})[_]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const w=this.deletedStates[t][f];if(w===null)return{};for(const R in w)delete y[R]}return y}initializeTileState(t,f){t.setFeatureState(this.state,f)}coalesceChanges(t,f){const _={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const w={};for(const R in this.stateChanges[y])this.state[y][R]||(this.state[y][R]={}),l.e(this.state[y][R],this.stateChanges[y][R]),w[R]=this.state[y][R];_[y]=w}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const w={};if(this.deletedStates[y]===null)for(const R in this.state[y])w[R]={},this.state[y][R]={};else for(const R in this.deletedStates[y]){if(this.deletedStates[y][R]===null)this.state[y][R]={};else for(const D of Object.keys(this.deletedStates[y][R]))delete this.state[y][R][D];w[R]=this.state[y][R]}_[y]=_[y]||{},l.e(_[y],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const y in t)t[y].setFeatureState(_,f)}}class At extends l.E{constructor(t,f,_){super(),this.id=t,this.dispatcher=_,this.on("data",y=>this._dataHandler(y)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((y,w,R,D)=>{const z=new(Jr(w.type))(y,w,R,D);if(z.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${z.id}`);return z})(t,f,_,this),this._tiles={},this._cache=new Mt(0,y=>this._unloadTile(y)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new An,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const f=this._tiles[t];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,f,_){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,f,_)}catch(y){t.state="errored",y.status!==404?this._source.fire(new l.j(y,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new l.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const _=this._tiles[f];_.upload(t),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(vr).map(t=>t.key)}getRenderableIds(t){const f=[];for(const _ in this._tiles)this._isIdRenderable(_,t)&&f.push(this._tiles[_]);return t?f.sort((_,y)=>{const w=_.tileID,R=y.tileID,D=new l.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),z=new l.P(R.canonical.x,R.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-R.overscaledZ||z.y-D.y||z.x-D.x}).map(_=>_.tileID.key):f.map(_=>_.tileID).sort(vr).map(_=>_.key)}hasRenderableParent(t){const f=this.findLoadedParent(t,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(t,f){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(f||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,f){return l._(this,void 0,void 0,function*(){const _=this._tiles[t];_&&(_.state!=="loading"&&(_.state=f),yield this._loadTile(_,t,f))})}_tileLoaded(t,f,_){t.timeAdded=C.now(),_==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(f,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const f=this.getRenderableIds();for(let y=0;y<f.length;y++){const w=f[y];if(t.neighboringTiles&&t.neighboringTiles[w]){const R=this.getTileByID(w);_(t,R),_(R,t)}}function _(y,w){y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let R=w.tileID.canonical.x-y.tileID.canonical.x;const D=w.tileID.canonical.y-y.tileID.canonical.y,z=Math.pow(2,y.tileID.canonical.z),q=w.tileID.key;R===0&&D===0||Math.abs(D)>1||(Math.abs(R)>1&&(Math.abs(R+z)===1?R+=z:Math.abs(R-z)===1&&(R-=z)),w.dem&&y.dem&&(y.dem.backfillBorder(w.dem,R,D),y.neighboringTiles&&y.neighboringTiles[q]&&(y.neighboringTiles[q].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,f,_,y){for(const w in this._tiles){let R=this._tiles[w];if(y[w]||!R.hasData()||R.tileID.overscaledZ<=f||R.tileID.overscaledZ>_)continue;let D=R.tileID;for(;R&&R.tileID.overscaledZ>f+1;){const q=R.tileID.scaledTo(R.tileID.overscaledZ-1);R=this._tiles[q.key],R&&R.hasData()&&(D=q)}let z=D;for(;z.overscaledZ>f;)if(z=z.scaledTo(z.overscaledZ-1),t[z.key]){y[D.key]=D;break}}}findLoadedParent(t,f){if(t.key in this._loadedParentTiles){const _=this._loadedParentTiles[t.key];return _&&_.tileID.overscaledZ>=f?_:null}for(let _=t.overscaledZ-1;_>=f;_--){const y=t.scaledTo(_),w=this._getLoadedTile(y);if(w)return w}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const f=this._tiles[t.key];return f&&f.hasData()?f:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const f=Math.ceil(t.width/this._source.tileSize)+1,_=Math.ceil(t.height/this._source.tileSize)+1,y=Math.floor(f*_*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(w)}handleWrapJump(t){const f=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,f){const _={};for(const y in this._tiles){const w=this._tiles[y];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+f),_[w.tileID.key]=w}this._tiles=_;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(y,this._tiles[y])}}_updateCoveredAndRetainedTiles(t,f,_,y,w,R){const D={},z={},q=Object.keys(t),H=C.now();for(const X of q){const ne=t[X],me=this._tiles[X];if(!me||me.fadeEndTime!==0&&me.fadeEndTime<=H)continue;const we=this.findLoadedParent(ne,f),Me=this.findLoadedSibling(ne),Ne=we||Me||null;Ne&&(this._addTile(Ne.tileID),D[Ne.tileID.key]=Ne.tileID),z[X]=ne}this._retainLoadedChildren(z,y,_,t);for(const X in D)t[X]||(this._coveredTiles[X]=!0,t[X]=D[X]);if(R){const X={},ne={};for(const me of w)this._tiles[me.key].hasData()?X[me.key]=me:ne[me.key]=me;for(const me in ne){const we=ne[me].children(this._source.maxzoom);this._tiles[we[0].key]&&this._tiles[we[1].key]&&this._tiles[we[2].key]&&this._tiles[we[3].key]&&(X[we[0].key]=t[we[0].key]=we[0],X[we[1].key]=t[we[1].key]=we[1],X[we[2].key]=t[we[2].key]=we[2],X[we[3].key]=t[we[3].key]=we[3],delete ne[me])}for(const me in ne){const we=ne[me],Me=this.findLoadedParent(we,this._source.minzoom),Ne=this.findLoadedSibling(we),Fe=Me||Ne||null;if(Fe){X[Fe.tileID.key]=t[Fe.tileID.key]=Fe.tileID;for(const Ve in X)X[Ve].isChildOf(Fe.tileID)&&delete X[Ve]}}for(const me in this._tiles)X[me]||(this._coveredTiles[me]=!0)}}update(t,f){if(!this._sourceLoaded||this._paused)return;let _;this.transform=t,this.terrain=f,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(H=>new l.S(H.canonical.z,H.wrap,H.canonical.z,H.canonical.x,H.canonical.y)):(_=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:f}),this._source.hasTile&&(_=_.filter(H=>this._source.hasTile(H)))):_=[];const y=t.coveringZoomLevel(this._source),w=Math.max(y-At.maxOverzooming,this._source.minzoom),R=Math.max(y+At.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const H={};for(const X of _)if(X.canonical.z>this._source.minzoom){const ne=X.scaledTo(X.canonical.z-1);H[ne.key]=ne;const me=X.scaledTo(Math.max(this._source.minzoom,Math.min(X.canonical.z,5)));H[me.key]=me}_=_.concat(Object.values(H))}const D=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,D&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const z=this._updateRetainedTiles(_,y);Gr(this._source.type)&&this._updateCoveredAndRetainedTiles(z,w,R,y,_,f);for(const H in z)this._tiles[H].clearFadeHold();const q=l.ab(this._tiles,z);for(const H of q){const X=this._tiles[H];X.hasSymbolBuckets&&!X.holdingForFade()?X.setHoldDuration(this.map._fadeDuration):X.hasSymbolBuckets&&!X.symbolFadeFinished()||this._removeTile(H)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,f){var _;const y={},w={},R=Math.max(f-At.maxOverzooming,this._source.minzoom),D=Math.max(f+At.maxUnderzooming,this._source.minzoom),z={};for(const q of t){const H=this._addTile(q);y[q.key]=q,H.hasData()||f<this._source.maxzoom&&(z[q.key]=q)}this._retainLoadedChildren(z,f,D,y);for(const q of t){let H=this._tiles[q.key];if(H.hasData())continue;if(f+1>this._source.maxzoom){const ne=q.children(this._source.maxzoom)[0],me=this.getTile(ne);if(me&&me.hasData()){y[ne.key]=ne;continue}}else{const ne=q.children(this._source.maxzoom);if(y[ne[0].key]&&y[ne[1].key]&&y[ne[2].key]&&y[ne[3].key])continue}let X=H.wasRequested();for(let ne=q.overscaledZ-1;ne>=R;--ne){const me=q.scaledTo(ne);if(w[me.key])break;if(w[me.key]=!0,H=this.getTile(me),!H&&X&&(H=this._addTile(me)),H){const we=H.hasData();if((we||!(!((_=this.map)===null||_===void 0)&&_.cancelPendingTileRequestsWhileZooming)||X)&&(y[me.key]=me),X=H.wasRequested(),we)break}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const f=[];let _,y=this._tiles[t].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){_=this._loadedParentTiles[y.key];break}f.push(y.key);const w=y.scaledTo(y.overscaledZ-1);if(_=this._getLoadedTile(w),_)break;y=w}for(const w of f)this._loadedParentTiles[w]=_}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const f=this._tiles[t].tileID,_=this._getLoadedTile(f);this._loadedSiblingTiles[f.key]=_}}_addTile(t){let f=this._tiles[t.key];if(f)return f;f=this._cache.getAndRemove(t),f&&(this._setTileReloadTimer(t.key,f),f.tileID=t,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,f)));const _=f;return f||(f=new Ms(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(f,t.key,f.state)),f.uses++,this._tiles[t.key]=f,_||this._source.fire(new l.k("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(t,f){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const _=f.getExpiryTimeout();_&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},_))}_removeTile(t){const f=this._tiles[t];f&&(f.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}_dataHandler(t){const f=t.sourceDataType;t.dataType==="source"&&f==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&f==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,f,_){const y=[],w=this.transform;if(!w)return y;const R=_?w.getCameraQueryGeometry(t):t,D=t.map(we=>w.pointCoordinate(we,this.terrain)),z=R.map(we=>w.pointCoordinate(we,this.terrain)),q=this.getIds();let H=1/0,X=1/0,ne=-1/0,me=-1/0;for(const we of z)H=Math.min(H,we.x),X=Math.min(X,we.y),ne=Math.max(ne,we.x),me=Math.max(me,we.y);for(let we=0;we<q.length;we++){const Me=this._tiles[q[we]];if(Me.holdingForFade())continue;const Ne=Me.tileID,Fe=Math.pow(2,w.zoom-Me.tileID.overscaledZ),Ve=f*Me.queryPadding*l.X/Me.tileSize/Fe,Te=[Ne.getTilePoint(new l.Z(H,X)),Ne.getTilePoint(new l.Z(ne,me))];if(Te[0].x-Ve<l.X&&Te[0].y-Ve<l.X&&Te[1].x+Ve>=0&&Te[1].y+Ve>=0){const He=D.map(st=>Ne.getTilePoint(st)),Je=z.map(st=>Ne.getTilePoint(st));y.push({tile:Me,tileID:Ne,queryGeometry:He,cameraQueryGeometry:Je,scale:Fe})}}return y}getVisibleCoordinates(t){const f=this.getRenderableIds(t).map(_=>this._tiles[_].tileID);for(const _ of f)_.posMatrix=this.transform.calculatePosMatrix(_.toUnwrapped());return f}hasTransition(){if(this._source.hasTransition())return!0;if(Gr(this._source.type)){const t=C.now();for(const f in this._tiles)if(this._tiles[f].fadeEndTime>=t)return!0}return!1}setFeatureState(t,f,_){this._state.updateState(t=t||"_geojsonTileLayer",f,_)}removeFeatureState(t,f,_){this._state.removeFeatureState(t=t||"_geojsonTileLayer",f,_)}getFeatureState(t,f){return this._state.getState(t=t||"_geojsonTileLayer",f)}setDependencies(t,f,_){const y=this._tiles[t];y&&y.setDependencies(f,_)}reloadTilesForDependencies(t,f){for(const _ in this._tiles)this._tiles[_].hasDependency(t,f)&&this._reloadTile(_,"reloading");this._cache.filter(_=>!_.hasDependency(t,f))}}function vr(k,t){const f=Math.abs(2*k.wrap)-+(k.wrap<0),_=Math.abs(2*t.wrap)-+(t.wrap<0);return k.overscaledZ-t.overscaledZ||_-f||t.canonical.y-k.canonical.y||t.canonical.x-k.canonical.x}function Gr(k){return k==="raster"||k==="image"||k==="video"}At.maxOverzooming=10,At.maxUnderzooming=3;class bn{constructor(t,f){this.reset(t,f)}reset(t,f){this.points=t||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=l.ac(t,0,1);let f=1,_=this._distances[f];const y=t*this.paddedLength+this.padding;for(;_<y&&f<this._distances.length;)_=this._distances[++f];const w=f-1,R=this._distances[w],D=_-R,z=D>0?(y-R)/D:0;return this.points[w].mult(1-z).add(this.points[f].mult(z))}}function Pi(k,t){let f=!0;return k==="always"||k!=="never"&&t!=="never"||(f=!1),f}class Ar{constructor(t,f,_){const y=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(t/_),this.yCellCount=Math.ceil(f/_);for(let R=0;R<this.xCellCount*this.yCellCount;R++)y.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=f,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,f,_,y,w){this._forEachCell(f,_,y,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(y),this.bboxes.push(w)}insertCircle(t,f,_,y){this._forEachCell(f-y,_-y,f+y,_+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(f),this.circles.push(_),this.circles.push(y)}_insertBoxCell(t,f,_,y,w,R){this.boxCells[w].push(R)}_insertCircleCell(t,f,_,y,w,R){this.circleCells[w].push(R)}_query(t,f,_,y,w,R,D){if(_<0||t>this.width||y<0||f>this.height)return[];const z=[];if(t<=0&&f<=0&&this.width<=_&&this.height<=y){if(w)return[{key:null,x1:t,y1:f,x2:_,y2:y}];for(let q=0;q<this.boxKeys.length;q++)z.push({key:this.boxKeys[q],x1:this.bboxes[4*q],y1:this.bboxes[4*q+1],x2:this.bboxes[4*q+2],y2:this.bboxes[4*q+3]});for(let q=0;q<this.circleKeys.length;q++){const H=this.circles[3*q],X=this.circles[3*q+1],ne=this.circles[3*q+2];z.push({key:this.circleKeys[q],x1:H-ne,y1:X-ne,x2:H+ne,y2:X+ne})}}else this._forEachCell(t,f,_,y,this._queryCell,z,{hitTest:w,overlapMode:R,seenUids:{box:{},circle:{}}},D);return z}query(t,f,_,y){return this._query(t,f,_,y,!1,null)}hitTest(t,f,_,y,w,R){return this._query(t,f,_,y,!0,w,R).length>0}hitTestCircle(t,f,_,y,w){const R=t-_,D=t+_,z=f-_,q=f+_;if(D<0||R>this.width||q<0||z>this.height)return!1;const H=[];return this._forEachCell(R,z,D,q,this._queryCellCircle,H,{hitTest:!0,overlapMode:y,circle:{x:t,y:f,radius:_},seenUids:{box:{},circle:{}}},w),H.length>0}_queryCell(t,f,_,y,w,R,D,z){const{seenUids:q,hitTest:H,overlapMode:X}=D,ne=this.boxCells[w];if(ne!==null){const we=this.bboxes;for(const Me of ne)if(!q.box[Me]){q.box[Me]=!0;const Ne=4*Me,Fe=this.boxKeys[Me];if(t<=we[Ne+2]&&f<=we[Ne+3]&&_>=we[Ne+0]&&y>=we[Ne+1]&&(!z||z(Fe))&&(!H||!Pi(X,Fe.overlapMode))&&(R.push({key:Fe,x1:we[Ne],y1:we[Ne+1],x2:we[Ne+2],y2:we[Ne+3]}),H))return!0}}const me=this.circleCells[w];if(me!==null){const we=this.circles;for(const Me of me)if(!q.circle[Me]){q.circle[Me]=!0;const Ne=3*Me,Fe=this.circleKeys[Me];if(this._circleAndRectCollide(we[Ne],we[Ne+1],we[Ne+2],t,f,_,y)&&(!z||z(Fe))&&(!H||!Pi(X,Fe.overlapMode))){const Ve=we[Ne],Te=we[Ne+1],He=we[Ne+2];if(R.push({key:Fe,x1:Ve-He,y1:Te-He,x2:Ve+He,y2:Te+He}),H)return!0}}}return!1}_queryCellCircle(t,f,_,y,w,R,D,z){const{circle:q,seenUids:H,overlapMode:X}=D,ne=this.boxCells[w];if(ne!==null){const we=this.bboxes;for(const Me of ne)if(!H.box[Me]){H.box[Me]=!0;const Ne=4*Me,Fe=this.boxKeys[Me];if(this._circleAndRectCollide(q.x,q.y,q.radius,we[Ne+0],we[Ne+1],we[Ne+2],we[Ne+3])&&(!z||z(Fe))&&!Pi(X,Fe.overlapMode))return R.push(!0),!0}}const me=this.circleCells[w];if(me!==null){const we=this.circles;for(const Me of me)if(!H.circle[Me]){H.circle[Me]=!0;const Ne=3*Me,Fe=this.circleKeys[Me];if(this._circlesCollide(we[Ne],we[Ne+1],we[Ne+2],q.x,q.y,q.radius)&&(!z||z(Fe))&&!Pi(X,Fe.overlapMode))return R.push(!0),!0}}}_forEachCell(t,f,_,y,w,R,D,z){const q=this._convertToXCellCoord(t),H=this._convertToYCellCoord(f),X=this._convertToXCellCoord(_),ne=this._convertToYCellCoord(y);for(let me=q;me<=X;me++)for(let we=H;we<=ne;we++)if(w.call(this,t,f,_,y,this.xCellCount*we+me,R,D,z))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,f,_,y,w,R){const D=y-t,z=w-f,q=_+R;return q*q>D*D+z*z}_circleAndRectCollide(t,f,_,y,w,R,D){const z=(R-y)/2,q=Math.abs(t-(y+z));if(q>z+_)return!1;const H=(D-w)/2,X=Math.abs(f-(w+H));if(X>H+_)return!1;if(q<=z||X<=H)return!0;const ne=q-z,me=X-H;return ne*ne+me*me<=_*_}}function Ji(k,t,f,_,y){const w=l.H();return t?(l.K(w,w,[1/y,1/y,1]),f||l.ad(w,w,_.angle)):l.L(w,_.labelPlaneMatrix,k),w}function Zr(k,t,f,_,y){if(t){const w=l.ae(k);return l.K(w,w,[y,y,1]),f||l.ad(w,w,-_.angle),w}return _.glCoordMatrix}function Re(k,t,f,_){let y;_?(y=[k,t,_(k,t),1],l.af(y,y,f)):(y=[k,t,0,1],Gn(y,y,f));const w=y[3];return{point:new l.P(y[0]/w,y[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}function J(k,t){return .5+k/t*.5}function $(k,t){return k.x>=-t[0]&&k.x<=t[0]&&k.y>=-t[1]&&k.y<=t[1]}function he(k,t,f,_,y,w,R,D,z,q,H,X,ne,me,we){const Me=_?k.textSizeData:k.iconSizeData,Ne=l.ag(Me,f.transform.zoom),Fe=[256/f.width*2+1,256/f.height*2+1],Ve=_?k.text.dynamicLayoutVertexArray:k.icon.dynamicLayoutVertexArray;Ve.clear();const Te=k.lineVertexArray,He=_?k.text.placedSymbolArray:k.icon.placedSymbolArray,Je=f.transform.width/f.transform.height;let st=!1;for(let xt=0;xt<He.length;xt++){const Pt=He.get(xt);if(Pt.hidden||Pt.writingMode===l.ah.vertical&&!st){ln(Pt.numGlyphs,Ve);continue}st=!1;const Zt=Re(Pt.anchorX,Pt.anchorY,t,we);if(!$(Zt.point,Fe)){ln(Pt.numGlyphs,Ve);continue}const Kt=J(f.transform.cameraToCenterDistance,Zt.signedDistanceFromCamera),qt=l.ai(Me,Ne,Pt),jt=R?qt/Kt:qt*Kt,rn={getElevation:we,labelPlaneMatrix:y,lineVertexArray:Te,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:q,tileAnchorPoint:new l.P(Pt.anchorX,Pt.anchorY),unwrappedTileID:H,width:X,height:ne,translation:me},Sn=je(rn,Pt,jt,!1,D,t,w,k.glyphOffsetArray,Ve,Je,z);st=Sn.useVertical,(Sn.notEnoughRoom||st||Sn.needsFlipping&&je(rn,Pt,jt,!0,D,t,w,k.glyphOffsetArray,Ve,Je,z).notEnoughRoom)&&ln(Pt.numGlyphs,Ve)}_?k.text.dynamicLayoutVertexBuffer.updateData(Ve):k.icon.dynamicLayoutVertexBuffer.updateData(Ve)}function ue(k,t,f,_,y,w,R,D){const z=w.glyphStartIndex+w.numGlyphs,q=w.lineStartIndex,H=w.lineStartIndex+w.lineLength,X=t.getoffsetX(w.glyphStartIndex),ne=t.getoffsetX(z-1),me=Dt(k*X,f,_,y,w.segment,q,H,D,R);if(!me)return null;const we=Dt(k*ne,f,_,y,w.segment,q,H,D,R);return we?D.projectionCache.anyProjectionOccluded?null:{first:me,last:we}:null}function fe(k,t,f,_){return k===l.ah.horizontal&&Math.abs(f.y-t.y)>Math.abs(f.x-t.x)*_?{useVertical:!0}:(k===l.ah.vertical?t.y<f.y:t.x>f.x)?{needsFlipping:!0}:null}function je(k,t,f,_,y,w,R,D,z,q,H){const X=f/24,ne=t.lineOffsetX*X,me=t.lineOffsetY*X;let we;if(t.numGlyphs>1){const Me=t.glyphStartIndex+t.numGlyphs,Ne=t.lineStartIndex,Fe=t.lineStartIndex+t.lineLength,Ve=ue(X,D,ne,me,_,t,H,k);if(!Ve)return{notEnoughRoom:!0};const Te=Re(Ve.first.point.x,Ve.first.point.y,R,k.getElevation).point,He=Re(Ve.last.point.x,Ve.last.point.y,R,k.getElevation).point;if(y&&!_){const Je=fe(t.writingMode,Te,He,q);if(Je)return Je}we=[Ve.first];for(let Je=t.glyphStartIndex+1;Je<Me-1;Je++)we.push(Dt(X*D.getoffsetX(Je),ne,me,_,t.segment,Ne,Fe,k,H));we.push(Ve.last)}else{if(y&&!_){const Ne=Re(k.tileAnchorPoint.x,k.tileAnchorPoint.y,w,k.getElevation).point,Fe=t.lineStartIndex+t.segment+1,Ve=new l.P(k.lineVertexArray.getx(Fe),k.lineVertexArray.gety(Fe)),Te=Re(Ve.x,Ve.y,w,k.getElevation),He=Te.signedDistanceFromCamera>0?Te.point:function(st,xt,Pt,Zt,Kt,qt){return Xe(st,xt,Pt,1,Kt,qt)}(k.tileAnchorPoint,Ve,Ne,0,w,k),Je=fe(t.writingMode,Ne,He,q);if(Je)return Je}const Me=Dt(X*D.getoffsetX(t.glyphStartIndex),ne,me,_,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,k,H);if(!Me||k.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};we=[Me]}for(const Me of we)l.aj(z,Me.point,Me.angle);return{}}function Xe(k,t,f,_,y,w){const R=k.add(k.sub(t)._unit()),D=y!==void 0?Re(R.x,R.y,y,w.getElevation).point:et(R.x,R.y,w).point,z=f.sub(D);return f.add(z._mult(_/z.mag()))}function Pe(k,t,f){const _=t.projectionCache;if(_.projections[k])return _.projections[k];const y=new l.P(t.lineVertexArray.getx(k),t.lineVertexArray.gety(k)),w=et(y.x,y.y,t);if(w.signedDistanceFromCamera>0)return _.projections[k]=w.point,_.anyProjectionOccluded=_.anyProjectionOccluded||w.isOccluded,w.point;const R=k-f.direction;return function(D,z,q,H,X){return Xe(D,z,q,H,void 0,X)}(f.distanceFromAnchor===0?t.tileAnchorPoint:new l.P(t.lineVertexArray.getx(R),t.lineVertexArray.gety(R)),y,f.previousVertex,f.absOffsetX-f.distanceFromAnchor+1,t)}function et(k,t,f){const _=k+f.translation[0],y=t+f.translation[1];let w;return!f.pitchWithMap&&f.projection.useSpecialProjectionForSymbols?(w=f.projection.projectTileCoordinates(_,y,f.unwrappedTileID,f.getElevation),w.point.x=(.5*w.point.x+.5)*f.width,w.point.y=(.5*-w.point.y+.5)*f.height):(w=Re(_,y,f.labelPlaneMatrix,f.getElevation),w.isOccluded=!1),w}function gt(k,t,f){return k._unit()._perp()._mult(t*f)}function at(k,t,f,_,y,w,R,D,z){if(D.projectionCache.offsets[k])return D.projectionCache.offsets[k];const q=f.add(t);if(k+z.direction<_||k+z.direction>=y)return D.projectionCache.offsets[k]=q,q;const H=Pe(k+z.direction,D,z),X=gt(H.sub(f),R,z.direction),ne=f.add(X),me=H.add(X);return D.projectionCache.offsets[k]=l.ak(w,q,ne,me)||q,D.projectionCache.offsets[k]}function Dt(k,t,f,_,y,w,R,D,z){const q=_?k-t:k+t;let H=q>0?1:-1,X=0;_&&(H*=-1,X=Math.PI),H<0&&(X+=Math.PI);let ne,me=H>0?w+y:w+y+1;D.projectionCache.cachedAnchorPoint?ne=D.projectionCache.cachedAnchorPoint:(ne=et(D.tileAnchorPoint.x,D.tileAnchorPoint.y,D).point,D.projectionCache.cachedAnchorPoint=ne);let we,Me,Ne=ne,Fe=ne,Ve=0,Te=0;const He=Math.abs(q),Je=[];let st;for(;Ve+Te<=He;){if(me+=H,me<w||me>=R)return null;Ve+=Te,Fe=Ne,Me=we;const Zt={absOffsetX:He,direction:H,distanceFromAnchor:Ve,previousVertex:Fe};if(Ne=Pe(me,D,Zt),f===0)Je.push(Fe),st=Ne.sub(Fe);else{let Kt;const qt=Ne.sub(Fe);Kt=qt.mag()===0?gt(Pe(me+H,D,Zt).sub(Ne),f,H):gt(qt,f,H),Me||(Me=Fe.add(Kt)),we=at(me,Kt,Ne,w,R,Me,f,D,Zt),Je.push(Me),st=we.sub(Me)}Te=st.mag()}const xt=st._mult((He-Ve)/Te)._add(Me||Fe),Pt=X+Math.atan2(Ne.y-Fe.y,Ne.x-Fe.x);return Je.push(xt),{point:xt,angle:z?Pt:0,path:Je}}const en=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ln(k,t){for(let f=0;f<k;f++){const _=t.length;t.resize(_+4),t.float32.set(en,3*_)}}function Gn(k,t,f){const _=t[0],y=t[1];return k[0]=f[0]*_+f[4]*y+f[12],k[1]=f[1]*_+f[5]*y+f[13],k[3]=f[3]*_+f[7]*y+f[15],k}const Tn=100;class Cn{constructor(t,f,_=new Ar(t.width+200,t.height+200,25),y=new Ar(t.width+200,t.height+200,25)){this.transform=t,this.mapProjection=f,this.grid=_,this.ignoredGrid=y,this.pitchFactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Tn,this.screenBottomBoundary=t.height+Tn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,f,_,y,w,R,D,z,q,H,X){const ne=t.anchorPointX+z[0],me=t.anchorPointY+z[1],we=this.projectAndGetPerspectiveRatio(y,ne,me,w,H),Me=_*we.perspectiveRatio;let Ne;if(R||D)Ne=this._projectCollisionBox(t,Me,y,w,R,D,z,we,H,X);else{const Je=we.point.x+(X?X.x*Me:0),st=we.point.y+(X?X.y*Me:0);Ne={allPointsOccluded:!1,box:[Je+t.x1*Me,st+t.y1*Me,Je+t.x2*Me,st+t.y2*Me]}}const[Fe,Ve,Te,He]=Ne.box;return this.mapProjection.useSpecialProjectionForSymbols&&(R?Ne.allPointsOccluded:this.mapProjection.isOccluded(ne,me,w))||we.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Fe,Ve,Te,He)||f!=="always"&&this.grid.hitTest(Fe,Ve,Te,He,f,q)?{box:[Fe,Ve,Te,He],placeable:!1,offscreen:!1}:{box:[Fe,Ve,Te,He],placeable:!0,offscreen:this.isOffscreen(Fe,Ve,Te,He)}}placeCollisionCircles(t,f,_,y,w,R,D,z,q,H,X,ne,me,we,Me,Ne){const Fe=[],Ve=new l.P(f.anchorX,f.anchorY),Te=this.getPerspectiveRatio(R,Ve.x,Ve.y,D,Ne),He=(X?w/Te:w*Te)/l.ap,Je={getElevation:Ne,labelPlaneMatrix:z,lineVertexArray:_,pitchWithMap:X,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Ve,unwrappedTileID:D,width:this.transform.width,height:this.transform.height,translation:Me},st=ue(He,y,f.lineOffsetX*He,f.lineOffsetY*He,!1,f,!1,Je);let xt=!1,Pt=!1,Zt=!0;if(st){const Kt=.5*me*Te+we,qt=new l.P(-100,-100),jt=new l.P(this.screenRightBoundary,this.screenBottomBoundary),rn=new bn,Sn=st.first,Vt=st.last;let Xt=[];for(let Bn=Sn.path.length-1;Bn>=1;Bn--)Xt.push(Sn.path[Bn]);for(let Bn=1;Bn<Vt.path.length;Bn++)Xt.push(Vt.path[Bn]);const wn=2.5*Kt;if(q){const Bn=this.projectPathToScreenSpace(Xt,Je,q);Xt=Bn.some(qn=>qn.signedDistanceFromCamera<=0)?[]:Bn.map(qn=>qn.point)}let Ai=[];if(Xt.length>0){const Bn=Xt[0].clone(),qn=Xt[0].clone();for(let Ti=1;Ti<Xt.length;Ti++)Bn.x=Math.min(Bn.x,Xt[Ti].x),Bn.y=Math.min(Bn.y,Xt[Ti].y),qn.x=Math.max(qn.x,Xt[Ti].x),qn.y=Math.max(qn.y,Xt[Ti].y);Ai=Bn.x>=qt.x&&qn.x<=jt.x&&Bn.y>=qt.y&&qn.y<=jt.y?[Xt]:qn.x<qt.x||Bn.x>jt.x||qn.y<qt.y||Bn.y>jt.y?[]:l.al([Xt],qt.x,qt.y,jt.x,jt.y)}for(const Bn of Ai){rn.reset(Bn,.25*Kt);let qn=0;qn=rn.length<=.5*Kt?1:Math.ceil(rn.paddedLength/wn)+1;for(let Ti=0;Ti<qn;Ti++){const zr=Ti/Math.max(qn-1,1),Hs=rn.lerp(zr),Ci=Hs.x+Tn,os=Hs.y+Tn;Fe.push(Ci,os,Kt,0);const Xr=Ci-Kt,Fr=os-Kt,Wr=Ci+Kt,ho=os+Kt;if(Zt=Zt&&this.isOffscreen(Xr,Fr,Wr,ho),Pt=Pt||this.isInsideGrid(Xr,Fr,Wr,ho),t!=="always"&&this.grid.hitTestCircle(Ci,os,Kt,t,ne)&&(xt=!0,!H))return{circles:[],offscreen:!1,collisionDetected:xt}}}}return{circles:!H&&xt||!Pt||Te<this.perspectiveRatioCutoff?[]:Fe,offscreen:Zt,collisionDetected:xt}}projectPathToScreenSpace(t,f,_){return t.map(y=>Re(y.x,y.y,_,f.getElevation))}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let _=1/0,y=1/0,w=-1/0,R=-1/0;for(const H of t){const X=new l.P(H.x+Tn,H.y+Tn);_=Math.min(_,X.x),y=Math.min(y,X.y),w=Math.max(w,X.x),R=Math.max(R,X.y),f.push(X)}const D=this.grid.query(_,y,w,R).concat(this.ignoredGrid.query(_,y,w,R)),z={},q={};for(const H of D){const X=H.key;if(z[X.bucketInstanceId]===void 0&&(z[X.bucketInstanceId]={}),z[X.bucketInstanceId][X.featureIndex])continue;const ne=[new l.P(H.x1,H.y1),new l.P(H.x2,H.y1),new l.P(H.x2,H.y2),new l.P(H.x1,H.y2)];l.am(f,ne)&&(z[X.bucketInstanceId][X.featureIndex]=!0,q[X.bucketInstanceId]===void 0&&(q[X.bucketInstanceId]=[]),q[X.bucketInstanceId].push(X.featureIndex))}return q}insertCollisionBox(t,f,_,y,w,R){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:w,collisionGroupID:R,overlapMode:f},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,f,_,y,w,R){const D=_?this.ignoredGrid:this.grid,z={bucketInstanceId:y,featureIndex:w,collisionGroupID:R,overlapMode:f};for(let q=0;q<t.length;q+=4)D.insertCircle(z,t[q],t[q+1],t[q+2])}projectAndGetPerspectiveRatio(t,f,_,y,w){let R;w?(R=[f,_,w(f,_),1],l.af(R,R,t)):(R=[f,_,0,1],Gn(R,R,t));const D=R[3];return{point:new l.P((R[0]/D+1)/2*this.transform.width+Tn,(-R[1]/D+1)/2*this.transform.height+Tn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/D*.5,isOccluded:!1,signedDistanceFromCamera:D}}getPerspectiveRatio(t,f,_,y,w){const R=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(f,_,y,w):Re(f,_,t,w);return .5+this.transform.cameraToCenterDistance/R.signedDistanceFromCamera*.5}isOffscreen(t,f,_,y){return _<Tn||t>=this.screenRightBoundary||y<Tn||f>this.screenBottomBoundary}isInsideGrid(t,f,_,y){return _>=0&&t<this.gridRightBoundary&&y>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const t=l.an([]);return l.J(t,t,[-100,-100,0]),t}_projectCollisionBox(t,f,_,y,w,R,D,z,q,H){let X=new l.P(1,0),ne=new l.P(0,1);const me=new l.P(t.anchorPointX+D[0],t.anchorPointY+D[1]);if(R&&!w){const Zt=this.projectAndGetPerspectiveRatio(_,me.x+1,me.y,y,q).point.sub(z.point).unit(),Kt=Math.atan(Zt.y/Zt.x)+(Zt.x<0?Math.PI:0),qt=Math.sin(Kt),jt=Math.cos(Kt);X=new l.P(jt,qt),ne=new l.P(-qt,jt)}else if(!R&&w){const Zt=-this.transform.angle,Kt=Math.sin(Zt),qt=Math.cos(Zt);X=new l.P(qt,Kt),ne=new l.P(-Kt,qt)}let we=z.point,Me=f;if(w){we=me;const Zt=this.transform.zoom-Math.floor(this.transform.zoom);Me=Math.pow(2,-Zt),Me*=this.mapProjection.getPitchedTextCorrection(this.transform,me,y),H||(Me*=l.ac(.5+z.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}H&&(we=we.add(X.mult(H.x*Me)).add(ne.mult(H.y*Me)));const Ne=t.x1*Me,Fe=t.x2*Me,Ve=(Ne+Fe)/2,Te=t.y1*Me,He=t.y2*Me,Je=(Te+He)/2,st=[{offsetX:Ne,offsetY:Te},{offsetX:Ve,offsetY:Te},{offsetX:Fe,offsetY:Te},{offsetX:Fe,offsetY:Je},{offsetX:Fe,offsetY:He},{offsetX:Ve,offsetY:He},{offsetX:Ne,offsetY:He},{offsetX:Ne,offsetY:Je}];let xt=[];for(const{offsetX:Zt,offsetY:Kt}of st)xt.push(new l.P(we.x+X.x*Zt+ne.x*Kt,we.y+X.y*Zt+ne.y*Kt));let Pt=!1;if(w){const Zt=xt.map(Kt=>this.projectAndGetPerspectiveRatio(_,Kt.x,Kt.y,y,q));Pt=Zt.some(Kt=>!Kt.isOccluded),xt=Zt.map(Kt=>Kt.point)}else Pt=!0;return{box:l.ao(xt),allPointsOccluded:!Pt}}}function Un(k,t,f){return t*(l.X/(k.tileSize*Math.pow(2,f-k.tileID.overscaledZ)))}class Ii{constructor(t,f,_,y){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?f:-f))):y&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class ci{constructor(t,f,_,y,w){this.text=new Ii(t?t.text:null,f,_,w),this.icon=new Ii(t?t.icon:null,f,y,w)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class En{constructor(t,f,_){this.text=t,this.icon=f,this.skipFade=_}}class ri{constructor(){this.invProjMatrix=l.H(),this.viewportMatrix=l.H(),this.circles=[]}}class fi{constructor(t,f,_,y,w){this.bucketInstanceId=t,this.featureIndex=f,this.sourceLayerIndex=_,this.bucketIndex=y,this.tileID=w}}class Di{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const f=++this.maxGroupID;this.collisionGroups[t]={ID:f,predicate:_=>_.collisionGroupID===f}}return this.collisionGroups[t]}}function Kn(k,t,f,_,y){const{horizontalAlign:w,verticalAlign:R}=l.au(k);return new l.P(-(w-.5)*t+_[0]*y,-(R-.5)*f+_[1]*y)}class Tr{constructor(t,f,_,y,w,R){this.transform=t.clone(),this.terrain=_,this.collisionIndex=new Cn(this.transform,f),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=y,this.retainedQueryData={},this.collisionGroups=new Di(w),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=R,R&&(R.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const f=this.terrain;return f?(_,y)=>f.getElevation(t,_,y):null}getBucketParts(t,f,_,y){const w=_.getBucket(f),R=_.latestFeatureIndex;if(!w||!R||f.id!==w.layerIds[0])return;const D=_.collisionBoxArray,z=w.layers[0].layout,q=w.layers[0].paint,H=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),X=_.tileSize/l.X,ne=_.tileID.toUnwrapped(),me=this.transform.calculatePosMatrix(ne),we=z.get("text-pitch-alignment")==="map",Me=z.get("text-rotation-alignment")==="map",Ne=Un(_,1,this.transform.zoom),Fe=this.collisionIndex.mapProjection.translatePosition(this.transform,_,q.get("text-translate"),q.get("text-translate-anchor")),Ve=this.collisionIndex.mapProjection.translatePosition(this.transform,_,q.get("icon-translate"),q.get("icon-translate-anchor")),Te=Ji(me,we,Me,this.transform,Ne);let He=null;if(we){const st=Zr(me,we,Me,this.transform,Ne);He=l.L([],this.transform.labelPlaneMatrix,st)}this.retainedQueryData[w.bucketInstanceId]=new fi(w.bucketInstanceId,R,w.sourceLayerIndex,w.index,_.tileID);const Je={bucket:w,layout:z,translationText:Fe,translationIcon:Ve,posMatrix:me,unwrappedTileID:ne,textLabelPlaneMatrix:Te,labelToScreenMatrix:He,scale:H,textPixelRatio:X,holdingForFade:_.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:l.ag(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(y)for(const st of w.sortKeyRanges){const{sortKey:xt,symbolInstanceStart:Pt,symbolInstanceEnd:Zt}=st;t.push({sortKey:xt,symbolInstanceStart:Pt,symbolInstanceEnd:Zt,parameters:Je})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Je})}attemptAnchorPlacement(t,f,_,y,w,R,D,z,q,H,X,ne,me,we,Me,Ne,Fe,Ve,Te){const He=l.aq[t.textAnchor],Je=[t.textOffset0,t.textOffset1],st=Kn(He,_,y,Je,w),xt=this.collisionIndex.placeCollisionBox(f,ne,z,q,H,D,R,Ne,X.predicate,Te,st);if((!Ve||this.collisionIndex.placeCollisionBox(Ve,ne,z,q,H,D,R,Fe,X.predicate,Te,st).placeable)&&xt.placeable){let Pt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[me.crossTileID]&&this.prevPlacement.placements[me.crossTileID]&&this.prevPlacement.placements[me.crossTileID].text&&(Pt=this.prevPlacement.variableOffsets[me.crossTileID].anchor),me.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[me.crossTileID]={textOffset:Je,width:_,height:y,anchor:He,textBoxScale:w,prevAnchor:Pt},this.markUsedJustification(we,He,me,Me),we.allowVerticalPlacement&&(this.markUsedOrientation(we,Me,me),this.placedOrientations[me.crossTileID]=Me),{shift:st,placedGlyphBoxes:xt}}}placeLayerBucketPart(t,f,_){const{bucket:y,layout:w,translationText:R,translationIcon:D,posMatrix:z,unwrappedTileID:q,textLabelPlaneMatrix:H,labelToScreenMatrix:X,textPixelRatio:ne,holdingForFade:me,collisionBoxArray:we,partiallyEvaluatedTextSize:Me,collisionGroup:Ne}=t.parameters,Fe=w.get("text-optional"),Ve=w.get("icon-optional"),Te=l.ar(w,"text-overlap","text-allow-overlap"),He=Te==="always",Je=l.ar(w,"icon-overlap","icon-allow-overlap"),st=Je==="always",xt=w.get("text-rotation-alignment")==="map",Pt=w.get("text-pitch-alignment")==="map",Zt=w.get("icon-text-fit")!=="none",Kt=w.get("symbol-z-order")==="viewport-y",qt=He&&(st||!y.hasIconData()||Ve),jt=st&&(He||!y.hasTextData()||Fe);!y.collisionArrays&&we&&y.deserializeCollisionBoxes(we);const rn=this._getTerrainElevationFunc(this.retainedQueryData[y.bucketInstanceId].tileID),Sn=(Vt,Xt,wn)=>{var Ai,Bn;if(f[Vt.crossTileID])return;if(me)return void(this.placements[Vt.crossTileID]=new En(!1,!1,!1));let qn=!1,Ti=!1,zr=!0,Hs=null,Ci={box:null,placeable:!1,offscreen:null},os={box:null,placeable:!1,offscreen:null},Xr=null,Fr=null,Wr=null,ho=0,tl=0,Su=0;Xt.textFeatureIndex?ho=Xt.textFeatureIndex:Vt.useRuntimeCollisionCircles&&(ho=Vt.featureIndex),Xt.verticalTextFeatureIndex&&(tl=Xt.verticalTextFeatureIndex);const nl=Xt.textBox;if(nl){const Fs=Pr=>{let Or=l.ah.horizontal;if(y.allowVerticalPlacement&&!Pr&&this.prevPlacement){const Ss=this.prevPlacement.placedOrientations[Vt.crossTileID];Ss&&(this.placedOrientations[Vt.crossTileID]=Ss,Or=Ss,this.markUsedOrientation(y,Or,Vt))}return Or},Os=(Pr,Or)=>{if(y.allowVerticalPlacement&&Vt.numVerticalGlyphVertices>0&&Xt.verticalTextBox){for(const Ss of y.writingModes)if(Ss===l.ah.vertical?(Ci=Or(),os=Ci):Ci=Pr(),Ci&&Ci.placeable)break}else Ci=Pr()},Qo=Vt.textAnchorOffsetStartIndex,Xs=Vt.textAnchorOffsetEndIndex;if(Xs===Qo){const Pr=(Or,Ss)=>{const Hn=this.collisionIndex.placeCollisionBox(Or,Te,ne,z,q,Pt,xt,R,Ne.predicate,rn);return Hn&&Hn.placeable&&(this.markUsedOrientation(y,Ss,Vt),this.placedOrientations[Vt.crossTileID]=Ss),Hn};Os(()=>Pr(nl,l.ah.horizontal),()=>{const Or=Xt.verticalTextBox;return y.allowVerticalPlacement&&Vt.numVerticalGlyphVertices>0&&Or?Pr(Or,l.ah.vertical):{box:null,offscreen:null}}),Fs(Ci&&Ci.placeable)}else{let Pr=l.aq[(Bn=(Ai=this.prevPlacement)===null||Ai===void 0?void 0:Ai.variableOffsets[Vt.crossTileID])===null||Bn===void 0?void 0:Bn.anchor];const Or=(Hn,Ia,il)=>{const rl=Hn.x2-Hn.x1,Hh=Hn.y2-Hn.y1,fd=Vt.textBoxScale,Xh=Zt&&Je==="never"?Ia:null;let ea=null,Wh=Te==="never"?1:2,Au="never";Pr&&Wh++;for(let Zl=0;Zl<Wh;Zl++){for(let Tu=Qo;Tu<Xs;Tu++){const Cu=y.textAnchorOffsets.get(Tu);if(Pr&&Cu.textAnchor!==Pr)continue;const sl=this.attemptAnchorPlacement(Cu,Hn,rl,Hh,fd,xt,Pt,ne,z,q,Ne,Au,Vt,y,il,R,D,Xh,rn);if(sl&&(ea=sl.placedGlyphBoxes,ea&&ea.placeable))return qn=!0,Hs=sl.shift,ea}Pr?Pr=null:Au=Te}return _&&!ea&&(ea={box:this.collisionIndex.placeCollisionBox(nl,"always",ne,z,q,Pt,xt,R,Ne.predicate,rn,new l.P(0,0)).box,offscreen:!1,placeable:!1}),ea};Os(()=>Or(nl,Xt.iconBox,l.ah.horizontal),()=>{const Hn=Xt.verticalTextBox;return y.allowVerticalPlacement&&(!Ci||!Ci.placeable)&&Vt.numVerticalGlyphVertices>0&&Hn?Or(Hn,Xt.verticalIconBox,l.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Ci&&(qn=Ci.placeable,zr=Ci.offscreen);const Ss=Fs(Ci&&Ci.placeable);if(!qn&&this.prevPlacement){const Hn=this.prevPlacement.variableOffsets[Vt.crossTileID];Hn&&(this.variableOffsets[Vt.crossTileID]=Hn,this.markUsedJustification(y,Hn.anchor,Vt,Ss))}}}if(Xr=Ci,qn=Xr&&Xr.placeable,zr=Xr&&Xr.offscreen,Vt.useRuntimeCollisionCircles){const Fs=y.text.placedSymbolArray.get(Vt.centerJustifiedTextSymbolIndex),Os=l.ai(y.textSizeData,Me,Fs),Qo=w.get("text-padding");Fr=this.collisionIndex.placeCollisionCircles(Te,Fs,y.lineVertexArray,y.glyphOffsetArray,Os,z,q,H,X,_,Pt,Ne.predicate,Vt.collisionCircleDiameter,Qo,R,rn),Fr.circles.length&&Fr.collisionDetected&&!_&&l.w("Collisions detected, but collision boxes are not shown"),qn=He||Fr.circles.length>0&&!Fr.collisionDetected,zr=zr&&Fr.offscreen}if(Xt.iconFeatureIndex&&(Su=Xt.iconFeatureIndex),Xt.iconBox){const Fs=Os=>this.collisionIndex.placeCollisionBox(Os,Je,ne,z,q,Pt,xt,D,Ne.predicate,rn,Zt&&Hs?Hs:void 0);os&&os.placeable&&Xt.verticalIconBox?(Wr=Fs(Xt.verticalIconBox),Ti=Wr.placeable):(Wr=Fs(Xt.iconBox),Ti=Wr.placeable),zr=zr&&Wr.offscreen}const zs=Fe||Vt.numHorizontalGlyphVertices===0&&Vt.numVerticalGlyphVertices===0,Eu=Ve||Vt.numIconVertices===0;zs||Eu?Eu?zs||(Ti=Ti&&qn):qn=Ti&&qn:Ti=qn=Ti&&qn;const Vc=Ti&&Wr.placeable;if(qn&&Xr.placeable&&this.collisionIndex.insertCollisionBox(Xr.box,Te,w.get("text-ignore-placement"),y.bucketInstanceId,os&&os.placeable&&tl?tl:ho,Ne.ID),Vc&&this.collisionIndex.insertCollisionBox(Wr.box,Je,w.get("icon-ignore-placement"),y.bucketInstanceId,Su,Ne.ID),Fr&&qn&&this.collisionIndex.insertCollisionCircles(Fr.circles,Te,w.get("text-ignore-placement"),y.bucketInstanceId,ho,Ne.ID),_&&this.storeCollisionData(y.bucketInstanceId,wn,Xt,Xr,Wr,Fr),Vt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(y.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Vt.crossTileID]=new En(qn||qt,Ti||jt,zr||y.justReloaded),f[Vt.crossTileID]=!0};if(Kt){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Vt=y.getSortedSymbolIndexes(this.transform.angle);for(let Xt=Vt.length-1;Xt>=0;--Xt){const wn=Vt[Xt];Sn(y.symbolInstances.get(wn),y.collisionArrays[wn],wn)}}else for(let Vt=t.symbolInstanceStart;Vt<t.symbolInstanceEnd;Vt++)Sn(y.symbolInstances.get(Vt),y.collisionArrays[Vt],Vt);if(_&&y.bucketInstanceId in this.collisionCircleArrays){const Vt=this.collisionCircleArrays[y.bucketInstanceId];l.as(Vt.invProjMatrix,z),Vt.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}storeCollisionData(t,f,_,y,w,R){if(_.textBox||_.iconBox){let D,z;this.collisionBoxArrays.has(t)?D=this.collisionBoxArrays.get(t):(D=new Map,this.collisionBoxArrays.set(t,D)),D.has(f)?z=D.get(f):(z={text:null,icon:null},D.set(f,z)),_.textBox&&(z.text=y.box),_.iconBox&&(z.icon=w.box)}if(R){let D=this.collisionCircleArrays[t];D===void 0&&(D=this.collisionCircleArrays[t]=new ri);for(let z=0;z<R.circles.length;z+=4)D.circles.push(R.circles[z+0]),D.circles.push(R.circles[z+1]),D.circles.push(R.circles[z+2]),D.circles.push(R.collisionDetected?1:0)}}markUsedJustification(t,f,_,y){let w;w=y===l.ah.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[l.at(f)];const R=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const D of R)D>=0&&(t.text.placedSymbolArray.get(D).crossTileID=w>=0&&D!==w?0:_.crossTileID)}markUsedOrientation(t,f,_){const y=f===l.ah.horizontal||f===l.ah.horizontalOnly?f:0,w=f===l.ah.vertical?f:0,R=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const D of R)t.text.placedSymbolArray.get(D).placedOrientation=y;_.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let _=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const y=f?f.symbolFadeChange(t):1,w=f?f.opacities:{},R=f?f.variableOffsets:{},D=f?f.placedOrientations:{};for(const z in this.placements){const q=this.placements[z],H=w[z];H?(this.opacities[z]=new ci(H,y,q.text,q.icon),_=_||q.text!==H.text.placed||q.icon!==H.icon.placed):(this.opacities[z]=new ci(null,y,q.text,q.icon,q.skipFade),_=_||q.text||q.icon)}for(const z in w){const q=w[z];if(!this.opacities[z]){const H=new ci(q,y,!1,!1);H.isHidden()||(this.opacities[z]=H,_=_||q.text.placed||q.icon.placed)}}for(const z in R)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=R[z]);for(const z in D)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=D[z]);if(f&&f.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:t)}updateLayerOpacities(t,f){const _={};for(const y of f){const w=y.getBucket(t);w&&y.latestFeatureIndex&&t.id===w.layerIds[0]&&this.updateBucketOpacities(w,y.tileID,_,y.collisionBoxArray)}}updateBucketOpacities(t,f,_,y){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const w=t.layers[0],R=w.layout,D=new ci(null,0,!1,!1,!0),z=R.get("text-allow-overlap"),q=R.get("icon-allow-overlap"),H=w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"),X=R.get("text-rotation-alignment")==="map",ne=R.get("text-pitch-alignment")==="map",me=R.get("icon-text-fit")!=="none",we=new ci(null,0,z&&(q||!t.hasIconData()||R.get("icon-optional")),q&&(z||!t.hasTextData()||R.get("text-optional")),!0);!t.collisionArrays&&y&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(y);const Me=(Fe,Ve,Te)=>{for(let He=0;He<Ve/4;He++)Fe.opacityVertexArray.emplaceBack(Te);Fe.hasVisibleVertices=Fe.hasVisibleVertices||Te!==no},Ne=this.collisionBoxArrays.get(t.bucketInstanceId);for(let Fe=0;Fe<t.symbolInstances.length;Fe++){const Ve=t.symbolInstances.get(Fe),{numHorizontalGlyphVertices:Te,numVerticalGlyphVertices:He,crossTileID:Je}=Ve;let st=this.opacities[Je];_[Je]?st=D:st||(st=we,this.opacities[Je]=st),_[Je]=!0;const xt=Ve.numIconVertices>0,Pt=this.placedOrientations[Ve.crossTileID],Zt=Pt===l.ah.vertical,Kt=Pt===l.ah.horizontal||Pt===l.ah.horizontalOnly;if(Te>0||He>0){const jt=or(st.text);Me(t.text,Te,Zt?no:jt),Me(t.text,He,Kt?no:jt);const rn=st.text.isHidden();[Ve.rightJustifiedTextSymbolIndex,Ve.centerJustifiedTextSymbolIndex,Ve.leftJustifiedTextSymbolIndex].forEach(Xt=>{Xt>=0&&(t.text.placedSymbolArray.get(Xt).hidden=rn||Zt?1:0)}),Ve.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(Ve.verticalPlacedTextSymbolIndex).hidden=rn||Kt?1:0);const Sn=this.variableOffsets[Ve.crossTileID];Sn&&this.markUsedJustification(t,Sn.anchor,Ve,Pt);const Vt=this.placedOrientations[Ve.crossTileID];Vt&&(this.markUsedJustification(t,"left",Ve,Vt),this.markUsedOrientation(t,Vt,Ve))}if(xt){const jt=or(st.icon),rn=!(me&&Ve.verticalPlacedIconSymbolIndex&&Zt);Ve.placedIconSymbolIndex>=0&&(Me(t.icon,Ve.numIconVertices,rn?jt:no),t.icon.placedSymbolArray.get(Ve.placedIconSymbolIndex).hidden=st.icon.isHidden()),Ve.verticalPlacedIconSymbolIndex>=0&&(Me(t.icon,Ve.numVerticalIconVertices,rn?no:jt),t.icon.placedSymbolArray.get(Ve.verticalPlacedIconSymbolIndex).hidden=st.icon.isHidden())}const qt=Ne&&Ne.has(Fe)?Ne.get(Fe):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const jt=t.collisionArrays[Fe];if(jt){let rn=new l.P(0,0);if(jt.textBox||jt.verticalTextBox){let Sn=!0;if(H){const Vt=this.variableOffsets[Je];Vt?(rn=Kn(Vt.anchor,Vt.width,Vt.height,Vt.textOffset,Vt.textBoxScale),X&&rn._rotate(ne?this.transform.angle:-this.transform.angle)):Sn=!1}if(jt.textBox||jt.verticalTextBox){let Vt;jt.textBox&&(Vt=Zt),jt.verticalTextBox&&(Vt=Kt),No(t.textCollisionBox.collisionVertexArray,st.text.placed,!Sn||Vt,qt.text,rn.x,rn.y)}}if(jt.iconBox||jt.verticalIconBox){const Sn=!!(!Kt&&jt.verticalIconBox);let Vt;jt.iconBox&&(Vt=Sn),jt.verticalIconBox&&(Vt=!Sn),No(t.iconCollisionBox.collisionVertexArray,st.icon.placed,Vt,qt.icon,me?rn.x:0,me?rn.y:0)}}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const Fe=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Fe.invProjMatrix,t.placementViewportMatrix=Fe.viewportMatrix,t.collisionCircleArray=Fe.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,f){const _=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*_>t}setStale(){this.stale=!0}}function No(k,t,f,_,y,w){_&&_.length!==0||(_=[0,0,0,0]);const R=_[0]-Tn,D=_[1]-Tn,z=_[2]-Tn,q=_[3]-Tn;k.emplaceBack(t?1:0,f?1:0,y||0,w||0,R,D),k.emplaceBack(t?1:0,f?1:0,y||0,w||0,z,D),k.emplaceBack(t?1:0,f?1:0,y||0,w||0,z,q),k.emplaceBack(t?1:0,f?1:0,y||0,w||0,R,q)}const ei=Math.pow(2,25),bo=Math.pow(2,24),aa=Math.pow(2,17),Cr=Math.pow(2,16),Nr=Math.pow(2,9),yc=Math.pow(2,8),Ni=Math.pow(2,1);function or(k){if(k.opacity===0&&!k.placed)return 0;if(k.opacity===1&&k.placed)return 4294967295;const t=k.placed?1:0,f=Math.floor(127*k.opacity);return f*ei+t*bo+f*aa+t*Cr+f*Nr+t*yc+f*Ni+t}const no=0;function Qr(){return{isOccluded:(k,t,f)=>!1,getPitchedTextCorrection:(k,t,f)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(k,t,f,_){throw new Error("Not implemented.")},translatePosition:(k,t,f,_)=>function(y,w,R,D,z=!1){if(!R[0]&&!R[1])return[0,0];const q=z?D==="map"?y.angle:0:D==="viewport"?-y.angle:0;if(q){const H=Math.sin(q),X=Math.cos(q);R=[R[0]*X-R[1]*H,R[0]*H+R[1]*X]}return[z?R[0]:Un(w,R[0],y.zoom),z?R[1]:Un(w,R[1],y.zoom)]}(k,t,f,_),getCircleRadiusCorrection:k=>1}}class zi{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,f,_,y,w){const R=this._bucketParts;for(;this._currentTileIndex<t.length;)if(f.getBucketParts(R,y,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,R.sort((D,z)=>D.sortKey-z.sortKey));this._currentPartIndex<R.length;)if(f.placeLayerBucketPart(R[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,w())return!0;return!1}}class la{constructor(t,f,_,y,w,R,D,z){this.placement=new Tr(t,Qr(),f,R,D,z),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(t,f,_){const y=C.now(),w=()=>!this._forceFullPlacement&&C.now()-y>2;for(;this._currentPlacementIndex>=0;){const R=f[t[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=D)&&(!R.maxzoom||R.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new zi(R)),this._inProgressLayer.continuePlacement(_[R.source],this.placement,this._showCollisionBoxes,R,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const _s=512/l.X/2;class Ui{constructor(t,f,_){this.tileID=t,this.bucketInstanceId=_,this._symbolsByKey={};const y=new Map;for(let w=0;w<f.length;w++){const R=f.get(w),D=R.key,z=y.get(D);z?z.push(R):y.set(D,[R])}for(const[w,R]of y){const D={positions:R.map(z=>({x:Math.floor(z.anchorX*_s),y:Math.floor(z.anchorY*_s)})),crossTileIDs:R.map(z=>z.crossTileID)};if(D.positions.length>128){const z=new l.av(D.positions.length,16,Uint16Array);for(const{x:q,y:H}of D.positions)z.add(q,H);z.finish(),delete D.positions,D.index=z}this._symbolsByKey[w]=D}}getScaledCoordinates(t,f){const{x:_,y,z:w}=this.tileID.canonical,{x:R,y:D,z}=f.canonical,q=_s/Math.pow(2,z-w),H=(D*l.X+t.anchorY)*q,X=y*l.X*_s;return{x:Math.floor((R*l.X+t.anchorX)*q-_*l.X*_s),y:Math.floor(H-X)}}findMatches(t,f,_){const y=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let w=0;w<t.length;w++){const R=t.get(w);if(R.crossTileID)continue;const D=this._symbolsByKey[R.key];if(!D)continue;const z=this.getScaledCoordinates(R,f);if(D.index){const q=D.index.range(z.x-y,z.y-y,z.x+y,z.y+y).sort();for(const H of q){const X=D.crossTileIDs[H];if(!_[X]){_[X]=!0,R.crossTileID=X;break}}}else if(D.positions)for(let q=0;q<D.positions.length;q++){const H=D.positions[q],X=D.crossTileIDs[q];if(Math.abs(H.x-z.x)<=y&&Math.abs(H.y-z.y)<=y&&!_[X]){_[X]=!0,R.crossTileID=X;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class ua{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class es{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const f=Math.round((t-this.lng)/360);if(f!==0)for(const _ in this.indexes){const y=this.indexes[_],w={};for(const R in y){const D=y[R];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+f),w[D.tileID.key]=D}this.indexes[_]=w}this.lng=t}addBucket(t,f,_){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let w=0;w<f.symbolInstances.length;w++)f.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const y=this.usedCrossTileIDs[t.overscaledZ];for(const w in this.indexes){const R=this.indexes[w];if(Number(w)>t.overscaledZ)for(const D in R){const z=R[D];z.tileID.isChildOf(t)&&z.findMatches(f.symbolInstances,t,y)}else{const D=R[t.scaledTo(Number(w)).key];D&&D.findMatches(f.symbolInstances,t,y)}}for(let w=0;w<f.symbolInstances.length;w++){const R=f.symbolInstances.get(w);R.crossTileID||(R.crossTileID=_.generate(),y[R.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ui(t,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(t,f){for(const _ of f.getCrossTileIDsLists())for(const y of _)delete this.usedCrossTileIDs[t][y]}removeStaleBuckets(t){let f=!1;for(const _ in this.indexes){const y=this.indexes[_];for(const w in y)t[y[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,y[w]),delete y[w],f=!0)}return f}}class zo{constructor(){this.layerIndexes={},this.crossTileIDs=new ua,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,f,_){let y=this.layerIndexes[t.id];y===void 0&&(y=this.layerIndexes[t.id]=new es);let w=!1;const R={};y.handleWrapJump(_);for(const D of f){const z=D.getBucket(t);z&&t.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(D.tileID,z,this.crossTileIDs)&&(w=!0),R[z.bucketInstanceId]=!0)}return y.removeStaleBuckets(R)&&(w=!0),w}pruneUnusedLayers(t){const f={};t.forEach(_=>{f[_]=!0});for(const _ in this.layerIndexes)f[_]||delete this.layerIndexes[_]}}const Qi=(k,t)=>l.t(k,t&&t.filter(f=>f.identifier!=="source.canvas")),io=l.aw();class ca extends l.E{constructor(t,f={}){super(),this._rtlPluginLoaded=()=>{for(const _ in this.sourceCaches){const y=this.sourceCaches[_].getSource().type;y!=="vector"&&y!=="geojson"||this.sourceCaches[_].reload()}},this.map=t,this.dispatcher=new dn(Wn(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(_,y)=>this.getGlyphs(_,y)),this.dispatcher.registerMessageHandler("GI",(_,y)=>this.getImages(_,y)),this.imageManager=new Ue,this.imageManager.setEventedParent(this),this.glyphManager=new dt(t._requestManager,f.localIdeographFontFamily),this.lineAtlas=new wt(256,512),this.crossTileSymbolIndex=new zo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.ay()),mn().on(ct,this._rtlPluginLoaded),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const y=this.sourceCaches[_.sourceId];if(!y)return;const w=y.getSource();if(w&&w.vectorLayerIds)for(const R in this._layers){const D=this._layers[R];D.source===w.id&&this._validateLayer(D)}})}loadURL(t,f={},_){this.fire(new l.k("dataloading",{dataType:"style"})),f.validate=typeof f.validate!="boolean"||f.validate;const y=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const w=this._loadStyleRequest;l.h(y,this._loadStyleRequest).then(R=>{this._loadStyleRequest=null,this._load(R.data,f,_)}).catch(R=>{this._loadStyleRequest=null,R&&!w.signal.aborted&&this.fire(new l.j(R))})}loadJSON(t,f={},_){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,C.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,f.validate=f.validate!==!1,this._load(t,f,_)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(io,{validate:!1})}_load(t,f,_){var y;const w=f.transformStyle?f.transformStyle(_,t):t;if(!f.validate||!Qi(this,l.u(w))){this._loaded=!0,this.stylesheet=w;for(const R in w.sources)this.addSource(R,w.sources[R],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new vt(this.stylesheet.light),this.sky=new ft(this.stylesheet.sky),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const t=l.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(f=>f.id),this._layers={},this._serializedLayers=null;for(const f of t){const _=l.aA(f);_.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=_}}_loadSprite(t,f=!1,_=void 0){let y;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(w,R,D,z){return l._(this,void 0,void 0,function*(){const q=be(w),H=D>1?"@2x":"",X={},ne={};for(const{id:me,url:we}of q){const Me=R.transformRequest(Le(we,H,".json"),"SpriteJSON");X[me]=l.h(Me,z);const Ne=R.transformRequest(Le(we,H,".png"),"SpriteImage");ne[me]=Y.getImage(Ne,z)}return yield Promise.all([...Object.values(X),...Object.values(ne)]),function(me,we){return l._(this,void 0,void 0,function*(){const Me={};for(const Ne in me){Me[Ne]={};const Fe=C.getImageCanvasContext((yield we[Ne]).data),Ve=(yield me[Ne]).data;for(const Te in Ve){const{width:He,height:Je,x:st,y:xt,sdf:Pt,pixelRatio:Zt,stretchX:Kt,stretchY:qt,content:jt,textFitWidth:rn,textFitHeight:Sn}=Ve[Te];Me[Ne][Te]={data:null,pixelRatio:Zt,sdf:Pt,stretchX:Kt,stretchY:qt,content:jt,textFitWidth:rn,textFitHeight:Sn,spriteData:{width:He,height:Je,x:st,y:xt,context:Fe}}}}return Me})}(X,ne)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(w=>{if(this._spriteRequest=null,w)for(const R in w){this._spritesImagesIds[R]=[];const D=this._spritesImagesIds[R]?this._spritesImagesIds[R].filter(z=>!(z in w)):[];for(const z of D)this.imageManager.removeImage(z),this._changedImages[z]=!0;for(const z in w[R]){const q=R==="default"?z:`${R}:${z}`;this._spritesImagesIds[R].push(q),q in this.imageManager.images?this.imageManager.updateImage(q,w[R][z],!1):this.imageManager.addImage(q,w[R][z]),f&&(this._changedImages[q]=!0)}}}).catch(w=>{this._spriteRequest=null,y=w,this.fire(new l.j(y))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),f&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),_&&_(y)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(t){const f=this.sourceCaches[t.source];if(!f)return;const _=t.sourceLayer;if(!_)return;const y=f.getSource();(y.type==="geojson"||y.vectorLayerIds&&y.vectorLayerIds.indexOf(_)===-1)&&this.fire(new l.j(new Error(`Source layer "${_}" does not exist on source "${y.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,f=!1){const _=this._serializedAllLayers();if(!t||t.length===0)return Object.values(f?l.aB(_):_);const y=[];for(const w of t)if(_[w]){const R=f?l.aB(_[w]):_[w];y.push(R)}return y}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const f=Object.keys(this._layers);for(const _ of f){const y=this._layers[_];y.type!=="custom"&&(t[_]=y.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const f=this._changed;if(f){const y=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(y.length||w.length)&&this._updateWorkerLayers(y,w);for(const R in this._updatedSources){const D=this._updatedSources[R];if(D==="reload")this._reloadSource(R);else{if(D!=="clear")throw new Error(`Invalid action ${D}`);this._clearSource(R)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const R in this._updatedPaintProps)this._layers[R].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const _={};for(const y in this.sourceCaches){const w=this.sourceCaches[y];_[y]=w.used,w.used=!1}for(const y of this._order){const w=this._layers[y];w.recalculate(t,this._availableImages),!w.isHidden(t.zoom)&&w.source&&(this.sourceCaches[w.source].used=!0)}for(const y in _){const w=this.sourceCaches[y];!!_[y]!=!!w.used&&w.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:y}))}this.light.recalculate(t),this.sky.recalculate(t),this.z=t.zoom,f&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,f){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,f={}){var _;this._checkLoaded();const y=this.serialize();if(t=f.transformStyle?f.transformStyle(y,t):t,((_=f.validate)===null||_===void 0||_)&&Qi(this,l.u(t)))return!1;(t=l.aB(t)).layers=l.az(t.layers);const w=l.aC(y,t),R=this._getOperationsToPerform(w);if(R.unimplemented.length>0)throw new Error(`Unimplemented: ${R.unimplemented.join(", ")}.`);if(R.operations.length===0)return!1;for(const D of R.operations)D();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const f=[],_=[];for(const y of t)switch(y.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":f.push(()=>this.addLayer.apply(this,y.args));break;case"removeLayer":f.push(()=>this.removeLayer.apply(this,y.args));break;case"setPaintProperty":f.push(()=>this.setPaintProperty.apply(this,y.args));break;case"setLayoutProperty":f.push(()=>this.setLayoutProperty.apply(this,y.args));break;case"setFilter":f.push(()=>this.setFilter.apply(this,y.args));break;case"addSource":f.push(()=>this.addSource.apply(this,y.args));break;case"removeSource":f.push(()=>this.removeSource.apply(this,y.args));break;case"setLayerZoomRange":f.push(()=>this.setLayerZoomRange.apply(this,y.args));break;case"setLight":f.push(()=>this.setLight.apply(this,y.args));break;case"setGeoJSONSourceData":f.push(()=>this.setGeoJSONSourceData.apply(this,y.args));break;case"setGlyphs":f.push(()=>this.setGlyphs.apply(this,y.args));break;case"setSprite":f.push(()=>this.setSprite.apply(this,y.args));break;case"setSky":f.push(()=>this.setSky.apply(this,y.args));break;case"setTerrain":f.push(()=>this.map.setTerrain.apply(this,y.args));break;case"setTransition":f.push(()=>{});break;default:_.push(y.command)}return{operations:f,unimplemented:_}}addImage(t,f){if(this.getImage(t))return this.fire(new l.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,f),this._afterImageUpdated(t)}updateImage(t,f){this.imageManager.updateImage(t,f)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new l.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,f,_={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(l.u.source,`sources.${t}`,f,null,_))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const y=this.sourceCaches[t]=new At(t,f,this.dispatcher);y.style=this,y.setEventedParent(this,()=>({isSourceLoaded:y.loaded(),source:y.serialize(),sourceId:t})),y.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===t)return this.fire(new l.j(new Error(`Source "${t}" cannot be removed while layer "${_}" is using it.`)));const f=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],f.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),f.setEventedParent(null),f.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,f){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const _=this.sourceCaches[t].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(f),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,f,_={}){this._checkLoaded();const y=t.id;if(this.getLayer(y))return void this.fire(new l.j(new Error(`Layer "${y}" already exists on this map.`)));let w;if(t.type==="custom"){if(Qi(this,l.aD(t)))return;w=l.aA(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(y,t.source),t=l.aB(t),t=l.e(t,{source:y})),this._validate(l.u.layer,`layers.${y}`,t,{arrayIndex:-1},_))return;w=l.aA(t),this._validateLayer(w),w.setEventedParent(this,{layer:{id:y}})}const R=f?this._order.indexOf(f):this._order.length;if(f&&R===-1)this.fire(new l.j(new Error(`Cannot add layer "${y}" before non-existing layer "${f}".`)));else{if(this._order.splice(R,0,y),this._layerOrderChanged=!0,this._layers[y]=w,this._removedLayers[y]&&w.source&&w.type!=="custom"){const D=this._removedLayers[y];delete this._removedLayers[y],D.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",this.sourceCaches[w.source].pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map)}}moveLayer(t,f){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new l.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===f)return;const _=this._order.indexOf(t);this._order.splice(_,1);const y=f?this._order.indexOf(f):this._order.length;f&&y===-1?this.fire(new l.j(new Error(`Cannot move layer "${t}" before non-existing layer "${f}".`))):(this._order.splice(y,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const f=this._layers[t];if(!f)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${t}".`)));f.setEventedParent(null);const _=this._order.indexOf(t);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=f,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],f.onRemove&&f.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,f,_){this._checkLoaded();const y=this.getLayer(t);y?y.minzoom===f&&y.maxzoom===_||(f!=null&&(y.minzoom=f),_!=null&&(y.maxzoom=_),this._updateLayer(y)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,f,_={}){this._checkLoaded();const y=this.getLayer(t);if(y){if(!l.aE(y.filter,f))return f==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(l.u.filter,`layers.${y.id}.filter`,f,null,_)||(y.filter=l.aB(f),this._updateLayer(y)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return l.aB(this.getLayer(t).filter)}setLayoutProperty(t,f,_,y={}){this._checkLoaded();const w=this.getLayer(t);w?l.aE(w.getLayoutProperty(f),_)||(w.setLayoutProperty(f,_,y),this._updateLayer(w)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,f){const _=this.getLayer(t);if(_)return _.getLayoutProperty(f);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,f,_,y={}){this._checkLoaded();const w=this.getLayer(t);w?l.aE(w.getPaintProperty(f),_)||(w.setPaintProperty(f,_,y)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new l.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,f){return this.getLayer(t).getPaintProperty(f)}setFeatureState(t,f){this._checkLoaded();const _=t.source,y=t.sourceLayer,w=this.sourceCaches[_];if(w===void 0)return void this.fire(new l.j(new Error(`The source '${_}' does not exist in the map's style.`)));const R=w.getSource().type;R==="geojson"&&y?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||y?(t.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),w.setFeatureState(y,t.id,f)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,f){this._checkLoaded();const _=t.source,y=this.sourceCaches[_];if(y===void 0)return void this.fire(new l.j(new Error(`The source '${_}' does not exist in the map's style.`)));const w=y.getSource().type,R=w==="vector"?t.sourceLayer:void 0;w!=="vector"||R?f&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):y.removeFeatureState(R,t.id,f):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const f=t.source,_=t.sourceLayer,y=this.sourceCaches[f];if(y!==void 0)return y.getSource().type!=="vector"||_?(t.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),y.getFeatureState(_,t.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=l.aF(this.sourceCaches,w=>w.serialize()),f=this._serializeByIds(this._order,!0),_=this.map.getTerrain()||void 0,y=this.stylesheet;return l.aG({version:y.version,name:y.name,metadata:y.metadata,light:y.light,sky:y.sky,center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch,sprite:y.sprite,glyphs:y.glyphs,transition:y.transition,sources:t,layers:f,terrain:_},w=>w!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const f=R=>this._layers[R].type==="fill-extrusion",_={},y=[];for(let R=this._order.length-1;R>=0;R--){const D=this._order[R];if(f(D)){_[D]=R;for(const z of t){const q=z[D];if(q)for(const H of q)y.push(H)}}}y.sort((R,D)=>D.intersectionZ-R.intersectionZ);const w=[];for(let R=this._order.length-1;R>=0;R--){const D=this._order[R];if(f(D))for(let z=y.length-1;z>=0;z--){const q=y[z].feature;if(_[q.layer.id]<R)break;w.push(q),y.pop()}else for(const z of t){const q=z[D];if(q)for(const H of q)w.push(H.feature)}}return w}queryRenderedFeatures(t,f,_){f&&f.filter&&this._validate(l.u.filter,"queryRenderedFeatures.filter",f.filter,null,f);const y={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const D of f.layers){const z=this._layers[D];if(!z)return this.fire(new l.j(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];y[z.source]=!0}}const w=[];f.availableImages=this._availableImages;const R=this._serializedAllLayers();for(const D in this.sourceCaches)f.layers&&!y[D]||w.push(lt(this.sourceCaches[D],this._layers,R,t,f,_));return this.placement&&w.push(function(D,z,q,H,X,ne,me){const we={},Me=ne.queryRenderedSymbols(H),Ne=[];for(const Fe of Object.keys(Me).map(Number))Ne.push(me[Fe]);Ne.sort(Ye);for(const Fe of Ne){const Ve=Fe.featureIndex.lookupSymbolFeatures(Me[Fe.bucketInstanceId],z,Fe.bucketIndex,Fe.sourceLayerIndex,X.filter,X.layers,X.availableImages,D);for(const Te in Ve){const He=we[Te]=we[Te]||[],Je=Ve[Te];Je.sort((st,xt)=>{const Pt=Fe.featureSortOrder;if(Pt){const Zt=Pt.indexOf(st.featureIndex);return Pt.indexOf(xt.featureIndex)-Zt}return xt.featureIndex-st.featureIndex});for(const st of Je)He.push(st)}}for(const Fe in we)we[Fe].forEach(Ve=>{const Te=Ve.feature,He=q[D[Fe].source].getFeatureState(Te.layer["source-layer"],Te.id);Te.source=Te.layer.source,Te.layer["source-layer"]&&(Te.sourceLayer=Te.layer["source-layer"]),Te.state=He});return we}(this._layers,R,this.sourceCaches,t,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(t,f){f&&f.filter&&this._validate(l.u.filter,"querySourceFeatures.filter",f.filter,null,f);const _=this.sourceCaches[t];return _?function(y,w){const R=y.getRenderableIds().map(q=>y.getTileByID(q)),D=[],z={};for(let q=0;q<R.length;q++){const H=R[q],X=H.tileID.canonical.key;z[X]||(z[X]=!0,H.querySourceFeatures(D,w))}return D}(_,f):[]}getLight(){return this.light.getLight()}setLight(t,f={}){this._checkLoaded();const _=this.light.getLight();let y=!1;for(const R in t)if(!l.aE(t[R],_[R])){y=!0;break}if(!y)return;const w={now:C.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,f),this.light.updateTransitions(w)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,f={}){const _=this.getSky();let y=!1;if(!t&&!_)return;if(t&&!_)y=!0;else if(!t&&_)y=!0;else for(const R in t)if(!l.aE(t[R],_[R])){y=!0;break}if(!y)return;const w={now:C.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,f),this.sky.updateTransitions(w)}_validate(t,f,_,y,w={}){return(!w||w.validate!==!1)&&Qi(this,t.call(l.u,l.e({key:f,style:this.serialize(),value:_,styleSpec:l.v},y)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),mn().off(ct,this._rtlPluginLoaded);for(const f in this._layers)this._layers[f].setEventedParent(null);for(const f in this.sourceCaches){const _=this.sourceCaches[f];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const f in this.sourceCaches)this.sourceCaches[f].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,f,_,y,w=!1){let R=!1,D=!1;const z={};for(const q of this._order){const H=this._layers[q];if(H.type!=="symbol")continue;if(!z[H.source]){const ne=this.sourceCaches[H.source];z[H.source]=ne.getRenderableIds(!0).map(me=>ne.getTileByID(me)).sort((me,we)=>we.tileID.overscaledZ-me.tileID.overscaledZ||(me.tileID.isLessThan(we.tileID)?-1:1))}const X=this.crossTileSymbolIndex.addLayer(H,z[H.source],t.center.lng);R=R||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((w=w||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(C.now(),t.zoom))&&(this.pauseablePlacement=new la(t,this.map.terrain,this._order,w,f,_,y,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(C.now()),D=!0),R&&this.pauseablePlacement.placement.setStale()),D||R)for(const q of this._order){const H=this._layers[q];H.type==="symbol"&&this.placement.updateLayerOpacities(H,z[H.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(C.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,f){return l._(this,void 0,void 0,function*(){const _=yield this.imageManager.getImages(f.icons);this._updateTilesForChangedImages();const y=this.sourceCaches[f.source];return y&&y.setDependencies(f.tileID.key,f.type,f.icons),_})}getGlyphs(t,f){return l._(this,void 0,void 0,function*(){const _=yield this.glyphManager.getGlyphs(f.stacks),y=this.sourceCaches[f.source];return y&&y.setDependencies(f.tileID.key,f.type,[""]),_})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,f={}){this._checkLoaded(),t&&this._validate(l.u.glyphs,"glyphs",t,null,f)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,f,_={},y){this._checkLoaded();const w=[{id:t,url:f}],R=[...be(this.stylesheet.sprite),...w];this._validate(l.u.sprite,"sprite",R,null,_)||(this.stylesheet.sprite=R,this._loadSprite(w,!0,y))}removeSprite(t){this._checkLoaded();const f=be(this.stylesheet.sprite);if(f.find(_=>_.id===t)){if(this._spritesImagesIds[t])for(const _ of this._spritesImagesIds[t])this.imageManager.removeImage(_),this._changedImages[_]=!0;f.splice(f.findIndex(_=>_.id===t),1),this.stylesheet.sprite=f.length>0?f:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return be(this.stylesheet.sprite)}setSprite(t,f={},_){this._checkLoaded(),t&&this._validate(l.u.sprite,"sprite",t,null,f)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,_):(this._unloadSprite(),_&&_(null)))}}var ts=l.Y([{name:"a_pos",type:"Int16",components:2}]);const ro={prelude:ti(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ti(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ti(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ti(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ti("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ti(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:ti(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ti("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ti("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ti("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ti(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ti(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ti(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ti(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ti(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ti(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ti(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ti(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ti(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ti(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ti(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ti(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ti(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ti(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ti(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ti(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ti("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ti("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ti("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:ti("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ti(k,t){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=t.match(/attribute ([\w]+) ([\w]+)/g),y=k.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=w?w.concat(y):y,D={};return{fragmentSource:k=k.replace(f,(z,q,H,X,ne)=>(D[ne]=!0,q==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
varying ${H} ${X} ${ne};
#else
uniform ${H} ${X} u_${ne};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ne}
    ${H} ${X} ${ne} = u_${ne};
#endif
`)),vertexSource:t=t.replace(f,(z,q,H,X,ne)=>{const me=X==="float"?"vec2":"vec4",we=ne.match(/color/)?"color":me;return D[ne]?q==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
attribute ${H} ${me} a_${ne};
varying ${H} ${X} ${ne};
#else
uniform ${H} ${X} u_${ne};
#endif
`:we==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = a_${ne};
#else
    ${H} ${X} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = unpack_mix_${we}(a_${ne}, u_${ne}_t);
#else
    ${H} ${X} ${ne} = u_${ne};
#endif
`:q==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
attribute ${H} ${me} a_${ne};
#else
uniform ${H} ${X} u_${ne};
#endif
`:we==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${H} ${X} ${ne} = a_${ne};
#else
    ${H} ${X} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${H} ${X} ${ne} = unpack_mix_${we}(a_${ne}, u_${ne}_t);
#else
    ${H} ${X} ${ne} = u_${ne};
#endif
`}),staticAttributes:_,staticUniforms:R}}class El{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,f,_,y,w,R,D,z,q){this.context=t;let H=this.boundPaintVertexBuffers.length!==y.length;for(let X=0;!H&&X<y.length;X++)this.boundPaintVertexBuffers[X]!==y[X]&&(H=!0);!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==_||H||this.boundIndexBuffer!==w||this.boundVertexOffset!==R||this.boundDynamicVertexBuffer!==D||this.boundDynamicVertexBuffer2!==z||this.boundDynamicVertexBuffer3!==q?this.freshBind(f,_,y,w,R,D,z,q):(t.bindVertexArray.set(this.vao),D&&D.bind(),w&&w.dynamicDraw&&w.bind(),z&&z.bind(),q&&q.bind())}freshBind(t,f,_,y,w,R,D,z){const q=t.numAttributes,H=this.context,X=H.gl;this.vao&&this.destroy(),this.vao=H.createVertexArray(),H.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=y,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=R,this.boundDynamicVertexBuffer2=D,this.boundDynamicVertexBuffer3=z,f.enableAttributes(X,t);for(const ne of _)ne.enableAttributes(X,t);R&&R.enableAttributes(X,t),D&&D.enableAttributes(X,t),z&&z.enableAttributes(X,t),f.bind(),f.setVertexAttribPointers(X,t,w);for(const ne of _)ne.bind(),ne.setVertexAttribPointers(X,t,w);R&&(R.bind(),R.setVertexAttribPointers(X,t,w)),y&&y.bind(),D&&(D.bind(),D.setVertexAttribPointers(X,t,w)),z&&(z.bind(),z.setVertexAttribPointers(X,t,w)),H.currentNumAttributes=q}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Al=(k,t,f,_,y)=>({u_matrix:k,u_texture:0,u_ele_delta:t,u_fog_matrix:f,u_fog_color:_?_.properties.get("fog-color"):l.aM.white,u_fog_ground_blend:_?_.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:_?_.calculateFogBlendOpacity(y):0,u_horizon_color:_?_.properties.get("horizon-color"):l.aM.white,u_horizon_fog_blend:_?_.properties.get("horizon-fog-blend"):1});function xo(k){const t=[];for(let f=0;f<k.length;f++){if(k[f]===null)continue;const _=k[f].split(" ");t.push(_.pop())}return t}class wo{constructor(t,f,_,y,w,R){const D=t.gl;this.program=D.createProgram();const z=xo(f.staticAttributes),q=_?_.getBinderAttributes():[],H=z.concat(q),X=ro.prelude.staticUniforms?xo(ro.prelude.staticUniforms):[],ne=f.staticUniforms?xo(f.staticUniforms):[],me=_?_.getBinderUniforms():[],we=X.concat(ne).concat(me),Me=[];for(const st of we)Me.indexOf(st)<0&&Me.push(st);const Ne=_?_.defines():[];w&&Ne.push("#define OVERDRAW_INSPECTOR;"),R&&Ne.push("#define TERRAIN3D;");const Fe=Ne.concat(ro.prelude.fragmentSource,f.fragmentSource).join(`
`),Ve=Ne.concat(ro.prelude.vertexSource,f.vertexSource).join(`
`),Te=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Te,Fe),D.compileShader(Te),!D.getShaderParameter(Te,D.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${D.getShaderInfoLog(Te)}`);D.attachShader(this.program,Te);const He=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(He,Ve),D.compileShader(He),!D.getShaderParameter(He,D.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${D.getShaderInfoLog(He)}`);D.attachShader(this.program,He),this.attributes={};const Je={};this.numAttributes=H.length;for(let st=0;st<this.numAttributes;st++)H[st]&&(D.bindAttribLocation(this.program,st,H[st]),this.attributes[H[st]]=st);if(D.linkProgram(this.program),!D.getProgramParameter(this.program,D.LINK_STATUS))throw new Error(`Program failed to link: ${D.getProgramInfoLog(this.program)}`);D.deleteShader(He),D.deleteShader(Te);for(let st=0;st<Me.length;st++){const xt=Me[st];if(xt&&!Je[xt]){const Pt=D.getUniformLocation(this.program,xt);Pt&&(Je[xt]=Pt)}}this.fixedUniforms=y(t,Je),this.terrainUniforms=((st,xt)=>({u_depth:new l.aH(st,xt.u_depth),u_terrain:new l.aH(st,xt.u_terrain),u_terrain_dim:new l.aI(st,xt.u_terrain_dim),u_terrain_matrix:new l.aJ(st,xt.u_terrain_matrix),u_terrain_unpack:new l.aK(st,xt.u_terrain_unpack),u_terrain_exaggeration:new l.aI(st,xt.u_terrain_exaggeration)}))(t,Je),this.binderUniforms=_?_.getUniforms(t,Je):[]}draw(t,f,_,y,w,R,D,z,q,H,X,ne,me,we,Me,Ne,Fe,Ve){const Te=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(_),t.setStencilMode(y),t.setColorMode(w),t.setCullFace(R),z){t.activeTexture.set(Te.TEXTURE2),Te.bindTexture(Te.TEXTURE_2D,z.depthTexture),t.activeTexture.set(Te.TEXTURE3),Te.bindTexture(Te.TEXTURE_2D,z.texture);for(const Je in this.terrainUniforms)this.terrainUniforms[Je].set(z[Je])}for(const Je in this.fixedUniforms)this.fixedUniforms[Je].set(D[Je]);Me&&Me.setUniforms(t,this.binderUniforms,me,{zoom:we});let He=0;switch(f){case Te.LINES:He=2;break;case Te.TRIANGLES:He=3;break;case Te.LINE_STRIP:He=1}for(const Je of ne.get()){const st=Je.vaos||(Je.vaos={});(st[q]||(st[q]=new El)).bind(t,this,H,Me?Me.getPaintVertexBuffers():[],X,Je.vertexOffset,Ne,Fe,Ve),Te.drawElements(f,Je.primitiveLength*He,Te.UNSIGNED_SHORT,Je.primitiveOffset*He*2)}}}function ha(k,t,f){const _=1/Un(f,1,t.transform.tileZoom),y=Math.pow(2,f.tileID.overscaledZ),w=f.tileSize*Math.pow(2,t.transform.tileZoom)/y,R=w*(f.tileID.canonical.x+f.tileID.wrap*y),D=w*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[_,k.fromScale,k.toScale],u_fade:k.t,u_pixel_coord_upper:[R>>16,D>>16],u_pixel_coord_lower:[65535&R,65535&D]}}const fa=(k,t,f,_)=>{const y=t.style.light,w=y.properties.get("position"),R=[w.x,w.y,w.z],D=function(){var q=new l.A(9);return l.A!=Float32Array&&(q[1]=0,q[2]=0,q[3]=0,q[5]=0,q[6]=0,q[7]=0),q[0]=1,q[4]=1,q[8]=1,q}();y.properties.get("anchor")==="viewport"&&function(q,H){var X=Math.sin(H),ne=Math.cos(H);q[0]=ne,q[1]=X,q[2]=0,q[3]=-X,q[4]=ne,q[5]=0,q[6]=0,q[7]=0,q[8]=1}(D,-t.transform.angle),function(q,H,X){var ne=H[0],me=H[1],we=H[2];q[0]=ne*X[0]+me*X[3]+we*X[6],q[1]=ne*X[1]+me*X[4]+we*X[7],q[2]=ne*X[2]+me*X[5]+we*X[8]}(R,R,D);const z=y.properties.get("color");return{u_matrix:k,u_lightpos:R,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+f,u_opacity:_}},da=(k,t,f,_,y,w,R)=>l.e(fa(k,t,f,_),ha(w,t,R),{u_height_factor:-Math.pow(2,y.overscaledZ)/R.tileSize/8}),Fo=k=>({u_matrix:k}),za=(k,t,f,_)=>l.e(Fo(k),ha(f,t,_)),Si=(k,t)=>({u_matrix:k,u_world:t}),so=(k,t,f,_,y)=>l.e(za(k,t,f,_),{u_world:y}),vc=(k,t,f,_)=>{const y=k.transform;let w,R;if(_.paint.get("circle-pitch-alignment")==="map"){const D=Un(f,1,y.zoom);w=!0,R=[D,D]}else w=!1,R=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(_.paint.get("circle-pitch-scale")==="map"),u_matrix:k.translatePosMatrix(t.posMatrix,f,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_pitch_with_map:+w,u_device_pixel_ratio:k.pixelRatio,u_extrude_scale:R}},qs=(k,t,f)=>({u_matrix:k,u_inv_matrix:t,u_camera_to_center_distance:f.cameraToCenterDistance,u_viewport_size:[f.width,f.height]}),br=(k,t,f=1)=>({u_matrix:k,u_color:t,u_overlay:0,u_overlay_scale:f}),xi=k=>({u_matrix:k}),cr=(k,t,f,_)=>({u_matrix:k,u_extrude_scale:Un(t,1,f),u_intensity:_}),Fa=(k,t,f,_)=>{const y=l.H();l.aP(y,0,k.width,k.height,0,0,1);const w=k.context.gl;return{u_matrix:y,u_world:[w.drawingBufferWidth,w.drawingBufferHeight],u_image:f,u_color_ramp:_,u_opacity:t.paint.get("heatmap-opacity")}};function Oa(k,t){const f=Math.pow(2,t.canonical.z),_=t.canonical.y;return[new l.Z(0,_/f).toLngLat().lat,new l.Z(0,(_+1)/f).toLngLat().lat]}const pa=(k,t,f,_)=>{const y=k.transform;return{u_matrix:ys(k,t,f,_),u_ratio:1/Un(t,1,y.zoom),u_device_pixel_ratio:k.pixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},ma=(k,t,f,_,y)=>l.e(pa(k,t,f,y),{u_image:0,u_image_height:_}),Oo=(k,t,f,_,y)=>{const w=k.transform,R=si(t,w);return{u_matrix:ys(k,t,f,y),u_texsize:t.imageAtlasTexture.size,u_ratio:1/Un(t,1,w.zoom),u_device_pixel_ratio:k.pixelRatio,u_image:0,u_scale:[R,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},au=(k,t,f,_,y,w)=>{const R=k.lineAtlas,D=si(t,k.transform),z=f.layout.get("line-cap")==="round",q=R.getDash(_.from,z),H=R.getDash(_.to,z),X=q.width*y.fromScale,ne=H.width*y.toScale;return l.e(pa(k,t,f,w),{u_patternscale_a:[D/X,-q.height/2],u_patternscale_b:[D/ne,-H.height/2],u_sdfgamma:R.width/(256*Math.min(X,ne)*k.pixelRatio)/2,u_image:0,u_tex_y_a:q.y,u_tex_y_b:H.y,u_mix:y.t})};function si(k,t){return 1/Un(k,1,t.tileZoom)}function ys(k,t,f,_){return k.translatePosMatrix(_?_.posMatrix:t.tileID.posMatrix,t,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}const Tl=(k,t,f,_,y)=>{return{u_matrix:k,u_tl_parent:t,u_scale_parent:f,u_buffer_scale:1,u_fade_t:_.mix,u_opacity:_.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(R=y.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(w=y.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:lu(y.paint.get("raster-hue-rotate"))};var w,R};function lu(k){k*=Math.PI/180;const t=Math.sin(k),f=Math.cos(k);return[(2*f+1)/3,(-Math.sqrt(3)*t-f+1)/3,(Math.sqrt(3)*t-f+1)/3]}const Bo=(k,t,f,_,y,w,R,D,z,q,H,X,ne,me)=>{const we=R.transform;return{u_is_size_zoom_constant:+(k==="constant"||k==="source"),u_is_size_feature_constant:+(k==="constant"||k==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:we.cameraToCenterDistance,u_pitch:we.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:we.width/we.height,u_fade_change:R.options.fadeDuration?R.symbolFadeChange:1,u_matrix:D,u_label_plane_matrix:z,u_coord_matrix:q,u_is_text:+X,u_pitch_with_map:+_,u_is_along_line:y,u_is_variable_anchor:w,u_texsize:ne,u_texture:0,u_translation:H,u_pitched_scale:me}},Uo=(k,t,f,_,y,w,R,D,z,q,H,X,ne,me,we)=>{const Me=R.transform;return l.e(Bo(k,t,f,_,y,w,R,D,z,q,H,X,ne,we),{u_gamma_scale:_?Math.cos(Me._pitch)*Me.cameraToCenterDistance:1,u_device_pixel_ratio:R.pixelRatio,u_is_halo:+me})},hr=(k,t,f,_,y,w,R,D,z,q,H,X,ne,me)=>l.e(Uo(k,t,f,_,y,w,R,D,z,q,H,!0,X,!0,me),{u_texsize_icon:ne,u_texture_icon:1}),ga=(k,t,f)=>({u_matrix:k,u_opacity:t,u_color:f}),_a=(k,t,f,_,y,w)=>l.e(function(R,D,z,q){const H=z.imageManager.getPattern(R.from.toString()),X=z.imageManager.getPattern(R.to.toString()),{width:ne,height:me}=z.imageManager.getPixelSize(),we=Math.pow(2,q.tileID.overscaledZ),Me=q.tileSize*Math.pow(2,z.transform.tileZoom)/we,Ne=Me*(q.tileID.canonical.x+q.tileID.wrap*we),Fe=Me*q.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:H.tl,u_pattern_br_a:H.br,u_pattern_tl_b:X.tl,u_pattern_br_b:X.br,u_texsize:[ne,me],u_mix:D.t,u_pattern_size_a:H.displaySize,u_pattern_size_b:X.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/Un(q,1,z.transform.tileZoom),u_pixel_coord_upper:[Ne>>16,Fe>>16],u_pixel_coord_lower:[65535&Ne,65535&Fe]}}(_,w,f,y),{u_matrix:k,u_opacity:t}),Ba={fillExtrusion:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_lightpos:new l.aN(k,t.u_lightpos),u_lightintensity:new l.aI(k,t.u_lightintensity),u_lightcolor:new l.aN(k,t.u_lightcolor),u_vertical_gradient:new l.aI(k,t.u_vertical_gradient),u_opacity:new l.aI(k,t.u_opacity)}),fillExtrusionPattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_lightpos:new l.aN(k,t.u_lightpos),u_lightintensity:new l.aI(k,t.u_lightintensity),u_lightcolor:new l.aN(k,t.u_lightcolor),u_vertical_gradient:new l.aI(k,t.u_vertical_gradient),u_height_factor:new l.aI(k,t.u_height_factor),u_image:new l.aH(k,t.u_image),u_texsize:new l.aO(k,t.u_texsize),u_pixel_coord_upper:new l.aO(k,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,t.u_pixel_coord_lower),u_scale:new l.aN(k,t.u_scale),u_fade:new l.aI(k,t.u_fade),u_opacity:new l.aI(k,t.u_opacity)}),fill:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix)}),fillPattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_image:new l.aH(k,t.u_image),u_texsize:new l.aO(k,t.u_texsize),u_pixel_coord_upper:new l.aO(k,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,t.u_pixel_coord_lower),u_scale:new l.aN(k,t.u_scale),u_fade:new l.aI(k,t.u_fade)}),fillOutline:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_world:new l.aO(k,t.u_world)}),fillOutlinePattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_world:new l.aO(k,t.u_world),u_image:new l.aH(k,t.u_image),u_texsize:new l.aO(k,t.u_texsize),u_pixel_coord_upper:new l.aO(k,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,t.u_pixel_coord_lower),u_scale:new l.aN(k,t.u_scale),u_fade:new l.aI(k,t.u_fade)}),circle:(k,t)=>({u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_scale_with_map:new l.aH(k,t.u_scale_with_map),u_pitch_with_map:new l.aH(k,t.u_pitch_with_map),u_extrude_scale:new l.aO(k,t.u_extrude_scale),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_matrix:new l.aJ(k,t.u_matrix)}),collisionBox:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_pixel_extrude_scale:new l.aO(k,t.u_pixel_extrude_scale)}),collisionCircle:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_inv_matrix:new l.aJ(k,t.u_inv_matrix),u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_viewport_size:new l.aO(k,t.u_viewport_size)}),debug:(k,t)=>({u_color:new l.aL(k,t.u_color),u_matrix:new l.aJ(k,t.u_matrix),u_overlay:new l.aH(k,t.u_overlay),u_overlay_scale:new l.aI(k,t.u_overlay_scale)}),clippingMask:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix)}),heatmap:(k,t)=>({u_extrude_scale:new l.aI(k,t.u_extrude_scale),u_intensity:new l.aI(k,t.u_intensity),u_matrix:new l.aJ(k,t.u_matrix)}),heatmapTexture:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_world:new l.aO(k,t.u_world),u_image:new l.aH(k,t.u_image),u_color_ramp:new l.aH(k,t.u_color_ramp),u_opacity:new l.aI(k,t.u_opacity)}),hillshade:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_image:new l.aH(k,t.u_image),u_latrange:new l.aO(k,t.u_latrange),u_light:new l.aO(k,t.u_light),u_shadow:new l.aL(k,t.u_shadow),u_highlight:new l.aL(k,t.u_highlight),u_accent:new l.aL(k,t.u_accent)}),hillshadePrepare:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_image:new l.aH(k,t.u_image),u_dimension:new l.aO(k,t.u_dimension),u_zoom:new l.aI(k,t.u_zoom),u_unpack:new l.aK(k,t.u_unpack)}),line:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_ratio:new l.aI(k,t.u_ratio),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_units_to_pixels:new l.aO(k,t.u_units_to_pixels)}),lineGradient:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_ratio:new l.aI(k,t.u_ratio),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_units_to_pixels:new l.aO(k,t.u_units_to_pixels),u_image:new l.aH(k,t.u_image),u_image_height:new l.aI(k,t.u_image_height)}),linePattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_texsize:new l.aO(k,t.u_texsize),u_ratio:new l.aI(k,t.u_ratio),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_image:new l.aH(k,t.u_image),u_units_to_pixels:new l.aO(k,t.u_units_to_pixels),u_scale:new l.aN(k,t.u_scale),u_fade:new l.aI(k,t.u_fade)}),lineSDF:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_ratio:new l.aI(k,t.u_ratio),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_units_to_pixels:new l.aO(k,t.u_units_to_pixels),u_patternscale_a:new l.aO(k,t.u_patternscale_a),u_patternscale_b:new l.aO(k,t.u_patternscale_b),u_sdfgamma:new l.aI(k,t.u_sdfgamma),u_image:new l.aH(k,t.u_image),u_tex_y_a:new l.aI(k,t.u_tex_y_a),u_tex_y_b:new l.aI(k,t.u_tex_y_b),u_mix:new l.aI(k,t.u_mix)}),raster:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_tl_parent:new l.aO(k,t.u_tl_parent),u_scale_parent:new l.aI(k,t.u_scale_parent),u_buffer_scale:new l.aI(k,t.u_buffer_scale),u_fade_t:new l.aI(k,t.u_fade_t),u_opacity:new l.aI(k,t.u_opacity),u_image0:new l.aH(k,t.u_image0),u_image1:new l.aH(k,t.u_image1),u_brightness_low:new l.aI(k,t.u_brightness_low),u_brightness_high:new l.aI(k,t.u_brightness_high),u_saturation_factor:new l.aI(k,t.u_saturation_factor),u_contrast_factor:new l.aI(k,t.u_contrast_factor),u_spin_weights:new l.aN(k,t.u_spin_weights)}),symbolIcon:(k,t)=>({u_is_size_zoom_constant:new l.aH(k,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(k,t.u_is_size_feature_constant),u_size_t:new l.aI(k,t.u_size_t),u_size:new l.aI(k,t.u_size),u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_pitch:new l.aI(k,t.u_pitch),u_rotate_symbol:new l.aH(k,t.u_rotate_symbol),u_aspect_ratio:new l.aI(k,t.u_aspect_ratio),u_fade_change:new l.aI(k,t.u_fade_change),u_matrix:new l.aJ(k,t.u_matrix),u_label_plane_matrix:new l.aJ(k,t.u_label_plane_matrix),u_coord_matrix:new l.aJ(k,t.u_coord_matrix),u_is_text:new l.aH(k,t.u_is_text),u_pitch_with_map:new l.aH(k,t.u_pitch_with_map),u_is_along_line:new l.aH(k,t.u_is_along_line),u_is_variable_anchor:new l.aH(k,t.u_is_variable_anchor),u_texsize:new l.aO(k,t.u_texsize),u_texture:new l.aH(k,t.u_texture),u_translation:new l.aO(k,t.u_translation),u_pitched_scale:new l.aI(k,t.u_pitched_scale)}),symbolSDF:(k,t)=>({u_is_size_zoom_constant:new l.aH(k,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(k,t.u_is_size_feature_constant),u_size_t:new l.aI(k,t.u_size_t),u_size:new l.aI(k,t.u_size),u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_pitch:new l.aI(k,t.u_pitch),u_rotate_symbol:new l.aH(k,t.u_rotate_symbol),u_aspect_ratio:new l.aI(k,t.u_aspect_ratio),u_fade_change:new l.aI(k,t.u_fade_change),u_matrix:new l.aJ(k,t.u_matrix),u_label_plane_matrix:new l.aJ(k,t.u_label_plane_matrix),u_coord_matrix:new l.aJ(k,t.u_coord_matrix),u_is_text:new l.aH(k,t.u_is_text),u_pitch_with_map:new l.aH(k,t.u_pitch_with_map),u_is_along_line:new l.aH(k,t.u_is_along_line),u_is_variable_anchor:new l.aH(k,t.u_is_variable_anchor),u_texsize:new l.aO(k,t.u_texsize),u_texture:new l.aH(k,t.u_texture),u_gamma_scale:new l.aI(k,t.u_gamma_scale),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_is_halo:new l.aH(k,t.u_is_halo),u_translation:new l.aO(k,t.u_translation),u_pitched_scale:new l.aI(k,t.u_pitched_scale)}),symbolTextAndIcon:(k,t)=>({u_is_size_zoom_constant:new l.aH(k,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(k,t.u_is_size_feature_constant),u_size_t:new l.aI(k,t.u_size_t),u_size:new l.aI(k,t.u_size),u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_pitch:new l.aI(k,t.u_pitch),u_rotate_symbol:new l.aH(k,t.u_rotate_symbol),u_aspect_ratio:new l.aI(k,t.u_aspect_ratio),u_fade_change:new l.aI(k,t.u_fade_change),u_matrix:new l.aJ(k,t.u_matrix),u_label_plane_matrix:new l.aJ(k,t.u_label_plane_matrix),u_coord_matrix:new l.aJ(k,t.u_coord_matrix),u_is_text:new l.aH(k,t.u_is_text),u_pitch_with_map:new l.aH(k,t.u_pitch_with_map),u_is_along_line:new l.aH(k,t.u_is_along_line),u_is_variable_anchor:new l.aH(k,t.u_is_variable_anchor),u_texsize:new l.aO(k,t.u_texsize),u_texsize_icon:new l.aO(k,t.u_texsize_icon),u_texture:new l.aH(k,t.u_texture),u_texture_icon:new l.aH(k,t.u_texture_icon),u_gamma_scale:new l.aI(k,t.u_gamma_scale),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_is_halo:new l.aH(k,t.u_is_halo),u_translation:new l.aO(k,t.u_translation),u_pitched_scale:new l.aI(k,t.u_pitched_scale)}),background:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_opacity:new l.aI(k,t.u_opacity),u_color:new l.aL(k,t.u_color)}),backgroundPattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_opacity:new l.aI(k,t.u_opacity),u_image:new l.aH(k,t.u_image),u_pattern_tl_a:new l.aO(k,t.u_pattern_tl_a),u_pattern_br_a:new l.aO(k,t.u_pattern_br_a),u_pattern_tl_b:new l.aO(k,t.u_pattern_tl_b),u_pattern_br_b:new l.aO(k,t.u_pattern_br_b),u_texsize:new l.aO(k,t.u_texsize),u_mix:new l.aI(k,t.u_mix),u_pattern_size_a:new l.aO(k,t.u_pattern_size_a),u_pattern_size_b:new l.aO(k,t.u_pattern_size_b),u_scale_a:new l.aI(k,t.u_scale_a),u_scale_b:new l.aI(k,t.u_scale_b),u_pixel_coord_upper:new l.aO(k,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,t.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aI(k,t.u_tile_units_to_pixels)}),terrain:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_texture:new l.aH(k,t.u_texture),u_ele_delta:new l.aI(k,t.u_ele_delta),u_fog_matrix:new l.aJ(k,t.u_fog_matrix),u_fog_color:new l.aL(k,t.u_fog_color),u_fog_ground_blend:new l.aI(k,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.aI(k,t.u_fog_ground_blend_opacity),u_horizon_color:new l.aL(k,t.u_horizon_color),u_horizon_fog_blend:new l.aI(k,t.u_horizon_fog_blend)}),terrainDepth:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_ele_delta:new l.aI(k,t.u_ele_delta)}),terrainCoords:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_texture:new l.aH(k,t.u_texture),u_terrain_coords_id:new l.aI(k,t.u_terrain_coords_id),u_ele_delta:new l.aI(k,t.u_ele_delta)}),sky:(k,t)=>({u_sky_color:new l.aL(k,t.u_sky_color),u_horizon_color:new l.aL(k,t.u_horizon_color),u_horizon:new l.aI(k,t.u_horizon),u_sky_horizon_blend:new l.aI(k,t.u_sky_horizon_blend)})};class vs{constructor(t,f,_){this.context=t;const y=t.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const f=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const bc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ua{constructor(t,f,_,y){this.length=f.length,this.attributes=_,this.itemSize=f.bytesPerElement,this.dynamicDraw=y,this.context=t;const w=t.gl;this.buffer=w.createBuffer(),t.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,f){for(let _=0;_<this.attributes.length;_++){const y=f.attributes[this.attributes[_].name];y!==void 0&&t.enableVertexAttribArray(y)}}setVertexAttribPointers(t,f,_){for(let y=0;y<this.attributes.length;y++){const w=this.attributes[y],R=f.attributes[w.name];R!==void 0&&t.vertexAttribPointer(R,w.components,t[bc[w.type]],!1,this.itemSize,w.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Lr=new WeakMap;function bs(k){var t;if(Lr.has(k))return Lr.get(k);{const f=(t=k.getParameter(k.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Lr.set(k,f),f}}class oi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Mr extends oi{getDefault(){return l.aM.transparent}set(t){const f=this.current;(t.r!==f.r||t.g!==f.g||t.b!==f.b||t.a!==f.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class jo extends oi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class qo extends oi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Vo extends oi{getDefault(){return[!0,!0,!0,!0]}set(t){const f=this.current;(t[0]!==f[0]||t[1]!==f[1]||t[2]!==f[2]||t[3]!==f[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Cl extends oi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Go extends oi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class uu extends oi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const f=this.current;(t.func!==f.func||t.ref!==f.ref||t.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ns extends oi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const f=this.current;(t[0]!==f[0]||t[1]!==f[1]||t[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Ll extends oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;t?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=t,this.dirty=!1}}class cu extends oi{getDefault(){return[0,1]}set(t){const f=this.current;(t[0]!==f[0]||t[1]!==f[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class hu extends oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;t?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=t,this.dirty=!1}}class fu extends oi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ko extends oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;t?f.enable(f.BLEND):f.disable(f.BLEND),this.current=t,this.dirty=!1}}class du extends oi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const f=this.current;(t[0]!==f[0]||t[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class xc extends oi{getDefault(){return l.aM.transparent}set(t){const f=this.current;(t.r!==f.r||t.g!==f.g||t.b!==f.b||t.a!==f.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class pu extends oi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class xs extends oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;t?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=t,this.dirty=!1}}class Hr extends oi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ja extends oi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class mu extends oi{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class wc extends oi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class qa extends oi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const f=this.current;(t[0]!==f[0]||t[1]!==f[1]||t[2]!==f[2]||t[3]!==f[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ml extends oi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Va extends oi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ga extends oi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class is extends oi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ya extends oi{getDefault(){return null}set(t){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ji extends oi{getDefault(){return null}set(t){var f;if(t===this.current&&!this.dirty)return;const _=this.gl;bs(_)?_.bindVertexArray(t):(f=_.getExtension("OES_vertex_array_object"))===null||f===void 0||f.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Io extends oi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Rl extends oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Za extends oi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class va extends oi{constructor(t,f){super(t),this.context=t,this.parent=f}getDefault(){return null}}class Ha extends va{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Vs extends va{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Pl extends va{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class kc{constructor(t,f,_,y,w){this.context=t,this.width=f,this.height=_;const R=t.gl,D=this.framebuffer=R.createFramebuffer();if(this.colorAttachment=new Ha(t,D),y)this.depthAttachment=w?new Pl(t,D):new Vs(t,D);else if(w)throw new Error("Stencil cannot be set without depth");if(R.checkFramebufferStatus(R.FRAMEBUFFER)!==R.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,f=this.colorAttachment.get();if(f&&t.deleteTexture(f),this.depthAttachment){const _=this.depthAttachment.get();_&&t.deleteRenderbuffer(_)}t.deleteFramebuffer(this.framebuffer)}}class Fi{constructor(t,f,_){this.blendFunction=t,this.blendColor=f,this.mask=_}}Fi.Replace=[1,0],Fi.disabled=new Fi(Fi.Replace,l.aM.transparent,[!1,!1,!1,!1]),Fi.unblended=new Fi(Fi.Replace,l.aM.transparent,[!0,!0,!0,!0]),Fi.alphaBlended=new Fi([1,771],l.aM.transparent,[!0,!0,!0,!0]);class Ic{constructor(t){var f,_;if(this.gl=t,this.clearColor=new Mr(this),this.clearDepth=new jo(this),this.clearStencil=new qo(this),this.colorMask=new Vo(this),this.depthMask=new Cl(this),this.stencilMask=new Go(this),this.stencilFunc=new uu(this),this.stencilOp=new ns(this),this.stencilTest=new Ll(this),this.depthRange=new cu(this),this.depthTest=new hu(this),this.depthFunc=new fu(this),this.blend=new ko(this),this.blendFunc=new du(this),this.blendColor=new xc(this),this.blendEquation=new pu(this),this.cullFace=new xs(this),this.cullFaceSide=new Hr(this),this.frontFace=new ja(this),this.program=new mu(this),this.activeTexture=new wc(this),this.viewport=new qa(this),this.bindFramebuffer=new Ml(this),this.bindRenderbuffer=new Va(this),this.bindTexture=new Ga(this),this.bindVertexBuffer=new is(this),this.bindElementBuffer=new ya(this),this.bindVertexArray=new ji(this),this.pixelStoreUnpack=new Io(this),this.pixelStoreUnpackPremultiplyAlpha=new Rl(this),this.pixelStoreUnpackFlipY=new Za(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),bs(t)){this.HALF_FLOAT=t.HALF_FLOAT;const y=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(f=t.RGBA16F)!==null&&f!==void 0?f:y==null?void 0:y.RGBA16F_EXT,this.RGB16F=(_=t.RGB16F)!==null&&_!==void 0?_:y==null?void 0:y.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const y=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=y==null?void 0:y.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,f){return new vs(this,t,f)}createVertexBuffer(t,f,_){return new Ua(this,t,f,_)}createRenderbuffer(t,f,_){const y=this.gl,w=y.createRenderbuffer();return this.bindRenderbuffer.set(w),y.renderbufferStorage(y.RENDERBUFFER,t,f,_),this.bindRenderbuffer.set(null),w}createFramebuffer(t,f,_,y){return new kc(this,t,f,_,y)}clear({color:t,depth:f,stencil:_}){const y=this.gl;let w=0;t&&(w|=y.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(w|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),_!==void 0&&(w|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),y.clear(w)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){l.aE(t.blendFunction,Fi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return bs(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var f;return bs(this.gl)?this.gl.deleteVertexArray(t):(f=this.gl.getExtension("OES_vertex_array_object"))===null||f===void 0?void 0:f.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class jn{constructor(t,f,_){this.func=t,this.mask=f,this.range=_}}jn.ReadOnly=!1,jn.ReadWrite=!0,jn.disabled=new jn(519,jn.ReadOnly,[0,1]);const Xa=7680;class mi{constructor(t,f,_,y,w,R){this.test=t,this.ref=f,this.mask=_,this.fail=y,this.depthFail=w,this.pass=R}}mi.disabled=new mi({func:519,mask:0},0,0,Xa,Xa,Xa);class hi{constructor(t,f,_){this.enable=t,this.mode=f,this.frontFace=_}}let oo;function ba(k,t,f,_,y){const w=k.context,R=w.gl,D=k.useProgram("collisionBox"),z=[];let q=0,H=0;for(let Fe=0;Fe<_.length;Fe++){const Ve=_[Fe],Te=t.getTile(Ve).getBucket(f);if(!Te)continue;const He=y?Te.textCollisionBox:Te.iconCollisionBox,Je=Te.collisionCircleArray;if(Je.length>0){const st=l.H();l.aQ(st,Te.placementInvProjMatrix,k.transform.glCoordMatrix),l.aQ(st,st,Te.placementViewportMatrix),z.push({circleArray:Je,circleOffset:H,transform:Ve.posMatrix,invTransform:st,coord:Ve}),q+=Je.length/4,H=q}He&&D.draw(w,R.LINES,jn.disabled,mi.disabled,k.colorModeForRenderPass(),hi.disabled,{u_matrix:Ve.posMatrix,u_pixel_extrude_scale:[1/(X=k.transform).width,1/X.height]},k.style.map.terrain&&k.style.map.terrain.getTerrainData(Ve),f.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,null,k.transform.zoom,null,null,He.collisionVertexBuffer)}var X;if(!y||!z.length)return;const ne=k.useProgram("collisionCircle"),me=new l.aR;me.resize(4*q),me._trim();let we=0;for(const Fe of z)for(let Ve=0;Ve<Fe.circleArray.length/4;Ve++){const Te=4*Ve,He=Fe.circleArray[Te+0],Je=Fe.circleArray[Te+1],st=Fe.circleArray[Te+2],xt=Fe.circleArray[Te+3];me.emplace(we++,He,Je,st,xt,0),me.emplace(we++,He,Je,st,xt,1),me.emplace(we++,He,Je,st,xt,2),me.emplace(we++,He,Je,st,xt,3)}(!oo||oo.length<2*q)&&(oo=function(Fe){const Ve=2*Fe,Te=new l.aT;Te.resize(Ve),Te._trim();for(let He=0;He<Ve;He++){const Je=6*He;Te.uint16[Je+0]=4*He+0,Te.uint16[Je+1]=4*He+1,Te.uint16[Je+2]=4*He+2,Te.uint16[Je+3]=4*He+2,Te.uint16[Je+4]=4*He+3,Te.uint16[Je+5]=4*He+0}return Te}(q));const Me=w.createIndexBuffer(oo,!0),Ne=w.createVertexBuffer(me,l.aS.members,!0);for(const Fe of z){const Ve=qs(Fe.transform,Fe.invTransform,k.transform);ne.draw(w,R.TRIANGLES,jn.disabled,mi.disabled,k.colorModeForRenderPass(),hi.disabled,Ve,k.style.map.terrain&&k.style.map.terrain.getTerrainData(Fe.coord),f.id,Ne,Me,l.a0.simpleSegment(0,2*Fe.circleOffset,Fe.circleArray.length,Fe.circleArray.length/2),null,k.transform.zoom,null,null,null)}Ne.destroy(),Me.destroy()}hi.disabled=new hi(!1,1029,2305),hi.backCCW=new hi(!0,1029,2305);const Zo=l.an(new Float32Array(16));function Dl(k,t,f,_,y,w){const{horizontalAlign:R,verticalAlign:D}=l.au(k);return new l.P((-(R-.5)*t/y+_[0])*w,(-(D-.5)*f/y+_[1])*w)}function So(k,t,f,_,y,w){const R=t.tileAnchorPoint.add(new l.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let D=_.mult(w);f||(D=D.rotate(-y));const z=R.add(D);return Re(z.x,z.y,t.labelPlaneMatrix,t.getElevation).point}if(f){const D=et(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(k),z=Math.atan(D.y/D.x)+(D.x<0?Math.PI:0);return k.add(_.rotate(z))}return k.add(_)}function Ho(k,t,f,_,y,w,R,D,z,q,H,X,ne,me){const we=k.text.placedSymbolArray,Me=k.text.dynamicLayoutVertexArray,Ne=k.icon.dynamicLayoutVertexArray,Fe={};Me.clear();for(let Ve=0;Ve<we.length;Ve++){const Te=we.get(Ve),He=Te.hidden||!Te.crossTileID||k.allowVerticalPlacement&&!Te.placedOrientation?null:_[Te.crossTileID];if(He){const Je=new l.P(Te.anchorX,Te.anchorY),st={getElevation:me,width:y.width,height:y.height,labelPlaneMatrix:w,lineVertexArray:null,pitchWithMap:f,projection:H,projectionCache:null,tileAnchorPoint:Je,translation:X,unwrappedTileID:ne},xt=f?Re(Je.x,Je.y,R,me):et(Je.x,Je.y,st),Pt=J(y.cameraToCenterDistance,xt.signedDistanceFromCamera);let Zt=l.ai(k.textSizeData,z,Te)*Pt/l.ap;f&&(Zt*=k.tilePixelRatio/D);const{width:Kt,height:qt,anchor:jt,textOffset:rn,textBoxScale:Sn}=He,Vt=Dl(jt,Kt,qt,rn,Sn,Zt),Xt=H.getPitchedTextCorrection(y,Je.add(new l.P(X[0],X[1])),ne),wn=So(xt.point,st,t,Vt,y.angle,Xt),Ai=k.allowVerticalPlacement&&Te.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let Bn=0;Bn<Te.numGlyphs;Bn++)l.aj(Me,wn,Ai);q&&Te.associatedIconIndex>=0&&(Fe[Te.associatedIconIndex]={shiftedAnchor:wn,angle:Ai})}else ln(Te.numGlyphs,Me)}if(q){Ne.clear();const Ve=k.icon.placedSymbolArray;for(let Te=0;Te<Ve.length;Te++){const He=Ve.get(Te);if(He.hidden)ln(He.numGlyphs,Ne);else{const Je=Fe[Te];if(Je)for(let st=0;st<He.numGlyphs;st++)l.aj(Ne,Je.shiftedAnchor,Je.angle);else ln(He.numGlyphs,Ne)}}k.icon.dynamicLayoutVertexBuffer.updateData(Ne)}k.text.dynamicLayoutVertexBuffer.updateData(Me)}function rs(k,t,f){return f.iconsInText&&t?"symbolTextAndIcon":k?"symbolSDF":"symbolIcon"}function Nl(k,t,f,_,y,w,R,D,z,q,H,X){const ne=k.context,me=ne.gl,we=k.transform,Me=Qr(),Ne=D==="map",Fe=z==="map",Ve=D!=="viewport"&&f.layout.get("symbol-placement")!=="point",Te=Ne&&!Fe&&!Ve,He=!Fe&&Ve,Je=!f.layout.get("symbol-sort-key").isConstant();let st=!1;const xt=k.depthModeForSublayer(0,jn.ReadOnly),Pt=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Zt=[],Kt=Me.getCircleRadiusCorrection(we);for(const qt of _){const jt=t.getTile(qt),rn=jt.getBucket(f);if(!rn)continue;const Sn=y?rn.text:rn.icon;if(!Sn||!Sn.segments.get().length||!Sn.hasVisibleVertices)continue;const Vt=Sn.programConfigurations.get(f.id),Xt=y||rn.sdfIcons,wn=y?rn.textSizeData:rn.iconSizeData,Ai=Fe||we.pitch!==0,Bn=k.useProgram(rs(Xt,y,rn),Vt),qn=l.ag(wn,we.zoom),Ti=k.style.map.terrain&&k.style.map.terrain.getTerrainData(qt);let zr,Hs,Ci,os,Xr=[0,0],Fr=null;if(y)Hs=jt.glyphAtlasTexture,Ci=me.LINEAR,zr=jt.glyphAtlasTexture.size,rn.iconsInText&&(Xr=jt.imageAtlasTexture.size,Fr=jt.imageAtlasTexture,os=Ai||k.options.rotating||k.options.zooming||wn.kind==="composite"||wn.kind==="camera"?me.LINEAR:me.NEAREST);else{const Hn=f.layout.get("icon-size").constantOr(0)!==1||rn.iconsNeedLinear;Hs=jt.imageAtlasTexture,Ci=Xt||k.options.rotating||k.options.zooming||Hn||Ai?me.LINEAR:me.NEAREST,zr=jt.imageAtlasTexture.size}const Wr=Un(jt,1,k.transform.zoom),ho=He?qt.posMatrix:Zo,tl=Ji(ho,Fe,Ne,k.transform,Wr),Su=Zr(ho,Fe,Ne,k.transform,Wr),nl=Zr(qt.posMatrix,Fe,Ne,k.transform,Wr),zs=Me.translatePosition(k.transform,jt,w,R),Eu=Pt&&rn.hasTextData(),Vc=f.layout.get("icon-text-fit")!=="none"&&Eu&&rn.hasIconData();if(Ve){const Hn=k.style.map.terrain?(il,rl)=>k.style.map.terrain.getElevation(qt,il,rl):null,Ia=f.layout.get("text-rotation-alignment")==="map";he(rn,qt.posMatrix,k,y,tl,nl,Fe,q,Ia,Me,qt.toUnwrapped(),we.width,we.height,zs,Hn)}const Fs=qt.posMatrix,Os=y&&Pt||Vc,Qo=Ve||Os?Zo:tl,Xs=Su,Pr=Xt&&f.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Or;Or=Xt?rn.iconsInText?hr(wn.kind,qn,Te,Fe,Ve,Os,k,Fs,Qo,Xs,zs,zr,Xr,Kt):Uo(wn.kind,qn,Te,Fe,Ve,Os,k,Fs,Qo,Xs,zs,y,zr,!0,Kt):Bo(wn.kind,qn,Te,Fe,Ve,Os,k,Fs,Qo,Xs,zs,y,zr,Kt);const Ss={program:Bn,buffers:Sn,uniformValues:Or,atlasTexture:Hs,atlasTextureIcon:Fr,atlasInterpolation:Ci,atlasInterpolationIcon:os,isSDF:Xt,hasHalo:Pr};if(Je&&rn.canOverlap){st=!0;const Hn=Sn.segments.get();for(const Ia of Hn)Zt.push({segments:new l.a0([Ia]),sortKey:Ia.sortKey,state:Ss,terrainData:Ti})}else Zt.push({segments:Sn.segments,sortKey:0,state:Ss,terrainData:Ti})}st&&Zt.sort((qt,jt)=>qt.sortKey-jt.sortKey);for(const qt of Zt){const jt=qt.state;if(ne.activeTexture.set(me.TEXTURE0),jt.atlasTexture.bind(jt.atlasInterpolation,me.CLAMP_TO_EDGE),jt.atlasTextureIcon&&(ne.activeTexture.set(me.TEXTURE1),jt.atlasTextureIcon&&jt.atlasTextureIcon.bind(jt.atlasInterpolationIcon,me.CLAMP_TO_EDGE)),jt.isSDF){const rn=jt.uniformValues;jt.hasHalo&&(rn.u_is_halo=1,zl(jt.buffers,qt.segments,f,k,jt.program,xt,H,X,rn,qt.terrainData)),rn.u_is_halo=0}zl(jt.buffers,qt.segments,f,k,jt.program,xt,H,X,jt.uniformValues,qt.terrainData)}}function zl(k,t,f,_,y,w,R,D,z,q){const H=_.context;y.draw(H,H.gl.TRIANGLES,w,R,D,hi.disabled,z,q,f.id,k.layoutVertexBuffer,k.indexBuffer,t,f.paint,_.transform.zoom,k.programConfigurations.get(f.id),k.dynamicLayoutVertexBuffer,k.opacityVertexBuffer)}function Fl(k,t,f,_){const y=k.context,w=y.gl,R=mi.disabled,D=new Fi([w.ONE,w.ONE],l.aM.transparent,[!0,!0,!0,!0]),z=t.getBucket(f);if(!z)return;const q=_.key;let H=f.heatmapFbos.get(q);H||(H=Xo(y,t.tileSize,t.tileSize),f.heatmapFbos.set(q,H)),y.bindFramebuffer.set(H.framebuffer),y.viewport.set([0,0,t.tileSize,t.tileSize]),y.clear({color:l.aM.transparent});const X=z.programConfigurations.get(f.id),ne=k.useProgram("heatmap",X),me=k.style.map.terrain.getTerrainData(_);ne.draw(y,w.TRIANGLES,jn.disabled,R,D,hi.disabled,cr(_.posMatrix,t,k.transform.zoom,f.paint.get("heatmap-intensity")),me,f.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,f.paint,k.transform.zoom,X)}function ao(k,t,f){const _=k.context,y=_.gl;_.setColorMode(k.colorModeForRenderPass());const w=Wo(_,t),R=f.key,D=t.heatmapFbos.get(R);D&&(_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,D.colorAttachment.get()),_.activeTexture.set(y.TEXTURE1),w.bind(y.LINEAR,y.CLAMP_TO_EDGE),k.useProgram("heatmapTexture").draw(_,y.TRIANGLES,jn.disabled,mi.disabled,k.colorModeForRenderPass(),hi.disabled,Fa(k,t,0,1),null,t.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments,t.paint,k.transform.zoom),D.destroy(),t.heatmapFbos.delete(R))}function Xo(k,t,f){var _,y;const w=k.gl,R=w.createTexture();w.bindTexture(w.TEXTURE_2D,R),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.LINEAR);const D=(_=k.HALF_FLOAT)!==null&&_!==void 0?_:w.UNSIGNED_BYTE,z=(y=k.RGBA16F)!==null&&y!==void 0?y:w.RGBA;w.texImage2D(w.TEXTURE_2D,0,z,t,f,0,w.RGBA,D,null);const q=k.createFramebuffer(t,f,!1,!1);return q.colorAttachment.set(R),q}function Wo(k,t){return t.colorRampTexture||(t.colorRampTexture=new ke(k,t.colorRamp,k.gl.RGBA)),t.colorRampTexture}function Ko(k,t,f,_,y){if(!f||!_||!_.imageAtlas)return;const w=_.imageAtlas.patternPositions;let R=w[f.to.toString()],D=w[f.from.toString()];if(!R&&D&&(R=D),!D&&R&&(D=R),!R||!D){const z=y.getPaintProperty(t);R=w[z],D=w[z]}R&&D&&k.setConstantPatternPositions(R,D)}function $o(k,t,f,_,y,w,R){const D=k.context.gl,z="fill-pattern",q=f.paint.get(z),H=q&&q.constantOr(1),X=f.getCrossfadeParameters();let ne,me,we,Me,Ne;R?(me=H&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ne=D.LINES):(me=H?"fillPattern":"fill",ne=D.TRIANGLES);const Fe=q.constantOr(null);for(const Ve of _){const Te=t.getTile(Ve);if(H&&!Te.patternsLoaded())continue;const He=Te.getBucket(f);if(!He)continue;const Je=He.programConfigurations.get(f.id),st=k.useProgram(me,Je),xt=k.style.map.terrain&&k.style.map.terrain.getTerrainData(Ve);H&&(k.context.activeTexture.set(D.TEXTURE0),Te.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Je.updatePaintBuffers(X)),Ko(Je,z,Fe,Te,f);const Pt=xt?Ve:null,Zt=k.translatePosMatrix(Pt?Pt.posMatrix:Ve.posMatrix,Te,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(R){Me=He.indexBuffer2,Ne=He.segments2;const Kt=[D.drawingBufferWidth,D.drawingBufferHeight];we=me==="fillOutlinePattern"&&H?so(Zt,k,X,Te,Kt):Si(Zt,Kt)}else Me=He.indexBuffer,Ne=He.segments,we=H?za(Zt,k,X,Te):Fo(Zt);st.draw(k.context,ne,y,k.stencilModeForClipping(Ve),w,hi.disabled,we,xt,f.id,He.layoutVertexBuffer,Me,Ne,f.paint,k.transform.zoom,Je)}}function Yo(k,t,f,_,y,w,R){const D=k.context,z=D.gl,q="fill-extrusion-pattern",H=f.paint.get(q),X=H.constantOr(1),ne=f.getCrossfadeParameters(),me=f.paint.get("fill-extrusion-opacity"),we=H.constantOr(null);for(const Me of _){const Ne=t.getTile(Me),Fe=Ne.getBucket(f);if(!Fe)continue;const Ve=k.style.map.terrain&&k.style.map.terrain.getTerrainData(Me),Te=Fe.programConfigurations.get(f.id),He=k.useProgram(X?"fillExtrusionPattern":"fillExtrusion",Te);X&&(k.context.activeTexture.set(z.TEXTURE0),Ne.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Te.updatePaintBuffers(ne)),Ko(Te,q,we,Ne,f);const Je=k.translatePosMatrix(Me.posMatrix,Ne,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),st=f.paint.get("fill-extrusion-vertical-gradient"),xt=X?da(Je,k,st,me,Me,ne,Ne):fa(Je,k,st,me);He.draw(D,D.gl.TRIANGLES,y,w,R,hi.backCCW,xt,Ve,f.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,f.paint,k.transform.zoom,Te,k.style.map.terrain&&Fe.centroidVertexBuffer)}}function Jo(k,t,f,_,y,w,R){const D=k.context,z=D.gl,q=f.fbo;if(!q)return;const H=k.useProgram("hillshade"),X=k.style.map.terrain&&k.style.map.terrain.getTerrainData(t);D.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,q.colorAttachment.get()),H.draw(D,z.TRIANGLES,y,w,R,hi.disabled,((ne,me,we,Me)=>{const Ne=we.paint.get("hillshade-shadow-color"),Fe=we.paint.get("hillshade-highlight-color"),Ve=we.paint.get("hillshade-accent-color");let Te=we.paint.get("hillshade-illumination-direction")*(Math.PI/180);we.paint.get("hillshade-illumination-anchor")==="viewport"&&(Te-=ne.transform.angle);const He=!ne.options.moving;return{u_matrix:Me?Me.posMatrix:ne.transform.calculatePosMatrix(me.tileID.toUnwrapped(),He),u_image:0,u_latrange:Oa(0,me.tileID),u_light:[we.paint.get("hillshade-exaggeration"),Te],u_shadow:Ne,u_highlight:Fe,u_accent:Ve}})(k,f,_,X?t:null),X,_.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments)}function Eo(k,t,f,_,y,w){const R=k.context,D=R.gl,z=t.dem;if(z&&z.data){const q=z.dim,H=z.stride,X=z.getPixels();if(R.activeTexture.set(D.TEXTURE1),R.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||k.getTileTexture(H),t.demTexture){const me=t.demTexture;me.update(X,{premultiply:!1}),me.bind(D.NEAREST,D.CLAMP_TO_EDGE)}else t.demTexture=new ke(R,X,D.RGBA,{premultiply:!1}),t.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);R.activeTexture.set(D.TEXTURE0);let ne=t.fbo;if(!ne){const me=new ke(R,{width:q,height:q,data:null},D.RGBA);me.bind(D.LINEAR,D.CLAMP_TO_EDGE),ne=t.fbo=R.createFramebuffer(q,q,!0,!1),ne.colorAttachment.set(me.texture)}R.bindFramebuffer.set(ne.framebuffer),R.viewport.set([0,0,q,q]),k.useProgram("hillshadePrepare").draw(R,D.TRIANGLES,_,y,w,hi.disabled,((me,we)=>{const Me=we.stride,Ne=l.H();return l.aP(Ne,0,l.X,-l.X,0,0,1),l.J(Ne,Ne,[0,-l.X,0]),{u_matrix:Ne,u_image:1,u_dimension:[Me,Me],u_zoom:me.overscaledZ,u_unpack:we.getUnpackVector()}})(t.tileID,z),null,f.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Ol(k,t,f,_,y,w){const R=_.paint.get("raster-fade-duration");if(!w&&R>0){const D=C.now(),z=(D-k.timeAdded)/R,q=t?(D-t.timeAdded)/R:-1,H=f.getSource(),X=y.coveringZoomLevel({tileSize:H.tileSize,roundZoom:H.roundZoom}),ne=!t||Math.abs(t.tileID.overscaledZ-X)>Math.abs(k.tileID.overscaledZ-X),me=ne&&k.refreshedUponExpiration?1:l.ac(ne?z:1-q,0,1);return k.refreshedUponExpiration&&z>=1&&(k.refreshedUponExpiration=!1),t?{opacity:1,mix:1-me}:{opacity:me,mix:0}}return{opacity:1,mix:0}}const Bl=new l.aM(1,0,0,1),Yn=new l.aM(0,1,0,1),Gs=new l.aM(0,0,1,1),Sc=new l.aM(1,0,1,1),Ul=new l.aM(0,1,1,1);function fr(k,t,f,_){I(k,0,t+f/2,k.transform.width,f,_)}function ws(k,t,f,_){I(k,t-f/2,0,f,k.transform.height,_)}function I(k,t,f,_,y,w){const R=k.context,D=R.gl;D.enable(D.SCISSOR_TEST),D.scissor(t*k.pixelRatio,f*k.pixelRatio,_*k.pixelRatio,y*k.pixelRatio),R.clear({color:w}),D.disable(D.SCISSOR_TEST)}function c(k,t,f){const _=k.context,y=_.gl,w=f.posMatrix,R=k.useProgram("debug"),D=jn.disabled,z=mi.disabled,q=k.colorModeForRenderPass(),H="$debug",X=k.style.map.terrain&&k.style.map.terrain.getTerrainData(f);_.activeTexture.set(y.TEXTURE0);const ne=t.getTileByID(f.key).latestRawTileData,me=Math.floor((ne&&ne.byteLength||0)/1024),we=t.getTile(f).tileSize,Me=512/Math.min(we,512)*(f.overscaledZ/k.transform.zoom)*.5;let Ne=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(Ne+=` => ${f.overscaledZ}`),function(Fe,Ve){Fe.initDebugOverlayCanvas();const Te=Fe.debugOverlayCanvas,He=Fe.context.gl,Je=Fe.debugOverlayCanvas.getContext("2d");Je.clearRect(0,0,Te.width,Te.height),Je.shadowColor="white",Je.shadowBlur=2,Je.lineWidth=1.5,Je.strokeStyle="white",Je.textBaseline="top",Je.font="bold 36px Open Sans, sans-serif",Je.fillText(Ve,5,5),Je.strokeText(Ve,5,5),Fe.debugOverlayTexture.update(Te),Fe.debugOverlayTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE)}(k,`${Ne} ${me}kB`),R.draw(_,y.TRIANGLES,D,z,Fi.alphaBlended,hi.disabled,br(w,l.aM.transparent,Me),null,H,k.debugBuffer,k.quadTriangleIndexBuffer,k.debugSegments),R.draw(_,y.LINE_STRIP,D,z,q,hi.disabled,br(w,l.aM.red),X,H,k.debugBuffer,k.tileBorderIndexBuffer,k.debugSegments)}function d(k,t,f){const _=k.context,y=_.gl,w=k.colorModeForRenderPass(),R=new jn(y.LEQUAL,jn.ReadWrite,k.depthRangeFor3D),D=k.useProgram("terrain"),z=t.getTerrainMesh();_.bindFramebuffer.set(null),_.viewport.set([0,0,k.width,k.height]);for(const q of f){const H=k.renderToTexture.getTexture(q),X=t.getTerrainData(q.tileID);_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,H.texture);const ne=k.transform.calculatePosMatrix(q.tileID.toUnwrapped()),me=t.getMeshFrameDelta(k.transform.zoom),we=k.transform.calculateFogMatrix(q.tileID.toUnwrapped()),Me=Al(ne,me,we,k.style.sky,k.transform.pitch);D.draw(_,y.TRIANGLES,R,mi.disabled,w,hi.backCCW,Me,X,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}}class p{constructor(t,f,_){this.vertexBuffer=t,this.indexBuffer=f,this.segments=_}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class b{constructor(t,f){this.context=new Ic(t),this.transform=f,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=At.maxUnderzooming+At.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new zo}resize(t,f,_){if(this.width=Math.floor(t*_),this.height=Math.floor(f*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style._order)this.style._layers[y].resize()}setup(){const t=this.context,f=new l.aX;f.emplaceBack(0,0),f.emplaceBack(l.X,0),f.emplaceBack(0,l.X),f.emplaceBack(l.X,l.X),this.tileExtentBuffer=t.createVertexBuffer(f,ts.members),this.tileExtentSegments=l.a0.simpleSegment(0,0,4,2);const _=new l.aX;_.emplaceBack(0,0),_.emplaceBack(l.X,0),_.emplaceBack(0,l.X),_.emplaceBack(l.X,l.X),this.debugBuffer=t.createVertexBuffer(_,ts.members),this.debugSegments=l.a0.simpleSegment(0,0,4,5);const y=new l.$;y.emplaceBack(0,0,0,0),y.emplaceBack(l.X,0,l.X,0),y.emplaceBack(0,l.X,0,l.X),y.emplaceBack(l.X,l.X,l.X,l.X),this.rasterBoundsBuffer=t.createVertexBuffer(y,Nn.members),this.rasterBoundsSegments=l.a0.simpleSegment(0,0,4,2);const w=new l.aX;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(w,ts.members),this.viewportSegments=l.a0.simpleSegment(0,0,4,2);const R=new l.aZ;R.emplaceBack(0),R.emplaceBack(1),R.emplaceBack(3),R.emplaceBack(2),R.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(R);const D=new l.aY;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(D);const z=this.context.gl;this.stencilClearMode=new mi({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO)}clearStencil(){const t=this.context,f=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=l.H();l.aP(_,0,this.width,this.height,0,0,1),l.K(_,_,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,f.TRIANGLES,jn.disabled,this.stencilClearMode,Fi.disabled,hi.disabled,xi(_),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,f){if(this.currentStencilSource===t.source||!t.isTileClipped()||!f||!f.length)return;this.currentStencilSource=t.source;const _=this.context,y=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(Fi.disabled),_.setDepthMode(jn.disabled);const w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const R of f){const D=this._tileClippingMaskIDs[R.key]=this.nextStencilID++,z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(R);w.draw(_,y.TRIANGLES,jn.disabled,new mi({func:y.ALWAYS,mask:0},D,255,y.KEEP,y.KEEP,y.REPLACE),Fi.disabled,hi.disabled,xi(R.posMatrix),z,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,f=this.context.gl;return new mi({func:f.NOTEQUAL,mask:255},t,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(t){const f=this.context.gl;return new mi({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(t){const f=this.context.gl,_=t.sort((R,D)=>D.overscaledZ-R.overscaledZ),y=_[_.length-1].overscaledZ,w=_[0].overscaledZ-y+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const R={};for(let D=0;D<w;D++)R[D+y]=new mi({func:f.GEQUAL,mask:255},D+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=w,[R,_]}return[{[y]:mi.disabled},_]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Fi([t.CONSTANT_COLOR,t.ONE],new l.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Fi.unblended:Fi.alphaBlended}depthModeForSublayer(t,f,_){if(!this.opaquePassEnabledForLayer())return jn.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new jn(_||this.context.gl.LEQUAL,f,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,f){this.style=t,this.options=f,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(C.now()),this.imageManager.beginFrame();const _=this.style._order,y=this.style.sourceCaches,w={},R={},D={};for(const z in y){const q=y[z];q.used&&q.prepare(this.context),w[z]=q.getVisibleCoordinates(),R[z]=w[z].slice().reverse(),D[z]=q.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<_.length;z++)if(this.style._layers[_[z]].is3D()){this.opaquePassCutoff=z;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const z of _){const q=this.style._layers[z];if(!q.hasOffscreenPass()||q.isHidden(this.transform.zoom))continue;const H=R[q.source];(q.type==="custom"||H.length)&&this.renderLayer(this,y[q.source],q,H)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?l.aM.black:l.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(z,q){const H=z.context,X=H.gl,ne=((Fe,Ve,Te)=>({u_sky_color:Fe.properties.get("sky-color"),u_horizon_color:Fe.properties.get("horizon-color"),u_horizon:(Ve.height/2+Ve.getHorizon())*Te,u_sky_horizon_blend:Fe.properties.get("sky-horizon-blend")*Ve.height/2*Te}))(q,z.style.map.transform,z.pixelRatio),me=new jn(X.LEQUAL,jn.ReadWrite,[0,1]),we=mi.disabled,Me=z.colorModeForRenderPass(),Ne=z.useProgram("sky");if(!q.mesh){const Fe=new l.aX;Fe.emplaceBack(-1,-1),Fe.emplaceBack(1,-1),Fe.emplaceBack(1,1),Fe.emplaceBack(-1,1);const Ve=new l.aY;Ve.emplaceBack(0,1,2),Ve.emplaceBack(0,2,3),q.mesh=new p(H.createVertexBuffer(Fe,ts.members),H.createIndexBuffer(Ve),l.a0.simpleSegment(0,0,Fe.length,Ve.length))}Ne.draw(H,X.TRIANGLES,me,we,Me,hi.disabled,ne,void 0,"sky",q.mesh.vertexBuffer,q.mesh.indexBuffer,q.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const z=this.style._layers[_[this.currentLayer]],q=y[z.source],H=w[z.source];this._renderTileClippingMasks(z,H),this.renderLayer(this,q,z,H)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const z=this.style._layers[_[this.currentLayer]],q=y[z.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(z))continue;const H=(z.type==="symbol"?D:R)[z.source];this._renderTileClippingMasks(z,w[z.source]),this.renderLayer(this,q,z,H)}if(this.options.showTileBoundaries){const z=function(q,H){let X=null;const ne=Object.values(q._layers).flatMap(Ne=>Ne.source&&!Ne.isHidden(H)?[q.sourceCaches[Ne.source]]:[]),me=ne.filter(Ne=>Ne.getSource().type==="vector"),we=ne.filter(Ne=>Ne.getSource().type!=="vector"),Me=Ne=>{(!X||X.getSource().maxzoom<Ne.getSource().maxzoom)&&(X=Ne)};return me.forEach(Ne=>Me(Ne)),X||we.forEach(Ne=>Me(Ne)),X}(this.style,this.transform.zoom);z&&function(q,H,X){for(let ne=0;ne<X.length;ne++)c(q,H,X[ne])}(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){const q=z.transform.padding;fr(z,z.transform.height-(q.top||0),3,Bl),fr(z,q.bottom||0,3,Yn),ws(z,q.left||0,3,Gs),ws(z,z.transform.width-(q.right||0),3,Sc);const H=z.transform.centerPoint;(function(X,ne,me,we){I(X,ne-1,me-10,2,20,we),I(X,ne-10,me-1,20,2,we)})(z,H.x,z.transform.height-H.y,Ul)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const f=this.terrainFacilitator.matrix,_=this.transform.modelViewProjectionMatrix;let y=this.terrainFacilitator.dirty;y||(y=t?!l.a_(f,_):!l.a$(f,_)),y||(y=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),y&&(l.b0(f,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(w,R){const D=w.context,z=D.gl,q=Fi.unblended,H=new jn(z.LEQUAL,jn.ReadWrite,[0,1]),X=R.getTerrainMesh(),ne=R.sourceCache.getRenderableTiles(),me=w.useProgram("terrainDepth");D.bindFramebuffer.set(R.getFramebuffer("depth").framebuffer),D.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),D.clear({color:l.aM.transparent,depth:1});for(const we of ne){const Me=R.getTerrainData(we.tileID),Ne={u_matrix:w.transform.calculatePosMatrix(we.tileID.toUnwrapped()),u_ele_delta:R.getMeshFrameDelta(w.transform.zoom)};me.draw(D,z.TRIANGLES,H,mi.disabled,q,hi.backCCW,Ne,Me,"terrain",X.vertexBuffer,X.indexBuffer,X.segments)}D.bindFramebuffer.set(null),D.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain),function(w,R){const D=w.context,z=D.gl,q=Fi.unblended,H=new jn(z.LEQUAL,jn.ReadWrite,[0,1]),X=R.getTerrainMesh(),ne=R.getCoordsTexture(),me=R.sourceCache.getRenderableTiles(),we=w.useProgram("terrainCoords");D.bindFramebuffer.set(R.getFramebuffer("coords").framebuffer),D.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),D.clear({color:l.aM.transparent,depth:1}),R.coordsIndex=[];for(const Me of me){const Ne=R.getTerrainData(Me.tileID);D.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,ne.texture);const Fe={u_matrix:w.transform.calculatePosMatrix(Me.tileID.toUnwrapped()),u_terrain_coords_id:(255-R.coordsIndex.length)/255,u_texture:0,u_ele_delta:R.getMeshFrameDelta(w.transform.zoom)};we.draw(D,z.TRIANGLES,H,mi.disabled,q,hi.backCCW,Fe,Ne,"terrain",X.vertexBuffer,X.indexBuffer,X.segments),R.coordsIndex.push(Me.tileID.key)}D.bindFramebuffer.set(null),D.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain))}renderLayer(t,f,_,y){if(!_.isHidden(this.transform.zoom)&&(_.type==="background"||_.type==="custom"||(y||[]).length))switch(this.id=_.id,_.type){case"symbol":(function(w,R,D,z,q){if(w.renderPass!=="translucent")return;const H=mi.disabled,X=w.colorModeForRenderPass();(D._unevaluatedLayout.hasValue("text-variable-anchor")||D._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ne,me,we,Me,Ne,Fe,Ve,Te,He){const Je=me.transform,st=Qr(),xt=Ne==="map",Pt=Fe==="map";for(const Zt of ne){const Kt=Me.getTile(Zt),qt=Kt.getBucket(we);if(!qt||!qt.text||!qt.text.segments.get().length)continue;const jt=l.ag(qt.textSizeData,Je.zoom),rn=Un(Kt,1,me.transform.zoom),Sn=Ji(Zt.posMatrix,Pt,xt,me.transform,rn),Vt=we.layout.get("icon-text-fit")!=="none"&&qt.hasIconData();if(jt){const Xt=Math.pow(2,Je.zoom-Kt.tileID.overscaledZ),wn=me.style.map.terrain?(Bn,qn)=>me.style.map.terrain.getElevation(Zt,Bn,qn):null,Ai=st.translatePosition(Je,Kt,Ve,Te);Ho(qt,xt,Pt,He,Je,Sn,Zt.posMatrix,Xt,jt,Vt,st,Ai,Zt.toUnwrapped(),wn)}}}(z,w,D,R,D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),q),D.paint.get("icon-opacity").constantOr(1)!==0&&Nl(w,R,D,z,!1,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),D.layout.get("icon-rotation-alignment"),D.layout.get("icon-pitch-alignment"),D.layout.get("icon-keep-upright"),H,X),D.paint.get("text-opacity").constantOr(1)!==0&&Nl(w,R,D,z,!0,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.layout.get("text-keep-upright"),H,X),R.map.showCollisionBoxes&&(ba(w,R,D,z,!0),ba(w,R,D,z,!1))})(t,f,_,y,this.style.placement.variableOffsets);break;case"circle":(function(w,R,D,z){if(w.renderPass!=="translucent")return;const q=D.paint.get("circle-opacity"),H=D.paint.get("circle-stroke-width"),X=D.paint.get("circle-stroke-opacity"),ne=!D.layout.get("circle-sort-key").isConstant();if(q.constantOr(1)===0&&(H.constantOr(1)===0||X.constantOr(1)===0))return;const me=w.context,we=me.gl,Me=w.depthModeForSublayer(0,jn.ReadOnly),Ne=mi.disabled,Fe=w.colorModeForRenderPass(),Ve=[];for(let Te=0;Te<z.length;Te++){const He=z[Te],Je=R.getTile(He),st=Je.getBucket(D);if(!st)continue;const xt=st.programConfigurations.get(D.id),Pt=w.useProgram("circle",xt),Zt=st.layoutVertexBuffer,Kt=st.indexBuffer,qt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(He),jt={programConfiguration:xt,program:Pt,layoutVertexBuffer:Zt,indexBuffer:Kt,uniformValues:vc(w,He,Je,D),terrainData:qt};if(ne){const rn=st.segments.get();for(const Sn of rn)Ve.push({segments:new l.a0([Sn]),sortKey:Sn.sortKey,state:jt})}else Ve.push({segments:st.segments,sortKey:0,state:jt})}ne&&Ve.sort((Te,He)=>Te.sortKey-He.sortKey);for(const Te of Ve){const{programConfiguration:He,program:Je,layoutVertexBuffer:st,indexBuffer:xt,uniformValues:Pt,terrainData:Zt}=Te.state;Je.draw(me,we.TRIANGLES,Me,Ne,Fe,hi.disabled,Pt,Zt,D.id,st,xt,Te.segments,D.paint,w.transform.zoom,He)}})(t,f,_,y);break;case"heatmap":(function(w,R,D,z){if(D.paint.get("heatmap-opacity")===0)return;const q=w.context;if(w.style.map.terrain){for(const H of z){const X=R.getTile(H);R.hasRenderableParent(H)||(w.renderPass==="offscreen"?Fl(w,X,D,H):w.renderPass==="translucent"&&ao(w,D,H))}q.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?function(H,X,ne,me){const we=H.context,Me=we.gl,Ne=mi.disabled,Fe=new Fi([Me.ONE,Me.ONE],l.aM.transparent,[!0,!0,!0,!0]);(function(Ve,Te,He){const Je=Ve.gl;Ve.activeTexture.set(Je.TEXTURE1),Ve.viewport.set([0,0,Te.width/4,Te.height/4]);let st=He.heatmapFbos.get(l.aU);st?(Je.bindTexture(Je.TEXTURE_2D,st.colorAttachment.get()),Ve.bindFramebuffer.set(st.framebuffer)):(st=Xo(Ve,Te.width/4,Te.height/4),He.heatmapFbos.set(l.aU,st))})(we,H,ne),we.clear({color:l.aM.transparent});for(let Ve=0;Ve<me.length;Ve++){const Te=me[Ve];if(X.hasRenderableParent(Te))continue;const He=X.getTile(Te),Je=He.getBucket(ne);if(!Je)continue;const st=Je.programConfigurations.get(ne.id),xt=H.useProgram("heatmap",st),{zoom:Pt}=H.transform;xt.draw(we,Me.TRIANGLES,jn.disabled,Ne,Fe,hi.disabled,cr(Te.posMatrix,He,Pt,ne.paint.get("heatmap-intensity")),null,ne.id,Je.layoutVertexBuffer,Je.indexBuffer,Je.segments,ne.paint,H.transform.zoom,st)}we.viewport.set([0,0,H.width,H.height])}(w,R,D,z):w.renderPass==="translucent"&&function(H,X){const ne=H.context,me=ne.gl;ne.setColorMode(H.colorModeForRenderPass());const we=X.heatmapFbos.get(l.aU);we&&(ne.activeTexture.set(me.TEXTURE0),me.bindTexture(me.TEXTURE_2D,we.colorAttachment.get()),ne.activeTexture.set(me.TEXTURE1),Wo(ne,X).bind(me.LINEAR,me.CLAMP_TO_EDGE),H.useProgram("heatmapTexture").draw(ne,me.TRIANGLES,jn.disabled,mi.disabled,H.colorModeForRenderPass(),hi.disabled,Fa(H,X,0,1),null,X.id,H.viewportBuffer,H.quadTriangleIndexBuffer,H.viewportSegments,X.paint,H.transform.zoom))}(w,D)})(t,f,_,y);break;case"line":(function(w,R,D,z){if(w.renderPass!=="translucent")return;const q=D.paint.get("line-opacity"),H=D.paint.get("line-width");if(q.constantOr(1)===0||H.constantOr(1)===0)return;const X=w.depthModeForSublayer(0,jn.ReadOnly),ne=w.colorModeForRenderPass(),me=D.paint.get("line-dasharray"),we=D.paint.get("line-pattern"),Me=we.constantOr(1),Ne=D.paint.get("line-gradient"),Fe=D.getCrossfadeParameters(),Ve=Me?"linePattern":me?"lineSDF":Ne?"lineGradient":"line",Te=w.context,He=Te.gl;let Je=!0;for(const st of z){const xt=R.getTile(st);if(Me&&!xt.patternsLoaded())continue;const Pt=xt.getBucket(D);if(!Pt)continue;const Zt=Pt.programConfigurations.get(D.id),Kt=w.context.program.get(),qt=w.useProgram(Ve,Zt),jt=Je||qt.program!==Kt,rn=w.style.map.terrain&&w.style.map.terrain.getTerrainData(st),Sn=we.constantOr(null);if(Sn&&xt.imageAtlas){const wn=xt.imageAtlas,Ai=wn.patternPositions[Sn.to.toString()],Bn=wn.patternPositions[Sn.from.toString()];Ai&&Bn&&Zt.setConstantPatternPositions(Ai,Bn)}const Vt=rn?st:null,Xt=Me?Oo(w,xt,D,Fe,Vt):me?au(w,xt,D,me,Fe,Vt):Ne?ma(w,xt,D,Pt.lineClipsArray.length,Vt):pa(w,xt,D,Vt);if(Me)Te.activeTexture.set(He.TEXTURE0),xt.imageAtlasTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE),Zt.updatePaintBuffers(Fe);else if(me&&(jt||w.lineAtlas.dirty))Te.activeTexture.set(He.TEXTURE0),w.lineAtlas.bind(Te);else if(Ne){const wn=Pt.gradients[D.id];let Ai=wn.texture;if(D.gradientVersion!==wn.version){let Bn=256;if(D.stepInterpolant){const qn=R.getSource().maxzoom,Ti=st.canonical.z===qn?Math.ceil(1<<w.transform.maxZoom-st.canonical.z):1;Bn=l.ac(l.aV(Pt.maxLineLength/l.X*1024*Ti),256,Te.maxTextureSize)}wn.gradient=l.aW({expression:D.gradientExpression(),evaluationKey:"lineProgress",resolution:Bn,image:wn.gradient||void 0,clips:Pt.lineClipsArray}),wn.texture?wn.texture.update(wn.gradient):wn.texture=new ke(Te,wn.gradient,He.RGBA),wn.version=D.gradientVersion,Ai=wn.texture}Te.activeTexture.set(He.TEXTURE0),Ai.bind(D.stepInterpolant?He.NEAREST:He.LINEAR,He.CLAMP_TO_EDGE)}qt.draw(Te,He.TRIANGLES,X,w.stencilModeForClipping(st),ne,hi.disabled,Xt,rn,D.id,Pt.layoutVertexBuffer,Pt.indexBuffer,Pt.segments,D.paint,w.transform.zoom,Zt,Pt.layoutVertexBuffer2),Je=!1}})(t,f,_,y);break;case"fill":(function(w,R,D,z){const q=D.paint.get("fill-color"),H=D.paint.get("fill-opacity");if(H.constantOr(1)===0)return;const X=w.colorModeForRenderPass(),ne=D.paint.get("fill-pattern"),me=w.opaquePassEnabledForLayer()&&!ne.constantOr(1)&&q.constantOr(l.aM.transparent).a===1&&H.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===me){const we=w.depthModeForSublayer(1,w.renderPass==="opaque"?jn.ReadWrite:jn.ReadOnly);$o(w,R,D,z,we,X,!1)}if(w.renderPass==="translucent"&&D.paint.get("fill-antialias")){const we=w.depthModeForSublayer(D.getPaintProperty("fill-outline-color")?2:0,jn.ReadOnly);$o(w,R,D,z,we,X,!0)}})(t,f,_,y);break;case"fill-extrusion":(function(w,R,D,z){const q=D.paint.get("fill-extrusion-opacity");if(q!==0&&w.renderPass==="translucent"){const H=new jn(w.context.gl.LEQUAL,jn.ReadWrite,w.depthRangeFor3D);if(q!==1||D.paint.get("fill-extrusion-pattern").constantOr(1))Yo(w,R,D,z,H,mi.disabled,Fi.disabled),Yo(w,R,D,z,H,w.stencilModeFor3D(),w.colorModeForRenderPass());else{const X=w.colorModeForRenderPass();Yo(w,R,D,z,H,mi.disabled,X)}}})(t,f,_,y);break;case"hillshade":(function(w,R,D,z){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const q=w.context,H=w.depthModeForSublayer(0,jn.ReadOnly),X=w.colorModeForRenderPass(),[ne,me]=w.renderPass==="translucent"?w.stencilConfigForOverlap(z):[{},z];for(const we of me){const Me=R.getTile(we);Me.needsHillshadePrepare!==void 0&&Me.needsHillshadePrepare&&w.renderPass==="offscreen"?Eo(w,Me,D,H,mi.disabled,X):w.renderPass==="translucent"&&Jo(w,we,Me,D,H,ne[we.overscaledZ],X)}q.viewport.set([0,0,w.width,w.height])})(t,f,_,y);break;case"raster":(function(w,R,D,z){if(w.renderPass!=="translucent"||D.paint.get("raster-opacity")===0||!z.length)return;const q=w.context,H=q.gl,X=R.getSource(),ne=w.useProgram("raster"),me=w.colorModeForRenderPass(),[we,Me]=X instanceof Qn?[{},z]:w.stencilConfigForOverlap(z),Ne=Me[Me.length-1].overscaledZ,Fe=!w.options.moving;for(const Ve of Me){const Te=w.depthModeForSublayer(Ve.overscaledZ-Ne,D.paint.get("raster-opacity")===1?jn.ReadWrite:jn.ReadOnly,H.LESS),He=R.getTile(Ve);He.registerFadeDuration(D.paint.get("raster-fade-duration"));const Je=R.findLoadedParent(Ve,0),st=R.findLoadedSibling(Ve),xt=Ol(He,Je||st||null,R,D,w.transform,w.style.map.terrain);let Pt,Zt;const Kt=D.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR;q.activeTexture.set(H.TEXTURE0),He.texture.bind(Kt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),q.activeTexture.set(H.TEXTURE1),Je?(Je.texture.bind(Kt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),Pt=Math.pow(2,Je.tileID.overscaledZ-He.tileID.overscaledZ),Zt=[He.tileID.canonical.x*Pt%1,He.tileID.canonical.y*Pt%1]):He.texture.bind(Kt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),He.texture.useMipmap&&q.extTextureFilterAnisotropic&&w.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);const qt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ve),jt=qt?Ve:null,rn=jt?jt.posMatrix:w.transform.calculatePosMatrix(Ve.toUnwrapped(),Fe),Sn=Tl(rn,Zt||[0,0],Pt||1,xt,D);X instanceof Qn?ne.draw(q,H.TRIANGLES,Te,mi.disabled,me,hi.disabled,Sn,qt,D.id,X.boundsBuffer,w.quadTriangleIndexBuffer,X.boundsSegments):ne.draw(q,H.TRIANGLES,Te,we[Ve.overscaledZ],me,hi.disabled,Sn,qt,D.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}})(t,f,_,y);break;case"background":(function(w,R,D,z){const q=D.paint.get("background-color"),H=D.paint.get("background-opacity");if(H===0)return;const X=w.context,ne=X.gl,me=w.transform,we=me.tileSize,Me=D.paint.get("background-pattern");if(w.isPatternMissing(Me))return;const Ne=!Me&&q.a===1&&H===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==Ne)return;const Fe=mi.disabled,Ve=w.depthModeForSublayer(0,Ne==="opaque"?jn.ReadWrite:jn.ReadOnly),Te=w.colorModeForRenderPass(),He=w.useProgram(Me?"backgroundPattern":"background"),Je=z||me.coveringTiles({tileSize:we,terrain:w.style.map.terrain});Me&&(X.activeTexture.set(ne.TEXTURE0),w.imageManager.bind(w.context));const st=D.getCrossfadeParameters();for(const xt of Je){const Pt=z?xt.posMatrix:w.transform.calculatePosMatrix(xt.toUnwrapped()),Zt=Me?_a(Pt,H,w,Me,{tileID:xt,tileSize:we},st):ga(Pt,H,q),Kt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(xt);He.draw(X,ne.TRIANGLES,Ve,Fe,Te,hi.disabled,Zt,Kt,D.id,w.tileExtentBuffer,w.quadTriangleIndexBuffer,w.tileExtentSegments)}})(t,0,_,y);break;case"custom":(function(w,R,D){const z=w.context,q=D.implementation;if(w.renderPass==="offscreen"){const H=q.prerender;H&&(w.setCustomLayerDefaults(),z.setColorMode(w.colorModeForRenderPass()),H.call(q,z.gl,w.transform.customLayerMatrix()),z.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),z.setColorMode(w.colorModeForRenderPass()),z.setStencilMode(mi.disabled);const H=q.renderingMode==="3d"?new jn(w.context.gl.LEQUAL,jn.ReadWrite,w.depthRangeFor3D):w.depthModeForSublayer(0,jn.ReadOnly);z.setDepthMode(H),q.render(z.gl,w.transform.customLayerMatrix(),{farZ:w.transform.farZ,nearZ:w.transform.nearZ,fov:w.transform._fov,modelViewProjectionMatrix:w.transform.modelViewProjectionMatrix,projectionMatrix:w.transform.projectionMatrix}),z.setDirty(),w.setBaseState(),z.bindFramebuffer.set(null)}})(t,0,_)}}translatePosMatrix(t,f,_,y,w){if(!_[0]&&!_[1])return t;const R=w?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(R){const q=Math.sin(R),H=Math.cos(R);_=[_[0]*H-_[1]*q,_[0]*q+_[1]*H]}const D=[w?_[0]:Un(f,_[0],this.transform.zoom),w?_[1]:Un(f,_[1],this.transform.zoom),0],z=new Float32Array(16);return l.J(z,t,D),z}saveTileTexture(t){const f=this._tileTextures[t.size[0]];f?f.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const f=this._tileTextures[t];return f&&f.length>0?f.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const f=this.imageManager.getPattern(t.from.toString()),_=this.imageManager.getPattern(t.to.toString());return!f||!_}useProgram(t,f){this.cache=this.cache||{};const _=t+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[_]||(this.cache[_]=new wo(this.context,ro[t],f,Ba[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ke(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:f}=this.context.gl;return this.width!==t||this.height!==f}}class L{constructor(t,f){this.points=t,this.planes=f}static fromInvProjectionMatrix(t,f,_){const y=Math.pow(2,_),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const z=1/(D=l.af([],D,t))[3]/f*y;return l.b1(D,D,[z,z,1/D[3],z])}),R=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const z=function(ne,me){var we=me[0],Me=me[1],Ne=me[2],Fe=we*we+Me*Me+Ne*Ne;return Fe>0&&(Fe=1/Math.sqrt(Fe)),ne[0]=me[0]*Fe,ne[1]=me[1]*Fe,ne[2]=me[2]*Fe,ne}([],function(ne,me,we){var Me=me[0],Ne=me[1],Fe=me[2],Ve=we[0],Te=we[1],He=we[2];return ne[0]=Ne*He-Fe*Te,ne[1]=Fe*Ve-Me*He,ne[2]=Me*Te-Ne*Ve,ne}([],ce([],w[D[0]],w[D[1]]),ce([],w[D[2]],w[D[1]]))),q=-((H=z)[0]*(X=w[D[1]])[0]+H[1]*X[1]+H[2]*X[2]);var H,X;return z.concat(q)});return new L(w,R)}}class O{constructor(t,f){this.min=t,this.max=f,this.center=function(_,y,w){return _[0]=.5*y[0],_[1]=.5*y[1],_[2]=.5*y[2],_}([],function(_,y,w){return _[0]=y[0]+w[0],_[1]=y[1]+w[1],_[2]=y[2]+w[2],_}([],this.min,this.max))}quadrant(t){const f=[t%2==0,t<2],_=ve(this.min),y=ve(this.max);for(let w=0;w<f.length;w++)_[w]=f[w]?this.min[w]:this.center[w],y[w]=f[w]?this.center[w]:this.max[w];return y[2]=this.max[2],new O(_,y)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const f=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let _=!0;for(let y=0;y<t.planes.length;y++){const w=t.planes[y];let R=0;for(let D=0;D<f.length;D++)l.b2(w,f[D])>=0&&R++;if(R===0)return 0;R!==f.length&&(_=!1)}if(_)return 2;for(let y=0;y<3;y++){let w=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(let D=0;D<t.points.length;D++){const z=t.points[D][y]-this.min[y];w=Math.min(w,z),R=Math.max(R,z)}if(R<0||w>this.max[y]-this.min[y])return 0}return 1}}class V{constructor(t=0,f=0,_=0,y=0){if(isNaN(t)||t<0||isNaN(f)||f<0||isNaN(_)||_<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=f,this.left=_,this.right=y}interpolate(t,f,_){return f.top!=null&&t.top!=null&&(this.top=l.y.number(t.top,f.top,_)),f.bottom!=null&&t.bottom!=null&&(this.bottom=l.y.number(t.bottom,f.bottom,_)),f.left!=null&&t.left!=null&&(this.left=l.y.number(t.left,f.left,_)),f.right!=null&&t.right!=null&&(this.right=l.y.number(t.right,f.right,_)),this}getCenter(t,f){const _=l.ac((this.left+t-this.right)/2,0,t),y=l.ac((this.top+f-this.bottom)/2,0,f);return new l.P(_,y)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new V(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const K=85.051129;class pe{constructor(t,f,_,y,w){this.tileSize=512,this._renderWorldCopies=w===void 0||!!w,this._minZoom=t||0,this._maxZoom=f||22,this._minPitch=_??0,this._maxPitch=y??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new V,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new pe(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.lngRange=t.lngRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const f=-l.b3(t,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=function(){var _=new l.A(4);return l.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}(),function(_,y,w){var R=y[0],D=y[1],z=y[2],q=y[3],H=Math.sin(w),X=Math.cos(w);_[0]=R*X+z*H,_[1]=D*X+q*H,_[2]=R*-H+z*X,_[3]=D*-H+q*X}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const f=l.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const f=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.tileZoom=Math.max(0,Math.floor(f)),this.scale=this.zoomScale(f),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,f,_){this._unmodified=!1,this._edgeInsets.interpolate(t,f,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const f=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(t){const f=[new l.b4(0,t)];if(this._renderWorldCopies){const _=this.pointCoordinate(new l.P(0,0)),y=this.pointCoordinate(new l.P(this.width,0)),w=this.pointCoordinate(new l.P(this.width,this.height)),R=this.pointCoordinate(new l.P(0,this.height)),D=Math.floor(Math.min(_.x,y.x,w.x,R.x)),z=Math.floor(Math.max(_.x,y.x,w.x,R.x)),q=1;for(let H=D-q;H<=z+q;H++)H!==0&&f.push(new l.b4(H,t))}return f}coveringTiles(t){var f,_;let y=this.coveringZoomLevel(t);const w=y;if(t.minzoom!==void 0&&y<t.minzoom)return[];t.maxzoom!==void 0&&y>t.maxzoom&&(y=t.maxzoom);const R=this.pointCoordinate(this.getCameraPoint()),D=l.Z.fromLngLat(this.center),z=Math.pow(2,y),q=[z*R.x,z*R.y,0],H=[z*D.x,z*D.y,0],X=L.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,y);let ne=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ne=y);const me=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,we=Te=>({aabb:new O([Te*z,0,0],[(Te+1)*z,z,0]),zoom:0,x:0,y:0,wrap:Te,fullyVisible:!1}),Me=[],Ne=[],Fe=y,Ve=t.reparseOverscaled?w:y;if(this._renderWorldCopies)for(let Te=1;Te<=3;Te++)Me.push(we(-Te)),Me.push(we(Te));for(Me.push(we(0));Me.length>0;){const Te=Me.pop(),He=Te.x,Je=Te.y;let st=Te.fullyVisible;if(!st){const qt=Te.aabb.intersects(X);if(qt===0)continue;st=qt===2}const xt=t.terrain?q:H,Pt=Te.aabb.distanceX(xt),Zt=Te.aabb.distanceY(xt),Kt=Math.max(Math.abs(Pt),Math.abs(Zt));if(Te.zoom===Fe||Kt>me+(1<<Fe-Te.zoom)-2&&Te.zoom>=ne){const qt=Fe-Te.zoom,jt=q[0]-.5-(He<<qt),rn=q[1]-.5-(Je<<qt);Ne.push({tileID:new l.S(Te.zoom===Fe?Ve:Te.zoom,Te.wrap,Te.zoom,He,Je),distanceSq:xe([H[0]-.5-He,H[1]-.5-Je]),tileDistanceToCamera:Math.sqrt(jt*jt+rn*rn)})}else for(let qt=0;qt<4;qt++){const jt=(He<<1)+qt%2,rn=(Je<<1)+(qt>>1),Sn=Te.zoom+1;let Vt=Te.aabb.quadrant(qt);if(t.terrain){const Xt=new l.S(Sn,Te.wrap,Sn,jt,rn),wn=t.terrain.getMinMaxElevation(Xt),Ai=(f=wn.minElevation)!==null&&f!==void 0?f:this.elevation,Bn=(_=wn.maxElevation)!==null&&_!==void 0?_:this.elevation;Vt=new O([Vt.min[0],Vt.min[1],Ai],[Vt.max[0],Vt.max[1],Bn])}Me.push({aabb:Vt,zoom:Sn,x:jt,y:rn,wrap:Te.wrap,fullyVisible:st})}}return Ne.sort((Te,He)=>Te.distanceSq-He.distanceSq).map(Te=>Te.tileID)}resize(t,f){this.width=t,this.height=f,this.pixelsToGLUnits=[2/t,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const f=l.ac(t.lat,-85.051129,K);return new l.P(l.O(t.lng)*this.worldSize,l.Q(f)*this.worldSize)}unproject(t){return new l.Z(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const f=this.elevation,_=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,y=this.pointLocation(this.centerPoint,t),w=t.getElevationForLngLatZoom(y,this.tileZoom);if(!(this.elevation-w))return;const R=_+f-w,D=Math.cos(this._pitch)*this.cameraToCenterDistance/R/l.b5(1,y.lat),z=this.scaleZoom(D/this.tileSize);this._elevation=w,this._center=y,this.zoom=z}setLocationAtPoint(t,f){const _=this.pointCoordinate(f),y=this.pointCoordinate(this.centerPoint),w=this.locationCoordinate(t),R=new l.Z(w.x-(_.x-y.x),w.y-(_.y-y.y));this.center=this.coordinateLocation(R),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,f){return f?this.coordinatePoint(this.locationCoordinate(t),f.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,f){return this.coordinateLocation(this.pointCoordinate(t,f))}locationCoordinate(t){return l.Z.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,f){if(f){const ne=f.pointCoordinate(t);if(ne!=null)return ne}const _=[t.x,t.y,0,1],y=[t.x,t.y,1,1];l.af(_,_,this.pixelMatrixInverse),l.af(y,y,this.pixelMatrixInverse);const w=_[3],R=y[3],D=_[1]/w,z=y[1]/R,q=_[2]/w,H=y[2]/R,X=q===H?0:(0-q)/(H-q);return new l.Z(l.y.number(_[0]/w,y[0]/R,X)/this.worldSize,l.y.number(D,z,X)/this.worldSize)}coordinatePoint(t,f=0,_=this.pixelMatrix){const y=[t.x*this.worldSize,t.y*this.worldSize,f,1];return l.af(y,y,_),new l.P(y[0]/y[3],y[1]/y[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Ke().extend(this.pointLocation(new l.P(0,t))).extend(this.pointLocation(new l.P(this.width,t))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ke([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,K])}calculateTileMatrix(t){const f=t.canonical,_=this.worldSize/this.zoomScale(f.z),y=f.x+Math.pow(2,f.z)*t.wrap,w=l.an(new Float64Array(16));return l.J(w,w,[y*_,f.y*_,0]),l.K(w,w,[_/l.X,_/l.X,1]),w}calculatePosMatrix(t,f=!1){const _=t.key,y=f?this._alignedPosMatrixCache:this._posMatrixCache;if(y[_])return y[_];const w=this.calculateTileMatrix(t);return l.L(w,f?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,w),y[_]=new Float32Array(w),y[_]}calculateFogMatrix(t){const f=t.key,_=this._fogMatrixCache;if(_[f])return _[f];const y=this.calculateTileMatrix(t);return l.L(y,this.fogMatrix,y),_[f]=new Float32Array(y),_[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,f){f=l.ac(+f,this.minZoom,this.maxZoom);const _={center:new l.N(t.lng,t.lat),zoom:f};let y=this.lngRange;if(!this._renderWorldCopies&&y===null){const Te=179.9999999999;y=[-Te,Te]}const w=this.tileSize*this.zoomScale(_.zoom);let R=0,D=w,z=0,q=w,H=0,X=0;const{x:ne,y:me}=this.size;if(this.latRange){const Te=this.latRange;R=l.Q(Te[1])*w,D=l.Q(Te[0])*w,D-R<me&&(H=me/(D-R))}y&&(z=l.b3(l.O(y[0])*w,0,w),q=l.b3(l.O(y[1])*w,0,w),q<z&&(q+=w),q-z<ne&&(X=ne/(q-z)));const{x:we,y:Me}=this.project.call({worldSize:w},t);let Ne,Fe;const Ve=Math.max(X||0,H||0);if(Ve){const Te=new l.P(X?(q+z)/2:we,H?(D+R)/2:Me);return _.center=this.unproject.call({worldSize:w},Te).wrap(),_.zoom+=this.scaleZoom(Ve),_}if(this.latRange){const Te=me/2;Me-Te<R&&(Fe=R+Te),Me+Te>D&&(Fe=D-Te)}if(y){const Te=(z+q)/2;let He=we;this._renderWorldCopies&&(He=l.b3(we,Te-w/2,Te+w/2));const Je=ne/2;He-Je<z&&(Ne=z+Je),He+Je>q&&(Ne=q-Je)}if(Ne!==void 0||Fe!==void 0){const Te=new l.P(Ne??we,Fe??Me);_.center=this.unproject.call({worldSize:w},Te).wrap()}return _}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:f,zoom:_}=this.getConstrained(this.center,this.zoom);this.center=f,this.zoom=_,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,f=this.point.x,_=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b5(1,this.center.lat)*this.worldSize;let y=l.an(new Float64Array(16));l.K(y,y,[this.width/2,-this.height/2,1]),l.J(y,y,[1,-1,0]),this.labelPlaneMatrix=y,y=l.an(new Float64Array(16)),l.K(y,y,[1,-1,1]),l.J(y,y,[-1,-1,0]),l.K(y,y,[2/this.width,2/this.height,1]),this.glCoordMatrix=y;const w=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),R=Math.min(this.elevation,this.minElevationForCurrentTile),D=w-R*this._pixelPerMeter/Math.cos(this._pitch),z=R<0?D:w,q=Math.PI/2+this._pitch,H=this._fov*(.5+t.y/this.height),X=Math.sin(H)*z/Math.sin(l.ac(Math.PI-q-H,.01,Math.PI-.01)),ne=this.getHorizon(),me=2*Math.atan(ne/this.cameraToCenterDistance)*(.5+t.y/(2*ne)),we=Math.sin(me)*z/Math.sin(l.ac(Math.PI-q-me,.01,Math.PI-.01)),Me=Math.min(X,we);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Me+z),this.nearZ=this.height/50,y=new Float64Array(16),l.b6(y,this._fov,this.width/this.height,this.nearZ,this.farZ),y[8]=2*-t.x/this.width,y[9]=2*t.y/this.height,this.projectionMatrix=l.ae(y),l.K(y,y,[1,-1,1]),l.J(y,y,[0,0,-this.cameraToCenterDistance]),l.b7(y,y,this._pitch),l.ad(y,y,this.angle),l.J(y,y,[-f,-_,0]),this.mercatorMatrix=l.K([],y,[this.worldSize,this.worldSize,this.worldSize]),l.K(y,y,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.L(new Float64Array(16),this.labelPlaneMatrix,y),l.J(y,y,[0,0,-this.elevation]),this.modelViewProjectionMatrix=y,this.invModelViewProjectionMatrix=l.as([],y),this.fogMatrix=new Float64Array(16),l.b6(this.fogMatrix,this._fov,this.width/this.height,w,this.farZ),this.fogMatrix[8]=2*-t.x/this.width,this.fogMatrix[9]=2*t.y/this.height,l.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),l.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),l.b7(this.fogMatrix,this.fogMatrix,this._pitch),l.ad(this.fogMatrix,this.fogMatrix,this.angle),l.J(this.fogMatrix,this.fogMatrix,[-f,-_,0]),l.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),l.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=l.L(new Float64Array(16),this.labelPlaneMatrix,y);const Ne=this.width%2/2,Fe=this.height%2/2,Ve=Math.cos(this.angle),Te=Math.sin(this.angle),He=f-Math.round(f)+Ve*Ne+Te*Fe,Je=_-Math.round(_)+Ve*Fe+Te*Ne,st=new Float64Array(y);if(l.J(st,st,[He>.5?He-1:He,Je>.5?Je-1:Je,0]),this.alignedModelViewProjectionMatrix=st,y=l.as(new Float64Array(16),this.pixelMatrix),!y)throw new Error("failed to invert matrix");this.pixelMatrixInverse=y,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new l.P(0,0)),f=[t.x*this.worldSize,t.y*this.worldSize,0,1];return l.af(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,t))}getCameraQueryGeometry(t){const f=this.getCameraPoint();if(t.length===1)return[t[0],f];{let _=f.x,y=f.y,w=f.x,R=f.y;for(const D of t)_=Math.min(_,D.x),y=Math.min(y,D.y),w=Math.max(w,D.x),R=Math.max(R,D.y);return[new l.P(_,y),new l.P(w,y),new l.P(w,R),new l.P(_,R),new l.P(_,y)]}}lngLatToCameraDepth(t,f){const _=this.locationCoordinate(t),y=[_.x*this.worldSize,_.y*this.worldSize,f,1];return l.af(y,y,this.modelViewProjectionMatrix),y[2]/y[3]}}function Be(k,t){let f,_=!1,y=null,w=null;const R=()=>{y=null,_&&(k.apply(w,f),y=setTimeout(R,t),_=!1)};return(...D)=>(_=!0,w=this,f=D,y||R(),y)}class $e{constructor(t){this._getCurrentHash=()=>{const f=window.location.hash.replace("#","");if(this._hashName){let _;return f.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(_=y)}),(_&&_[1]||"").split("/")}return f.split("/")},this._onHashChange=()=>{const f=this._getCurrentHash();if(f.length>=3&&!f.some(_=>isNaN(_))){const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:_,pitch:+(f[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const f=window.location.href.replace(/(#.+)?$/,this.getHashString());window.history.replaceState(window.history.state,null,f)},this._removeHash=()=>{const f=this._getCurrentHash();if(f.length===0)return;const _=f.join("/");let y=_;y.split("&").length>0&&(y=y.split("&")[0]),this._hashName&&(y=`${this._hashName}=${_}`);let w=window.location.hash.replace(y,"");w.startsWith("#&")?w=w.slice(0,1)+w.slice(2):w==="#"&&(w="");let R=window.location.href.replace(/(#.+)?$/,w);R=R.replace("&&","&"),window.history.replaceState(window.history.state,null,R)},this._updateHash=Be(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const f=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,y=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,y),R=Math.round(f.lng*w)/w,D=Math.round(f.lat*w)/w,z=this._map.getBearing(),q=this._map.getPitch();let H="";if(H+=t?`/${R}/${D}/${_}`:`${_}/${D}/${R}`,(z||q)&&(H+="/"+Math.round(10*z)/10),q&&(H+=`/${Math.round(q)}`),this._hashName){const X=this._hashName;let ne=!1;const me=window.location.hash.slice(1).split("&").map(we=>{const Me=we.split("=")[0];return Me===X?(ne=!0,`${Me}=${H}`):we}).filter(we=>we);return ne||me.push(`${X}=${H}`),`#${me.join("&")}`}return`#${H}`}}const mt={linearity:.3,easing:l.b8(0,0,.3,1)},Ft=l.e({deceleration:2500,maxSpeed:1400},mt),Nt=l.e({deceleration:20,maxSpeed:1400},mt),gn=l.e({deceleration:1e3,maxSpeed:360},mt),vn=l.e({deceleration:1e3,maxSpeed:90},mt);class Ln{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:C.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,f=C.now();for(;t.length>0&&f-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const f={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)f.zoom+=w.zoomDelta||0,f.bearing+=w.bearingDelta||0,f.pitch+=w.pitchDelta||0,w.panDelta&&f.pan._add(w.panDelta),w.around&&(f.around=w.around),w.pinchAround&&(f.pinchAround=w.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(f.pan.mag()){const w=gi(f.pan.mag(),_,l.e({},Ft,t||{}));y.offset=f.pan.mult(w.amount/f.pan.mag()),y.center=this._map.transform.center,ni(y,w)}if(f.zoom){const w=gi(f.zoom,_,Nt);y.zoom=this._map.transform.zoom+w.amount,ni(y,w)}if(f.bearing){const w=gi(f.bearing,_,gn);y.bearing=this._map.transform.bearing+l.ac(w.amount,-179,179),ni(y,w)}if(f.pitch){const w=gi(f.pitch,_,vn);y.pitch=this._map.transform.pitch+w.amount,ni(y,w)}if(y.zoom||y.bearing){const w=f.pinchAround===void 0?f.around:f.pinchAround;y.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),l.e(y,{noMoveStart:!0})}}function ni(k,t){(!k.duration||k.duration<t.duration)&&(k.duration=t.duration,k.easing=t.easing)}function gi(k,t,f){const{maxSpeed:_,linearity:y,deceleration:w}=f,R=l.ac(k*y/(t/1e3),-_,_),D=Math.abs(R)/(w*y);return{easing:f.easing,duration:1e3*D,amount:R*(D/2)}}class ui extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,f,_,y={}){const w=N.mousePos(f.getCanvas(),_),R=f.unproject(w);super(t,l.e({point:w,lngLat:R,originalEvent:_},y)),this._defaultPrevented=!1,this.target=f}}class er extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,f,_){const y=t==="touchend"?_.changedTouches:_.touches,w=N.touchPos(f.getCanvasContainer(),y),R=w.map(z=>f.unproject(z)),D=w.reduce((z,q,H,X)=>z.add(q.div(X.length)),new l.P(0,0));super(t,{points:w,point:D,lngLats:R,lngLat:f.unproject(D),originalEvent:_}),this._defaultPrevented=!1}}class ss extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,f,_){super(t,{originalEvent:_}),this._defaultPrevented=!1}}class Rs{constructor(t,f){this._map=t,this._clickTolerance=f.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new ss(t.type,this._map,t))}mousedown(t,f){return this._mousedownPos=f,this._firePreventable(new ui(t.type,this._map,t))}mouseup(t){this._map.fire(new ui(t.type,this._map,t))}click(t,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new ui(t.type,this._map,t))}dblclick(t){return this._firePreventable(new ui(t.type,this._map,t))}mouseover(t){this._map.fire(new ui(t.type,this._map,t))}mouseout(t){this._map.fire(new ui(t.type,this._map,t))}touchstart(t){return this._firePreventable(new er(t.type,this._map,t))}touchmove(t){this._map.fire(new er(t.type,this._map,t))}touchend(t){this._map.fire(new er(t.type,this._map,t))}touchcancel(t){this._map.fire(new er(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class di{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new ui(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ui("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new ui(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rr{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(l.P.convert(t),this._map.terrain)}}class dr{constructor(t,f){this._map=t,this._tr=new Rr(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,f){this.isEnabled()&&t.shiftKey&&t.button===0&&(N.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(t,f){if(!this._active)return;const _=f;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=_,this._box||(this._box=N.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const w=Math.min(y.x,_.x),R=Math.max(y.x,_.x),D=Math.min(y.y,_.y),z=Math.max(y.y,_.y);N.setTransform(this._box,`translate(${w}px,${D}px)`),this._box.style.width=R-w+"px",this._box.style.height=z-D+"px"}mouseupWindow(t,f){if(!this._active||t.button!==0)return;const _=this._startPos,y=f;if(this.reset(),N.suppressClick(),_.x!==y.x||_.y!==y.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:t})),{cameraAnimation:w=>w.fitScreenCoordinates(_,y,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(N.remove(this._box),this._box=null),N.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,f){return this._map.fire(new l.k(t,{originalEvent:f}))}}function Ps(k,t){if(k.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${k.length}, points ${t.length}`);const f={};for(let _=0;_<k.length;_++)f[k[_].identifier]=t[_];return f}class Wa{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,f,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),_.length===this.numTouches&&(this.centroid=function(y){const w=new l.P(0,0);for(const R of y)w._add(R);return w.div(y.length)}(f),this.touches=Ps(_,f)))}touchmove(t,f,_){if(this.aborted||!this.centroid)return;const y=Ps(_,f);for(const w in this.touches){const R=y[w];(!R||R.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(t,f,_){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class xa{constructor(t){this.singleTap=new Wa(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,f,_){this.singleTap.touchstart(t,f,_)}touchmove(t,f,_){this.singleTap.touchmove(t,f,_)}touchend(t,f,_){const y=this.singleTap.touchend(t,f,_);if(y){const w=t.timeStamp-this.lastTime<500,R=!this.lastTap||this.lastTap.dist(y)<30;if(w&&R||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class lo{constructor(t){this._tr=new Rr(t),this._zoomIn=new xa({numTouches:1,numTaps:2}),this._zoomOut=new xa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,f,_){this._zoomIn.touchstart(t,f,_),this._zoomOut.touchstart(t,f,_)}touchmove(t,f,_){this._zoomIn.touchmove(t,f,_),this._zoomOut.touchmove(t,f,_)}touchend(t,f,_){const y=this._zoomIn.touchend(t,f,_),w=this._zoomOut.touchend(t,f,_),R=this._tr;return y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:R.zoom+1,around:R.unproject(y)},{originalEvent:t})}):w?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:R.zoom-1,around:R.unproject(w)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ks{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const f=this._moveFunction(...t);if(f.bearingDelta||f.pitchDelta||f.around||f.panDelta)return this._active=!0,f}dragStart(t,f){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=f.length?f[0]:f,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,f){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const y=f.length?f[0]:f;return!this._moved&&y.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=y,this._move(_,y))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&N.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ec={0:1,2:2};class gu{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const f=N.mouseButton(t);this._eventButton=f}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(f,_){const y=Ec[_];return f.buttons===void 0||(f.buttons&y)!==y}(t,this._eventButton)}isValidEndEvent(t){return N.mouseButton(t)===this._eventButton}}class Ac{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const _u=k=>{k.mousedown=k.dragStart,k.mousemoveWindow=k.dragMove,k.mouseup=k.dragEnd,k.contextmenu=t=>{t.preventDefault()}},Tc=({enable:k,clickTolerance:t,bearingDegreesPerPixelMoved:f=.8})=>{const _=new gu({checkCorrectEvent:y=>N.mouseButton(y)===0&&y.ctrlKey||N.mouseButton(y)===2});return new ks({clickTolerance:t,move:(y,w)=>({bearingDelta:(w.x-y.x)*f}),moveStateManager:_,enable:k,assignEvents:_u})},Cc=({enable:k,clickTolerance:t,pitchDegreesPerPixelMoved:f=-.5})=>{const _=new gu({checkCorrectEvent:y=>N.mouseButton(y)===0&&y.ctrlKey||N.mouseButton(y)===2});return new ks({clickTolerance:t,move:(y,w)=>({pitchDelta:(w.y-y.y)*f}),moveStateManager:_,enable:k,assignEvents:_u})};class wa{constructor(t,f){this._clickTolerance=t.clickTolerance||1,this._map=f,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,f,_){return this._calculateTransform(t,f,_)}touchmove(t,f,_){if(this._active){if(!this._shouldBePrevented(_.length))return t.preventDefault(),this._calculateTransform(t,f,_);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,f,_){this._calculateTransform(t,f,_),this._active&&this._shouldBePrevented(_.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,f,_){_.length>0&&(this._active=!0);const y=Ps(_,f),w=new l.P(0,0),R=new l.P(0,0);let D=0;for(const q in y){const H=y[q],X=this._touches[q];X&&(w._add(H),R._add(H.sub(X)),D++,y[q]=H)}if(this._touches=y,this._shouldBePrevented(D)||!R.mag())return;const z=R.div(D);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(D),panDelta:z}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,f,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([f[0],f[1]]))}touchmove(t,f,_){if(!this._firstTwoTouches)return;t.preventDefault();const[y,w]=this._firstTwoTouches,R=jl(_,f,y),D=jl(_,f,w);if(!R||!D)return;const z=this._aroundCenter?null:R.add(D).div(2);return this._move([R,D],z,t)}touchend(t,f,_){if(!this._firstTwoTouches)return;const[y,w]=this._firstTwoTouches,R=jl(_,f,y),D=jl(_,f,w);R&&D||(this._active&&N.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function jl(k,t,f){for(let _=0;_<k.length;_++)if(k[_].identifier===f)return t[_]}function Lc(k,t){return Math.log(k/t)/Math.LN2}class Mc extends yu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,f){const _=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Lc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Lc(this._distance,_),pinchAround:f}}}function Rc(k,t){return 180*k.angleWith(t)/Math.PI}class Pc extends yu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,f,_){const y=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Rc(this._vector,y),pinchAround:f}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const f=25/(Math.PI*this._minDiameter)*360,_=Rc(t,this._startVector);return Math.abs(_)<f}}function vu(k){return Math.abs(k.y)>Math.abs(k.x)}class Ka extends yu{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,f,_){super.touchstart(t,f,_),this._currentTouchCount=_.length}_start(t){this._lastPoints=t,vu(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,f,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const y=t[0].sub(this._lastPoints[0]),w=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(y,w,_.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(y.y+w.y)/2*-.5}):void 0}gestureBeginsVertically(t,f,_){if(this._valid!==void 0)return this._valid;const y=t.mag()>=2,w=f.mag()>=2;if(!y&&!w)return;if(!y||!w)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const R=t.y>0==f.y>0;return vu(t)&&vu(f)&&R}}const Bh={panStep:100,bearingStep:15,pitchStep:10};class Ds{constructor(t){this._tr=new Rr(t);const f=Bh;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let f=0,_=0,y=0,w=0,R=0;switch(t.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:t.shiftKey?_=-1:(t.preventDefault(),w=-1);break;case 39:t.shiftKey?_=1:(t.preventDefault(),w=1);break;case 38:t.shiftKey?y=1:(t.preventDefault(),R=-1);break;case 40:t.shiftKey?y=-1:(t.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(_=0,y=0),{cameraAnimation:D=>{const z=this._tr;D.easeTo({duration:300,easeId:"keyboardHandler",easing:uo,zoom:f?Math.round(z.zoom)+f*(t.shiftKey?2:1):z.zoom,bearing:z.bearing+_*this._bearingStep,pitch:z.pitch+y*this._pitchStep,offset:[-w*this._panStep,-R*this._panStep],center:z.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function uo(k){return k*(2-k)}const Dc=4.000244140625;class Zs{constructor(t,f){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=t,this._tr=new Rr(t),this._triggerRenderFrame=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let f=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const _=C.now(),y=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,f!==0&&f%Dc==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(y*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),t.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=t,this._delta-=f,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=N.mousePos(this._map.getCanvas(),t),_=this._tr;this._around=f.y>_.transform.height/2-_.transform.getHorizon()?l.N.convert(this._aroundCenter?_.center:_.unproject(f)):l.N.convert(_.center),this._aroundPoint=_.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>Dc?this._wheelZoomRate:this._defaultZoomRate;let q=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&q!==0&&(q=1/q);const H=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(H*q))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,_=this._startZoom,y=this._easing;let w,R=!1;const D=C.now()-this._lastWheelEventTime;if(this._type==="wheel"&&_&&y&&D){const z=Math.min(D/200,1),q=y(z);w=l.y.number(_,f,q),z<1?this._frameId||(this._frameId=!0):R=!0}else w=f,R=!0;return this._active=!0,R&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!R,zoomDelta:w-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let f=l.b9;if(this._prevEase){const _=this._prevEase,y=(C.now()-_.start)/_.duration,w=_.easing(y+.01)-_.easing(y),R=.27/Math.sqrt(w*w+1e-4)*.01,D=Math.sqrt(.0729-R*R);f=l.b8(R,D,.25,1)}return this._prevEase={start:C.now(),duration:t,easing:f},f}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ka{constructor(t,f){this._clickZoom=t,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class sd{constructor(t){this._tr=new Rr(t),this.reset()}reset(){this._active=!1}dblclick(t,f){return t.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(f)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class od{constructor(){this._tap=new xa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,f,_){if(!this._swipePoint)if(this._tapTime){const y=f[0],w=t.timeStamp-this._tapTime<500,R=this._tapPoint.dist(y)<30;w&&R?_.length>0&&(this._swipePoint=y,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(t,f,_)}touchmove(t,f,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const y=f[0],w=y.y-this._swipePoint.y;return this._swipePoint=y,t.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(t,f,_)}touchend(t,f,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const y=this._tap.touchend(t,f,_);y&&(this._tapTime=t.timeStamp,this._tapPoint=y)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uh{constructor(t,f,_){this._el=t,this._mousePan=f,this._touchPan=_}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class jh{constructor(t,f,_){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=f,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Nc{constructor(t,f,_,y){this._el=t,this._touchZoom=f,this._touchRotate=_,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class $a{constructor(t,f){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=f,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=N.create("div","maplibregl-cooperative-gesture-screen",t);let f=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(f=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),y=document.createElement("div");y.className="maplibregl-desktop-message",y.textContent=f,this._container.appendChild(y);const w=document.createElement("div");w.className="maplibregl-mobile-message",w.textContent=_,this._container.appendChild(w),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(N.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,f){this._enabled&&(this._map.fire(new l.k("cooperativegestureprevented",{gestureType:t,originalEvent:f})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Ns=k=>k.zoom||k.drag||k.pitch||k.rotate;class Qt extends l.k{}function bu(k){return k.panDelta&&k.panDelta.mag()||k.zoomDelta||k.bearingDelta||k.pitchDelta}class zc{constructor(t,f){this.handleWindowEvent=y=>{this.handleEvent(y,`${y.type}Window`)},this.handleEvent=(y,w)=>{if(y.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const R=y.type==="renderFrame"?void 0:y,D={needsRenderFrame:!1},z={},q={},H=y.touches,X=H?this._getMapTouches(H):void 0,ne=X?N.touchPos(this._map.getCanvas(),X):N.mousePos(this._map.getCanvas(),y);for(const{handlerName:Me,handler:Ne,allowed:Fe}of this._handlers){if(!Ne.isEnabled())continue;let Ve;this._blockedByActive(q,Fe,Me)?Ne.reset():Ne[w||y.type]&&(Ve=Ne[w||y.type](y,ne,X),this.mergeHandlerResult(D,z,Ve,Me,R),Ve&&Ve.needsRenderFrame&&this._triggerRenderFrame()),(Ve||Ne.isActive())&&(q[Me]=Ne)}const me={};for(const Me in this._previousActiveHandlers)q[Me]||(me[Me]=R);this._previousActiveHandlers=q,(Object.keys(me).length||bu(D))&&(this._changes.push([D,z,me]),this._triggerRenderFrame()),(Object.keys(q).length||bu(D))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:we}=D;we&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],we(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ln(t),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,w,R]of this._listeners)N.addEventListener(y,w,y===document?this.handleWindowEvent:this.handleEvent,R)}destroy(){for(const[t,f,_]of this._listeners)N.removeEventListener(t,f,t===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(t){const f=this._map,_=f.getCanvasContainer();this._add("mapEvent",new Rs(f,t));const y=f.boxZoom=new dr(f,t);this._add("boxZoom",y),t.interactive&&t.boxZoom&&y.enable();const w=f.cooperativeGestures=new $a(f,t.cooperativeGestures);this._add("cooperativeGestures",w),t.cooperativeGestures&&w.enable();const R=new lo(f),D=new sd(f);f.doubleClickZoom=new ka(D,R),this._add("tapZoom",R),this._add("clickZoom",D),t.interactive&&t.doubleClickZoom&&f.doubleClickZoom.enable();const z=new od;this._add("tapDragZoom",z);const q=f.touchPitch=new Ka(f);this._add("touchPitch",q),t.interactive&&t.touchPitch&&f.touchPitch.enable(t.touchPitch);const H=Tc(t),X=Cc(t);f.dragRotate=new jh(t,H,X),this._add("mouseRotate",H,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]),t.interactive&&t.dragRotate&&f.dragRotate.enable();const ne=(({enable:Ve,clickTolerance:Te})=>{const He=new gu({checkCorrectEvent:Je=>N.mouseButton(Je)===0&&!Je.ctrlKey});return new ks({clickTolerance:Te,move:(Je,st)=>({around:st,panDelta:st.sub(Je)}),activateOnStart:!0,moveStateManager:He,enable:Ve,assignEvents:_u})})(t),me=new wa(t,f);f.dragPan=new Uh(_,ne,me),this._add("mousePan",ne),this._add("touchPan",me,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&f.dragPan.enable(t.dragPan);const we=new Pc,Me=new Mc;f.touchZoomRotate=new Nc(_,Me,we,z),this._add("touchRotate",we,["touchPan","touchZoom"]),this._add("touchZoom",Me,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&f.touchZoomRotate.enable(t.touchZoomRotate);const Ne=f.scrollZoom=new Zs(f,()=>this._triggerRenderFrame());this._add("scrollZoom",Ne,["mousePan"]),t.interactive&&t.scrollZoom&&f.scrollZoom.enable(t.scrollZoom);const Fe=f.keyboard=new Ds(f);this._add("keyboard",Fe),t.interactive&&t.keyboard&&f.keyboard.enable(),this._add("blockableMapEvent",new di(f))}_add(t,f,_){this._handlers.push({handlerName:t,handler:f,allowed:_}),this._handlersById[t]=f}stop(t){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ns(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,f,_){for(const y in t)if(y!==_&&(!f||f.indexOf(y)<0))return!0;return!1}_getMapTouches(t){const f=[];for(const _ of t)this._el.contains(_.target)&&f.push(_);return f}mergeHandlerResult(t,f,_,y,w){if(!_)return;l.e(t,_);const R={handlerName:y,originalEvent:_.originalEvent||w};_.zoomDelta!==void 0&&(f.zoom=R),_.panDelta!==void 0&&(f.drag=R),_.pitchDelta!==void 0&&(f.pitch=R),_.bearingDelta!==void 0&&(f.rotate=R)}_applyChanges(){const t={},f={},_={};for(const[y,w,R]of this._changes)y.panDelta&&(t.panDelta=(t.panDelta||new l.P(0,0))._add(y.panDelta)),y.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(t.around=y.around),y.pinchAround!==void 0&&(t.pinchAround=y.pinchAround),y.noInertia&&(t.noInertia=y.noInertia),l.e(f,w),l.e(_,R);this._updateMapTransform(t,f,_),this._changes=[]}_updateMapTransform(t,f,_){const y=this._map,w=y._getTransformForUpdate(),R=y.terrain;if(!(bu(t)||R&&this._terrainMovement))return this._fireEvents(f,_,!0);let{panDelta:D,zoomDelta:z,bearingDelta:q,pitchDelta:H,around:X,pinchAround:ne}=t;ne!==void 0&&(X=ne),y._stop(!0),X=X||y.transform.centerPoint;const me=w.pointLocation(D?X.sub(D):X);q&&(w.bearing+=q),H&&(w.pitch+=H),z&&(w.zoom+=z),R?this._terrainMovement||!f.drag&&!f.zoom?f.drag&&this._terrainMovement?w.center=w.pointLocation(w.centerPoint.sub(D)):w.setLocationAtPoint(me,X):(this._terrainMovement=!0,this._map._elevationFreeze=!0,w.setLocationAtPoint(me,X)):w.setLocationAtPoint(me,X),y._applyUpdatedTransform(w),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(f,_,!0)}_fireEvents(t,f,_){const y=Ns(this._eventsInProgress),w=Ns(t),R={};for(const X in t){const{originalEvent:ne}=t[X];this._eventsInProgress[X]||(R[`${X}start`]=ne),this._eventsInProgress[X]=t[X]}!y&&w&&this._fireEvent("movestart",w.originalEvent);for(const X in R)this._fireEvent(X,R[X]);w&&this._fireEvent("move",w.originalEvent);for(const X in t){const{originalEvent:ne}=t[X];this._fireEvent(X,ne)}const D={};let z;for(const X in this._eventsInProgress){const{handlerName:ne,originalEvent:me}=this._eventsInProgress[X];this._handlersById[ne].isActive()||(delete this._eventsInProgress[X],z=f[ne]||me,D[`${X}end`]=z)}for(const X in D)this._fireEvent(X,D[X]);const q=Ns(this._eventsInProgress),H=(y||w)&&!q;if(H&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const X=this._map._getTransformForUpdate();X.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(X)}if(_&&H){this._updatingCamera=!0;const X=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ne=me=>me!==0&&-this._bearingSnap<me&&me<this._bearingSnap;!X||!X.essential&&C.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:z})),ne(this._map.getBearing())&&this._map.resetNorth()):(ne(X.bearing||this._map.getBearing())&&(X.bearing=0),X.freezeElevation=!0,this._map.easeTo(X,{originalEvent:z})),this._updatingCamera=!1}}_fireEvent(t,f){this._map.fire(new l.k(t,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Qt("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class qh extends l.E{constructor(t,f){super(),this._renderFrameCallback=()=>{const _=Math.min((C.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=f.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.N(this.transform.center.lng,this.transform.center.lat)}setCenter(t,f){return this.jumpTo({center:t},f)}panBy(t,f,_){return t=l.P.convert(t).mult(-1),this.panTo(this.transform.center,l.e({offset:t},f),_)}panTo(t,f,_){return this.easeTo(l.e({center:t},f),_)}getZoom(){return this.transform.zoom}setZoom(t,f){return this.jumpTo({zoom:t},f),this}zoomTo(t,f,_){return this.easeTo(l.e({zoom:t},f),_)}zoomIn(t,f){return this.zoomTo(this.getZoom()+1,t,f),this}zoomOut(t,f){return this.zoomTo(this.getZoom()-1,t,f),this}getBearing(){return this.transform.bearing}setBearing(t,f){return this.jumpTo({bearing:t},f),this}getPadding(){return this.transform.padding}setPadding(t,f){return this.jumpTo({padding:t},f),this}rotateTo(t,f,_){return this.easeTo(l.e({bearing:t},f),_)}resetNorth(t,f){return this.rotateTo(0,l.e({duration:1e3},t),f),this}resetNorthPitch(t,f){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},t),f),this}snapToNorth(t,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,f):this}getPitch(){return this.transform.pitch}setPitch(t,f){return this.jumpTo({pitch:t},f),this}cameraForBounds(t,f){t=Ke.convert(t).adjustAntiMeridian();const _=f&&f.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),_,f)}_cameraForBoxAndBearing(t,f,_,y){const w={top:0,bottom:0,right:0,left:0};if(typeof(y=l.e({padding:w,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding=="number"){const qt=y.padding;y.padding={top:qt,bottom:qt,right:qt,left:qt}}y.padding=l.e(w,y.padding);const R=this.transform,D=R.padding,z=new Ke(t,f),q=R.project(z.getNorthWest()),H=R.project(z.getNorthEast()),X=R.project(z.getSouthEast()),ne=R.project(z.getSouthWest()),me=l.ba(-_),we=q.rotate(me),Me=H.rotate(me),Ne=X.rotate(me),Fe=ne.rotate(me),Ve=new l.P(Math.max(we.x,Me.x,Fe.x,Ne.x),Math.max(we.y,Me.y,Fe.y,Ne.y)),Te=new l.P(Math.min(we.x,Me.x,Fe.x,Ne.x),Math.min(we.y,Me.y,Fe.y,Ne.y)),He=Ve.sub(Te),Je=(R.width-(D.left+D.right+y.padding.left+y.padding.right))/He.x,st=(R.height-(D.top+D.bottom+y.padding.top+y.padding.bottom))/He.y;if(st<0||Je<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const xt=Math.min(R.scaleZoom(R.scale*Math.min(Je,st)),y.maxZoom),Pt=l.P.convert(y.offset),Zt=new l.P((y.padding.left-y.padding.right)/2,(y.padding.top-y.padding.bottom)/2).rotate(l.ba(_)),Kt=Pt.add(Zt).mult(R.scale/R.zoomScale(xt));return{center:R.unproject(q.add(X).div(2).sub(Kt)),zoom:xt,bearing:_}}fitBounds(t,f,_){return this._fitInternal(this.cameraForBounds(t,f),f,_)}fitScreenCoordinates(t,f,_,y,w){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(t)),this.transform.pointLocation(l.P.convert(f)),_,y),y,w)}_fitInternal(t,f,_){return t?(delete(f=l.e(t,f)).padding,f.linear?this.easeTo(f,_):this.flyTo(f,_)):this}jumpTo(t,f){this.stop();const _=this._getTransformForUpdate();let y=!1,w=!1,R=!1;return"zoom"in t&&_.zoom!==+t.zoom&&(y=!0,_.zoom=+t.zoom),t.center!==void 0&&(_.center=l.N.convert(t.center)),"bearing"in t&&_.bearing!==+t.bearing&&(w=!0,_.bearing=+t.bearing),"pitch"in t&&_.pitch!==+t.pitch&&(R=!0,_.pitch=+t.pitch),t.padding==null||_.isPaddingEqual(t.padding)||(_.padding=t.padding),this._applyUpdatedTransform(_),this.fire(new l.k("movestart",f)).fire(new l.k("move",f)),y&&this.fire(new l.k("zoomstart",f)).fire(new l.k("zoom",f)).fire(new l.k("zoomend",f)),w&&this.fire(new l.k("rotatestart",f)).fire(new l.k("rotate",f)).fire(new l.k("rotateend",f)),R&&this.fire(new l.k("pitchstart",f)).fire(new l.k("pitch",f)).fire(new l.k("pitchend",f)),this.fire(new l.k("moveend",f))}calculateCameraOptionsFromTo(t,f,_,y=0){const w=l.Z.fromLngLat(t,f),R=l.Z.fromLngLat(_,y),D=R.x-w.x,z=R.y-w.y,q=R.z-w.z,H=Math.hypot(D,z,q);if(H===0)throw new Error("Can't calculate camera options with same From and To");const X=Math.hypot(D,z),ne=this.transform.scaleZoom(this.transform.cameraToCenterDistance/H/this.transform.tileSize),me=180*Math.atan2(D,-z)/Math.PI;let we=180*Math.acos(X/H)/Math.PI;return we=q<0?90-we:90+we,{center:R.toLngLat(),zoom:ne,pitch:we,bearing:me}}easeTo(t,f){var _;this._stop(!1,t.easeId),((t=l.e({offset:[0,0],duration:500,easing:l.b9},t)).animate===!1||!t.essential&&C.prefersReducedMotion)&&(t.duration=0);const y=this._getTransformForUpdate(),w=y.zoom,R=y.bearing,D=y.pitch,z=y.padding,q="bearing"in t?this._normalizeBearing(t.bearing,R):R,H="pitch"in t?+t.pitch:D,X="padding"in t?t.padding:y.padding,ne=l.P.convert(t.offset);let me=y.centerPoint.add(ne);const we=y.pointLocation(me),{center:Me,zoom:Ne}=y.getConstrained(l.N.convert(t.center||we),(_=t.zoom)!==null&&_!==void 0?_:w);this._normalizeCenter(Me,y);const Fe=y.project(we),Ve=y.project(Me).sub(Fe),Te=y.zoomScale(Ne-w);let He,Je;t.around&&(He=l.N.convert(t.around),Je=y.locationPoint(He));const st={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Ne!==w,this._rotating=this._rotating||R!==q,this._pitching=this._pitching||H!==D,this._padding=!y.isPaddingEqual(X),this._easeId=t.easeId,this._prepareEase(f,t.noMoveStart,st),this.terrain&&this._prepareElevation(Me),this._ease(xt=>{if(this._zooming&&(y.zoom=l.y.number(w,Ne,xt)),this._rotating&&(y.bearing=l.y.number(R,q,xt)),this._pitching&&(y.pitch=l.y.number(D,H,xt)),this._padding&&(y.interpolatePadding(z,X,xt),me=y.centerPoint.add(ne)),this.terrain&&!t.freezeElevation&&this._updateElevation(xt),He)y.setLocationAtPoint(He,Je);else{const Pt=y.zoomScale(y.zoom-w),Zt=Ne>w?Math.min(2,Te):Math.max(.5,Te),Kt=Math.pow(Zt,1-xt),qt=y.unproject(Fe.add(Ve.mult(xt*Kt)).mult(Pt));y.setLocationAtPoint(y.renderWorldCopies?qt.wrap():qt,me)}this._applyUpdatedTransform(y),this._fireMoveEvents(f)},xt=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(f,xt)},t),this}_prepareEase(t,f,_={}){this._moving=!0,f||_.moving||this.fire(new l.k("movestart",t)),this._zooming&&!_.zooming&&this.fire(new l.k("zoomstart",t)),this._rotating&&!_.rotating&&this.fire(new l.k("rotatestart",t)),this._pitching&&!_.pitching&&this.fire(new l.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const f=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&f!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(_-(f-(_*t+this._elevationStart))/(1-t)),this._elevationTarget=f}this.transform.elevation=l.y.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){const f=t.getCameraPosition(),_=this.terrain.getElevationForLngLatZoom(f.lngLat,t.zoom);if(f.altitude<_){const y=this.calculateCameraOptionsFromTo(f.lngLat,_,t.center,t.elevation);return{pitch:y.pitch,zoom:y.zoom}}return{}}_applyUpdatedTransform(t){const f=[];if(this.terrain&&f.push(y=>this._elevateCameraIfInsideTerrain(y)),this.transformCameraUpdate&&f.push(y=>this.transformCameraUpdate(y)),!f.length)return;const _=t.clone();for(const y of f){const w=_.clone(),{center:R,zoom:D,pitch:z,bearing:q,elevation:H}=y(w);R&&(w.center=R),D!==void 0&&(w.zoom=D),z!==void 0&&(w.pitch=z),q!==void 0&&(w.bearing=q),H!==void 0&&(w.elevation=H),_.apply(w)}this.transform.apply(_)}_fireMoveEvents(t){this.fire(new l.k("move",t)),this._zooming&&this.fire(new l.k("zoom",t)),this._rotating&&this.fire(new l.k("rotate",t)),this._pitching&&this.fire(new l.k("pitch",t))}_afterEase(t,f){if(this._easeId&&f&&this._easeId===f)return;delete this._easeId;const _=this._zooming,y=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new l.k("zoomend",t)),y&&this.fire(new l.k("rotateend",t)),w&&this.fire(new l.k("pitchend",t)),this.fire(new l.k("moveend",t))}flyTo(t,f){var _;if(!t.essential&&C.prefersReducedMotion){const Xt=l.M(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Xt,f)}this.stop(),t=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b9},t);const y=this._getTransformForUpdate(),w=y.zoom,R=y.bearing,D=y.pitch,z=y.padding,q="bearing"in t?this._normalizeBearing(t.bearing,R):R,H="pitch"in t?+t.pitch:D,X="padding"in t?t.padding:y.padding,ne=l.P.convert(t.offset);let me=y.centerPoint.add(ne);const we=y.pointLocation(me),{center:Me,zoom:Ne}=y.getConstrained(l.N.convert(t.center||we),(_=t.zoom)!==null&&_!==void 0?_:w);this._normalizeCenter(Me,y);const Fe=y.zoomScale(Ne-w),Ve=y.project(we),Te=y.project(Me).sub(Ve);let He=t.curve;const Je=Math.max(y.width,y.height),st=Je/Fe,xt=Te.mag();if("minZoom"in t){const Xt=l.ac(Math.min(t.minZoom,w,Ne),y.minZoom,y.maxZoom),wn=Je/y.zoomScale(Xt-w);He=Math.sqrt(wn/xt*2)}const Pt=He*He;function Zt(Xt){const wn=(st*st-Je*Je+(Xt?-1:1)*Pt*Pt*xt*xt)/(2*(Xt?st:Je)*Pt*xt);return Math.log(Math.sqrt(wn*wn+1)-wn)}function Kt(Xt){return(Math.exp(Xt)-Math.exp(-Xt))/2}function qt(Xt){return(Math.exp(Xt)+Math.exp(-Xt))/2}const jt=Zt(!1);let rn=function(Xt){return qt(jt)/qt(jt+He*Xt)},Sn=function(Xt){return Je*((qt(jt)*(Kt(wn=jt+He*Xt)/qt(wn))-Kt(jt))/Pt)/xt;var wn},Vt=(Zt(!0)-jt)/He;if(Math.abs(xt)<1e-6||!isFinite(Vt)){if(Math.abs(Je-st)<1e-6)return this.easeTo(t,f);const Xt=st<Je?-1:1;Vt=Math.abs(Math.log(st/Je))/He,Sn=()=>0,rn=wn=>Math.exp(Xt*He*wn)}return t.duration="duration"in t?+t.duration:1e3*Vt/("screenSpeed"in t?+t.screenSpeed/He:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=R!==q,this._pitching=H!==D,this._padding=!y.isPaddingEqual(X),this._prepareEase(f,!1),this.terrain&&this._prepareElevation(Me),this._ease(Xt=>{const wn=Xt*Vt,Ai=1/rn(wn);y.zoom=Xt===1?Ne:w+y.scaleZoom(Ai),this._rotating&&(y.bearing=l.y.number(R,q,Xt)),this._pitching&&(y.pitch=l.y.number(D,H,Xt)),this._padding&&(y.interpolatePadding(z,X,Xt),me=y.centerPoint.add(ne)),this.terrain&&!t.freezeElevation&&this._updateElevation(Xt);const Bn=Xt===1?Me:y.unproject(Ve.add(Te.mult(Sn(wn))).mult(Ai));y.setLocationAtPoint(y.renderWorldCopies?Bn.wrap():Bn,me),this._applyUpdatedTransform(y),this._fireMoveEvents(f)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(f)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,f){var _;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,f)}return t||(_=this.handlers)===null||_===void 0||_.stop(!1),this}_ease(t,f,_){_.animate===!1||_.duration===0?(t(1),f()):(this._easeStart=C.now(),this._easeOptions=_,this._onEaseFrame=t,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,f){t=l.b3(t,-180,180);const _=Math.abs(t-f);return Math.abs(t-360-f)<_&&(t-=360),Math.abs(t+360-f)<_&&(t+=360),t}_normalizeCenter(t,f){if(!f.renderWorldCopies||f.lngRange)return;const _=t.lng-f.center.lng;t.lng+=_>180?-360:_<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(l.N.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const Ya={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ja{constructor(t=Ya){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=f=>{!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"&&f.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=N.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=N.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=N.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){N.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,f){const _=this._map._getUIString(`AttributionControl.${f}`);t.title=_,t.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(y=>typeof y!="string"?"":y)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const f=this._map.style.sourceCaches;for(const y in f){const w=f[y];if(w.used||w.usedForTerrain){const R=w.getSource();R.attribution&&t.indexOf(R.attribution)<0&&t.push(R.attribution)}}t=t.filter(y=>String(y).trim()),t.sort((y,w)=>y.length-w.length),t=t.filter((y,w)=>{for(let R=w+1;R<t.length;R++)if(t[R].indexOf(y)>=0)return!1;return!0});const _=t.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,t.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Fc{constructor(t={}){this._updateCompact=()=>{const f=this._container.children;if(f.length){const _=f[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=N.create("div","maplibregl-ctrl");const f=N.create("a","maplibregl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://maplibre.org/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){N.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Zn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const f=++this._id;return this._queue.push({callback:t,id:f,cancelled:!1}),f}remove(t){const f=this._currentlyRunning,_=f?this._queue.concat(f):this._queue;for(const y of _)if(y.id===t)return void(y.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const f=this._currentlyRunning=this._queue;this._queue=[];for(const _ of f)if(!_.cancelled&&(_.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Oc=l.Y([{name:"a_pos3d",type:"Int16",components:3}]);class ad extends l.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,f){this.sourceCache.update(t,f),this._renderableTilesKeys=[];const _={};for(const y of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:f}))_[y.key]=!0,this._renderableTilesKeys.push(y.key),this._tiles[y.key]||(y.posMatrix=new Float64Array(16),l.aP(y.posMatrix,0,l.X,0,l.X,0,1),this._tiles[y.key]=new Ms(y,this.tileSize));for(const y in this._tiles)_[y]||delete this._tiles[y]}freeRtt(t){for(const f in this._tiles){const _=this._tiles[f];(!t||_.tileID.equals(t)||_.tileID.isChildOf(t)||t.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const f={};for(const _ of this._renderableTilesKeys){const y=this._tiles[_].tileID;if(y.canonical.equals(t.canonical)){const w=t.clone();w.posMatrix=new Float64Array(16),l.aP(w.posMatrix,0,l.X,0,l.X,0,1),f[_]=w}else if(y.canonical.isChildOf(t.canonical)){const w=t.clone();w.posMatrix=new Float64Array(16);const R=y.canonical.z-t.canonical.z,D=y.canonical.x-(y.canonical.x>>R<<R),z=y.canonical.y-(y.canonical.y>>R<<R),q=l.X>>R;l.aP(w.posMatrix,0,q,0,q,0,1),l.J(w.posMatrix,w.posMatrix,[-D*q,-z*q,0]),f[_]=w}else if(t.canonical.isChildOf(y.canonical)){const w=t.clone();w.posMatrix=new Float64Array(16);const R=t.canonical.z-y.canonical.z,D=t.canonical.x-(t.canonical.x>>R<<R),z=t.canonical.y-(t.canonical.y>>R<<R),q=l.X>>R;l.aP(w.posMatrix,0,l.X,0,l.X,0,1),l.J(w.posMatrix,w.posMatrix,[D*q,z*q,0]),l.K(w.posMatrix,w.posMatrix,[1/2**R,1/2**R,0]),f[_]=w}}return f}getSourceTile(t,f){const _=this.sourceCache._source;let y=t.overscaledZ-this.deltaZoom;if(y>_.maxzoom&&(y=_.maxzoom),y<_.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(y).key);let w=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!w||!w.dem)&&f)for(;y>=_.minzoom&&(!w||!w.dem);)w=this.sourceCache.getTileByID(t.scaledTo(y--).key);return w}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(f=>f.timeAdded>=t)}}class Bc{constructor(t,f,_){this.painter=t,this.sourceCache=new ad(f),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,f,_,y=l.X){var w;if(!(f>=0&&f<y&&_>=0&&_<y))return 0;const R=this.getTerrainData(t),D=(w=R.tile)===null||w===void 0?void 0:w.dem;if(!D)return 0;const z=function(we,Me,Ne){var Fe=Me[0],Ve=Me[1];return we[0]=Ne[0]*Fe+Ne[4]*Ve+Ne[12],we[1]=Ne[1]*Fe+Ne[5]*Ve+Ne[13],we}([],[f/y*l.X,_/y*l.X],R.u_terrain_matrix),q=[z[0]*D.dim,z[1]*D.dim],H=Math.floor(q[0]),X=Math.floor(q[1]),ne=q[0]-H,me=q[1]-X;return D.get(H,X)*(1-ne)*(1-me)+D.get(H+1,X)*ne*(1-me)+D.get(H,X+1)*(1-ne)*me+D.get(H+1,X+1)*ne*me}getElevationForLngLatZoom(t,f){if(!l.bb(f,t.wrap()))return 0;const{tileID:_,mercatorX:y,mercatorY:w}=this._getOverscaledTileIDFromLngLatZoom(t,f);return this.getElevation(_,y%l.X,w%l.X,l.X)}getElevation(t,f,_,y=l.X){return this.getDEMElevation(t,f,_,y)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const y=this.painter.context,w=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ke(y,w,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ke(y,new l.R({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const f=this.sourceCache.getSourceTile(t,!0);if(f&&f.dem&&(!f.demTexture||f.needsTerrainPrepare)){const y=this.painter.context;f.demTexture=this.painter.getTileTexture(f.dem.stride),f.demTexture?f.demTexture.update(f.dem.getPixels(),{premultiply:!1}):f.demTexture=new ke(y,f.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),f.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),f.needsTerrainPrepare=!1}const _=f&&f+f.tileID.key+t.key;if(_&&!this._demMatrixCache[_]){const y=this.sourceCache.sourceCache._source.maxzoom;let w=t.canonical.z-f.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=y?w=t.canonical.z-y:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const R=t.canonical.x-(t.canonical.x>>w<<w),D=t.canonical.y-(t.canonical.y>>w<<w),z=l.bc(new Float64Array(16),[1/(l.X<<w),1/(l.X<<w),0]);l.J(z,z,[R*l.X,D*l.X,0]),this._demMatrixCache[t.key]={matrix:z,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:f&&f.dem&&f.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:f&&f.dem&&f.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(f&&f.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:f}}getFramebuffer(t){const f=this.painter,_=f.width/devicePixelRatio,y=f.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===y||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ke(f.context,{width:_,height:y,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ke(f.context,{width:_,height:y,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=f.context.createFramebuffer(_,y,!0,!1),this._fbo.depthAttachment.set(f.context.createRenderbuffer(f.context.gl.DEPTH_COMPONENT16,_,y))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const f=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let w=0,R=0;w<this._coordsTextureSize;w++)for(let D=0;D<this._coordsTextureSize;D++,R+=4)f[R+0]=255&D,f[R+1]=255&w,f[R+2]=D>>8<<4|w>>8,f[R+3]=0;const _=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(f.buffer)),y=new ke(t,_,t.gl.RGBA,{premultiply:!1});return y.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=y,y}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const f=new Uint8Array(4),_=this.painter.context,y=_.gl,w=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),R=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),D=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),y.readPixels(w,D-R-1,1,1,y.RGBA,y.UNSIGNED_BYTE,f),_.bindFramebuffer.set(null);const z=f[0]+(f[2]>>4<<8),q=f[1]+((15&f[2])<<8),H=this.coordsIndex[255-f[3]],X=H&&this.sourceCache.getTileByID(H);if(!X)return null;const ne=this._coordsTextureSize,me=(1<<X.tileID.canonical.z)*ne;return new l.Z((X.tileID.canonical.x*ne+z)/me+X.tileID.wrap,(X.tileID.canonical.y*ne+q)/me,this.getElevation(X.tileID,z,q,ne))}depthAtPoint(t){const f=new Uint8Array(4),_=this.painter.context,y=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),y.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,y.RGBA,y.UNSIGNED_BYTE,f),_.bindFramebuffer.set(null),(f[0]/16777216+f[1]/65536+f[2]/256+f[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,f=new l.bd,_=new l.aY,y=this.meshSize,w=l.X/y,R=y*y;for(let X=0;X<=y;X++)for(let ne=0;ne<=y;ne++)f.emplaceBack(ne*w,X*w,0);for(let X=0;X<R;X+=y+1)for(let ne=0;ne<y;ne++)_.emplaceBack(ne+X,y+ne+X+1,y+ne+X+2),_.emplaceBack(ne+X,y+ne+X+2,ne+X+1);const D=f.length,z=D+2*(y+1);for(const X of[0,1])for(let ne=0;ne<=y;ne++)for(const me of[0,1])f.emplaceBack(ne*w,X*l.X,me);for(let X=0;X<2*y;X+=2)_.emplaceBack(z+X,z+X+1,z+X+3),_.emplaceBack(z+X,z+X+3,z+X+2),_.emplaceBack(D+X,D+X+3,D+X+1),_.emplaceBack(D+X,D+X+2,D+X+3);const q=f.length,H=q+2*(y+1);for(const X of[0,1])for(let ne=0;ne<=y;ne++)for(const me of[0,1])f.emplaceBack(X*l.X,ne*w,me);for(let X=0;X<2*y;X+=2)_.emplaceBack(q+X,q+X+1,q+X+3),_.emplaceBack(q+X,q+X+3,q+X+2),_.emplaceBack(H+X,H+X+3,H+X+1),_.emplaceBack(H+X,H+X+2,H+X+3);return this._mesh=new p(t.createVertexBuffer(f,Oc.members),t.createIndexBuffer(_),l.a0.simpleSegment(0,0,f.length,_.length)),this._mesh}getMeshFrameDelta(t){return 2*Math.PI*l.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,f){var _;const{tileID:y}=this._getOverscaledTileIDFromLngLatZoom(t,f);return(_=this.getMinMaxElevation(y).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(t){const f=this.getTerrainData(t).tile,_={minElevation:null,maxElevation:null};return f&&f.dem&&(_.minElevation=f.dem.min*this.exaggeration,_.maxElevation=f.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(t,f){const _=l.Z.fromLngLat(t.wrap()),y=(1<<f)*l.X,w=_.x*y,R=_.y*y,D=Math.floor(w/l.X),z=Math.floor(R/l.X);return{tileID:new l.S(f,0,f,D,z),mercatorX:w,mercatorY:R}}}class ld{constructor(t,f,_){this._context=t,this._size=f,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const f=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new ke(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),f.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),f.colorAttachment.set(_.texture),{id:t,fbo:f,texture:_,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(f=>t.id!==f),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const f of this._recentlyUsed)if(!this._objects[f].inUse)return this._objects[f];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Qa={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Vh{constructor(t,f){this.painter=t,this.terrain=f,this.pool=new ld(t.context,30,f.sourceCache.tileSize*f.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,f){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(_=>!t._layers[_].isHidden(f)),this._coordsDescendingInv={};for(const _ in t.sourceCaches){this._coordsDescendingInv[_]={};const y=t.sourceCaches[_].getVisibleCoordinates();for(const w of y){const R=this.terrain.sourceCache.getTerrainCoords(w);for(const D in R)this._coordsDescendingInv[_][D]||(this._coordsDescendingInv[_][D]=[]),this._coordsDescendingInv[_][D].push(R[D])}}this._coordsDescendingInvStr={};for(const _ of t._order){const y=t._layers[_],w=y.source;if(Qa[y.type]&&!this._coordsDescendingInvStr[w]){this._coordsDescendingInvStr[w]={};for(const R in this._coordsDescendingInv[w])this._coordsDescendingInvStr[w][R]=this._coordsDescendingInv[w][R].map(D=>D.key).sort().join()}}for(const _ of this._renderableTiles)for(const y in this._coordsDescendingInvStr){const w=this._coordsDescendingInvStr[y][_.tileID.key];w&&w!==_.rttCoords[y]&&(_.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const f=t.type,_=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Qa[f]&&(this._prevType&&Qa[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(t.id),!y))return!0;if(Qa[this._prevType]||Qa[f]&&y){this._prevType=f;const w=this._stacks.length-1,R=this._stacks[w]||[];for(const D of this._renderableTiles){if(this.pool.isFull()&&(d(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(D),D.rtt[w]){const q=this.pool.getObjectForId(D.rtt[w].id);if(q.stamp===D.rtt[w].stamp){this.pool.useObject(q);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),D.rtt[w]={id:z.id,stamp:z.stamp},_.context.bindFramebuffer.set(z.fbo.framebuffer),_.context.clear({color:l.aM.transparent,stencil:0}),_.currentStencilSource=void 0;for(let q=0;q<R.length;q++){const H=_.style._layers[R[q]],X=H.source?this._coordsDescendingInv[H.source][D.tileID.key]:[D.tileID];_.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),_._renderTileClippingMasks(H,X),_.renderLayer(_,_.style.sourceCaches[H.source],H,X),H.source&&(D.rttCoords[H.source]=this._coordsDescendingInvStr[H.source][D.tileID.key])}}return d(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Qa[f]}return!1}}const Uc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Gh=x,ud={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ya,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},jc=k=>{k.touchstart=k.dragStart,k.touchmoveWindow=k.dragMove,k.touchend=k.dragEnd},cd={showCompass:!0,showZoom:!0,visualizePitch:!1};class hd{constructor(t,f,_=!1){this.mousedown=R=>{this.startMouse(l.e({},R,{ctrlKey:!0,preventDefault:()=>R.preventDefault()}),N.mousePos(this.element,R)),N.addEventListener(window,"mousemove",this.mousemove),N.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=R=>{this.moveMouse(R,N.mousePos(this.element,R))},this.mouseup=R=>{this.mouseRotate.dragEnd(R),this.mousePitch&&this.mousePitch.dragEnd(R),this.offTemp()},this.touchstart=R=>{R.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=N.touchPos(this.element,R.targetTouches)[0],this.startTouch(R,this._startPos),N.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.addEventListener(window,"touchend",this.touchend))},this.touchmove=R=>{R.targetTouches.length!==1?this.reset():(this._lastPos=N.touchPos(this.element,R.targetTouches)[0],this.moveTouch(R,this._lastPos))},this.touchend=R=>{R.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const y=t.dragRotate._mouseRotate.getClickTolerance(),w=t.dragRotate._mousePitch.getClickTolerance();this.element=f,this.mouseRotate=Tc({clickTolerance:y,enable:!0}),this.touchRotate=(({enable:R,clickTolerance:D,bearingDegreesPerPixelMoved:z=.8})=>{const q=new Ac;return new ks({clickTolerance:D,move:(H,X)=>({bearingDelta:(X.x-H.x)*z}),moveStateManager:q,enable:R,assignEvents:jc})})({clickTolerance:y,enable:!0}),this.map=t,_&&(this.mousePitch=Cc({clickTolerance:w,enable:!0}),this.touchPitch=(({enable:R,clickTolerance:D,pitchDegreesPerPixelMoved:z=-.5})=>{const q=new Ac;return new ks({clickTolerance:D,move:(H,X)=>({pitchDelta:(X.y-H.y)*z}),moveStateManager:q,enable:R,assignEvents:jc})})({clickTolerance:w,enable:!0})),N.addEventListener(f,"mousedown",this.mousedown),N.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),N.addEventListener(f,"touchcancel",this.reset)}startMouse(t,f){this.mouseRotate.dragStart(t,f),this.mousePitch&&this.mousePitch.dragStart(t,f),N.disableDrag()}startTouch(t,f){this.touchRotate.dragStart(t,f),this.touchPitch&&this.touchPitch.dragStart(t,f),N.disableDrag()}moveMouse(t,f){const _=this.map,{bearingDelta:y}=this.mouseRotate.dragMove(t,f)||{};if(y&&_.setBearing(_.getBearing()+y),this.mousePitch){const{pitchDelta:w}=this.mousePitch.dragMove(t,f)||{};w&&_.setPitch(_.getPitch()+w)}}moveTouch(t,f){const _=this.map,{bearingDelta:y}=this.touchRotate.dragMove(t,f)||{};if(y&&_.setBearing(_.getBearing()+y),this.touchPitch){const{pitchDelta:w}=this.touchPitch.dragMove(t,f)||{};w&&_.setPitch(_.getPitch()+w)}}off(){const t=this.element;N.removeEventListener(t,"mousedown",this.mousedown),N.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend),N.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){N.enableDrag(),N.removeEventListener(window,"mousemove",this.mousemove),N.removeEventListener(window,"mouseup",this.mouseup),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend)}}let Is;function Ei(k,t,f){const _=new l.N(k.lng,k.lat);if(k=new l.N(k.lng,k.lat),t){const y=new l.N(k.lng-360,k.lat),w=new l.N(k.lng+360,k.lat),R=f.locationPoint(k).distSqr(t);f.locationPoint(y).distSqr(t)<R?k=y:f.locationPoint(w).distSqr(t)<R&&(k=w)}for(;Math.abs(k.lng-f.center.lng)>180;){const y=f.locationPoint(k);if(y.x>=0&&y.y>=0&&y.x<=f.width&&y.y<=f.height)break;k.lng>f.center.lng?k.lng-=360:k.lng+=360}return k.lng!==_.lng&&f.locationPoint(k).y>f.height/2-f.getHorizon()?k:_}const el={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function xu(k,t,f){const _=k.classList;for(const y in el)_.remove(`maplibregl-${f}-anchor-${y}`);_.add(`maplibregl-${f}-anchor-${t}`)}class wu extends l.E{constructor(t){if(super(),this._onKeyPress=f=>{const _=f.code,y=f.charCode||f.keyCode;_!=="Space"&&_!=="Enter"&&y!==32&&y!==13||this.togglePopup()},this._onMapClick=f=>{const _=f.originalEvent.target,y=this._element;this._popup&&(_===y||y.contains(_))&&this.togglePopup()},this._update=f=>{var _;if(!this._map)return;const y=this._map.loaded()&&!this._map.isMoving();((f==null?void 0:f.type)==="terrain"||(f==null?void 0:f.type)==="render"&&!y)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ei(this._lngLat,this._flatPos,this._map.transform):(_=this._lngLat)===null||_===void 0?void 0:_.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let w="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?w=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(w=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let R="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?R="rotateX(0deg)":this._pitchAlignment==="map"&&(R=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||f&&f.type!=="moveend"||(this._pos=this._pos.round()),N.setTransform(this._element,`${el[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${R} ${w}`),C.frameAsync(new AbortController).then(()=>{this._updateOpacity(f&&f.type==="moveend")}).catch(()=>{})},this._onMove=f=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=f=>{this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=l.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=N.create("div");const f=N.createNS("http://www.w3.org/2000/svg","svg"),_=41,y=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${_}px`),f.setAttributeNS(null,"width",`${y}px`),f.setAttributeNS(null,"viewBox",`0 0 ${y} ${_}`);const w=N.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");const R=N.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");const D=N.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(3.0, 29.0)"),D.setAttributeNS(null,"fill","#000000");const z=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Fe of z){const Ve=N.createNS("http://www.w3.org/2000/svg","ellipse");Ve.setAttributeNS(null,"opacity","0.04"),Ve.setAttributeNS(null,"cx","10.5"),Ve.setAttributeNS(null,"cy","5.80029008"),Ve.setAttributeNS(null,"rx",Fe.rx),Ve.setAttributeNS(null,"ry",Fe.ry),D.appendChild(Ve)}const q=N.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"fill",this._color);const H=N.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),q.appendChild(H);const X=N.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"fill","#000000");const ne=N.createNS("http://www.w3.org/2000/svg","path");ne.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),X.appendChild(ne);const me=N.createNS("http://www.w3.org/2000/svg","g");me.setAttributeNS(null,"transform","translate(6.0, 7.0)"),me.setAttributeNS(null,"fill","#FFFFFF");const we=N.createNS("http://www.w3.org/2000/svg","g");we.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Me=N.createNS("http://www.w3.org/2000/svg","circle");Me.setAttributeNS(null,"fill","#000000"),Me.setAttributeNS(null,"opacity","0.25"),Me.setAttributeNS(null,"cx","5.5"),Me.setAttributeNS(null,"cy","5.5"),Me.setAttributeNS(null,"r","5.4999962");const Ne=N.createNS("http://www.w3.org/2000/svg","circle");Ne.setAttributeNS(null,"fill","#FFFFFF"),Ne.setAttributeNS(null,"cx","5.5"),Ne.setAttributeNS(null,"cy","5.5"),Ne.setAttributeNS(null,"r","5.4999962"),we.appendChild(Me),we.appendChild(Ne),R.appendChild(D),R.appendChild(q),R.appendChild(X),R.appendChild(me),R.appendChild(we),f.appendChild(R),f.setAttributeNS(null,"height",_*this._scale+"px"),f.setAttributeNS(null,"width",y*this._scale+"px"),this._element.appendChild(f),this._offset=l.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),xu(this._element,this._anchor,"marker"),t&&t.className)for(const f of t.className.split(" "))this._element.classList.add(f);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),N.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=l.N.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const y=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var f,_;if(!(!((f=this._map)===null||f===void 0)&&f.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const y=this._map,w=y.terrain.depthAtPoint(this._pos),R=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,R)-w<.006)return void(this._element.style.opacity=this._opacity);const D=-this._offset.y/y.transform._pixelPerMeter,z=Math.sin(y.getPitch()*Math.PI/180)*D,q=y.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),H=y.transform.lngLatToCameraDepth(this._lngLat,R+z)-q>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&H&&this._popup.remove(),this._element.style.opacity=H?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=l.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,f){return t===void 0&&f===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),f!==void 0&&(this._opacityWhenCovered=f),this._map&&this._updateOpacity(!0),this}}const Zh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ql=0,Vl=!1;const co={maxWidth:100,unit:"metric"};function Gl(k,t,f){const _=f&&f.maxWidth||100,y=k._container.clientHeight/2,w=k.unproject([0,y]),R=k.unproject([_,y]),D=w.distanceTo(R);if(f&&f.unit==="imperial"){const z=3.2808*D;z>5280?nn(t,_,z/5280,k._getUIString("ScaleControl.Miles")):nn(t,_,z,k._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?nn(t,_,D/1852,k._getUIString("ScaleControl.NauticalMiles")):D>=1e3?nn(t,_,D/1e3,k._getUIString("ScaleControl.Kilometers")):nn(t,_,D,k._getUIString("ScaleControl.Meters"))}function nn(k,t,f,_){const y=function(w){const R=Math.pow(10,`${Math.floor(w)}`.length-1);let D=w/R;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function(z){const q=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*q)/q}(D),R*D}(f);k.style.width=t*(y/f)+"px",k.innerHTML=`${y}&nbsp;${_}`}const yn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},ku=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Iu(k){if(k){if(typeof k=="number"){const t=Math.round(Math.abs(k)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,k),"top-left":new l.P(t,t),"top-right":new l.P(-t,t),bottom:new l.P(0,-k),"bottom-left":new l.P(t,-t),"bottom-right":new l.P(-t,-t),left:new l.P(k,0),right:new l.P(-k,0)}}if(k instanceof l.P||Array.isArray(k)){const t=l.P.convert(k);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:l.P.convert(k.center||[0,0]),top:l.P.convert(k.top||[0,0]),"top-left":l.P.convert(k["top-left"]||[0,0]),"top-right":l.P.convert(k["top-right"]||[0,0]),bottom:l.P.convert(k.bottom||[0,0]),"bottom-left":l.P.convert(k["bottom-left"]||[0,0]),"bottom-right":l.P.convert(k["bottom-right"]||[0,0]),left:l.P.convert(k.left||[0,0]),right:l.P.convert(k.right||[0,0])}}return Iu(new l.P(0,0))}const qc=x;m.AJAXError=l.bh,m.Evented=l.E,m.LngLat=l.N,m.MercatorCoordinate=l.Z,m.Point=l.P,m.addProtocol=l.bi,m.config=l.a,m.removeProtocol=l.bj,m.AttributionControl=Ja,m.BoxZoomHandler=dr,m.CanvasSource=Ri,m.CooperativeGesturesHandler=$a,m.DoubleClickZoomHandler=ka,m.DragPanHandler=Uh,m.DragRotateHandler=jh,m.EdgeInsets=V,m.FullscreenControl=class extends l.E{constructor(k={}){super(),this._onFullscreenChange=()=>{var t;let f=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=f==null?void 0:f.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)f=f.shadowRoot.fullscreenElement;f===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,k&&k.container&&(k.container instanceof HTMLElement?this._container=k.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(k){return this._map=k,this._container||(this._container=this._map.getContainer()),this._controlContainer=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){N.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const k=this._fullscreenButton=N.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);N.create("span","maplibregl-ctrl-icon",k).setAttribute("aria-hidden","true"),k.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const k=this._getTitle();this._fullscreenButton.setAttribute("aria-label",k),this._fullscreenButton.title=k}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},m.GeoJSONSource=Mn,m.GeolocateControl=class extends l.E{constructor(k){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const f=new l.N(t.coords.longitude,t.coords.latitude),_=t.coords.accuracy,y=this._map.getBearing(),w=l.e({bearing:y},this.options.fitBoundsOptions),R=Ke.fromLngLat(f,_);this._map.fitBounds(R,w,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const f=new l.N(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Vl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=N.create("button","maplibregl-ctrl-geolocate",this._container),N.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}else{const f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new wu({element:this._dotElement}),this._circleElement=N.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new wu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",f=>{f.geolocateSource||this._watchState!=="ACTIVE_LOCK"||f.originalEvent&&f.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")),this.fire(new l.k("userlocationlostfocus")))})}},this.options=l.e({},Zh,k)}onAdd(k){return this._map=k,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return l._(this,arguments,void 0,function*(t=!1){if(Is!==void 0&&!t)return Is;if(window.navigator.permissions===void 0)return Is=!!window.navigator.geolocation,Is;try{Is=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Is=!!window.navigator.geolocation}return Is})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),N.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ql=0,Vl=!1}_isOutOfMapMaxBounds(k){const t=this._map.getMaxBounds(),f=k.coords;return t&&(f.longitude<t.getWest()||f.longitude>t.getEast()||f.latitude<t.getSouth()||f.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const k=this._map.getBounds(),t=k.getSouthEast(),f=k.getNorthEast(),_=t.distanceTo(f),y=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ql--,Vl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart")),this.fire(new l.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let k;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ql++,ql>1?(k={maximumAge:6e5,timeout:0},Vl=!0):(k=this.options.positionOptions,Vl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,k)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},m.Hash=$e,m.ImageSource=Qn,m.KeyboardHandler=Ds,m.LngLatBounds=Ke,m.LogoControl=Fc,m.Map=class extends qh{constructor(k){l.bf.mark(l.bg.create);const t=Object.assign(Object.assign({},ud),k);if(t.minZoom!=null&&t.maxZoom!=null&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(t.minPitch!=null&&t.maxPitch!=null&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(t.minPitch!=null&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(t.maxPitch!=null&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new pe(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),{bearingSnap:t.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Zn,this._controls=[],this._mapId=l.a4(),this._contextLost=f=>{f.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:f}))},this._contextRestored=f=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:f}))},this._onMapScroll=f=>{if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._maxTileCacheZoomLevels=t.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=t.preserveDrawingBuffer===!0,this._antialias=t.antialias===!0,this._trackResize=t.trackResize===!0,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles===!0,this._fadeDuration=t.fadeDuration,this._crossSourceCollisions=t.crossSourceCollisions===!0,this._collectResourceTiming=t.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Uc),t.locale),this._clickTolerance=t.clickTolerance,this._overridePixelRatio=t.pixelRatio,this._maxCanvasSize=t.maxCanvasSize,this.transformCameraUpdate=t.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=t.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Y.addThrottleControl(()=>this.isMoving()),this._requestManager=new _e(t.transformRequest),typeof t.container=="string"){if(this._container=document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(t.maxBounds&&this.setMaxBounds(t.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let f=!1;const _=Be(y=>{this._trackResize&&!this._removed&&(this.resize(y),this.redraw())},50);this._resizeObserver=new ResizeObserver(y=>{f?_(y):f=!0}),this._resizeObserver.observe(this._container)}this.handlers=new zc(this,t),this._hash=t.hash&&new $e(typeof t.hash=="string"&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,l.e({},t.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=t.localIdeographFontFamily,this._validateStyle=t.validateStyle,t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily}),t.attributionControl&&this.addControl(new Ja(typeof t.attributionControl=="boolean"?void 0:t.attributionControl)),t.maplibreLogo&&this.addControl(new Fc,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",f=>{this._update(f.dataType==="style"),this.fire(new l.k(`${f.dataType}data`,f))}),this.on("dataloading",f=>{this.fire(new l.k(`${f.dataType}dataloading`,f))}),this.on("dataabort",f=>{this.fire(new l.k("sourcedataabort",f))})}_getMapId(){return this._mapId}addControl(k,t){if(t===void 0&&(t=k.getDefaultPosition?k.getDefaultPosition():"top-right"),!k||!k.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=k.onAdd(this);this._controls.push(k);const _=this._controlPositions[t];return t.indexOf("bottom")!==-1?_.insertBefore(f,_.firstChild):_.appendChild(f),this}removeControl(k){if(!k||!k.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(k);return t>-1&&this._controls.splice(t,1),k.onRemove(this),this}hasControl(k){return this._controls.indexOf(k)>-1}calculateCameraOptionsFromTo(k,t,f,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(f,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(k,t,f,_)}resize(k){var t;const f=this._containerDimensions(),_=f[0],y=f[1],w=this._getClampedPixelRatio(_,y);if(this._resizeCanvas(_,y,w),this.painter.resize(_,y,w),this.painter.overLimit()){const D=this.painter.context.gl;this._maxCanvasSize=[D.drawingBufferWidth,D.drawingBufferHeight];const z=this._getClampedPixelRatio(_,y);this._resizeCanvas(_,y,z),this.painter.resize(_,y,z)}this.transform.resize(_,y),(t=this._requestedCameraState)===null||t===void 0||t.resize(_,y);const R=!this._moving;return R&&(this.stop(),this.fire(new l.k("movestart",k)).fire(new l.k("move",k))),this.fire(new l.k("resize",k)),R&&this.fire(new l.k("moveend",k)),this}_getClampedPixelRatio(k,t){const{0:f,1:_}=this._maxCanvasSize,y=this.getPixelRatio(),w=k*y,R=t*y;return Math.min(w>f?f/w:1,R>_?_/R:1)*y}getPixelRatio(){var k;return(k=this._overridePixelRatio)!==null&&k!==void 0?k:devicePixelRatio}setPixelRatio(k){this._overridePixelRatio=k,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(k){return this.transform.setMaxBounds(Ke.convert(k)),this._update()}setMinZoom(k){if((k=k??-2)>=-2&&k<=this.transform.maxZoom)return this.transform.minZoom=k,this._update(),this.getZoom()<k&&this.setZoom(k),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(k){if((k=k??22)>=this.transform.minZoom)return this.transform.maxZoom=k,this._update(),this.getZoom()>k&&this.setZoom(k),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(k){if((k=k??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(k>=0&&k<=this.transform.maxPitch)return this.transform.minPitch=k,this._update(),this.getPitch()<k&&this.setPitch(k),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(k){if((k=k??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(k>=this.transform.minPitch)return this.transform.maxPitch=k,this._update(),this.getPitch()>k&&this.setPitch(k),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(k){return this.transform.renderWorldCopies=k,this._update()}project(k){return this.transform.locationPoint(l.N.convert(k),this.style&&this.terrain)}unproject(k){return this.transform.pointLocation(l.P.convert(k),this.terrain)}isMoving(){var k;return this._moving||((k=this.handlers)===null||k===void 0?void 0:k.isMoving())}isZooming(){var k;return this._zooming||((k=this.handlers)===null||k===void 0?void 0:k.isZooming())}isRotating(){var k;return this._rotating||((k=this.handlers)===null||k===void 0?void 0:k.isRotating())}_createDelegatedListener(k,t,f){if(k==="mouseenter"||k==="mouseover"){let _=!1;return{layers:t,listener:f,delegates:{mousemove:w=>{const R=t.filter(z=>this.getLayer(z)),D=R.length!==0?this.queryRenderedFeatures(w.point,{layers:R}):[];D.length?_||(_=!0,f.call(this,new ui(k,this,w.originalEvent,{features:D}))):_=!1},mouseout:()=>{_=!1}}}}if(k==="mouseleave"||k==="mouseout"){let _=!1;return{layers:t,listener:f,delegates:{mousemove:R=>{const D=t.filter(z=>this.getLayer(z));(D.length!==0?this.queryRenderedFeatures(R.point,{layers:D}):[]).length?_=!0:_&&(_=!1,f.call(this,new ui(k,this,R.originalEvent)))},mouseout:R=>{_&&(_=!1,f.call(this,new ui(k,this,R.originalEvent)))}}}}{const _=y=>{const w=t.filter(D=>this.getLayer(D)),R=w.length!==0?this.queryRenderedFeatures(y.point,{layers:w}):[];R.length&&(y.features=R,f.call(this,y),delete y.features)};return{layers:t,listener:f,delegates:{[k]:_}}}}_saveDelegatedListener(k,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[k]=this._delegatedListeners[k]||[],this._delegatedListeners[k].push(t)}_removeDelegatedListener(k,t,f){if(!this._delegatedListeners||!this._delegatedListeners[k])return;const _=this._delegatedListeners[k];for(let y=0;y<_.length;y++){const w=_[y];if(w.listener===f&&w.layers.length===t.length&&w.layers.every(R=>t.includes(R))){for(const R in w.delegates)this.off(R,w.delegates[R]);return void _.splice(y,1)}}}on(k,t,f){if(f===void 0)return super.on(k,t);const _=this._createDelegatedListener(k,typeof t=="string"?[t]:t,f);this._saveDelegatedListener(k,_);for(const y in _.delegates)this.on(y,_.delegates[y]);return this}once(k,t,f){if(f===void 0)return super.once(k,t);const _=typeof t=="string"?[t]:t,y=this._createDelegatedListener(k,_,f);for(const w in y.delegates){const R=y.delegates[w];y.delegates[w]=(...D)=>{this._removeDelegatedListener(k,_,f),R(...D)}}this._saveDelegatedListener(k,y);for(const w in y.delegates)this.once(w,y.delegates[w]);return this}off(k,t,f){return f===void 0?super.off(k,t):(this._removeDelegatedListener(k,typeof t=="string"?[t]:t,f),this)}queryRenderedFeatures(k,t){if(!this.style)return[];let f;const _=k instanceof l.P||Array.isArray(k),y=_?k:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(_?{}:k)||{},y instanceof l.P||typeof y[0]=="number")f=[l.P.convert(y)];else{const w=l.P.convert(y[0]),R=l.P.convert(y[1]);f=[w,new l.P(R.x,w.y),R,new l.P(w.x,R.y),w]}return this.style.queryRenderedFeatures(f,t,this.transform)}querySourceFeatures(k,t){return this.style.querySourceFeatures(k,t)}setStyle(k,t){return(t=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&k?(this._diffStyle(k,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(k,t))}setTransformRequest(k){return this._requestManager.setTransformRequest(k),this}_getUIString(k){const t=this._locale[k];if(t==null)throw new Error(`Missing UI string '${k}'`);return t}_updateStyle(k,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(k,t));const f=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!k)),k?(this.style=new ca(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof k=="string"?this.style.loadURL(k,t,f):this.style.loadJSON(k,t,f),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ca(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(k,t){if(typeof k=="string"){const f=this._requestManager.transformRequest(k,"Style");l.h(f,new AbortController).then(_=>{this._updateDiff(_.data,t)}).catch(_=>{_&&this.fire(new l.j(_))})}else typeof k=="object"&&this._updateDiff(k,t)}_updateDiff(k,t){try{this.style.setState(k,t)&&this._update(!0)}catch(f){l.w(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(k,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(k,t){return this._lazyInitEmptyStyle(),this.style.addSource(k,t),this._update(!0)}isSourceLoaded(k){const t=this.style&&this.style.sourceCaches[k];if(t!==void 0)return t.loaded();this.fire(new l.j(new Error(`There is no source with ID '${k}'`)))}setTerrain(k){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),k){const t=this.style.sourceCaches[k.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${k.source}`);this.terrain===null&&t.reload();for(const f in this.style._layers){const _=this.style._layers[f];_.type==="hillshade"&&_.source===k.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Bc(this.painter,t,k),this.painter.renderToTexture=new Vh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=f=>{f.dataType==="style"?this.terrain.sourceCache.freeRtt():f.dataType==="source"&&f.tile&&(f.sourceId!==k.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(f.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:k})),this}getTerrain(){var k,t;return(t=(k=this.terrain)===null||k===void 0?void 0:k.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const k=this.style&&this.style.sourceCaches;for(const t in k){const f=k[t]._tiles;for(const _ in f){const y=f[_];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}removeSource(k){return this.style.removeSource(k),this._update(!0)}getSource(k){return this.style.getSource(k)}addImage(k,t,f={}){const{pixelRatio:_=1,sdf:y=!1,stretchX:w,stretchY:R,content:D,textFitWidth:z,textFitHeight:q}=f;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||l.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:H,height:X,data:ne}=t,me=t;return this.style.addImage(k,{data:new l.R({width:H,height:X},new Uint8Array(ne)),pixelRatio:_,stretchX:w,stretchY:R,content:D,textFitWidth:z,textFitHeight:q,sdf:y,version:0,userImage:me}),me.onAdd&&me.onAdd(this,k),this}}{const{width:H,height:X,data:ne}=C.getImageData(t);this.style.addImage(k,{data:new l.R({width:H,height:X},ne),pixelRatio:_,stretchX:w,stretchY:R,content:D,textFitWidth:z,textFitHeight:q,sdf:y,version:0})}}updateImage(k,t){const f=this.style.getImage(k);if(!f)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=t instanceof HTMLImageElement||l.b(t)?C.getImageData(t):t,{width:y,height:w,data:R}=_;if(y===void 0||w===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==f.data.width||w!==f.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const D=!(t instanceof HTMLImageElement||l.b(t));return f.data.replace(R,D),this.style.updateImage(k,f),this}getImage(k){return this.style.getImage(k)}hasImage(k){return k?!!this.style.getImage(k):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(k){this.style.removeImage(k)}loadImage(k){return Y.getImage(this._requestManager.transformRequest(k,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(k,t){return this._lazyInitEmptyStyle(),this.style.addLayer(k,t),this._update(!0)}moveLayer(k,t){return this.style.moveLayer(k,t),this._update(!0)}removeLayer(k){return this.style.removeLayer(k),this._update(!0)}getLayer(k){return this.style.getLayer(k)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(k,t,f){return this.style.setLayerZoomRange(k,t,f),this._update(!0)}setFilter(k,t,f={}){return this.style.setFilter(k,t,f),this._update(!0)}getFilter(k){return this.style.getFilter(k)}setPaintProperty(k,t,f,_={}){return this.style.setPaintProperty(k,t,f,_),this._update(!0)}getPaintProperty(k,t){return this.style.getPaintProperty(k,t)}setLayoutProperty(k,t,f,_={}){return this.style.setLayoutProperty(k,t,f,_),this._update(!0)}getLayoutProperty(k,t){return this.style.getLayoutProperty(k,t)}setGlyphs(k,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(k,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(k,t,f={}){return this._lazyInitEmptyStyle(),this.style.addSprite(k,t,f,_=>{_||this._update(!0)}),this}removeSprite(k){return this._lazyInitEmptyStyle(),this.style.removeSprite(k),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(k,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(k,t,f=>{f||this._update(!0)}),this}setLight(k,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(k,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(k){return this._lazyInitEmptyStyle(),this.style.setSky(k),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(k,t){return this.style.setFeatureState(k,t),this._update()}removeFeatureState(k,t){return this.style.removeFeatureState(k,t),this._update()}getFeatureState(k){return this.style.getFeatureState(k)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let k=0,t=0;return this._container&&(k=this._container.clientWidth||400,t=this._container.clientHeight||300),[k,t]}_setupContainer(){const k=this._container;k.classList.add("maplibregl-map");const t=this._canvasContainer=N.create("div","maplibregl-canvas-container",k);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=N.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const f=this._containerDimensions(),_=this._getClampedPixelRatio(f[0],f[1]);this._resizeCanvas(f[0],f[1],_);const y=this._controlContainer=N.create("div","maplibregl-control-container",k),w=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(R=>{w[R]=N.create("div",`maplibregl-ctrl-${R} `,y)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(k,t,f){this._canvas.width=Math.floor(f*k),this._canvas.height=Math.floor(f*t),this._canvas.style.width=`${k}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const k={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",_=>{t={requestedAttributes:k},_&&(t.statusMessage=_.statusMessage,t.type=_.type)},{once:!0});const f=this._canvas.getContext("webgl2",k)||this._canvas.getContext("webgl",k);if(!f){const _="Failed to initialize WebGL";throw t?(t.message=_,new Error(JSON.stringify(t))):new Error(_)}this.painter=new b(f,this.transform),B.testSupport(f)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(k){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||k,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(k){return this._update(),this._renderTaskQueue.add(k)}_cancelRenderFrame(k){this._renderTaskQueue.remove(k)}_render(k){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(k),this._removed)return;let f=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const y=this.transform.zoom,w=C.now();this.style.zoomHistory.update(y,w);const R=new l.z(y,{now:w,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),D=R.crossFadingFactor();D===1&&D===this._crossFadingFactor||(f=!0,this._crossFadingFactor=D),this.style.update(R)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bf.mark(l.bg.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||f)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const _=this._sourcesDirty||this._styleDirty||this._placementDirty;return _||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||_||(this._fullyLoaded=!0,l.bf.mark(l.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var k;this._hash&&this._hash.remove();for(const f of this._controls)f.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Y.removeThrottleControl(this._imageQueueHandle),(k=this._resizeObserver)===null||k===void 0||k.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t!=null&&t.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),N.remove(this._canvasContainer),N.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bf.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,C.frameAsync(this._frameRequest).then(k=>{l.bf.frame(k),this._frameRequest=null,this._render(k)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(k){this._showTileBoundaries!==k&&(this._showTileBoundaries=k,this._update())}get showPadding(){return!!this._showPadding}set showPadding(k){this._showPadding!==k&&(this._showPadding=k,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(k){this._showCollisionBoxes!==k&&(this._showCollisionBoxes=k,k?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(k){this._showOverdrawInspector!==k&&(this._showOverdrawInspector=k,this._update())}get repaint(){return!!this._repaint}set repaint(k){this._repaint!==k&&(this._repaint=k,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(k){this._vertices=k,this._update()}get version(){return Gh}getCameraTargetElevation(){return this.transform.elevation}},m.MapMouseEvent=ui,m.MapTouchEvent=er,m.MapWheelEvent=ss,m.Marker=wu,m.NavigationControl=class{constructor(k){this._updateZoomButtons=()=>{const t=this._map.getZoom(),f=t===this._map.getMaxZoom(),_=t===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,f)=>{const _=this._map._getUIString(`NavigationControl.${f}`);t.title=_,t.setAttribute("aria-label",_)},this.options=l.e({},cd,k),this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),N.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),N.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=N.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(k){return this._map=k,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new hd(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){N.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(k,t){const f=N.create("button",k,this._container);return f.type="button",f.addEventListener("click",t),f}},m.Popup=class extends l.E{constructor(k){super(),this.remove=()=>(this._content&&N.remove(this._content),this._container&&(N.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var f;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=N.create("div","maplibregl-popup",this._map.getContainer()),this._tip=N.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const D of this.options.className.split(" "))this._container.classList.add(D);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ei(this._lngLat,this._flatPos,this._map.transform):(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._trackPointer&&!t)return;const _=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationPoint(this._lngLat));let y=this.options.anchor;const w=Iu(this.options.offset);if(!y){const D=this._container.offsetWidth,z=this._container.offsetHeight;let q;q=_.y+w.bottom.y<z?["top"]:_.y>this._map.transform.height-z?["bottom"]:[],_.x<D/2?q.push("left"):_.x>this._map.transform.width-D/2&&q.push("right"),y=q.length===0?"bottom":q.join("-")}let R=_.add(w[y]);this.options.subpixelPositioning||(R=R.round()),N.setTransform(this._container,`${el[y]} translate(${R.x}px,${R.y}px)`),xu(this._container,y,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(yn),k)}addTo(k){return this._map&&this.remove(),this._map=k,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(k){return this._lngLat=l.N.convert(k),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(k){return this.setDOMContent(document.createTextNode(k))}setHTML(k){const t=document.createDocumentFragment(),f=document.createElement("body");let _;for(f.innerHTML=k;_=f.firstChild,_;)t.appendChild(_);return this.setDOMContent(t)}getMaxWidth(){var k;return(k=this._container)===null||k===void 0?void 0:k.style.maxWidth}setMaxWidth(k){return this.options.maxWidth=k,this._update(),this}setDOMContent(k){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=N.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(k),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(k){return this._container&&this._container.classList.add(k),this}removeClassName(k){return this._container&&this._container.classList.remove(k),this}setOffset(k){return this.options.offset=k,this._update(),this}toggleClassName(k){if(this._container)return this._container.classList.toggle(k)}setSubpixelPositioning(k){this.options.subpixelPositioning=k}_createCloseButton(){this.options.closeButton&&(this._closeButton=N.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const k=this._container.querySelector(ku);k&&k.focus()}},m.RasterDEMTileSource=Bt,m.RasterTileSource=Ie,m.ScaleControl=class{constructor(k){this._onMove=()=>{Gl(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Gl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},co),k)}getDefaultPosition(){return"bottom-left"}onAdd(k){return this._map=k,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-scale",k.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){N.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},m.ScrollZoomHandler=Zs,m.Style=ca,m.TerrainControl=class{constructor(k){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=k}onAdd(k){return this._map=k,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=N.create("button","maplibregl-ctrl-terrain",this._container),N.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){N.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},m.TwoFingersTouchPitchHandler=Ka,m.TwoFingersTouchRotateHandler=Pc,m.TwoFingersTouchZoomHandler=Mc,m.TwoFingersTouchZoomRotateHandler=Nc,m.VectorTileSource=bt,m.VideoSource=Jt,m.addSourceType=(k,t)=>l._(void 0,void 0,void 0,function*(){if(Jr(k))throw new Error(`A source type called "${k}" already exists.`);((f,_)=>{Yi[f]=_})(k,t)}),m.clearPrewarmedResources=function(){const k=Pn;k&&(k.isPreloaded()&&k.numActive()===1?(k.release(It),Pn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},m.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},m.getRTLTextPluginStatus=function(){return mn().getRTLTextPluginStatus()},m.getVersion=function(){return qc},m.getWorkerCount=function(){return $t.workerCount},m.getWorkerUrl=function(){return l.a.WORKER_URL},m.importScriptInWorkers=function(k){return Ot().broadcast("IS",k)},m.prewarm=function(){Wn().acquire(It)},m.setMaxParallelImageRequests=function(k){l.a.MAX_PARALLEL_IMAGE_REQUESTS=k},m.setRTLTextPlugin=function(k,t){return mn().setRTLTextPlugin(k,t)},m.setWorkerCount=function(k){$t.workerCount=k},m.setWorkerUrl=function(k){l.a.WORKER_URL=k}});var h=n;return h})})(iv);var fx=iv.exports;const Cs=hx(fx);var dx=Object.defineProperty,px=(r,e,n)=>e in r?dx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n,Vg=(r,e,n)=>px(r,typeof e!="symbol"?e+"":e,n);function Ch(){}function sv(r){return r()}function Gg(){return Object.create(null)}function nd(r){r.forEach(sv)}function ov(r){return typeof r=="function"}function mx(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}function gx(r){return Object.keys(r).length===0}function _x(r,e){r.appendChild(e)}function yx(r,e,n){r.insertBefore(e,n||null)}function av(r){r.parentNode&&r.parentNode.removeChild(r)}function Zg(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function dl(r,e,n){n==null?r.removeAttribute(e):r.getAttribute(e)!==n&&r.setAttribute(e,n)}function vx(r){return Array.from(r.childNodes)}function _f(r,e,n){r.classList.toggle(e,!!n)}let jp;function wh(r){jp=r}const Ku=[],Hg=[];let tc=[];const Xg=[],bx=Promise.resolve();let gp=!1;function xx(){gp||(gp=!0,bx.then(lv))}function _p(r){tc.push(r)}const ip=new Set;let Vu=0;function lv(){if(Vu!==0)return;const r=jp;do{try{for(;Vu<Ku.length;){const e=Ku[Vu];Vu++,wh(e),wx(e.$$)}}catch(e){throw Ku.length=0,Vu=0,e}for(wh(null),Ku.length=0,Vu=0;Hg.length;)Hg.pop()();for(let e=0;e<tc.length;e+=1){const n=tc[e];ip.has(n)||(ip.add(n),n())}tc.length=0}while(Ku.length);for(;Xg.length;)Xg.pop()();gp=!1,ip.clear(),wh(r)}function wx(r){if(r.fragment!==null){r.update(),nd(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(_p)}}function kx(r){const e=[],n=[];tc.forEach(s=>r.indexOf(s)===-1?e.push(s):n.push(s)),n.forEach(s=>s()),tc=e}const Ix=new Set;function Sx(r,e){r&&r.i&&(Ix.delete(r),r.i(e))}function Ex(r,e,n){const{fragment:s,after_update:a}=r.$$;s&&s.m(e,n),_p(()=>{const h=r.$$.on_mount.map(sv).filter(ov);r.$$.on_destroy?r.$$.on_destroy.push(...h):nd(h),r.$$.on_mount=[]}),a.forEach(_p)}function Ax(r,e){const n=r.$$;n.fragment!==null&&(kx(n.after_update),nd(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Tx(r,e){r.$$.dirty[0]===-1&&(Ku.push(r),xx(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Cx(r,e,n,s,a,h,m=null,l=[-1]){const x=jp;wh(r);const S=r.$$={fragment:null,ctx:[],props:h,update:Ch,not_equal:a,bound:Gg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(x?x.$$.context:[])),callbacks:Gg(),dirty:l,skip_bound:!1,root:e.target||x.$$.root};m&&m(S.root);let T=!1;if(S.ctx=n?n(r,e.props||{},(C,N,...B)=>{const U=B.length?B[0]:N;return S.ctx&&a(S.ctx[C],S.ctx[C]=U)&&(!S.skip_bound&&S.bound[C]&&S.bound[C](U),T&&Tx(r,C)),N}):[],S.update(),T=!0,nd(S.before_update),S.fragment=s?s(S.ctx):!1,e.target){if(e.hydrate){const C=vx(e.target);S.fragment&&S.fragment.l(C),C.forEach(av)}else S.fragment&&S.fragment.c();e.intro&&Sx(r.$$.fragment),Ex(r,e.target,e.anchor),lv()}wh(x)}class Lx{constructor(){Vg(this,"$$"),Vg(this,"$$set")}$destroy(){Ax(this,1),this.$destroy=Ch}$on(e,n){if(!ov(n))return Ch;const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(n),()=>{const a=s.indexOf(n);a!==-1&&s.splice(a,1)}}$set(e){this.$$set&&!gx(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Mx="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Mx);function Rx(r){let e,n,s;return{c(){e=Zg("svg"),n=Zg("path"),dl(n,"stroke-width","4"),dl(n,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),dl(n,"class","svelte-gzo3ar"),dl(e,"width",s=r[0]==="list"?20:void 0),dl(e,"viewBox","0 0 70 85"),dl(e,"fill","none"),dl(e,"class","svelte-gzo3ar"),_f(e,"in-map",r[0]!=="list"),_f(e,"list-icon",r[0]==="list")},m(a,h){yx(a,e,h),_x(e,n)},p(a,[h]){h&1&&s!==(s=a[0]==="list"?20:void 0)&&dl(e,"width",s),h&1&&_f(e,"in-map",a[0]!=="list"),h&1&&_f(e,"list-icon",a[0]==="list")},i:Ch,o:Ch,d(a){a&&av(e)}}}function Px(r,e,n){let{displayIn:s}=e;return r.$$set=a=>{"displayIn"in a&&n(0,s=a.displayIn)},[s]}class Dx extends Lx{constructor(e){super(),Cx(this,e,Px,Rx,mx,{displayIn:0})}}const Nx=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],zx={decimalLatitude:40.123,decimalLongitude:-74.123},Fx=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],Ox=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function Bx(){const r=[];return Nx.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...zx})}),[...r,...Fx,...Ox]}const Ux=Bx();Ux.map(r=>r.verbatimCoordinates);var Us=63710088e-1,uv={centimeters:Us*100,centimetres:Us*100,degrees:360/(2*Math.PI),feet:Us*3.28084,inches:Us*39.37,kilometers:Us/1e3,kilometres:Us/1e3,meters:Us,metres:Us,miles:Us/1609.344,millimeters:Us*1e3,millimetres:Us*1e3,nauticalmiles:Us/1852,radians:1,yards:Us*1.0936};function zh(r,e,n={}){const s={type:"Feature"};return(n.id===0||n.id)&&(s.id=n.id),n.bbox&&(s.bbox=n.bbox),s.properties=e||{},s.geometry=r,s}function jx(r,e,n={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Wg(r[0])||!Wg(r[1]))throw new Error("coordinates must contain numbers");return zh({type:"Point",coordinates:r},e,n)}function qp(r,e,n={}){for(const s of r){if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(s[s.length-1].length!==s[0].length)throw new Error("First and last Position are not equivalent.");for(let a=0;a<s[s.length-1].length;a++)if(s[s.length-1][a]!==s[0][a])throw new Error("First and last Position are not equivalent.")}return zh({type:"Polygon",coordinates:r},e,n)}function ru(r,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=r,n}function cv(r,e,n={}){return zh({type:"MultiPolygon",coordinates:r},e,n)}function qx(r,e="kilometers"){const n=uv[e];if(!n)throw new Error(e+" units is invalid");return r*n}function Vx(r,e="kilometers"){const n=uv[e];if(!n)throw new Error(e+" units is invalid");return r/n}function Wg(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Gx(r,e){var n={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},s,a,h,m;return m={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function l(S){return function(T){return x([S,T])}}function x(S){if(s)throw new TypeError("Generator is already executing.");for(;n;)try{if(s=1,a&&(h=S[0]&2?a.return:S[0]?a.throw||((h=a.return)&&h.call(a),0):a.next)&&!(h=h.call(a,S[1])).done)return h;switch(a=0,h&&(S=[S[0]&2,h.value]),S[0]){case 0:case 1:h=S;break;case 4:return n.label++,{value:S[1],done:!1};case 5:n.label++,a=S[1],S=[0];continue;case 7:S=n.ops.pop(),n.trys.pop();continue;default:if(h=n.trys,!(h=h.length>0&&h[h.length-1])&&(S[0]===6||S[0]===2)){n=0;continue}if(S[0]===3&&(!h||S[1]>h[0]&&S[1]<h[3])){n.label=S[1];break}if(S[0]===6&&n.label<h[1]){n.label=h[1],h=S;break}if(h&&n.label<h[2]){n.label=h[2],n.ops.push(S);break}h[2]&&n.ops.pop(),n.trys.pop();continue}S=e.call(r,n)}catch(T){S=[6,T],a=0}finally{s=h=0}if(S[0]&5)throw S[1];return{value:S[0]?S[1]:void 0,done:!0}}}var wl=function(){function r(e,n){this.next=null,this.key=e,this.data=n,this.left=null,this.right=null}return r}();function Zx(r,e){return r>e?1:r<e?-1:0}function gl(r,e,n){for(var s=new wl(null,null),a=s,h=s;;){var m=n(r,e.key);if(m<0){if(e.left===null)break;if(n(r,e.left.key)<0){var l=e.left;if(e.left=l.right,l.right=e,e=l,e.left===null)break}h.left=e,h=e,e=e.left}else if(m>0){if(e.right===null)break;if(n(r,e.right.key)>0){var l=e.right;if(e.right=l.left,l.left=e,e=l,e.right===null)break}a.right=e,a=e,e=e.right}else break}return a.right=e.left,h.left=e.right,e.left=s.right,e.right=s.left,e}function rp(r,e,n,s){var a=new wl(r,e);if(n===null)return a.left=a.right=null,a;n=gl(r,n,s);var h=s(r,n.key);return h<0?(a.left=n.left,a.right=n,n.left=null):h>=0&&(a.right=n.right,a.left=n,n.right=null),a}function Kg(r,e,n){var s=null,a=null;if(e){e=gl(r,e,n);var h=n(e.key,r);h===0?(s=e.left,a=e.right):h<0?(a=e.right,e.right=null,s=e):(s=e.left,e.left=null,a=e)}return{left:s,right:a}}function Hx(r,e,n){return e===null?r:(r===null||(e=gl(r.key,e,n),e.left=r),e)}function yp(r,e,n,s,a){if(r){s(""+e+(n?"└── ":"├── ")+a(r)+`
`);var h=e+(n?"    ":"│   ");r.left&&yp(r.left,h,!1,s,a),r.right&&yp(r.right,h,!0,s,a)}}var Vp=function(){function r(e){e===void 0&&(e=Zx),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,n){return this._size++,this._root=rp(e,n,this._root,this._comparator)},r.prototype.add=function(e,n){var s=new wl(e,n);this._root===null&&(s.left=s.right=null,this._size++,this._root=s);var a=this._comparator,h=gl(e,this._root,a),m=a(e,h.key);return m===0?this._root=h:(m<0?(s.left=h.left,s.right=h,h.left=null):m>0&&(s.right=h.right,s.left=h,h.right=null),this._size++,this._root=s),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,n,s){var a;if(n===null)return null;n=gl(e,n,s);var h=s(e,n.key);return h===0?(n.left===null?a=n.right:(a=gl(e,n.left,s),a.right=n.right),this._size--,a):n},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=gl(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var n=this._root,s=this._comparator;n;){var a=s(e,n.key);if(a===0)return n;a<0?n=n.left:n=n.right}return null},r.prototype.find=function(e){return this._root&&(this._root=gl(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var n=this._root,s=this._comparator;n;){var a=s(e,n.key);if(a===0)return!0;a<0?n=n.left:n=n.right}return!1},r.prototype.forEach=function(e,n){for(var s=this._root,a=[],h=!1;!h;)s!==null?(a.push(s),s=s.left):a.length!==0?(s=a.pop(),e.call(n,s),s=s.right):h=!0;return this},r.prototype.range=function(e,n,s,a){for(var h=[],m=this._comparator,l=this._root,x;h.length!==0||l;)if(l)h.push(l),l=l.left;else{if(l=h.pop(),x=m(l.key,n),x>0)break;if(m(l.key,e)>=0&&s.call(a,l))return this;l=l.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(n){var s=n.key;return e.push(s)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(n){var s=n.data;return e.push(s)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var n=this._root,s=!1,a=0,h=[];!s;)if(n)h.push(n),n=n.left;else if(h.length>0){if(n=h.pop(),a===e)return n;a++,n=n.right}else s=!0;return null},r.prototype.next=function(e){var n=this._root,s=null;if(e.right){for(s=e.right;s.left;)s=s.left;return s}for(var a=this._comparator;n;){var h=a(e.key,n.key);if(h===0)break;h<0?(s=n,n=n.left):n=n.right}return s},r.prototype.prev=function(e){var n=this._root,s=null;if(e.left!==null){for(s=e.left;s.right;)s=s.right;return s}for(var a=this._comparator;n;){var h=a(e.key,n.key);if(h===0)break;h<0?n=n.left:(s=n,n=n.right)}return s},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return Wx(this._root)},r.prototype.load=function(e,n,s){n===void 0&&(n=[]),s===void 0&&(s=!1);var a=e.length,h=this._comparator;if(s&&xp(e,n,0,a-1,h),this._root===null)this._root=vp(e,n,0,a),this._size=a;else{var m=Kx(this.toList(),Xx(e,n),h);a=this._size+a,this._root=bp({head:m},0,a)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(s){return String(s.key)});var n=[];return yp(this._root,"",!0,function(s){return n.push(s)},e),n.join("")},r.prototype.update=function(e,n,s){var a=this._comparator,h=Kg(e,this._root,a),m=h.left,l=h.right;a(e,n)<0?l=rp(n,s,l,a):m=rp(n,s,m,a),this._root=Hx(m,l,a)},r.prototype.split=function(e){return Kg(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,n,s;return Gx(this,function(a){switch(a.label){case 0:e=this._root,n=[],s=!1,a.label=1;case 1:return s?[3,6]:e===null?[3,2]:(n.push(e),e=e.left,[3,5]);case 2:return n.length===0?[3,4]:(e=n.pop(),[4,e]);case 3:return a.sent(),e=e.right,[3,5];case 4:s=!0,a.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function vp(r,e,n,s){var a=s-n;if(a>0){var h=n+Math.floor(a/2),m=r[h],l=e[h],x=new wl(m,l);return x.left=vp(r,e,n,h),x.right=vp(r,e,h+1,s),x}return null}function Xx(r,e){for(var n=new wl(null,null),s=n,a=0;a<r.length;a++)s=s.next=new wl(r[a],e[a]);return s.next=null,n.next}function Wx(r){for(var e=r,n=[],s=!1,a=new wl(null,null),h=a;!s;)e?(n.push(e),e=e.left):n.length>0?(e=h=h.next=n.pop(),e=e.right):s=!0;return h.next=null,a.next}function bp(r,e,n){var s=n-e;if(s>0){var a=e+Math.floor(s/2),h=bp(r,e,a),m=r.head;return m.left=h,r.head=r.head.next,m.right=bp(r,a+1,n),m}return null}function Kx(r,e,n){for(var s=new wl(null,null),a=s,h=r,m=e;h!==null&&m!==null;)n(h.key,m.key)<0?(a.next=h,h=h.next):(a.next=m,m=m.next),a=a.next;return h!==null?a.next=h:m!==null&&(a.next=m),s.next}function xp(r,e,n,s,a){if(!(n>=s)){for(var h=r[n+s>>1],m=n-1,l=s+1;;){do m++;while(a(r[m],h)<0);do l--;while(a(r[l],h)>0);if(m>=l)break;var x=r[m];r[m]=r[l],r[l]=x,x=e[m],e[m]=e[l],e[l]=x}xp(r,e,n,l,a),xp(r,e,l+1,s,a)}}const Na=11102230246251565e-32,fs=134217729,$x=(3+8*Na)*Na;function sp(r,e,n,s,a){let h,m,l,x,S=e[0],T=s[0],C=0,N=0;T>S==T>-S?(h=S,S=e[++C]):(h=T,T=s[++N]);let B=0;if(C<r&&N<n)for(T>S==T>-S?(m=S+h,l=h-(m-S),S=e[++C]):(m=T+h,l=h-(m-T),T=s[++N]),h=m,l!==0&&(a[B++]=l);C<r&&N<n;)T>S==T>-S?(m=h+S,x=m-h,l=h-(m-x)+(S-x),S=e[++C]):(m=h+T,x=m-h,l=h-(m-x)+(T-x),T=s[++N]),h=m,l!==0&&(a[B++]=l);for(;C<r;)m=h+S,x=m-h,l=h-(m-x)+(S-x),S=e[++C],h=m,l!==0&&(a[B++]=l);for(;N<n;)m=h+T,x=m-h,l=h-(m-x)+(T-x),T=s[++N],h=m,l!==0&&(a[B++]=l);return(h!==0||B===0)&&(a[B++]=h),B}function Yx(r,e){let n=e[0];for(let s=1;s<r;s++)n+=e[s];return n}function Fh(r){return new Float64Array(r)}const Jx=(3+16*Na)*Na,Qx=(2+12*Na)*Na,ew=(9+64*Na)*Na*Na,Gu=Fh(4),$g=Fh(8),Yg=Fh(12),Jg=Fh(16),Ts=Fh(4);function tw(r,e,n,s,a,h,m){let l,x,S,T,C,N,B,U,ee,ie,se,Q,Y,_e,ve,Ae,ce,xe;const be=r-a,Le=n-a,ke=e-h,ye=s-h;_e=be*ye,N=fs*be,B=N-(N-be),U=be-B,N=fs*ye,ee=N-(N-ye),ie=ye-ee,ve=U*ie-(_e-B*ee-U*ee-B*ie),Ae=ke*Le,N=fs*ke,B=N-(N-ke),U=ke-B,N=fs*Le,ee=N-(N-Le),ie=Le-ee,ce=U*ie-(Ae-B*ee-U*ee-B*ie),se=ve-ce,C=ve-se,Gu[0]=ve-(se+C)+(C-ce),Q=_e+se,C=Q-_e,Y=_e-(Q-C)+(se-C),se=Y-Ae,C=Y-se,Gu[1]=Y-(se+C)+(C-Ae),xe=Q+se,C=xe-Q,Gu[2]=Q-(xe-C)+(se-C),Gu[3]=xe;let Ue=Yx(4,Gu),qe=Qx*m;if(Ue>=qe||-Ue>=qe||(C=r-be,l=r-(be+C)+(C-a),C=n-Le,S=n-(Le+C)+(C-a),C=e-ke,x=e-(ke+C)+(C-h),C=s-ye,T=s-(ye+C)+(C-h),l===0&&x===0&&S===0&&T===0)||(qe=ew*m+$x*Math.abs(Ue),Ue+=be*T+ye*l-(ke*S+Le*x),Ue>=qe||-Ue>=qe))return Ue;_e=l*ye,N=fs*l,B=N-(N-l),U=l-B,N=fs*ye,ee=N-(N-ye),ie=ye-ee,ve=U*ie-(_e-B*ee-U*ee-B*ie),Ae=x*Le,N=fs*x,B=N-(N-x),U=x-B,N=fs*Le,ee=N-(N-Le),ie=Le-ee,ce=U*ie-(Ae-B*ee-U*ee-B*ie),se=ve-ce,C=ve-se,Ts[0]=ve-(se+C)+(C-ce),Q=_e+se,C=Q-_e,Y=_e-(Q-C)+(se-C),se=Y-Ae,C=Y-se,Ts[1]=Y-(se+C)+(C-Ae),xe=Q+se,C=xe-Q,Ts[2]=Q-(xe-C)+(se-C),Ts[3]=xe;const pt=sp(4,Gu,4,Ts,$g);_e=be*T,N=fs*be,B=N-(N-be),U=be-B,N=fs*T,ee=N-(N-T),ie=T-ee,ve=U*ie-(_e-B*ee-U*ee-B*ie),Ae=ke*S,N=fs*ke,B=N-(N-ke),U=ke-B,N=fs*S,ee=N-(N-S),ie=S-ee,ce=U*ie-(Ae-B*ee-U*ee-B*ie),se=ve-ce,C=ve-se,Ts[0]=ve-(se+C)+(C-ce),Q=_e+se,C=Q-_e,Y=_e-(Q-C)+(se-C),se=Y-Ae,C=Y-se,Ts[1]=Y-(se+C)+(C-Ae),xe=Q+se,C=xe-Q,Ts[2]=Q-(xe-C)+(se-C),Ts[3]=xe;const St=sp(pt,$g,4,Ts,Yg);_e=l*T,N=fs*l,B=N-(N-l),U=l-B,N=fs*T,ee=N-(N-T),ie=T-ee,ve=U*ie-(_e-B*ee-U*ee-B*ie),Ae=x*S,N=fs*x,B=N-(N-x),U=x-B,N=fs*S,ee=N-(N-S),ie=S-ee,ce=U*ie-(Ae-B*ee-U*ee-B*ie),se=ve-ce,C=ve-se,Ts[0]=ve-(se+C)+(C-ce),Q=_e+se,C=Q-_e,Y=_e-(Q-C)+(se-C),se=Y-Ae,C=Y-se,Ts[1]=Y-(se+C)+(C-Ae),xe=Q+se,C=xe-Q,Ts[2]=Q-(xe-C)+(se-C),Ts[3]=xe;const dt=sp(St,Yg,4,Ts,Jg);return Jg[dt-1]}function nw(r,e,n,s,a,h){const m=(e-h)*(n-a),l=(r-a)*(s-h),x=m-l,S=Math.abs(m+l);return Math.abs(x)>=Jx*S?x:-tw(r,e,n,s,a,h,S)}const uh=(r,e)=>r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y,wp=(r,e)=>{if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;const n=r.ll.x<e.ll.x?e.ll.x:r.ll.x,s=r.ur.x<e.ur.x?r.ur.x:e.ur.x,a=r.ll.y<e.ll.y?e.ll.y:r.ll.y,h=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:n,y:a},ur:{x:s,y:h}}};let vl=Number.EPSILON;vl===void 0&&(vl=Math.pow(2,-52));const iw=vl*vl,Qg=(r,e)=>{if(-vl<r&&r<vl&&-vl<e&&e<vl)return 0;const n=r-e;return n*n<iw*r*e?0:r<e?-1:1};class rw{constructor(){this.reset()}reset(){this.xRounder=new e_,this.yRounder=new e_}round(e,n){return{x:this.xRounder.round(e),y:this.yRounder.round(n)}}}class e_{constructor(){this.tree=new Vp,this.round(0)}round(e){const n=this.tree.add(e),s=this.tree.prev(n);if(s!==null&&Qg(n.key,s.key)===0)return this.tree.remove(e),s.key;const a=this.tree.next(n);return a!==null&&Qg(n.key,a.key)===0?(this.tree.remove(e),a.key):e}}const Lh=new rw,Tf=(r,e)=>r.x*e.y-r.y*e.x,hv=(r,e)=>r.x*e.x+r.y*e.y,t_=(r,e,n)=>{const s=nw(r.x,r.y,e.x,e.y,n.x,n.y);return s>0?-1:s<0?1:0},zf=r=>Math.sqrt(hv(r,r)),sw=(r,e,n)=>{const s={x:e.x-r.x,y:e.y-r.y},a={x:n.x-r.x,y:n.y-r.y};return Tf(a,s)/zf(a)/zf(s)},ow=(r,e,n)=>{const s={x:e.x-r.x,y:e.y-r.y},a={x:n.x-r.x,y:n.y-r.y};return hv(a,s)/zf(a)/zf(s)},n_=(r,e,n)=>e.y===0?null:{x:r.x+e.x/e.y*(n-r.y),y:n},i_=(r,e,n)=>e.x===0?null:{x:n,y:r.y+e.y/e.x*(n-r.x)},aw=(r,e,n,s)=>{if(e.x===0)return i_(n,s,r.x);if(s.x===0)return i_(r,e,n.x);if(e.y===0)return n_(n,s,r.y);if(s.y===0)return n_(r,e,n.y);const a=Tf(e,s);if(a==0)return null;const h={x:n.x-r.x,y:n.y-r.y},m=Tf(h,e)/a,l=Tf(h,s)/a,x=r.x+l*e.x,S=n.x+m*s.x,T=r.y+l*e.y,C=n.y+m*s.y,N=(x+S)/2,B=(T+C)/2;return{x:N,y:B}};class yo{static compare(e,n){const s=yo.comparePoints(e.point,n.point);return s!==0?s:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:xl.compare(e.segment,n.segment))}static comparePoints(e,n){return e.x<n.x?-1:e.x>n.x?1:e.y<n.y?-1:e.y>n.y?1:0}constructor(e,n){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const n=e.point.events;for(let s=0,a=n.length;s<a;s++){const h=n[s];this.point.events.push(h),h.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let n=0;n<e;n++){const s=this.point.events[n];if(s.segment.consumedBy===void 0)for(let a=n+1;a<e;a++){const h=this.point.events[a];h.consumedBy===void 0&&s.otherSE.point.events===h.otherSE.point.events&&s.segment.consume(h.segment)}}}getAvailableLinkedEvents(){const e=[];for(let n=0,s=this.point.events.length;n<s;n++){const a=this.point.events[n];a!==this&&!a.segment.ringOut&&a.segment.isInResult()&&e.push(a)}return e}getLeftmostComparator(e){const n=new Map,s=a=>{const h=a.otherSE;n.set(a,{sine:sw(this.point,e.point,h.point),cosine:ow(this.point,e.point,h.point)})};return(a,h)=>{n.has(a)||s(a),n.has(h)||s(h);const{sine:m,cosine:l}=n.get(a),{sine:x,cosine:S}=n.get(h);return m>=0&&x>=0?l<S?1:l>S?-1:0:m<0&&x<0?l<S?-1:l>S?1:0:x<m?-1:x>m?1:0}}}let lw=0;class xl{static compare(e,n){const s=e.leftSE.point.x,a=n.leftSE.point.x,h=e.rightSE.point.x,m=n.rightSE.point.x;if(m<s)return 1;if(h<a)return-1;const l=e.leftSE.point.y,x=n.leftSE.point.y,S=e.rightSE.point.y,T=n.rightSE.point.y;if(s<a){if(x<l&&x<S)return 1;if(x>l&&x>S)return-1;const C=e.comparePoint(n.leftSE.point);if(C<0)return 1;if(C>0)return-1;const N=n.comparePoint(e.rightSE.point);return N!==0?N:-1}if(s>a){if(l<x&&l<T)return-1;if(l>x&&l>T)return 1;const C=n.comparePoint(e.leftSE.point);if(C!==0)return C;const N=e.comparePoint(n.rightSE.point);return N<0?1:N>0?-1:1}if(l<x)return-1;if(l>x)return 1;if(h<m){const C=n.comparePoint(e.rightSE.point);if(C!==0)return C}if(h>m){const C=e.comparePoint(n.rightSE.point);if(C<0)return 1;if(C>0)return-1}if(h!==m){const C=S-l,N=h-s,B=T-x,U=m-a;if(C>N&&B<U)return 1;if(C<N&&B>U)return-1}return h>m?1:h<m||S<T?-1:S>T?1:e.id<n.id?-1:e.id>n.id?1:0}constructor(e,n,s,a){this.id=++lw,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=s,this.windings=a}static fromRing(e,n,s){let a,h,m;const l=yo.comparePoints(e,n);if(l<0)a=e,h=n,m=1;else if(l>0)a=n,h=e,m=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const x=new yo(a,!0),S=new yo(h,!1);return new xl(x,S,[s],[m])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<n?e:n},ur:{x:this.rightSE.point.x,y:e>n?e:n}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const n=this.leftSE.point,s=this.rightSE.point,a=this.vector();if(n.x===s.x)return e.x===n.x?0:e.x<n.x?1:-1;const h=(e.y-n.y)/a.y,m=n.x+h*a.x;if(e.x===m)return 0;const l=(e.x-n.x)/a.x,x=n.y+l*a.y;return e.y===x?0:e.y<x?-1:1}getIntersection(e){const n=this.bbox(),s=e.bbox(),a=wp(n,s);if(a===null)return null;const h=this.leftSE.point,m=this.rightSE.point,l=e.leftSE.point,x=e.rightSE.point,S=uh(n,l)&&this.comparePoint(l)===0,T=uh(s,h)&&e.comparePoint(h)===0,C=uh(n,x)&&this.comparePoint(x)===0,N=uh(s,m)&&e.comparePoint(m)===0;if(T&&S)return N&&!C?m:!N&&C?x:null;if(T)return C&&h.x===x.x&&h.y===x.y?null:h;if(S)return N&&m.x===l.x&&m.y===l.y?null:l;if(N&&C)return null;if(N)return m;if(C)return x;const B=aw(h,this.vector(),l,e.vector());return B===null||!uh(a,B)?null:Lh.round(B.x,B.y)}split(e){const n=[],s=e.events!==void 0,a=new yo(e,!0),h=new yo(e,!1),m=this.rightSE;this.replaceRightSE(h),n.push(h),n.push(a);const l=new xl(a,m,this.rings.slice(),this.windings.slice());return yo.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),yo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),s&&(a.checkForConsuming(),h.checkForConsuming()),n}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let n=0,s=this.windings.length;n<s;n++)this.windings[n]*=-1}consume(e){let n=this,s=e;for(;n.consumedBy;)n=n.consumedBy;for(;s.consumedBy;)s=s.consumedBy;const a=xl.compare(n,s);if(a!==0){if(a>0){const h=n;n=s,s=h}if(n.prev===s){const h=n;n=s,s=h}for(let h=0,m=s.rings.length;h<m;h++){const l=s.rings[h],x=s.windings[h],S=n.rings.indexOf(l);S===-1?(n.rings.push(l),n.windings.push(x)):n.windings[S]+=x}s.rings=null,s.windings=null,s.consumedBy=n,s.leftSE.consumedBy=n.leftSE,s.rightSE.consumedBy=n.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const n=this._afterState.rings,s=this._afterState.windings,a=this._afterState.multiPolys;for(let l=0,x=this.rings.length;l<x;l++){const S=this.rings[l],T=this.windings[l],C=n.indexOf(S);C===-1?(n.push(S),s.push(T)):s[C]+=T}const h=[],m=[];for(let l=0,x=n.length;l<x;l++){if(s[l]===0)continue;const S=n[l],T=S.poly;if(m.indexOf(T)===-1)if(S.isExterior)h.push(T);else{m.indexOf(T)===-1&&m.push(T);const C=h.indexOf(S.poly);C!==-1&&h.splice(C,1)}}for(let l=0,x=h.length;l<x;l++){const S=h[l].multiPoly;a.indexOf(S)===-1&&a.push(S)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Po.type){case"union":{const s=e.length===0,a=n.length===0;this._isInResult=s!==a;break}case"intersection":{let s,a;e.length<n.length?(s=e.length,a=n.length):(s=n.length,a=e.length),this._isInResult=a===Po.numMultiPolys&&s<a;break}case"xor":{const s=Math.abs(e.length-n.length);this._isInResult=s%2===1;break}case"difference":{const s=a=>a.length===1&&a[0].isSubject;this._isInResult=s(e)!==s(n);break}default:throw new Error(`Unrecognized operation type found ${Po.type}`)}return this._isInResult}}class r_{constructor(e,n,s){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=s,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const a=Lh.round(e[0][0],e[0][1]);this.bbox={ll:{x:a.x,y:a.y},ur:{x:a.x,y:a.y}};let h=a;for(let m=1,l=e.length;m<l;m++){if(typeof e[m][0]!="number"||typeof e[m][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let x=Lh.round(e[m][0],e[m][1]);x.x===h.x&&x.y===h.y||(this.segments.push(xl.fromRing(h,x,this)),x.x<this.bbox.ll.x&&(this.bbox.ll.x=x.x),x.y<this.bbox.ll.y&&(this.bbox.ll.y=x.y),x.x>this.bbox.ur.x&&(this.bbox.ur.x=x.x),x.y>this.bbox.ur.y&&(this.bbox.ur.y=x.y),h=x)}(a.x!==h.x||a.y!==h.y)&&this.segments.push(xl.fromRing(h,a,this))}getSweepEvents(){const e=[];for(let n=0,s=this.segments.length;n<s;n++){const a=this.segments[n];e.push(a.leftSE),e.push(a.rightSE)}return e}}class uw{constructor(e,n){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new r_(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let s=1,a=e.length;s<a;s++){const h=new r_(e[s],this,!1);h.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=h.bbox.ll.x),h.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=h.bbox.ll.y),h.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=h.bbox.ur.x),h.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=h.bbox.ur.y),this.interiorRings.push(h)}this.multiPoly=n}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let n=0,s=this.interiorRings.length;n<s;n++){const a=this.interiorRings[n].getSweepEvents();for(let h=0,m=a.length;h<m;h++)e.push(a[h])}return e}}class s_{constructor(e,n){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let s=0,a=e.length;s<a;s++){const h=new uw(e[s],this);h.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=h.bbox.ll.x),h.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=h.bbox.ll.y),h.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=h.bbox.ur.x),h.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=h.bbox.ur.y),this.polys.push(h)}this.isSubject=n}getSweepEvents(){const e=[];for(let n=0,s=this.polys.length;n<s;n++){const a=this.polys[n].getSweepEvents();for(let h=0,m=a.length;h<m;h++)e.push(a[h])}return e}}class Ff{static factory(e){const n=[];for(let s=0,a=e.length;s<a;s++){const h=e[s];if(!h.isInResult()||h.ringOut)continue;let m=null,l=h.leftSE,x=h.rightSE;const S=[l],T=l.point,C=[];for(;m=l,l=x,S.push(l),l.point!==T;)for(;;){const N=l.getAvailableLinkedEvents();if(N.length===0){const ee=S[0].point,ie=S[S.length-1].point;throw new Error(`Unable to complete output ring starting at [${ee.x}, ${ee.y}]. Last matching segment found ends at [${ie.x}, ${ie.y}].`)}if(N.length===1){x=N[0].otherSE;break}let B=null;for(let ee=0,ie=C.length;ee<ie;ee++)if(C[ee].point===l.point){B=ee;break}if(B!==null){const ee=C.splice(B)[0],ie=S.splice(ee.index);ie.unshift(ie[0].otherSE),n.push(new Ff(ie.reverse()));continue}C.push({index:S.length,point:l.point});const U=l.getLeftmostComparator(m);x=N.sort(U)[0].otherSE;break}n.push(new Ff(S))}return n}constructor(e){this.events=e;for(let n=0,s=e.length;n<s;n++)e[n].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const n=[e];for(let S=1,T=this.events.length-1;S<T;S++){const C=this.events[S].point,N=this.events[S+1].point;t_(C,e,N)!==0&&(n.push(C),e=C)}if(n.length===1)return null;const s=n[0],a=n[1];t_(s,e,a)===0&&n.shift(),n.push(n[0]);const h=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:n.length-1,l=this.isExteriorRing()?n.length:-1,x=[];for(let S=m;S!=l;S+=h)x.push([n[S].x,n[S].y]);return x}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let a=1,h=this.events.length;a<h;a++){const m=this.events[a];yo.compare(e,m)>0&&(e=m)}let n=e.segment.prevInResult(),s=n?n.prevInResult():null;for(;;){if(!n)return null;if(!s)return n.ringOut;if(s.ringOut!==n.ringOut)return s.ringOut.enclosingRing()!==n.ringOut?n.ringOut:n.ringOut.enclosingRing();n=s.prevInResult(),s=n?n.prevInResult():null}}}class o_{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let n=0,s=this.interiorRings.length;n<s;n++){const a=this.interiorRings[n].getGeom();a!==null&&e.push(a)}return e}}let cw=class{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let n=0,s=this.polys.length;n<s;n++){const a=this.polys[n].getGeom();a!==null&&e.push(a)}return e}_composePolys(e){const n=[];for(let s=0,a=e.length;s<a;s++){const h=e[s];if(!h.poly)if(h.isExteriorRing())n.push(new o_(h));else{const m=h.enclosingRing();m.poly||n.push(new o_(m)),m.poly.addInterior(h)}}return n}};class hw{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:xl.compare;this.queue=e,this.tree=new Vp(n),this.segments=[]}process(e){const n=e.segment,s=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(n),s;const a=e.isLeft?this.tree.add(n):this.tree.find(n);if(!a)throw new Error(`Unable to find segment #${n.id} [${n.leftSE.point.x}, ${n.leftSE.point.y}] -> [${n.rightSE.point.x}, ${n.rightSE.point.y}] in SweepLine tree.`);let h=a,m=a,l,x;for(;l===void 0;)h=this.tree.prev(h),h===null?l=null:h.key.consumedBy===void 0&&(l=h.key);for(;x===void 0;)m=this.tree.next(m),m===null?x=null:m.key.consumedBy===void 0&&(x=m.key);if(e.isLeft){let S=null;if(l){const C=l.getIntersection(n);if(C!==null&&(n.isAnEndpoint(C)||(S=C),!l.isAnEndpoint(C))){const N=this._splitSafely(l,C);for(let B=0,U=N.length;B<U;B++)s.push(N[B])}}let T=null;if(x){const C=x.getIntersection(n);if(C!==null&&(n.isAnEndpoint(C)||(T=C),!x.isAnEndpoint(C))){const N=this._splitSafely(x,C);for(let B=0,U=N.length;B<U;B++)s.push(N[B])}}if(S!==null||T!==null){let C=null;S===null?C=T:T===null?C=S:C=yo.comparePoints(S,T)<=0?S:T,this.queue.remove(n.rightSE),s.push(n.rightSE);const N=n.split(C);for(let B=0,U=N.length;B<U;B++)s.push(N[B])}s.length>0?(this.tree.remove(n),s.push(e)):(this.segments.push(n),n.prev=l)}else{if(l&&x){const S=l.getIntersection(x);if(S!==null){if(!l.isAnEndpoint(S)){const T=this._splitSafely(l,S);for(let C=0,N=T.length;C<N;C++)s.push(T[C])}if(!x.isAnEndpoint(S)){const T=this._splitSafely(x,S);for(let C=0,N=T.length;C<N;C++)s.push(T[C])}}}this.tree.remove(n)}return s}_splitSafely(e,n){this.tree.remove(e);const s=e.rightSE;this.queue.remove(s);const a=e.split(n);return a.push(s),e.consumedBy===void 0&&this.tree.add(e),a}}const a_=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,fw=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class dw{run(e,n,s){Po.type=e,Lh.reset();const a=[new s_(n,!0)];for(let T=0,C=s.length;T<C;T++)a.push(new s_(s[T],!1));if(Po.numMultiPolys=a.length,Po.type==="difference"){const T=a[0];let C=1;for(;C<a.length;)wp(a[C].bbox,T.bbox)!==null?C++:a.splice(C,1)}if(Po.type==="intersection")for(let T=0,C=a.length;T<C;T++){const N=a[T];for(let B=T+1,U=a.length;B<U;B++)if(wp(N.bbox,a[B].bbox)===null)return[]}const h=new Vp(yo.compare);for(let T=0,C=a.length;T<C;T++){const N=a[T].getSweepEvents();for(let B=0,U=N.length;B<U;B++)if(h.insert(N[B]),h.size>a_)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const m=new hw(h);let l=h.size,x=h.pop();for(;x;){const T=x.key;if(h.size===l){const N=T.segment;throw new Error(`Unable to pop() ${T.isLeft?"left":"right"} SweepEvent [${T.point.x}, ${T.point.y}] from segment #${N.id} [${N.leftSE.point.x}, ${N.leftSE.point.y}] -> [${N.rightSE.point.x}, ${N.rightSE.point.y}] from queue.`)}if(h.size>a_)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(m.segments.length>fw)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const C=m.process(T);for(let N=0,B=C.length;N<B;N++){const U=C[N];U.consumedBy===void 0&&h.insert(U)}l=h.size,x=h.pop()}Lh.reset();const S=Ff.factory(m.segments);return new cw(S).getGeom()}}const Po=new dw,pw=function(r){for(var e=arguments.length,n=new Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];return Po.run("union",r,n)},mw=function(r){for(var e=arguments.length,n=new Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];return Po.run("intersection",r,n)},gw=function(r){for(var e=arguments.length,n=new Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];return Po.run("xor",r,n)},_w=function(r){for(var e=arguments.length,n=new Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];return Po.run("difference",r,n)};var fv={union:pw,intersection:mw,xor:gw,difference:_w};function dv(r,e,n){if(r!==null)for(var s,a,h,m,l,x,S,T=0,C=0,N,B=r.type,U=B==="FeatureCollection",ee=B==="Feature",ie=U?r.features.length:1,se=0;se<ie;se++){S=U?r.features[se].geometry:ee?r.geometry:r,N=S?S.type==="GeometryCollection":!1,l=N?S.geometries.length:1;for(var Q=0;Q<l;Q++){var Y=0,_e=0;if(m=N?S.geometries[Q]:S,m!==null){x=m.coordinates;var ve=m.type;switch(T=0,ve){case null:break;case"Point":if(e(x,C,se,Y,_e)===!1)return!1;C++,Y++;break;case"LineString":case"MultiPoint":for(s=0;s<x.length;s++){if(e(x[s],C,se,Y,_e)===!1)return!1;C++,ve==="MultiPoint"&&Y++}ve==="LineString"&&Y++;break;case"Polygon":case"MultiLineString":for(s=0;s<x.length;s++){for(a=0;a<x[s].length-T;a++){if(e(x[s][a],C,se,Y,_e)===!1)return!1;C++}ve==="MultiLineString"&&Y++,ve==="Polygon"&&_e++}ve==="Polygon"&&Y++;break;case"MultiPolygon":for(s=0;s<x.length;s++){for(_e=0,a=0;a<x[s].length;a++){for(h=0;h<x[s][a].length-T;h++){if(e(x[s][a][h],C,se,Y,_e)===!1)return!1;C++}_e++}Y++}break;case"GeometryCollection":for(s=0;s<m.geometries.length;s++)if(dv(m.geometries[s],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function l_(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var n=0;n<r.features.length&&e(r.features[n],n)!==!1;n++);}function id(r,e){var n,s,a,h,m,l,x,S,T,C,N=0,B=r.type==="FeatureCollection",U=r.type==="Feature",ee=B?r.features.length:1;for(n=0;n<ee;n++){for(l=B?r.features[n].geometry:U?r.geometry:r,S=B?r.features[n].properties:U?r.properties:{},T=B?r.features[n].bbox:U?r.bbox:void 0,C=B?r.features[n].id:U?r.id:void 0,x=l?l.type==="GeometryCollection":!1,m=x?l.geometries.length:1,a=0;a<m;a++){if(h=x?l.geometries[a]:l,h===null){if(e(null,N,S,T,C)===!1)return!1;continue}switch(h.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(h,N,S,T,C)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<h.geometries.length;s++)if(e(h.geometries[s],N,S,T,C)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}N++}}function yw(r,e={}){const n=[];if(id(r,a=>{n.push(a.coordinates)}),n.length<2)throw new Error("Must have at least 2 geometries");const s=fv.union(n[0],...n.slice(1));return s.length===0?null:s.length===1?qp(s[0],e.properties):cv(s,e.properties)}var vw=yw;function bw(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const n=[1/0,1/0,-1/0,-1/0];return dv(r,s=>{n[0]>s[0]&&(n[0]=s[0]),n[1]>s[1]&&(n[1]=s[1]),n[2]<s[0]&&(n[2]=s[0]),n[3]<s[1]&&(n[3]=s[1])}),n}function xw(r,e={}){const n=bw(r),s=(n[0]+n[2])/2,a=(n[1]+n[3])/2;return jx([s,a],e.properties,e)}var ww=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function kw(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var pv={exports:{}};(function(r,e){(function(n,s){r.exports=s()})(ww,function(){function n(I,c){if(!(I instanceof c))throw new TypeError("Cannot call a class as a function")}function s(I,c){for(var d=0;d<c.length;d++){var p=c[d];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(I,p.key,p)}}function a(I,c,d){return c&&s(I.prototype,c),d&&s(I,d),I}function h(I,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");I.prototype=Object.create(c&&c.prototype,{constructor:{value:I,writable:!0,configurable:!0}}),c&&l(I,c)}function m(I){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(c){return c.__proto__||Object.getPrototypeOf(c)},m(I)}function l(I,c){return l=Object.setPrototypeOf||function(d,p){return d.__proto__=p,d},l(I,c)}function x(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function S(I,c,d){return S=x()?Reflect.construct:function(p,b,L){var O=[null];O.push.apply(O,b);var V=new(Function.bind.apply(p,O));return L&&l(V,L.prototype),V},S.apply(null,arguments)}function T(I){var c=typeof Map=="function"?new Map:void 0;return T=function(d){if(d===null||(p=d,Function.toString.call(p).indexOf("[native code]")===-1))return d;var p;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(c!==void 0){if(c.has(d))return c.get(d);c.set(d,b)}function b(){return S(d,arguments,m(this).constructor)}return b.prototype=Object.create(d.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),l(b,d)},T(I)}function C(I){if(I===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I}function N(I,c){if(c&&(typeof c=="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return C(I)}function B(I){var c=x();return function(){var d,p=m(I);if(c){var b=m(this).constructor;d=Reflect.construct(p,arguments,b)}else d=p.apply(this,arguments);return N(this,d)}}function U(I,c,d){return U=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(p,b,L){var O=function(K,pe){for(;!Object.prototype.hasOwnProperty.call(K,pe)&&(K=m(K))!==null;);return K}(p,b);if(O){var V=Object.getOwnPropertyDescriptor(O,b);return V.get?V.get.call(L):V.value}},U(I,c,d||I)}function ee(I){return function(c){if(Array.isArray(c))return se(c)}(I)||function(c){if(typeof Symbol<"u"&&c[Symbol.iterator]!=null||c["@@iterator"]!=null)return Array.from(c)}(I)||ie(I)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function ie(I,c){if(I){if(typeof I=="string")return se(I,c);var d=Object.prototype.toString.call(I).slice(8,-1);return d==="Object"&&I.constructor&&(d=I.constructor.name),d==="Map"||d==="Set"?Array.from(I):d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d)?se(I,c):void 0}}function se(I,c){(c==null||c>I.length)&&(c=I.length);for(var d=0,p=new Array(c);d<c;d++)p[d]=I[d];return p}function Q(I,c){var d=typeof Symbol<"u"&&I[Symbol.iterator]||I["@@iterator"];if(!d){if(Array.isArray(I)||(d=ie(I))||c){d&&(I=d);var p=0,b=function(){};return{s:b,n:function(){return p>=I.length?{done:!0}:{done:!1,value:I[p++]}},e:function(K){throw K},f:b}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var L,O=!0,V=!1;return{s:function(){d=d.call(I)},n:function(){var K=d.next();return O=K.done,K},e:function(K){V=!0,L=K},f:function(){try{O||d.return==null||d.return()}finally{if(V)throw L}}}}var Y=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(c){this._quadrantSegments=c,this._quadrantSegments===0&&(this._joinStyle=I.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=I.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),c<=0&&(this._quadrantSegments=1),this._joinStyle!==I.JOIN_ROUND&&(this._quadrantSegments=I.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(c){this._joinStyle=c}},{key:"setSimplifyFactor",value:function(c){this._simplifyFactor=c<0?0:c}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(c){this._endCapStyle=c}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(c){this._mitreLimit=c}},{key:"setSingleSided",value:function(c){this._isSingleSided=c}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=I.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=I.CAP_ROUND,this._joinStyle=I.JOIN_ROUND,this._mitreLimit=I.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=I.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var c=arguments[0];this.setQuadrantSegments(c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.setQuadrantSegments(d),this.setEndCapStyle(p)}else if(arguments.length===4){var b=arguments[0],L=arguments[1],O=arguments[2],V=arguments[3];this.setQuadrantSegments(b),this.setEndCapStyle(L),this.setJoinStyle(O),this.setMitreLimit(V)}}}},{key:"bufferDistanceError",value:function(c){var d=Math.PI/2/c;return 1-Math.cos(d/2)}}]),I}();Y.CAP_ROUND=1,Y.CAP_FLAT=2,Y.CAP_SQUARE=3,Y.JOIN_ROUND=1,Y.JOIN_MITRE=2,Y.JOIN_BEVEL=3,Y.DEFAULT_QUADRANT_SEGMENTS=8,Y.DEFAULT_MITRE_LIMIT=5,Y.DEFAULT_SIMPLIFY_FACTOR=.01;var _e=function(I){h(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({Exception:d})[0],b}return a(d,[{key:"toString",value:function(){return this.message}}]),d}(T(Error)),ve=function(I){h(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({IllegalArgumentException:d})[0],b}return d}(_e),Ae=function(){function I(){n(this,I)}return a(I,[{key:"filter",value:function(c){}}]),I}();function ce(){}function xe(){}function be(){}var Le,ke,ye,Ue,qe,pt,St,dt,ut=function(){function I(){n(this,I)}return a(I,null,[{key:"equalsWithTolerance",value:function(c,d,p){return Math.abs(c-d)<=p}}]),I}(),Ut=function(){function I(c,d){n(this,I),this.low=d||0,this.high=c||0}return a(I,null,[{key:"toBinaryString",value:function(c){var d,p="";for(d=2147483648;d>0;d>>>=1)p+=(c.high&d)===d?"1":"0";for(d=2147483648;d>0;d>>>=1)p+=(c.low&d)===d?"1":"0";return p}}]),I}();function vt(){}function kt(){}vt.NaN=NaN,vt.isNaN=function(I){return Number.isNaN(I)},vt.isInfinite=function(I){return!Number.isFinite(I)},vt.MAX_VALUE=Number.MAX_VALUE,vt.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,vt.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(pt=2146435072,St=new Float64Array(1),dt=new Int32Array(St.buffer),vt.doubleToLongBits=function(I){St[0]=I;var c=0|dt[0],d=0|dt[1];return(d&pt)===pt&&1048575&d&&c!==0&&(c=0,d=2146959360),new Ut(d,c)},vt.longBitsToDouble=function(I){return dt[0]=I.low,dt[1]=I.high,St[0]}):(Le=1023,ke=Math.log2,ye=Math.floor,Ue=Math.pow,qe=function(){for(var I=53;I>0;I--){var c=Ue(2,I)-1;if(ye(ke(c))+1===I)return c}return 0}(),vt.doubleToLongBits=function(I){var c,d,p,b,L,O,V,K,pe;if(I<0||1/I===Number.NEGATIVE_INFINITY?(O=1<<31,I=-I):O=0,I===0)return new Ut(K=O,pe=0);if(I===1/0)return new Ut(K=2146435072|O,pe=0);if(I!=I)return new Ut(K=2146959360,pe=0);if(b=0,pe=0,(c=ye(I))>1)if(c<=qe)(b=ye(ke(c)))<=20?(pe=0,K=c<<20-b&1048575):(pe=c%(d=Ue(2,p=b-20))<<32-p,K=c/d&1048575);else for(p=c,pe=0;(p=ye(d=p/2))!==0;)b++,pe>>>=1,pe|=(1&K)<<31,K>>>=1,d!==p&&(K|=524288);if(V=b+Le,L=c===0,c=I-c,b<52&&c!==0)for(p=0;;){if((d=2*c)>=1?(c=d-1,L?(V--,L=!1):(p<<=1,p|=1,b++)):(c=d,L?--V==0&&(b++,L=!1):(p<<=1,b++)),b===20)K|=p,p=0;else if(b===52){pe|=p;break}if(d===1){b<20?K|=p<<20-b:b<52&&(pe|=p<<52-b);break}}return K|=V<<20,new Ut(K|=O,pe)},vt.longBitsToDouble=function(I){var c,d,p,b,L=I.high,O=I.low,V=L&1<<31?-1:1;for(p=((2146435072&L)>>20)-Le,b=0,d=1<<19,c=1;c<=20;c++)L&d&&(b+=Ue(2,-c)),d>>>=1;for(d=1<<31,c=21;c<=52;c++)O&d&&(b+=Ue(2,-c)),d>>>=1;if(p===-1023){if(b===0)return 0*V;p=-1022}else{if(p===1024)return b===0?V/0:NaN;b+=1}return V*b*Ue(2,p)});var ft=function(I){h(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({RuntimeException:d})[0],b}return d}(_e),wt=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,null,[{key:"constructor_",value:function(){if(arguments.length===0)ft.constructor_.call(this);else if(arguments.length===1){var p=arguments[0];ft.constructor_.call(this,p)}}}]),d}(ft),It=function(){function I(){n(this,I)}return a(I,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)I.shouldNeverReachHere(null);else if(arguments.length===1){var c=arguments[0];throw new wt("Should never reach here"+(c!==null?": "+c:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var c=arguments[0];I.isTrue(c,null)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];if(!d)throw p===null?new wt:new wt(p)}}},{key:"equals",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];I.equals(c,d,null)}else if(arguments.length===3){var p=arguments[0],b=arguments[1],L=arguments[2];if(!b.equals(p))throw new wt("Expected "+p+" but encountered "+b+(L!==null?": "+L:""))}}}]),I}(),$t=new ArrayBuffer(8),pn=new Float64Array($t),Pn=new Int32Array($t),We=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getM",value:function(){return vt.NaN}},{key:"setOrdinate",value:function(c,d){switch(c){case I.X:this.x=d;break;case I.Y:this.y=d;break;case I.Z:this.setZ(d);break;default:throw new ve("Invalid ordinate index: "+c)}}},{key:"equals2D",value:function(){if(arguments.length===1){var c=arguments[0];return this.x===c.x&&this.y===c.y}if(arguments.length===2){var d=arguments[0],p=arguments[1];return!!ut.equalsWithTolerance(this.x,d.x,p)&&!!ut.equalsWithTolerance(this.y,d.y,p)}}},{key:"setM",value:function(c){throw new ve("Invalid ordinate index: "+I.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(c){switch(c){case I.X:return this.x;case I.Y:return this.y;case I.Z:return this.getZ()}throw new ve("Invalid ordinate index: "+c)}},{key:"equals3D",value:function(c){return this.x===c.x&&this.y===c.y&&(this.getZ()===c.getZ()||vt.isNaN(this.getZ())&&vt.isNaN(c.getZ()))}},{key:"equals",value:function(c){return c instanceof I&&this.equals2D(c)}},{key:"equalInZ",value:function(c,d){return ut.equalsWithTolerance(this.getZ(),c.getZ(),d)}},{key:"setX",value:function(c){this.x=c}},{key:"compareTo",value:function(c){var d=c;return this.x<d.x?-1:this.x>d.x?1:this.y<d.y?-1:this.y>d.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(c){this.z=c}},{key:"clone",value:function(){try{return null}catch(c){if(c instanceof CloneNotSupportedException)return It.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw c}}},{key:"copy",value:function(){return new I(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(c){var d=this.x-c.x,p=this.y-c.y,b=this.getZ()-c.getZ();return Math.sqrt(d*d+p*p+b*b)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(c){this.y=c}},{key:"distance",value:function(c){var d=this.x-c.x,p=this.y-c.y;return Math.sqrt(d*d+p*p)}},{key:"hashCode",value:function(){var c=17;return c=37*(c=37*c+I.hashCode(this.x))+I.hashCode(this.y)}},{key:"setCoordinate",value:function(c){this.x=c.x,this.y=c.y,this.z=c.getZ()}},{key:"interfaces_",get:function(){return[ce,xe,be]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)I.constructor_.call(this,0,0);else if(arguments.length===1){var c=arguments[0];I.constructor_.call(this,c.x,c.y,c.getZ())}else if(arguments.length===2){var d=arguments[0],p=arguments[1];I.constructor_.call(this,d,p,I.NULL_ORDINATE)}else if(arguments.length===3){var b=arguments[0],L=arguments[1],O=arguments[2];this.x=b,this.y=L,this.z=O}}},{key:"hashCode",value:function(c){return pn[0]=c,Pn[0]^Pn[1]}}]),I}(),Wn=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compare",value:function(c,d){var p=I.compare(c.x,d.x);if(p!==0)return p;var b=I.compare(c.y,d.y);return b!==0?b:this._dimensionsToTest<=2?0:I.compare(c.getZ(),d.getZ())}},{key:"interfaces_",get:function(){return[kt]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)I.constructor_.call(this,2);else if(arguments.length===1){var c=arguments[0];if(c!==2&&c!==3)throw new ve("only 2 or 3 dimensions may be specified");this._dimensionsToTest=c}}},{key:"compare",value:function(c,d){return c<d?-1:c>d?1:vt.isNaN(c)?vt.isNaN(d)?0:-1:vt.isNaN(d)?1:0}}]),I}();We.DimensionalComparator=Wn,We.NULL_ORDINATE=vt.NaN,We.X=0,We.Y=1,We.Z=2,We.M=3;var dn=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(c){if(!(c instanceof I))return!1;var d=c;return this.isNull()?d.isNull():this._maxx===d.getMaxX()&&this._maxy===d.getMaxY()&&this._minx===d.getMinX()&&this._miny===d.getMinY()}},{key:"intersection",value:function(c){if(this.isNull()||c.isNull()||!this.intersects(c))return new I;var d=this._minx>c._minx?this._minx:c._minx,p=this._miny>c._miny?this._miny:c._miny;return new I(d,this._maxx<c._maxx?this._maxx:c._maxx,p,this._maxy<c._maxy?this._maxy:c._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof We){var c=arguments[0];return this.covers(c.x,c.y)}if(arguments[0]instanceof I){var d=arguments[0];return!this.isNull()&&!d.isNull()&&d.getMinX()>=this._minx&&d.getMaxX()<=this._maxx&&d.getMinY()>=this._miny&&d.getMaxY()<=this._maxy}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];return!this.isNull()&&p>=this._minx&&p<=this._maxx&&b>=this._miny&&b<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return!this.isNull()&&!c.isNull()&&!(c._minx>this._maxx||c._maxx<this._minx||c._miny>this._maxy||c._maxy<this._miny)}if(arguments[0]instanceof We){var d=arguments[0];return this.intersects(d.x,d.y)}}else if(arguments.length===2){if(arguments[0]instanceof We&&arguments[1]instanceof We){var p=arguments[0],b=arguments[1];if(this.isNull())return!1;var L=p.x<b.x?p.x:b.x;if(L>this._maxx)return!1;var O=p.x>b.x?p.x:b.x;if(O<this._minx)return!1;var V=p.y<b.y?p.y:b.y;if(V>this._maxy)return!1;var K=p.y>b.y?p.y:b.y;return!(K<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var pe=arguments[0],Be=arguments[1];return!this.isNull()&&!(pe>this._maxx||pe<this._minx||Be>this._maxy||Be<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var c=this.getWidth(),d=this.getHeight();return Math.sqrt(c*c+d*d)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof We){var c=arguments[0];this.expandToInclude(c.x,c.y)}else if(arguments[0]instanceof I){var d=arguments[0];if(d.isNull())return null;this.isNull()?(this._minx=d.getMinX(),this._maxx=d.getMaxX(),this._miny=d.getMinY(),this._maxy=d.getMaxY()):(d._minx<this._minx&&(this._minx=d._minx),d._maxx>this._maxx&&(this._maxx=d._maxx),d._miny<this._miny&&(this._miny=d._miny),d._maxy>this._maxy&&(this._maxy=d._maxy))}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.isNull()?(this._minx=p,this._maxx=p,this._miny=b,this._maxy=b):(p<this._minx&&(this._minx=p),p>this._maxx&&(this._maxx=p),b<this._miny&&(this._miny=b),b>this._maxy&&(this._maxy=b))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var c=this.getWidth(),d=this.getHeight();return c<d?c:d}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(c){var d=c;return this.isNull()?d.isNull()?0:-1:d.isNull()?1:this._minx<d._minx?-1:this._minx>d._minx?1:this._miny<d._miny?-1:this._miny>d._miny?1:this._maxx<d._maxx?-1:this._maxx>d._maxx?1:this._maxy<d._maxy?-1:this._maxy>d._maxy?1:0}},{key:"translate",value:function(c,d){if(this.isNull())return null;this.init(this.getMinX()+c,this.getMaxX()+c,this.getMinY()+d,this.getMaxY()+d)}},{key:"copy",value:function(){return new I(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(c){return!(!this.isNull()&&!c.isNull())||c._minx>this._maxx||c._maxx<this._minx||c._miny>this._maxy||c._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var c=this.getWidth(),d=this.getHeight();return c>d?c:d}},{key:"expandBy",value:function(){if(arguments.length===1){var c=arguments[0];this.expandBy(c,c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];if(this.isNull())return null;this._minx-=d,this._maxx+=d,this._miny-=p,this._maxy+=p,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.covers(c)}if(arguments[0]instanceof We){var d=arguments[0];return this.covers(d)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];return this.covers(p,b)}}},{key:"centre",value:function(){return this.isNull()?null:new We((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof We){var c=arguments[0];this.init(c.x,c.x,c.y,c.y)}else if(arguments[0]instanceof I){var d=arguments[0];this._minx=d._minx,this._maxx=d._maxx,this._miny=d._miny,this._maxy=d._maxy}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.init(p.x,b.x,p.y,b.y)}else if(arguments.length===4){var L=arguments[0],O=arguments[1],V=arguments[2],K=arguments[3];L<O?(this._minx=L,this._maxx=O):(this._minx=O,this._maxx=L),V<K?(this._miny=V,this._maxy=K):(this._miny=K,this._maxy=V)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(c){if(this.intersects(c))return 0;var d=0;this._maxx<c._minx?d=c._minx-this._maxx:this._minx>c._maxx&&(d=this._minx-c._maxx);var p=0;return this._maxy<c._miny?p=c._miny-this._maxy:this._miny>c._maxy&&(p=this._miny-c._maxy),d===0?p:p===0?d:Math.sqrt(d*d+p*p)}},{key:"hashCode",value:function(){var c=17;return c=37*(c=37*(c=37*(c=37*c+We.hashCode(this._minx))+We.hashCode(this._maxx))+We.hashCode(this._miny))+We.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[ce,be]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof We){var c=arguments[0];this.init(c.x,c.x,c.y,c.y)}else if(arguments[0]instanceof I){var d=arguments[0];this.init(d)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.init(p.x,b.x,p.y,b.y)}else if(arguments.length===4){var L=arguments[0],O=arguments[1],V=arguments[2],K=arguments[3];this.init(L,O,V,K)}}},{key:"intersects",value:function(){if(arguments.length===3){var c=arguments[0],d=arguments[1],p=arguments[2];return p.x>=(c.x<d.x?c.x:d.x)&&p.x<=(c.x>d.x?c.x:d.x)&&p.y>=(c.y<d.y?c.y:d.y)&&p.y<=(c.y>d.y?c.y:d.y)}if(arguments.length===4){var b=arguments[0],L=arguments[1],O=arguments[2],V=arguments[3],K=Math.min(O.x,V.x),pe=Math.max(O.x,V.x),Be=Math.min(b.x,L.x),$e=Math.max(b.x,L.x);return!(Be>pe)&&!($e<K)&&(K=Math.min(O.y,V.y),pe=Math.max(O.y,V.y),Be=Math.min(b.y,L.y),$e=Math.max(b.y,L.y),!(Be>pe)&&!($e<K))}}}]),I}(),Ot=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===I.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(c){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(c){return this===c||this.equalsExact(c,0)}},{key:"geometryChanged",value:function(){this.apply(I.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(c){return c!==null&&this.norm().equalsExact(c.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var c;if(arguments.length===1){var d=arguments[0];return c=d,this.getTypeCode()!==c.getTypeCode()?this.getTypeCode()-c.getTypeCode():this.isEmpty()&&c.isEmpty()?0:this.isEmpty()?-1:c.isEmpty()?1:this.compareToSameClass(d)}if(arguments.length===2){var p=arguments[0],b=arguments[1];return c=p,this.getTypeCode()!==c.getTypeCode()?this.getTypeCode()-c.getTypeCode():this.isEmpty()&&c.isEmpty()?0:this.isEmpty()?-1:c.isEmpty()?1:this.compareToSameClass(p,b)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(c){if(c.getTypeCode()===I.TYPECODE_GEOMETRYCOLLECTION)throw new ve("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(c,d,p){return p===0?c.equals(d):c.distance(d)<=p}},{key:"norm",value:function(){var c=this.copy();return c.normalize(),c}},{key:"reverse",value:function(){var c=this.reverseInternal();return this.envelope!=null&&(c.envelope=this.envelope.copy()),c.setSRID(this.getSRID()),c}},{key:"copy",value:function(){var c=this.copyInternal();return c.envelope=this._envelope==null?null:this._envelope.copy(),c._SRID=this._SRID,c._userData=this._userData,c}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new dn(this._envelope)}},{key:"setSRID",value:function(c){this._SRID=c}},{key:"setUserData",value:function(c){this._userData=c}},{key:"compare",value:function(c,d){for(var p=c.iterator(),b=d.iterator();p.hasNext()&&b.hasNext();){var L=p.next(),O=b.next(),V=L.compareTo(O);if(V!==0)return V}return p.hasNext()?1:b.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(c){return this.getClass()===c.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===I.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===I.TYPECODE_MULTIPOINT||this.getTypeCode()===I.TYPECODE_MULTILINESTRING||this.getTypeCode()===I.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[xe,ce,be]}},{key:"getClass",value:function(){return I}}],[{key:"hasNonEmptyElements",value:function(c){for(var d=0;d<c.length;d++)if(!c[d].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(c){for(var d=0;d<c.length;d++)if(c[d]===null)return!0;return!1}}]),I}();Ot.constructor_=function(I){I&&(this._envelope=null,this._userData=null,this._factory=I,this._SRID=I.getSRID())},Ot.TYPECODE_POINT=0,Ot.TYPECODE_MULTIPOINT=1,Ot.TYPECODE_LINESTRING=2,Ot.TYPECODE_LINEARRING=3,Ot.TYPECODE_MULTILINESTRING=4,Ot.TYPECODE_POLYGON=5,Ot.TYPECODE_MULTIPOLYGON=6,Ot.TYPECODE_GEOMETRYCOLLECTION=7,Ot.TYPENAME_POINT="Point",Ot.TYPENAME_MULTIPOINT="MultiPoint",Ot.TYPENAME_LINESTRING="LineString",Ot.TYPENAME_LINEARRING="LinearRing",Ot.TYPENAME_MULTILINESTRING="MultiLineString",Ot.TYPENAME_POLYGON="Polygon",Ot.TYPENAME_MULTIPOLYGON="MultiPolygon",Ot.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",Ot.geometryChangedFilter={get interfaces_(){return[Ae]},filter:function(I){I.geometryChangedAction()}};var Ee=function(){function I(){n(this,I)}return a(I,null,[{key:"toLocationSymbol",value:function(c){switch(c){case I.EXTERIOR:return"e";case I.BOUNDARY:return"b";case I.INTERIOR:return"i";case I.NONE:return"-"}throw new ve("Unknown location value: "+c)}}]),I}();Ee.INTERIOR=0,Ee.BOUNDARY=1,Ee.EXTERIOR=2,Ee.NONE=-1;var lt=function(){function I(){n(this,I)}return a(I,[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}]),I}(),Ye=function(I){h(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({NoSuchElementException:d})[0],b}return d}(_e),Lt=function(I){h(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({UnsupportedOperationException:d})[0],b}return d}(_e),Ke=function(I){h(d,I);var c=B(d);function d(){return n(this,d),c.apply(this,arguments)}return a(d,[{key:"contains",value:function(){}}]),d}(lt),On=function(I,c){h(p,I);var d=B(p);function p(b){var L;return n(this,p),(L=d.call(this)).map=new Map,b instanceof lt&&L.addAll(b),L}return a(p,[{key:"contains",value:function(b){var L=b.hashCode?b.hashCode():b;return!!this.map.has(L)}},{key:"add",value:function(b){var L=b.hashCode?b.hashCode():b;return!this.map.has(L)&&!!this.map.set(L,b)}},{key:"addAll",value:function(b){var L,O=Q(b);try{for(O.s();!(L=O.n()).done;){var V=L.value;this.add(V)}}catch(K){O.e(K)}finally{O.f()}return!0}},{key:"remove",value:function(){throw new Lt}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new bt(this.map)}},{key:c,value:function(){return this.map}}]),p}(Ke,Symbol.iterator),bt=function(){function I(c){n(this,I),this.iterator=c.values();var d=this.iterator.next(),p=d.done,b=d.value;this.done=p,this.value=b}return a(I,[{key:"next",value:function(){if(this.done)throw new Ye;var c=this.value,d=this.iterator.next(),p=d.done,b=d.value;return this.done=p,this.value=b,c}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new Lt}}]),I}(),Ie=function(){function I(){n(this,I)}return a(I,null,[{key:"opposite",value:function(c){return c===I.LEFT?I.RIGHT:c===I.RIGHT?I.LEFT:c}}]),I}();Ie.ON=0,Ie.LEFT=1,Ie.RIGHT=2;var Bt=function(I){h(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({EmptyStackException:d})[0],b}return d}(_e),Mn=function(I){h(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({IndexOutOfBoundsException:d})[0],b}return d}(_e),Nn=function(I){h(d,I);var c=B(d);function d(){return n(this,d),c.apply(this,arguments)}return a(d,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}]),d}(lt),Qn=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),(p=c.call(this)).array=[],p}return a(d,[{key:"add",value:function(p){return this.array.push(p),!0}},{key:"get",value:function(p){if(p<0||p>=this.size())throw new Mn;return this.array[p]}},{key:"push",value:function(p){return this.array.push(p),p}},{key:"pop",value:function(){if(this.array.length===0)throw new Bt;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new Bt;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(p){return this.array.indexOf(p)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}]),d}(Nn);function Jt(I,c){return I.interfaces_&&I.interfaces_.indexOf(c)>-1}var Ri=function(){function I(c){n(this,I),this.str=c}return a(I,[{key:"append",value:function(c){this.str+=c}},{key:"setCharAt",value:function(c,d){this.str=this.str.substr(0,c)+d+this.str.substr(c+1)}},{key:"toString",value:function(){return this.str}}]),I}(),Yi=function(){function I(c){n(this,I),this.value=c}return a(I,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(c){return this.value<c?-1:this.value>c?1:0}}],[{key:"compare",value:function(c,d){return c<d?-1:c>d?1:0}},{key:"isNan",value:function(c){return Number.isNaN(c)}},{key:"valueOf",value:function(c){return new I(c)}}]),I}(),Jr=function(){function I(){n(this,I)}return a(I,null,[{key:"isWhitespace",value:function(c){return c<=32&&c>=0||c===127}},{key:"toUpperCase",value:function(c){return c.toUpperCase()}}]),I}(),ct=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"le",value:function(c){return this._hi<c._hi||this._hi===c._hi&&this._lo<=c._lo}},{key:"extractSignificantDigits",value:function(c,d){var p=this.abs(),b=I.magnitude(p._hi),L=I.TEN.pow(b);(p=p.divide(L)).gt(I.TEN)?(p=p.divide(I.TEN),b+=1):p.lt(I.ONE)&&(p=p.multiply(I.TEN),b-=1);for(var O=b+1,V=new Ri,K=I.MAX_PRINT_DIGITS-1,pe=0;pe<=K;pe++){c&&pe===O&&V.append(".");var Be=Math.trunc(p._hi);if(Be<0)break;var $e=!1,mt=0;Be>9?($e=!0,mt="9"):mt="0"+Be,V.append(mt),p=p.subtract(I.valueOf(Be)).multiply(I.TEN),$e&&p.selfAdd(I.TEN);var Ft=!0,Nt=I.magnitude(p._hi);if(Nt<0&&Math.abs(Nt)>=K-pe&&(Ft=!1),!Ft)break}return d[0]=b,V.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return this.add(c.negate())}if(typeof arguments[0]=="number"){var d=arguments[0];return this.add(-d)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof I){var c=arguments[0];return this._hi===c._hi&&this._lo===c._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return this.isNaN()?this:this.selfAdd(-c._hi,-c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.isNaN()?this:this.selfAdd(-d,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(c){return this.le(c)?this:c}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.selfDivide(c._hi,c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.selfDivide(d,0)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1],L=null,O=null,V=null,K=null,pe=null,Be=null,$e=null,mt=null;return pe=this._hi/p,mt=(L=(Be=I.SPLIT*pe)-(L=Be-pe))*(V=(mt=I.SPLIT*p)-(V=mt-p))-($e=pe*p)+L*(K=p-V)+(O=pe-L)*V+O*K,mt=pe+(Be=(this._hi-$e-mt+this._lo-pe*b)/p),this._hi=mt,this._lo=pe-mt+Be,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof I){var c=arguments[0],d=null,p=null,b=null,L=null,O=null,V=null,K=null,pe=null;p=(O=this._hi/c._hi)-(d=(V=I.SPLIT*O)-(d=V-O)),pe=d*(b=(pe=I.SPLIT*c._hi)-(b=pe-c._hi))-(K=O*c._hi)+d*(L=c._hi-b)+p*b+p*L;var Be=pe=O+(V=(this._hi-K-pe+this._lo-O*c._lo)/c._hi),$e=O-pe+V;return new I(Be,$e)}if(typeof arguments[0]=="number"){var mt=arguments[0];return vt.isNaN(mt)?I.createNaN():I.copy(this).selfDivide(mt,0)}}},{key:"ge",value:function(c){return this._hi>c._hi||this._hi===c._hi&&this._lo>=c._lo}},{key:"pow",value:function(c){if(c===0)return I.valueOf(1);var d=new I(this),p=I.valueOf(1),b=Math.abs(c);if(b>1)for(;b>0;)b%2==1&&p.selfMultiply(d),(b/=2)>0&&(d=d.sqr());else p=d;return c<0?p.reciprocal():p}},{key:"ceil",value:function(){if(this.isNaN())return I.NaN;var c=Math.ceil(this._hi),d=0;return c===this._hi&&(d=Math.ceil(this._lo)),new I(c,d)}},{key:"compareTo",value:function(c){var d=c;return this._hi<d._hi?-1:this._hi>d._hi?1:this._lo<d._lo?-1:this._lo>d._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return this.init(c),this}if(typeof arguments[0]=="number"){var d=arguments[0];return this.init(d),this}}},{key:"max",value:function(c){return this.ge(c)?this:c}},{key:"sqrt",value:function(){if(this.isZero())return I.valueOf(0);if(this.isNegative())return I.NaN;var c=1/Math.sqrt(this._hi),d=this._hi*c,p=I.valueOf(d),b=this.subtract(p.sqr())._hi*(.5*c);return p.add(b)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.selfAdd(c._hi,c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0],p=null,b=null,L=null,O=null,V=null,K=null;return O=(L=this._hi+d)-(V=L-this._hi),b=(K=(O=d-V+(this._hi-O))+this._lo)+(L-(p=L+K)),this._hi=p+b,this._lo=b+(p-this._hi),this}}else if(arguments.length===2){var pe=arguments[0],Be=arguments[1],$e=null,mt=null,Ft=null,Nt=null,gn=null,vn=null,Ln=null;Nt=this._hi+pe,mt=this._lo+Be,gn=Nt-(vn=Nt-this._hi),Ft=mt-(Ln=mt-this._lo);var ni=($e=Nt+(vn=(gn=pe-vn+(this._hi-gn))+mt))+(vn=(Ft=Be-Ln+(this._lo-Ft))+(vn+(Nt-$e))),gi=vn+($e-ni);return this._hi=ni,this._lo=gi,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.selfMultiply(c._hi,c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.selfMultiply(d,0)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1],L=null,O=null,V=null,K=null,pe=null,Be=null;L=(pe=I.SPLIT*this._hi)-this._hi,Be=I.SPLIT*p,L=pe-L,O=this._hi-L,V=Be-p;var $e=(pe=this._hi*p)+(Be=L*(V=Be-V)-pe+L*(K=p-V)+O*V+O*K+(this._hi*b+this._lo*p)),mt=Be+(L=pe-$e);return this._hi=$e,this._lo=mt,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return I.NaN;var c=Math.floor(this._hi),d=0;return c===this._hi&&(d=Math.floor(this._lo)),new I(c,d)}},{key:"negate",value:function(){return this.isNaN()?this:new I(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(c){if(c instanceof CloneNotSupportedException)return null;throw c}}},{key:"multiply",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return c.isNaN()?I.createNaN():I.copy(this).selfMultiply(c)}if(typeof arguments[0]=="number"){var d=arguments[0];return vt.isNaN(d)?I.createNaN():I.copy(this).selfMultiply(d,0)}}},{key:"isNaN",value:function(){return vt.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var c=I.magnitude(this._hi);return c>=-3&&c<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var c=this.getSpecialNumberString();if(c!==null)return c;var d=new Array(1).fill(null),p=this.extractSignificantDigits(!0,d),b=d[0]+1,L=p;if(p.charAt(0)===".")L="0"+p;else if(b<0)L="0."+I.stringOfChar("0",-b)+p;else if(p.indexOf(".")===-1){var O=b-p.length;L=p+I.stringOfChar("0",O)+".0"}return this.isNegative()?"-"+L:L}},{key:"reciprocal",value:function(){var c,d,p,b,L=null,O=null,V=null,K=null;c=(p=1/this._hi)-(L=(V=I.SPLIT*p)-(L=V-p)),O=(K=I.SPLIT*this._hi)-this._hi;var pe=p+(V=(1-(b=p*this._hi)-(K=L*(O=K-O)-b+L*(d=this._hi-O)+c*O+c*d)-p*this._lo)/this._hi);return new I(pe,p-pe+V)}},{key:"toSciNotation",value:function(){if(this.isZero())return I.SCI_NOT_ZERO;var c=this.getSpecialNumberString();if(c!==null)return c;var d=new Array(1).fill(null),p=this.extractSignificantDigits(!1,d),b=I.SCI_NOT_EXPONENT_CHAR+d[0];if(p.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+p);var L="";p.length>1&&(L=p.substring(1));var O=p.charAt(0)+"."+L;return this.isNegative()?"-"+O+b:O+b}},{key:"abs",value:function(){return this.isNaN()?I.NaN:this.isNegative()?this.negate():new I(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(c){return this._hi<c._hi||this._hi===c._hi&&this._lo<c._lo}},{key:"add",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return I.copy(this).selfAdd(c)}if(typeof arguments[0]=="number"){var d=arguments[0];return I.copy(this).selfAdd(d)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var c=arguments[0];this._hi=c,this._lo=0}else if(arguments[0]instanceof I){var d=arguments[0];this._hi=d._hi,this._lo=d._lo}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this._hi=p,this._lo=b}}},{key:"gt",value:function(c){return this._hi>c._hi||this._hi===c._hi&&this._lo>c._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?I.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[be,ce,xe]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var c=arguments[0];this.init(c)}else if(arguments[0]instanceof I){var d=arguments[0];this.init(d)}else if(typeof arguments[0]=="string"){var p=arguments[0];I.constructor_.call(this,I.parse(p))}}else if(arguments.length===2){var b=arguments[0],L=arguments[1];this.init(b,L)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];return I.determinant(I.valueOf(c),I.valueOf(d),I.valueOf(p),I.valueOf(b))}if(arguments[3]instanceof I&&arguments[2]instanceof I&&arguments[0]instanceof I&&arguments[1]instanceof I){var L=arguments[0],O=arguments[1],V=arguments[2],K=arguments[3],pe=L.multiply(K).selfSubtract(O.multiply(V));return pe}}},{key:"sqr",value:function(c){return I.valueOf(c).selfMultiply(c)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var c=arguments[0];return I.parse(c)}if(typeof arguments[0]=="number"){var d=arguments[0];return new I(d)}}},{key:"sqrt",value:function(c){return I.valueOf(c).sqrt()}},{key:"parse",value:function(c){for(var d=0,p=c.length;Jr.isWhitespace(c.charAt(d));)d++;var b=!1;if(d<p){var L=c.charAt(d);L!=="-"&&L!=="+"||(d++,L==="-"&&(b=!0))}for(var O=new I,V=0,K=0,pe=0,Be=!1;!(d>=p);){var $e=c.charAt(d);if(d++,Jr.isDigit($e)){var mt=$e-"0";O.selfMultiply(I.TEN),O.selfAdd(mt),V++}else{if($e!=="."){if($e==="e"||$e==="E"){var Ft=c.substring(d);try{pe=Yi.parseInt(Ft)}catch(ni){throw ni instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+Ft+" in string "+c):ni}break}throw new NumberFormatException("Unexpected character '"+$e+"' at position "+d+" in string "+c)}K=V,Be=!0}}var Nt=O;Be||(K=V);var gn=V-K-pe;if(gn===0)Nt=O;else if(gn>0){var vn=I.TEN.pow(gn);Nt=O.divide(vn)}else if(gn<0){var Ln=I.TEN.pow(-gn);Nt=O.multiply(Ln)}return b?Nt.negate():Nt}},{key:"createNaN",value:function(){return new I(vt.NaN,vt.NaN)}},{key:"copy",value:function(c){return new I(c)}},{key:"magnitude",value:function(c){var d=Math.abs(c),p=Math.log(d)/Math.log(10),b=Math.trunc(Math.floor(p));return 10*Math.pow(10,b)<=d&&(b+=1),b}},{key:"stringOfChar",value:function(c,d){for(var p=new Ri,b=0;b<d;b++)p.append(c);return p.toString()}}]),I}();ct.PI=new ct(3.141592653589793,12246467991473532e-32),ct.TWO_PI=new ct(6.283185307179586,24492935982947064e-32),ct.PI_2=new ct(1.5707963267948966,6123233995736766e-32),ct.E=new ct(2.718281828459045,14456468917292502e-32),ct.NaN=new ct(vt.NaN,vt.NaN),ct.EPS=123259516440783e-46,ct.SPLIT=134217729,ct.MAX_PRINT_DIGITS=32,ct.TEN=ct.valueOf(10),ct.ONE=ct.valueOf(1),ct.SCI_NOT_EXPONENT_CHAR="E",ct.SCI_NOT_ZERO="0.0E0";var yr=function(){function I(){n(this,I)}return a(I,null,[{key:"orientationIndex",value:function(c,d,p){var b=I.orientationIndexFilter(c,d,p);if(b<=1)return b;var L=ct.valueOf(d.x).selfAdd(-c.x),O=ct.valueOf(d.y).selfAdd(-c.y),V=ct.valueOf(p.x).selfAdd(-d.x),K=ct.valueOf(p.y).selfAdd(-d.y);return L.selfMultiply(K).selfSubtract(O.selfMultiply(V)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof ct&&arguments[2]instanceof ct&&arguments[0]instanceof ct&&arguments[1]instanceof ct){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3],L=c.multiply(b).selfSubtract(d.multiply(p));return L.signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var O=arguments[0],V=arguments[1],K=arguments[2],pe=arguments[3],Be=ct.valueOf(O),$e=ct.valueOf(V),mt=ct.valueOf(K),Ft=ct.valueOf(pe),Nt=Be.multiply(Ft).selfSubtract($e.multiply(mt));return Nt.signum()}}},{key:"intersection",value:function(c,d,p,b){var L=new ct(c.y).selfSubtract(d.y),O=new ct(d.x).selfSubtract(c.x),V=new ct(c.x).selfMultiply(d.y).selfSubtract(new ct(d.x).selfMultiply(c.y)),K=new ct(p.y).selfSubtract(b.y),pe=new ct(b.x).selfSubtract(p.x),Be=new ct(p.x).selfMultiply(b.y).selfSubtract(new ct(b.x).selfMultiply(p.y)),$e=O.multiply(Be).selfSubtract(pe.multiply(V)),mt=K.multiply(V).selfSubtract(L.multiply(Be)),Ft=L.multiply(pe).selfSubtract(K.multiply(O)),Nt=$e.selfDivide(Ft).doubleValue(),gn=mt.selfDivide(Ft).doubleValue();return vt.isNaN(Nt)||vt.isInfinite(Nt)||vt.isNaN(gn)||vt.isInfinite(gn)?null:new We(Nt,gn)}},{key:"orientationIndexFilter",value:function(c,d,p){var b=null,L=(c.x-p.x)*(d.y-p.y),O=(c.y-p.y)*(d.x-p.x),V=L-O;if(L>0){if(O<=0)return I.signum(V);b=L+O}else{if(!(L<0)||O>=0)return I.signum(V);b=-L-O}var K=I.DP_SAFE_EPSILON*b;return V>=K||-V>=K?I.signum(V):2}},{key:"signum",value:function(c){return c>0?1:c<0?-1:0}}]),I}();yr.DP_SAFE_EPSILON=1e-15;var xn=function(){function I(){n(this,I)}return a(I,[{key:"getM",value:function(c){if(this.hasM()){var d=this.getDimension()-this.getMeasures();return this.getOrdinate(c,d)}return vt.NaN}},{key:"setOrdinate",value:function(c,d,p){}},{key:"getZ",value:function(c){return this.hasZ()?this.getOrdinate(c,2):vt.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(c,d){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(c){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(c){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(c){}},{key:"copy",value:function(){}},{key:"getY",value:function(c){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[xe]}}]),I}();xn.X=0,xn.Y=1,xn.Z=2,xn.M=3;var mn=function(){function I(){n(this,I)}return a(I,null,[{key:"index",value:function(c,d,p){return yr.orientationIndex(c,d,p)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var c=arguments[0],d=c.length-1;if(d<3)throw new ve("Ring has fewer than 4 points, so orientation cannot be determined");for(var p=c[0],b=0,L=1;L<=d;L++){var O=c[L];O.y>p.y&&(p=O,b=L)}var V=b;do(V-=1)<0&&(V=d);while(c[V].equals2D(p)&&V!==b);var K=b;do K=(K+1)%d;while(c[K].equals2D(p)&&K!==b);var pe=c[V],Be=c[K];if(pe.equals2D(p)||Be.equals2D(p)||pe.equals2D(Be))return!1;var $e=I.index(pe,p,Be),mt=null;return mt=$e===0?pe.x>Be.x:$e>0,mt}if(Jt(arguments[0],xn)){var Ft=arguments[0],Nt=Ft.size()-1;if(Nt<3)throw new ve("Ring has fewer than 4 points, so orientation cannot be determined");for(var gn=Ft.getCoordinate(0),vn=0,Ln=1;Ln<=Nt;Ln++){var ni=Ft.getCoordinate(Ln);ni.y>gn.y&&(gn=ni,vn=Ln)}var gi=null,ui=vn;do(ui-=1)<0&&(ui=Nt),gi=Ft.getCoordinate(ui);while(gi.equals2D(gn)&&ui!==vn);var er=null,ss=vn;do ss=(ss+1)%Nt,er=Ft.getCoordinate(ss);while(er.equals2D(gn)&&ss!==vn);if(gi.equals2D(gn)||er.equals2D(gn)||gi.equals2D(er))return!1;var Rs=I.index(gi,gn,er);return Rs===0?gi.x>er.x:Rs>0}}}]),I}();mn.CLOCKWISE=-1,mn.RIGHT=mn.CLOCKWISE,mn.COUNTERCLOCKWISE=1,mn.LEFT=mn.COUNTERCLOCKWISE,mn.COLLINEAR=0,mn.STRAIGHT=mn.COLLINEAR;var Ms=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(c,d){var p=this.getRightmostSideOfSegment(c,d);return p<0&&(p=this.getRightmostSideOfSegment(c,d-1)),p<0&&(this._minCoord=null,this.checkForRightmostCoordinate(c)),p}},{key:"findRightmostEdgeAtVertex",value:function(){var c=this._minDe.getEdge().getCoordinates();It.isTrue(this._minIndex>0&&this._minIndex<c.length,"rightmost point expected to be interior vertex of edge");var d=c[this._minIndex-1],p=c[this._minIndex+1],b=mn.index(this._minCoord,p,d),L=!1;(d.y<this._minCoord.y&&p.y<this._minCoord.y&&b===mn.COUNTERCLOCKWISE||d.y>this._minCoord.y&&p.y>this._minCoord.y&&b===mn.CLOCKWISE)&&(L=!0),L&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(c,d){var p=c.getEdge().getCoordinates();if(d<0||d+1>=p.length||p[d].y===p[d+1].y)return-1;var b=Ie.LEFT;return p[d].y<p[d+1].y&&(b=Ie.RIGHT),b}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(c){for(var d=c.getEdge().getCoordinates(),p=0;p<d.length-1;p++)(this._minCoord===null||d[p].x>this._minCoord.x)&&(this._minDe=c,this._minIndex=p,this._minCoord=d[p])}},{key:"findRightmostEdgeAtNode",value:function(){var c=this._minDe.getNode().getEdges();this._minDe=c.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(c){for(var d=c.iterator();d.hasNext();){var p=d.next();p.isForward()&&this.checkForRightmostCoordinate(p)}It.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Ie.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}]),I}(),Mt=function(I){h(d,I);var c=B(d);function d(p,b){var L;return n(this,d),(L=c.call(this,b?p+" [ "+b+" ]":p)).pt=b?new We(b):void 0,L.name=Object.keys({TopologyException:d})[0],L}return a(d,[{key:"getCoordinate",value:function(){return this.pt}}]),d}(ft),An=function(){function I(){n(this,I),this.array=[]}return a(I,[{key:"addLast",value:function(c){this.array.push(c)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}]),I}(),At=function(I,c){h(p,I);var d=B(p);function p(b){var L;return n(this,p),(L=d.call(this)).array=[],b instanceof lt&&L.addAll(b),L}return a(p,[{key:"interfaces_",get:function(){return[Nn,lt]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(b){return arguments.length===1?this.array.push(b):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(b){var L,O=Q(b);try{for(O.s();!(L=O.n()).done;){var V=L.value;this.array.push(V)}}catch(K){O.e(K)}finally{O.f()}}},{key:"set",value:function(b,L){var O=this.array[b];return this.array[b]=L,O}},{key:"iterator",value:function(){return new vr(this)}},{key:"get",value:function(b){if(b<0||b>=this.size())throw new Mn;return this.array[b]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(b){b?this.array.sort(function(L,O){return b.compare(L,O)}):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(b){for(var L=0,O=this.array.length;L<O;L++)if(this.array[L]===b)return!!this.array.splice(L,1);return!1}},{key:c,value:function(){return this.array.values()}}]),p}(Nn,Symbol.iterator),vr=function(){function I(c){n(this,I),this.arrayList=c,this.position=0}return a(I,[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new Ye;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(c){return this.arrayList.set(this.position-1,c)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}]),I}(),Gr=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"clearVisitedEdges",value:function(){for(var c=this._dirEdgeList.iterator();c.hasNext();)c.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(c){for(var d=null,p=c.getEdges().iterator();p.hasNext();){var b=p.next();if(b.isVisited()||b.getSym().isVisited()){d=b;break}}if(d===null)throw new Mt("unable to find edge to compute depths at "+c.getCoordinate());c.getEdges().computeDepths(d);for(var L=c.getEdges().iterator();L.hasNext();){var O=L.next();O.setVisited(!0),this.copySymDepths(O)}}},{key:"computeDepth",value:function(c){this.clearVisitedEdges();var d=this._finder.getEdge();d.getNode(),d.getLabel(),d.setEdgeDepths(Ie.RIGHT,c),this.copySymDepths(d),this.computeDepths(d)}},{key:"create",value:function(c){this.addReachable(c),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var c=this._dirEdgeList.iterator();c.hasNext();){var d=c.next();d.getDepth(Ie.RIGHT)>=1&&d.getDepth(Ie.LEFT)<=0&&!d.isInteriorAreaEdge()&&d.setInResult(!0)}}},{key:"computeDepths",value:function(c){var d=new On,p=new An,b=c.getNode();for(p.addLast(b),d.add(b),c.setVisited(!0);!p.isEmpty();){var L=p.removeFirst();d.add(L),this.computeNodeDepth(L);for(var O=L.getEdges().iterator();O.hasNext();){var V=O.next().getSym();if(!V.isVisited()){var K=V.getNode();d.contains(K)||(p.addLast(K),d.add(K))}}}}},{key:"compareTo",value:function(c){var d=c;return this._rightMostCoord.x<d._rightMostCoord.x?-1:this._rightMostCoord.x>d._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var c=new dn,d=this._dirEdgeList.iterator();d.hasNext();)for(var p=d.next().getEdge().getCoordinates(),b=0;b<p.length-1;b++)c.expandToInclude(p[b]);this._env=c}return this._env}},{key:"addReachable",value:function(c){var d=new Qn;for(d.add(c);!d.empty();){var p=d.pop();this.add(p,d)}}},{key:"copySymDepths",value:function(c){var d=c.getSym();d.setDepth(Ie.LEFT,c.getDepth(Ie.RIGHT)),d.setDepth(Ie.RIGHT,c.getDepth(Ie.LEFT))}},{key:"add",value:function(c,d){c.setVisited(!0),this._nodes.add(c);for(var p=c.getEdges().iterator();p.hasNext();){var b=p.next();this._dirEdgeList.add(b);var L=b.getSym().getNode();L.isVisited()||d.push(L)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[ce]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new At,this._nodes=new At,this._rightMostCoord=null,this._env=null,this._finder=new Ms}}]),I}(),bn=function(){function I(){n(this,I)}return a(I,null,[{key:"intersection",value:function(c,d,p,b){var L=c.x<d.x?c.x:d.x,O=c.y<d.y?c.y:d.y,V=c.x>d.x?c.x:d.x,K=c.y>d.y?c.y:d.y,pe=p.x<b.x?p.x:b.x,Be=p.y<b.y?p.y:b.y,$e=p.x>b.x?p.x:b.x,mt=p.y>b.y?p.y:b.y,Ft=((L>pe?L:pe)+(V<$e?V:$e))/2,Nt=((O>Be?O:Be)+(K<mt?K:mt))/2,gn=c.x-Ft,vn=c.y-Nt,Ln=d.x-Ft,ni=d.y-Nt,gi=p.x-Ft,ui=p.y-Nt,er=b.x-Ft,ss=b.y-Nt,Rs=vn-ni,di=Ln-gn,Rr=gn*ni-Ln*vn,dr=ui-ss,Ps=er-gi,Wa=gi*ss-er*ui,xa=Rs*Ps-dr*di,lo=(di*Wa-Ps*Rr)/xa,ks=(dr*Rr-Rs*Wa)/xa;return vt.isNaN(lo)||vt.isInfinite(lo)||vt.isNaN(ks)||vt.isInfinite(ks)?null:new We(lo+Ft,ks+Nt)}}]),I}(),Pi=function(){function I(){n(this,I)}return a(I,null,[{key:"arraycopy",value:function(c,d,p,b,L){for(var O=0,V=d;V<d+L;V++)p[b+O]=c[V],O++}},{key:"getProperty",value:function(c){return{"line.separator":`
`}[c]}}]),I}(),Ar=function(){function I(){n(this,I)}return a(I,null,[{key:"log10",value:function(c){var d=Math.log(c);return vt.isInfinite(d)||vt.isNaN(d)?d:d/I.LOG_10}},{key:"min",value:function(c,d,p,b){var L=c;return d<L&&(L=d),p<L&&(L=p),b<L&&(L=b),L}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1],p=arguments[2];return c<d?d:c>p?p:c}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var b=arguments[0],L=arguments[1],O=arguments[2];return b<L?L:b>O?O:b}}},{key:"wrap",value:function(c,d){return c<0?d- -c%d:c%d}},{key:"max",value:function(){if(arguments.length===3){var c=arguments[0],d=arguments[1],p=arguments[2],b=c;return d>b&&(b=d),p>b&&(b=p),b}if(arguments.length===4){var L=arguments[0],O=arguments[1],V=arguments[2],K=arguments[3],pe=L;return O>pe&&(pe=O),V>pe&&(pe=V),K>pe&&(pe=K),pe}}},{key:"average",value:function(c,d){return(c+d)/2}}]),I}();Ar.LOG_10=Math.log(10);var Ji=function(){function I(){n(this,I)}return a(I,null,[{key:"segmentToSegment",value:function(c,d,p,b){if(c.equals(d))return I.pointToSegment(c,p,b);if(p.equals(b))return I.pointToSegment(b,c,d);var L=!1;if(dn.intersects(c,d,p,b)){var O=(d.x-c.x)*(b.y-p.y)-(d.y-c.y)*(b.x-p.x);if(O===0)L=!0;else{var V=(c.y-p.y)*(b.x-p.x)-(c.x-p.x)*(b.y-p.y),K=((c.y-p.y)*(d.x-c.x)-(c.x-p.x)*(d.y-c.y))/O,pe=V/O;(pe<0||pe>1||K<0||K>1)&&(L=!0)}}else L=!0;return L?Ar.min(I.pointToSegment(c,p,b),I.pointToSegment(d,p,b),I.pointToSegment(p,c,d),I.pointToSegment(b,c,d)):0}},{key:"pointToSegment",value:function(c,d,p){if(d.x===p.x&&d.y===p.y)return c.distance(d);var b=(p.x-d.x)*(p.x-d.x)+(p.y-d.y)*(p.y-d.y),L=((c.x-d.x)*(p.x-d.x)+(c.y-d.y)*(p.y-d.y))/b;if(L<=0)return c.distance(d);if(L>=1)return c.distance(p);var O=((d.y-c.y)*(p.x-d.x)-(d.x-c.x)*(p.y-d.y))/b;return Math.abs(O)*Math.sqrt(b)}},{key:"pointToLinePerpendicular",value:function(c,d,p){var b=(p.x-d.x)*(p.x-d.x)+(p.y-d.y)*(p.y-d.y),L=((d.y-c.y)*(p.x-d.x)-(d.x-c.x)*(p.y-d.y))/b;return Math.abs(L)*Math.sqrt(b)}},{key:"pointToSegmentString",value:function(c,d){if(d.length===0)throw new ve("Line array must contain at least one vertex");for(var p=c.distance(d[0]),b=0;b<d.length-1;b++){var L=I.pointToSegment(c,d[b],d[b+1]);L<p&&(p=L)}return p}}]),I}(),Zr=function(){function I(){n(this,I)}return a(I,[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||Jt(arguments[0],xn);else if(arguments.length!==2&&arguments.length===3){var c=arguments[0],d=arguments[1];return this.create(c,d)}}}]),I}(),Re=function(){function I(){n(this,I)}return a(I,[{key:"filter",value:function(c){}}]),I}(),J=function(){function I(){n(this,I)}return a(I,null,[{key:"ofLine",value:function(c){var d=c.size();if(d<=1)return 0;var p=0,b=new We;c.getCoordinate(0,b);for(var L=b.x,O=b.y,V=1;V<d;V++){c.getCoordinate(V,b);var K=b.x,pe=b.y,Be=K-L,$e=pe-O;p+=Math.sqrt(Be*Be+$e*$e),L=K,O=pe}return p}}]),I}(),$=function I(){n(this,I)},he=function(){function I(){n(this,I)}return a(I,null,[{key:"copyCoord",value:function(c,d,p,b){for(var L=Math.min(c.getDimension(),p.getDimension()),O=0;O<L;O++)p.setOrdinate(b,O,c.getOrdinate(d,O))}},{key:"isRing",value:function(c){var d=c.size();return d===0||!(d<=3)&&c.getOrdinate(0,xn.X)===c.getOrdinate(d-1,xn.X)&&c.getOrdinate(0,xn.Y)===c.getOrdinate(d-1,xn.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(Jt(arguments[0],xn)&&Number.isInteger(arguments[1])){var c=arguments[0],d=arguments[1];I.scroll(c,d,I.isRing(c))}else if(Jt(arguments[0],xn)&&arguments[1]instanceof We){var p=arguments[0],b=arguments[1],L=I.indexOf(b,p);if(L<=0)return null;I.scroll(p,L)}}else if(arguments.length===3){var O=arguments[0],V=arguments[1],K=arguments[2],pe=V;if(pe<=0)return null;for(var Be=O.copy(),$e=K?O.size()-1:O.size(),mt=0;mt<$e;mt++)for(var Ft=0;Ft<O.getDimension();Ft++)O.setOrdinate(mt,Ft,Be.getOrdinate((V+mt)%$e,Ft));if(K)for(var Nt=0;Nt<O.getDimension();Nt++)O.setOrdinate($e,Nt,O.getOrdinate(0,Nt))}}},{key:"isEqual",value:function(c,d){var p=c.size();if(p!==d.size())return!1;for(var b=Math.min(c.getDimension(),d.getDimension()),L=0;L<p;L++)for(var O=0;O<b;O++){var V=c.getOrdinate(L,O),K=d.getOrdinate(L,O);if(c.getOrdinate(L,O)!==d.getOrdinate(L,O)&&(!vt.isNaN(V)||!vt.isNaN(K)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var c=arguments[0];return I.minCoordinateIndex(c,0,c.size()-1)}if(arguments.length===3){for(var d=arguments[0],p=arguments[1],b=arguments[2],L=-1,O=null,V=p;V<=b;V++){var K=d.getCoordinate(V);(O===null||O.compareTo(K)>0)&&(O=K,L=V)}return L}}},{key:"extend",value:function(c,d,p){var b=c.create(p,d.getDimension()),L=d.size();if(I.copy(d,0,b,0,L),L>0)for(var O=L;O<p;O++)I.copy(d,L-1,b,O,1);return b}},{key:"reverse",value:function(c){for(var d=c.size()-1,p=Math.trunc(d/2),b=0;b<=p;b++)I.swap(c,b,d-b)}},{key:"swap",value:function(c,d,p){if(d===p)return null;for(var b=0;b<c.getDimension();b++){var L=c.getOrdinate(d,b);c.setOrdinate(d,b,c.getOrdinate(p,b)),c.setOrdinate(p,b,L)}}},{key:"copy",value:function(c,d,p,b,L){for(var O=0;O<L;O++)I.copyCoord(c,d+O,p,b+O)}},{key:"ensureValidRing",value:function(c,d){var p=d.size();return p===0?d:p<=3?I.createClosedRing(c,d,4):d.getOrdinate(0,xn.X)===d.getOrdinate(p-1,xn.X)&&d.getOrdinate(0,xn.Y)===d.getOrdinate(p-1,xn.Y)?d:I.createClosedRing(c,d,p+1)}},{key:"indexOf",value:function(c,d){for(var p=0;p<d.size();p++)if(c.x===d.getOrdinate(p,xn.X)&&c.y===d.getOrdinate(p,xn.Y))return p;return-1}},{key:"createClosedRing",value:function(c,d,p){var b=c.create(p,d.getDimension()),L=d.size();I.copy(d,0,b,0,L);for(var O=L;O<p;O++)I.copy(d,0,b,O,1);return b}},{key:"minCoordinate",value:function(c){for(var d=null,p=0;p<c.size();p++){var b=c.getCoordinate(p);(d===null||d.compareTo(b)>0)&&(d=b)}return d}}]),I}(),ue=function(){function I(){n(this,I)}return a(I,null,[{key:"toDimensionSymbol",value:function(c){switch(c){case I.FALSE:return I.SYM_FALSE;case I.TRUE:return I.SYM_TRUE;case I.DONTCARE:return I.SYM_DONTCARE;case I.P:return I.SYM_P;case I.L:return I.SYM_L;case I.A:return I.SYM_A}throw new ve("Unknown dimension value: "+c)}},{key:"toDimensionValue",value:function(c){switch(Jr.toUpperCase(c)){case I.SYM_FALSE:return I.FALSE;case I.SYM_TRUE:return I.TRUE;case I.SYM_DONTCARE:return I.DONTCARE;case I.SYM_P:return I.P;case I.SYM_L:return I.L;case I.SYM_A:return I.A}throw new ve("Unknown dimension symbol: "+c)}}]),I}();ue.P=0,ue.L=1,ue.A=2,ue.FALSE=-1,ue.TRUE=-2,ue.DONTCARE=-3,ue.SYM_FALSE="F",ue.SYM_TRUE="T",ue.SYM_DONTCARE="*",ue.SYM_P="0",ue.SYM_L="1",ue.SYM_A="2";var fe=function(){function I(){n(this,I)}return a(I,[{key:"filter",value:function(c){}}]),I}(),je=function(){function I(){n(this,I)}return a(I,[{key:"filter",value:function(c,d){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}]),I}(),Xe=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new dn:this._points.expandEnvelope(new dn)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new d(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];if(!this.isEquivalentClass(p))return!1;var L=p;if(this._points.size()!==L._points.size())return!1;for(var O=0;O<this._points.size();O++)if(!this.equal(this._points.getCoordinate(O),L._points.getCoordinate(O),b))return!1;return!0}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){for(var p=0;p<Math.trunc(this._points.size()/2);p++){var b=this._points.size()-1-p;if(!this._points.getCoordinate(p).equals(this._points.getCoordinate(b))){if(this._points.getCoordinate(p).compareTo(this._points.getCoordinate(b))>0){var L=this._points.copy();he.reverse(L),this._points=L}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?ue.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var p=this._points.copy();return he.reverse(p),this.getFactory().createLineString(p)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return J.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var p=arguments[0],b=p,L=0,O=0;L<this._points.size()&&O<b._points.size();){var V=this._points.getCoordinate(L).compareTo(b._points.getCoordinate(O));if(V!==0)return V;L++,O++}return L<this._points.size()?1:O<b._points.size()?-1:0}if(arguments.length===2){var K=arguments[0],pe=arguments[1],Be=K;return pe.compare(this._points,Be._points)}}},{key:"apply",value:function(){if(Jt(arguments[0],Re))for(var p=arguments[0],b=0;b<this._points.size();b++)p.filter(this._points.getCoordinate(b));else if(Jt(arguments[0],je)){var L=arguments[0];if(this._points.size()===0)return null;for(var O=0;O<this._points.size()&&(L.filter(this._points,O),!L.isDone());O++);L.isGeometryChanged()&&this.geometryChanged()}else if(Jt(arguments[0],fe)){var V=arguments[0];V.filter(this)}else if(Jt(arguments[0],Ae)){var K=arguments[0];K.filter(this)}}},{key:"getBoundary",value:function(){throw new Lt}},{key:"isEquivalentClass",value:function(p){return p instanceof d}},{key:"getCoordinateN",value:function(p){return this._points.getCoordinate(p)}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(p){if(p===null&&(p=this.getFactory().getCoordinateSequenceFactory().create([])),p.size()===1)throw new ve("Invalid number of points in LineString (found "+p.size()+" - must be 0 or >= 2)");this._points=p}},{key:"isCoordinate",value:function(p){for(var b=0;b<this._points.size();b++)if(this._points.getCoordinate(b).equals(p))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(p){return this.getFactory().createPoint(this._points.getCoordinate(p))}},{key:"interfaces_",get:function(){return[$]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0&&arguments.length===2){var p=arguments[0],b=arguments[1];Ot.constructor_.call(this,b),this.init(p)}}}]),d}(Ot),Pe=function I(){n(this,I)},et=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new dn;var p=new dn;return p.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),p}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new d(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&(!(!this.isEmpty()||!p.isEmpty())||this.isEmpty()===p.isEmpty()&&this.equal(p.getCoordinate(),this.getCoordinate(),b))}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return ue.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var p=arguments[0],b=p;return this.getCoordinate().compareTo(b.getCoordinate())}if(arguments.length===2){var L=arguments[0],O=arguments[1],V=L;return O.compare(this._coordinates,V._coordinates)}}},{key:"apply",value:function(){if(Jt(arguments[0],Re)){var p=arguments[0];if(this.isEmpty())return null;p.filter(this.getCoordinate())}else if(Jt(arguments[0],je)){var b=arguments[0];if(this.isEmpty())return null;b.filter(this._coordinates,0),b.isGeometryChanged()&&this.geometryChanged()}else if(Jt(arguments[0],fe)){var L=arguments[0];L.filter(this)}else if(Jt(arguments[0],Ae)){var O=arguments[0];O.filter(this)}}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(p){p===null&&(p=this.getFactory().getCoordinateSequenceFactory().create([])),It.isTrue(p.size()<=1),this._coordinates=p}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[Pe]}}],[{key:"constructor_",value:function(){this._coordinates=null;var p=arguments[0],b=arguments[1];Ot.constructor_.call(this,b),this.init(p)}}]),d}(Ot),gt=function(){function I(){n(this,I)}return a(I,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var c=arguments[0];return Math.abs(I.ofRingSigned(c))}if(Jt(arguments[0],xn)){var d=arguments[0];return Math.abs(I.ofRingSigned(d))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var c=arguments[0];if(c.length<3)return 0;for(var d=0,p=c[0].x,b=1;b<c.length-1;b++){var L=c[b].x-p,O=c[b+1].y,V=c[b-1].y;d+=L*(V-O)}return d/2}if(Jt(arguments[0],xn)){var K=arguments[0],pe=K.size();if(pe<3)return 0;var Be=new We,$e=new We,mt=new We;K.getCoordinate(0,$e),K.getCoordinate(1,mt);var Ft=$e.x;mt.x-=Ft;for(var Nt=0,gn=1;gn<pe-1;gn++)Be.y=$e.y,$e.x=mt.x,$e.y=mt.y,K.getCoordinate(gn+1,mt),mt.x-=Ft,Nt+=$e.x*(Be.y-mt.y);return Nt/2}}}]),I}(),at=function(){function I(){n(this,I)}return a(I,null,[{key:"sort",value:function(){var c=arguments,d=arguments[0];if(arguments.length===1)d.sort(function(Ft,Nt){return Ft.compareTo(Nt)});else if(arguments.length===2)d.sort(function(Ft,Nt){return c[1].compare(Ft,Nt)});else if(arguments.length===3){var p=d.slice(arguments[1],arguments[2]);p.sort();var b=d.slice(0,arguments[1]).concat(p,d.slice(arguments[2],d.length));d.splice(0,d.length);var L,O=Q(b);try{for(O.s();!(L=O.n()).done;){var V=L.value;d.push(V)}}catch(Ft){O.e(Ft)}finally{O.f()}}else if(arguments.length===4){var K=d.slice(arguments[1],arguments[2]);K.sort(function(Ft,Nt){return c[3].compare(Ft,Nt)});var pe=d.slice(0,arguments[1]).concat(K,d.slice(arguments[2],d.length));d.splice(0,d.length);var Be,$e=Q(pe);try{for($e.s();!(Be=$e.n()).done;){var mt=Be.value;d.push(mt)}}catch(Ft){$e.e(Ft)}finally{$e.f()}}}},{key:"asList",value:function(c){var d,p=new At,b=Q(c);try{for(b.s();!(d=b.n()).done;){var L=d.value;p.add(L)}}catch(O){b.e(O)}finally{b.f()}return p}},{key:"copyOf",value:function(c,d){return c.slice(0,d)}}]),I}(),Dt=function I(){n(this,I)},en=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var p=new Array(this.getNumPoints()).fill(null),b=-1,L=this._shell.getCoordinates(),O=0;O<L.length;O++)p[++b]=L[O];for(var V=0;V<this._holes.length;V++)for(var K=this._holes[V].getCoordinates(),pe=0;pe<K.length;pe++)p[++b]=K[pe];return p}},{key:"getArea",value:function(){var p=0;p+=gt.ofRing(this._shell.getCoordinateSequence());for(var b=0;b<this._holes.length;b++)p-=gt.ofRing(this._holes[b].getCoordinateSequence());return p}},{key:"copyInternal",value:function(){for(var p=this._shell.copy(),b=new Array(this._holes.length).fill(null),L=0;L<this._holes.length;L++)b[L]=this._holes[L].copy();return new d(p,b,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var p=this._shell.getCoordinateSequence(),b=this.getEnvelopeInternal(),L=0;L<5;L++){var O=p.getX(L);if(O!==b.getMinX()&&O!==b.getMaxX())return!1;var V=p.getY(L);if(V!==b.getMinY()&&V!==b.getMaxY())return!1}for(var K=p.getX(0),pe=p.getY(0),Be=1;Be<=4;Be++){var $e=p.getX(Be),mt=p.getY(Be);if($e!==K==(mt!==pe))return!1;K=$e,pe=mt}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];if(!this.isEquivalentClass(p))return!1;var L=p,O=this._shell,V=L._shell;if(!O.equalsExact(V,b)||this._holes.length!==L._holes.length)return!1;for(var K=0;K<this._holes.length;K++)if(!this._holes[K].equalsExact(L._holes[K],b))return!1;return!0}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var p=0;p<this._holes.length;p++)this._holes[p]=this.normalized(this._holes[p],!1);at.sort(this._holes)}else if(arguments.length===2){var b=arguments[0],L=arguments[1];if(b.isEmpty())return null;var O=b.getCoordinateSequence(),V=he.minCoordinateIndex(O,0,O.size()-2);he.scroll(O,V,!0),mn.isCCW(O)===L&&he.reverse(O)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var p=this.getExteriorRing().reverse(),b=new Array(this.getNumInteriorRing()).fill(null),L=0;L<b.length;L++)b[L]=this.getInteriorRingN(L).reverse();return this.getFactory().createPolygon(p,b)}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var p=0;p+=this._shell.getLength();for(var b=0;b<this._holes.length;b++)p+=this._holes[b].getLength();return p}},{key:"getNumPoints",value:function(){for(var p=this._shell.getNumPoints(),b=0;b<this._holes.length;b++)p+=this._holes[b].getNumPoints();return p}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(p,b){var L=p.copy();return this.normalize(L,b),L}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var p=arguments[0],b=this._shell,L=p._shell;return b.compareToSameClass(L)}if(arguments.length===2){var O=arguments[0],V=arguments[1],K=O,pe=this._shell,Be=K._shell,$e=pe.compareToSameClass(Be,V);if($e!==0)return $e;for(var mt=this.getNumInteriorRing(),Ft=K.getNumInteriorRing(),Nt=0;Nt<mt&&Nt<Ft;){var gn=this.getInteriorRingN(Nt),vn=K.getInteriorRingN(Nt),Ln=gn.compareToSameClass(vn,V);if(Ln!==0)return Ln;Nt++}return Nt<mt?1:Nt<Ft?-1:0}}},{key:"apply",value:function(){if(Jt(arguments[0],Re)){var p=arguments[0];this._shell.apply(p);for(var b=0;b<this._holes.length;b++)this._holes[b].apply(p)}else if(Jt(arguments[0],je)){var L=arguments[0];if(this._shell.apply(L),!L.isDone())for(var O=0;O<this._holes.length&&(this._holes[O].apply(L),!L.isDone());O++);L.isGeometryChanged()&&this.geometryChanged()}else if(Jt(arguments[0],fe)){var V=arguments[0];V.filter(this)}else if(Jt(arguments[0],Ae)){var K=arguments[0];K.filter(this),this._shell.apply(K);for(var pe=0;pe<this._holes.length;pe++)this._holes[pe].apply(K)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var p=new Array(this._holes.length+1).fill(null);p[0]=this._shell;for(var b=0;b<this._holes.length;b++)p[b+1]=this._holes[b];return p.length<=1?this.getFactory().createLinearRing(p[0].getCoordinateSequence()):this.getFactory().createMultiLineString(p)}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(p){return this._holes[p]}},{key:"interfaces_",get:function(){return[Dt]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var p=arguments[0],b=arguments[1],L=arguments[2];if(Ot.constructor_.call(this,L),p===null&&(p=this.getFactory().createLinearRing()),b===null&&(b=[]),Ot.hasNullElements(b))throw new ve("holes must not contain null elements");if(p.isEmpty()&&Ot.hasNonEmptyElements(b))throw new ve("shell is empty but holes are not");this._shell=p,this._holes=b}}]),d}(Ot),ln=function(I){h(d,I);var c=B(d);function d(){return n(this,d),c.apply(this,arguments)}return d}(Ke),Gn=function(I){h(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this)).array=[],p instanceof lt&&b.addAll(p),b}return a(d,[{key:"contains",value:function(p){var b,L=Q(this.array);try{for(L.s();!(b=L.n()).done;)if(b.value.compareTo(p)===0)return!0}catch(O){L.e(O)}finally{L.f()}return!1}},{key:"add",value:function(p){if(this.contains(p))return!1;for(var b=0,L=this.array.length;b<L;b++)if(this.array[b].compareTo(p)===1)return!!this.array.splice(b,0,p);return this.array.push(p),!0}},{key:"addAll",value:function(p){var b,L=Q(p);try{for(L.s();!(b=L.n()).done;){var O=b.value;this.add(O)}}catch(V){L.e(V)}finally{L.f()}return!0}},{key:"remove",value:function(){throw new Lt}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new Tn(this.array)}}]),d}(ln),Tn=function(){function I(c){n(this,I),this.array=c,this.position=0}return a(I,[{key:"next",value:function(){if(this.position===this.array.length)throw new Ye;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new Lt}}]),I}(),Cn=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){for(var p=new dn,b=0;b<this._geometries.length;b++)p.expandToInclude(this._geometries[b].getEnvelopeInternal());return p}},{key:"getGeometryN",value:function(p){return this._geometries[p]}},{key:"getCoordinates",value:function(){for(var p=new Array(this.getNumPoints()).fill(null),b=-1,L=0;L<this._geometries.length;L++)for(var O=this._geometries[L].getCoordinates(),V=0;V<O.length;V++)p[++b]=O[V];return p}},{key:"getArea",value:function(){for(var p=0,b=0;b<this._geometries.length;b++)p+=this._geometries[b].getArea();return p}},{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];if(!this.isEquivalentClass(p))return!1;var L=p;if(this._geometries.length!==L._geometries.length)return!1;for(var O=0;O<this._geometries.length;O++)if(!this._geometries[O].equalsExact(L._geometries[O],b))return!1;return!0}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){for(var p=0;p<this._geometries.length;p++)this._geometries[p].normalize();at.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var p=ue.FALSE,b=0;b<this._geometries.length;b++)p=Math.max(p,this._geometries[b].getBoundaryDimension());return p}},{key:"reverseInternal",value:function(){for(var p=this._geometries.length,b=new At(p),L=0;L<p;L++)b.add(this._geometries[L].reverse());return this.getFactory().buildGeometry(b)}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var p=ue.FALSE,b=0;b<this._geometries.length;b++)p=Math.max(p,this._geometries[b].getDimension());return p}},{key:"getLength",value:function(){for(var p=0,b=0;b<this._geometries.length;b++)p+=this._geometries[b].getLength();return p}},{key:"getNumPoints",value:function(){for(var p=0,b=0;b<this._geometries.length;b++)p+=this._geometries[b].getNumPoints();return p}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var p=arguments[0],b=new Gn(at.asList(this._geometries)),L=new Gn(at.asList(p._geometries));return this.compare(b,L)}if(arguments.length===2){for(var O=arguments[0],V=arguments[1],K=O,pe=this.getNumGeometries(),Be=K.getNumGeometries(),$e=0;$e<pe&&$e<Be;){var mt=this.getGeometryN($e),Ft=K.getGeometryN($e),Nt=mt.compareToSameClass(Ft,V);if(Nt!==0)return Nt;$e++}return $e<pe?1:$e<Be?-1:0}}},{key:"apply",value:function(){if(Jt(arguments[0],Re))for(var p=arguments[0],b=0;b<this._geometries.length;b++)this._geometries[b].apply(p);else if(Jt(arguments[0],je)){var L=arguments[0];if(this._geometries.length===0)return null;for(var O=0;O<this._geometries.length&&(this._geometries[O].apply(L),!L.isDone());O++);L.isGeometryChanged()&&this.geometryChanged()}else if(Jt(arguments[0],fe)){var V=arguments[0];V.filter(this);for(var K=0;K<this._geometries.length;K++)this._geometries[K].apply(V)}else if(Jt(arguments[0],Ae)){var pe=arguments[0];pe.filter(this);for(var Be=0;Be<this._geometries.length;Be++)this._geometries[Be].apply(pe)}}},{key:"getBoundary",value:function(){return Ot.checkNotGeometryCollection(this),It.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var p=0;p<this._geometries.length;p++)if(!this._geometries[p].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0&&arguments.length===2){var p=arguments[0],b=arguments[1];if(Ot.constructor_.call(this,b),p===null&&(p=[]),Ot.hasNullElements(p))throw new ve("geometries must not contain null elements");this._geometries=p}}}]),d}(Ot),Un=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&U(m(d.prototype),"equalsExact",this).call(this,p,b)}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var p=arguments[0];return this._geometries[p].getCoordinate()}return U(m(d.prototype),"getCoordinate",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return ue.FALSE}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[Pe]}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];Cn.constructor_.call(this,p,b)}}]),d}(Cn),Ii=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){return new d(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return ue.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||U(m(d.prototype),"isClosed",this).call(this)}},{key:"reverseInternal",value:function(){var p=this._points.copy();return he.reverse(p),this.getFactory().createLinearRing(p)}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!U(m(d.prototype),"isClosed",this).call(this))throw new ve("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<d.MINIMUM_VALID_SIZE)throw new ve("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];Xe.constructor_.call(this,p,b),this.validateConstruction()}}]),d}(Xe);Ii.MINIMUM_VALID_SIZE=4;var ci=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"setOrdinate",value:function(p,b){switch(p){case d.X:this.x=b;break;case d.Y:this.y=b;break;default:throw new ve("Invalid ordinate index: "+p)}}},{key:"getZ",value:function(){return We.NULL_ORDINATE}},{key:"getOrdinate",value:function(p){switch(p){case d.X:return this.x;case d.Y:return this.y}throw new ve("Invalid ordinate index: "+p)}},{key:"setZ",value:function(p){throw new ve("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new d(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(p){this.x=p.x,this.y=p.y,this.z=p.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)We.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof d){var p=arguments[0];We.constructor_.call(this,p.x,p.y)}else if(arguments[0]instanceof We){var b=arguments[0];We.constructor_.call(this,b.x,b.y)}}else if(arguments.length===2){var L=arguments[0],O=arguments[1];We.constructor_.call(this,L,O,We.NULL_ORDINATE)}}}]),d}(We);ci.X=0,ci.Y=1,ci.Z=-1,ci.M=-1;var En=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(p,b){switch(p){case d.X:this.x=b;break;case d.Y:this.y=b;break;case d.M:this._m=b;break;default:throw new ve("Invalid ordinate index: "+p)}}},{key:"setM",value:function(p){this._m=p}},{key:"getZ",value:function(){return We.NULL_ORDINATE}},{key:"getOrdinate",value:function(p){switch(p){case d.X:return this.x;case d.Y:return this.y;case d.M:return this._m}throw new ve("Invalid ordinate index: "+p)}},{key:"setZ",value:function(p){throw new ve("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new d(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(p){this.x=p.x,this.y=p.y,this.z=p.getZ(),this._m=p.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)We.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof d){var p=arguments[0];We.constructor_.call(this,p.x,p.y),this._m=p._m}else if(arguments[0]instanceof We){var b=arguments[0];We.constructor_.call(this,b.x,b.y),this._m=this.getM()}}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];We.constructor_.call(this,L,O,We.NULL_ORDINATE),this._m=V}}}]),d}(We);En.X=0,En.Y=1,En.Z=-1,En.M=2;var ri=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(p,b){switch(p){case We.X:this.x=b;break;case We.Y:this.y=b;break;case We.Z:this.z=b;break;case We.M:this._m=b;break;default:throw new ve("Invalid ordinate index: "+p)}}},{key:"setM",value:function(p){this._m=p}},{key:"getOrdinate",value:function(p){switch(p){case We.X:return this.x;case We.Y:return this.y;case We.Z:return this.getZ();case We.M:return this.getM()}throw new ve("Invalid ordinate index: "+p)}},{key:"copy",value:function(){return new d(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(p){this.x=p.x,this.y=p.y,this.z=p.getZ(),this._m=p.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)We.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof d){var p=arguments[0];We.constructor_.call(this,p),this._m=p._m}else if(arguments[0]instanceof We){var b=arguments[0];We.constructor_.call(this,b),this._m=this.getM()}}else if(arguments.length===4){var L=arguments[0],O=arguments[1],V=arguments[2],K=arguments[3];We.constructor_.call(this,L,O,V),this._m=K}}}]),d}(We),fi=function(){function I(){n(this,I)}return a(I,null,[{key:"measures",value:function(c){return c instanceof ci?0:c instanceof En||c instanceof ri?1:0}},{key:"dimension",value:function(c){return c instanceof ci?2:c instanceof En?3:c instanceof ri?4:3}},{key:"create",value:function(){if(arguments.length===1){var c=arguments[0];return I.create(c,0)}if(arguments.length===2){var d=arguments[0],p=arguments[1];return d===2?new ci:d===3&&p===0?new We:d===3&&p===1?new En:d===4&&p===1?new ri:new We}}}]),I}(),Di=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"getCoordinate",value:function(p){return this.get(p)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&Jt(arguments[0],lt)){for(var p=arguments[0],b=arguments[1],L=!1,O=p.iterator();O.hasNext();)this.add(O.next(),b),L=!0;return L}return U(m(d.prototype),"addAll",this).apply(this,arguments)}},{key:"clone",value:function(){for(var p=U(m(d.prototype),"clone",this).call(this),b=0;b<this.size();b++)p.add(b,this.get(b).clone());return p}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(d.coordArrayType);if(arguments.length===1){var p=arguments[0];if(p)return this.toArray(d.coordArrayType);for(var b=this.size(),L=new Array(b).fill(null),O=0;O<b;O++)L[O]=this.get(b-O-1);return L}}},{key:"add",value:function(){if(arguments.length===1){var p=arguments[0];return U(m(d.prototype),"add",this).call(this,p)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var b=arguments[0],L=arguments[1];return this.add(b,L,!0),!0}if(arguments[0]instanceof We&&typeof arguments[1]=="boolean"){var O=arguments[0],V=arguments[1];if(!V&&this.size()>=1){var K=this.get(this.size()-1);if(K.equals2D(O))return null}U(m(d.prototype),"add",this).call(this,O)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var pe=arguments[0],Be=arguments[1];return this.add(pe,Be),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var $e=arguments[0],mt=arguments[1],Ft=arguments[2];if(Ft)for(var Nt=0;Nt<$e.length;Nt++)this.add($e[Nt],mt);else for(var gn=$e.length-1;gn>=0;gn--)this.add($e[gn],mt);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof We){var vn=arguments[0],Ln=arguments[1],ni=arguments[2];if(!ni){var gi=this.size();if(gi>0){if(vn>0){var ui=this.get(vn-1);if(ui.equals2D(Ln))return null}if(vn<gi){var er=this.get(vn);if(er.equals2D(Ln))return null}}}U(m(d.prototype),"add",this).call(this,vn,Ln)}}else if(arguments.length===4){var ss=arguments[0],Rs=arguments[1],di=arguments[2],Rr=arguments[3],dr=1;di>Rr&&(dr=-1);for(var Ps=di;Ps!==Rr;Ps+=dr)this.add(ss[Ps],Rs);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var p=this.get(0).copy();this.add(p,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var p=arguments[0];this.ensureCapacity(p.length),this.add(p,!0)}else if(arguments.length===2){var b=arguments[0],L=arguments[1];this.ensureCapacity(b.length),this.add(b,L)}}}}]),d}(At);Di.coordArrayType=new Array(0).fill(null);var Kn=function(){function I(){n(this,I)}return a(I,null,[{key:"isRing",value:function(c){return!(c.length<4)&&!!c[0].equals2D(c[c.length-1])}},{key:"ptNotInList",value:function(c,d){for(var p=0;p<c.length;p++){var b=c[p];if(I.indexOf(b,d)<0)return b}return null}},{key:"scroll",value:function(c,d){var p=I.indexOf(d,c);if(p<0)return null;var b=new Array(c.length).fill(null);Pi.arraycopy(c,p,b,0,c.length-p),Pi.arraycopy(c,0,b,c.length-p,p),Pi.arraycopy(b,0,c,0,c.length)}},{key:"equals",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];if(c===d)return!0;if(c===null||d===null||c.length!==d.length)return!1;for(var p=0;p<c.length;p++)if(!c[p].equals(d[p]))return!1;return!0}if(arguments.length===3){var b=arguments[0],L=arguments[1],O=arguments[2];if(b===L)return!0;if(b===null||L===null||b.length!==L.length)return!1;for(var V=0;V<b.length;V++)if(O.compare(b[V],L[V])!==0)return!1;return!0}}},{key:"intersection",value:function(c,d){for(var p=new Di,b=0;b<c.length;b++)d.intersects(c[b])&&p.add(c[b],!0);return p.toCoordinateArray()}},{key:"measures",value:function(c){if(c===null||c.length===0)return 0;var d,p=0,b=Q(c);try{for(b.s();!(d=b.n()).done;){var L=d.value;p=Math.max(p,fi.measures(L))}}catch(O){b.e(O)}finally{b.f()}return p}},{key:"hasRepeatedPoints",value:function(c){for(var d=1;d<c.length;d++)if(c[d-1].equals(c[d]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(c){return I.hasRepeatedPoints(c)?new Di(c,!1).toCoordinateArray():c}},{key:"reverse",value:function(c){for(var d=c.length-1,p=Math.trunc(d/2),b=0;b<=p;b++){var L=c[b];c[b]=c[d-b],c[d-b]=L}}},{key:"removeNull",value:function(c){for(var d=0,p=0;p<c.length;p++)c[p]!==null&&d++;var b=new Array(d).fill(null);if(d===0)return b;for(var L=0,O=0;O<c.length;O++)c[O]!==null&&(b[L++]=c[O]);return b}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var c=arguments[0],d=new Array(c.length).fill(null),p=0;p<c.length;p++)d[p]=c[p].copy();return d}if(arguments.length===5)for(var b=arguments[0],L=arguments[1],O=arguments[2],V=arguments[3],K=arguments[4],pe=0;pe<K;pe++)O[V+pe]=b[L+pe].copy()}},{key:"isEqualReversed",value:function(c,d){for(var p=0;p<c.length;p++){var b=c[p],L=d[c.length-p-1];if(b.compareTo(L)!==0)return!1}return!0}},{key:"envelope",value:function(c){for(var d=new dn,p=0;p<c.length;p++)d.expandToInclude(c[p]);return d}},{key:"toCoordinateArray",value:function(c){return c.toArray(I.coordArrayType)}},{key:"dimension",value:function(c){if(c===null||c.length===0)return 3;var d,p=0,b=Q(c);try{for(b.s();!(d=b.n()).done;){var L=d.value;p=Math.max(p,fi.dimension(L))}}catch(O){b.e(O)}finally{b.f()}return p}},{key:"atLeastNCoordinatesOrNothing",value:function(c,d){return d.length>=c?d:[]}},{key:"indexOf",value:function(c,d){for(var p=0;p<d.length;p++)if(c.equals(d[p]))return p;return-1}},{key:"increasingDirection",value:function(c){for(var d=0;d<Math.trunc(c.length/2);d++){var p=c.length-1-d,b=c[d].compareTo(c[p]);if(b!==0)return b}return 1}},{key:"compare",value:function(c,d){for(var p=0;p<c.length&&p<d.length;){var b=c[p].compareTo(d[p]);if(b!==0)return b;p++}return p<d.length?-1:p<c.length?1:0}},{key:"minCoordinate",value:function(c){for(var d=null,p=0;p<c.length;p++)(d===null||d.compareTo(c[p])>0)&&(d=c[p]);return d}},{key:"extract",value:function(c,d,p){d=Ar.clamp(d,0,c.length);var b=(p=Ar.clamp(p,-1,c.length))-d+1;p<0&&(b=0),d>=c.length&&(b=0),p<d&&(b=0);var L=new Array(b).fill(null);if(b===0)return L;for(var O=0,V=d;V<=p;V++)L[O++]=c[V];return L}}]),I}(),Tr=function(){function I(){n(this,I)}return a(I,[{key:"compare",value:function(c,d){var p=c,b=d;return Kn.compare(p,b)}},{key:"interfaces_",get:function(){return[kt]}}]),I}(),No=function(){function I(){n(this,I)}return a(I,[{key:"compare",value:function(c,d){var p=c,b=d;if(p.length<b.length)return-1;if(p.length>b.length)return 1;if(p.length===0)return 0;var L=Kn.compare(p,b);return Kn.isEqualReversed(p,b)?0:L}},{key:"OLDcompare",value:function(c,d){var p=c,b=d;if(p.length<b.length)return-1;if(p.length>b.length)return 1;if(p.length===0)return 0;for(var L=Kn.increasingDirection(p),O=Kn.increasingDirection(b),V=L>0?0:p.length-1,K=O>0?0:p.length-1,pe=0;pe<p.length;pe++){var Be=p[V].compareTo(b[K]);if(Be!==0)return Be;V+=L,K+=O}return 0}},{key:"interfaces_",get:function(){return[kt]}}]),I}();Kn.ForwardComparator=Tr,Kn.BidirectionalComparator=No,Kn.coordArrayType=new Array(0).fill(null);var ei=function(){function I(c){n(this,I),this.str=c}return a(I,[{key:"append",value:function(c){this.str+=c}},{key:"setCharAt",value:function(c,d){this.str=this.str.substr(0,c)+d+this.str.substr(c+1)}},{key:"toString",value:function(){return this.str}}]),I}(),bo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getM",value:function(c){return this.hasM()?this._coordinates[c].getM():vt.NaN}},{key:"setOrdinate",value:function(c,d,p){switch(d){case xn.X:this._coordinates[c].x=p;break;case xn.Y:this._coordinates[c].y=p;break;default:this._coordinates[c].setOrdinate(d,p)}}},{key:"getZ",value:function(c){return this.hasZ()?this._coordinates[c].getZ():vt.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(c,d){switch(d){case xn.X:return this._coordinates[c].x;case xn.Y:return this._coordinates[c].y;default:return this._coordinates[c].getOrdinate(d)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var c=arguments[0];return this._coordinates[c]}if(arguments.length===2){var d=arguments[0],p=arguments[1];p.setCoordinate(this._coordinates[d])}}},{key:"getCoordinateCopy",value:function(c){var d=this.createCoordinate();return d.setCoordinate(this._coordinates[c]),d}},{key:"createCoordinate",value:function(){return fi.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(c){return this._coordinates[c].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(c){for(var d=0;d<this._coordinates.length;d++)c.expandToInclude(this._coordinates[d]);return c}},{key:"copy",value:function(){for(var c=new Array(this.size()).fill(null),d=0;d<this._coordinates.length;d++){var p=this.createCoordinate();p.setCoordinate(this._coordinates[d]),c[d]=p}return new I(c,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var c=new ei(17*this._coordinates.length);c.append("("),c.append(this._coordinates[0]);for(var d=1;d<this._coordinates.length;d++)c.append(", "),c.append(this._coordinates[d]);return c.append(")"),c.toString()}return"()"}},{key:"getY",value:function(c){return this._coordinates[c].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[xn,be]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];I.constructor_.call(this,c,Kn.dimension(c),Kn.measures(c))}else if(Number.isInteger(arguments[0])){var d=arguments[0];this._coordinates=new Array(d).fill(null);for(var p=0;p<d;p++)this._coordinates[p]=new We}else if(Jt(arguments[0],xn)){var b=arguments[0];if(b===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=b.getDimension(),this._measures=b.getMeasures(),this._coordinates=new Array(b.size()).fill(null);for(var L=0;L<this._coordinates.length;L++)this._coordinates[L]=b.getCoordinateCopy(L)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var O=arguments[0],V=arguments[1];I.constructor_.call(this,O,V,Kn.measures(O))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var K=arguments[0],pe=arguments[1];this._coordinates=new Array(K).fill(null),this._dimension=pe;for(var Be=0;Be<K;Be++)this._coordinates[Be]=fi.create(pe)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var $e=arguments[0],mt=arguments[1],Ft=arguments[2];this._dimension=mt,this._measures=Ft,this._coordinates=$e===null?new Array(0).fill(null):$e}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var Nt=arguments[0],gn=arguments[1],vn=arguments[2];this._coordinates=new Array(Nt).fill(null),this._dimension=gn,this._measures=vn;for(var Ln=0;Ln<Nt;Ln++)this._coordinates[Ln]=this.createCoordinate()}}}}]),I}(),aa=function(){function I(){n(this,I)}return a(I,[{key:"readResolve",value:function(){return I.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return new bo(c)}if(Jt(arguments[0],xn)){var d=arguments[0];return new bo(d)}}else{if(arguments.length===2){var p=arguments[0],b=arguments[1];return b>3&&(b=3),b<2&&(b=2),new bo(p,b)}if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2],K=O-V;return V>1&&(V=1),K>3&&(K=3),K<2&&(K=2),new bo(L,K+V,V)}}}},{key:"interfaces_",get:function(){return[Zr,be]}}],[{key:"instance",value:function(){return I.instanceObject}}]),I}();aa.instanceObject=new aa;var Cr=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&U(m(d.prototype),"equalsExact",this).call(this,p,b)}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var p=new At,b=0;b<this._geometries.length;b++)for(var L=this._geometries[b].getBoundary(),O=0;O<L.getNumGeometries();O++)p.add(L.getGeometryN(O));var V=new Array(p.size()).fill(null);return this.getFactory().createMultiLineString(p.toArray(V))}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Dt]}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];Cn.constructor_.call(this,p,b)}}]),d}(Cn),Nr=function(){function I(){n(this,I)}return a(I,[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}]),I}(),yc=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),(p=c.call(this)).map=new Map,p}return a(d,[{key:"get",value:function(p){return this.map.get(p)||null}},{key:"put",value:function(p,b){return this.map.set(p,b),b}},{key:"values",value:function(){for(var p=new At,b=this.map.values(),L=b.next();!L.done;)p.add(L.value),L=b.next();return p}},{key:"entrySet",value:function(){var p=new On;return this.map.entries().forEach(function(b){return p.add(b)}),p}},{key:"size",value:function(){return this.map.size()}}]),d}(Nr),Ni=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"equals",value:function(c){if(!(c instanceof I))return!1;var d=c;return this._modelType===d._modelType&&this._scale===d._scale}},{key:"compareTo",value:function(c){var d=c,p=this.getMaximumSignificantDigits(),b=d.getMaximumSignificantDigits();return Yi.compare(p,b)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===I.FLOATING||this._modelType===I.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var c="UNKNOWN";return this._modelType===I.FLOATING?c="Floating":this._modelType===I.FLOATING_SINGLE?c="Floating-Single":this._modelType===I.FIXED&&(c="Fixed (Scale="+this.getScale()+")"),c}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var c=arguments[0];return vt.isNaN(c)||this._modelType===I.FLOATING_SINGLE?c:this._modelType===I.FIXED?Math.round(c*this._scale)/this._scale:c}if(arguments[0]instanceof We){var d=arguments[0];if(this._modelType===I.FLOATING)return null;d.x=this.makePrecise(d.x),d.y=this.makePrecise(d.y)}}},{key:"getMaximumSignificantDigits",value:function(){var c=16;return this._modelType===I.FLOATING?c=16:this._modelType===I.FLOATING_SINGLE?c=6:this._modelType===I.FIXED&&(c=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),c}},{key:"setScale",value:function(c){this._scale=Math.abs(c)}},{key:"interfaces_",get:function(){return[be,ce]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=I.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof or){var c=arguments[0];this._modelType=c,c===I.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var d=arguments[0];this._modelType=I.FIXED,this.setScale(d)}else if(arguments[0]instanceof I){var p=arguments[0];this._modelType=p._modelType,this._scale=p._scale}}}},{key:"mostPrecise",value:function(c,d){return c.compareTo(d)>=0?c:d}}]),I}(),or=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"readResolve",value:function(){return I.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[be]}}],[{key:"constructor_",value:function(){this._name=null;var c=arguments[0];this._name=c,I.nameToTypeMap.put(c,this)}}]),I}();or.nameToTypeMap=new yc,Ni.Type=or,Ni.FIXED=new or("FIXED"),Ni.FLOATING=new or("FLOATING"),Ni.FLOATING_SINGLE=new or("FLOATING SINGLE"),Ni.maximumPreciseValue=9007199254740992;var no=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ot){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&U(m(d.prototype),"equalsExact",this).call(this,p,b)}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?ue.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var p=0;p<this._geometries.length;p++)if(!this._geometries[p].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return Ot.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new Lt}},{key:"getGeometryType",value:function(){return Ot.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[$]}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];Cn.constructor_.call(this,p,b)}}]),d}(Cn),Qr=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"createEmpty",value:function(c){switch(c){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new ve("Invalid dimension: "+c)}}},{key:"toGeometry",value:function(c){return c.isNull()?this.createPoint():c.getMinX()===c.getMaxX()&&c.getMinY()===c.getMaxY()?this.createPoint(new We(c.getMinX(),c.getMinY())):c.getMinX()===c.getMaxX()||c.getMinY()===c.getMaxY()?this.createLineString([new We(c.getMinX(),c.getMinY()),new We(c.getMaxX(),c.getMaxY())]):this.createPolygon(this.createLinearRing([new We(c.getMinX(),c.getMinY()),new We(c.getMinX(),c.getMaxY()),new We(c.getMaxX(),c.getMaxY()),new We(c.getMaxX(),c.getMinY()),new We(c.getMinX(),c.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return this.createLineString(c!==null?this.getCoordinateSequenceFactory().create(c):null)}if(Jt(arguments[0],xn)){var d=arguments[0];return new Xe(d,this)}}}},{key:"createMultiLineString",value:function(){if(arguments.length===0)return new no(null,this);if(arguments.length===1){var c=arguments[0];return new no(c,this)}}},{key:"buildGeometry",value:function(c){for(var d=null,p=!1,b=!1,L=c.iterator();L.hasNext();){var O=L.next(),V=O.getTypeCode();d===null&&(d=V),V!==d&&(p=!0),O instanceof Cn&&(b=!0)}if(d===null)return this.createGeometryCollection();if(p||b)return this.createGeometryCollection(I.toGeometryArray(c));var K=c.iterator().next();if(c.size()>1){if(K instanceof en)return this.createMultiPolygon(I.toPolygonArray(c));if(K instanceof Xe)return this.createMultiLineString(I.toLineStringArray(c));if(K instanceof et)return this.createMultiPoint(I.toPointArray(c));It.shouldNeverReachHere("Unhandled geometry type: "+K.getGeometryType())}return K}},{key:"createMultiPointFromCoords",value:function(c){return this.createMultiPoint(c!==null?this.getCoordinateSequenceFactory().create(c):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof We){var c=arguments[0];return this.createPoint(c!==null?this.getCoordinateSequenceFactory().create([c]):null)}if(Jt(arguments[0],xn)){var d=arguments[0];return new et(d,this)}}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(Jt(arguments[0],xn)){var c=arguments[0];return this.createPolygon(this.createLinearRing(c))}if(arguments[0]instanceof Array){var d=arguments[0];return this.createPolygon(this.createLinearRing(d))}if(arguments[0]instanceof Ii){var p=arguments[0];return this.createPolygon(p,null)}}else if(arguments.length===2){var b=arguments[0],L=arguments[1];return new en(b,L,this)}}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){if(arguments.length===0)return new Cn(null,this);if(arguments.length===1){var c=arguments[0];return new Cn(c,this)}}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return this.createLinearRing(c!==null?this.getCoordinateSequenceFactory().create(c):null)}if(Jt(arguments[0],xn)){var d=arguments[0];return new Ii(d,this)}}}},{key:"createMultiPolygon",value:function(){if(arguments.length===0)return new Cr(null,this);if(arguments.length===1){var c=arguments[0];return new Cr(c,this)}}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new Un(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return new Un(c,this)}if(Jt(arguments[0],xn)){var d=arguments[0];if(d===null)return this.createMultiPoint(new Array(0).fill(null));for(var p=new Array(d.size()).fill(null),b=0;b<d.size();b++){var L=this.getCoordinateSequenceFactory().create(1,d.getDimension(),d.getMeasures());he.copy(d,b,L,0,1),p[b]=this.createPoint(L)}return this.createMultiPoint(p)}}}},{key:"interfaces_",get:function(){return[be]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)I.constructor_.call(this,new Ni,0);else if(arguments.length===1){if(Jt(arguments[0],Zr)){var c=arguments[0];I.constructor_.call(this,new Ni,0,c)}else if(arguments[0]instanceof Ni){var d=arguments[0];I.constructor_.call(this,d,0,I.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];I.constructor_.call(this,p,b,I.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];this._precisionModel=L,this._coordinateSequenceFactory=V,this._SRID=O}}},{key:"toMultiPolygonArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toGeometryArray",value:function(c){if(c===null)return null;var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return aa.instance()}},{key:"toMultiLineStringArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toLineStringArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toMultiPointArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toLinearRingArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toPointArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toPolygonArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"createPointFromInternalCoord",value:function(c,d){return d.getPrecisionModel().makePrecise(c),d.getFactory().createPoint(c)}}]),I}(),zi="XY",la="XYZ",_s="XYM",Ui="XYZM",ua={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},es="EMPTY",zo=1,Qi=2,io=3,ca=4,ts=5,ro=6;for(var ti in ua)ua[ti].toUpperCase();var El=function(){function I(c){n(this,I),this.wkt=c,this.index_=-1}return a(I,[{key:"isAlpha_",value:function(c){return c>="a"&&c<="z"||c>="A"&&c<="Z"}},{key:"isNumeric_",value:function(c,d){return c>="0"&&c<="9"||c=="."&&!(d!==void 0&&d)}},{key:"isWhiteSpace_",value:function(c){return c==" "||c=="	"||c=="\r"||c==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var c,d=this.nextChar_(),p=this.index_,b=d;if(d=="(")c=Qi;else if(d==",")c=ts;else if(d==")")c=io;else if(this.isNumeric_(d)||d=="-")c=ca,b=this.readNumber_();else if(this.isAlpha_(d))c=zo,b=this.readText_();else{if(this.isWhiteSpace_(d))return this.nextToken();if(d!=="")throw new Error("Unexpected character: "+d);c=ro}return{position:p,value:b,type:c}}},{key:"readNumber_",value:function(){var c,d=this.index_,p=!1,b=!1;do c=="."?p=!0:c!="e"&&c!="E"||(b=!0),c=this.nextChar_();while(this.isNumeric_(c,p)||!b&&(c=="e"||c=="E")||b&&(c=="-"||c=="+"));return parseFloat(this.wkt.substring(d,this.index_--))}},{key:"readText_",value:function(){var c,d=this.index_;do c=this.nextChar_();while(this.isAlpha_(c));return this.wkt.substring(d,this.index_--).toUpperCase()}}]),I}(),Al=function(){function I(c,d){n(this,I),this.lexer_=c,this.token_,this.layout_=zi,this.factory=d}return a(I,[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(c){return this.token_.type==c}},{key:"match",value:function(c){var d=this.isTokenType(c);return d&&this.consume_(),d}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var c=zi,d=this.token_;if(this.isTokenType(zo)){var p=d.value;p==="Z"?c=la:p==="M"?c=_s:p==="ZM"&&(c=Ui),c!==zi&&this.consume_()}return c}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(Qi)){var c=[];do c.push(this.parseGeometry_());while(this.match(ts));if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(Qi)){var c=this.parsePoint_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(Qi)){var c=this.parsePointList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(Qi)){var c=this.parseLineStringTextList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var c;if(this.match(Qi)){if(c=this.token_.type==Qi?this.parsePointTextList_():this.parsePointList_(),this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(Qi)){var c=this.parseLineStringTextList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(Qi)){var c=this.parsePolygonTextList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var c=[],d=this.layout_.length,p=0;p<d;++p){var b=this.token_;if(!this.match(ca))break;c.push(b.value)}if(c.length==d)return c;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var c=[this.parsePoint_()];this.match(ts);)c.push(this.parsePoint_());return c}},{key:"parsePointTextList_",value:function(){for(var c=[this.parsePointText_()];this.match(ts);)c.push(this.parsePointText_());return c}},{key:"parseLineStringTextList_",value:function(){for(var c=[this.parseLineStringText_()];this.match(ts);)c.push(this.parseLineStringText_());return c}},{key:"parsePolygonTextList_",value:function(){for(var c=[this.parsePolygonText_()];this.match(ts);)c.push(this.parsePolygonText_());return c}},{key:"isEmptyGeometry_",value:function(){var c=this.isTokenType(zo)&&this.token_.value==es;return c&&this.consume_(),c}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var c=this.factory,d=function(vn){return S(We,ee(vn))},p=function(vn){var Ln=vn.map(function(ni){return c.createLinearRing(ni.map(d))});return Ln.length>1?c.createPolygon(Ln[0],Ln.slice(1)):c.createPolygon(Ln[0])},b=this.token_;if(this.match(zo)){var L=b.value;if(this.layout_=this.parseGeometryLayout_(),L=="GEOMETRYCOLLECTION"){var O=this.parseGeometryCollectionText_();return c.createGeometryCollection(O)}switch(L){case"POINT":var V=this.parsePointText_();return V?c.createPoint(S(We,ee(V))):c.createPoint();case"LINESTRING":var K=this.parseLineStringText_().map(d);return c.createLineString(K);case"LINEARRING":var pe=this.parseLineStringText_().map(d);return c.createLinearRing(pe);case"POLYGON":var Be=this.parsePolygonText_();return Be&&Be.length!==0?p(Be):c.createPolygon();case"MULTIPOINT":var $e=this.parseMultiPointText_();if(!$e||$e.length===0)return c.createMultiPoint();var mt=$e.map(d).map(function(vn){return c.createPoint(vn)});return c.createMultiPoint(mt);case"MULTILINESTRING":var Ft=this.parseMultiLineStringText_().map(function(vn){return c.createLineString(vn.map(d))});return c.createMultiLineString(Ft);case"MULTIPOLYGON":var Nt=this.parseMultiPolygonText_();if(!Nt||Nt.length===0)return c.createMultiPolygon();var gn=Nt.map(p);return c.createMultiPolygon(gn);default:throw new Error("Invalid geometry type: "+L)}}throw new Error(this.formatErrorMessage_())}}]),I}();function xo(I){if(I.isEmpty())return"";var c=I.getCoordinate(),d=[c.x,c.y];return c.z===void 0||Number.isNaN(c.z)||d.push(c.z),c.m===void 0||Number.isNaN(c.m)||d.push(c.m),d.join(" ")}function wo(I){for(var c=I.getCoordinates().map(function(L){var O=[L.x,L.y];return L.z===void 0||Number.isNaN(L.z)||O.push(L.z),L.m===void 0||Number.isNaN(L.m)||O.push(L.m),O}),d=[],p=0,b=c.length;p<b;++p)d.push(c[p].join(" "));return d.join(", ")}function ha(I){var c=[];c.push("("+wo(I.getExteriorRing())+")");for(var d=0,p=I.getNumInteriorRing();d<p;++d)c.push("("+wo(I.getInteriorRingN(d))+")");return c.join(", ")}var fa={Point:xo,LineString:wo,LinearRing:wo,Polygon:ha,MultiPoint:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push("("+xo(I.getGeometryN(d))+")");return c.join(", ")},MultiLineString:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push("("+wo(I.getGeometryN(d))+")");return c.join(", ")},MultiPolygon:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push("("+ha(I.getGeometryN(d))+")");return c.join(", ")},GeometryCollection:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push(da(I.getGeometryN(d)));return c.join(", ")}};function da(I){var c=I.getGeometryType(),d=fa[c];c=c.toUpperCase();var p=function(b){var L="";if(b.isEmpty())return L;var O=b.getCoordinate();return O.z===void 0||Number.isNaN(O.z)||(L+="Z"),O.m===void 0||Number.isNaN(O.m)||(L+="M"),L}(I);return p.length>0&&(c+=" "+p),I.isEmpty()?c+" "+es:c+" ("+d(I)+")"}var Fo=function(){function I(c){n(this,I),this.geometryFactory=c||new Qr,this.precisionModel=this.geometryFactory.getPrecisionModel()}return a(I,[{key:"read",value:function(c){var d=new El(c);return new Al(d,this.geometryFactory).parse()}},{key:"write",value:function(c){return da(c)}}]),I}(),za=function(){function I(c){n(this,I),this.parser=new Fo(c)}return a(I,[{key:"write",value:function(c){return this.parser.write(c)}}],[{key:"toLineString",value:function(c,d){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+c.x+" "+c.y+", "+d.x+" "+d.y+" )"}}]),I}(),Si=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getIndexAlongSegment",value:function(c,d){return this.computeIntLineIndex(),this._intLineIndex[c][d]}},{key:"getTopologySummary",value:function(){var c=new ei;return this.isEndPoint()&&c.append(" endpoint"),this._isProper&&c.append(" proper"),this.isCollinear()&&c.append(" collinear"),c.toString()}},{key:"computeIntersection",value:function(c,d,p,b){this._inputLines[0][0]=c,this._inputLines[0][1]=d,this._inputLines[1][0]=p,this._inputLines[1][1]=b,this._result=this.computeIntersect(c,d,p,b)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var c=arguments[0],d=this.getEdgeDistance(c,0),p=this.getEdgeDistance(c,1);d>p?(this._intLineIndex[c][0]=0,this._intLineIndex[c][1]=1):(this._intLineIndex[c][0]=1,this._intLineIndex[c][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(c){this._precisionModel=c}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var c=arguments[0],d=0;d<this._result;d++)if(!this._intPt[d].equals2D(this._inputLines[c][0])&&!this._intPt[d].equals2D(this._inputLines[c][1]))return!0;return!1}}},{key:"getIntersection",value:function(c){return this._intPt[c]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==I.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(c,d){return I.computeEdgeDistance(this._intPt[d],this._inputLines[c][0],this._inputLines[c][1])}},{key:"isCollinear",value:function(){return this._result===I.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return za.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+za.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(c,d){return this._inputLines[c][d]}},{key:"isIntersection",value:function(c){for(var d=0;d<this._result;d++)if(this._intPt[d].equals2D(c))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(c,d){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[c][d]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new We,this._intPt[1]=new We,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(c,d,p){var b=Math.abs(p.x-d.x),L=Math.abs(p.y-d.y),O=-1;if(c.equals(d))O=0;else if(c.equals(p))O=b>L?b:L;else{var V=Math.abs(c.x-d.x),K=Math.abs(c.y-d.y);(O=b>L?V:K)!==0||c.equals(d)||(O=Math.max(V,K))}return It.isTrue(!(O===0&&!c.equals(d)),"Bad distance calculation"),O}},{key:"nonRobustComputeEdgeDistance",value:function(c,d,p){var b=c.x-d.x,L=c.y-d.y,O=Math.sqrt(b*b+L*L);return It.isTrue(!(O===0&&!c.equals(d)),"Invalid distance calculation"),O}}]),I}();Si.DONT_INTERSECT=0,Si.DO_INTERSECT=1,Si.COLLINEAR=2,Si.NO_INTERSECTION=0,Si.POINT_INTERSECTION=1,Si.COLLINEAR_INTERSECTION=2;var so=function(I){h(d,I);var c=B(d);function d(){return n(this,d),c.call(this)}return a(d,[{key:"isInSegmentEnvelopes",value:function(p){var b=new dn(this._inputLines[0][0],this._inputLines[0][1]),L=new dn(this._inputLines[1][0],this._inputLines[1][1]);return b.contains(p)&&L.contains(p)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return U(m(d.prototype),"computeIntersection",this).apply(this,arguments);var p=arguments[0],b=arguments[1],L=arguments[2];if(this._isProper=!1,dn.intersects(b,L,p)&&mn.index(b,L,p)===0&&mn.index(L,b,p)===0)return this._isProper=!0,(p.equals(b)||p.equals(L))&&(this._isProper=!1),this._result=Si.POINT_INTERSECTION,null;this._result=Si.NO_INTERSECTION}},{key:"intersection",value:function(p,b,L,O){var V=this.intersectionSafe(p,b,L,O);return this.isInSegmentEnvelopes(V)||(V=new We(d.nearestEndpoint(p,b,L,O))),this._precisionModel!==null&&this._precisionModel.makePrecise(V),V}},{key:"checkDD",value:function(p,b,L,O,V){var K=yr.intersection(p,b,L,O),pe=this.isInSegmentEnvelopes(K);Pi.out.println("DD in env = "+pe+"  --------------------- "+K),V.distance(K)>1e-4&&Pi.out.println("Distance = "+V.distance(K))}},{key:"intersectionSafe",value:function(p,b,L,O){var V=bn.intersection(p,b,L,O);return V===null&&(V=d.nearestEndpoint(p,b,L,O)),V}},{key:"computeCollinearIntersection",value:function(p,b,L,O){var V=dn.intersects(p,b,L),K=dn.intersects(p,b,O),pe=dn.intersects(L,O,p),Be=dn.intersects(L,O,b);return V&&K?(this._intPt[0]=L,this._intPt[1]=O,Si.COLLINEAR_INTERSECTION):pe&&Be?(this._intPt[0]=p,this._intPt[1]=b,Si.COLLINEAR_INTERSECTION):V&&pe?(this._intPt[0]=L,this._intPt[1]=p,!L.equals(p)||K||Be?Si.COLLINEAR_INTERSECTION:Si.POINT_INTERSECTION):V&&Be?(this._intPt[0]=L,this._intPt[1]=b,!L.equals(b)||K||pe?Si.COLLINEAR_INTERSECTION:Si.POINT_INTERSECTION):K&&pe?(this._intPt[0]=O,this._intPt[1]=p,!O.equals(p)||V||Be?Si.COLLINEAR_INTERSECTION:Si.POINT_INTERSECTION):K&&Be?(this._intPt[0]=O,this._intPt[1]=b,!O.equals(b)||V||pe?Si.COLLINEAR_INTERSECTION:Si.POINT_INTERSECTION):Si.NO_INTERSECTION}},{key:"computeIntersect",value:function(p,b,L,O){if(this._isProper=!1,!dn.intersects(p,b,L,O))return Si.NO_INTERSECTION;var V=mn.index(p,b,L),K=mn.index(p,b,O);if(V>0&&K>0||V<0&&K<0)return Si.NO_INTERSECTION;var pe=mn.index(L,O,p),Be=mn.index(L,O,b);return pe>0&&Be>0||pe<0&&Be<0?Si.NO_INTERSECTION:V===0&&K===0&&pe===0&&Be===0?this.computeCollinearIntersection(p,b,L,O):(V===0||K===0||pe===0||Be===0?(this._isProper=!1,p.equals2D(L)||p.equals2D(O)?this._intPt[0]=p:b.equals2D(L)||b.equals2D(O)?this._intPt[0]=b:V===0?this._intPt[0]=new We(L):K===0?this._intPt[0]=new We(O):pe===0?this._intPt[0]=new We(p):Be===0&&(this._intPt[0]=new We(b))):(this._isProper=!0,this._intPt[0]=this.intersection(p,b,L,O)),Si.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(p,b,L,O){var V=p,K=Ji.pointToSegment(p,L,O),pe=Ji.pointToSegment(b,L,O);return pe<K&&(K=pe,V=b),(pe=Ji.pointToSegment(L,p,b))<K&&(K=pe,V=L),(pe=Ji.pointToSegment(O,p,b))<K&&(K=pe,V=O),V}}]),d}(Si),vc=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"countSegment",value:function(c,d){if(c.x<this._p.x&&d.x<this._p.x)return null;if(this._p.x===d.x&&this._p.y===d.y)return this._isPointOnSegment=!0,null;if(c.y===this._p.y&&d.y===this._p.y){var p=c.x,b=d.x;return p>b&&(p=d.x,b=c.x),this._p.x>=p&&this._p.x<=b&&(this._isPointOnSegment=!0),null}if(c.y>this._p.y&&d.y<=this._p.y||d.y>this._p.y&&c.y<=this._p.y){var L=mn.index(c,d,this._p);if(L===mn.COLLINEAR)return this._isPointOnSegment=!0,null;d.y<c.y&&(L=-L),L===mn.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==Ee.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?Ee.BOUNDARY:this._crossingCount%2==1?Ee.INTERIOR:Ee.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var c=arguments[0];this._p=c}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof We&&Jt(arguments[1],xn)){for(var c=arguments[0],d=arguments[1],p=new I(c),b=new We,L=new We,O=1;O<d.size();O++)if(d.getCoordinate(O,b),d.getCoordinate(O-1,L),p.countSegment(b,L),p.isOnSegment())return p.getLocation();return p.getLocation()}if(arguments[0]instanceof We&&arguments[1]instanceof Array){for(var V=arguments[0],K=arguments[1],pe=new I(V),Be=1;Be<K.length;Be++){var $e=K[Be],mt=K[Be-1];if(pe.countSegment($e,mt),pe.isOnSegment())return pe.getLocation()}return pe.getLocation()}}}]),I}(),qs=function(){function I(){n(this,I)}return a(I,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof We&&Jt(arguments[1],xn)){for(var c=arguments[0],d=arguments[1],p=new so,b=new We,L=new We,O=d.size(),V=1;V<O;V++)if(d.getCoordinate(V-1,b),d.getCoordinate(V,L),p.computeIntersection(c,b,L),p.hasIntersection())return!0;return!1}if(arguments[0]instanceof We&&arguments[1]instanceof Array){for(var K=arguments[0],pe=arguments[1],Be=new so,$e=1;$e<pe.length;$e++){var mt=pe[$e-1],Ft=pe[$e];if(Be.computeIntersection(K,mt,Ft),Be.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(c,d){return vc.locatePointInRing(c,d)}},{key:"isInRing",value:function(c,d){return I.locateInRing(c,d)!==Ee.EXTERIOR}}]),I}(),br=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setAllLocations",value:function(c){for(var d=0;d<this.location.length;d++)this.location[d]=c}},{key:"isNull",value:function(){for(var c=0;c<this.location.length;c++)if(this.location[c]!==Ee.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(c){for(var d=0;d<this.location.length;d++)this.location[d]===Ee.NONE&&(this.location[d]=c)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(c){if(c.location.length>this.location.length){var d=new Array(3).fill(null);d[Ie.ON]=this.location[Ie.ON],d[Ie.LEFT]=Ee.NONE,d[Ie.RIGHT]=Ee.NONE,this.location=d}for(var p=0;p<this.location.length;p++)this.location[p]===Ee.NONE&&p<c.location.length&&(this.location[p]=c.location[p])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var c=this.location[Ie.LEFT];this.location[Ie.LEFT]=this.location[Ie.RIGHT],this.location[Ie.RIGHT]=c}},{key:"toString",value:function(){var c=new Ri;return this.location.length>1&&c.append(Ee.toLocationSymbol(this.location[Ie.LEFT])),c.append(Ee.toLocationSymbol(this.location[Ie.ON])),this.location.length>1&&c.append(Ee.toLocationSymbol(this.location[Ie.RIGHT])),c.toString()}},{key:"setLocations",value:function(c,d,p){this.location[Ie.ON]=c,this.location[Ie.LEFT]=d,this.location[Ie.RIGHT]=p}},{key:"get",value:function(c){return c<this.location.length?this.location[c]:Ee.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var c=0;c<this.location.length;c++)if(this.location[c]===Ee.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var c=arguments[0];this.setLocation(Ie.ON,c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.location[d]=p}}},{key:"init",value:function(c){this.location=new Array(c).fill(null),this.setAllLocations(Ee.NONE)}},{key:"isEqualOnSide",value:function(c,d){return this.location[d]===c.location[d]}},{key:"allPositionsEqual",value:function(c){for(var d=0;d<this.location.length;d++)if(this.location[d]!==c)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];this.init(c.length)}else if(Number.isInteger(arguments[0])){var d=arguments[0];this.init(1),this.location[Ie.ON]=d}else if(arguments[0]instanceof I){var p=arguments[0];if(this.init(p.location.length),p!==null)for(var b=0;b<this.location.length;b++)this.location[b]=p.location[b]}}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];this.init(3),this.location[Ie.ON]=L,this.location[Ie.LEFT]=O,this.location[Ie.RIGHT]=V}}}]),I}(),xi=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getGeometryCount",value:function(){var c=0;return this.elt[0].isNull()||c++,this.elt[1].isNull()||c++,c}},{key:"setAllLocations",value:function(c,d){this.elt[c].setAllLocations(d)}},{key:"isNull",value:function(c){return this.elt[c].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var c=arguments[0];this.setAllLocationsIfNull(0,c),this.setAllLocationsIfNull(1,c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.elt[d].setAllLocationsIfNull(p)}}},{key:"isLine",value:function(c){return this.elt[c].isLine()}},{key:"merge",value:function(c){for(var d=0;d<2;d++)this.elt[d]===null&&c.elt[d]!==null?this.elt[d]=new br(c.elt[d]):this.elt[d].merge(c.elt[d])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var c=arguments[0];return this.elt[c].get(Ie.ON)}if(arguments.length===2){var d=arguments[0],p=arguments[1];return this.elt[d].get(p)}}},{key:"toString",value:function(){var c=new Ri;return this.elt[0]!==null&&(c.append("A:"),c.append(this.elt[0].toString())),this.elt[1]!==null&&(c.append(" B:"),c.append(this.elt[1].toString())),c.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var c=arguments[0];return this.elt[c].isArea()}}},{key:"isAnyNull",value:function(c){return this.elt[c].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];this.elt[c].setLocation(Ie.ON,d)}else if(arguments.length===3){var p=arguments[0],b=arguments[1],L=arguments[2];this.elt[p].setLocation(b,L)}}},{key:"isEqualOnSide",value:function(c,d){return this.elt[0].isEqualOnSide(c.elt[0],d)&&this.elt[1].isEqualOnSide(c.elt[1],d)}},{key:"allPositionsEqual",value:function(c,d){return this.elt[c].allPositionsEqual(d)}},{key:"toLine",value:function(c){this.elt[c].isArea()&&(this.elt[c]=new br(this.elt[c].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var c=arguments[0];this.elt[0]=new br(c),this.elt[1]=new br(c)}else if(arguments[0]instanceof I){var d=arguments[0];this.elt[0]=new br(d.elt[0]),this.elt[1]=new br(d.elt[1])}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.elt[0]=new br(Ee.NONE),this.elt[1]=new br(Ee.NONE),this.elt[p].setLocation(b)}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];this.elt[0]=new br(L,O,V),this.elt[1]=new br(L,O,V)}else if(arguments.length===4){var K=arguments[0],pe=arguments[1],Be=arguments[2],$e=arguments[3];this.elt[0]=new br(Ee.NONE,Ee.NONE,Ee.NONE),this.elt[1]=new br(Ee.NONE,Ee.NONE,Ee.NONE),this.elt[K].setLocations(pe,Be,$e)}}},{key:"toLineLabel",value:function(c){for(var d=new I(Ee.NONE),p=0;p<2;p++)d.setLocation(p,c.getLocation(p));return d}}]),I}(),cr=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var c=new Array(this._pts.size()).fill(null),d=0;d<this._pts.size();d++)c[d]=this._pts.get(d);this._ring=this._geometryFactory.createLinearRing(c),this._isHole=mn.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(c){this._startDe=c;var d=c,p=!0;do{if(d===null)throw new Mt("Found null DirectedEdge");if(d.getEdgeRing()===this)throw new Mt("Directed Edge visited twice during ring-building at "+d.getCoordinate());this._edges.add(d);var b=d.getLabel();It.isTrue(b.isArea()),this.mergeLabel(b),this.addPoints(d.getEdge(),d.isForward(),p),p=!1,this.setEdgeRing(d,this),d=this.getNext(d)}while(d!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(c){return this._pts.get(c)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var c=this._startDe;do{var d=c.getNode().getEdges().getOutgoingDegree(this);d>this._maxNodeDegree&&(this._maxNodeDegree=d),c=this.getNext(c)}while(c!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(c,d,p){var b=c.getCoordinates();if(d){var L=1;p&&(L=0);for(var O=L;O<b.length;O++)this._pts.add(b[O])}else{var V=b.length-2;p&&(V=b.length-1);for(var K=V;K>=0;K--)this._pts.add(b[K])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var c=this._startDe;do c.getEdge().setInResult(!0),c=c.getNext();while(c!==this._startDe)}},{key:"containsPoint",value:function(c){var d=this.getLinearRing();if(!d.getEnvelopeInternal().contains(c)||!qs.isInRing(c,d.getCoordinates()))return!1;for(var p=this._holes.iterator();p.hasNext();)if(p.next().containsPoint(c))return!1;return!0}},{key:"addHole",value:function(c){this._holes.add(c)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var c=arguments[0];this.mergeLabel(c,0),this.mergeLabel(c,1)}else if(arguments.length===2){var d=arguments[0],p=arguments[1],b=d.getLocation(p,Ie.RIGHT);if(b===Ee.NONE)return null;if(this._label.getLocation(p)===Ee.NONE)return this._label.setLocation(p,b),null}}},{key:"setShell",value:function(c){this._shell=c,c!==null&&c.addHole(this)}},{key:"toPolygon",value:function(c){for(var d=new Array(this._holes.size()).fill(null),p=0;p<this._holes.size();p++)d[p]=this._holes.get(p).getLinearRing();return c.createPolygon(this.getLinearRing(),d)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new At,this._pts=new At,this._label=new xi(Ee.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new At,this._geometryFactory=null,arguments.length!==0&&arguments.length===2){var c=arguments[0],d=arguments[1];this._geometryFactory=d,this.computePoints(c),this.computeRing()}}}]),I}(),Fa=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"setEdgeRing",value:function(p,b){p.setMinEdgeRing(b)}},{key:"getNext",value:function(p){return p.getNextMin()}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];cr.constructor_.call(this,p,b)}}]),d}(cr),Oa=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"buildMinimalRings",value:function(){var p=new At,b=this._startDe;do{if(b.getMinEdgeRing()===null){var L=new Fa(b,this._geometryFactory);p.add(L)}b=b.getNext()}while(b!==this._startDe);return p}},{key:"setEdgeRing",value:function(p,b){p.setEdgeRing(b)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var p=this._startDe;do p.getNode().getEdges().linkMinimalDirectedEdges(this),p=p.getNext();while(p!==this._startDe)}},{key:"getNext",value:function(p){return p.getNext()}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];cr.constructor_.call(this,p,b)}}]),d}(cr),pa=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setVisited",value:function(c){this._isVisited=c}},{key:"setInResult",value:function(c){this._isInResult=c}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(c){this._label=c}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(c){this._isCovered=c,this._isCoveredSet=!0}},{key:"updateIM",value:function(c){It.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(c)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var c=arguments[0];this._label=c}}}]),I}(),ma=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"isIncidentEdgeInResult",value:function(){for(var p=this.getEdges().getEdges().iterator();p.hasNext();)if(p.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(p){p.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(p){}},{key:"computeMergedLocation",value:function(p,b){var L=Ee.NONE;if(L=this._label.getLocation(b),!p.isNull(b)){var O=p.getLocation(b);L!==Ee.BOUNDARY&&(L=O)}return L}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return U(m(d.prototype),"setLabel",this).apply(this,arguments);var p=arguments[0],b=arguments[1];this._label===null?this._label=new xi(p,b):this._label.setLocation(p,b)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof d){var p=arguments[0];this.mergeLabel(p._label)}else if(arguments[0]instanceof xi)for(var b=arguments[0],L=0;L<2;L++){var O=this.computeMergedLocation(b,L),V=this._label.getLocation(L);V===Ee.NONE&&this._label.setLocation(L,O)}}},{key:"add",value:function(p){this._edges.insert(p),p.setNode(this)}},{key:"setLabelBoundary",value:function(p){if(this._label===null)return null;var b=Ee.NONE;this._label!==null&&(b=this._label.getLocation(p));var L=null;switch(b){case Ee.BOUNDARY:L=Ee.INTERIOR;break;case Ee.INTERIOR:default:L=Ee.BOUNDARY}this._label.setLocation(p,L)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var p=arguments[0],b=arguments[1];this._coord=p,this._edges=b,this._label=new xi(0,Ee.NONE)}}]),d}(pa),Oo=function(I){h(d,I);var c=B(d);function d(){return n(this,d),c.apply(this,arguments)}return d}(Nr);function au(I){return I==null?0:I.color}function si(I){return I==null?null:I.parent}function ys(I,c){I!==null&&(I.color=c)}function Tl(I){return I==null?null:I.left}function lu(I){return I==null?null:I.right}var Bo=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),(p=c.call(this)).root_=null,p.size_=0,p}return a(d,[{key:"get",value:function(p){for(var b=this.root_;b!==null;){var L=p.compareTo(b.key);if(L<0)b=b.left;else{if(!(L>0))return b.value;b=b.right}}return null}},{key:"put",value:function(p,b){if(this.root_===null)return this.root_={key:p,value:b,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var L,O,V=this.root_;do if(L=V,(O=p.compareTo(V.key))<0)V=V.left;else{if(!(O>0)){var K=V.value;return V.value=b,K}V=V.right}while(V!==null);var pe={key:p,left:null,right:null,value:b,parent:L,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return O<0?L.left=pe:L.right=pe,this.fixAfterInsertion(pe),this.size_++,null}},{key:"fixAfterInsertion",value:function(p){var b;for(p.color=1;p!=null&&p!==this.root_&&p.parent.color===1;)si(p)===Tl(si(si(p)))?au(b=lu(si(si(p))))===1?(ys(si(p),0),ys(b,0),ys(si(si(p)),1),p=si(si(p))):(p===lu(si(p))&&(p=si(p),this.rotateLeft(p)),ys(si(p),0),ys(si(si(p)),1),this.rotateRight(si(si(p)))):au(b=Tl(si(si(p))))===1?(ys(si(p),0),ys(b,0),ys(si(si(p)),1),p=si(si(p))):(p===Tl(si(p))&&(p=si(p),this.rotateRight(p)),ys(si(p),0),ys(si(si(p)),1),this.rotateLeft(si(si(p))));this.root_.color=0}},{key:"values",value:function(){var p=new At,b=this.getFirstEntry();if(b!==null)for(p.add(b.value);(b=d.successor(b))!==null;)p.add(b.value);return p}},{key:"entrySet",value:function(){var p=new On,b=this.getFirstEntry();if(b!==null)for(p.add(b);(b=d.successor(b))!==null;)p.add(b);return p}},{key:"rotateLeft",value:function(p){if(p!=null){var b=p.right;p.right=b.left,b.left!=null&&(b.left.parent=p),b.parent=p.parent,p.parent==null?this.root_=b:p.parent.left===p?p.parent.left=b:p.parent.right=b,b.left=p,p.parent=b}}},{key:"rotateRight",value:function(p){if(p!=null){var b=p.left;p.left=b.right,b.right!=null&&(b.right.parent=p),b.parent=p.parent,p.parent==null?this.root_=b:p.parent.right===p?p.parent.right=b:p.parent.left=b,b.right=p,p.parent=b}}},{key:"getFirstEntry",value:function(){var p=this.root_;if(p!=null)for(;p.left!=null;)p=p.left;return p}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(p){for(var b=this.root_;b!==null;){var L=p.compareTo(b.key);if(L<0)b=b.left;else{if(!(L>0))return!0;b=b.right}}return!1}}],[{key:"successor",value:function(p){var b;if(p===null)return null;if(p.right!==null){for(b=p.right;b.left!==null;)b=b.left;return b}b=p.parent;for(var L=p;b!==null&&L===b.right;)L=b,b=b.parent;return b}}]),d}(Oo),Uo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"find",value:function(c){return this.nodeMap.get(c)}},{key:"addNode",value:function(){if(arguments[0]instanceof We){var c=arguments[0],d=this.nodeMap.get(c);return d===null&&(d=this.nodeFact.createNode(c),this.nodeMap.put(c,d)),d}if(arguments[0]instanceof ma){var p=arguments[0],b=this.nodeMap.get(p.getCoordinate());return b===null?(this.nodeMap.put(p.getCoordinate(),p),p):(b.mergeLabel(p),b)}}},{key:"print",value:function(c){for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(c){for(var d=new At,p=this.iterator();p.hasNext();){var b=p.next();b.getLabel().getLocation(c)===Ee.BOUNDARY&&d.add(b)}return d}},{key:"add",value:function(c){var d=c.getCoordinate();this.addNode(d).add(c)}}],[{key:"constructor_",value:function(){this.nodeMap=new Bo,this.nodeFact=null;var c=arguments[0];this.nodeFact=c}}]),I}(),hr=function(){function I(){n(this,I)}return a(I,null,[{key:"isNorthern",value:function(c){return c===I.NE||c===I.NW}},{key:"isOpposite",value:function(c,d){return c!==d&&(c-d+4)%4===2}},{key:"commonHalfPlane",value:function(c,d){if(c===d)return c;if((c-d+4)%4===2)return-1;var p=c<d?c:d;return p===0&&(c>d?c:d)===3?3:p}},{key:"isInHalfPlane",value:function(c,d){return d===I.SE?c===I.SE||c===I.SW:c===d||c===d+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1];if(c===0&&d===0)throw new ve("Cannot compute the quadrant for point ( "+c+", "+d+" )");return c>=0?d>=0?I.NE:I.SE:d>=0?I.NW:I.SW}if(arguments[0]instanceof We&&arguments[1]instanceof We){var p=arguments[0],b=arguments[1];if(b.x===p.x&&b.y===p.y)throw new ve("Cannot compute the quadrant for two identical points "+p);return b.x>=p.x?b.y>=p.y?I.NE:I.SE:b.y>=p.y?I.NW:I.SW}}}]),I}();hr.NE=0,hr.NW=1,hr.SW=2,hr.SE=3;var ga=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compareDirection",value:function(c){return this._dx===c._dx&&this._dy===c._dy?0:this._quadrant>c._quadrant?1:this._quadrant<c._quadrant?-1:mn.index(c._p0,c._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(c){this._node=c}},{key:"print",value:function(c){var d=Math.atan2(this._dy,this._dx),p=this.getClass().getName(),b=p.lastIndexOf("."),L=p.substring(b+1);c.print("  "+L+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+d+"   "+this._label)}},{key:"compareTo",value:function(c){var d=c;return this.compareDirection(d)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var c=Math.atan2(this._dy,this._dx),d=this.getClass().getName(),p=d.lastIndexOf(".");return"  "+d.substring(p+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+c+"   "+this._label}},{key:"computeLabel",value:function(c){}},{key:"init",value:function(c,d){this._p0=c,this._p1=d,this._dx=d.x-c.x,this._dy=d.y-c.y,this._quadrant=hr.quadrant(this._dx,this._dy),It.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[ce]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var c=arguments[0];this._edge=c}else if(arguments.length===3){var d=arguments[0],p=arguments[1],b=arguments[2];I.constructor_.call(this,d,p,b,null)}else if(arguments.length===4){var L=arguments[0],O=arguments[1],V=arguments[2],K=arguments[3];I.constructor_.call(this,L),this.init(O,V),this._label=K}}}]),I}(),_a=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(p){return this._depth[p]}},{key:"setVisited",value:function(p){this._isVisited=p}},{key:"computeDirectedLabel",value:function(){this._label=new xi(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(p,b){if(this._depth[p]!==-999&&this._depth[p]!==b)throw new Mt("assigned depths do not match",this.getCoordinate());this._depth[p]=b}},{key:"isInteriorAreaEdge",value:function(){for(var p=!0,b=0;b<2;b++)this._label.isArea(b)&&this._label.getLocation(b,Ie.LEFT)===Ee.INTERIOR&&this._label.getLocation(b,Ie.RIGHT)===Ee.INTERIOR||(p=!1);return p}},{key:"setNextMin",value:function(p){this._nextMin=p}},{key:"print",value:function(p){U(m(d.prototype),"print",this).call(this,p),p.print(" "+this._depth[Ie.LEFT]+"/"+this._depth[Ie.RIGHT]),p.print(" ("+this.getDepthDelta()+")"),this._isInResult&&p.print(" inResult")}},{key:"setMinEdgeRing",value:function(p){this._minEdgeRing=p}},{key:"isLineEdge",value:function(){var p=this._label.isLine(0)||this._label.isLine(1),b=!this._label.isArea(0)||this._label.allPositionsEqual(0,Ee.EXTERIOR),L=!this._label.isArea(1)||this._label.allPositionsEqual(1,Ee.EXTERIOR);return p&&b&&L}},{key:"setEdgeRing",value:function(p){this._edgeRing=p}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var p=this._edge.getDepthDelta();return this._isForward||(p=-p),p}},{key:"setInResult",value:function(p){this._isInResult=p}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(p){this.print(p),p.print(" "),this._isForward?this._edge.print(p):this._edge.printReverse(p)}},{key:"setSym",value:function(p){this._sym=p}},{key:"setVisitedEdge",value:function(p){this.setVisited(p),this._sym.setVisited(p)}},{key:"setEdgeDepths",value:function(p,b){var L=this.getEdge().getDepthDelta();this._isForward||(L=-L);var O=1;p===Ie.LEFT&&(O=-1);var V=Ie.opposite(p),K=b+L*O;this.setDepth(p,b),this.setDepth(V,K)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(p){this._next=p}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var p=arguments[0],b=arguments[1];if(ga.constructor_.call(this,p),this._isForward=b,b)this.init(p.getCoordinate(0),p.getCoordinate(1));else{var L=p.getNumPoints()-1;this.init(p.getCoordinate(L),p.getCoordinate(L-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(p,b){return p===Ee.EXTERIOR&&b===Ee.INTERIOR?1:p===Ee.INTERIOR&&b===Ee.EXTERIOR?-1:0}}]),d}(ga),Ba=function(){function I(){n(this,I)}return a(I,[{key:"createNode",value:function(c){return new ma(c,null)}}]),I}(),vs=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"printEdges",value:function(c){c.println("Edges:");for(var d=0;d<this._edges.size();d++){c.println("edge "+d+":");var p=this._edges.get(d);p.print(c),p.eiList.print(c)}}},{key:"find",value:function(c){return this._nodes.find(c)}},{key:"addNode",value:function(){if(arguments[0]instanceof ma){var c=arguments[0];return this._nodes.addNode(c)}if(arguments[0]instanceof We){var d=arguments[0];return this._nodes.addNode(d)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var c=this._nodes.iterator();c.hasNext();)c.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(c){Pi.out.println(c)}},{key:"isBoundaryNode",value:function(c,d){var p=this._nodes.find(d);if(p===null)return!1;var b=p.getLabel();return b!==null&&b.getLocation(c)===Ee.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var c=this._nodes.iterator();c.hasNext();)c.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(c,d,p,b){return!!c.equals(p)&&mn.index(c,d,b)===mn.COLLINEAR&&hr.quadrant(c,d)===hr.quadrant(p,b)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(c){Pi.out.print(c)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(c,d){for(var p=0;p<this._edges.size();p++){var b=this._edges.get(p),L=b.getCoordinates();if(this.matchInSameDirection(c,d,L[0],L[1])||this.matchInSameDirection(c,d,L[L.length-1],L[L.length-2]))return b}return null}},{key:"insertEdge",value:function(c){this._edges.add(c)}},{key:"findEdgeEnd",value:function(c){for(var d=this.getEdgeEnds().iterator();d.hasNext();){var p=d.next();if(p.getEdge()===c)return p}return null}},{key:"addEdges",value:function(c){for(var d=c.iterator();d.hasNext();){var p=d.next();this._edges.add(p);var b=new _a(p,!0),L=new _a(p,!1);b.setSym(L),L.setSym(b),this.add(b),this.add(L)}}},{key:"add",value:function(c){this._nodes.add(c),this._edgeEndList.add(c)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(c,d){for(var p=0;p<this._edges.size();p++){var b=this._edges.get(p),L=b.getCoordinates();if(c.equals(L[0])&&d.equals(L[1]))return b}return null}}],[{key:"constructor_",value:function(){if(this._edges=new At,this._nodes=null,this._edgeEndList=new At,arguments.length===0)this._nodes=new Uo(new Ba);else if(arguments.length===1){var c=arguments[0];this._nodes=new Uo(c)}}},{key:"linkResultDirectedEdges",value:function(c){for(var d=c.iterator();d.hasNext();)d.next().getEdges().linkResultDirectedEdges()}}]),I}(),bc=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"sortShellsAndHoles",value:function(c,d,p){for(var b=c.iterator();b.hasNext();){var L=b.next();L.isHole()?p.add(L):d.add(L)}}},{key:"computePolygons",value:function(c){for(var d=new At,p=c.iterator();p.hasNext();){var b=p.next().toPolygon(this._geometryFactory);d.add(b)}return d}},{key:"placeFreeHoles",value:function(c,d){for(var p=d.iterator();p.hasNext();){var b=p.next();if(b.getShell()===null){var L=I.findEdgeRingContaining(b,c);if(L===null)throw new Mt("unable to assign hole to a shell",b.getCoordinate(0));b.setShell(L)}}}},{key:"buildMinimalEdgeRings",value:function(c,d,p){for(var b=new At,L=c.iterator();L.hasNext();){var O=L.next();if(O.getMaxNodeDegree()>2){O.linkDirectedEdgesForMinimalEdgeRings();var V=O.buildMinimalRings(),K=this.findShell(V);K!==null?(this.placePolygonHoles(K,V),d.add(K)):p.addAll(V)}else b.add(O)}return b}},{key:"buildMaximalEdgeRings",value:function(c){for(var d=new At,p=c.iterator();p.hasNext();){var b=p.next();if(b.isInResult()&&b.getLabel().isArea()&&b.getEdgeRing()===null){var L=new Oa(b,this._geometryFactory);d.add(L),L.setInResult()}}return d}},{key:"placePolygonHoles",value:function(c,d){for(var p=d.iterator();p.hasNext();){var b=p.next();b.isHole()&&b.setShell(c)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(c){for(var d=0,p=null,b=c.iterator();b.hasNext();){var L=b.next();L.isHole()||(p=L,d++)}return It.isTrue(d<=1,"found two shells in MinimalEdgeRing list"),p}},{key:"add",value:function(){if(arguments.length===1){var c=arguments[0];this.add(c.getEdgeEnds(),c.getNodes())}else if(arguments.length===2){var d=arguments[0],p=arguments[1];vs.linkResultDirectedEdges(p);var b=this.buildMaximalEdgeRings(d),L=new At,O=this.buildMinimalEdgeRings(b,this._shellList,L);this.sortShellsAndHoles(O,this._shellList,L),this.placeFreeHoles(this._shellList,L)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new At;var c=arguments[0];this._geometryFactory=c}},{key:"findEdgeRingContaining",value:function(c,d){for(var p=c.getLinearRing(),b=p.getEnvelopeInternal(),L=p.getCoordinateN(0),O=null,V=null,K=d.iterator();K.hasNext();){var pe=K.next(),Be=pe.getLinearRing(),$e=Be.getEnvelopeInternal();if(!$e.equals(b)&&$e.contains(b)){L=Kn.ptNotInList(p.getCoordinates(),Be.getCoordinates());var mt=!1;qs.isInRing(L,Be.getCoordinates())&&(mt=!0),mt&&(O===null||V.contains($e))&&(V=(O=pe).getLinearRing().getEnvelopeInternal())}}return O}}]),I}(),Ua=function(){function I(){n(this,I)}return a(I,[{key:"getBounds",value:function(){}}]),I}(),Lr=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[Ua,be]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var c=arguments[0],d=arguments[1];this._bounds=c,this._item=d}}]),I}(),bs=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"poll",value:function(){if(this.isEmpty())return null;var c=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),c}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(c){for(var d=null,p=this._items.get(c);2*c<=this._size&&((d=2*c)!==this._size&&this._items.get(d+1).compareTo(this._items.get(d))<0&&d++,this._items.get(d).compareTo(p)<0);c=d)this._items.set(c,this._items.get(d));this._items.set(c,p)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(c){this._items.add(null),this._size+=1;var d=this._size;for(this._items.set(0,c);c.compareTo(this._items.get(Math.trunc(d/2)))<0;d/=2)this._items.set(d,this._items.get(Math.trunc(d/2)));this._items.set(d,c)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new At,this._items.add(null)}}]),I}(),oi=function(){function I(){n(this,I)}return a(I,[{key:"insert",value:function(c,d){}},{key:"remove",value:function(c,d){}},{key:"query",value:function(){}}]),I}(),Mr=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(c){It.isTrue(this._bounds===null),this._childBoundables.add(c)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[Ua,be]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new At,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var c=arguments[0];this._level=c}}}]),I}(),jo={reverseOrder:function(){return{compare:function(I,c){return c.compareTo(I)}}},min:function(I){return jo.sort(I),I.get(0)},sort:function(I,c){var d=I.toArray();c?at.sort(d,c):at.sort(d);for(var p=I.iterator(),b=0,L=d.length;b<L;b++)p.next(),p.set(d[b])},singletonList:function(I){var c=new At;return c.add(I),c}},qo=function(){function I(){n(this,I)}return a(I,null,[{key:"maxDistance",value:function(c,d,p,b,L,O,V,K){var pe=I.distance(c,d,L,O);return pe=Math.max(pe,I.distance(c,d,V,K)),pe=Math.max(pe,I.distance(p,b,L,O)),pe=Math.max(pe,I.distance(p,b,V,K))}},{key:"distance",value:function(c,d,p,b){var L=p-c,O=b-d;return Math.sqrt(L*L+O*O)}},{key:"maximumDistance",value:function(c,d){var p=Math.min(c.getMinX(),d.getMinX()),b=Math.min(c.getMinY(),d.getMinY()),L=Math.max(c.getMaxX(),d.getMaxX()),O=Math.max(c.getMaxY(),d.getMaxY());return I.distance(p,b,L,O)}},{key:"minMaxDistance",value:function(c,d){var p=c.getMinX(),b=c.getMinY(),L=c.getMaxX(),O=c.getMaxY(),V=d.getMinX(),K=d.getMinY(),pe=d.getMaxX(),Be=d.getMaxY(),$e=I.maxDistance(p,b,p,O,V,K,V,Be);return $e=Math.min($e,I.maxDistance(p,b,p,O,V,K,pe,K)),$e=Math.min($e,I.maxDistance(p,b,p,O,pe,Be,V,Be)),$e=Math.min($e,I.maxDistance(p,b,p,O,pe,Be,pe,K)),$e=Math.min($e,I.maxDistance(p,b,L,b,V,K,V,Be)),$e=Math.min($e,I.maxDistance(p,b,L,b,V,K,pe,K)),$e=Math.min($e,I.maxDistance(p,b,L,b,pe,Be,V,Be)),$e=Math.min($e,I.maxDistance(p,b,L,b,pe,Be,pe,K)),$e=Math.min($e,I.maxDistance(L,O,p,O,V,K,V,Be)),$e=Math.min($e,I.maxDistance(L,O,p,O,V,K,pe,K)),$e=Math.min($e,I.maxDistance(L,O,p,O,pe,Be,V,Be)),$e=Math.min($e,I.maxDistance(L,O,p,O,pe,Be,pe,K)),$e=Math.min($e,I.maxDistance(L,O,L,b,V,K,V,Be)),$e=Math.min($e,I.maxDistance(L,O,L,b,V,K,pe,K)),$e=Math.min($e,I.maxDistance(L,O,L,b,pe,Be,V,Be)),$e=Math.min($e,I.maxDistance(L,O,L,b,pe,Be,pe,K))}}]),I}(),Vo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"maximumDistance",value:function(){return qo.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(c,d){var p=I.isComposite(this._boundable1),b=I.isComposite(this._boundable2);if(p&&b)return I.area(this._boundable1)>I.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,c,d),null):(this.expand(this._boundable2,this._boundable1,!0,c,d),null);if(p)return this.expand(this._boundable1,this._boundable2,!1,c,d),null;if(b)return this.expand(this._boundable2,this._boundable1,!0,c,d),null;throw new ve("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(I.isComposite(this._boundable1)||I.isComposite(this._boundable2))}},{key:"compareTo",value:function(c){var d=c;return this._distance<d._distance?-1:this._distance>d._distance?1:0}},{key:"expand",value:function(c,d,p,b,L){for(var O=c.getChildBoundables().iterator();O.hasNext();){var V=O.next(),K=null;(K=p?new I(d,V,this._itemDistance):new I(V,d,this._itemDistance)).getDistance()<L&&b.add(K)}}},{key:"getBoundable",value:function(c){return c===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[ce]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var c=arguments[0],d=arguments[1],p=arguments[2];this._boundable1=c,this._boundable2=d,this._itemDistance=p,this._distance=this.distance()}},{key:"area",value:function(c){return c.getBounds().getArea()}},{key:"isComposite",value:function(c){return c instanceof Mr}}]),I}(),Cl=function(){function I(){n(this,I)}return a(I,[{key:"visitItem",value:function(c){}}]),I}(),Go=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"queryInternal",value:function(){if(Jt(arguments[2],Cl)&&arguments[0]instanceof Object&&arguments[1]instanceof Mr)for(var c=arguments[0],d=arguments[1],p=arguments[2],b=d.getChildBoundables(),L=0;L<b.size();L++){var O=b.get(L);this.getIntersectsOp().intersects(O.getBounds(),c)&&(O instanceof Mr?this.queryInternal(c,O,p):O instanceof Lr?p.visitItem(O.getItem()):It.shouldNeverReachHere())}else if(Jt(arguments[2],Nn)&&arguments[0]instanceof Object&&arguments[1]instanceof Mr)for(var V=arguments[0],K=arguments[1],pe=arguments[2],Be=K.getChildBoundables(),$e=0;$e<Be.size();$e++){var mt=Be.get($e);this.getIntersectsOp().intersects(mt.getBounds(),V)&&(mt instanceof Mr?this.queryInternal(V,mt,pe):mt instanceof Lr?pe.add(mt.getItem()):It.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(c){return c.get(c.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var c=arguments[0],d=0,p=c.getChildBoundables().iterator();p.hasNext();){var b=p.next();b instanceof Mr?d+=this.size(b):b instanceof Lr&&(d+=1)}return d}}},{key:"removeItem",value:function(c,d){for(var p=null,b=c.getChildBoundables().iterator();b.hasNext();){var L=b.next();L instanceof Lr&&L.getItem()===d&&(p=L)}return p!==null&&(c.getChildBoundables().remove(p),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var c=this.itemsTree(this._root);return c===null?new At:c}if(arguments.length===1){for(var d=arguments[0],p=new At,b=d.getChildBoundables().iterator();b.hasNext();){var L=b.next();if(L instanceof Mr){var O=this.itemsTree(L);O!==null&&p.add(O)}else L instanceof Lr?p.add(L.getItem()):It.shouldNeverReachHere()}return p.size()<=0?null:p}}},{key:"insert",value:function(c,d){It.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Lr(c,d))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var c=arguments[0],d=new At;return this.boundablesAtLevel(c,this._root,d),d}if(arguments.length===3){var p=arguments[0],b=arguments[1],L=arguments[2];if(It.isTrue(p>-2),b.getLevel()===p)return L.add(b),null;for(var O=b.getChildBoundables().iterator();O.hasNext();){var V=O.next();V instanceof Mr?this.boundablesAtLevel(p,V,L):(It.isTrue(V instanceof Lr),p===-1&&L.add(V))}return null}}},{key:"query",value:function(){if(arguments.length===1){var c=arguments[0];this.build();var d=new At;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),c)&&this.queryInternal(c,this._root,d),d}if(arguments.length===2){var p=arguments[0],b=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),p)&&this.queryInternal(p,this._root,b)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),c)&&this.remove(c,this._root,d)}if(arguments.length===3){var p=arguments[0],b=arguments[1],L=arguments[2],O=this.removeItem(b,L);if(O)return!0;for(var V=null,K=b.getChildBoundables().iterator();K.hasNext();){var pe=K.next();if(this.getIntersectsOp().intersects(pe.getBounds(),p)&&pe instanceof Mr&&(O=this.remove(p,pe,L))){V=pe;break}}return V!==null&&V.getChildBoundables().isEmpty()&&b.getChildBoundables().remove(V),O}}},{key:"createHigherLevels",value:function(c,d){It.isTrue(!c.isEmpty());var p=this.createParentBoundables(c,d+1);return p.size()===1?p.get(0):this.createHigherLevels(p,d+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var c=arguments[0],d=0,p=c.getChildBoundables().iterator();p.hasNext();){var b=p.next();if(b instanceof Mr){var L=this.depth(b);L>d&&(d=L)}}return d+1}}},{key:"createParentBoundables",value:function(c,d){It.isTrue(!c.isEmpty());var p=new At;p.add(this.createNode(d));var b=new At(c);jo.sort(b,this.getComparator());for(var L=b.iterator();L.hasNext();){var O=L.next();this.lastNode(p).getChildBoundables().size()===this.getNodeCapacity()&&p.add(this.createNode(d)),this.lastNode(p).addChildBoundable(O)}return p}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[be]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new At,this._nodeCapacity=null,arguments.length===0)I.constructor_.call(this,I.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var c=arguments[0];It.isTrue(c>1,"Node capacity must be greater than 1"),this._nodeCapacity=c}}},{key:"compareDoubles",value:function(c,d){return c>d?1:c<d?-1:0}}]),I}();Go.IntersectsOp=function(){},Go.DEFAULT_NODE_CAPACITY=10;var uu=function(){function I(){n(this,I)}return a(I,[{key:"distance",value:function(c,d){}}]),I}(),ns=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"createParentBoundablesFromVerticalSlices",value:function(p,b){It.isTrue(p.length>0);for(var L=new At,O=0;O<p.length;O++)L.addAll(this.createParentBoundablesFromVerticalSlice(p[O],b));return L}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var p=arguments[0],b=arguments[1];return this.nearestNeighbourK(p,vt.POSITIVE_INFINITY,b)}if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2],K=O,pe=new bs;pe.add(L);for(var Be=new bs;!pe.isEmpty()&&K>=0;){var $e=pe.poll(),mt=$e.getDistance();if(mt>=K)break;if($e.isLeaves())if(Be.size()<V)Be.add($e);else{var Ft=Be.peek();Ft.getDistance()>mt&&(Be.poll(),Be.add($e));var Nt=Be.peek();K=Nt.getDistance()}else $e.expandToQueue(pe,K)}return d.getItems(Be)}}},{key:"createNode",value:function(p){return new Ll(p)}},{key:"size",value:function(){return arguments.length===0?U(m(d.prototype),"size",this).call(this):U(m(d.prototype),"size",this).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof dn))return U(m(d.prototype),"insert",this).apply(this,arguments);var p=arguments[0],b=arguments[1];if(p.isNull())return null;U(m(d.prototype),"insert",this).call(this,p,b)}},{key:"getIntersectsOp",value:function(){return d.intersectsOp}},{key:"verticalSlices",value:function(p,b){for(var L=Math.trunc(Math.ceil(p.size()/b)),O=new Array(b).fill(null),V=p.iterator(),K=0;K<b;K++){O[K]=new At;for(var pe=0;V.hasNext()&&pe<L;){var Be=V.next();O[K].add(Be),pe++}}return O}},{key:"query",value:function(){if(arguments.length===1){var p=arguments[0];return U(m(d.prototype),"query",this).call(this,p)}if(arguments.length===2){var b=arguments[0],L=arguments[1];U(m(d.prototype),"query",this).call(this,b,L)}}},{key:"getComparator",value:function(){return d.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(p,b){return U(m(d.prototype),"createParentBoundables",this).call(this,p,b)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof dn){var p=arguments[0],b=arguments[1];return U(m(d.prototype),"remove",this).call(this,p,b)}return U(m(d.prototype),"remove",this).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?U(m(d.prototype),"depth",this).call(this):U(m(d.prototype),"depth",this).apply(this,arguments)}},{key:"createParentBoundables",value:function(p,b){It.isTrue(!p.isEmpty());var L=Math.trunc(Math.ceil(p.size()/this.getNodeCapacity())),O=new At(p);jo.sort(O,d.xComparator);var V=this.verticalSlices(O,Math.trunc(Math.ceil(Math.sqrt(L))));return this.createParentBoundablesFromVerticalSlices(V,b)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(Jt(arguments[0],uu)){var p=arguments[0];if(this.isEmpty())return null;var b=new Vo(this.getRoot(),this.getRoot(),p);return this.nearestNeighbour(b)}if(arguments[0]instanceof Vo){var L=arguments[0],O=vt.POSITIVE_INFINITY,V=null,K=new bs;for(K.add(L);!K.isEmpty()&&O>0;){var pe=K.poll(),Be=pe.getDistance();if(Be>=O)break;pe.isLeaves()?(O=Be,V=pe):pe.expandToQueue(K,O)}return V===null?null:[V.getBoundable(0).getItem(),V.getBoundable(1).getItem()]}}else{if(arguments.length===2){var $e=arguments[0],mt=arguments[1];if(this.isEmpty()||$e.isEmpty())return null;var Ft=new Vo(this.getRoot(),$e.getRoot(),mt);return this.nearestNeighbour(Ft)}if(arguments.length===3){var Nt=arguments[0],gn=arguments[1],vn=arguments[2],Ln=new Lr(Nt,gn),ni=new Vo(this.getRoot(),Ln,vn);return this.nearestNeighbour(ni)[0]}if(arguments.length===4){var gi=arguments[0],ui=arguments[1],er=arguments[2],ss=arguments[3],Rs=new Lr(gi,ui),di=new Vo(this.getRoot(),Rs,er);return this.nearestNeighbourK(di,ss)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var p=arguments[0],b=arguments[1],L=vt.POSITIVE_INFINITY,O=new bs;for(O.add(p);!O.isEmpty();){var V=O.poll(),K=V.getDistance();if(K>b)return!1;if(V.maximumDistance()<=b)return!0;if(V.isLeaves()){if((L=K)<=b)return!0}else V.expandToQueue(O,L)}return!1}if(arguments.length===3){var pe=arguments[0],Be=arguments[1],$e=arguments[2],mt=new Vo(this.getRoot(),pe.getRoot(),Be);return this.isWithinDistance(mt,$e)}}},{key:"interfaces_",get:function(){return[oi,be]}}],[{key:"constructor_",value:function(){if(arguments.length===0)d.constructor_.call(this,d.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var p=arguments[0];Go.constructor_.call(this,p)}}},{key:"centreX",value:function(p){return d.avg(p.getMinX(),p.getMaxX())}},{key:"avg",value:function(p,b){return(p+b)/2}},{key:"getItems",value:function(p){for(var b=new Array(p.size()).fill(null),L=0;!p.isEmpty();){var O=p.poll();b[L]=O.getBoundable(0).getItem(),L++}return b}},{key:"centreY",value:function(p){return d.avg(p.getMinY(),p.getMaxY())}}]),d}(Go),Ll=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"computeBounds",value:function(){for(var p=null,b=this.getChildBoundables().iterator();b.hasNext();){var L=b.next();p===null?p=new dn(L.getBounds()):p.expandToInclude(L.getBounds())}return p}}],[{key:"constructor_",value:function(){var p=arguments[0];Mr.constructor_.call(this,p)}}]),d}(Mr);ns.STRtreeNode=Ll,ns.xComparator=new(function(){function I(){n(this,I)}return a(I,[{key:"interfaces_",get:function(){return[kt]}},{key:"compare",value:function(c,d){return Go.compareDoubles(ns.centreX(c.getBounds()),ns.centreX(d.getBounds()))}}]),I}()),ns.yComparator=new(function(){function I(){n(this,I)}return a(I,[{key:"interfaces_",get:function(){return[kt]}},{key:"compare",value:function(c,d){return Go.compareDoubles(ns.centreY(c.getBounds()),ns.centreY(d.getBounds()))}}]),I}()),ns.intersectsOp=new(function(){function I(){n(this,I)}return a(I,[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(c,d){return c.intersects(d)}}]),I}()),ns.DEFAULT_NODE_CAPACITY=10;var cu=function(){function I(){n(this,I)}return a(I,null,[{key:"relativeSign",value:function(c,d){return c<d?-1:c>d?1:0}},{key:"compare",value:function(c,d,p){if(d.equals2D(p))return 0;var b=I.relativeSign(d.x,p.x),L=I.relativeSign(d.y,p.y);switch(c){case 0:return I.compareValue(b,L);case 1:return I.compareValue(L,b);case 2:return I.compareValue(L,-b);case 3:return I.compareValue(-b,L);case 4:return I.compareValue(-b,-L);case 5:return I.compareValue(-L,-b);case 6:return I.compareValue(-L,b);case 7:return I.compareValue(b,-L)}return It.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(c,d){return c<0?-1:c>0?1:d<0?-1:d>0?1:0}}]),I}(),hu=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(c){c.print(this.coord),c.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(c){var d=c;return this.segmentIndex<d.segmentIndex?-1:this.segmentIndex>d.segmentIndex?1:this.coord.equals2D(d.coord)?0:this._isInterior?d._isInterior?cu.compare(this._segmentOctant,this.coord,d.coord):1:-1}},{key:"isEndPoint",value:function(c){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===c}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[ce]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];this._segString=c,this.coord=new We(d),this.segmentIndex=p,this._segmentOctant=b,this._isInterior=!d.equals2D(c.getCoordinate(p))}}]),I}(),fu=function(){function I(){n(this,I)}return a(I,[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}]),I}(),ko=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getSplitCoordinates",value:function(){var c=new Di;this.addEndpoints();for(var d=this.iterator(),p=d.next();d.hasNext();){var b=d.next();this.addEdgeCoordinates(p,b,c),p=b}return c.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var c=new At;this.findCollapsesFromInsertedNodes(c),this.findCollapsesFromExistingVertices(c);for(var d=c.iterator();d.hasNext();){var p=d.next().intValue();this.add(this._edge.getCoordinate(p),p)}}},{key:"createSplitEdgePts",value:function(c,d){var p=d.segmentIndex-c.segmentIndex+2;if(p===2)return[new We(c.coord),new We(d.coord)];var b=this._edge.getCoordinate(d.segmentIndex),L=d.isInterior()||!d.coord.equals2D(b);L||p--;var O=new Array(p).fill(null),V=0;O[V++]=new We(c.coord);for(var K=c.segmentIndex+1;K<=d.segmentIndex;K++)O[V++]=this._edge.getCoordinate(K);return L&&(O[V]=new We(d.coord)),O}},{key:"print",value:function(c){c.println("Intersections:");for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"findCollapsesFromExistingVertices",value:function(c){for(var d=0;d<this._edge.size()-2;d++){var p=this._edge.getCoordinate(d);this._edge.getCoordinate(d+1);var b=this._edge.getCoordinate(d+2);p.equals2D(b)&&c.add(Yi.valueOf(d+1))}}},{key:"addEdgeCoordinates",value:function(c,d,p){var b=this.createSplitEdgePts(c,d);p.add(b,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(c){this.addEndpoints(),this.addCollapsedNodes();for(var d=this.iterator(),p=d.next();d.hasNext();){var b=d.next(),L=this.createSplitEdge(p,b);c.add(L),p=b}}},{key:"findCollapseIndex",value:function(c,d,p){if(!c.coord.equals2D(d.coord))return!1;var b=d.segmentIndex-c.segmentIndex;return d.isInterior()||b--,b===1&&(p[0]=c.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(c){for(var d=new Array(1).fill(null),p=this.iterator(),b=p.next();p.hasNext();){var L=p.next();this.findCollapseIndex(b,L,d)&&c.add(Yi.valueOf(d[0])),b=L}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var c=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(c),c)}},{key:"createSplitEdge",value:function(c,d){var p=this.createSplitEdgePts(c,d);return new xs(p,this._edge.getData())}},{key:"add",value:function(c,d){var p=new hu(this._edge,c,d,this._edge.getSegmentOctant(d)),b=this._nodeMap.get(p);return b!==null?(It.isTrue(b.coord.equals2D(c),"Found equal nodes with different coordinates"),b):(this._nodeMap.put(p,p),p)}},{key:"checkSplitEdgesCorrectness",value:function(c){var d=this._edge.getCoordinates(),p=c.get(0).getCoordinate(0);if(!p.equals2D(d[0]))throw new ft("bad split edge start point at "+p);var b=c.get(c.size()-1).getCoordinates(),L=b[b.length-1];if(!L.equals2D(d[d.length-1]))throw new ft("bad split edge end point at "+L)}}],[{key:"constructor_",value:function(){this._nodeMap=new Bo,this._edge=null;var c=arguments[0];this._edge=c}}]),I}(),du=function(){function I(){n(this,I)}return a(I,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1];if(c===0&&d===0)throw new ve("Cannot compute the octant for point ( "+c+", "+d+" )");var p=Math.abs(c),b=Math.abs(d);return c>=0?d>=0?p>=b?0:1:p>=b?7:6:d>=0?p>=b?3:2:p>=b?4:5}if(arguments[0]instanceof We&&arguments[1]instanceof We){var L=arguments[0],O=arguments[1],V=O.x-L.x,K=O.y-L.y;if(V===0&&K===0)throw new ve("Cannot compute the octant for two identical points "+L);return I.octant(V,K)}}}]),I}(),xc=function(){function I(){n(this,I)}return a(I,[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(c){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(c){}},{key:"getData",value:function(){}}]),I}(),pu=function(){function I(){n(this,I)}return a(I,[{key:"addIntersection",value:function(c,d){}},{key:"interfaces_",get:function(){return[xc]}}]),I}(),xs=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(c){return this._pts[c]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(c){return c===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(c),this.getCoordinate(c+1))}},{key:"setData",value:function(c){this._data=c}},{key:"safeOctant",value:function(c,d){return c.equals2D(d)?0:du.octant(c,d)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];this.addIntersectionNode(c,d)}else if(arguments.length===4){var p=arguments[0],b=arguments[1],L=arguments[3],O=new We(p.getIntersection(L));this.addIntersection(O,b)}}},{key:"toString",value:function(){return za.toLineString(new bo(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(c,d){var p=d,b=p+1;if(b<this._pts.length){var L=this._pts[b];c.equals2D(L)&&(p=b)}return this._nodeList.add(c,p)}},{key:"addIntersections",value:function(c,d,p){for(var b=0;b<c.getIntersectionNum();b++)this.addIntersection(c,d,p,b)}},{key:"interfaces_",get:function(){return[pu]}}],[{key:"constructor_",value:function(){this._nodeList=new ko(this),this._pts=null,this._data=null;var c=arguments[0],d=arguments[1];this._pts=c,this._data=d}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var c=arguments[0],d=new At;return I.getNodedSubstrings(c,d),d}if(arguments.length===2)for(var p=arguments[0],b=arguments[1],L=p.iterator();L.hasNext();){var O=L.next();O.getNodeList().addSplitEdges(b)}}}]),I}(),Hr=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof I){var c=arguments[0],d=mn.index(this.p0,this.p1,c.p0),p=mn.index(this.p0,this.p1,c.p1);return d>=0&&p>=0||d<=0&&p<=0?Math.max(d,p):0}if(arguments[0]instanceof We){var b=arguments[0];return mn.index(this.p0,this.p1,b)}}},{key:"toGeometry",value:function(c){return c.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(c){if(!(c instanceof I))return!1;var d=c;return this.p0.equals(d.p0)&&this.p1.equals(d.p1)}},{key:"intersection",value:function(c){var d=new so;return d.computeIntersection(this.p0,this.p1,c.p0,c.p1),d.hasIntersection()?d.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof We){var c=arguments[0];if(c.equals(this.p0)||c.equals(this.p1))return new We(c);var d=this.projectionFactor(c),p=new We;return p.x=this.p0.x+d*(this.p1.x-this.p0.x),p.y=this.p0.y+d*(this.p1.y-this.p0.y),p}if(arguments[0]instanceof I){var b=arguments[0],L=this.projectionFactor(b.p0),O=this.projectionFactor(b.p1);if(L>=1&&O>=1||L<=0&&O<=0)return null;var V=this.project(b.p0);L<0&&(V=this.p0),L>1&&(V=this.p1);var K=this.project(b.p1);return O<0&&(K=this.p0),O>1&&(K=this.p1),new I(V,K)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(c){return c===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(c){return Ji.pointToLinePerpendicular(c,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return I.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(c){if(c.equals(this.p0))return 0;if(c.equals(this.p1))return 1;var d=this.p1.x-this.p0.x,p=this.p1.y-this.p0.y,b=d*d+p*p;return b<=0?vt.NaN:((c.x-this.p0.x)*d+(c.y-this.p0.y)*p)/b}},{key:"closestPoints",value:function(c){var d=this.intersection(c);if(d!==null)return[d,d];var p=new Array(2).fill(null),b=vt.MAX_VALUE,L=null,O=this.closestPoint(c.p0);b=O.distance(c.p0),p[0]=O,p[1]=c.p0;var V=this.closestPoint(c.p1);(L=V.distance(c.p1))<b&&(b=L,p[0]=V,p[1]=c.p1);var K=c.closestPoint(this.p0);(L=K.distance(this.p0))<b&&(b=L,p[0]=this.p0,p[1]=K);var pe=c.closestPoint(this.p1);return(L=pe.distance(this.p1))<b&&(b=L,p[0]=this.p1,p[1]=pe),p}},{key:"closestPoint",value:function(c){var d=this.projectionFactor(c);return d>0&&d<1?this.project(c):this.p0.distance(c)<this.p1.distance(c)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(c){var d=c,p=this.p0.compareTo(d.p0);return p!==0?p:this.p1.compareTo(d.p1)}},{key:"reverse",value:function(){var c=this.p0;this.p0=this.p1,this.p1=c}},{key:"equalsTopo",value:function(c){return this.p0.equals(c.p0)&&this.p1.equals(c.p1)||this.p0.equals(c.p1)&&this.p1.equals(c.p0)}},{key:"lineIntersection",value:function(c){return bn.intersection(this.p0,this.p1,c.p0,c.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(c,d){var p=this.p0.x+c*(this.p1.x-this.p0.x),b=this.p0.y+c*(this.p1.y-this.p0.y),L=this.p1.x-this.p0.x,O=this.p1.y-this.p0.y,V=Math.sqrt(L*L+O*O),K=0,pe=0;if(d!==0){if(V<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");K=d*L/V,pe=d*O/V}return new We(p-pe,b+K)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var c=arguments[0];this.setCoordinates(c.p0,c.p1)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.p0.x=d.x,this.p0.y=d.y,this.p1.x=p.x,this.p1.y=p.y}}},{key:"segmentFraction",value:function(c){var d=this.projectionFactor(c);return d<0?d=0:(d>1||vt.isNaN(d))&&(d=1),d}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(c){var d=this.p1.getY()-this.p0.getY(),p=this.p0.getX()-this.p1.getX(),b=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),L=d*d+p*p,O=d*d-p*p,V=c.getX(),K=c.getY();return new We((-O*V-2*d*p*K-2*d*b)/L,(O*K-2*d*p*V-2*p*b)/L)}},{key:"distance",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return Ji.segmentToSegment(this.p0,this.p1,c.p0,c.p1)}if(arguments[0]instanceof We){var d=arguments[0];return Ji.pointToSegment(d,this.p0,this.p1)}}},{key:"pointAlong",value:function(c){var d=new We;return d.x=this.p0.x+c*(this.p1.x-this.p0.x),d.y=this.p0.y+c*(this.p1.y-this.p0.y),d}},{key:"hashCode",value:function(){var c=vt.doubleToLongBits(this.p0.x);c^=31*vt.doubleToLongBits(this.p0.y);var d=Math.trunc(c)^Math.trunc(c>>32),p=vt.doubleToLongBits(this.p1.x);return p^=31*vt.doubleToLongBits(this.p1.y),d^(Math.trunc(p)^Math.trunc(p>>32))}},{key:"interfaces_",get:function(){return[ce,be]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)I.constructor_.call(this,new We,new We);else if(arguments.length===1){var c=arguments[0];I.constructor_.call(this,c.p0,c.p1)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.p0=d,this.p1=p}else if(arguments.length===4){var b=arguments[0],L=arguments[1],O=arguments[2],V=arguments[3];I.constructor_.call(this,new We(b,L),new We(O,V))}}},{key:"midPoint",value:function(c,d){return new We((c.x+d.x)/2,(c.y+d.y)/2)}}]),I}(),ja=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"overlap",value:function(){if(arguments.length!==2&&arguments.length===4){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];c.getLineSegment(d,this._overlapSeg1),p.getLineSegment(b,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new Hr,this._overlapSeg2=new Hr}}]),I}(),mu=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getLineSegment",value:function(c,d){d.p0=this._pts[c],d.p1=this._pts[c+1]}},{key:"computeSelect",value:function(c,d,p,b){var L=this._pts[d],O=this._pts[p];if(p-d==1)return b.select(this,d),null;if(!c.intersects(L,O))return null;var V=Math.trunc((d+p)/2);d<V&&this.computeSelect(c,d,V,b),V<p&&this.computeSelect(c,V,p,b)}},{key:"getCoordinates",value:function(){for(var c=new Array(this._end-this._start+1).fill(null),d=0,p=this._start;p<=this._end;p++)c[d++]=this._pts[p];return c}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];this.computeOverlaps(this._start,this._end,c,c._start,c._end,d)}else if(arguments.length===6){var p=arguments[0],b=arguments[1],L=arguments[2],O=arguments[3],V=arguments[4],K=arguments[5];if(b-p==1&&V-O==1)return K.overlap(this,p,L,O),null;if(!this.overlaps(p,b,L,O,V))return null;var pe=Math.trunc((p+b)/2),Be=Math.trunc((O+V)/2);p<pe&&(O<Be&&this.computeOverlaps(p,pe,L,O,Be,K),Be<V&&this.computeOverlaps(p,pe,L,Be,V,K)),pe<b&&(O<Be&&this.computeOverlaps(pe,b,L,O,Be,K),Be<V&&this.computeOverlaps(pe,b,L,Be,V,K))}}},{key:"setId",value:function(c){this._id=c}},{key:"select",value:function(c,d){this.computeSelect(c,this._start,this._end,d)}},{key:"getEnvelope",value:function(){if(this._env===null){var c=this._pts[this._start],d=this._pts[this._end];this._env=new dn(c,d)}return this._env}},{key:"overlaps",value:function(c,d,p,b,L){return dn.intersects(this._pts[c],this._pts[d],p._pts[b],p._pts[L])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];this._pts=c,this._start=d,this._end=p,this._context=b}}]),I}(),wc=function(){function I(){n(this,I)}return a(I,null,[{key:"findChainEnd",value:function(c,d){for(var p=d;p<c.length-1&&c[p].equals2D(c[p+1]);)p++;if(p>=c.length-1)return c.length-1;for(var b=hr.quadrant(c[p],c[p+1]),L=d+1;L<c.length&&!(!c[L-1].equals2D(c[L])&&hr.quadrant(c[L-1],c[L])!==b);)L++;return L-1}},{key:"getChains",value:function(){if(arguments.length===1){var c=arguments[0];return I.getChains(c,null)}if(arguments.length===2){var d=arguments[0],p=arguments[1],b=new At,L=0;do{var O=I.findChainEnd(d,L),V=new mu(d,L,O,p);b.add(V),L=O}while(L<d.length-1);return b}}}]),I}(),qa=function(){function I(){n(this,I)}return a(I,[{key:"computeNodes",value:function(c){}},{key:"getNodedSubstrings",value:function(){}}]),I}(),Ml=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setSegmentIntersector",value:function(c){this._segInt=c}},{key:"interfaces_",get:function(){return[qa]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var c=arguments[0];this.setSegmentIntersector(c)}}}]),I}(),Va=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return xs.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(p){for(var b=wc.getChains(p.getCoordinates(),p).iterator();b.hasNext();){var L=b.next();L.setId(this._idCounter++),this._index.insert(L.getEnvelope(),L),this._monoChains.add(L)}}},{key:"computeNodes",value:function(p){this._nodedSegStrings=p;for(var b=p.iterator();b.hasNext();)this.add(b.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var p=new Ga(this._segInt),b=this._monoChains.iterator();b.hasNext();)for(var L=b.next(),O=this._index.query(L.getEnvelope()).iterator();O.hasNext();){var V=O.next();if(V.getId()>L.getId()&&(L.computeOverlaps(V,p),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new At,this._index=new ns,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0&&arguments.length===1){var p=arguments[0];Ml.constructor_.call(this,p)}}}]),d}(Ml),Ga=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"overlap",value:function(){if(arguments.length!==4)return U(m(d.prototype),"overlap",this).apply(this,arguments);var p=arguments[0],b=arguments[1],L=arguments[2],O=arguments[3],V=p.getContext(),K=L.getContext();this._si.processIntersections(V,b,K,O)}}],[{key:"constructor_",value:function(){this._si=null;var p=arguments[0];this._si=p}}]),d}(ja);Va.SegmentOverlapAction=Ga;var is=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isDeletable",value:function(c,d,p,b){var L=this._inputLine[c],O=this._inputLine[d],V=this._inputLine[p];return!!this.isConcave(L,O,V)&&!!this.isShallow(L,O,V,b)&&this.isShallowSampled(L,O,c,p,b)}},{key:"deleteShallowConcavities",value:function(){for(var c=1,d=this.findNextNonDeletedIndex(c),p=this.findNextNonDeletedIndex(d),b=!1;p<this._inputLine.length;){var L=!1;this.isDeletable(c,d,p,this._distanceTol)&&(this._isDeleted[d]=I.DELETE,L=!0,b=!0),c=L?p:d,d=this.findNextNonDeletedIndex(c),p=this.findNextNonDeletedIndex(d)}return b}},{key:"isShallowConcavity",value:function(c,d,p,b){return mn.index(c,d,p)===this._angleOrientation&&Ji.pointToSegment(d,c,p)<b}},{key:"isShallowSampled",value:function(c,d,p,b,L){var O=Math.trunc((b-p)/I.NUM_PTS_TO_CHECK);O<=0&&(O=1);for(var V=p;V<b;V+=O)if(!this.isShallow(c,d,this._inputLine[V],L))return!1;return!0}},{key:"isConcave",value:function(c,d,p){var b=mn.index(c,d,p)===this._angleOrientation;return b}},{key:"simplify",value:function(c){this._distanceTol=Math.abs(c),c<0&&(this._angleOrientation=mn.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var d=!1;do d=this.deleteShallowConcavities();while(d);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(c){for(var d=c+1;d<this._inputLine.length&&this._isDeleted[d]===I.DELETE;)d++;return d}},{key:"isShallow",value:function(c,d,p,b){return Ji.pointToSegment(d,c,p)<b}},{key:"collapseLine",value:function(){for(var c=new Di,d=0;d<this._inputLine.length;d++)this._isDeleted[d]!==I.DELETE&&c.add(this._inputLine[d]);return c.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=mn.COUNTERCLOCKWISE;var c=arguments[0];this._inputLine=c}},{key:"simplify",value:function(c,d){return new I(c).simplify(d)}}]),I}();is.INIT=0,is.DELETE=1,is.KEEP=1,is.NUM_PTS_TO_CHECK=10;var ya=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinates",value:function(){return this._ptList.toArray(I.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(c){this._precisionModel=c}},{key:"addPt",value:function(c){var d=new We(c);if(this._precisionModel.makePrecise(d),this.isRedundant(d))return null;this._ptList.add(d)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(c,d){if(d)for(var p=0;p<c.length;p++)this.addPt(c[p]);else for(var b=c.length-1;b>=0;b--)this.addPt(c[b])}},{key:"isRedundant",value:function(c){if(this._ptList.size()<1)return!1;var d=this._ptList.get(this._ptList.size()-1);return c.distance(d)<this._minimimVertexDistance}},{key:"toString",value:function(){return new Qr().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var c=new We(this._ptList.get(0)),d=this._ptList.get(this._ptList.size()-1);if(c.equals(d))return null;this._ptList.add(c)}},{key:"setMinimumVertexDistance",value:function(c){this._minimimVertexDistance=c}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new At}}]),I}();ya.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var ji=function(){function I(){n(this,I)}return a(I,null,[{key:"toDegrees",value:function(c){return 180*c/Math.PI}},{key:"normalize",value:function(c){for(;c>Math.PI;)c-=I.PI_TIMES_2;for(;c<=-Math.PI;)c+=I.PI_TIMES_2;return c}},{key:"angle",value:function(){if(arguments.length===1){var c=arguments[0];return Math.atan2(c.y,c.x)}if(arguments.length===2){var d=arguments[0],p=arguments[1],b=p.x-d.x,L=p.y-d.y;return Math.atan2(L,b)}}},{key:"isAcute",value:function(c,d,p){var b=c.x-d.x,L=c.y-d.y;return b*(p.x-d.x)+L*(p.y-d.y)>0}},{key:"isObtuse",value:function(c,d,p){var b=c.x-d.x,L=c.y-d.y;return b*(p.x-d.x)+L*(p.y-d.y)<0}},{key:"interiorAngle",value:function(c,d,p){var b=I.angle(d,c),L=I.angle(d,p);return Math.abs(L-b)}},{key:"normalizePositive",value:function(c){if(c<0){for(;c<0;)c+=I.PI_TIMES_2;c>=I.PI_TIMES_2&&(c=0)}else{for(;c>=I.PI_TIMES_2;)c-=I.PI_TIMES_2;c<0&&(c=0)}return c}},{key:"angleBetween",value:function(c,d,p){var b=I.angle(d,c),L=I.angle(d,p);return I.diff(b,L)}},{key:"diff",value:function(c,d){var p=null;return(p=c<d?d-c:c-d)>Math.PI&&(p=2*Math.PI-p),p}},{key:"toRadians",value:function(c){return c*Math.PI/180}},{key:"getTurn",value:function(c,d){var p=Math.sin(d-c);return p>0?I.COUNTERCLOCKWISE:p<0?I.CLOCKWISE:I.NONE}},{key:"angleBetweenOriented",value:function(c,d,p){var b=I.angle(d,c),L=I.angle(d,p)-b;return L<=-Math.PI?L+I.PI_TIMES_2:L>Math.PI?L-I.PI_TIMES_2:L}}]),I}();ji.PI_TIMES_2=2*Math.PI,ji.PI_OVER_2=Math.PI/2,ji.PI_OVER_4=Math.PI/4,ji.COUNTERCLOCKWISE=mn.COUNTERCLOCKWISE,ji.CLOCKWISE=mn.CLOCKWISE,ji.NONE=mn.COLLINEAR;var Io=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"addNextSegment",value:function(c,d){if(this._s0=this._s1,this._s1=this._s2,this._s2=c,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var p=mn.index(this._s0,this._s1,this._s2),b=p===mn.CLOCKWISE&&this._side===Ie.LEFT||p===mn.COUNTERCLOCKWISE&&this._side===Ie.RIGHT;p===0?this.addCollinear(d):b?this.addOutsideTurn(p,d):this.addInsideTurn(p,d)}},{key:"addLineEndCap",value:function(c,d){var p=new Hr(c,d),b=new Hr;this.computeOffsetSegment(p,Ie.LEFT,this._distance,b);var L=new Hr;this.computeOffsetSegment(p,Ie.RIGHT,this._distance,L);var O=d.x-c.x,V=d.y-c.y,K=Math.atan2(V,O);switch(this._bufParams.getEndCapStyle()){case Y.CAP_ROUND:this._segList.addPt(b.p1),this.addDirectedFillet(d,K+Math.PI/2,K-Math.PI/2,mn.CLOCKWISE,this._distance),this._segList.addPt(L.p1);break;case Y.CAP_FLAT:this._segList.addPt(b.p1),this._segList.addPt(L.p1);break;case Y.CAP_SQUARE:var pe=new We;pe.x=Math.abs(this._distance)*Math.cos(K),pe.y=Math.abs(this._distance)*Math.sin(K);var Be=new We(b.p1.x+pe.x,b.p1.y+pe.y),$e=new We(L.p1.x+pe.x,L.p1.y+pe.y);this._segList.addPt(Be),this._segList.addPt($e)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(c,d,p,b){var L=bn.intersection(d.p0,d.p1,p.p0,p.p1);if(L!==null&&(b<=0?1:L.distance(c)/Math.abs(b))<=this._bufParams.getMitreLimit())return this._segList.addPt(L),null;this.addLimitedMitreJoin(d,p,b,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(c,d){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*I.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Y.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Y.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(d&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,c,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(c){this._segList.addPt(new We(c.x+this._distance,c.y+this._distance)),this._segList.addPt(new We(c.x+this._distance,c.y-this._distance)),this._segList.addPt(new We(c.x-this._distance,c.y-this._distance)),this._segList.addPt(new We(c.x-this._distance,c.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(c,d){this._segList.addPts(c,d)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(c,d,p,b,L){var O=d.x-c.x,V=d.y-c.y,K=Math.atan2(V,O),pe=p.x-c.x,Be=p.y-c.y,$e=Math.atan2(Be,pe);b===mn.CLOCKWISE?K<=$e&&(K+=2*Math.PI):K>=$e&&(K-=2*Math.PI),this._segList.addPt(d),this.addDirectedFillet(c,K,$e,b,L),this._segList.addPt(p)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(c,d,p){this._s1=c,this._s2=d,this._side=p,this._seg1.setCoordinates(c,d),this.computeOffsetSegment(this._seg1,p,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(c,d,p,b){var L=this._seg0.p1,O=ji.angle(L,this._seg0.p0),V=ji.angleBetweenOriented(this._seg0.p0,L,this._seg1.p1)/2,K=ji.normalize(O+V),pe=ji.normalize(K+Math.PI),Be=b*p,$e=p-Be*Math.abs(Math.sin(V)),mt=L.x+Be*Math.cos(pe),Ft=L.y+Be*Math.sin(pe),Nt=new We(mt,Ft),gn=new Hr(L,Nt),vn=gn.pointAlongOffset(1,$e),Ln=gn.pointAlongOffset(1,-$e);this._side===Ie.LEFT?(this._segList.addPt(vn),this._segList.addPt(Ln)):(this._segList.addPt(Ln),this._segList.addPt(vn))}},{key:"addDirectedFillet",value:function(c,d,p,b,L){var O=b===mn.CLOCKWISE?-1:1,V=Math.abs(d-p),K=Math.trunc(V/this._filletAngleQuantum+.5);if(K<1)return null;for(var pe=V/K,Be=new We,$e=0;$e<K;$e++){var mt=d+O*$e*pe;Be.x=c.x+L*Math.cos(mt),Be.y=c.y+L*Math.sin(mt),this._segList.addPt(Be)}}},{key:"computeOffsetSegment",value:function(c,d,p,b){var L=d===Ie.LEFT?1:-1,O=c.p1.x-c.p0.x,V=c.p1.y-c.p0.y,K=Math.sqrt(O*O+V*V),pe=L*p*O/K,Be=L*p*V/K;b.p0.x=c.p0.x-Be,b.p0.y=c.p0.y+pe,b.p1.x=c.p1.x-Be,b.p1.y=c.p1.y+pe}},{key:"addInsideTurn",value:function(c,d){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*I.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var p=new We((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(p);var b=new We((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(b)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(c){var d=new We(c.x+this._distance,c.y);this._segList.addPt(d),this.addDirectedFillet(c,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(c,d){this._segList.addPt(c.p1),this._segList.addPt(d.p0)}},{key:"init",value:function(c){this._distance=c,this._maxCurveSegmentError=c*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new ya,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(c*I.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(c){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===Y.JOIN_BEVEL||this._bufParams.getJoinStyle()===Y.JOIN_MITRE?(c&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,mn.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Hr,this._seg1=new Hr,this._offset0=new Hr,this._offset1=new Hr,this._side=0,this._hasNarrowConcaveAngle=!1;var c=arguments[0],d=arguments[1],p=arguments[2];this._precisionModel=c,this._bufParams=d,this._li=new so,this._filletAngleQuantum=Math.PI/2/d.getQuadrantSegments(),d.getQuadrantSegments()>=8&&d.getJoinStyle()===Y.JOIN_ROUND&&(this._closingSegLengthFactor=I.MAX_CLOSING_SEG_LEN_FACTOR),this.init(p)}}]),I}();Io.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,Io.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,Io.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,Io.MAX_CLOSING_SEG_LEN_FACTOR=80;var Rl=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getOffsetCurve",value:function(c,d){if(this._distance=d,d===0)return null;var p=d<0,b=Math.abs(d),L=this.getSegGen(b);c.length<=1?this.computePointCurve(c[0],L):this.computeOffsetCurve(c,p,L);var O=L.getCoordinates();return p&&Kn.reverse(O),O}},{key:"computeSingleSidedBufferCurve",value:function(c,d,p){var b=this.simplifyTolerance(this._distance);if(d){p.addSegments(c,!0);var L=is.simplify(c,-b),O=L.length-1;p.initSideSegments(L[O],L[O-1],Ie.LEFT),p.addFirstSegment();for(var V=O-2;V>=0;V--)p.addNextSegment(L[V],!0)}else{p.addSegments(c,!1);var K=is.simplify(c,b),pe=K.length-1;p.initSideSegments(K[0],K[1],Ie.LEFT),p.addFirstSegment();for(var Be=2;Be<=pe;Be++)p.addNextSegment(K[Be],!0)}p.addLastSegment(),p.closeRing()}},{key:"computeRingBufferCurve",value:function(c,d,p){var b=this.simplifyTolerance(this._distance);d===Ie.RIGHT&&(b=-b);var L=is.simplify(c,b),O=L.length-1;p.initSideSegments(L[O-1],L[0],d);for(var V=1;V<=O;V++){var K=V!==1;p.addNextSegment(L[V],K)}p.closeRing()}},{key:"computeLineBufferCurve",value:function(c,d){var p=this.simplifyTolerance(this._distance),b=is.simplify(c,p),L=b.length-1;d.initSideSegments(b[0],b[1],Ie.LEFT);for(var O=2;O<=L;O++)d.addNextSegment(b[O],!0);d.addLastSegment(),d.addLineEndCap(b[L-1],b[L]);var V=is.simplify(c,-p),K=V.length-1;d.initSideSegments(V[K],V[K-1],Ie.LEFT);for(var pe=K-2;pe>=0;pe--)d.addNextSegment(V[pe],!0);d.addLastSegment(),d.addLineEndCap(V[1],V[0]),d.closeRing()}},{key:"computePointCurve",value:function(c,d){switch(this._bufParams.getEndCapStyle()){case Y.CAP_ROUND:d.createCircle(c);break;case Y.CAP_SQUARE:d.createSquare(c)}}},{key:"getLineCurve",value:function(c,d){if(this._distance=d,this.isLineOffsetEmpty(d))return null;var p=Math.abs(d),b=this.getSegGen(p);if(c.length<=1)this.computePointCurve(c[0],b);else if(this._bufParams.isSingleSided()){var L=d<0;this.computeSingleSidedBufferCurve(c,L,b)}else this.computeLineBufferCurve(c,b);return b.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(c){return c*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(c,d,p){if(this._distance=p,c.length<=2)return this.getLineCurve(c,p);if(p===0)return I.copyCoordinates(c);var b=this.getSegGen(p);return this.computeRingBufferCurve(c,d,b),b.getCoordinates()}},{key:"computeOffsetCurve",value:function(c,d,p){var b=this.simplifyTolerance(this._distance);if(d){var L=is.simplify(c,-b),O=L.length-1;p.initSideSegments(L[O],L[O-1],Ie.LEFT),p.addFirstSegment();for(var V=O-2;V>=0;V--)p.addNextSegment(L[V],!0)}else{var K=is.simplify(c,b),pe=K.length-1;p.initSideSegments(K[0],K[1],Ie.LEFT),p.addFirstSegment();for(var Be=2;Be<=pe;Be++)p.addNextSegment(K[Be],!0)}p.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(c){return c===0||c<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(c){return new Io(this._precisionModel,this._bufParams,c)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var c=arguments[0],d=arguments[1];this._precisionModel=c,this._bufParams=d}},{key:"copyCoordinates",value:function(c){for(var d=new Array(c.length).fill(null),p=0;p<d.length;p++)d[p]=new We(c[p]);return d}}]),I}(),Za=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var c=arguments[0],d=new At,p=this._subgraphs.iterator();p.hasNext();){var b=p.next(),L=b.getEnvelope();c.y<L.getMinY()||c.y>L.getMaxY()||this.findStabbedSegments(c,b.getDirectedEdges(),d)}return d}if(arguments.length===3){if(Jt(arguments[2],Nn)&&arguments[0]instanceof We&&arguments[1]instanceof _a)for(var O=arguments[0],V=arguments[1],K=arguments[2],pe=V.getEdge().getCoordinates(),Be=0;Be<pe.length-1;Be++){this._seg.p0=pe[Be],this._seg.p1=pe[Be+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse();var $e=Math.max(this._seg.p0.x,this._seg.p1.x);if(!($e<O.x)&&!(this._seg.isHorizontal()||O.y<this._seg.p0.y||O.y>this._seg.p1.y||mn.index(this._seg.p0,this._seg.p1,O)===mn.RIGHT)){var mt=V.getDepth(Ie.LEFT);this._seg.p0.equals(pe[Be])||(mt=V.getDepth(Ie.RIGHT));var Ft=new va(this._seg,mt);K.add(Ft)}}else if(Jt(arguments[2],Nn)&&arguments[0]instanceof We&&Jt(arguments[1],Nn))for(var Nt=arguments[0],gn=arguments[1],vn=arguments[2],Ln=gn.iterator();Ln.hasNext();){var ni=Ln.next();ni.isForward()&&this.findStabbedSegments(Nt,ni,vn)}}}},{key:"getDepth",value:function(c){var d=this.findStabbedSegments(c);return d.size()===0?0:jo.min(d)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new Hr;var c=arguments[0];this._subgraphs=c}}]),I}(),va=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compareTo",value:function(c){var d=c;if(this._upwardSeg.minX()>=d._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=d._upwardSeg.minX())return-1;var p=this._upwardSeg.orientationIndex(d._upwardSeg);return p!==0||(p=-1*d._upwardSeg.orientationIndex(this._upwardSeg))!==0?p:this._upwardSeg.compareTo(d._upwardSeg)}},{key:"compareX",value:function(c,d){var p=c.p0.compareTo(d.p0);return p!==0?p:c.p1.compareTo(d.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[ce]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var c=arguments[0],d=arguments[1];this._upwardSeg=new Hr(c),this._leftDepth=d}}]),I}();Za.DepthSegment=va;var Ha=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,null,[{key:"constructor_",value:function(){_e.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}]),d}(_e),Vs=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getY",value:function(){var c=this.y/this.w;if(vt.isNaN(c)||vt.isInfinite(c))throw new Ha;return c}},{key:"getX",value:function(){var c=this.x/this.w;if(vt.isNaN(c)||vt.isInfinite(c))throw new Ha;return c}},{key:"getCoordinate",value:function(){var c=new We;return c.x=this.getX(),c.y=this.getY(),c}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var c=arguments[0];this.x=c.x,this.y=c.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var d=arguments[0],p=arguments[1];this.x=d,this.y=p,this.w=1}else if(arguments[0]instanceof I&&arguments[1]instanceof I){var b=arguments[0],L=arguments[1];this.x=b.y*L.w-L.y*b.w,this.y=L.x*b.w-b.x*L.w,this.w=b.x*L.y-L.x*b.y}else if(arguments[0]instanceof We&&arguments[1]instanceof We){var O=arguments[0],V=arguments[1];this.x=O.y-V.y,this.y=V.x-O.x,this.w=O.x*V.y-V.x*O.y}}else if(arguments.length===3){var K=arguments[0],pe=arguments[1],Be=arguments[2];this.x=K,this.y=pe,this.w=Be}else if(arguments.length===4){var $e=arguments[0],mt=arguments[1],Ft=arguments[2],Nt=arguments[3],gn=$e.y-mt.y,vn=mt.x-$e.x,Ln=$e.x*mt.y-mt.x*$e.y,ni=Ft.y-Nt.y,gi=Nt.x-Ft.x,ui=Ft.x*Nt.y-Nt.x*Ft.y;this.x=vn*ui-gi*Ln,this.y=ni*Ln-gn*ui,this.w=gn*gi-ni*vn}}}]),I}(),Pl=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"area",value:function(){return I.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return I.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(c){if(c===null)throw new ve("Supplied point is null.");return I.interpolateZ(c,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return I.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return I.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return I.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return I.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return I.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return I.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var c=arguments[0],d=arguments[1],p=arguments[2];this.p0=c,this.p1=d,this.p2=p}},{key:"area",value:function(c,d,p){return Math.abs(((p.x-c.x)*(d.y-c.y)-(d.x-c.x)*(p.y-c.y))/2)}},{key:"signedArea",value:function(c,d,p){return((p.x-c.x)*(d.y-c.y)-(d.x-c.x)*(p.y-c.y))/2}},{key:"det",value:function(c,d,p,b){return c*b-d*p}},{key:"interpolateZ",value:function(c,d,p,b){var L=d.x,O=d.y,V=p.x-L,K=b.x-L,pe=p.y-O,Be=b.y-O,$e=V*Be-K*pe,mt=c.x-L,Ft=c.y-O,Nt=(Be*mt-K*Ft)/$e,gn=(-pe*mt+V*Ft)/$e;return d.getZ()+Nt*(p.getZ()-d.getZ())+gn*(b.getZ()-d.getZ())}},{key:"longestSideLength",value:function(c,d,p){var b=c.distance(d),L=d.distance(p),O=p.distance(c),V=b;return L>V&&(V=L),O>V&&(V=O),V}},{key:"circumcentreDD",value:function(c,d,p){var b=ct.valueOf(c.x).subtract(p.x),L=ct.valueOf(c.y).subtract(p.y),O=ct.valueOf(d.x).subtract(p.x),V=ct.valueOf(d.y).subtract(p.y),K=ct.determinant(b,L,O,V).multiply(2),pe=b.sqr().add(L.sqr()),Be=O.sqr().add(V.sqr()),$e=ct.determinant(L,pe,V,Be),mt=ct.determinant(b,pe,O,Be),Ft=ct.valueOf(p.x).subtract($e.divide(K)).doubleValue(),Nt=ct.valueOf(p.y).add(mt.divide(K)).doubleValue();return new We(Ft,Nt)}},{key:"isAcute",value:function(c,d,p){return!!ji.isAcute(c,d,p)&&!!ji.isAcute(d,p,c)&&!!ji.isAcute(p,c,d)}},{key:"circumcentre",value:function(c,d,p){var b=p.x,L=p.y,O=c.x-b,V=c.y-L,K=d.x-b,pe=d.y-L,Be=2*I.det(O,V,K,pe),$e=I.det(V,O*O+V*V,pe,K*K+pe*pe),mt=I.det(O,O*O+V*V,K,K*K+pe*pe);return new We(b-$e/Be,L+mt/Be)}},{key:"perpendicularBisector",value:function(c,d){var p=d.x-c.x,b=d.y-c.y,L=new Vs(c.x+p/2,c.y+b/2,1),O=new Vs(c.x-b+p/2,c.y+p+b/2,1);return new Vs(L,O)}},{key:"angleBisector",value:function(c,d,p){var b=d.distance(c),L=b/(b+d.distance(p)),O=p.x-c.x,V=p.y-c.y;return new We(c.x+L*O,c.y+L*V)}},{key:"area3D",value:function(c,d,p){var b=d.x-c.x,L=d.y-c.y,O=d.getZ()-c.getZ(),V=p.x-c.x,K=p.y-c.y,pe=p.getZ()-c.getZ(),Be=L*pe-O*K,$e=O*V-b*pe,mt=b*K-L*V,Ft=Be*Be+$e*$e+mt*mt,Nt=Math.sqrt(Ft)/2;return Nt}},{key:"centroid",value:function(c,d,p){var b=(c.x+d.x+p.x)/3,L=(c.y+d.y+p.y)/3;return new We(b,L)}},{key:"inCentre",value:function(c,d,p){var b=d.distance(p),L=c.distance(p),O=c.distance(d),V=b+L+O,K=(b*c.x+L*d.x+O*p.x)/V,pe=(b*c.y+L*d.y+O*p.y)/V;return new We(K,pe)}}]),I}(),kc=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"addRingSide",value:function(c,d,p,b,L){if(d===0&&c.length<Ii.MINIMUM_VALID_SIZE)return null;var O=b,V=L;c.length>=Ii.MINIMUM_VALID_SIZE&&mn.isCCW(c)&&(O=L,V=b,p=Ie.opposite(p));var K=this._curveBuilder.getRingCurve(c,p,d);this.addCurve(K,O,V)}},{key:"addRingBothSides",value:function(c,d){this.addRingSide(c,d,Ie.LEFT,Ee.EXTERIOR,Ee.INTERIOR),this.addRingSide(c,d,Ie.RIGHT,Ee.INTERIOR,Ee.EXTERIOR)}},{key:"addPoint",value:function(c){if(this._distance<=0)return null;var d=c.getCoordinates(),p=this._curveBuilder.getLineCurve(d,this._distance);this.addCurve(p,Ee.EXTERIOR,Ee.INTERIOR)}},{key:"addPolygon",value:function(c){var d=this._distance,p=Ie.LEFT;this._distance<0&&(d=-this._distance,p=Ie.RIGHT);var b=c.getExteriorRing(),L=Kn.removeRepeatedPoints(b.getCoordinates());if(this._distance<0&&this.isErodedCompletely(b,this._distance)||this._distance<=0&&L.length<3)return null;this.addRingSide(L,d,p,Ee.EXTERIOR,Ee.INTERIOR);for(var O=0;O<c.getNumInteriorRing();O++){var V=c.getInteriorRingN(O),K=Kn.removeRepeatedPoints(V.getCoordinates());this._distance>0&&this.isErodedCompletely(V,-this._distance)||this.addRingSide(K,d,Ie.opposite(p),Ee.INTERIOR,Ee.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(c,d){var p=new Pl(c[0],c[1],c[2]),b=p.inCentre();return Ji.pointToSegment(b,p.p0,p.p1)<Math.abs(d)}},{key:"addLineString",value:function(c){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var d=Kn.removeRepeatedPoints(c.getCoordinates());if(Kn.isRing(d)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(d,this._distance);else{var p=this._curveBuilder.getLineCurve(d,this._distance);this.addCurve(p,Ee.EXTERIOR,Ee.INTERIOR)}}},{key:"addCurve",value:function(c,d,p){if(c===null||c.length<2)return null;var b=new xs(c,new xi(0,Ee.BOUNDARY,d,p));this._curveList.add(b)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(c){if(c.isEmpty())return null;if(c instanceof en)this.addPolygon(c);else if(c instanceof Xe)this.addLineString(c);else if(c instanceof et)this.addPoint(c);else if(c instanceof Un)this.addCollection(c);else if(c instanceof no)this.addCollection(c);else if(c instanceof Cr)this.addCollection(c);else{if(!(c instanceof Cn))throw new Lt(c.getGeometryType());this.addCollection(c)}}},{key:"isErodedCompletely",value:function(c,d){var p=c.getCoordinates();if(p.length<4)return d<0;if(p.length===4)return this.isTriangleErodedCompletely(p,d);var b=c.getEnvelopeInternal(),L=Math.min(b.getHeight(),b.getWidth());return d<0&&2*Math.abs(d)>L}},{key:"addCollection",value:function(c){for(var d=0;d<c.getNumGeometries();d++){var p=c.getGeometryN(d);this.add(p)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new At;var c=arguments[0],d=arguments[1],p=arguments[2];this._inputGeom=c,this._distance=d,this._curveBuilder=p}}]),I}(),Fi=function(){function I(){n(this,I)}return a(I,[{key:"locate",value:function(c){}}]),I}(),Ic=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,I.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Ye;var c=this._parent.getGeometryN(this._index++);return c instanceof Cn?(this._subcollectionIterator=new I(c),this._subcollectionIterator.next()):c}},{key:"remove",value:function(){throw new Lt(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[fu]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var c=arguments[0];this._parent=c,this._atStart=!0,this._index=0,this._max=c.getNumGeometries()}},{key:"isAtomic",value:function(c){return!(c instanceof Cn)}}]),I}(),jn=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"locate",value:function(c){return I.locate(c,this._geom)}},{key:"interfaces_",get:function(){return[Fi]}}],[{key:"constructor_",value:function(){this._geom=null;var c=arguments[0];this._geom=c}},{key:"locatePointInPolygon",value:function(c,d){if(d.isEmpty())return Ee.EXTERIOR;var p=d.getExteriorRing(),b=I.locatePointInRing(c,p);if(b!==Ee.INTERIOR)return b;for(var L=0;L<d.getNumInteriorRing();L++){var O=d.getInteriorRingN(L),V=I.locatePointInRing(c,O);if(V===Ee.BOUNDARY)return Ee.BOUNDARY;if(V===Ee.INTERIOR)return Ee.EXTERIOR}return Ee.INTERIOR}},{key:"locatePointInRing",value:function(c,d){return d.getEnvelopeInternal().intersects(c)?qs.locateInRing(c,d.getCoordinates()):Ee.EXTERIOR}},{key:"containsPointInPolygon",value:function(c,d){return Ee.EXTERIOR!==I.locatePointInPolygon(c,d)}},{key:"locateInGeometry",value:function(c,d){if(d instanceof en)return I.locatePointInPolygon(c,d);if(d instanceof Cn)for(var p=new Ic(d);p.hasNext();){var b=p.next();if(b!==d){var L=I.locateInGeometry(c,b);if(L!==Ee.EXTERIOR)return L}}return Ee.EXTERIOR}},{key:"isContained",value:function(c,d){return Ee.EXTERIOR!==I.locate(c,d)}},{key:"locate",value:function(c,d){return d.isEmpty()?Ee.EXTERIOR:d.getEnvelopeInternal().intersects(c)?I.locateInGeometry(c,d):Ee.EXTERIOR}}]),I}(),Xa=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getNextCW",value:function(c){this.getEdges();var d=this._edgeList.indexOf(c),p=d-1;return d===0&&(p=this._edgeList.size()-1),this._edgeList.get(p)}},{key:"propagateSideLabels",value:function(c){for(var d=Ee.NONE,p=this.iterator();p.hasNext();){var b=p.next().getLabel();b.isArea(c)&&b.getLocation(c,Ie.LEFT)!==Ee.NONE&&(d=b.getLocation(c,Ie.LEFT))}if(d===Ee.NONE)return null;for(var L=d,O=this.iterator();O.hasNext();){var V=O.next(),K=V.getLabel();if(K.getLocation(c,Ie.ON)===Ee.NONE&&K.setLocation(c,Ie.ON,L),K.isArea(c)){var pe=K.getLocation(c,Ie.LEFT),Be=K.getLocation(c,Ie.RIGHT);if(Be!==Ee.NONE){if(Be!==L)throw new Mt("side location conflict",V.getCoordinate());pe===Ee.NONE&&It.shouldNeverReachHere("found single null side (at "+V.getCoordinate()+")"),L=pe}else It.isTrue(K.getLocation(c,Ie.LEFT)===Ee.NONE,"found single null side"),K.setLocation(c,Ie.RIGHT,L),K.setLocation(c,Ie.LEFT,L)}}}},{key:"getCoordinate",value:function(){var c=this.iterator();return c.hasNext()?c.next().getCoordinate():null}},{key:"print",value:function(c){Pi.out.println("EdgeEndStar:   "+this.getCoordinate());for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"isAreaLabelsConsistent",value:function(c){return this.computeEdgeEndLabels(c.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(c){var d=this.getEdges();if(d.size()<=0)return!0;var p=d.size()-1,b=d.get(p).getLabel().getLocation(c,Ie.LEFT);It.isTrue(b!==Ee.NONE,"Found unlabelled area edge");for(var L=b,O=this.iterator();O.hasNext();){var V=O.next().getLabel();It.isTrue(V.isArea(c),"Found non-area edge");var K=V.getLocation(c,Ie.LEFT),pe=V.getLocation(c,Ie.RIGHT);if(K===pe||pe!==L)return!1;L=K}return!0}},{key:"findIndex",value:function(c){this.iterator();for(var d=0;d<this._edgeList.size();d++)if(this._edgeList.get(d)===c)return d;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new At(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(c,d,p){return this._ptInAreaLocation[c]===Ee.NONE&&(this._ptInAreaLocation[c]=jn.locate(d,p[c].getGeometry())),this._ptInAreaLocation[c]}},{key:"toString",value:function(){var c=new Ri;c.append("EdgeEndStar:   "+this.getCoordinate()),c.append(`
`);for(var d=this.iterator();d.hasNext();){var p=d.next();c.append(p),c.append(`
`)}return c.toString()}},{key:"computeEdgeEndLabels",value:function(c){for(var d=this.iterator();d.hasNext();)d.next().computeLabel(c)}},{key:"computeLabelling",value:function(c){this.computeEdgeEndLabels(c[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var d=[!1,!1],p=this.iterator();p.hasNext();)for(var b=p.next().getLabel(),L=0;L<2;L++)b.isLine(L)&&b.getLocation(L)===Ee.BOUNDARY&&(d[L]=!0);for(var O=this.iterator();O.hasNext();)for(var V=O.next(),K=V.getLabel(),pe=0;pe<2;pe++)if(K.isAnyNull(pe)){var Be=Ee.NONE;if(d[pe])Be=Ee.EXTERIOR;else{var $e=V.getCoordinate();Be=this.getLocation(pe,$e,c)}K.setAllLocationsIfNull(pe,Be)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(c,d){this._edgeMap.put(c,d),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new Bo,this._edgeList=null,this._ptInAreaLocation=[Ee.NONE,Ee.NONE]}}]),I}(),mi=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var p=null,b=null,L=this._SCANNING_FOR_INCOMING,O=0;O<this._resultAreaEdgeList.size();O++){var V=this._resultAreaEdgeList.get(O),K=V.getSym();if(V.getLabel().isArea())switch(p===null&&V.isInResult()&&(p=V),L){case this._SCANNING_FOR_INCOMING:if(!K.isInResult())continue;b=K,L=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!V.isInResult())continue;b.setNext(V),L=this._SCANNING_FOR_INCOMING}}if(L===this._LINKING_TO_OUTGOING){if(p===null)throw new Mt("no outgoing dirEdge found",this.getCoordinate());It.isTrue(p.isInResult(),"unable to link last incoming dirEdge"),b.setNext(p)}}},{key:"insert",value:function(p){var b=p;this.insertEdgeEnd(b,b)}},{key:"getRightmostEdge",value:function(){var p=this.getEdges(),b=p.size();if(b<1)return null;var L=p.get(0);if(b===1)return L;var O=p.get(b-1),V=L.getQuadrant(),K=O.getQuadrant();return hr.isNorthern(V)&&hr.isNorthern(K)?L:hr.isNorthern(V)||hr.isNorthern(K)?L.getDy()!==0?L:O.getDy()!==0?O:(It.shouldNeverReachHere("found two horizontal edges incident on node"),null):O}},{key:"print",value:function(p){Pi.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var b=this.iterator();b.hasNext();){var L=b.next();p.print("out "),L.print(p),p.println(),p.print("in "),L.getSym().print(p),p.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new At;for(var p=this.iterator();p.hasNext();){var b=p.next();(b.isInResult()||b.getSym().isInResult())&&this._resultAreaEdgeList.add(b)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(p){for(var b=this.iterator();b.hasNext();){var L=b.next().getLabel();L.setAllLocationsIfNull(0,p.getLocation(0)),L.setAllLocationsIfNull(1,p.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var p=null,b=null,L=this._edgeList.size()-1;L>=0;L--){var O=this._edgeList.get(L),V=O.getSym();b===null&&(b=V),p!==null&&V.setNext(p),p=O}b.setNext(p)}},{key:"computeDepths",value:function(){if(arguments.length===1){var p=arguments[0],b=this.findIndex(p),L=p.getDepth(Ie.LEFT),O=p.getDepth(Ie.RIGHT),V=this.computeDepths(b+1,this._edgeList.size(),L),K=this.computeDepths(0,b,V);if(K!==O)throw new Mt("depth mismatch at "+p.getCoordinate())}else if(arguments.length===3){for(var pe=arguments[0],Be=arguments[1],$e=arguments[2],mt=$e,Ft=pe;Ft<Be;Ft++){var Nt=this._edgeList.get(Ft);Nt.setEdgeDepths(Ie.RIGHT,mt),mt=Nt.getDepth(Ie.LEFT)}return mt}}},{key:"mergeSymLabels",value:function(){for(var p=this.iterator();p.hasNext();){var b=p.next();b.getLabel().merge(b.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(p){for(var b=null,L=null,O=this._SCANNING_FOR_INCOMING,V=this._resultAreaEdgeList.size()-1;V>=0;V--){var K=this._resultAreaEdgeList.get(V),pe=K.getSym();switch(b===null&&K.getEdgeRing()===p&&(b=K),O){case this._SCANNING_FOR_INCOMING:if(pe.getEdgeRing()!==p)continue;L=pe,O=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(K.getEdgeRing()!==p)continue;L.setNextMin(K),O=this._SCANNING_FOR_INCOMING}}O===this._LINKING_TO_OUTGOING&&(It.isTrue(b!==null,"found null for first outgoing dirEdge"),It.isTrue(b.getEdgeRing()===p,"unable to link last incoming dirEdge"),L.setNextMin(b))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var p=0,b=this.iterator();b.hasNext();){var L=b.next();L.isInResult()&&p++}return p}if(arguments.length===1){for(var O=arguments[0],V=0,K=this.iterator();K.hasNext();){var pe=K.next();pe.getEdgeRing()===O&&V++}return V}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var p=Ee.NONE,b=this.iterator();b.hasNext();){var L=b.next(),O=L.getSym();if(!L.isLineEdge()){if(L.isInResult()){p=Ee.INTERIOR;break}if(O.isInResult()){p=Ee.EXTERIOR;break}}}if(p===Ee.NONE)return null;for(var V=p,K=this.iterator();K.hasNext();){var pe=K.next(),Be=pe.getSym();pe.isLineEdge()?pe.getEdge().setCovered(V===Ee.INTERIOR):(pe.isInResult()&&(V=Ee.EXTERIOR),Be.isInResult()&&(V=Ee.INTERIOR))}}},{key:"computeLabelling",value:function(p){U(m(d.prototype),"computeLabelling",this).call(this,p),this._label=new xi(Ee.NONE);for(var b=this.iterator();b.hasNext();)for(var L=b.next().getEdge().getLabel(),O=0;O<2;O++){var V=L.getLocation(O);V!==Ee.INTERIOR&&V!==Ee.BOUNDARY||this._label.setLocation(O,Ee.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}]),d}(Xa),hi=function(I){h(d,I);var c=B(d);function d(){return n(this,d),c.call(this)}return a(d,[{key:"createNode",value:function(p){return new ma(p,new mi)}}]),d}(Ba),oo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compareTo",value:function(c){var d=c;return I.compareOriented(this._pts,this._orientation,d._pts,d._orientation)}},{key:"interfaces_",get:function(){return[ce]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var c=arguments[0];this._pts=c,this._orientation=I.orientation(c)}},{key:"orientation",value:function(c){return Kn.increasingDirection(c)===1}},{key:"compareOriented",value:function(c,d,p,b){for(var L=d?1:-1,O=b?1:-1,V=d?c.length:-1,K=b?p.length:-1,pe=d?0:c.length-1,Be=b?0:p.length-1;;){var $e=c[pe].compareTo(p[Be]);if($e!==0)return $e;var mt=(pe+=L)===V,Ft=(Be+=O)===K;if(mt&&!Ft)return-1;if(!mt&&Ft)return 1;if(mt&&Ft)return 0}}}]),I}(),ba=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"print",value:function(c){c.print("MULTILINESTRING ( ");for(var d=0;d<this._edges.size();d++){var p=this._edges.get(d);d>0&&c.print(","),c.print("(");for(var b=p.getCoordinates(),L=0;L<b.length;L++)L>0&&c.print(","),c.print(b[L].x+" "+b[L].y);c.println(")")}c.print(")  ")}},{key:"addAll",value:function(c){for(var d=c.iterator();d.hasNext();)this.add(d.next())}},{key:"findEdgeIndex",value:function(c){for(var d=0;d<this._edges.size();d++)if(this._edges.get(d).equals(c))return d;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(c){return this._edges.get(c)}},{key:"findEqualEdge",value:function(c){var d=new oo(c.getCoordinates());return this._ocaMap.get(d)}},{key:"add",value:function(c){this._edges.add(c);var d=new oo(c.getCoordinates());this._ocaMap.put(d,c)}}],[{key:"constructor_",value:function(){this._edges=new At,this._ocaMap=new Bo}}]),I}(),Zo=function(){function I(){n(this,I)}return a(I,[{key:"processIntersections",value:function(c,d,p,b){}},{key:"isDone",value:function(){}}]),I}(),Dl=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isTrivialIntersection",value:function(c,d,p,b){if(c===p&&this._li.getIntersectionNum()===1){if(I.isAdjacentSegments(d,b))return!0;if(c.isClosed()){var L=c.size()-1;if(d===0&&b===L||b===0&&d===L)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(c,d,p,b){if(c===p&&d===b)return null;this.numTests++;var L=c.getCoordinates()[d],O=c.getCoordinates()[d+1],V=p.getCoordinates()[b],K=p.getCoordinates()[b+1];this._li.computeIntersection(L,O,V,K),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(c,d,p,b)||(this._hasIntersection=!0,c.addIntersections(this._li,d,0),p.addIntersections(this._li,b,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[Zo]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var c=arguments[0];this._li=c}},{key:"isAdjacentSegments",value:function(c,d){return Math.abs(c-d)===1}}]),I}(),So=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(c){c.print(this.coord),c.print(" seg # = "+this.segmentIndex),c.println(" dist = "+this.dist)}},{key:"compareTo",value:function(c){var d=c;return this.compare(d.segmentIndex,d.dist)}},{key:"isEndPoint",value:function(c){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===c}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(c,d){return this.segmentIndex<c?-1:this.segmentIndex>c?1:this.dist<d?-1:this.dist>d?1:0}},{key:"interfaces_",get:function(){return[ce]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var c=arguments[0],d=arguments[1],p=arguments[2];this.coord=new We(c),this.segmentIndex=d,this.dist=p}}]),I}(),Ho=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"print",value:function(c){c.println("Intersections:");for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(c){this.addEndpoints();for(var d=this.iterator(),p=d.next();d.hasNext();){var b=d.next(),L=this.createSplitEdge(p,b);c.add(L),p=b}}},{key:"addEndpoints",value:function(){var c=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[c],c,0)}},{key:"createSplitEdge",value:function(c,d){var p=d.segmentIndex-c.segmentIndex+2,b=this.edge.pts[d.segmentIndex],L=d.dist>0||!d.coord.equals2D(b);L||p--;var O=new Array(p).fill(null),V=0;O[V++]=new We(c.coord);for(var K=c.segmentIndex+1;K<=d.segmentIndex;K++)O[V++]=this.edge.pts[K];return L&&(O[V]=d.coord),new Xo(O,new xi(this.edge._label))}},{key:"add",value:function(c,d,p){var b=new So(c,d,p),L=this._nodeMap.get(b);return L!==null?L:(this._nodeMap.put(b,b),b)}},{key:"isIntersection",value:function(c){for(var d=this.iterator();d.hasNext();)if(d.next().coord.equals(c))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new Bo,this.edge=null;var c=arguments[0];this.edge=c}}]),I}(),rs=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(I.isTrue(this._matrix[Ee.INTERIOR][Ee.INTERIOR])||I.isTrue(this._matrix[Ee.INTERIOR][Ee.BOUNDARY])||I.isTrue(this._matrix[Ee.BOUNDARY][Ee.INTERIOR])||I.isTrue(this._matrix[Ee.BOUNDARY][Ee.BOUNDARY]))&&this._matrix[Ee.EXTERIOR][Ee.INTERIOR]===ue.FALSE&&this._matrix[Ee.EXTERIOR][Ee.BOUNDARY]===ue.FALSE}},{key:"isCoveredBy",value:function(){return(I.isTrue(this._matrix[Ee.INTERIOR][Ee.INTERIOR])||I.isTrue(this._matrix[Ee.INTERIOR][Ee.BOUNDARY])||I.isTrue(this._matrix[Ee.BOUNDARY][Ee.INTERIOR])||I.isTrue(this._matrix[Ee.BOUNDARY][Ee.BOUNDARY]))&&this._matrix[Ee.INTERIOR][Ee.EXTERIOR]===ue.FALSE&&this._matrix[Ee.BOUNDARY][Ee.EXTERIOR]===ue.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var c=arguments[0],d=0;d<c.length;d++){var p=Math.trunc(d/3),b=d%3;this._matrix[p][b]=ue.toDimensionValue(c.charAt(d))}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];this._matrix[L][O]=V}}},{key:"isContains",value:function(){return I.isTrue(this._matrix[Ee.INTERIOR][Ee.INTERIOR])&&this._matrix[Ee.EXTERIOR][Ee.INTERIOR]===ue.FALSE&&this._matrix[Ee.EXTERIOR][Ee.BOUNDARY]===ue.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var c=arguments[0],d=0;d<c.length;d++){var p=Math.trunc(d/3),b=d%3;this.setAtLeast(p,b,ue.toDimensionValue(c.charAt(d)))}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];this._matrix[L][O]<V&&(this._matrix[L][O]=V)}}},{key:"setAtLeastIfValid",value:function(c,d,p){c>=0&&d>=0&&this.setAtLeast(c,d,p)}},{key:"isWithin",value:function(){return I.isTrue(this._matrix[Ee.INTERIOR][Ee.INTERIOR])&&this._matrix[Ee.INTERIOR][Ee.EXTERIOR]===ue.FALSE&&this._matrix[Ee.BOUNDARY][Ee.EXTERIOR]===ue.FALSE}},{key:"isTouches",value:function(c,d){return c>d?this.isTouches(d,c):(c===ue.A&&d===ue.A||c===ue.L&&d===ue.L||c===ue.L&&d===ue.A||c===ue.P&&d===ue.A||c===ue.P&&d===ue.L)&&this._matrix[Ee.INTERIOR][Ee.INTERIOR]===ue.FALSE&&(I.isTrue(this._matrix[Ee.INTERIOR][Ee.BOUNDARY])||I.isTrue(this._matrix[Ee.BOUNDARY][Ee.INTERIOR])||I.isTrue(this._matrix[Ee.BOUNDARY][Ee.BOUNDARY]))}},{key:"isOverlaps",value:function(c,d){return c===ue.P&&d===ue.P||c===ue.A&&d===ue.A?I.isTrue(this._matrix[Ee.INTERIOR][Ee.INTERIOR])&&I.isTrue(this._matrix[Ee.INTERIOR][Ee.EXTERIOR])&&I.isTrue(this._matrix[Ee.EXTERIOR][Ee.INTERIOR]):c===ue.L&&d===ue.L&&this._matrix[Ee.INTERIOR][Ee.INTERIOR]===1&&I.isTrue(this._matrix[Ee.INTERIOR][Ee.EXTERIOR])&&I.isTrue(this._matrix[Ee.EXTERIOR][Ee.INTERIOR])}},{key:"isEquals",value:function(c,d){return c===d&&I.isTrue(this._matrix[Ee.INTERIOR][Ee.INTERIOR])&&this._matrix[Ee.INTERIOR][Ee.EXTERIOR]===ue.FALSE&&this._matrix[Ee.BOUNDARY][Ee.EXTERIOR]===ue.FALSE&&this._matrix[Ee.EXTERIOR][Ee.INTERIOR]===ue.FALSE&&this._matrix[Ee.EXTERIOR][Ee.BOUNDARY]===ue.FALSE}},{key:"toString",value:function(){for(var c=new ei("123456789"),d=0;d<3;d++)for(var p=0;p<3;p++)c.setCharAt(3*d+p,ue.toDimensionSymbol(this._matrix[d][p]));return c.toString()}},{key:"setAll",value:function(c){for(var d=0;d<3;d++)for(var p=0;p<3;p++)this._matrix[d][p]=c}},{key:"get",value:function(c,d){return this._matrix[c][d]}},{key:"transpose",value:function(){var c=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=c,c=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=c,c=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=c,this}},{key:"matches",value:function(c){if(c.length!==9)throw new ve("Should be length 9: "+c);for(var d=0;d<3;d++)for(var p=0;p<3;p++)if(!I.matches(this._matrix[d][p],c.charAt(3*d+p)))return!1;return!0}},{key:"add",value:function(c){for(var d=0;d<3;d++)for(var p=0;p<3;p++)this.setAtLeast(d,p,c.get(d,p))}},{key:"isDisjoint",value:function(){return this._matrix[Ee.INTERIOR][Ee.INTERIOR]===ue.FALSE&&this._matrix[Ee.INTERIOR][Ee.BOUNDARY]===ue.FALSE&&this._matrix[Ee.BOUNDARY][Ee.INTERIOR]===ue.FALSE&&this._matrix[Ee.BOUNDARY][Ee.BOUNDARY]===ue.FALSE}},{key:"isCrosses",value:function(c,d){return c===ue.P&&d===ue.L||c===ue.P&&d===ue.A||c===ue.L&&d===ue.A?I.isTrue(this._matrix[Ee.INTERIOR][Ee.INTERIOR])&&I.isTrue(this._matrix[Ee.INTERIOR][Ee.EXTERIOR]):c===ue.L&&d===ue.P||c===ue.A&&d===ue.P||c===ue.A&&d===ue.L?I.isTrue(this._matrix[Ee.INTERIOR][Ee.INTERIOR])&&I.isTrue(this._matrix[Ee.EXTERIOR][Ee.INTERIOR]):c===ue.L&&d===ue.L&&this._matrix[Ee.INTERIOR][Ee.INTERIOR]===0}},{key:"interfaces_",get:function(){return[xe]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(ue.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var c=arguments[0];I.constructor_.call(this),this.set(c)}else if(arguments[0]instanceof I){var d=arguments[0];I.constructor_.call(this),this._matrix[Ee.INTERIOR][Ee.INTERIOR]=d._matrix[Ee.INTERIOR][Ee.INTERIOR],this._matrix[Ee.INTERIOR][Ee.BOUNDARY]=d._matrix[Ee.INTERIOR][Ee.BOUNDARY],this._matrix[Ee.INTERIOR][Ee.EXTERIOR]=d._matrix[Ee.INTERIOR][Ee.EXTERIOR],this._matrix[Ee.BOUNDARY][Ee.INTERIOR]=d._matrix[Ee.BOUNDARY][Ee.INTERIOR],this._matrix[Ee.BOUNDARY][Ee.BOUNDARY]=d._matrix[Ee.BOUNDARY][Ee.BOUNDARY],this._matrix[Ee.BOUNDARY][Ee.EXTERIOR]=d._matrix[Ee.BOUNDARY][Ee.EXTERIOR],this._matrix[Ee.EXTERIOR][Ee.INTERIOR]=d._matrix[Ee.EXTERIOR][Ee.INTERIOR],this._matrix[Ee.EXTERIOR][Ee.BOUNDARY]=d._matrix[Ee.EXTERIOR][Ee.BOUNDARY],this._matrix[Ee.EXTERIOR][Ee.EXTERIOR]=d._matrix[Ee.EXTERIOR][Ee.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var c=arguments[0],d=arguments[1];return d===ue.SYM_DONTCARE||d===ue.SYM_TRUE&&(c>=0||c===ue.TRUE)||d===ue.SYM_FALSE&&c===ue.FALSE||d===ue.SYM_P&&c===ue.P||d===ue.SYM_L&&c===ue.L||d===ue.SYM_A&&c===ue.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var p=arguments[0],b=arguments[1],L=new I(p);return L.matches(b)}}},{key:"isTrue",value:function(c){return c>=0||c===ue.TRUE}}]),I}(),Nl=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(c){return c===null||c.length===0?null:(this.ensureCapacity(this._size+c.length),Pi.arraycopy(c,0,this._data,this._size,c.length),void(this._size+=c.length))}},{key:"ensureCapacity",value:function(c){if(c<=this._data.length)return null;var d=Math.max(c,2*this._data.length);this._data=at.copyOf(this._data,d)}},{key:"toArray",value:function(){var c=new Array(this._size).fill(null);return Pi.arraycopy(this._data,0,c,0,this._size),c}},{key:"add",value:function(c){this.ensureCapacity(this._size+1),this._data[this._size]=c,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)I.constructor_.call(this,10);else if(arguments.length===1){var c=arguments[0];this._data=new Array(c).fill(null)}}}]),I}(),zl=function(){function I(){n(this,I)}return a(I,[{key:"getChainStartIndices",value:function(c){var d=0,p=new Nl(Math.trunc(c.length/2));p.add(d);do{var b=this.findChainEnd(c,d);p.add(b),d=b}while(d<c.length-1);return p.toArray()}},{key:"findChainEnd",value:function(c,d){for(var p=hr.quadrant(c[d],c[d+1]),b=d+1;b<c.length&&hr.quadrant(c[b-1],c[b])===p;)b++;return b-1}},{key:"OLDgetChainStartIndices",value:function(c){var d=0,p=new At;p.add(d);do{var b=this.findChainEnd(c,d);p.add(b),d=b}while(d<c.length-1);return I.toIntArray(p)}}],[{key:"toIntArray",value:function(c){for(var d=new Array(c.size()).fill(null),p=0;p<d.length;p++)d[p]=c.get(p).intValue();return d}}]),I}(),Fl=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(c){var d=this.pts[this.startIndex[c]].x,p=this.pts[this.startIndex[c+1]].x;return d>p?d:p}},{key:"getMinX",value:function(c){var d=this.pts[this.startIndex[c]].x,p=this.pts[this.startIndex[c+1]].x;return d<p?d:p}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];this.computeIntersectsForChain(this.startIndex[c],this.startIndex[c+1],d,d.startIndex[p],d.startIndex[p+1],b)}else if(arguments.length===6){var L=arguments[0],O=arguments[1],V=arguments[2],K=arguments[3],pe=arguments[4],Be=arguments[5];if(O-L==1&&pe-K==1)return Be.addIntersections(this.e,L,V.e,K),null;if(!this.overlaps(L,O,V,K,pe))return null;var $e=Math.trunc((L+O)/2),mt=Math.trunc((K+pe)/2);L<$e&&(K<mt&&this.computeIntersectsForChain(L,$e,V,K,mt,Be),mt<pe&&this.computeIntersectsForChain(L,$e,V,mt,pe,Be)),$e<O&&(K<mt&&this.computeIntersectsForChain($e,O,V,K,mt,Be),mt<pe&&this.computeIntersectsForChain($e,O,V,mt,pe,Be))}}},{key:"overlaps",value:function(c,d,p,b,L){return dn.intersects(this.pts[c],this.pts[d],p.pts[b],p.pts[L])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(c,d){for(var p=0;p<this.startIndex.length-1;p++)for(var b=0;b<c.startIndex.length-1;b++)this.computeIntersectsForChain(p,c,b,d)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var c=arguments[0];this.e=c,this.pts=c.getCoordinates();var d=new zl;this.startIndex=d.getChainStartIndices(this.pts)}}]),I}(),ao=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getDepth",value:function(c,d){return this._depth[c][d]}},{key:"setDepth",value:function(c,d,p){this._depth[c][d]=p}},{key:"isNull",value:function(){if(arguments.length===0){for(var c=0;c<2;c++)for(var d=0;d<3;d++)if(this._depth[c][d]!==I.NULL_VALUE)return!1;return!0}if(arguments.length===1){var p=arguments[0];return this._depth[p][1]===I.NULL_VALUE}if(arguments.length===2){var b=arguments[0],L=arguments[1];return this._depth[b][L]===I.NULL_VALUE}}},{key:"normalize",value:function(){for(var c=0;c<2;c++)if(!this.isNull(c)){var d=this._depth[c][1];this._depth[c][2]<d&&(d=this._depth[c][2]),d<0&&(d=0);for(var p=1;p<3;p++){var b=0;this._depth[c][p]>d&&(b=1),this._depth[c][p]=b}}}},{key:"getDelta",value:function(c){return this._depth[c][Ie.RIGHT]-this._depth[c][Ie.LEFT]}},{key:"getLocation",value:function(c,d){return this._depth[c][d]<=0?Ee.EXTERIOR:Ee.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var c=arguments[0],d=0;d<2;d++)for(var p=1;p<3;p++){var b=c.getLocation(d,p);b!==Ee.EXTERIOR&&b!==Ee.INTERIOR||(this.isNull(d,p)?this._depth[d][p]=I.depthAtLocation(b):this._depth[d][p]+=I.depthAtLocation(b))}else if(arguments.length===3){var L=arguments[0],O=arguments[1],V=arguments[2];V===Ee.INTERIOR&&this._depth[L][O]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var c=0;c<2;c++)for(var d=0;d<3;d++)this._depth[c][d]=I.NULL_VALUE}},{key:"depthAtLocation",value:function(c){return c===Ee.EXTERIOR?0:c===Ee.INTERIOR?1:I.NULL_VALUE}}]),I}();ao.NULL_VALUE=-1;var Xo=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var p=new Array(2).fill(null);return p[0]=this.pts[0],p[1]=this.pts[1],new d(p,xi.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(p){this._isIsolated=p}},{key:"setName",value:function(p){this._name=p}},{key:"equals",value:function(p){if(!(p instanceof d))return!1;var b=p;if(this.pts.length!==b.pts.length)return!1;for(var L=!0,O=!0,V=this.pts.length,K=0;K<this.pts.length;K++)if(this.pts[K].equals2D(b.pts[K])||(L=!1),this.pts[K].equals2D(b.pts[--V])||(O=!1),!L&&!O)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var p=arguments[0];return this.pts[p]}}},{key:"print",value:function(p){p.print("edge "+this._name+": "),p.print("LINESTRING (");for(var b=0;b<this.pts.length;b++)b>0&&p.print(","),p.print(this.pts[b].x+" "+this.pts[b].y);p.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(p){d.updateIM(this._label,p)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(p){p.print("edge "+this._name+": ");for(var b=this.pts.length-1;b>=0;b--)p.print(this.pts[b]+" ");p.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new Fl(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new dn;for(var p=0;p<this.pts.length;p++)this._env.expandToInclude(this.pts[p])}return this._env}},{key:"addIntersection",value:function(p,b,L,O){var V=new We(p.getIntersection(O)),K=b,pe=p.getEdgeDistance(L,O),Be=K+1;if(Be<this.pts.length){var $e=this.pts[Be];V.equals2D($e)&&(K=Be,pe=0)}this.eiList.add(V,K,pe)}},{key:"toString",value:function(){var p=new ei;p.append("edge "+this._name+": "),p.append("LINESTRING (");for(var b=0;b<this.pts.length;b++)b>0&&p.append(","),p.append(this.pts[b].x+" "+this.pts[b].y);return p.append(")  "+this._label+" "+this._depthDelta),p.toString()}},{key:"isPointwiseEqual",value:function(p){if(this.pts.length!==p.pts.length)return!1;for(var b=0;b<this.pts.length;b++)if(!this.pts[b].equals2D(p.pts[b]))return!1;return!0}},{key:"setDepthDelta",value:function(p){this._depthDelta=p}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(p,b,L){for(var O=0;O<p.getIntersectionNum();O++)this.addIntersection(p,b,L,O)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new Ho(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new ao,this._depthDelta=0,arguments.length===1){var p=arguments[0];d.constructor_.call(this,p,null)}else if(arguments.length===2){var b=arguments[0],L=arguments[1];this.pts=b,this._label=L}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof rs&&arguments[0]instanceof xi))return U(m(d),"updateIM",this).apply(this,arguments);var p=arguments[0],b=arguments[1];b.setAtLeastIfValid(p.getLocation(0,Ie.ON),p.getLocation(1,Ie.ON),1),p.isArea()&&(b.setAtLeastIfValid(p.getLocation(0,Ie.LEFT),p.getLocation(1,Ie.LEFT),2),b.setAtLeastIfValid(p.getLocation(0,Ie.RIGHT),p.getLocation(1,Ie.RIGHT),2))}}]),d}(pa),Wo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setWorkingPrecisionModel",value:function(c){this._workingPrecisionModel=c}},{key:"insertUniqueEdge",value:function(c){var d=this._edgeList.findEqualEdge(c);if(d!==null){var p=d.getLabel(),b=c.getLabel();d.isPointwiseEqual(c)||(b=new xi(c.getLabel())).flip(),p.merge(b);var L=I.depthDelta(b),O=d.getDepthDelta()+L;d.setDepthDelta(O)}else this._edgeList.add(c),c.setDepthDelta(I.depthDelta(c.getLabel()))}},{key:"buildSubgraphs",value:function(c,d){for(var p=new At,b=c.iterator();b.hasNext();){var L=b.next(),O=L.getRightmostCoordinate(),V=new Za(p).getDepth(O);L.computeDepth(V),L.findResultEdges(),p.add(L),d.add(L.getDirectedEdges(),L.getNodes())}}},{key:"createSubgraphs",value:function(c){for(var d=new At,p=c.getNodes().iterator();p.hasNext();){var b=p.next();if(!b.isVisited()){var L=new Gr;L.create(b),d.add(L)}}return jo.sort(d,jo.reverseOrder()),d}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(c){if(this._workingNoder!==null)return this._workingNoder;var d=new Va,p=new so;return p.setPrecisionModel(c),d.setSegmentIntersector(new Dl(p)),d}},{key:"buffer",value:function(c,d){var p=this._workingPrecisionModel;p===null&&(p=c.getPrecisionModel()),this._geomFact=c.getFactory();var b=new Rl(p,this._bufParams),L=new kc(c,d,b).getCurves();if(L.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(L,p),this._graph=new vs(new hi),this._graph.addEdges(this._edgeList.getEdges());var O=this.createSubgraphs(this._graph),V=new bc(this._geomFact);this.buildSubgraphs(O,V);var K=V.getPolygons();return K.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(K)}},{key:"computeNodedEdges",value:function(c,d){var p=this.getNoder(d);p.computeNodes(c);for(var b=p.getNodedSubstrings().iterator();b.hasNext();){var L=b.next(),O=L.getCoordinates();if(O.length!==2||!O[0].equals2D(O[1])){var V=L.getData(),K=new Xo(L.getCoordinates(),new xi(V));this.insertUniqueEdge(K)}}}},{key:"setNoder",value:function(c){this._workingNoder=c}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new ba;var c=arguments[0];this._bufParams=c}},{key:"depthDelta",value:function(c){var d=c.getLocation(0,Ie.LEFT),p=c.getLocation(0,Ie.RIGHT);return d===Ee.INTERIOR&&p===Ee.EXTERIOR?1:d===Ee.EXTERIOR&&p===Ee.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(c){for(var d=new Qr,p=new At;c.hasNext();){var b=c.next(),L=d.createLineString(b.getCoordinates());p.add(L)}return d.buildGeometry(p)}}]),I}(),Ko=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"rescale",value:function(){if(Jt(arguments[0],lt))for(var c=arguments[0],d=c.iterator();d.hasNext();){var p=d.next();this.rescale(p.getCoordinates())}else if(arguments[0]instanceof Array){for(var b=arguments[0],L=0;L<b.length;L++)b[L].x=b[L].x/this._scaleFactor+this._offsetX,b[L].y=b[L].y/this._scaleFactor+this._offsetY;b.length===2&&b[0].equals2D(b[1])&&Pi.out.println(b)}}},{key:"scale",value:function(){if(Jt(arguments[0],lt)){for(var c=arguments[0],d=new At(c.size()),p=c.iterator();p.hasNext();){var b=p.next();d.add(new xs(this.scale(b.getCoordinates()),b.getData()))}return d}if(arguments[0]instanceof Array){for(var L=arguments[0],O=new Array(L.length).fill(null),V=0;V<L.length;V++)O[V]=new We(Math.round((L[V].x-this._offsetX)*this._scaleFactor),Math.round((L[V].y-this._offsetY)*this._scaleFactor),L[V].getZ());var K=Kn.removeRepeatedPoints(O);return K}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var c=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(c),c}},{key:"computeNodes",value:function(c){var d=c;this._isScaled&&(d=this.scale(c)),this._noder.computeNodes(d)}},{key:"interfaces_",get:function(){return[qa]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var c=arguments[0],d=arguments[1];I.constructor_.call(this,c,d,0,0)}else if(arguments.length===4){var p=arguments[0],b=arguments[1];this._noder=p,this._scaleFactor=b,this._isScaled=!this.isIntegerPrecision()}}}]),I}(),$o=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();){var d=c.next(),p=d.getCoordinates();this.checkEndPtVertexIntersections(p[0],this._segStrings),this.checkEndPtVertexIntersections(p[p.length-1],this._segStrings)}else if(arguments.length===2){for(var b=arguments[0],L=arguments[1],O=L.iterator();O.hasNext();)for(var V=O.next(),K=V.getCoordinates(),pe=1;pe<K.length-1;pe++)if(K[pe].equals(b))throw new ft("found endpt/interior pt intersection at index "+pe+" :pt "+b)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();)for(var d=c.next(),p=this._segStrings.iterator();p.hasNext();){var b=p.next();this.checkInteriorIntersections(d,b)}else if(arguments.length===2)for(var L=arguments[0],O=arguments[1],V=L.getCoordinates(),K=O.getCoordinates(),pe=0;pe<V.length-1;pe++)for(var Be=0;Be<K.length-1;Be++)this.checkInteriorIntersections(L,pe,O,Be);else if(arguments.length===4){var $e=arguments[0],mt=arguments[1],Ft=arguments[2],Nt=arguments[3];if($e===Ft&&mt===Nt)return null;var gn=$e.getCoordinates()[mt],vn=$e.getCoordinates()[mt+1],Ln=Ft.getCoordinates()[Nt],ni=Ft.getCoordinates()[Nt+1];if(this._li.computeIntersection(gn,vn,Ln,ni),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,gn,vn)||this.hasInteriorIntersection(this._li,Ln,ni)))throw new ft("found non-noded intersection at "+gn+"-"+vn+" and "+Ln+"-"+ni)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();){var d=c.next();this.checkCollapses(d)}else if(arguments.length===1)for(var p=arguments[0],b=p.getCoordinates(),L=0;L<b.length-2;L++)this.checkCollapse(b[L],b[L+1],b[L+2])}},{key:"hasInteriorIntersection",value:function(c,d,p){for(var b=0;b<c.getIntersectionNum();b++){var L=c.getIntersection(b);if(!L.equals(d)&&!L.equals(p))return!0}return!1}},{key:"checkCollapse",value:function(c,d,p){if(c.equals(p))throw new ft("found non-noded collapse at "+I.fact.createLineString([c,d,p]))}}],[{key:"constructor_",value:function(){this._li=new so,this._segStrings=null;var c=arguments[0];this._segStrings=c}}]),I}();$o.fact=new Qr;var Yo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"intersectsScaled",value:function(c,d){var p=Math.min(c.x,d.x),b=Math.max(c.x,d.x),L=Math.min(c.y,d.y),O=Math.max(c.y,d.y),V=this._maxx<p||this._minx>b||this._maxy<L||this._miny>O;if(V)return!1;var K=this.intersectsToleranceSquare(c,d);return It.isTrue(!(V&&K),"Found bad envelope test"),K}},{key:"initCorners",value:function(c){var d=.5;this._minx=c.x-d,this._maxx=c.x+d,this._miny=c.y-d,this._maxy=c.y+d,this._corner[0]=new We(this._maxx,this._maxy),this._corner[1]=new We(this._minx,this._maxy),this._corner[2]=new We(this._minx,this._miny),this._corner[3]=new We(this._maxx,this._miny)}},{key:"intersects",value:function(c,d){return this._scaleFactor===1?this.intersectsScaled(c,d):(this.copyScaled(c,this._p0Scaled),this.copyScaled(d,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(c){return Math.round(c*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(c,d){d.x=this.scale(c.x),d.y=this.scale(c.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var c=I.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new dn(this._originalPt.x-c,this._originalPt.x+c,this._originalPt.y-c,this._originalPt.y+c)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(c,d){return this._li.computeIntersection(c,d,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,d,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,d,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,d,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(c,d){var p=!1,b=!1;return this._li.computeIntersection(c,d,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(c,d,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(p=!0),this._li.computeIntersection(c,d,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(b=!0),this._li.computeIntersection(c,d,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!p||!b)||!!c.equals(this._pt)||!!d.equals(this._pt))))}},{key:"addSnappedNode",value:function(c,d){var p=c.getCoordinate(d),b=c.getCoordinate(d+1);return!!this.intersects(p,b)&&(c.addIntersection(this.getCoordinate(),d),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var c=arguments[0],d=arguments[1],p=arguments[2];if(this._originalPt=c,this._pt=c,this._scaleFactor=d,this._li=p,d<=0)throw new ve("Scale factor must be non-zero");d!==1&&(this._pt=new We(this.scale(c.x),this.scale(c.y)),this._p0Scaled=new We,this._p1Scaled=new We),this.initCorners(this._pt)}}]),I}();Yo.SAFE_ENV_EXPANSION_FACTOR=.75;var Jo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"select",value:function(){if(arguments.length!==1&&arguments.length===2){var c=arguments[0],d=arguments[1];c.getLineSegment(d,this.selectedSegment),this.select(this.selectedSegment)}}}],[{key:"constructor_",value:function(){this.selectedSegment=new Hr}}]),I}(),Eo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"snap",value:function(){if(arguments.length===1){var c=arguments[0];return this.snap(c,null,-1)}if(arguments.length===3){var d=arguments[0],p=arguments[1],b=arguments[2],L=d.getSafeEnvelope(),O=new Ol(d,p,b);return this._index.query(L,new(function(){function V(){n(this,V)}return a(V,[{key:"interfaces_",get:function(){return[Cl]}},{key:"visitItem",value:function(K){K.select(L,O)}}]),V}())),O.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var c=arguments[0];this._index=c}}]),I}(),Ol=function(I){h(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(C(p),arguments),p}return a(d,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof mu))return U(m(d.prototype),"select",this).apply(this,arguments);var p=arguments[0],b=arguments[1],L=p.getContext();if(this._parentEdge===L&&(b===this._hotPixelVertexIndex||b+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(L,b)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var p=arguments[0],b=arguments[1],L=arguments[2];this._hotPixel=p,this._parentEdge=b,this._hotPixelVertexIndex=L}}]),d}(Jo);Eo.HotPixelSnapAction=Ol;var Bl=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"processIntersections",value:function(c,d,p,b){if(c===p&&d===b)return null;var L=c.getCoordinates()[d],O=c.getCoordinates()[d+1],V=p.getCoordinates()[b],K=p.getCoordinates()[b+1];if(this._li.computeIntersection(L,O,V,K),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var pe=0;pe<this._li.getIntersectionNum();pe++)this._interiorIntersections.add(this._li.getIntersection(pe));c.addIntersections(this._li,d,0),p.addIntersections(this._li,b,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[Zo]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var c=arguments[0];this._li=c,this._interiorIntersections=new At}}]),I}(),Yn=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"checkCorrectness",value:function(c){var d=xs.getNodedSubstrings(c),p=new $o(d);try{p.checkValid()}catch(b){if(!(b instanceof _e))throw b;b.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return xs.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(c,d){var p=this.findInteriorIntersections(c,d);this.computeIntersectionSnaps(p),this.computeVertexSnaps(c)}},{key:"findInteriorIntersections",value:function(c,d){var p=new Bl(d);return this._noder.setSegmentIntersector(p),this._noder.computeNodes(c),p.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(Jt(arguments[0],lt))for(var c=arguments[0],d=c.iterator();d.hasNext();){var p=d.next();this.computeVertexSnaps(p)}else if(arguments[0]instanceof xs)for(var b=arguments[0],L=b.getCoordinates(),O=0;O<L.length;O++){var V=new Yo(L[O],this._scaleFactor,this._li),K=this._pointSnapper.snap(V,b,O);K&&b.addIntersection(L[O],O)}}},{key:"computeNodes",value:function(c){this._nodedSegStrings=c,this._noder=new Va,this._pointSnapper=new Eo(this._noder.getIndex()),this.snapRound(c,this._li)}},{key:"computeIntersectionSnaps",value:function(c){for(var d=c.iterator();d.hasNext();){var p=d.next(),b=new Yo(p,this._scaleFactor,this._li);this._pointSnapper.snap(b)}}},{key:"interfaces_",get:function(){return[qa]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var c=arguments[0];this._pm=c,this._li=new so,this._li.setPrecisionModel(c),this._scaleFactor=c.getScale()}}]),I}(),Gs=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"bufferFixedPrecision",value:function(c){var d=new Ko(new Yn(new Ni(1)),c.getScale()),p=new Wo(this._bufParams);p.setWorkingPrecisionModel(c),p.setNoder(d),this._resultGeometry=p.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var c=I.MAX_PRECISION_DIGITS;c>=0;c--){try{this.bufferReducedPrecision(c)}catch(L){if(!(L instanceof Mt))throw L;this._saveException=L}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var d=arguments[0],p=I.precisionScaleFactor(this._argGeom,this._distance,d),b=new Ni(p);this.bufferFixedPrecision(b)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var c=this._argGeom.getFactory().getPrecisionModel();c.getType()===Ni.FIXED?this.bufferFixedPrecision(c):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(c){this._bufParams.setQuadrantSegments(c)}},{key:"bufferOriginalPrecision",value:function(){try{var c=new Wo(this._bufParams);this._resultGeometry=c.buffer(this._argGeom,this._distance)}catch(d){if(!(d instanceof ft))throw d;this._saveException=d}}},{key:"getResultGeometry",value:function(c){return this._distance=c,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(c){this._bufParams.setEndCapStyle(c)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Y,this._resultGeometry=null,this._saveException=null,arguments.length===1){var c=arguments[0];this._argGeom=c}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this._argGeom=d,this._bufParams=p}}},{key:"bufferOp",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1],p=new I(c),b=p.getResultGeometry(d);return b}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Ot&&typeof arguments[1]=="number"){var L=arguments[0],O=arguments[1],V=arguments[2],K=new I(L);K.setQuadrantSegments(V);var pe=K.getResultGeometry(O);return pe}if(arguments[2]instanceof Y&&arguments[0]instanceof Ot&&typeof arguments[1]=="number"){var Be=arguments[0],$e=arguments[1],mt=arguments[2],Ft=new I(Be,mt),Nt=Ft.getResultGeometry($e);return Nt}}else if(arguments.length===4){var gn=arguments[0],vn=arguments[1],Ln=arguments[2],ni=arguments[3],gi=new I(gn);gi.setQuadrantSegments(Ln),gi.setEndCapStyle(ni);var ui=gi.getResultGeometry(vn);return ui}}},{key:"precisionScaleFactor",value:function(c,d,p){var b=c.getEnvelopeInternal(),L=Ar.max(Math.abs(b.getMaxX()),Math.abs(b.getMaxY()),Math.abs(b.getMinX()),Math.abs(b.getMinY()))+2*(d>0?d:0),O=p-Math.trunc(Math.log(L)/Math.log(10)+1);return Math.pow(10,O)}}]),I}();Gs.CAP_ROUND=Y.CAP_ROUND,Gs.CAP_BUTT=Y.CAP_FLAT,Gs.CAP_FLAT=Y.CAP_FLAT,Gs.CAP_SQUARE=Y.CAP_SQUARE,Gs.MAX_PRECISION_DIGITS=12;var Sc=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Ul=function(){function I(c){n(this,I),this.geometryFactory=c||new Qr}return a(I,[{key:"read",value:function(c){var d,p=(d=typeof c=="string"?JSON.parse(c):c).type;if(!fr[p])throw new Error("Unknown GeoJSON type: "+d.type);return Sc.indexOf(p)!==-1?fr[p].call(this,d.coordinates):p==="GeometryCollection"?fr[p].call(this,d.geometries):fr[p].call(this,d)}},{key:"write",value:function(c){var d=c.getGeometryType();if(!ws[d])throw new Error("Geometry is not supported");return ws[d].call(this,c)}}]),I}(),fr={Feature:function(I){var c={};for(var d in I)c[d]=I[d];if(I.geometry){var p=I.geometry.type;if(!fr[p])throw new Error("Unknown GeoJSON type: "+I.type);c.geometry=this.read(I.geometry)}return I.bbox&&(c.bbox=fr.bbox.call(this,I.bbox)),c},FeatureCollection:function(I){var c={};if(I.features){c.features=[];for(var d=0;d<I.features.length;++d)c.features.push(this.read(I.features[d]))}return I.bbox&&(c.bbox=this.parse.bbox.call(this,I.bbox)),c},coordinates:function(I){for(var c=[],d=0;d<I.length;++d){var p=I[d];c.push(S(We,ee(p)))}return c},bbox:function(I){return this.geometryFactory.createLinearRing([new We(I[0],I[1]),new We(I[2],I[1]),new We(I[2],I[3]),new We(I[0],I[3]),new We(I[0],I[1])])},Point:function(I){var c=S(We,ee(I));return this.geometryFactory.createPoint(c)},MultiPoint:function(I){for(var c=[],d=0;d<I.length;++d)c.push(fr.Point.call(this,I[d]));return this.geometryFactory.createMultiPoint(c)},LineString:function(I){var c=fr.coordinates.call(this,I);return this.geometryFactory.createLineString(c)},MultiLineString:function(I){for(var c=[],d=0;d<I.length;++d)c.push(fr.LineString.call(this,I[d]));return this.geometryFactory.createMultiLineString(c)},Polygon:function(I){for(var c=fr.coordinates.call(this,I[0]),d=this.geometryFactory.createLinearRing(c),p=[],b=1;b<I.length;++b){var L=I[b],O=fr.coordinates.call(this,L),V=this.geometryFactory.createLinearRing(O);p.push(V)}return this.geometryFactory.createPolygon(d,p)},MultiPolygon:function(I){for(var c=[],d=0;d<I.length;++d){var p=I[d];c.push(fr.Polygon.call(this,p))}return this.geometryFactory.createMultiPolygon(c)},GeometryCollection:function(I){for(var c=[],d=0;d<I.length;++d){var p=I[d];c.push(this.read(p))}return this.geometryFactory.createGeometryCollection(c)}},ws={coordinate:function(I){var c=[I.x,I.y];return I.z&&c.push(I.z),I.m&&c.push(I.m),c},Point:function(I){return{type:"Point",coordinates:ws.coordinate.call(this,I.getCoordinate())}},MultiPoint:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=ws.Point.call(this,p);c.push(b.coordinates)}return{type:"MultiPoint",coordinates:c}},LineString:function(I){for(var c=[],d=I.getCoordinates(),p=0;p<d.length;++p){var b=d[p];c.push(ws.coordinate.call(this,b))}return{type:"LineString",coordinates:c}},MultiLineString:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=ws.LineString.call(this,p);c.push(b.coordinates)}return{type:"MultiLineString",coordinates:c}},Polygon:function(I){var c=[],d=ws.LineString.call(this,I._shell);c.push(d.coordinates);for(var p=0;p<I._holes.length;++p){var b=I._holes[p],L=ws.LineString.call(this,b);c.push(L.coordinates)}return{type:"Polygon",coordinates:c}},MultiPolygon:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=ws.Polygon.call(this,p);c.push(b.coordinates)}return{type:"MultiPolygon",coordinates:c}},GeometryCollection:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=p.getGeometryType();c.push(ws[b].call(this,p))}return{type:"GeometryCollection",geometries:c}}};return{BufferOp:Gs,GeoJSONReader:function(){function I(c){n(this,I),this.parser=new Ul(c||new Qr)}return a(I,[{key:"read",value:function(c){return this.parser.read(c)}}]),I}(),GeoJSONWriter:function(){function I(){n(this,I),this.parser=new Ul(this.geometryFactory)}return a(I,[{key:"write",value:function(c){return this.parser.write(c)}}]),I}()}})})(pv);var Iw=pv.exports;const Sw=kw(Iw);function Sl(){return new Of}function Of(){this.reset()}Of.prototype={constructor:Of,reset:function(){this.s=this.t=0},add:function(r){u_(yf,r,this.t),u_(this,yf.s,this.s),this.s?this.t+=yf.t:this.s=yf.t},valueOf:function(){return this.s}};var yf=new Of;function u_(r,e,n){var s=r.s=e+n,a=s-e,h=s-a;r.t=e-h+(n-a)}var Bi=1e-6,pi=Math.PI,sa=pi/2,c_=pi/4,oa=pi*2,pl=180/pi,mo=pi/180,Vr=Math.abs,Ew=Math.atan,rc=Math.atan2,nr=Math.cos,ir=Math.sin,fc=Math.sqrt;function mv(r){return r>1?0:r<-1?pi:Math.acos(r)}function su(r){return r>1?sa:r<-1?-sa:Math.asin(r)}function mh(){}function Bf(r,e){r&&f_.hasOwnProperty(r.type)&&f_[r.type](r,e)}var h_={Feature:function(r,e){Bf(r.geometry,e)},FeatureCollection:function(r,e){for(var n=r.features,s=-1,a=n.length;++s<a;)Bf(n[s].geometry,e)}},f_={Sphere:function(r,e){e.sphere()},Point:function(r,e){r=r.coordinates,e.point(r[0],r[1],r[2])},MultiPoint:function(r,e){for(var n=r.coordinates,s=-1,a=n.length;++s<a;)r=n[s],e.point(r[0],r[1],r[2])},LineString:function(r,e){kp(r.coordinates,e,0)},MultiLineString:function(r,e){for(var n=r.coordinates,s=-1,a=n.length;++s<a;)kp(n[s],e,0)},Polygon:function(r,e){d_(r.coordinates,e)},MultiPolygon:function(r,e){for(var n=r.coordinates,s=-1,a=n.length;++s<a;)d_(n[s],e)},GeometryCollection:function(r,e){for(var n=r.geometries,s=-1,a=n.length;++s<a;)Bf(n[s],e)}};function kp(r,e,n){var s=-1,a=r.length-n,h;for(e.lineStart();++s<a;)h=r[s],e.point(h[0],h[1],h[2]);e.lineEnd()}function d_(r,e){var n=-1,s=r.length;for(e.polygonStart();++n<s;)kp(r[n],e,1);e.polygonEnd()}function Aw(r,e){r&&h_.hasOwnProperty(r.type)?h_[r.type](r,e):Bf(r,e)}Sl();Sl();function Ip(r){return[rc(r[1],r[0]),su(r[2])]}function sc(r){var e=r[0],n=r[1],s=nr(n);return[s*nr(e),s*ir(e),ir(n)]}function vf(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Uf(r,e){return[r[1]*e[2]-r[2]*e[1],r[2]*e[0]-r[0]*e[2],r[0]*e[1]-r[1]*e[0]]}function op(r,e){r[0]+=e[0],r[1]+=e[1],r[2]+=e[2]}function bf(r,e){return[r[0]*e,r[1]*e,r[2]*e]}function Sp(r){var e=fc(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]/=e,r[1]/=e,r[2]/=e}Sl();function gv(r,e){function n(s,a){return s=r(s,a),e(s[0],s[1])}return r.invert&&e.invert&&(n.invert=function(s,a){return s=e.invert(s,a),s&&r.invert(s[0],s[1])}),n}function Ep(r,e){return[r>pi?r-oa:r<-pi?r+oa:r,e]}Ep.invert=Ep;function Tw(r,e,n){return(r%=oa)?e||n?gv(m_(r),g_(e,n)):m_(r):e||n?g_(e,n):Ep}function p_(r){return function(e,n){return e+=r,[e>pi?e-oa:e<-pi?e+oa:e,n]}}function m_(r){var e=p_(r);return e.invert=p_(-r),e}function g_(r,e){var n=nr(r),s=ir(r),a=nr(e),h=ir(e);function m(l,x){var S=nr(x),T=nr(l)*S,C=ir(l)*S,N=ir(x),B=N*n+T*s;return[rc(C*a-B*h,T*n-N*s),su(B*a+C*h)]}return m.invert=function(l,x){var S=nr(x),T=nr(l)*S,C=ir(l)*S,N=ir(x),B=N*a-C*h;return[rc(C*a+N*h,T*n+B*s),su(B*n-T*s)]},m}function Cw(r,e,n,s,a,h){if(n){var m=nr(e),l=ir(e),x=s*n;a==null?(a=e+s*oa,h=e-x/2):(a=__(m,a),h=__(m,h),(s>0?a<h:a>h)&&(a+=s*oa));for(var S,T=a;s>0?T>h:T<h;T-=x)S=Ip([m,-l*nr(T),-l*ir(T)]),r.point(S[0],S[1])}}function __(r,e){e=sc(e),e[0]-=r,Sp(e);var n=mv(-e[1]);return((-e[2]<0?-n:n)+oa-Bi)%oa}function _v(){var r=[],e;return{point:function(n,s){e.push([n,s])},lineStart:function(){r.push(e=[])},lineEnd:mh,rejoin:function(){r.length>1&&r.push(r.pop().concat(r.shift()))},result:function(){var n=r;return r=[],e=null,n}}}function Lw(r,e,n,s,a,h){var m=r[0],l=r[1],x=e[0],S=e[1],T=0,C=1,N=x-m,B=S-l,U;if(U=n-m,!(!N&&U>0)){if(U/=N,N<0){if(U<T)return;U<C&&(C=U)}else if(N>0){if(U>C)return;U>T&&(T=U)}if(U=a-m,!(!N&&U<0)){if(U/=N,N<0){if(U>C)return;U>T&&(T=U)}else if(N>0){if(U<T)return;U<C&&(C=U)}if(U=s-l,!(!B&&U>0)){if(U/=B,B<0){if(U<T)return;U<C&&(C=U)}else if(B>0){if(U>C)return;U>T&&(T=U)}if(U=h-l,!(!B&&U<0)){if(U/=B,B<0){if(U>C)return;U>T&&(T=U)}else if(B>0){if(U<T)return;U<C&&(C=U)}return T>0&&(r[0]=m+T*N,r[1]=l+T*B),C<1&&(e[0]=m+C*N,e[1]=l+C*B),!0}}}}}function Cf(r,e){return Vr(r[0]-e[0])<Bi&&Vr(r[1]-e[1])<Bi}function xf(r,e,n,s){this.x=r,this.z=e,this.o=n,this.e=s,this.v=!1,this.n=this.p=null}function yv(r,e,n,s,a){var h=[],m=[],l,x;if(r.forEach(function(U){if(!((ee=U.length-1)<=0)){var ee,ie=U[0],se=U[ee],Q;if(Cf(ie,se)){for(a.lineStart(),l=0;l<ee;++l)a.point((ie=U[l])[0],ie[1]);a.lineEnd();return}h.push(Q=new xf(ie,U,null,!0)),m.push(Q.o=new xf(ie,null,Q,!1)),h.push(Q=new xf(se,U,null,!1)),m.push(Q.o=new xf(se,null,Q,!0))}}),!!h.length){for(m.sort(e),y_(h),y_(m),l=0,x=m.length;l<x;++l)m[l].e=n=!n;for(var S=h[0],T,C;;){for(var N=S,B=!0;N.v;)if((N=N.n)===S)return;T=N.z,a.lineStart();do{if(N.v=N.o.v=!0,N.e){if(B)for(l=0,x=T.length;l<x;++l)a.point((C=T[l])[0],C[1]);else s(N.x,N.n.x,1,a);N=N.n}else{if(B)for(T=N.p.z,l=T.length-1;l>=0;--l)a.point((C=T[l])[0],C[1]);else s(N.x,N.p.x,-1,a);N=N.p}N=N.o,T=N.z,B=!B}while(!N.v);a.lineEnd()}}}function y_(r){if(e=r.length){for(var e,n=0,s=r[0],a;++n<e;)s.n=a=r[n],a.p=s,s=a;s.n=a=r[0],a.p=s}}function vv(r,e){return r<e?-1:r>e?1:r>=e?0:NaN}function Mw(r){return r.length===1&&(r=Rw(r)),{left:function(e,n,s,a){for(s==null&&(s=0),a==null&&(a=e.length);s<a;){var h=s+a>>>1;r(e[h],n)<0?s=h+1:a=h}return s},right:function(e,n,s,a){for(s==null&&(s=0),a==null&&(a=e.length);s<a;){var h=s+a>>>1;r(e[h],n)>0?a=h:s=h+1}return s}}}function Rw(r){return function(e,n){return vv(r(e),n)}}Mw(vv);function bv(r){for(var e=r.length,n,s=-1,a=0,h,m;++s<e;)a+=r[s].length;for(h=new Array(a);--e>=0;)for(m=r[e],n=m.length;--n>=0;)h[--a]=m[n];return h}var gh=1e9,wf=-gh;function Pw(r,e,n,s){function a(S,T){return r<=S&&S<=n&&e<=T&&T<=s}function h(S,T,C,N){var B=0,U=0;if(S==null||(B=m(S,C))!==(U=m(T,C))||x(S,T)<0^C>0)do N.point(B===0||B===3?r:n,B>1?s:e);while((B=(B+C+4)%4)!==U);else N.point(T[0],T[1])}function m(S,T){return Vr(S[0]-r)<Bi?T>0?0:3:Vr(S[0]-n)<Bi?T>0?2:1:Vr(S[1]-e)<Bi?T>0?1:0:T>0?3:2}function l(S,T){return x(S.x,T.x)}function x(S,T){var C=m(S,1),N=m(T,1);return C!==N?C-N:C===0?T[1]-S[1]:C===1?S[0]-T[0]:C===2?S[1]-T[1]:T[0]-S[0]}return function(S){var T=S,C=_v(),N,B,U,ee,ie,se,Q,Y,_e,ve,Ae,ce={point:xe,lineStart:ye,lineEnd:Ue,polygonStart:Le,polygonEnd:ke};function xe(pt,St){a(pt,St)&&T.point(pt,St)}function be(){for(var pt=0,St=0,dt=B.length;St<dt;++St)for(var ut=B[St],Ut=1,vt=ut.length,kt=ut[0],ft,wt,It=kt[0],$t=kt[1];Ut<vt;++Ut)ft=It,wt=$t,kt=ut[Ut],It=kt[0],$t=kt[1],wt<=s?$t>s&&(It-ft)*(s-wt)>($t-wt)*(r-ft)&&++pt:$t<=s&&(It-ft)*(s-wt)<($t-wt)*(r-ft)&&--pt;return pt}function Le(){T=C,N=[],B=[],Ae=!0}function ke(){var pt=be(),St=Ae&&pt,dt=(N=bv(N)).length;(St||dt)&&(S.polygonStart(),St&&(S.lineStart(),h(null,null,1,S),S.lineEnd()),dt&&yv(N,l,pt,h,S),S.polygonEnd()),T=S,N=B=U=null}function ye(){ce.point=qe,B&&B.push(U=[]),ve=!0,_e=!1,Q=Y=NaN}function Ue(){N&&(qe(ee,ie),se&&_e&&C.rejoin(),N.push(C.result())),ce.point=xe,_e&&T.lineEnd()}function qe(pt,St){var dt=a(pt,St);if(B&&U.push([pt,St]),ve)ee=pt,ie=St,se=dt,ve=!1,dt&&(T.lineStart(),T.point(pt,St));else if(dt&&_e)T.point(pt,St);else{var ut=[Q=Math.max(wf,Math.min(gh,Q)),Y=Math.max(wf,Math.min(gh,Y))],Ut=[pt=Math.max(wf,Math.min(gh,pt)),St=Math.max(wf,Math.min(gh,St))];Lw(ut,Ut,r,e,n,s)?(_e||(T.lineStart(),T.point(ut[0],ut[1])),T.point(Ut[0],Ut[1]),dt||T.lineEnd(),Ae=!1):dt&&(T.lineStart(),T.point(pt,St),Ae=!1)}Q=pt,Y=St,_e=dt}return ce}}var ap=Sl();function Dw(r,e){var n=e[0],s=e[1],a=[ir(n),-nr(n),0],h=0,m=0;ap.reset();for(var l=0,x=r.length;l<x;++l)if(T=(S=r[l]).length)for(var S,T,C=S[T-1],N=C[0],B=C[1]/2+c_,U=ir(B),ee=nr(B),ie=0;ie<T;++ie,N=Q,U=_e,ee=ve,C=se){var se=S[ie],Q=se[0],Y=se[1]/2+c_,_e=ir(Y),ve=nr(Y),Ae=Q-N,ce=Ae>=0?1:-1,xe=ce*Ae,be=xe>pi,Le=U*_e;if(ap.add(rc(Le*ce*ir(xe),ee*ve+Le*nr(xe))),h+=be?Ae+ce*oa:Ae,be^N>=n^Q>=n){var ke=Uf(sc(C),sc(se));Sp(ke);var ye=Uf(a,ke);Sp(ye);var Ue=(be^Ae>=0?-1:1)*su(ye[2]);(s>Ue||s===Ue&&(ke[0]||ke[1]))&&(m+=be^Ae>=0?1:-1)}}return(h<-Bi||h<Bi&&ap<-Bi)^m&1}Sl();function v_(r){return r}Sl();Sl();var oc=1/0,jf=oc,Mh=-oc,qf=Mh,b_={point:Nw,lineStart:mh,lineEnd:mh,polygonStart:mh,polygonEnd:mh,result:function(){var r=[[oc,jf],[Mh,qf]];return Mh=qf=-(jf=oc=1/0),r}};function Nw(r,e){r<oc&&(oc=r),r>Mh&&(Mh=r),e<jf&&(jf=e),e>qf&&(qf=e)}Sl();function xv(r,e,n,s){return function(a,h){var m=e(h),l=a.invert(s[0],s[1]),x=_v(),S=e(x),T=!1,C,N,B,U={point:ee,lineStart:se,lineEnd:Q,polygonStart:function(){U.point=Y,U.lineStart=_e,U.lineEnd=ve,N=[],C=[]},polygonEnd:function(){U.point=ee,U.lineStart=se,U.lineEnd=Q,N=bv(N);var Ae=Dw(C,l);N.length?(T||(h.polygonStart(),T=!0),yv(N,Fw,Ae,n,h)):Ae&&(T||(h.polygonStart(),T=!0),h.lineStart(),n(null,null,1,h),h.lineEnd()),T&&(h.polygonEnd(),T=!1),N=C=null},sphere:function(){h.polygonStart(),h.lineStart(),n(null,null,1,h),h.lineEnd(),h.polygonEnd()}};function ee(Ae,ce){var xe=a(Ae,ce);r(Ae=xe[0],ce=xe[1])&&h.point(Ae,ce)}function ie(Ae,ce){var xe=a(Ae,ce);m.point(xe[0],xe[1])}function se(){U.point=ie,m.lineStart()}function Q(){U.point=ee,m.lineEnd()}function Y(Ae,ce){B.push([Ae,ce]);var xe=a(Ae,ce);S.point(xe[0],xe[1])}function _e(){S.lineStart(),B=[]}function ve(){Y(B[0][0],B[0][1]),S.lineEnd();var Ae=S.clean(),ce=x.result(),xe,be=ce.length,Le,ke,ye;if(B.pop(),C.push(B),B=null,!!be){if(Ae&1){if(ke=ce[0],(Le=ke.length-1)>0){for(T||(h.polygonStart(),T=!0),h.lineStart(),xe=0;xe<Le;++xe)h.point((ye=ke[xe])[0],ye[1]);h.lineEnd()}return}be>1&&Ae&2&&ce.push(ce.pop().concat(ce.shift())),N.push(ce.filter(zw))}}return U}}function zw(r){return r.length>1}function Fw(r,e){return((r=r.x)[0]<0?r[1]-sa-Bi:sa-r[1])-((e=e.x)[0]<0?e[1]-sa-Bi:sa-e[1])}const x_=xv(function(){return!0},Ow,Uw,[-pi,-sa]);function Ow(r){var e=NaN,n=NaN,s=NaN,a;return{lineStart:function(){r.lineStart(),a=1},point:function(h,m){var l=h>0?pi:-pi,x=Vr(h-e);Vr(x-pi)<Bi?(r.point(e,n=(n+m)/2>0?sa:-sa),r.point(s,n),r.lineEnd(),r.lineStart(),r.point(l,n),r.point(h,n),a=0):s!==l&&x>=pi&&(Vr(e-s)<Bi&&(e-=s*Bi),Vr(h-l)<Bi&&(h-=l*Bi),n=Bw(e,n,h,m),r.point(s,n),r.lineEnd(),r.lineStart(),r.point(l,n),a=0),r.point(e=h,n=m),s=l},lineEnd:function(){r.lineEnd(),e=n=NaN},clean:function(){return 2-a}}}function Bw(r,e,n,s){var a,h,m=ir(r-n);return Vr(m)>Bi?Ew((ir(e)*(h=nr(s))*ir(n)-ir(s)*(a=nr(e))*ir(r))/(a*h*m)):(e+s)/2}function Uw(r,e,n,s){var a;if(r==null)a=n*sa,s.point(-pi,a),s.point(0,a),s.point(pi,a),s.point(pi,0),s.point(pi,-a),s.point(0,-a),s.point(-pi,-a),s.point(-pi,0),s.point(-pi,a);else if(Vr(r[0]-e[0])>Bi){var h=r[0]<e[0]?pi:-pi;a=n*h/2,s.point(-h,a),s.point(0,a),s.point(h,a)}else s.point(e[0],e[1])}function jw(r,e){var n=nr(r),s=n>0,a=Vr(n)>Bi;function h(T,C,N,B){Cw(B,r,e,N,T,C)}function m(T,C){return nr(T)*nr(C)>n}function l(T){var C,N,B,U,ee;return{lineStart:function(){U=B=!1,ee=1},point:function(ie,se){var Q=[ie,se],Y,_e=m(ie,se),ve=s?_e?0:S(ie,se):_e?S(ie+(ie<0?pi:-pi),se):0;if(!C&&(U=B=_e)&&T.lineStart(),_e!==B&&(Y=x(C,Q),(!Y||Cf(C,Y)||Cf(Q,Y))&&(Q[0]+=Bi,Q[1]+=Bi,_e=m(Q[0],Q[1]))),_e!==B)ee=0,_e?(T.lineStart(),Y=x(Q,C),T.point(Y[0],Y[1])):(Y=x(C,Q),T.point(Y[0],Y[1]),T.lineEnd()),C=Y;else if(a&&C&&s^_e){var Ae;!(ve&N)&&(Ae=x(Q,C,!0))&&(ee=0,s?(T.lineStart(),T.point(Ae[0][0],Ae[0][1]),T.point(Ae[1][0],Ae[1][1]),T.lineEnd()):(T.point(Ae[1][0],Ae[1][1]),T.lineEnd(),T.lineStart(),T.point(Ae[0][0],Ae[0][1])))}_e&&(!C||!Cf(C,Q))&&T.point(Q[0],Q[1]),C=Q,B=_e,N=ve},lineEnd:function(){B&&T.lineEnd(),C=null},clean:function(){return ee|(U&&B)<<1}}}function x(T,C,N){var B=sc(T),U=sc(C),ee=[1,0,0],ie=Uf(B,U),se=vf(ie,ie),Q=ie[0],Y=se-Q*Q;if(!Y)return!N&&T;var _e=n*se/Y,ve=-n*Q/Y,Ae=Uf(ee,ie),ce=bf(ee,_e),xe=bf(ie,ve);op(ce,xe);var be=Ae,Le=vf(ce,be),ke=vf(be,be),ye=Le*Le-ke*(vf(ce,ce)-1);if(!(ye<0)){var Ue=fc(ye),qe=bf(be,(-Le-Ue)/ke);if(op(qe,ce),qe=Ip(qe),!N)return qe;var pt=T[0],St=C[0],dt=T[1],ut=C[1],Ut;St<pt&&(Ut=pt,pt=St,St=Ut);var vt=St-pt,kt=Vr(vt-pi)<Bi,ft=kt||vt<Bi;if(!kt&&ut<dt&&(Ut=dt,dt=ut,ut=Ut),ft?kt?dt+ut>0^qe[1]<(Vr(qe[0]-pt)<Bi?dt:ut):dt<=qe[1]&&qe[1]<=ut:vt>pi^(pt<=qe[0]&&qe[0]<=St)){var wt=bf(be,(-Le+Ue)/ke);return op(wt,ce),[qe,Ip(wt)]}}}function S(T,C){var N=s?r:pi-r,B=0;return T<-N?B|=1:T>N&&(B|=2),C<-N?B|=4:C>N&&(B|=8),B}return xv(m,l,h,s?[0,-r]:[-pi,r-pi])}function wv(r){return function(e){var n=new Ap;for(var s in r)n[s]=r[s];return n.stream=e,n}}function Ap(){}Ap.prototype={constructor:Ap,point:function(r,e){this.stream.point(r,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function kv(r,e,n){var s=e[1][0]-e[0][0],a=e[1][1]-e[0][1],h=r.clipExtent&&r.clipExtent();r.scale(150).translate([0,0]),h!=null&&r.clipExtent(null),Aw(n,r.stream(b_));var m=b_.result(),l=Math.min(s/(m[1][0]-m[0][0]),a/(m[1][1]-m[0][1])),x=+e[0][0]+(s-l*(m[1][0]+m[0][0]))/2,S=+e[0][1]+(a-l*(m[1][1]+m[0][1]))/2;return h!=null&&r.clipExtent(h),r.scale(l*150).translate([x,S])}function qw(r,e,n){return kv(r,[[0,0],e],n)}var w_=16,Vw=nr(30*mo);function k_(r,e){return+e?Zw(r,e):Gw(r)}function Gw(r){return wv({point:function(e,n){e=r(e,n),this.stream.point(e[0],e[1])}})}function Zw(r,e){function n(s,a,h,m,l,x,S,T,C,N,B,U,ee,ie){var se=S-s,Q=T-a,Y=se*se+Q*Q;if(Y>4*e&&ee--){var _e=m+N,ve=l+B,Ae=x+U,ce=fc(_e*_e+ve*ve+Ae*Ae),xe=su(Ae/=ce),be=Vr(Vr(Ae)-1)<Bi||Vr(h-C)<Bi?(h+C)/2:rc(ve,_e),Le=r(be,xe),ke=Le[0],ye=Le[1],Ue=ke-s,qe=ye-a,pt=Q*Ue-se*qe;(pt*pt/Y>e||Vr((se*Ue+Q*qe)/Y-.5)>.3||m*N+l*B+x*U<Vw)&&(n(s,a,h,m,l,x,ke,ye,be,_e/=ce,ve/=ce,Ae,ee,ie),ie.point(ke,ye),n(ke,ye,be,_e,ve,Ae,S,T,C,N,B,U,ee,ie))}}return function(s){var a,h,m,l,x,S,T,C,N,B,U,ee,ie={point:se,lineStart:Q,lineEnd:_e,polygonStart:function(){s.polygonStart(),ie.lineStart=ve},polygonEnd:function(){s.polygonEnd(),ie.lineStart=Q}};function se(xe,be){xe=r(xe,be),s.point(xe[0],xe[1])}function Q(){C=NaN,ie.point=Y,s.lineStart()}function Y(xe,be){var Le=sc([xe,be]),ke=r(xe,be);n(C,N,T,B,U,ee,C=ke[0],N=ke[1],T=xe,B=Le[0],U=Le[1],ee=Le[2],w_,s),s.point(C,N)}function _e(){ie.point=se,s.lineEnd()}function ve(){Q(),ie.point=Ae,ie.lineEnd=ce}function Ae(xe,be){Y(a=xe,be),h=C,m=N,l=B,x=U,S=ee,ie.point=Y}function ce(){n(C,N,T,B,U,ee,h,m,a,l,x,S,w_,s),ie.lineEnd=_e,_e()}return ie}}var Hw=wv({point:function(r,e){this.stream.point(r*mo,e*mo)}});function Xw(r){return Ww(function(){return r})()}function Ww(r){var e,n=150,s=480,a=250,h,m,l=0,x=0,S=0,T=0,C=0,N,B,U=null,ee=x_,ie=null,se,Q,Y,_e=v_,ve=.5,Ae=k_(ke,ve),ce,xe;function be(qe){return qe=B(qe[0]*mo,qe[1]*mo),[qe[0]*n+h,m-qe[1]*n]}function Le(qe){return qe=B.invert((qe[0]-h)/n,(m-qe[1])/n),qe&&[qe[0]*pl,qe[1]*pl]}function ke(qe,pt){return qe=e(qe,pt),[qe[0]*n+h,m-qe[1]*n]}be.stream=function(qe){return ce&&xe===qe?ce:ce=Hw(ee(N,Ae(_e(xe=qe))))},be.clipAngle=function(qe){return arguments.length?(ee=+qe?jw(U=qe*mo,6*mo):(U=null,x_),Ue()):U*pl},be.clipExtent=function(qe){return arguments.length?(_e=qe==null?(ie=se=Q=Y=null,v_):Pw(ie=+qe[0][0],se=+qe[0][1],Q=+qe[1][0],Y=+qe[1][1]),Ue()):ie==null?null:[[ie,se],[Q,Y]]},be.scale=function(qe){return arguments.length?(n=+qe,ye()):n},be.translate=function(qe){return arguments.length?(s=+qe[0],a=+qe[1],ye()):[s,a]},be.center=function(qe){return arguments.length?(l=qe[0]%360*mo,x=qe[1]%360*mo,ye()):[l*pl,x*pl]},be.rotate=function(qe){return arguments.length?(S=qe[0]%360*mo,T=qe[1]%360*mo,C=qe.length>2?qe[2]%360*mo:0,ye()):[S*pl,T*pl,C*pl]},be.precision=function(qe){return arguments.length?(Ae=k_(ke,ve=qe*qe),Ue()):fc(ve)},be.fitExtent=function(qe,pt){return kv(be,qe,pt)},be.fitSize=function(qe,pt){return qw(be,qe,pt)};function ye(){B=gv(N=Tw(S,T,C),e);var qe=e(l,x);return h=s-qe[0]*n,m=a+qe[1]*n,Ue()}function Ue(){return ce=xe=null,be}return function(){return e=r.apply(this,arguments),be.invert=e.invert&&Le,ye()}}function Iv(r){return function(e,n){var s=nr(e),a=nr(n),h=r(s*a);return[h*a*ir(e),h*ir(n)]}}function Sv(r){return function(e,n){var s=fc(e*e+n*n),a=r(s),h=ir(a),m=nr(a);return[rc(e*h,s*m),su(s&&n*h/s)]}}var Kw=Iv(function(r){return fc(2/(1+r))});Kw.invert=Sv(function(r){return 2*su(r/2)});var Ev=Iv(function(r){return(r=mv(r))&&r/ir(r)});Ev.invert=Sv(function(r){return r});function $w(){return Xw(Ev).scale(79.4188).clipAngle(180-.001)}function I_(r,e){return[r,e]}I_.invert=I_;var{BufferOp:Yw,GeoJSONReader:Jw,GeoJSONWriter:Qw}=Sw;function e2(r,e,n){n=n||{};var s=n.units||"kilometers",a=n.steps||8;if(!r)throw new Error("geojson is required");if(typeof n!="object")throw new Error("options must be an object");if(typeof a!="number")throw new Error("steps must be an number");if(e===void 0)throw new Error("radius is required");if(a<=0)throw new Error("steps must be greater than 0");var h=[];switch(r.type){case"GeometryCollection":return id(r,function(m){var l=Lf(m,e,s,a);l&&h.push(l)}),ru(h);case"FeatureCollection":return l_(r,function(m){var l=Lf(m,e,s,a);l&&l_(l,function(x){x&&h.push(x)})}),ru(h)}return Lf(r,e,s,a)}function Lf(r,e,n,s){var a=r.properties||{},h=r.type==="Feature"?r.geometry:r;if(h.type==="GeometryCollection"){var m=[];return id(r,function(ee){var ie=Lf(ee,e,n,s);ie&&m.push(ie)}),ru(m)}var l=t2(h),x={type:h.type,coordinates:Tv(h.coordinates,l)},S=new Jw,T=S.read(x),C=qx(Vx(e,n),"meters"),N=Yw.bufferOp(T,C,s),B=new Qw;if(N=B.write(N),!Av(N.coordinates)){var U={type:N.type,coordinates:Cv(N.coordinates,l)};return zh(U,a)}}function Av(r){return Array.isArray(r[0])?Av(r[0]):isNaN(r[0])}function Tv(r,e){return typeof r[0]!="object"?e(r):r.map(function(n){return Tv(n,e)})}function Cv(r,e){return typeof r[0]!="object"?e.invert(r):r.map(function(n){return Cv(n,e)})}function t2(r){var e=xw(r).geometry.coordinates,n=[-e[0],-e[1]];return $w().rotate(n).scale(Us)}var n2=e2;function i2(r){const e=[];if(id(r,a=>{e.push(a.coordinates)}),e.length<2)throw new Error("Must have at least two features");const n=r.features[0].properties||{},s=fv.difference(e[0],...e.slice(1));return s.length===0?null:s.length===1?qp(s[0],n):cv(s,n)}var r2=i2;function S_(r){let e;for(const n of r)e&&n[0]-e[0]>=180?n[0]-=360:e&&n[0]-e[0]<-180&&(n[0]+=360),e=n}function E_(r,e){const n=r2(ru([qp([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!n)return;n.properties={isMask:"y"};const s=n2(r,0);if(s){if(s.geometry.type==="Polygon")for(const a of s.geometry.coordinates)S_(a);else for(const a of s.geometry.coordinates)for(const h of a)S_(h);e(ru([s,n]))}}const A_=ru([]);function s2(r,e,n=!0,s=!0,a={},h={},m={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}}){let l;const x=[];let S,T,C;function N(){!r.getSource("full-geom")&&(m!=null&&m.fill||m!=null&&m.line)&&r.addSource("full-geom",{type:"geojson",data:A_}),!r.getLayer("full-geom-fill")&&m!=null&&m.fill&&r.addLayer({...m==null?void 0:m.fill,id:"full-geom-fill",type:"fill",source:"full-geom"}),!r.getLayer("full-geom-line")&&m!=null&&m.line&&r.addLayer({...m==null?void 0:m.line,id:"full-geom-line",type:"line",source:"full-geom"}),C&&ee(C)}r.loaded()?N():r.once("load",()=>{N()}),r.on("styledata",()=>{N()});const B=ie=>{l==null||l({type:"mapClick",coordinates:[ie.lngLat.lng,ie.lngLat.lat]})};function U(ie=!1){if(!e)throw new Error;const se=document.createElement("div");return ie&&se.classList.add("marker-interactive"),new Dx({props:{displayIn:"maplibre"},target:se}),new e.Marker({element:se,offset:[1,-13]})}function ee(ie){var se;C=ie,(se=r.getSource("full-geom"))==null||se.setData(ie)}return{setEventHandler(ie){ie?(l=ie,r.on("click",B)):(l=void 0,r.off("click",B))},flyTo(ie,se){r.flyTo({center:ie,zoom:se,...a})},fitBounds(ie,se,Q){r.fitBounds([[ie[0],ie[1]],[ie[2],ie[3]]],{padding:se,maxZoom:Q,...h})},indicateReverse(ie){r.getCanvasContainer().style.cursor=ie?"crosshair":""},setReverseMarker(ie){!e||!n||(T?ie?T.setLngLat(ie):(T.remove(),T=void 0):ie&&(T=(typeof n=="object"?new e.Marker(n):U()).setLngLat(ie).addTo(r),T.getElement().classList.add("marker-reverse")))},setMarkers(ie,se){if(n){for(const Q of x)Q.remove();if(x.length=0,ee(A_),!!e){if(se){let Q=!1;if(se.geometry.type==="GeometryCollection"){const Y=se.geometry.geometries.filter(_e=>_e.type==="Polygon"||_e.type==="MultiPolygon");e:if(Y.length>0){const _e=vw(ru(Y.map(ve=>zh(ve))));if(!_e)break e;E_({...se,geometry:_e.geometry},ee),Q=!0}else{const _e=se.geometry.geometries.filter(ve=>ve.type==="LineString"||ve.type==="MultiLineString");_e.length>0&&(ee({...se,geometry:{type:"GeometryCollection",geometries:_e}}),Q=!0)}}if(!Q){if(se.geometry.type==="Polygon"||se.geometry.type==="MultiPolygon")E_(se,ee);else if(se.geometry.type==="LineString"||se.geometry.type==="MultiLineString"){ee(se);return}}n&&x.push((typeof n=="object"?new e.Marker(n):U()).setLngLat(se.center).addTo(r))}if(s)for(const Q of ie??[]){if(Q===se)continue;const Y=(typeof s=="object"?new e.Marker(s):U(!0)).setLngLat(Q.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(Q.place_type[0]==="reverse"?Q.place_name:Q.place_name.replace(/,.*/,""))).addTo(r),_e=Y.getElement();_e.addEventListener("click",ve=>{ve.stopPropagation(),l==null||l({type:"markerClick",id:Q.id})}),_e.addEventListener("mouseenter",()=>{l==null||l({type:"markerMouseEnter",id:Q.id}),Y.togglePopup()}),_e.addEventListener("mouseleave",()=>{l==null||l({type:"markerMouseLeave",id:Q.id}),Y.togglePopup()}),x.push(Y)}}}},setSelectedMarker(ie){S&&S.getElement().classList.toggle("marker-selected",!1),S=ie>-1?x[ie]:void 0,S==null||S.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const ie=r.getCenter();return[r.getZoom(),ie.lng,ie.lat]}}}function o2(r){let e,n;return{c(){e=Da("svg"),n=Da("path"),Ze(n,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Ze(e,"viewBox","0 0 14 14"),Ze(e,"width","13"),Ze(e,"height","13"),Ze(e,"class","svelte-en2qvf")},m(s,a){ae(s,e,a),Z(e,n)},p:tt,i:tt,o:tt,d(s){s&&oe(e)}}}class Lv extends fn{constructor(e){super(),hn(this,e,null,o2,an,{})}}function a2(r){let e,n;return{c(){e=Da("svg"),n=Da("path"),Ze(n,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Ze(e,"viewBox","0 0 30 30"),Ze(e,"fill","none"),Ze(e,"xmlns","http://www.w3.org/2000/svg"),Ze(e,"class","svelte-d2loi5")},m(s,a){ae(s,e,a),Z(e,n)},p:tt,i:tt,o:tt,d(s){s&&oe(e)}}}class Mv extends fn{constructor(e){super(),hn(this,e,null,a2,an,{})}}function l2(r){let e,n;return{c(){e=le("img"),Yr(e.src,n=r[3]+"area.svg")||Ze(e,"src",n),Ze(e,"alt",r[6]),Ze(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!Yr(e.src,n=s[3]+"area.svg")&&Ze(e,"src",n),a&64&&Ze(e,"alt",s[6])},d(s){s&&oe(e)}}}function u2(r){let e,n;return{c(){e=le("img"),Yr(e.src,n=r[3]+"reverse.svg")||Ze(e,"src",n),Ze(e,"alt",r[6]),Ze(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!Yr(e.src,n=s[3]+"reverse.svg")&&Ze(e,"src",n),a&64&&Ze(e,"alt",s[6])},d(s){s&&oe(e)}}}function c2(r){let e,n;return{c(){e=le("img"),Yr(e.src,n=r[3]+"poi.svg")||Ze(e,"src",n),Ze(e,"alt",r[6]),Ze(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!Yr(e.src,n=s[3]+"poi.svg")&&Ze(e,"src",n),a&64&&Ze(e,"alt",s[6])},d(s){s&&oe(e)}}}function h2(r){let e,n;return{c(){e=le("img"),Yr(e.src,n=r[3]+"postal_code.svg")||Ze(e,"src",n),Ze(e,"alt",r[6]),Ze(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!Yr(e.src,n=s[3]+"postal_code.svg")&&Ze(e,"src",n),a&64&&Ze(e,"alt",s[6])},d(s){s&&oe(e)}}}function f2(r){let e,n;return{c(){e=le("img"),Yr(e.src,n=r[3]+"street.svg")||Ze(e,"src",n),Ze(e,"alt",r[6]),Ze(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!Yr(e.src,n=s[3]+"street.svg")&&Ze(e,"src",n),a&64&&Ze(e,"alt",s[6])},d(s){s&&oe(e)}}}function d2(r){let e,n;return{c(){e=le("img"),Yr(e.src,n=r[3]+"road.svg")||Ze(e,"src",n),Ze(e,"alt",r[6]),Ze(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!Yr(e.src,n=s[3]+"road.svg")&&Ze(e,"src",n),a&64&&Ze(e,"alt",s[6])},d(s){s&&oe(e)}}}function p2(r){let e,n;return{c(){e=le("img"),Yr(e.src,n=r[3]+"housenumber.svg")||Ze(e,"src",n),Ze(e,"alt",r[6]),Ze(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!Yr(e.src,n=s[3]+"housenumber.svg")&&Ze(e,"src",n),a&64&&Ze(e,"alt",s[6])},d(s){s&&oe(e)}}}function m2(r){let e,n,s,a;return{c(){e=le("img"),Yr(e.src,n=r[5])||Ze(e,"src",n),Ze(e,"alt",r[4]),Ze(e,"class","svelte-ltkwvy")},m(h,m){ae(h,e,m),s||(a=Rt(e,"error",r[14]),s=!0)},p(h,m){m&32&&!Yr(e.src,n=h[5])&&Ze(e,"src",n),m&16&&Ze(e,"alt",h[4])},d(h){h&&oe(e),s=!1,a()}}}function T_(r){let e,n;return{c(){e=le("span"),n=ze(r[6]),Ze(e,"class","secondary svelte-ltkwvy")},m(s,a){ae(s,e,a),Z(e,n)},p(s,a){a&64&&Ct(n,s[6])},d(s){s&&oe(e)}}}function g2(r){var ce,xe;let e,n,s,a,h,m,l,x,S=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",T,C,N=r[2]==="always"||r[2]&&!r[0].address&&((ce=r[0].properties)==null?void 0:ce.kind)!=="road"&&((xe=r[0].properties)==null?void 0:xe.kind)!=="road_relation"&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],B,U,ee=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",ie,se,Q;function Y(be,Le){var ke,ye;return Le&1&&(n=null),Le&1&&(s=null),Le&1&&(a=null),be[5]?m2:be[0].address?p2:((ke=be[0].properties)==null?void 0:ke.kind)==="road"||((ye=be[0].properties)==null?void 0:ye.kind)==="road_relation"?d2:(n==null&&(n=!!be[0].id.startsWith("address.")),n?f2:(s==null&&(s=!!be[0].id.startsWith("postal_code.")),s?h2:(a==null&&(a=!!be[0].id.startsWith("poi.")),a?c2:be[7]?u2:l2)))}let _e=Y(r,-1),ve=_e(r),Ae=N&&T_(r);return{c(){e=le("li"),ve.c(),h=Oe(),m=le("span"),l=le("span"),x=le("span"),T=ze(S),C=Oe(),Ae&&Ae.c(),B=Oe(),U=le("span"),ie=ze(ee),Ze(x,"class","primary svelte-ltkwvy"),Ze(l,"class","svelte-ltkwvy"),Ze(U,"class","line2 svelte-ltkwvy"),Ze(m,"class","texts svelte-ltkwvy"),Ze(e,"tabindex","0"),Ze(e,"data-selected",r[1]),Ze(e,"class","svelte-ltkwvy"),Sr(e,"selected",r[1])},m(be,Le){ae(be,e,Le),ve.m(e,null),Z(e,h),Z(e,m),Z(m,l),Z(l,x),Z(x,T),Z(l,C),Ae&&Ae.m(l,null),Z(m,B),Z(m,U),Z(U,ie),se||(Q=[Rt(e,"mouseenter",r[12]),Rt(e,"focus",r[13])],se=!0)},p(be,[Le]){var ke,ye;_e===(_e=Y(be,Le))&&ve?ve.p(be,Le):(ve.d(1),ve=_e(be),ve&&(ve.c(),ve.m(e,h))),Le&1&&S!==(S=(be[7]?be[0].place_name:be[0].place_name.replace(/,.*/,""))+"")&&Ct(T,S),Le&37&&(N=be[2]==="always"||be[2]&&!be[0].address&&((ke=be[0].properties)==null?void 0:ke.kind)!=="road"&&((ye=be[0].properties)==null?void 0:ye.kind)!=="road_relation"&&!be[0].id.startsWith("address.")&&!be[0].id.startsWith("postal_code.")&&(!be[0].id.startsWith("poi.")||!be[5])&&!be[7]),N?Ae?Ae.p(be,Le):(Ae=T_(be),Ae.c(),Ae.m(l,null)):Ae&&(Ae.d(1),Ae=null),Le&1&&ee!==(ee=(be[7]?"":be[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Ct(ie,ee),Le&2&&Ze(e,"data-selected",be[1]),Le&2&&Sr(e,"selected",be[1])},i:tt,o:tt,d(be){be&&oe(e),ve.d(),Ae&&Ae.d(),se=!1,$i(Q)}}}function _2(r,e,n){var Y;let s,a,{feature:h}=e,{selected:m=!1}=e,{showPlaceType:l}=e,{missingIconsCache:x}=e,{iconsBaseUrl:S}=e;const T=(Y=h.properties)==null?void 0:Y.categories;let C,N,B=0,U=h.place_type[0]==="reverse";function ee(){N&&x.add(N),n(10,B++,B)}function ie(_e){ur.call(this,r,_e)}function se(_e){ur.call(this,r,_e)}const Q=()=>ee();return r.$$set=_e=>{"feature"in _e&&n(0,h=_e.feature),"selected"in _e&&n(1,m=_e.selected),"showPlaceType"in _e&&n(2,l=_e.showPlaceType),"missingIconsCache"in _e&&n(9,x=_e.missingIconsCache),"iconsBaseUrl"in _e&&n(3,S=_e.iconsBaseUrl)},r.$$.update=()=>{var _e,ve,Ae,ce;if(r.$$.dirty&3640)do n(11,s--,s),n(4,C=T==null?void 0:T[s]),n(5,N=C?S+C.replace(/ /g,"_")+".svg":void 0);while(s>-1&&(!N||x.has(N)));r.$$.dirty&1&&n(6,a=h.id.startsWith("poi.")?(ve=(_e=h.properties)==null?void 0:_e.categories)==null?void 0:ve.join(", "):((ce=(Ae=h.properties)==null?void 0:Ae.place_type_name)==null?void 0:ce[0])??h.place_type[0])},n(11,s=(T==null?void 0:T.length)??0),[h,m,l,S,C,N,a,U,ee,x,B,s,ie,se,Q]}class y2 extends fn{constructor(e){super(),hn(this,e,_2,g2,an,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function v2(r){let e;return{c(){e=le("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Ze(e,"class","svelte-7cmwmc")},m(n,s){ae(n,e,s)},p:tt,i:tt,o:tt,d(n){n&&oe(e)}}}class b2 extends fn{constructor(e){super(),hn(this,e,null,v2,an,{})}}function x2(r){let e,n;return{c(){e=Da("svg"),n=Da("path"),Ze(n,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Ze(e,"viewBox","0 0 60.006 21.412"),Ze(e,"width","14"),Ze(e,"height","20"),Ze(e,"class","svelte-en2qvf")},m(s,a){ae(s,e,a),Z(e,n)},p:tt,i:tt,o:tt,d(s){s&&oe(e)}}}class w2 extends fn{constructor(e){super(),hn(this,e,null,x2,an,{})}}function k2(r){let e,n,s;return{c(){e=Da("svg"),n=Da("circle"),s=Da("path"),Ze(n,"cx","4.789"),Ze(n,"cy","4.787"),Ze(n,"r","3.85"),Ze(n,"class","svelte-1aq105l"),Ze(s,"d","M12.063 12.063 7.635 7.635"),Ze(s,"class","svelte-1aq105l"),Ze(e,"xmlns","http://www.w3.org/2000/svg"),Ze(e,"width","13"),Ze(e,"height","13"),Ze(e,"viewBox","0 0 13 13"),Ze(e,"class","svelte-1aq105l")},m(a,h){ae(a,e,h),Z(e,n),Z(e,s)},p:tt,i:tt,o:tt,d(a){a&&oe(e)}}}class I2 extends fn{constructor(e){super(),hn(this,e,null,k2,an,{})}}function S2(r,e,n){const s=e[1],a=e[0],h=s-a;return r===s&&n?r:((r-a)%h+h)%h+a}function C_(r){const e=[...r];return e[2]<e[0]&&(e[2]+=360),e}let ch;async function E2(r,e,n){const s=r==null?void 0:r.getCenterAndZoom();for(const a of e??[])if(!(s&&(a.minZoom!=null&&a.minZoom>s[0]||a.maxZoom!=null&&a.maxZoom<s[0]))){if(a.type==="fixed")return a.coordinates.join(",");e:if(a.type==="client-geolocation"){if(ch&&a.cachedLocationExpiry&&ch.time+a.cachedLocationExpiry>Date.now()){if(!ch.coords)break e;return ch.coords}let h;try{return h=await new Promise((m,l)=>{n.signal.addEventListener("abort",()=>{l(Error("aborted"))}),navigator.geolocation.getCurrentPosition(x=>{m([x.coords.longitude,x.coords.latitude].map(S=>S.toFixed(6)).join(","))},x=>{l(x)},a)}),h}catch{}finally{a.cachedLocationExpiry&&(ch={time:Date.now(),coords:h})}if(n.signal.aborted)return}if(a.type==="server-geolocation")return"ip";if(s&&a.type==="map-center")return s[1].toFixed(6)+","+s[2].toFixed(6)}}const A2=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,L_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,M_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,R_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,P_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,D_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function T2(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(B=>Number(B.trim())),n=Number(e[0]),s=Number(e[1]),a=Math.abs(n),h=Math.abs(s),m=n>0?"N":"S",l=s>0?"E":"W";let x;r=="DD"&&(x=`${a}° ${m}, ${h}° ${l}`);const S=Math.floor(a),T=Math.floor(h),C=(a-S)*60,N=(h-T)*60;if(r=="DM"){let B=N_(C,3).toFixed(3).padStart(6,"0"),U=N_(N,3).toFixed(3).padStart(6,"0");B.endsWith(".000")&&U.endsWith(".000")&&(B=B.replace(/\.000$/,""),U=U.replace(/\.000$/,"")),x=`${S}° ${B}' ${m}, ${T}° ${U}' ${l}`}if(r=="DMS"){const B=Math.floor(C),U=Math.floor(N);let ee=((C-B)*60).toFixed(1).padStart(4,"0"),ie=((N-U)*60).toFixed(1).padStart(4,"0");const se=B.toString().padStart(2,"0"),Q=U.toString().padStart(2,"0");ee.endsWith(".0")&&ie.endsWith(".0")&&(ee=ee.replace(/\.0$/,""),ie=ie.replace(/\.0$/,"")),x=`${S}° ${se}' ${ee}" ${m}, ${T}° ${Q}' ${ie}" ${l}`}return x}else throw new Error("no decimal coordinates to convert")}function N_(r,e){const n=Math.pow(10,e);return Math.round((r+Number.EPSILON)*n)/n}function Gp(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let n=null,s=null,a="",h="",m=null,l=[],x=!1;if(A2.test(r))throw new Error("invalid coordinate value");if(L_.test(r))if(l=L_.exec(r),x=hh(l),x)n=Math.abs(l[1])+l[2]/60,Number(l[1])<0&&(n*=-1),s=Math.abs(l[3])+l[4]/60,Number(l[3])<0&&(s*=-1),m="DM";else throw new Error("invalid coordinate format");else if(M_.test(r))if(l=M_.exec(r),x=hh(l),x){if(n=l[2],s=l[6],n.includes(",")&&(n=n.replace(",",".")),s.includes(",")&&(s=s.replace(",",".")),m="DD",Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");if(Number(Math.round(s))==Number(s))throw new Error("integer only coordinate provided");l[1]?(a=l[1],h=l[5]):l[4]&&(a=l[4],h=l[8])}else throw new Error("invalid decimal coordinate format");else if(R_.test(r))if(l=R_.exec(r),x=hh(l),x)n=Math.abs(parseInt(l[2])),l[4]&&(n+=l[4]/60,m="DM"),l[6]&&(n+=l[6].replace(",",".")/3600,m="DMS"),parseInt(l[2])<0&&(n=-1*n),s=Math.abs(parseInt(l[9])),l[11]&&(s+=l[11]/60),l[13]&&(s+=l[13].replace(",",".")/3600),parseInt(l[9])<0&&(s=-1*s),l[1]?(a=l[1],h=l[8]):l[7]&&(a=l[7],h=l[14]);else throw new Error("invalid DMS coordinates format");else if(P_.test(r))if(l=P_.exec(r),x=hh(l),x)n=Math.abs(parseInt(l[2])),l[4]&&(n+=l[4]/60,m="DM"),l[6]&&(n+=l[6]/3600,m="DMS"),parseInt(l[2])<0&&(n=-1*n),s=Math.abs(parseInt(l[10])),l[12]&&(s+=l[12]/60),l[14]&&(s+=l[14]/3600),parseInt(l[10])<0&&(s=-1*s),l[1]?(a=l[1],h=l[9]):l[8]&&(a=l[8],h=l[16]);else throw new Error("invalid DMS coordinates format");else if(D_.test(r)){if(l=D_.exec(r),x=hh(l),l.filter(S=>S).length<=5)throw new Error("invalid coordinates format");if(x)n=Math.abs(parseInt(l[2])),l[4]&&(n+=l[4].replace(",",".")/60,m="DM"),l[6]&&(n+=l[6].replace(",",".")/3600,m="DMS"),parseInt(l[2])<0&&(n=-1*n),s=Math.abs(parseInt(l[10])),l[12]&&(s+=l[12].replace(",",".")/60),l[14]&&(s+=l[14].replace(",",".")/3600),parseInt(l[10])<0&&(s=-1*s),l[1]?(a=l[1],h=l[9]):l[8]&&(a=l[8],h=l[16]);else throw new Error("invalid coordinates format")}if(x){if(Math.abs(s)>=180)throw new Error("invalid longitude value");if(Math.abs(n)>=90)throw new Error("invalid latitude value");if(a&&!h||!a&&h)throw new Error("invalid coordinates value");if(a&&a==h)throw new Error("invalid coordinates format");n.toString().includes(",")&&(n=n.replace(",",".")),s.toString().includes(",")&&(s=s.replace(",","."));let S=/S|SOUTH/i;S.test(a)&&n>0&&(n=-1*n),S=/W|WEST/i,S.test(h)&&s>0&&(s=-1*s);const T=l[0].trim();let C,N;const B=/[,/;\u0020]/g,U=T.match(B);if(U==null){const se=Math.floor(r.length/2);C=T.substring(0,se).trim(),N=T.substring(se).trim()}else{let se;U.length%2==1?se=Math.floor(U.length/2):se=U.length/2-1;let Q=0;if(se==0)Q=T.indexOf(U[0]),C=T.substring(0,Q).trim(),N=T.substring(Q+1).trim();else{let Y=0,_e=0;for(;Y<=se;)Q=T.indexOf(U[Y],_e),_e=Q+1,Y++;C=T.substring(0,Q).trim(),N=T.substring(Q+1).trim()}}const ee=C.split(".");if(ee.length==2&&ee[1]==0&&ee[1].length!=2)throw new Error("invalid coordinates format");const ie=N.split(".");if(ie.length==2&&ie[1]==0&&ie[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(C)||/^\d+$/.test(N))throw new Error("degree only coordinate/s provided");return n=Number(Number(n).toFixed(e)),s=Number(Number(s).toFixed(e)),Object.freeze({verbatimCoordinates:T,verbatimLatitude:C,verbatimLongitude:N,decimalLatitude:n,decimalLongitude:s,decimalCoordinates:`${n},${s}`,originalFormat:m,closeEnough:C2,toCoordinateFormat:T2})}else throw new Error("coordinates pattern match failed")}function hh(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const n=/^[-+]?\d+([\.,]\d+)?$/,s=/[eastsouthnorthwest]+/i,a=e.length/2;for(let h=0;h<a;h++){const m=e[h],l=e[h+a],x=n.test(m)&&n.test(l),S=s.test(m)&&s.test(l),T=m==l;if(!(m==null&&l==null)){if(m==null||l==null)return!1;if(x||S||T)continue;return!1}}return!0}function z_(r,e){const n=Math.abs(r-e);return Number(n.toFixed(6))<=1e-5}function C2(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return z_(this.decimalLatitude,Number(e[0]))&&z_(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const L2=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Gp.to=L2;const M2=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],R2={decimalLatitude:40.123,decimalLongitude:-74.123},P2=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],D2=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function N2(){const r=[];return M2.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...R2})}),[...r,...P2,...D2]}const z2=N2();Gp.formats=z2.map(r=>r.verbatimCoordinates);const F2=Gp;function F_(r,e,n){const s=r.slice();return s[81]=e[n],s[83]=n,s}function O_(r){let e,n;return e=new b2({}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function B_(r){let e,n,s,a,h;return n=new w2({}),{c(){e=le("button"),ot(n.$$.fragment),Ze(e,"type","button"),Ze(e,"title",r[9]),Ze(e,"class","svelte-zh3kmv"),Sr(e,"active",r[0])},m(m,l){ae(m,e,l),it(n,e,null),s=!0,a||(h=Rt(e,"click",r[67]),a=!0)},p(m,l){(!s||l[0]&512)&&Ze(e,"title",m[9]),(!s||l[0]&1)&&Sr(e,"active",m[0])},i(m){s||(ge(n.$$.fragment,m),s=!0)},o(m){Se(n.$$.fragment,m),s=!1},d(m){m&&oe(e),rt(n),a=!1,h()}}}function O2(r){let e,n=[],s=new Map,a,h,m,l=Vn(r[14]);const x=S=>S[81].id+(S[81].address?","+S[81].address:"");for(let S=0;S<l.length;S+=1){let T=F_(r,l,S),C=x(T);s.set(C,n[S]=U_(C,T))}return{c(){e=le("ul");for(let S=0;S<n.length;S+=1)n[S].c();Ze(e,"class","svelte-zh3kmv")},m(S,T){ae(S,e,T);for(let C=0;C<n.length;C+=1)n[C]&&n[C].m(e,null);a=!0,h||(m=[Rt(e,"mouseleave",r[71]),Rt(e,"blur",r[72])],h=!0)},p(S,T){T[0]&17880064&&(l=Vn(S[14]),zn(),n=ax(n,T,x,1,S,l,s,e,ox,U_,null,F_),Fn())},i(S){if(!a){for(let T=0;T<l.length;T+=1)ge(n[T]);a=!0}},o(S){for(let T=0;T<n.length;T+=1)Se(n[T]);a=!1},d(S){S&&oe(e);for(let T=0;T<n.length;T+=1)n[T].d();h=!1,$i(m)}}}function B2(r){let e,n,s,a,h,m;return n=new Mv({}),{c(){e=le("div"),ot(n.$$.fragment),s=Oe(),a=le("div"),h=ze(r[7]),Ze(a,"class","svelte-zh3kmv"),Ze(e,"class","no-results svelte-zh3kmv")},m(l,x){ae(l,e,x),it(n,e,null),Z(e,s),Z(e,a),Z(a,h),m=!0},p(l,x){(!m||x[0]&128)&&Ct(h,l[7])},i(l){m||(ge(n.$$.fragment,l),m=!0)},o(l){Se(n.$$.fragment,l),m=!1},d(l){l&&oe(e),rt(n)}}}function U2(r){let e="",n;return{c(){n=ze(e)},m(s,a){ae(s,n,a)},p:tt,i:tt,o:tt,d(s){s&&oe(n)}}}function j2(r){let e,n,s,a,h,m,l,x,S,T,C;return n=new Mv({}),x=new Lv({}),{c(){e=le("div"),ot(n.$$.fragment),s=Oe(),a=le("div"),h=ze(r[6]),m=Oe(),l=le("button"),ot(x.$$.fragment),Ze(a,"class","svelte-zh3kmv"),Ze(l,"class","svelte-zh3kmv"),Ze(e,"class","error svelte-zh3kmv")},m(N,B){ae(N,e,B),it(n,e,null),Z(e,s),Z(e,a),Z(a,h),Z(e,m),Z(e,l),it(x,l,null),S=!0,T||(C=Rt(l,"click",r[68]),T=!0)},p(N,B){(!S||B[0]&64)&&Ct(h,N[6])},i(N){S||(ge(n.$$.fragment,N),ge(x.$$.fragment,N),S=!0)},o(N){Se(n.$$.fragment,N),Se(x.$$.fragment,N),S=!1},d(N){N&&oe(e),rt(n),rt(x),T=!1,C()}}}function U_(r,e){let n,s,a;function h(){return e[69](e[83])}function m(){return e[70](e[81])}return s=new y2({props:{feature:e[81],showPlaceType:e[10],selected:e[15]===e[83],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),s.$on("mouseenter",h),s.$on("focus",m),{key:r,first:null,c(){n=ii(),ot(s.$$.fragment),this.first=n},m(l,x){ae(l,n,x),it(s,l,x),a=!0},p(l,x){e=l;const S={};x[0]&16384&&(S.feature=e[81]),x[0]&1024&&(S.showPlaceType=e[10]),x[0]&49152&&(S.selected=e[15]===e[83]),x[0]&4096&&(S.iconsBaseUrl=e[12]),s.$set(S)},i(l){a||(ge(s.$$.fragment,l),a=!0)},o(l){Se(s.$$.fragment,l),a=!1},d(l){l&&oe(n),rt(s,l)}}}function q2(r){let e,n,s,a,h,m,l,x,S,T,C,N,B,U,ee,ie,se,Q,Y,_e,ve,Ae=!1;h=new I2({}),C=new Lv({});let ce=r[19]&&O_(),xe=r[5]===!0&&B_(r);const be=r[59].default,Le=Zi(be,r,r[58],null),ke=[j2,U2,B2,O2],ye=[];function Ue(qe,pt){var St,dt;return qe[18]?0:qe[16]?((St=qe[14])==null?void 0:St.length)===0?2:qe[16]&&((dt=qe[14])!=null&&dt.length)?3:-1:1}return~(ie=Ue(r))&&(se=ye[ie]=ke[ie](r)),{c(){e=Oe(),n=le("form"),s=le("div"),a=le("button"),ot(h.$$.fragment),m=Oe(),l=le("input"),x=Oe(),S=le("div"),T=le("button"),ot(C.$$.fragment),N=Oe(),ce&&ce.c(),B=Oe(),xe&&xe.c(),U=Oe(),Le&&Le.c(),ee=Oe(),se&&se.c(),Ze(a,"class","search-button svelte-zh3kmv"),Ze(a,"type","button"),Ze(l,"placeholder",r[8]),Ze(l,"aria-label",r[8]),Ze(l,"class","svelte-zh3kmv"),Ze(T,"type","button"),Ze(T,"title",r[3]),Ze(T,"class","svelte-zh3kmv"),Ze(S,"class","clear-button-container svelte-zh3kmv"),Sr(S,"displayable",r[1]!==""),Ze(s,"class","input-group svelte-zh3kmv"),Ze(n,"tabindex","0"),Ze(n,"class",Q=Nf(r[2])+" svelte-zh3kmv"),Sr(n,"can-collapse",r[4]&&r[1]==="")},m(qe,pt){ae(qe,e,pt),ae(qe,n,pt),Z(n,s),Z(s,a),it(h,a,null),Z(s,m),Z(s,l),r[61](l),ki(l,r[1]),Z(s,x),Z(s,S),Z(S,T),it(C,T,null),Z(S,N),ce&&ce.m(S,null),Z(s,B),xe&&xe.m(s,null),Z(s,U),Le&&Le.m(s,null),Z(n,ee),~ie&&ye[ie].m(n,null),Y=!0,_e||(ve=[Rt(a,"click",r[60]),Rt(l,"input",r[62]),Rt(l,"focus",r[63]),Rt(l,"blur",r[64]),Rt(l,"keydown",r[22]),Rt(l,"input",r[65]),Rt(T,"click",r[66]),Rt(n,"submit",Nh(r[21]))],_e=!0)},p(qe,pt){(!Y||pt[0]&256)&&Ze(l,"placeholder",qe[8]),(!Y||pt[0]&256)&&Ze(l,"aria-label",qe[8]),pt[0]&2&&l.value!==qe[1]&&ki(l,qe[1]),(!Y||pt[0]&8)&&Ze(T,"title",qe[3]),qe[19]?ce?pt[0]&524288&&ge(ce,1):(ce=O_(),ce.c(),ge(ce,1),ce.m(S,null)):ce&&(zn(),Se(ce,1,1,()=>{ce=null}),Fn()),(!Y||pt[0]&2)&&Sr(S,"displayable",qe[1]!==""),qe[5]===!0?xe?(xe.p(qe,pt),pt[0]&32&&ge(xe,1)):(xe=B_(qe),xe.c(),ge(xe,1),xe.m(s,U)):xe&&(zn(),Se(xe,1,1,()=>{xe=null}),Fn()),Le&&Le.p&&(!Y||pt[1]&134217728)&&Xi(Le,be,qe,qe[58],Y?Hi(be,qe[58],pt,null):Wi(qe[58]),null);let St=ie;ie=Ue(qe),ie===St?~ie&&ye[ie].p(qe,pt):(se&&(zn(),Se(ye[St],1,1,()=>{ye[St]=null}),Fn()),~ie?(se=ye[ie],se?se.p(qe,pt):(se=ye[ie]=ke[ie](qe),se.c()),ge(se,1),se.m(n,null)):se=null),(!Y||pt[0]&4&&Q!==(Q=Nf(qe[2])+" svelte-zh3kmv"))&&Ze(n,"class",Q),(!Y||pt[0]&22)&&Sr(n,"can-collapse",qe[4]&&qe[1]==="")},i(qe){Y||(ge(Ae),ge(h.$$.fragment,qe),ge(C.$$.fragment,qe),ge(ce),ge(xe),ge(Le,qe),ge(se),Y=!0)},o(qe){Se(Ae),Se(h.$$.fragment,qe),Se(C.$$.fragment,qe),Se(ce),Se(xe),Se(Le,qe),Se(se),Y=!1},d(qe){qe&&(oe(e),oe(n)),rt(h),r[61](null),rt(C),ce&&ce.d(),xe&&xe.d(),Le&&Le.d(qe),~ie&&ye[ie].d(),_e=!1,$i(ve)}}}function V2(r,e,n){let s,{$$slots:a={},$$scope:h}=e,{class:m=void 0}=e,{apiKey:l}=e,{bbox:x=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:T=!1}=e,{collapsed:C=!1}=e,{country:N=void 0}=e,{debounceSearch:B=200}=e,{enableReverse:U=!1}=e,{errorMessage:ee="Something went wrong…"}=e,{filter:ie=()=>!0}=e,{flyTo:se=!0}=e,{fuzzyMatch:Q=!0}=e,{language:Y=void 0}=e,{limit:_e=void 0}=e,{mapController:ve=void 0}=e,{minLength:Ae=2}=e,{noResultsMessage:ce="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:xe="Search"}=e,{proximity:be=[{type:"server-geolocation"}]}=e,{reverseActive:Le=U==="always"}=e,{reverseButtonTitle:ke="toggle reverse geocoding"}=e,{searchValue:ye=""}=e,{showFullGeometry:Ue=!0}=e,{showPlaceType:qe="ifNeeded"}=e,{showResultsWhileTyping:pt=!0}=e,{selectFirst:St=!0}=e,{flyToSelected:dt=!1}=e,{markerOnSelected:ut=!0}=e,{types:Ut=void 0}=e,{excludeTypes:vt=!1}=e,{zoom:kt=16}=e,{maxZoom:ft=18}=e,{apiUrl:wt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:It={}}=e,{iconsBaseUrl:$t="https://cdn.maptiler.com/maptiler-geocoding-control/v1.3.3/icons/"}=e,{adjustUrlQuery:pn=()=>{}}=e;function Pn(){On.focus()}function We(){On.blur()}function Wn(fe,je=!0,Xe=!1){n(1,ye=fe),je?(n(15,bt=-1),Jr()):(Mt(!Xe,Xe),setTimeout(()=>{On.focus(),On.select()}))}function dn(){n(14,lt=void 0),n(55,Lt=void 0),n(15,bt=-1)}function Ot(){n(54,Ye=[]),n(55,Lt=void 0)}let Ee=!1,lt,Ye,Lt,Ke="",On,bt=-1,Ie,Bt=[],Mn,Nn,Qn,Jt;const Ri=new Set,Yi=hc();vo(()=>{ve&&(ve.setEventHandler(void 0),ve.indicateReverse(!1),ve.setSelectedMarker(-1),ve.setMarkers(void 0,void 0))});function Jr(fe){if(Nn&&(clearTimeout(Nn),Nn=void 0),bt>-1&&lt)n(55,Lt=lt[bt]),n(1,ye=Lt.place_type[0]==="reverse"?Lt.place_name:Lt.place_name.replace(/,.*/,"")),n(18,Ie=void 0),n(54,Ye=void 0),n(15,bt=-1);else if(ye){const je=fe||!ct(ye);yr(ye,{exact:!0}).then(()=>{n(54,Ye=lt),n(55,Lt=void 0),je&&xn()}).catch(Xe=>n(18,Ie=Xe))}}function ct(fe){try{return F2(fe,6)}catch{return!1}}async function yr(fe,{byId:je=!1,exact:Xe=!1}={}){n(18,Ie=void 0),Mn==null||Mn.abort();const Pe=new AbortController;n(19,Mn=Pe);try{const et=ct(fe),gt=new URLSearchParams;if(Y!==void 0&&gt.set("language",Array.isArray(Y)?Y.join(","):Y??""),Ut&&gt.set("types",Ut.join(",")),vt&&gt.set("excludeTypes",String(vt)),x&&gt.set("bbox",x.map(ln=>ln.toFixed(6)).join(",")),N&&gt.set("country",Array.isArray(N)?N.join(","):N),!je&&!et){const ln=await E2(ve,be,Pe);ln&&gt.set("proximity",ln),(Xe||!pt)&&gt.set("autocomplete","false"),gt.set("fuzzyMatch",String(Q))}_e!==void 0&&(!et||(Ut==null?void 0:Ut.length)===1)&&gt.set("limit",String(_e)),gt.set("key",l),pn(gt);const at=wt+"/"+encodeURIComponent(et?et.decimalLongitude+","+et.decimalLatitude:fe)+".json?"+gt.toString();if(at===Ke){je?(n(14,lt=void 0),n(55,Lt=Bt[0])):n(14,lt=Bt);return}Ke=at;const Dt=await fetch(at,{signal:Pe.signal,...It});if(!Dt.ok)throw new Error(await Dt.text());const en=await Dt.json();Yi("response",{url:at,featureCollection:en}),je?(n(14,lt=void 0),n(55,Lt=en.features[0]),Bt=[Lt]):(n(14,lt=en.features.filter(ie)),et&&lt.unshift({type:"Feature",properties:{},id:"reverse_"+et.decimalLongitude+"_"+et.decimalLatitude,text:et.decimalLatitude+", "+et.decimalLongitude,place_name:et.decimalLatitude+", "+et.decimalLongitude,place_type:["reverse"],center:[et.decimalLongitude,et.decimalLatitude],bbox:[et.decimalLongitude,et.decimalLatitude,et.decimalLongitude,et.decimalLatitude],geometry:{type:"Point",coordinates:[et.decimalLongitude,et.decimalLatitude]}}),Bt=lt,et&&On.focus())}catch(et){if(et&&typeof et=="object"&&"name"in et&&et.name==="AbortError")return;throw et}finally{Pe===Mn&&n(19,Mn=void 0)}}function xn(){var Xe;if(!(Ye!=null&&Ye.length)||!se)return;const fe=[180,90,-180,-90],je=!Ye.some(Pe=>!Pe.matching_text);for(const Pe of Ye)if(je||!Pe.matching_text)for(const et of[0,1,2,3])fe[et]=Math[et<2?"min":"max"](fe[et],((Xe=Pe.bbox)==null?void 0:Xe[et])??Pe.center[et%2]);ve&&Ye.length>0&&(Lt&&fe[0]===fe[2]&&fe[1]===fe[3]?ve.flyTo(Lt.center,kt):ve.fitBounds(C_(fe),50,ft))}function mn(fe){n(0,Le=U==="always"),n(14,lt=void 0),n(55,Lt=void 0),n(15,bt=-1),Wn(fe[1].toFixed(6)+", "+S2(fe[0],[-180,180],!0).toFixed(6),!1,!0)}function Ms(fe){if(!lt)return;let je=fe.key==="ArrowDown"?1:fe.key==="ArrowUp"?-1:0;je&&(bt===(St?0:-1)&&je===-1&&n(15,bt=lt.length),n(15,bt+=je),bt>=lt.length&&n(15,bt=-1),bt<0&&St&&n(15,bt=0),fe.preventDefault())}function Mt(fe=!0,je=!1){if(n(18,Ie=void 0),pt||je){if(Nn&&clearTimeout(Nn),ye.length<Ae)return;const Xe=ye;Nn=window.setTimeout(()=>{yr(Xe).catch(Pe=>n(18,Ie=Pe))},fe?B:0)}else n(14,lt=void 0),n(18,Ie=void 0)}function An(fe){n(55,Lt=fe),n(1,ye=fe.place_name),n(15,bt=-1)}const At=()=>On.focus();function vr(fe){$n[fe?"unshift":"push"](()=>{On=fe,n(17,On)})}function Gr(){ye=this.value,n(1,ye),n(13,Ee),n(27,T)}const bn=()=>n(13,Ee=!0),Pi=()=>n(13,Ee=!1),Ar=()=>Mt(),Ji=()=>{n(1,ye=""),On.focus()},Zr=()=>n(0,Le=!Le),Re=()=>n(18,Ie=void 0),J=fe=>n(15,bt=fe),$=fe=>An(fe),he=()=>{St||n(15,bt=-1)},ue=()=>{};return r.$$set=fe=>{"class"in fe&&n(2,m=fe.class),"apiKey"in fe&&n(25,l=fe.apiKey),"bbox"in fe&&n(26,x=fe.bbox),"clearButtonTitle"in fe&&n(3,S=fe.clearButtonTitle),"clearOnBlur"in fe&&n(27,T=fe.clearOnBlur),"collapsed"in fe&&n(4,C=fe.collapsed),"country"in fe&&n(28,N=fe.country),"debounceSearch"in fe&&n(29,B=fe.debounceSearch),"enableReverse"in fe&&n(5,U=fe.enableReverse),"errorMessage"in fe&&n(6,ee=fe.errorMessage),"filter"in fe&&n(30,ie=fe.filter),"flyTo"in fe&&n(31,se=fe.flyTo),"fuzzyMatch"in fe&&n(32,Q=fe.fuzzyMatch),"language"in fe&&n(33,Y=fe.language),"limit"in fe&&n(34,_e=fe.limit),"mapController"in fe&&n(35,ve=fe.mapController),"minLength"in fe&&n(36,Ae=fe.minLength),"noResultsMessage"in fe&&n(7,ce=fe.noResultsMessage),"placeholder"in fe&&n(8,xe=fe.placeholder),"proximity"in fe&&n(37,be=fe.proximity),"reverseActive"in fe&&n(0,Le=fe.reverseActive),"reverseButtonTitle"in fe&&n(9,ke=fe.reverseButtonTitle),"searchValue"in fe&&n(1,ye=fe.searchValue),"showFullGeometry"in fe&&n(38,Ue=fe.showFullGeometry),"showPlaceType"in fe&&n(10,qe=fe.showPlaceType),"showResultsWhileTyping"in fe&&n(39,pt=fe.showResultsWhileTyping),"selectFirst"in fe&&n(11,St=fe.selectFirst),"flyToSelected"in fe&&n(40,dt=fe.flyToSelected),"markerOnSelected"in fe&&n(41,ut=fe.markerOnSelected),"types"in fe&&n(42,Ut=fe.types),"excludeTypes"in fe&&n(43,vt=fe.excludeTypes),"zoom"in fe&&n(44,kt=fe.zoom),"maxZoom"in fe&&n(45,ft=fe.maxZoom),"apiUrl"in fe&&n(46,wt=fe.apiUrl),"fetchParameters"in fe&&n(47,It=fe.fetchParameters),"iconsBaseUrl"in fe&&n(12,$t=fe.iconsBaseUrl),"adjustUrlQuery"in fe&&n(48,pn=fe.adjustUrlQuery),"$$scope"in fe&&n(58,h=fe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&n(0,Le=U==="always"),r.$$.dirty[0]&134225920&&setTimeout(()=>{n(16,Qn=Ee),T&&!Ee&&n(1,ye="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&32&&ye.length<Ae&&(n(55,Lt=void 0),n(14,lt=void 0),n(18,Ie=void 0),n(54,Ye=lt)),r.$$.dirty[1]&16777344&&Ue&&Lt&&!Lt.address&&Lt.geometry.type==="Point"&&Lt.place_type[0]!=="reverse"&&yr(Lt.id,{byId:!0}).catch(fe=>n(18,Ie=fe)),r.$$.dirty[1]&50356241&&(ve&&Lt&&Lt.id!==Jt&&se&&(!Lt.bbox||Lt.bbox[0]===Lt.bbox[2]&&Lt.bbox[1]===Lt.bbox[3]?ve.flyTo(Lt.center,Lt.id.startsWith("poi.")||Lt.id.startsWith("address.")?ft:kt):ve.fitBounds(C_(Lt.bbox),50,ft),n(14,lt=void 0),n(54,Ye=void 0),n(15,bt=-1)),n(56,Jt=Lt==null?void 0:Lt.id)),r.$$.dirty[0]&18432&&St&&lt!=null&&lt.length&&n(15,bt=0),r.$$.dirty[0]&2050&&(St||n(15,bt=-1)),r.$$.dirty[0]&16384|r.$$.dirty[1]&8388608&&Ye!==lt&&n(54,Ye=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&8388624&&ve&&ve.setEventHandler(fe=>{switch(fe.type){case"mapClick":Le&&mn(fe.coordinates);break;case"markerClick":{const je=lt==null?void 0:lt.find(Xe=>Xe.id===fe.id);je&&An(je)}break;case"markerMouseEnter":Ye&&n(15,bt=Qn?(lt==null?void 0:lt.findIndex(je=>je.id===fe.id))??-1:-1);break;case"markerMouseLeave":Ye&&n(15,bt=-1);break}}),r.$$.dirty[0]&49152&&n(57,s=lt==null?void 0:lt[bt]),r.$$.dirty[1]&67133969&&ve&&s&&se&&dt&&ve.flyTo(s.center,s.id.startsWith("poi.")||s.id.startsWith("address.")?ft:kt),r.$$.dirty[1]&1040&&(ut||ve==null||ve.setMarkers(void 0,void 0)),r.$$.dirty[1]&75498512&&ve&&ut&&!Ye&&(ve.setMarkers(s?[s]:void 0,void 0),ve.setSelectedMarker(s?0:-1)),r.$$.dirty[1]&25165840&&ve&&ve.setMarkers(Ye,Lt),r.$$.dirty[0]&32768|r.$$.dirty[1]&8388624&&Ye&&ve&&ve.setSelectedMarker(bt),r.$$.dirty[0]&2|r.$$.dirty[1]&16&&ve){const fe=ct(ye);ve.setReverseMarker(fe?[fe.decimalLongitude,fe.decimalLatitude]:void 0)}r.$$.dirty[1]&67108864&&Yi("select",s),r.$$.dirty[1]&16777216&&Yi("pick",Lt),r.$$.dirty[0]&81920&&Yi("optionsVisibilityChange",Qn&&!!lt),r.$$.dirty[0]&16384&&Yi("featuresListed",lt),r.$$.dirty[1]&8388608&&Yi("featuresMarked",Ye),r.$$.dirty[0]&1&&Yi("reverseToggle",Le),r.$$.dirty[0]&2&&Yi("queryChange",ye),r.$$.dirty[0]&1|r.$$.dirty[1]&16&&ve&&ve.indicateReverse(Le)},[Le,ye,m,S,C,U,ee,ce,xe,ke,qe,St,$t,Ee,lt,bt,Qn,On,Ie,Mn,Ri,Jr,Ms,Mt,An,l,x,T,N,B,ie,se,Q,Y,_e,ve,Ae,be,Ue,pt,dt,ut,Ut,vt,kt,ft,wt,It,pn,Pn,We,Wn,dn,Ot,Ye,Lt,Jt,s,h,a,At,vr,Gr,bn,Pi,Ar,Ji,Zr,Re,J,$,he,ue]}class G2 extends fn{constructor(e){super(),hn(this,e,V2,q2,an,{class:2,apiKey:25,bbox:26,clearButtonTitle:3,clearOnBlur:27,collapsed:4,country:28,debounceSearch:29,enableReverse:5,errorMessage:6,filter:30,flyTo:31,fuzzyMatch:32,language:33,limit:34,mapController:35,minLength:36,noResultsMessage:7,placeholder:8,proximity:37,reverseActive:0,reverseButtonTitle:9,searchValue:1,showFullGeometry:38,showPlaceType:10,showResultsWhileTyping:39,selectFirst:11,flyToSelected:40,markerOnSelected:41,types:42,excludeTypes:43,zoom:44,maxZoom:45,apiUrl:46,fetchParameters:47,iconsBaseUrl:12,adjustUrlQuery:48,focus:49,blur:50,setQuery:51,clearList:52,clearMap:53},null,[-1,-1,-1])}get focus(){return this.$$.ctx[49]}get blur(){return this.$$.ctx[50]}get setQuery(){return this.$$.ctx[51]}get clearList(){return this.$$.ctx[52]}get clearMap(){return this.$$.ctx[53]}}function j_(r){let e,n,s;return n=new G2({props:{mapController:r[1],apiKey:r[0]}}),{c(){e=le("div"),ot(n.$$.fragment),Ze(e,"class","svelte-ixhnie")},m(a,h){ae(a,e,h),it(n,e,null),s=!0},p(a,h){const m={};h&2&&(m.mapController=a[1]),h&1&&(m.apiKey=a[0]),n.$set(m)},i(a){s||(ge(n.$$.fragment,a),s=!0)},o(a){Se(n.$$.fragment,a),s=!1},d(a){a&&oe(e),rt(n)}}}function Z2(r){let e,n,s=r[1]&&j_(r);return{c(){s&&s.c(),e=ii()},m(a,h){s&&s.m(a,h),ae(a,e,h),n=!0},p(a,[h]){a[1]?s?(s.p(a,h),h&2&&ge(s,1)):(s=j_(a),s.c(),ge(s,1),s.m(e.parentNode,e)):s&&(zn(),Se(s,1,1,()=>{s=null}),Fn())},i(a){n||(ge(s),n=!0)},o(a){Se(s),n=!1},d(a){a&&oe(e),s&&s.d(a)}}}function H2(r,e,n){let s,{apiKey:a}=e,{map:h}=e;return r.$$set=m=>{"apiKey"in m&&n(0,a=m.apiKey),"map"in m&&n(2,h=m.map)},r.$$.update=()=>{r.$$.dirty&4&&n(1,s=h?s2(h,Cs):null)},[a,s,h]}class X2 extends fn{constructor(e){super(),hn(this,e,H2,Z2,an,{apiKey:0,map:2})}}const Zu=[];function lp(r,e){return{subscribe:Jn(r,e).subscribe}}function Jn(r,e=tt){let n;const s=new Set;function a(l){if(an(r,l)&&(r=l,n)){const x=!Zu.length;for(const S of s)S[1](),Zu.push(S,r);if(x){for(let S=0;S<Zu.length;S+=2)Zu[S][0](Zu[S+1]);Zu.length=0}}}function h(l){a(l(r))}function m(l,x=tt){const S=[l,x];return s.add(S),s.size===1&&(n=e(a,h)||tt),l(r),()=>{s.delete(S),s.size===0&&n&&(n(),n=null)}}return{set:a,update:h,subscribe:m}}const W2=Symbol.for("svelte-maplibre");function K2(){return ev(W2)}function $2(r){return"layerType"in r&&r.layerType==="deckgl"}var Rh=Y2;function Y2(r){var e,n,s;if(r){if(Array.isArray(r)){for(e=[],n=r.length,s=0;s<n;s++){var a=r[s];a!=null&&e.push(a)}return e}if(typeof r=="object"){e={};var h=Object.keys(r);for(n=h.length,s=0;s<n;s++){var m=h[s],l=r[m];l!=null&&(e[m]=l)}return e}}}var Hu=Zp;function Zp(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?q_(r,e):{}.toString.call(r)=="[object Set]"?q_(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?Q2(r,e):J2(r,e)}function J2(r,e){return r.toString()===e.toString()}function q_(r,e){var n=r.length;if(n!=e.length)return!1;for(var s=0;s<n;s++)if(!Zp(r[s],e[s]))return!1;return!0}function Q2(r,e){var n=Object.keys(r),s=n.length;if(s!=Object.keys(e).length)return!1;for(var a=0;a<s;a++){var h=n[a];if(!(e.hasOwnProperty(h)&&Zp(r[h],e[h])))return!1}return!0}const ek=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),V_=r=>{var e;return{features:r[4],data:(e=r[4])==null?void 0:e[0],map:r[2],close:r[31]}};function G_(r){let e,n,s=(r[4]||r[3]instanceof Cs.Marker)&&Z_(r);return{c(){e=le("div"),s&&s.c()},m(a,h){ae(a,e,h),s&&s.m(e,null),r[32](e),n=!0},p(a,h){a[4]||a[3]instanceof Cs.Marker?s?(s.p(a,h),h[0]&24&&ge(s,1)):(s=Z_(a),s.c(),ge(s,1),s.m(e,null)):s&&(zn(),Se(s,1,1,()=>{s=null}),Fn())},i(a){n||(ge(s),n=!0)},o(a){Se(s),n=!1},d(a){a&&oe(e),s&&s.d(),r[32](null)}}}function Z_(r){let e;const n=r[30].default,s=Zi(n,r,r[29],V_);return{c(){s&&s.c()},m(a,h){s&&s.m(a,h),e=!0},p(a,h){s&&s.p&&(!e||h[0]&536870933)&&Xi(s,n,a,a[29],e?Hi(n,a[29],h,ek):Wi(a[29]),V_)},i(a){e||(ge(s,a),e=!0)},o(a){Se(s,a),e=!1},d(a){s&&s.d(a)}}}function tk(r){let e,n,s=r[9].default&&G_(r);return{c(){s&&s.c(),e=ii()},m(a,h){s&&s.m(a,h),ae(a,e,h),n=!0},p(a,h){a[9].default?s?(s.p(a,h),h[0]&512&&ge(s,1)):(s=G_(a),s.c(),ge(s,1),s.m(e.parentNode,e)):s&&(zn(),Se(s,1,1,()=>{s=null}),Fn())},i(a){n||(ge(s),n=!0)},o(a){Se(s),n=!1},d(a){a&&oe(e),s&&s.d(a)}}}function nk(r,e,n){let s,a,h,m,l,x,{$$slots:S={},$$scope:T}=e;const C=ex(S);let{closeButton:N=void 0}=e,{closeOnClickOutside:B=!0}=e,{closeOnClickInside:U=!1}=e,{closeOnMove:ee=!1}=e,{openOn:ie="click"}=e,{openIfTopMost:se=!0}=e,{focusAfterOpen:Q=!0}=e,{anchor:Y=void 0}=e,{offset:_e=void 0}=e,{popupClass:ve=void 0}=e,{maxWidth:Ae=void 0}=e,{lngLat:ce=void 0}=e,{html:xe=void 0}=e,{open:be=!1}=e;const Le=hc(),{map:ke,popupTarget:ye,layerEvent:Ue,layer:qe,eventTopMost:pt}=K2();zt(r,ke,Ye=>n(2,h=Ye)),zt(r,ye,Ye=>n(3,l=Ye)),zt(r,Ue,Ye=>n(28,m=Ye)),zt(r,qe,Ye=>n(35,x=Ye));const St=["click","dblclick","contextmenu"];let dt,ut=!1,Ut;function vt(){if(!dt)return;let Ye=dt.getElement();!Ye||Ye===Ut||(Ut=Ye,ie==="hover"&&(Ut.style.pointerEvents="none"),Ut.addEventListener("mouseenter",()=>{n(24,ut=!0)},{passive:!0}),Ut.addEventListener("mouseleave",()=>{n(24,ut=!1)},{passive:!0}),Ut.addEventListener("click",()=>{U&&n(0,be=!1)},{passive:!0}))}cc(()=>{if(h)return h.on("click",dn),h.on("contextmenu",dn),typeof l=="string"&&(h.on("click",l,It),h.on("dblclick",l,It),h.on("contextmenu",l,It),h.on("mousemove",l,Wn),h.on("mouseleave",l,We),h.on("touchstart",l,pn),h.on("touchend",l,Pn)),()=>{h!=null&&h.loaded()&&(dt==null||dt.remove(),h.off("click",dn),h.off("contextmenu",dn),l instanceof Cs.Marker?l.getPopup()===dt&&l.setPopup(void 0):typeof l=="string"&&(h.off("click",l,It),h.off("dblclick",l,It),h.off("contextmenu",l,It),h.off("mousemove",l,Wn),h.off("mouseleave",l,We),h.off("touchstart",l,pn),h.off("touchend",l,Pn)))}});function kt(Ye){return se?!("marker"in Ye)&&!$2(Ye)&&pt(Ye)!==x:!1}let ft=null,wt="normal";function It(Ye){Ye.type===ie&&(kt(Ye)||("layerType"in Ye?Ye.layerType==="deckgl"?(n(10,ce=Ye.coordinate),n(4,ft=Ye.object?[Ye.object]:null)):(n(10,ce=Ye.lngLat),n(4,ft=Ye.features??[])):(n(10,ce=Ye.lngLat),n(4,ft=Ye.features??[])),setTimeout(()=>n(0,be=!0))))}let $t=null;function pn(Ye){$t=Ye.point}function Pn(Ye){if(!$t||ie!=="hover")return;let Lt=$t.dist(Ye.point);$t=null,Lt<3&&(n(10,ce=Ye.lngLat),n(4,ft=Ye.features??[]),dt.isOpen()?n(25,wt="justOpened"):(n(25,wt="opening"),n(0,be=!0)))}function We(Ye){ie!=="hover"||$t||wt!=="normal"||(n(0,be=!1),n(4,ft=null))}function Wn(Ye){if(!(ie!=="hover"||$t||wt!=="normal")){if(kt(Ye)){n(0,be=!1),n(4,ft=null);return}n(0,be=!0),n(4,ft=Ye.features??[]),n(10,ce=Ye.lngLat)}}function dn(Ye){if(wt==="justOpened"){n(25,wt="normal");return}if(!B)return;let Lt=[Ut,l instanceof Cs.Marker?l==null?void 0:l.getElement():null];be&&dt.isOpen()&&!Lt.some(Ke=>Ke==null?void 0:Ke.contains(Ye.originalEvent.target))&&(Ye.type==="contextmenu"&&ie==="contextmenu"||Ye.type!=="contextmenu")&&n(0,be=!1)}vo(()=>{h&&(dt!=null&&dt.isOpen())&&dt.remove()});let Ot;const Ee=()=>n(0,be=!1);function lt(Ye){$n[Ye?"unshift":"push"](()=>{Ot=Ye,n(1,Ot)})}return r.$$set=Ye=>{"closeButton"in Ye&&n(11,N=Ye.closeButton),"closeOnClickOutside"in Ye&&n(12,B=Ye.closeOnClickOutside),"closeOnClickInside"in Ye&&n(13,U=Ye.closeOnClickInside),"closeOnMove"in Ye&&n(14,ee=Ye.closeOnMove),"openOn"in Ye&&n(15,ie=Ye.openOn),"openIfTopMost"in Ye&&n(16,se=Ye.openIfTopMost),"focusAfterOpen"in Ye&&n(17,Q=Ye.focusAfterOpen),"anchor"in Ye&&n(18,Y=Ye.anchor),"offset"in Ye&&n(19,_e=Ye.offset),"popupClass"in Ye&&n(20,ve=Ye.popupClass),"maxWidth"in Ye&&n(21,Ae=Ye.maxWidth),"lngLat"in Ye&&n(10,ce=Ye.lngLat),"html"in Ye&&n(22,xe=Ye.html),"open"in Ye&&n(0,be=Ye.open),"$$scope"in Ye&&n(29,T=Ye.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&n(27,s=N??(!B&&!U)),r.$$.dirty[0]&146685952&&(dt||(n(23,dt=new Cs.Popup({closeButton:s,closeOnClick:!1,closeOnMove:ee,focusAfterOpen:Q,maxWidth:Ae,className:ve,anchor:Y,offset:_e})),Ut=dt.getElement(),dt.on("open",()=>{n(0,be=!0),vt(),Le("open",dt)}),dt.on("close",()=>{n(0,be=!1),Le("close",dt)}),dt.on("hover",()=>{Le("hover",dt)}))),r.$$.dirty[0]&8421384&&dt&&l instanceof Cs.Marker&&(ie==="click"?l.setPopup(dt):l.getPopup()===dt&&l.setPopup(void 0)),r.$$.dirty[0]&268468224&&St.includes(ie)&&(m==null?void 0:m.type)===ie&&(It(m),Dn(Ue,m=null,m)),r.$$.dirty[0]&268468224&&n(26,a=ie==="hover"&&((m==null?void 0:m.type)==="mousemove"||(m==null?void 0:m.type)==="mouseenter")),r.$$.dirty[0]&352354304&&ie==="hover"&&Ue&&(a&&m&&(m.layerType==="deckgl"?(n(10,ce=m.coordinate),n(4,ft=m.object?[m.object]:null)):(n(10,ce=m.lngLat),n(4,ft=m.features??[]))),n(0,be=(a||ut)??!1)),r.$$.dirty[0]&12582914&&(Ot?dt.setDOMContent(Ot):xe&&dt.setHTML(xe)),r.$$.dirty[0]&8389632&&ce&&dt.setLngLat(ce),r.$$.dirty[0]&41943045&&h){let Ye=dt.isOpen();be&&!Ye?(dt.addTo(h),wt==="opening"&&n(25,wt="justOpened")):!be&&Ye&&dt.remove()}},[be,Ot,h,l,ft,ke,ye,Ue,qe,C,ce,N,B,U,ee,ie,se,Q,Y,_e,ve,Ae,xe,dt,ut,wt,a,s,m,T,S,Ee,lt]}class ik extends fn{constructor(e){super(),hn(this,e,nk,tk,an,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var nc=Math.pow,ms=(r,e,n)=>new Promise((s,a)=>{var h=x=>{try{l(n.next(x))}catch(S){a(S)}},m=x=>{try{l(n.throw(x))}catch(S){a(S)}},l=x=>x.done?s(x.value):Promise.resolve(x.value).then(h,m);l((n=n.apply(r,e)).next())}),eo=Uint8Array,Yu=Uint16Array,rk=Int32Array,Rv=new eo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Pv=new eo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),sk=new eo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Dv=function(r,e){for(var n=new Yu(31),s=0;s<31;++s)n[s]=e+=1<<r[s-1];for(var a=new rk(n[30]),s=1;s<30;++s)for(var h=n[s];h<n[s+1];++h)a[h]=h-n[s]<<5|s;return{b:n,r:a}},Nv=Dv(Rv,2),zv=Nv.b,ok=Nv.r;zv[28]=258,ok[258]=28;var ak=Dv(Pv,0),lk=ak.b,Tp=new Yu(32768);for(vi=0;vi<32768;++vi)Ca=(vi&43690)>>1|(vi&21845)<<1,Ca=(Ca&52428)>>2|(Ca&13107)<<2,Ca=(Ca&61680)>>4|(Ca&3855)<<4,Tp[vi]=((Ca&65280)>>8|(Ca&255)<<8)>>1;var Ca,vi,kh=function(r,e,n){for(var s=r.length,a=0,h=new Yu(e);a<s;++a)r[a]&&++h[r[a]-1];var m=new Yu(e);for(a=1;a<e;++a)m[a]=m[a-1]+h[a-1]<<1;var l;if(n){l=new Yu(1<<e);var x=15-e;for(a=0;a<s;++a)if(r[a])for(var S=a<<4|r[a],T=e-r[a],C=m[r[a]-1]++<<T,N=C|(1<<T)-1;C<=N;++C)l[Tp[C]>>x]=S}else for(l=new Yu(s),a=0;a<s;++a)r[a]&&(l[a]=Tp[m[r[a]-1]++]>>15-r[a]);return l},Oh=new eo(288);for(vi=0;vi<144;++vi)Oh[vi]=8;var vi;for(vi=144;vi<256;++vi)Oh[vi]=9;var vi;for(vi=256;vi<280;++vi)Oh[vi]=7;var vi;for(vi=280;vi<288;++vi)Oh[vi]=8;var vi,Fv=new eo(32);for(vi=0;vi<32;++vi)Fv[vi]=5;var vi,uk=kh(Oh,9,1),ck=kh(Fv,5,1),up=function(r){for(var e=r[0],n=1;n<r.length;++n)r[n]>e&&(e=r[n]);return e},Lo=function(r,e,n){var s=e/8|0;return(r[s]|r[s+1]<<8)>>(e&7)&n},cp=function(r,e){var n=e/8|0;return(r[n]|r[n+1]<<8|r[n+2]<<16)>>(e&7)},hk=function(r){return(r+7)/8|0},fk=function(r,e,n){(e==null||e<0)&&(e=0),(n==null||n>r.length)&&(n=r.length);var s=new eo(n-e);return s.set(r.subarray(e,n)),s},dk=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Qs=function(r,e,n){var s=new Error(e||dk[r]);if(s.code=r,Error.captureStackTrace&&Error.captureStackTrace(s,Qs),!n)throw s;return s},Hp=function(r,e,n,s){var a=r.length,h=s?s.length:0;if(!a||e.f&&!e.l)return n||new eo(0);var m=!n||e.i!=2,l=e.i;n||(n=new eo(a*3));var x=function(dn){var Ot=n.length;if(dn>Ot){var Ee=new eo(Math.max(Ot*2,dn));Ee.set(n),n=Ee}},S=e.f||0,T=e.p||0,C=e.b||0,N=e.l,B=e.d,U=e.m,ee=e.n,ie=a*8;do{if(!N){S=Lo(r,T,1);var se=Lo(r,T+1,3);if(T+=3,se)if(se==1)N=uk,B=ck,U=9,ee=5;else if(se==2){var ve=Lo(r,T,31)+257,Ae=Lo(r,T+10,15)+4,ce=ve+Lo(r,T+5,31)+1;T+=14;for(var xe=new eo(ce),be=new eo(19),Le=0;Le<Ae;++Le)be[sk[Le]]=Lo(r,T+Le*3,7);T+=Ae*3;for(var ke=up(be),ye=(1<<ke)-1,Ue=kh(be,ke,1),Le=0;Le<ce;){var qe=Ue[Lo(r,T,ye)];T+=qe&15;var Q=qe>>4;if(Q<16)xe[Le++]=Q;else{var pt=0,St=0;for(Q==16?(St=3+Lo(r,T,3),T+=2,pt=xe[Le-1]):Q==17?(St=3+Lo(r,T,7),T+=3):Q==18&&(St=11+Lo(r,T,127),T+=7);St--;)xe[Le++]=pt}}var dt=xe.subarray(0,ve),ut=xe.subarray(ve);U=up(dt),ee=up(ut),N=kh(dt,U,1),B=kh(ut,ee,1)}else Qs(1);else{var Q=hk(T)+4,Y=r[Q-4]|r[Q-3]<<8,_e=Q+Y;if(_e>a){l&&Qs(0);break}m&&x(C+Y),n.set(r.subarray(Q,_e),C),e.b=C+=Y,e.p=T=_e*8,e.f=S;continue}if(T>ie){l&&Qs(0);break}}m&&x(C+131072);for(var Ut=(1<<U)-1,vt=(1<<ee)-1,kt=T;;kt=T){var pt=N[cp(r,T)&Ut],ft=pt>>4;if(T+=pt&15,T>ie){l&&Qs(0);break}if(pt||Qs(2),ft<256)n[C++]=ft;else if(ft==256){kt=T,N=null;break}else{var wt=ft-254;if(ft>264){var Le=ft-257,It=Rv[Le];wt=Lo(r,T,(1<<It)-1)+zv[Le],T+=It}var $t=B[cp(r,T)&vt],pn=$t>>4;$t||Qs(3),T+=$t&15;var ut=lk[pn];if(pn>3){var It=Pv[pn];ut+=cp(r,T)&(1<<It)-1,T+=It}if(T>ie){l&&Qs(0);break}m&&x(C+131072);var Pn=C+wt;if(C<ut){var We=h-ut,Wn=Math.min(ut,Pn);for(We+C<0&&Qs(3);C<Wn;++C)n[C]=s[We+C]}for(;C<Pn;C+=4)n[C]=n[C-ut],n[C+1]=n[C+1-ut],n[C+2]=n[C+2-ut],n[C+3]=n[C+3-ut];C=Pn}}e.l=N,e.p=kt,e.b=C,e.f=S,N&&(S=1,e.m=U,e.d=B,e.n=ee)}while(!S);return C==n.length?n:fk(n,0,C)},pk=new eo(0),mk=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Qs(6,"invalid gzip data");var e=r[3],n=10;e&4&&(n+=(r[10]|r[11]<<8)+2);for(var s=(e>>3&1)+(e>>4&1);s>0;s-=!r[n++]);return n+(e&2)},gk=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},_k=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Qs(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&Qs(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function yk(r,e){return Hp(r,{i:2},e&&e.out,e&&e.dictionary)}function vk(r,e){var n=mk(r);return n+8>r.length&&Qs(6,"invalid gzip data"),Hp(r.subarray(n,-8),{i:2},e&&e.out||new eo(gk(r)),e&&e.dictionary)}function bk(r,e){return Hp(r.subarray(_k(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Cp(r,e){return r[0]==31&&r[1]==139&&r[2]==8?vk(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?yk(r,e):bk(r,e)}var xk=typeof TextDecoder<"u"&&new TextDecoder,wk=0;try{xk.decode(pk,{stream:!0}),wk=1}catch{}var Ov=(r,e)=>r*nc(2,e),fh=(r,e)=>Math.floor(r/nc(2,e)),Vf=(r,e)=>Ov(r.getUint16(e+1,!0),8)+r.getUint8(e),Bv=(r,e)=>Ov(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),kk=(r,e,n,s,a)=>{if(r!==s.getUint8(a))return r-s.getUint8(a);const h=Vf(s,a+1);if(e!==h)return e-h;const m=Vf(s,a+4);return n!==m?n-m:0},Ik=(r,e,n,s)=>{const a=Uv(r,e|128,n,s);return a?{z:e,x:n,y:s,offset:a[0],length:a[1],isDir:!0}:null},H_=(r,e,n,s)=>{const a=Uv(r,e,n,s);return a?{z:e,x:n,y:s,offset:a[0],length:a[1],isDir:!1}:null},Uv=(r,e,n,s)=>{let a=0,h=r.byteLength/17-1;for(;a<=h;){const m=h+a>>1,l=kk(e,n,s,r,m*17);if(l>0)a=m+1;else if(l<0)h=m-1;else return[Bv(r,m*17+7),r.getUint32(m*17+13,!0)]}return null},Sk=(r,e)=>r.isDir&&!e.isDir?1:!r.isDir&&e.isDir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,jv=(r,e)=>{const n=r.getUint8(e*17);return{z:n&127,x:Vf(r,e*17+1),y:Vf(r,e*17+4),offset:Bv(r,e*17+7),length:r.getUint32(e*17+13,!0),isDir:n>>7===1}},X_=r=>{const e=[],n=new DataView(r);for(let s=0;s<n.byteLength/17;s++)e.push(jv(n,s));return Ek(e)},Ek=r=>{r.sort(Sk);const e=new ArrayBuffer(17*r.length),n=new Uint8Array(e);for(let s=0;s<r.length;s++){const a=r[s];let h=a.z;a.isDir&&(h=h|128),n[s*17]=h,n[s*17+1]=a.x&255,n[s*17+2]=a.x>>8&255,n[s*17+3]=a.x>>16&255,n[s*17+4]=a.y&255,n[s*17+5]=a.y>>8&255,n[s*17+6]=a.y>>16&255,n[s*17+7]=a.offset&255,n[s*17+8]=fh(a.offset,8)&255,n[s*17+9]=fh(a.offset,16)&255,n[s*17+10]=fh(a.offset,24)&255,n[s*17+11]=fh(a.offset,32)&255,n[s*17+12]=fh(a.offset,48)&255,n[s*17+13]=a.length&255,n[s*17+14]=a.length>>8&255,n[s*17+15]=a.length>>16&255,n[s*17+16]=a.length>>24&255}return e},Ak=(r,e)=>{if(r.byteLength<17)return null;const n=r.byteLength/17,s=jv(r,n-1);if(s.isDir){const a=s.z,h=e.z-a,m=Math.trunc(e.x/(1<<h)),l=Math.trunc(e.y/(1<<h));return{z:a,x:m,y:l}}return null};function Tk(r){return ms(this,null,function*(){const e=yield r.getBytes(0,512e3),n=new DataView(e.data),s=n.getUint32(4,!0),a=n.getUint16(8,!0),h=new TextDecoder("utf-8"),m=JSON.parse(h.decode(new DataView(e.data,10,s)));let l=0;m.compression==="gzip"&&(l=2);let x=0;"minzoom"in m&&(x=+m.minzoom);let S=0;"maxzoom"in m&&(S=+m.maxzoom);let T=0,C=0,N=0,B=-180,U=-85,ee=180,ie=85;if(m.bounds){const Q=m.bounds.split(",");B=+Q[0],U=+Q[1],ee=+Q[2],ie=+Q[3]}if(m.center){const Q=m.center.split(",");T=+Q[0],C=+Q[1],N=+Q[2]}return{specVersion:n.getUint16(2,!0),rootDirectoryOffset:10+s,rootDirectoryLength:a*17,jsonMetadataOffset:10,jsonMetadataLength:s,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:l,tileType:1,minZoom:x,maxZoom:S,minLon:B,minLat:U,maxLon:ee,maxLat:ie,centerZoom:N,centerLon:T,centerLat:C,etag:e.etag}})}function Ck(r,e,n,s,a,h,m){return ms(this,null,function*(){let l=yield n.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(l=X_(l));const x=H_(new DataView(l),s,a,h);if(x){let C=(yield e.getBytes(x.offset,x.length,m)).data;const N=new DataView(C);return N.getUint8(0)===31&&N.getUint8(1)===139&&(C=Cp(new Uint8Array(C))),{data:C}}const S=Ak(new DataView(l),{z:s,x:a,y:h});if(S){const T=Ik(new DataView(l),S.z,S.x,S.y);if(T){let C=yield n.getArrayBuffer(e,T.offset,T.length,r);r.specVersion===1&&(C=X_(C));const N=H_(new DataView(C),s,a,h);if(N){let U=(yield e.getBytes(N.offset,N.length,m)).data;const ee=new DataView(U);return ee.getUint8(0)===31&&ee.getUint8(1)===139&&(U=Cp(new Uint8Array(U))),{data:U}}}}})}var qv={getHeader:Tk,getZxy:Ck},Lk=r=>(e,n)=>{if(n instanceof AbortController)return r(e,n);const s=new AbortController;return r(e,s).then(a=>n(void 0,a.data,a.cacheControl||"",a.expires||""),a=>n(a)).catch(a=>n(a)),{cancel:()=>s.abort()}},Mk=class{constructor(){this.tilev4=(r,e)=>ms(this,null,function*(){if(r.type==="json"){const C=r.url.substr(10);let N=this.tiles.get(C);N||(N=new W_(C),this.tiles.set(C,N));const B=yield N.getHeader();return{data:{tiles:[`${r.url}/{z}/{x}/{y}`],minzoom:B.minZoom,maxzoom:B.maxZoom,bounds:[B.minLon,B.minLat,B.maxLon,B.maxLat]}}}const n=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=r.url.match(n);if(!s)throw new Error("Invalid PMTiles protocol URL");const a=s[1];let h=this.tiles.get(a);h||(h=new W_(a),this.tiles.set(a,h));const m=s[2],l=s[3],x=s[4],S=yield h.getHeader(),T=yield h==null?void 0:h.getZxy(+m,+l,+x,e.signal);return T?{data:new Uint8Array(T.data),cacheControl:T.cacheControl,expires:T.expires}:S.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=Lk(this.tilev4),this.tiles=new Map}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function Xu(r,e){return(e>>>0)*4294967296+(r>>>0)}function Rk(r,e){const n=e.buf;let s=n[e.pos++],a=(s&112)>>4;if(s<128||(s=n[e.pos++],a|=(s&127)<<3,s<128)||(s=n[e.pos++],a|=(s&127)<<10,s<128)||(s=n[e.pos++],a|=(s&127)<<17,s<128)||(s=n[e.pos++],a|=(s&127)<<24,s<128)||(s=n[e.pos++],a|=(s&1)<<31,s<128))return Xu(r,a);throw new Error("Expected varint not more than 10 bytes")}function dh(r){const e=r.buf;let n=e[r.pos++],s=n&127;return n<128||(n=e[r.pos++],s|=(n&127)<<7,n<128)||(n=e[r.pos++],s|=(n&127)<<14,n<128)||(n=e[r.pos++],s|=(n&127)<<21,n<128)?s:(n=e[r.pos],s|=(n&15)<<28,Rk(s,r))}function Pk(r,e,n,s){if(s===0){n===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const a=e[0];e[0]=e[1],e[1]=a}}var Dk=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Nk(r,e,n){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>nc(2,r)-1||n>nc(2,r)-1)throw Error("tile x/y outside zoom level bounds");const s=Dk[r],a=nc(2,r);let h=0,m=0,l=0;const x=[e,n];let S=a/2;for(;S>0;)h=(x[0]&S)>0?1:0,m=(x[1]&S)>0?1:0,l+=S*S*(3*h^m),Pk(S,x,h,m),S=S/2;return s+l}function Vv(r,e){return ms(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Cp(new Uint8Array(r));const n=new Response(r).body;if(!n)throw Error("Failed to read response stream");const s=n.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(s).arrayBuffer()}throw Error("Compression method not supported")})}var zk=127;function Fk(r,e){let n=0,s=r.length-1;for(;n<=s;){const a=s+n>>1,h=e-r[a].tileId;if(h>0)n=a+1;else if(h<0)s=a-1;else return r[a]}return s>=0&&(r[s].runLength===0||e-r[s].tileId<r[s].runLength)?r[s]:null}var Ok=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,n,s){return ms(this,null,function*(){let a,h;n?h=n:(a=new AbortController,h=a.signal);const m=new Headers(this.customHeaders);m.set("range",`bytes=${r}-${r+e-1}`);let l;this.mustReload&&(l="reload");let x=yield fetch(this.url,{signal:h,cache:l,headers:m});if(r===0&&x.status===416){const N=x.headers.get("Content-Range");if(!N||!N.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const B=+N.substr(8);x=yield fetch(this.url,{signal:h,cache:"reload",headers:{range:`bytes=0-${B-1}`}})}let S=x.headers.get("Etag");if(S!=null&&S.startsWith("W/")&&(S=null),x.status===416||s&&S&&S!==s)throw this.mustReload=!0,new Lp(`Server returned non-matching ETag ${s} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(x.status>=300)throw Error(`Bad response code: ${x.status}`);const T=x.headers.get("Content-Length");if(x.status===200&&(!T||+T>e))throw a&&a.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield x.arrayBuffer(),etag:S||void 0,cacheControl:x.headers.get("Cache-Control")||void 0,expires:x.headers.get("Expires")||void 0}})}};function Mo(r,e){const n=r.getUint32(e+4,!0),s=r.getUint32(e+0,!0);return n*nc(2,32)+s}function Bk(r,e){const n=new DataView(r),s=n.getUint8(7);if(s>3)throw Error(`Archive is spec version ${s} but this library supports up to spec version 3`);return{specVersion:s,rootDirectoryOffset:Mo(n,8),rootDirectoryLength:Mo(n,16),jsonMetadataOffset:Mo(n,24),jsonMetadataLength:Mo(n,32),leafDirectoryOffset:Mo(n,40),leafDirectoryLength:Mo(n,48),tileDataOffset:Mo(n,56),tileDataLength:Mo(n,64),numAddressedTiles:Mo(n,72),numTileEntries:Mo(n,80),numTileContents:Mo(n,88),clustered:n.getUint8(96)===1,internalCompression:n.getUint8(97),tileCompression:n.getUint8(98),tileType:n.getUint8(99),minZoom:n.getUint8(100),maxZoom:n.getUint8(101),minLon:n.getInt32(102,!0)/1e7,minLat:n.getInt32(106,!0)/1e7,maxLon:n.getInt32(110,!0)/1e7,maxLat:n.getInt32(114,!0)/1e7,centerZoom:n.getUint8(118),centerLon:n.getInt32(119,!0)/1e7,centerLat:n.getInt32(123,!0)/1e7,etag:e}}function Gv(r){const e={buf:new Uint8Array(r),pos:0},n=dh(e),s=[];let a=0;for(let h=0;h<n;h++){const m=dh(e);s.push({tileId:a+m,offset:0,length:0,runLength:1}),a+=m}for(let h=0;h<n;h++)s[h].runLength=dh(e);for(let h=0;h<n;h++)s[h].length=dh(e);for(let h=0;h<n;h++){const m=dh(e);m===0&&h>0?s[h].offset=s[h-1].offset+s[h-1].length:s[h].offset=m-1}return s}function Uk(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Lp=class extends Error{};function jk(r,e){return ms(this,null,function*(){const n=yield r.getBytes(0,16384);if(new DataView(n.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Uk(n.data)<3)return[yield qv.getHeader(r)];const a=n.data.slice(0,zk),h=Bk(a,n.etag),m=n.data.slice(h.rootDirectoryOffset,h.rootDirectoryOffset+h.rootDirectoryLength),l=`${r.getKey()}|${h.etag||""}|${h.rootDirectoryOffset}|${h.rootDirectoryLength}`,x=Gv(yield e(m,h.internalCompression));return[h,[l,x.length,x]]})}function qk(r,e,n,s,a){return ms(this,null,function*(){const h=yield r.getBytes(n,s,void 0,a.etag),m=yield e(h.data,a.internalCompression),l=Gv(m);if(l.length===0)throw new Error("Empty directory is invalid");return l})}var Vk=class{constructor(r=100,e=!0,n=Vv){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=r,this.counter=1,this.decompress=n}getHeader(r){return ms(this,null,function*(){const e=r.getKey(),n=this.cache.get(e);if(n)return n.lastUsed=this.counter++,yield n.data;const s=new Promise((a,h)=>{jk(r,this.decompress).then(m=>{m[1]&&this.cache.set(m[1][0],{lastUsed:this.counter++,data:Promise.resolve(m[1][2])}),a(m[0]),this.prune()}).catch(m=>{h(m)})});return this.cache.set(e,{lastUsed:this.counter++,data:s}),s})}getDirectory(r,e,n,s){return ms(this,null,function*(){const a=`${r.getKey()}|${s.etag||""}|${e}|${n}`,h=this.cache.get(a);if(h)return h.lastUsed=this.counter++,yield h.data;const m=new Promise((l,x)=>{qk(r,this.decompress,e,n,s).then(S=>{l(S),this.prune()}).catch(S=>{x(S)})});return this.cache.set(a,{lastUsed:this.counter++,data:m}),m})}getArrayBuffer(r,e,n,s){return ms(this,null,function*(){const a=`${r.getKey()}|${s.etag||""}|${e}|${n}`,h=this.cache.get(a);if(h)return h.lastUsed=this.counter++,yield h.data;const m=new Promise((l,x)=>{r.getBytes(e,n,void 0,s.etag).then(S=>{l(S.data),this.cache.has(a),this.prune()}).catch(S=>{x(S)})});return this.cache.set(a,{lastUsed:this.counter++,data:m}),m})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((n,s)=>{n.lastUsed<r&&(r=n.lastUsed,e=s)}),e&&this.cache.delete(e)}}invalidate(r){return ms(this,null,function*(){const e=r.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(r.getKey());const n=new Promise((s,a)=>{this.getHeader(r).then(h=>{s(),this.invalidations.delete(e)}).catch(h=>{a(h)})});this.invalidations.set(e,n)})}},W_=class{constructor(r,e,n){typeof r=="string"?this.source=new Ok(r):this.source=r,n?this.decompress=n:this.decompress=Vv,e?this.cache=e:this.cache=new Vk}getHeader(){return ms(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,n,s){return ms(this,null,function*(){const a=Nk(r,e,n),h=yield this.cache.getHeader(this.source);if(h.specVersion<3)return qv.getZxy(h,this.source,this.cache,r,e,n,s);if(r<h.minZoom||r>h.maxZoom)return;let m=h.rootDirectoryOffset,l=h.rootDirectoryLength;for(let x=0;x<=3;x++){const S=yield this.cache.getDirectory(this.source,m,l,h),T=Fk(S,a);if(T){if(T.runLength>0){const C=yield this.source.getBytes(h.tileDataOffset+T.offset,T.length,s,h.etag);return{data:yield this.decompress(C.data,h.tileCompression),cacheControl:C.cacheControl,expires:C.expires}}m=h.leafDirectoryOffset+T.offset,l=T.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,n,s){return ms(this,null,function*(){try{return yield this.getZxyAttempt(r,e,n,s)}catch(a){if(a instanceof Lp)return this.cache.invalidate(this.source),yield this.getZxyAttempt(r,e,n,s);throw a}})}getMetadataAttempt(){return ms(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength,void 0,r.etag),n=yield this.decompress(e.data,r.internalCompression),s=new TextDecoder("utf-8");return JSON.parse(s.decode(n))})}getMetadata(){return ms(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof Lp)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw r}})}};const Gk=r=>({props:r&8}),K_=r=>({props:Xk(r[3])});function Zk(r){let e;const n=r[1].default,s=Zi(n,r,r[2],K_);return{c(){s&&s.c()},m(a,h){s&&s.m(a,h),e=!0},p(a,h){s&&s.p&&(!e||h&12)&&Xi(s,n,a,a[2],e?Hi(n,a[2],h,Gk):Wi(a[2]),K_)},i(a){e||(ge(s,a),e=!0)},o(a){Se(s,a),e=!1},d(a){s&&s.d(a)}}}function Hk(r){let e,n;return e=new ik({props:{openOn:r[0],$$slots:{default:[Zk,({features:s})=>({3:s}),({features:s})=>s?8:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,[a]){const h={};a&1&&(h.openOn=s[0]),a&12&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function Xk(r){return r?r[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function Wk(r,e,n){let{$$slots:s={},$$scope:a}=e,{openOn:h="hover"}=e;return r.$$set=m=>{"openOn"in m&&n(0,h=m.openOn),"$$scope"in m&&n(2,a=m.$$scope)},[h,s,a]}class js extends fn{constructor(e){super(),hn(this,e,Wk,Hk,an,{openOn:0})}}function Xp(r,e,n){let s=["match",r];for(let[a,h]of Object.entries(e))s.push(a),s.push(h);return s.push(n),s}function Gf(r,e,n){let s=["step",r];for(let a=1;a<e.length;a++)s.push(n[a-1]),s.push(e[a]);return s.push(n[n.length-1]),s}function Mf(){return{type:"FeatureCollection",features:[]}}let Kk=Date.now();function dc(r){return`${r}-${Kk++}`}const Wp=Symbol.for("svelte-maplibre");function pc(){return ev(Wp)}function $k(r){let e=new WeakMap;return n=>{var m;let s=e.get(n.originalEvent);if(s!==void 0)return s;let h=(m=n.target.queryRenderedFeatures(n.point).find(l=>{var x;return(x=r.get(l.layer.id))==null?void 0:x.interactive}))==null?void 0:m.layer.id;return e.set(n.originalEvent,h),h}}function Yk(){let r=new Map;return Q0(Wp,{map:Jn(null),source:lp(null),layer:lp(null),popupTarget:lp(null),cluster:Jn(),loadedImages:Jn(new Set),minzoom:Jn(0),maxzoom:Jn(24),layerEvent:Jn(null),layerInfo:r,eventTopMost:$k(r),markerClickManager:new eI})}function $_(r){return{subscribe:r.subscribe}}function Kp({key:r,setPopupTarget:e=!1,setCluster:n=!1,setMouseEvent:s=!1}){let a=pc(),h=Jn(null),m=$_(h),l={...a,[r]:$_(h)};if(e&&(l.popupTarget=m),s){let x=Jn(null);l.layerEvent=x,a.layerEvent=x}return n&&(l.cluster=Jn()),Q0(Wp,l),{...a,self:h}}function Zv(){return Kp({key:"source",setCluster:!0})}function Jk(r=!0){return Kp({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Qk(){return Kp({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}class eI{constructor(){lh(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const n of this._handlers)n(e)}}function Y_(r){let e;return n=>{if(n)for(let s in n){let a=e==null?void 0:e[s],h=n[s];a!==h&&r(s,h,a)}else if(e)for(let s in e)r(s,void 0,e[s]);e=n}}function tI(r,...e){let n=[r];for(let s of e)if(s)Array.isArray(s)&&s[0]===r?n.push(...s.slice(1)):n.push(s);else continue;if(n.length!==1)return n.length===2?n[1]:n}function nI(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Ls(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}function J_(r){let e=r[0],n,s,a=Q_(r);return{c(){a.c(),n=ii()},m(h,m){a.m(h,m),ae(h,n,m),s=!0},p(h,m){m[0]&1&&an(e,e=h[0])?(zn(),Se(a,1,1,tt),Fn(),a=Q_(h),a.c(),ge(a,1),a.m(n.parentNode,n)):a.p(h,m)},i(h){s||(ge(a),s=!0)},o(h){Se(a),s=!1},d(h){h&&oe(n),a.d(h)}}}function Q_(r){let e;const n=r[36].default,s=Zi(n,r,r[35],null);return{c(){s&&s.c()},m(a,h){s&&s.m(a,h),e=!0},p(a,h){s&&s.p&&(!e||h[1]&16)&&Xi(s,n,a,a[35],e?Hi(n,a[35],h,null):Wi(a[35]),null)},i(a){e||(ge(s,a),e=!0)},o(a){Se(s,a),e=!1},d(a){s&&s.d(a)}}}function iI(r){let e,n,s=r[0]&&J_(r);return{c(){s&&s.c(),e=ii()},m(a,h){s&&s.m(a,h),ae(a,e,h),n=!0},p(a,h){a[0]?s?(s.p(a,h),h[0]&1&&ge(s,1)):(s=J_(a),s.c(),ge(s,1),s.m(e.parentNode,e)):s&&(zn(),Se(s,1,1,()=>{s=null}),Fn())},i(a){n||(ge(s),n=!0)},o(a){Se(s),n=!1},d(a){a&&oe(e),s&&s.d(a)}}}function rI(r,e,n){let s,a,h,m,l,x,S,T,C,N,B,U,{$$slots:ee={},$$scope:ie}=e,{id:se=dc("layer")}=e,{source:Q=void 0}=e,{sourceLayer:Y=void 0}=e,{beforeId:_e=void 0}=e,{beforeLayerType:ve=void 0}=e,{type:Ae}=e,{paint:ce=void 0}=e,{layout:xe=void 0}=e,{filter:be=void 0}=e,{applyToClusters:Le=void 0}=e,{minzoom:ke=void 0}=e,{maxzoom:ye=void 0}=e,{manageHoverState:Ue=!1}=e,{hovered:qe=null}=e,{interactive:pt=!0}=e,{hoverCursor:St=void 0}=e,{eventsIfTopMost:dt=!1}=e;const ut=hc(),{map:Ut,source:vt,self:kt,minzoom:ft,maxzoom:wt,eventTopMost:It,layerInfo:$t}=Jk();zt(r,Ut,lt=>n(31,C=lt)),zt(r,vt,lt=>n(32,N=lt)),zt(r,kt,lt=>n(0,T=lt)),zt(r,ft,lt=>n(34,U=lt)),zt(r,wt,lt=>n(33,B=lt)),vo(()=>{T&&C&&($t.delete(T),C==null||C.removeLayer(T))});let pn;function Pn(lt){var On,bt;if(!pt||!T||!C||dt&&It(lt)!==T)return;let Ye=lt.features??[],Lt=(bt=(On=Ye[0])==null?void 0:On.properties)==null?void 0:bt.cluster_id,Ke={event:lt,map:C,clusterId:Lt,layer:T,source:l,features:Ye};ut(lt.type,Ke)}function We(lt){var On,bt;if(!pt||!T||!C||dt&&It(lt)!==T)return;St&&(C.getCanvas().style.cursor=St);let Ye=lt.features??[];n(6,qe=Ye[0]??null);let Lt=(bt=(On=Ye[0])==null?void 0:On.properties)==null?void 0:bt.cluster_id;ut("mouseenter",{event:lt,map:C,clusterId:Lt,layer:T,source:l,features:Ye})}function Wn(lt){var On,bt,Ie;if(!pt||!C)return;if(dt&&It(lt)!==T){n(6,qe=null),Ue&&pn!==void 0&&(C==null||C.setFeatureState({source:l,sourceLayer:Y,id:pn},{hover:!1}),pn=void 0);return}C.getCanvas().style.cursor=St;let Ye=lt.features??[],Lt=(bt=(On=Ye[0])==null?void 0:On.properties)==null?void 0:bt.cluster_id,Ke=(Ie=Ye[0])==null?void 0:Ie.id;Ke!==pn&&(Ue&&(pn!==void 0&&(C==null||C.setFeatureState({source:l,id:pn,sourceLayer:Y},{hover:!1})),C==null||C.setFeatureState({source:l,id:Ke,sourceLayer:Y},{hover:!0})),pn=Ke,n(6,qe=Ye[0]??null)),ut("mousemove",{event:lt,map:C,clusterId:Lt,layer:T,source:l,features:Ye})}function dn(lt){if(!(!pt||!T||!C)){if(St&&(C.getCanvas().style.cursor=""),n(6,qe=null),Ue&&pn!==void 0){const Ye={source:l,id:pn,sourceLayer:Y};C==null||C.setFeatureState(Ye,{hover:!1}),pn=void 0}ut("mouseleave",{map:C,layer:T,source:l})}}let Ot=!0;function Ee(lt){C&&(C.off("click",lt,Pn),C.off("dblclick",lt,Pn),C.off("contextmenu",lt,Pn),C.off("mouseenter",lt,We),C.off("mousemove",lt,Wn),C.off("mouseleave",lt,dn))}return vo(()=>{C&&T&&Ee(T)}),r.$$set=lt=>{"id"in lt&&n(7,se=lt.id),"source"in lt&&n(8,Q=lt.source),"sourceLayer"in lt&&n(9,Y=lt.sourceLayer),"beforeId"in lt&&n(10,_e=lt.beforeId),"beforeLayerType"in lt&&n(11,ve=lt.beforeLayerType),"type"in lt&&n(12,Ae=lt.type),"paint"in lt&&n(13,ce=lt.paint),"layout"in lt&&n(14,xe=lt.layout),"filter"in lt&&n(15,be=lt.filter),"applyToClusters"in lt&&n(16,Le=lt.applyToClusters),"minzoom"in lt&&n(17,ke=lt.minzoom),"maxzoom"in lt&&n(18,ye=lt.maxzoom),"manageHoverState"in lt&&n(19,Ue=lt.manageHoverState),"hovered"in lt&&n(6,qe=lt.hovered),"interactive"in lt&&n(20,pt=lt.interactive),"hoverCursor"in lt&&n(21,St=lt.hoverCursor),"eventsIfTopMost"in lt&&n(22,dt=lt.eventsIfTopMost),"$$scope"in lt&&n(35,ie=lt.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&n(30,s=nI(Le)),r.$$.dirty[0]&1073774592&&n(24,a=tI("all",s,be)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&n(26,h=ke??U),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&n(25,m=ye??B),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&n(29,l=Q||N),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&C&&T!==se&&l){T&&(Ee(T),$t.delete(T));let lt=_e;if(!_e&&ve){let Ye=C.getStyle().layers,Lt=typeof ve=="function"?ve:On=>On.type===ve,Ke=Ye==null?void 0:Ye.find(Lt);Ke&&(lt=Ke.id)}Dn(kt,T=se,T),C.addLayer(Rh({id:T,type:Ae,source:l,"source-layer":Y,filter:a,paint:ce,layout:xe,minzoom:h,maxzoom:m}),lt),n(23,Ot=!0),C.on("click",T,Pn),C.on("dblclick",T,Pn),C.on("contextmenu",T,Pn),C.on("mouseenter",T,We),C.on("mousemove",T,Wn),C.on("mouseleave",T,dn)}r.$$.dirty[0]&1048577&&T&&$t.set(T,{interactive:pt}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(28,x=T?Y_((lt,Ye)=>C==null?void 0:C.setPaintProperty(T,lt,Ye)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(27,S=T?Y_((lt,Ye)=>C==null?void 0:C.setLayoutProperty(T,lt,Ye)):void 0),r.$$.dirty[0]&268443648&&(x==null||x(ce)),r.$$.dirty[0]&134234112&&(S==null||S(xe)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&T&&(C==null||C.setLayerZoomRange(T,h,m)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&T&&(Ot?n(23,Ot=!1):C==null||C.setFilter(T,a))},[T,Ut,vt,kt,ft,wt,qe,se,Q,Y,_e,ve,Ae,ce,xe,be,Le,ke,ye,Ue,pt,St,dt,Ot,a,m,h,S,x,l,s,C,N,B,U,ie,ee]}class $p extends fn{constructor(e){super(),hn(this,e,rI,iI,an,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function sI(r){let e;const n=r[16].default,s=Zi(n,r,r[24],null);return{c(){s&&s.c()},m(a,h){s&&s.m(a,h),e=!0},p(a,h){s&&s.p&&(!e||h&16777216)&&Xi(s,n,a,a[24],e?Hi(n,a[24],h,null):Wi(a[24]),null)},i(a){e||(ge(s,a),e=!0)},o(a){Se(s,a),e=!1},d(a){s&&s.d(a)}}}function oI(r){let e,n,s;function a(m){r[17](m)}let h={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[sI]},$$scope:{ctx:r}};return r[0]!==void 0&&(h.hovered=r[0]),e=new $p({props:h}),$n.push(()=>gr(e,"hovered",a)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ot(e.$$.fragment)},m(m,l){it(e,m,l),s=!0},p(m,[l]){const x={};l&2&&(x.id=m[1]),l&4&&(x.source=m[2]),l&8&&(x.sourceLayer=m[3]),l&16&&(x.beforeId=m[4]),l&32&&(x.beforeLayerType=m[5]),l&64&&(x.paint=m[6]),l&128&&(x.layout=m[7]),l&256&&(x.filter=m[8]),l&512&&(x.applyToClusters=m[9]),l&1024&&(x.minzoom=m[10]),l&2048&&(x.maxzoom=m[11]),l&4096&&(x.hoverCursor=m[12]),l&8192&&(x.manageHoverState=m[13]),l&16384&&(x.eventsIfTopMost=m[14]),l&32768&&(x.interactive=m[15]),l&16777216&&(x.$$scope={dirty:l,ctx:m}),!n&&l&1&&(n=!0,x.hovered=m[0],mr(()=>n=!1)),e.$set(x)},i(m){s||(ge(e.$$.fragment,m),s=!0)},o(m){Se(e.$$.fragment,m),s=!1},d(m){rt(e,m)}}}function aI(r,e,n){let{$$slots:s={},$$scope:a}=e,{id:h=dc("circle")}=e,{source:m=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:x=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:T}=e,{layout:C=void 0}=e,{filter:N=void 0}=e,{applyToClusters:B=void 0}=e,{minzoom:U=void 0}=e,{maxzoom:ee=void 0}=e,{hoverCursor:ie=void 0}=e,{manageHoverState:se=!1}=e,{hovered:Q=null}=e,{eventsIfTopMost:Y=!1}=e,{interactive:_e=!0}=e;function ve(ye){Q=ye,n(0,Q)}function Ae(ye){ur.call(this,r,ye)}function ce(ye){ur.call(this,r,ye)}function xe(ye){ur.call(this,r,ye)}function be(ye){ur.call(this,r,ye)}function Le(ye){ur.call(this,r,ye)}function ke(ye){ur.call(this,r,ye)}return r.$$set=ye=>{"id"in ye&&n(1,h=ye.id),"source"in ye&&n(2,m=ye.source),"sourceLayer"in ye&&n(3,l=ye.sourceLayer),"beforeId"in ye&&n(4,x=ye.beforeId),"beforeLayerType"in ye&&n(5,S=ye.beforeLayerType),"paint"in ye&&n(6,T=ye.paint),"layout"in ye&&n(7,C=ye.layout),"filter"in ye&&n(8,N=ye.filter),"applyToClusters"in ye&&n(9,B=ye.applyToClusters),"minzoom"in ye&&n(10,U=ye.minzoom),"maxzoom"in ye&&n(11,ee=ye.maxzoom),"hoverCursor"in ye&&n(12,ie=ye.hoverCursor),"manageHoverState"in ye&&n(13,se=ye.manageHoverState),"hovered"in ye&&n(0,Q=ye.hovered),"eventsIfTopMost"in ye&&n(14,Y=ye.eventsIfTopMost),"interactive"in ye&&n(15,_e=ye.interactive),"$$scope"in ye&&n(24,a=ye.$$scope)},[Q,h,m,l,x,S,T,C,N,B,U,ee,ie,se,Y,_e,s,ve,Ae,ce,xe,be,Le,ke,a]}class Yp extends fn{constructor(e){super(),hn(this,e,aI,oI,an,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function lI(r){let e;const n=r[15].default,s=Zi(n,r,r[23],null);return{c(){s&&s.c()},m(a,h){s&&s.m(a,h),e=!0},p(a,h){s&&s.p&&(!e||h&8388608)&&Xi(s,n,a,a[23],e?Hi(n,a[23],h,null):Wi(a[23]),null)},i(a){e||(ge(s,a),e=!0)},o(a){Se(s,a),e=!1},d(a){s&&s.d(a)}}}function uI(r){let e,n,s;function a(m){r[16](m)}let h={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[lI]},$$scope:{ctx:r}};return r[0]!==void 0&&(h.hovered=r[0]),e=new $p({props:h}),$n.push(()=>gr(e,"hovered",a)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ot(e.$$.fragment)},m(m,l){it(e,m,l),s=!0},p(m,[l]){const x={};l&2&&(x.id=m[1]),l&4&&(x.source=m[2]),l&8&&(x.sourceLayer=m[3]),l&16&&(x.beforeId=m[4]),l&32&&(x.beforeLayerType=m[5]),l&64&&(x.paint=m[6]),l&128&&(x.layout=m[7]),l&256&&(x.filter=m[8]),l&512&&(x.minzoom=m[9]),l&1024&&(x.maxzoom=m[10]),l&2048&&(x.hoverCursor=m[11]),l&4096&&(x.manageHoverState=m[12]),l&8192&&(x.eventsIfTopMost=m[13]),l&16384&&(x.interactive=m[14]),l&8388608&&(x.$$scope={dirty:l,ctx:m}),!n&&l&1&&(n=!0,x.hovered=m[0],mr(()=>n=!1)),e.$set(x)},i(m){s||(ge(e.$$.fragment,m),s=!0)},o(m){Se(e.$$.fragment,m),s=!1},d(m){rt(e,m)}}}function cI(r,e,n){let{$$slots:s={},$$scope:a}=e,{id:h=dc("fill")}=e,{source:m=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:x=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:T}=e,{layout:C=void 0}=e,{filter:N=void 0}=e,{minzoom:B=void 0}=e,{maxzoom:U=void 0}=e,{hoverCursor:ee=void 0}=e,{manageHoverState:ie=!1}=e,{hovered:se=null}=e,{eventsIfTopMost:Q=!1}=e,{interactive:Y=!0}=e;function _e(ke){se=ke,n(0,se)}function ve(ke){ur.call(this,r,ke)}function Ae(ke){ur.call(this,r,ke)}function ce(ke){ur.call(this,r,ke)}function xe(ke){ur.call(this,r,ke)}function be(ke){ur.call(this,r,ke)}function Le(ke){ur.call(this,r,ke)}return r.$$set=ke=>{"id"in ke&&n(1,h=ke.id),"source"in ke&&n(2,m=ke.source),"sourceLayer"in ke&&n(3,l=ke.sourceLayer),"beforeId"in ke&&n(4,x=ke.beforeId),"beforeLayerType"in ke&&n(5,S=ke.beforeLayerType),"paint"in ke&&n(6,T=ke.paint),"layout"in ke&&n(7,C=ke.layout),"filter"in ke&&n(8,N=ke.filter),"minzoom"in ke&&n(9,B=ke.minzoom),"maxzoom"in ke&&n(10,U=ke.maxzoom),"hoverCursor"in ke&&n(11,ee=ke.hoverCursor),"manageHoverState"in ke&&n(12,ie=ke.manageHoverState),"hovered"in ke&&n(0,se=ke.hovered),"eventsIfTopMost"in ke&&n(13,Q=ke.eventsIfTopMost),"interactive"in ke&&n(14,Y=ke.interactive),"$$scope"in ke&&n(23,a=ke.$$scope)},[se,h,m,l,x,S,T,C,N,B,U,ee,ie,Q,Y,s,_e,ve,Ae,ce,xe,be,Le,a]}class mc extends fn{constructor(e){super(),hn(this,e,cI,uI,an,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function hI(r,e,n){let s;const{map:a}=pc();zt(r,a,x=>n(4,s=x));let{position:h="top-left"}=e,{container:m=void 0}=e,l=null;return vo(()=>{s!=null&&s.loaded()&&l&&s.removeControl(l)}),r.$$set=x=>{"position"in x&&n(1,h=x.position),"container"in x&&n(2,m=x.container)},r.$$.update=()=>{if(r.$$.dirty&30&&s&&!l){let x;typeof m=="string"?x=document.querySelector(m)??void 0:x=m,n(3,l=new Cs.FullscreenControl({container:x})),s.addControl(l,h)}},[a,h,m,l,s]}class fI extends fn{constructor(e){super(),hn(this,e,hI,null,an,{position:1,container:2})}}function Hv(r,e,n,s,a){let h=!1;r.getSource(e)&&(h=!0,r.removeSource(e));const m=()=>{s(e)&&(r.addSource(e,n),a())};if(h){const l=()=>{e&&(r.getSource(e)?setTimeout(l,1):m())};l()}else m()}function Xv(r,e,n){ix().then(()=>{let s=Df(r);if(!s)return;s.getSource(e)===n&&s.removeSource(e)})}function ey(r){let e=r[0],n,s,a=ty(r);return{c(){a.c(),n=ii()},m(h,m){a.m(h,m),ae(h,n,m),s=!0},p(h,m){m&1&&an(e,e=h[0])?(zn(),Se(a,1,1,tt),Fn(),a=ty(h),a.c(),ge(a,1),a.m(n.parentNode,n)):a.p(h,m)},i(h){s||(ge(a),s=!0)},o(h){Se(a),s=!1},d(h){h&&oe(n),a.d(h)}}}function ty(r){let e;const n=r[19].default,s=Zi(n,r,r[18],null);return{c(){s&&s.c()},m(a,h){s&&s.m(a,h),e=!0},p(a,h){s&&s.p&&(!e||h&262144)&&Xi(s,n,a,a[18],e?Hi(n,a[18],h,null):Wi(a[18]),null)},i(a){e||(ge(s,a),e=!0)},o(a){Se(s,a),e=!1},d(a){s&&s.d(a)}}}function dI(r){let e,n,s=r[0]&&ey(r);return{c(){s&&s.c(),e=ii()},m(a,h){s&&s.m(a,h),ae(a,e,h),n=!0},p(a,[h]){a[0]?s?(s.p(a,h),h&1&&ge(s,1)):(s=ey(a),s.c(),ge(s,1),s.m(e.parentNode,e)):s&&(zn(),Se(s,1,1,()=>{s=null}),Fn())},i(a){n||(ge(s),n=!0)},o(a){Se(s),n=!1},d(a){a&&oe(e),s&&s.d(a)}}}function pI(r,e,n){let s,a,h,{$$slots:m={},$$scope:l}=e,{id:x=dc("geojson")}=e,{data:S}=e,{generateId:T=!1}=e,{promoteId:C=void 0}=e,{filter:N=void 0}=e,{lineMetrics:B=void 0}=e,{cluster:U=void 0}=e,{maxzoom:ee=void 0}=e,{attribution:ie=void 0}=e,{buffer:se=void 0}=e,{tolerance:Q=void 0}=e;const{map:Y,cluster:_e,self:ve}=Zv();zt(r,Y,xe=>n(17,a=xe)),zt(r,_e,xe=>n(20,h=xe)),zt(r,ve,xe=>n(0,s=xe));let Ae,ce=!0;return vo(()=>{s&&Ae&&a&&(Xv(Y,s,Ae),Dn(ve,s=null,s),n(15,Ae=void 0))}),r.$$set=xe=>{"id"in xe&&n(4,x=xe.id),"data"in xe&&n(5,S=xe.data),"generateId"in xe&&n(6,T=xe.generateId),"promoteId"in xe&&n(7,C=xe.promoteId),"filter"in xe&&n(8,N=xe.filter),"lineMetrics"in xe&&n(9,B=xe.lineMetrics),"cluster"in xe&&n(10,U=xe.cluster),"maxzoom"in xe&&n(11,ee=xe.maxzoom),"attribution"in xe&&n(12,ie=xe.attribution),"buffer"in xe&&n(13,se=xe.buffer),"tolerance"in xe&&n(14,Q=xe.tolerance),"$$scope"in xe&&n(18,l=xe.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&Dn(_e,h=U,h),r.$$.dirty&196593&&a&&s!==x&&(Dn(ve,s=x,s),Hv(a,s,Rh({type:"geojson",data:S,filter:N,lineMetrics:B,generateId:T,promoteId:C,cluster:!!U,clusterMinPoints:U==null?void 0:U.minPoints,clusterMaxZoom:U==null?void 0:U.maxZoom,clusterRadius:U==null?void 0:U.radius,clusterProperties:U==null?void 0:U.properties,maxzoom:ee,attribution:ie,buffer:se,tolerance:Q}),xe=>a&&xe===s,()=>{s&&(n(15,Ae=a==null?void 0:a.getSource(s)),n(16,ce=!0))})),r.$$.dirty&131088&&(a==null||a.on("style.load",()=>{n(15,Ae=a==null?void 0:a.getSource(x))})),r.$$.dirty&98336&&Ae&&(ce?n(16,ce=!1):Ae.setData(S)),r.$$.dirty&33792&&(Ae==null||Ae.setClusterOptions(Rh({cluster:!!U,clusterMaxZoom:U==null?void 0:U.maxZoom,clusterRadius:U==null?void 0:U.radius})))},[s,Y,_e,ve,x,S,T,C,N,B,U,ee,ie,se,Q,Ae,ce,a,l,m]}class rr extends fn{constructor(e){super(),hn(this,e,pI,dI,an,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}}function mI(r,e,n){let s;const{map:a}=pc();zt(r,a,N=>n(8,s=N));let{position:h="top-left"}=e,{positionOptions:m=void 0}=e,{fitBoundsOptions:l=void 0}=e,{trackUserLocation:x=!1}=e,{showAccuracyCircle:S=!0}=e,{showUserLocation:T=!0}=e,{control:C=null}=e;return vo(()=>{s!=null&&s.loaded()&&C&&s.removeControl(C)}),r.$$set=N=>{"position"in N&&n(2,h=N.position),"positionOptions"in N&&n(3,m=N.positionOptions),"fitBoundsOptions"in N&&n(4,l=N.fitBoundsOptions),"trackUserLocation"in N&&n(5,x=N.trackUserLocation),"showAccuracyCircle"in N&&n(6,S=N.showAccuracyCircle),"showUserLocation"in N&&n(7,T=N.showUserLocation),"control"in N&&n(1,C=N.control)},r.$$.update=()=>{r.$$.dirty&510&&s&&!C&&(n(1,C=new Cs.GeolocateControl({positionOptions:m,fitBoundsOptions:l,trackUserLocation:x,showAccuracyCircle:S,showUserLocation:T})),s.addControl(C,h))},[a,C,h,m,l,x,S,T,s]}class gI extends fn{constructor(e){super(),hn(this,e,mI,null,an,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function _I(r){let e;const n=r[15].default,s=Zi(n,r,r[23],null);return{c(){s&&s.c()},m(a,h){s&&s.m(a,h),e=!0},p(a,h){s&&s.p&&(!e||h&8388608)&&Xi(s,n,a,a[23],e?Hi(n,a[23],h,null):Wi(a[23]),null)},i(a){e||(ge(s,a),e=!0)},o(a){Se(s,a),e=!1},d(a){s&&s.d(a)}}}function yI(r){let e,n,s;function a(m){r[16](m)}let h={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[_I]},$$scope:{ctx:r}};return r[0]!==void 0&&(h.hovered=r[0]),e=new $p({props:h}),$n.push(()=>gr(e,"hovered",a)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ot(e.$$.fragment)},m(m,l){it(e,m,l),s=!0},p(m,[l]){const x={};l&2&&(x.id=m[1]),l&4&&(x.source=m[2]),l&8&&(x.sourceLayer=m[3]),l&16&&(x.beforeId=m[4]),l&32&&(x.beforeLayerType=m[5]),l&64&&(x.paint=m[6]),l&128&&(x.layout=m[7]),l&256&&(x.filter=m[8]),l&512&&(x.minzoom=m[9]),l&1024&&(x.maxzoom=m[10]),l&2048&&(x.hoverCursor=m[11]),l&4096&&(x.manageHoverState=m[12]),l&8192&&(x.eventsIfTopMost=m[13]),l&16384&&(x.interactive=m[14]),l&8388608&&(x.$$scope={dirty:l,ctx:m}),!n&&l&1&&(n=!0,x.hovered=m[0],mr(()=>n=!1)),e.$set(x)},i(m){s||(ge(e.$$.fragment,m),s=!0)},o(m){Se(e.$$.fragment,m),s=!1},d(m){rt(e,m)}}}function vI(r,e,n){let{$$slots:s={},$$scope:a}=e,{id:h=dc("line")}=e,{source:m=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:x=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:T}=e,{layout:C=void 0}=e,{filter:N=void 0}=e,{minzoom:B=void 0}=e,{maxzoom:U=void 0}=e,{hoverCursor:ee=void 0}=e,{manageHoverState:ie=!1}=e,{hovered:se=null}=e,{eventsIfTopMost:Q=!1}=e,{interactive:Y=!0}=e;function _e(ke){se=ke,n(0,se)}function ve(ke){ur.call(this,r,ke)}function Ae(ke){ur.call(this,r,ke)}function ce(ke){ur.call(this,r,ke)}function xe(ke){ur.call(this,r,ke)}function be(ke){ur.call(this,r,ke)}function Le(ke){ur.call(this,r,ke)}return r.$$set=ke=>{"id"in ke&&n(1,h=ke.id),"source"in ke&&n(2,m=ke.source),"sourceLayer"in ke&&n(3,l=ke.sourceLayer),"beforeId"in ke&&n(4,x=ke.beforeId),"beforeLayerType"in ke&&n(5,S=ke.beforeLayerType),"paint"in ke&&n(6,T=ke.paint),"layout"in ke&&n(7,C=ke.layout),"filter"in ke&&n(8,N=ke.filter),"minzoom"in ke&&n(9,B=ke.minzoom),"maxzoom"in ke&&n(10,U=ke.maxzoom),"hoverCursor"in ke&&n(11,ee=ke.hoverCursor),"manageHoverState"in ke&&n(12,ie=ke.manageHoverState),"hovered"in ke&&n(0,se=ke.hovered),"eventsIfTopMost"in ke&&n(13,Q=ke.eventsIfTopMost),"interactive"in ke&&n(14,Y=ke.interactive),"$$scope"in ke&&n(23,a=ke.$$scope)},[se,h,m,l,x,S,T,C,N,B,U,ee,ie,Q,Y,s,_e,ve,Ae,ce,xe,be,Le,a]}class _r extends fn{constructor(e){super(),hn(this,e,vI,yI,an,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function bI(r,e,n){let s;const a=hc();let{layer:h=void 0}=e;const{map:m}=pc();zt(r,m,T=>n(2,s=T));function l(T){a(T.type,{...T,map:m})}const x=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],S=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return vo(()=>{if(s)if(h)for(const T of x)s.off(T,h,l);else for(const T of S)s.off(T,l)}),r.$$set=T=>{"layer"in T&&n(1,h=T.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&s)if(h)for(const T of x)s.on(T,h,l);else for(const T of S)s.on(T,l)},[m,h,s]}class Wv extends fn{constructor(e){super(),hn(this,e,bI,null,an,{layer:1})}}function xI(r){let e=r.getCenter(),n=Math.round(r.getZoom()*100)/100,s=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,s),h=Math.round(e.lat*a)/a,m=Math.round(e.lng*a)/a,l=`${n}/${h}/${m}`,x=r.getBearing(),S=r.getPitch();return(x||S)&&(l+=`/${Math.round(x*10)/10}`),S&&(l+=`/${Math.round(S)}`),`#${l}`}function wI(r){return r.replace("#","").split("/").map(parseFloat)}function kI(r,e,n){let s;const{map:a}=pc();zt(r,a,T=>n(6,s=T));let{position:h="top-left"}=e,{showCompass:m=!0}=e,{showZoom:l=!0}=e,{visualizePitch:x=!1}=e,S=null;return vo(()=>{s!=null&&s.loaded()&&S&&s.removeControl(S)}),r.$$set=T=>{"position"in T&&n(1,h=T.position),"showCompass"in T&&n(2,m=T.showCompass),"showZoom"in T&&n(3,l=T.showZoom),"visualizePitch"in T&&n(4,x=T.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&s&&!S&&(n(5,S=new Cs.NavigationControl({showCompass:m,showZoom:l,visualizePitch:x})),s.addControl(S,h))},[a,h,m,l,x,S,s]}class II extends fn{constructor(e){super(),hn(this,e,kI,null,an,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function SI(r,e,n){let s;const{map:a}=pc();zt(r,a,S=>n(5,s=S));let{position:h="bottom-left"}=e,{maxWidth:m=void 0}=e,{unit:l="metric"}=e,x=null;return vo(()=>{s!=null&&s.loaded()&&x&&s.removeControl(x)}),r.$$set=S=>{"position"in S&&n(1,h=S.position),"maxWidth"in S&&n(2,m=S.maxWidth),"unit"in S&&n(3,l=S.unit)},r.$$.update=()=>{r.$$.dirty&62&&s&&!x&&(n(4,x=new Cs.ScaleControl({maxWidth:m,unit:l})),s.addControl(x,h))},[a,h,m,l,x,s]}class EI extends fn{constructor(e){super(),hn(this,e,SI,null,an,{position:1,maxWidth:2,unit:3})}}const{window:AI}=J0,TI=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),ny=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function iy(r){let e,n,s=r[3]&&ry(r);const a=r[46].default,h=Zi(a,r,r[45],ny);return{c(){s&&s.c(),e=Oe(),h&&h.c()},m(m,l){s&&s.m(m,l),ae(m,e,l),h&&h.m(m,l),n=!0},p(m,l){m[3]?s?(s.p(m,l),l[0]&8&&ge(s,1)):(s=ry(m),s.c(),ge(s,1),s.m(e.parentNode,e)):s&&(zn(),Se(s,1,1,()=>{s=null}),Fn()),h&&h.p&&(!n||l[0]&112|l[1]&16384)&&Xi(h,a,m,m[45],n?Hi(a,m[45],l,TI):Wi(m[45]),ny)},i(m){n||(ge(s),ge(h,m),n=!0)},o(m){Se(s),Se(h,m),n=!1},d(m){m&&oe(e),s&&s.d(m),h&&h.d(m)}}}function ry(r){let e,n,s,a,h,m,l,x;return e=new II({props:{position:r[7]}}),s=new gI({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),h=new fI({props:{position:r[7]}}),l=new EI({props:{position:r[7]}}),{c(){ot(e.$$.fragment),n=Oe(),ot(s.$$.fragment),a=Oe(),ot(h.$$.fragment),m=Oe(),ot(l.$$.fragment)},m(S,T){it(e,S,T),ae(S,n,T),it(s,S,T),ae(S,a,T),it(h,S,T),ae(S,m,T),it(l,S,T),x=!0},p(S,T){const C={};T[0]&128&&(C.position=S[7]),e.$set(C);const N={};T[0]&128&&(N.position=S[7]),s.$set(N);const B={};T[0]&128&&(B.position=S[7]),h.$set(B);const U={};T[0]&128&&(U.position=S[7]),l.$set(U)},i(S){x||(ge(e.$$.fragment,S),ge(s.$$.fragment,S),ge(h.$$.fragment,S),ge(l.$$.fragment,S),x=!0)},o(S){Se(e.$$.fragment,S),Se(s.$$.fragment,S),Se(h.$$.fragment,S),Se(l.$$.fragment,S),x=!1},d(S){S&&(oe(n),oe(a),oe(m)),rt(e,S),rt(s,S),rt(h,S),rt(l,S)}}}function CI(r){let e,n,s,a,h,m=r[4]&&r[0]&&iy(r);return{c(){e=le("div"),m&&m.c(),Ze(e,"class",n=Nf(r[2])+" svelte-p00lfq"),Ze(e,"data-testid","map-container"),Sr(e,"expand-map",!r[2])},m(l,x){ae(l,e,x),m&&m.m(e,null),r[47](e),s=!0,a||(h=[Rt(AI,"hashchange",r[11]),dp(r[10].call(null,e))],a=!0)},p(l,x){l[4]&&l[0]?m?(m.p(l,x),x[0]&17&&ge(m,1)):(m=iy(l),m.c(),ge(m,1),m.m(e,null)):m&&(zn(),Se(m,1,1,()=>{m=null}),Fn()),(!s||x[0]&4&&n!==(n=Nf(l[2])+" svelte-p00lfq"))&&Ze(e,"class",n),(!s||x[0]&4)&&Sr(e,"expand-map",!l[2])},i(l){s||(ge(m),s=!0)},o(l){Se(m),s=!1},d(l){l&&oe(e),m&&m.d(),r[47](null),a=!1,$i(h)}}}function LI(r,e,n){let s,a,h,m,{$$slots:l={},$$scope:x}=e,{map:S=null}=e,{mapContainer:T=void 0}=e,{class:C=void 0}=e,{style:N}=e,{diffStyleUpdates:B=!1}=e,{center:U=void 0}=e,{zoom:ee=void 0}=e,{pitch:ie=0}=e,{bearing:se=0}=e,{bounds:Q=void 0}=e,{hash:Y=!1}=e,{updateHash:_e=Ie=>{window.history.replaceState(window.history.state,"",Ie)}}=e,{loaded:ve=!1}=e,{minZoom:Ae=0}=e,{maxZoom:ce=22}=e,{minPitch:xe=0}=e,{maxPitch:be=60}=e,{renderWorldCopies:Le=void 0}=e,{dragPan:ke=void 0}=e,{dragRotate:ye=void 0}=e,{pitchWithRotate:Ue=void 0}=e,{antialias:qe=void 0}=e,{zoomOnDoubleClick:pt=!0}=e,{locale:St=void 0}=e,{interactive:dt=!0}=e,{attributionControl:ut=!0}=e,{cooperativeGestures:Ut=!1}=e,{preserveDrawingBuffer:vt=!1}=e,{maxBounds:kt=void 0}=e,{images:ft=[]}=e,{standardControls:wt=!1}=e,{filterLayers:It=void 0}=e,{transformRequest:$t=void 0}=e;const pn=hc(),{map:Pn,loadedImages:We}=Yk();zt(r,Pn,Ie=>n(4,h=Ie)),zt(r,We,Ie=>n(5,m=Ie));let Wn=new Set;async function dn(Ie,Bt=!1){if(h&&!(!h.loaded()&&!Bt))if("url"in Ie){Wn.add(Ie.id);try{let Mn=await h.loadImage(Ie.url);h==null||h.addImage(Ie.id,Mn.data,Ie.options),m.add(Ie.id),We.set(m)}catch(Mn){pn("error",Mn)}finally{Wn.delete(Ie.id)}}else h.addImage(Ie.id,Ie.data,Ie.options),m.add(Ie.id),We.set(m)}let Ot,Ee,lt,Ye;function Lt(Ie){return On(),Dn(Pn,h=new Cs.Map(Rh({container:Ie,style:N,locale:St,center:U,zoom:ee,pitch:ie,bearing:se,minZoom:Ae,maxZoom:ce,minPitch:xe,maxPitch:be,renderWorldCopies:Le,dragPan:ke,dragRotate:ye,pitchWithRotate:Ue,antialias:qe,interactive:dt,preserveDrawingBuffer:vt,maxBounds:kt,bounds:Q,attributionControl:ut,transformRequest:$t,cooperativeGestures:Ut})),h),h.on("load",Bt=>{Bt.target.getContainer().setAttribute("data-testid","map"),Bt.target.getCanvas().setAttribute("data-testid","map-canvas"),n(0,ve=!0),pn("load",h)}),h.on("error",Bt=>pn("error",{...Bt,map:h})),h.on("movestart",Bt=>pn("movestart",{...Bt,map:h})),h.on("moveend",Bt=>{if(n(12,U=Bt.target.getCenter()),n(13,ee=Bt.target.getZoom()),n(14,ie=Bt.target.getPitch()),n(15,se=Bt.target.getBearing()),n(16,Q=Bt.target.getBounds()),pn("moveend",{...Bt,map:h}),Y){let Mn=new URL(window.location.href.replace(/(#.+)?$/,xI(h)));_e(Mn)}}),h.on("click",Bt=>pn("click",{...Bt,map:h})),h.on("dblclick",Bt=>pn("dblclick",{...Bt,map:h})),h.on("contextmenu",Bt=>pn("contextmenu",{...Bt,map:h})),h.on("zoomstart",Bt=>pn("zoomstart",{...Bt,map:h})),h.on("zoom",Bt=>{pn("zoom",{...Bt,map:h})}),h.on("zoomend",Bt=>{pn("zoomend",{...Bt,map:h})}),h.on("style.load",()=>{if(h){const Bt=h.getStyle();if(n(42,Ot=Bt.layers.map(Mn=>Mn.id)),n(43,Ee=Object.keys(Bt.sources)),Ye)for(const[Mn,Nn]of Object.entries(Ye))h.addSource(Mn,Nn);if(lt)for(const Mn of lt)h.addLayer(Mn);for(const Mn of ft)dn(Mn,!0)}}),h.on("styledata",Bt=>{if(h&&It){const Mn=h.getStyle().layers;if(Mn)for(let Nn of Mn)It(Nn)||h.setLayoutProperty(Nn.id,"visibility","none")}pn("styledata",{...Bt,map:h})}),{destroy(){n(0,ve=!1),h==null||h.remove(),Dn(Pn,h=null,h)}}}let Ke=N;function On(){if(Y){let Ie=wI(window.location.hash);Ie.length>=3&&(n(13,ee=Ie[0]),n(12,U=[Ie[2],Ie[1]])),Ie.length==5&&(n(15,se=Ie[3]),n(14,ie=Ie[4]))}}function bt(Ie){$n[Ie?"unshift":"push"](()=>{T=Ie,n(1,T)})}return r.$$set=Ie=>{"map"in Ie&&n(17,S=Ie.map),"mapContainer"in Ie&&n(1,T=Ie.mapContainer),"class"in Ie&&n(2,C=Ie.class),"style"in Ie&&n(18,N=Ie.style),"diffStyleUpdates"in Ie&&n(19,B=Ie.diffStyleUpdates),"center"in Ie&&n(12,U=Ie.center),"zoom"in Ie&&n(13,ee=Ie.zoom),"pitch"in Ie&&n(14,ie=Ie.pitch),"bearing"in Ie&&n(15,se=Ie.bearing),"bounds"in Ie&&n(16,Q=Ie.bounds),"hash"in Ie&&n(20,Y=Ie.hash),"updateHash"in Ie&&n(21,_e=Ie.updateHash),"loaded"in Ie&&n(0,ve=Ie.loaded),"minZoom"in Ie&&n(22,Ae=Ie.minZoom),"maxZoom"in Ie&&n(23,ce=Ie.maxZoom),"minPitch"in Ie&&n(24,xe=Ie.minPitch),"maxPitch"in Ie&&n(25,be=Ie.maxPitch),"renderWorldCopies"in Ie&&n(26,Le=Ie.renderWorldCopies),"dragPan"in Ie&&n(27,ke=Ie.dragPan),"dragRotate"in Ie&&n(28,ye=Ie.dragRotate),"pitchWithRotate"in Ie&&n(29,Ue=Ie.pitchWithRotate),"antialias"in Ie&&n(30,qe=Ie.antialias),"zoomOnDoubleClick"in Ie&&n(31,pt=Ie.zoomOnDoubleClick),"locale"in Ie&&n(32,St=Ie.locale),"interactive"in Ie&&n(33,dt=Ie.interactive),"attributionControl"in Ie&&n(34,ut=Ie.attributionControl),"cooperativeGestures"in Ie&&n(35,Ut=Ie.cooperativeGestures),"preserveDrawingBuffer"in Ie&&n(36,vt=Ie.preserveDrawingBuffer),"maxBounds"in Ie&&n(37,kt=Ie.maxBounds),"images"in Ie&&n(38,ft=Ie.images),"standardControls"in Ie&&n(3,wt=Ie.standardControls),"filterLayers"in Ie&&n(39,It=Ie.filterLayers),"transformRequest"in Ie&&n(40,$t=Ie.transformRequest),"$$scope"in Ie&&n(45,x=Ie.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&n(7,s=typeof wt=="boolean"?void 0:wt),r.$$.dirty[0]&16&&n(17,S=h),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&h&&!Hu(N,Ke)){const Ie=h.getStyle();if(Ot&&(lt=Ie.layers.filter(Bt=>!Ot.includes(Bt.id))),Ee){const Bt=Object.keys(Ie.sources).filter(Mn=>!Ee.includes(Mn));Ye={};for(const Mn of Bt)Ye[Mn]=Ie.sources[Mn]}n(44,Ke=N),h.setStyle(N,{diff:B}),Dn(We,m=new Set,m),n(41,Wn=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&ve&&h!=null&&h.loaded())for(let Ie of ft)!m.has(Ie.id)&&!Wn.has(Ie.id)&&!h.hasImage(Ie.id)&&dn(Ie);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&n(6,a=ft.every(Ie=>m.has(Ie.id))),r.$$.dirty[0]&61456&&h){let Ie={};U!=null&&!Hu(U,h==null?void 0:h.getCenter())&&(Ie.center=U),ee!=null&&!Hu(ee,h==null?void 0:h.getZoom())&&(Ie.zoom=ee),se!=null&&!Hu(se,h==null?void 0:h.getBearing())&&(Ie.bearing=se),ie!=null&&!Hu(ie,h==null?void 0:h.getPitch())&&(Ie.pitch=ie),Object.keys(Ie).length&&h.easeTo(Ie)}r.$$.dirty[0]&65552&&Q&&!Hu(Q,h==null?void 0:h.getBounds())&&(h==null||h.fitBounds(Q)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(pt?h==null||h.doubleClickZoom.enable():h==null||h.doubleClickZoom.disable())},[ve,T,C,wt,h,m,a,s,Pn,We,Lt,On,U,ee,ie,se,Q,S,N,B,Y,_e,Ae,ce,xe,be,Le,ke,ye,Ue,qe,pt,St,dt,ut,Ut,vt,kt,ft,It,$t,Wn,Ot,Ee,Ke,x,l,bt]}class MI extends fn{constructor(e){super(),hn(this,e,LI,CI,an,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const RI=r=>({marker:r&8}),sy=r=>({marker:r[3]});function PI(r){let e,n,s,a,h,m,l;const x=r[19].default,S=Zi(x,r,r[18],sy);return{c(){e=le("div"),S&&S.c(),Ze(e,"tabindex",n=r[1]?0:void 0),Ze(e,"role",s=r[1]?"button":void 0),Rn(e,"z-index",r[2])},m(T,C){ae(T,e,C),S&&S.m(e,null),h=!0,m||(l=[dp(r[7].call(null,e)),dp(a=DI.call(null,e,r[0])),Rt(e,"click",tp(r[20])),Rt(e,"dblclick",tp(r[21])),Rt(e,"contextmenu",tp(Nh(r[22]))),Rt(e,"mouseenter",r[23]),Rt(e,"mouseleave",r[24]),Rt(e,"mousemove",r[25]),Rt(e,"keydown",r[8])],m=!0)},p(T,[C]){S&&S.p&&(!h||C&262152)&&Xi(S,x,T,T[18],h?Hi(x,T[18],C,RI):Wi(T[18]),sy),(!h||C&2&&n!==(n=T[1]?0:void 0))&&Ze(e,"tabindex",n),(!h||C&2&&s!==(s=T[1]?"button":void 0))&&Ze(e,"role",s),a&&iu(a.update)&&C&1&&a.update.call(null,T[0]),C&4&&Rn(e,"z-index",T[2])},i(T){h||(ge(S,T),h=!0)},o(T){Se(S,T),h=!1},d(T){T&&oe(e),S&&S.d(T),m=!1,$i(l)}}}function DI(r,e){const n=r.className;function s(a){a?r.className=`${n} ${a}`:r.className=n}return s(e),{update:s}}function NI(r,e,n){let s,a,h,{$$slots:m={},$$scope:l}=e,{marker:x=void 0}=e,{lngLat:S}=e,{class:T=void 0}=e,{interactive:C=!0}=e,{asButton:N=!1}=e,{draggable:B=!1}=e,{feature:U=null}=e,{offset:ee=void 0}=e,{zIndex:ie=void 0}=e,{rotation:se=0}=e,{opacity:Q=1}=e;const Y=hc(),{map:_e,layerEvent:ve,self:Ae,markerClickManager:ce}=Qk();zt(r,_e,ut=>n(27,h=ut)),zt(r,ve,ut=>n(26,s=ut)),zt(r,Ae,ut=>n(3,a=ut));function xe(ut){Dn(Ae,a=new Cs.Marker({element:ut,rotation:se,draggable:B,offset:ee,opacity:Q.toString()}).setLngLat(S).addTo(h),a),n(11,x=a);const Ut=()=>ke("dragstart"),vt=()=>{be(),ke("drag")},kt=()=>{be(),ke("dragend")};return B&&(a.on("dragstart",Ut),a.on("drag",vt),a.on("dragend",kt)),{destroy(){B&&(a==null||a.off("dragstart",Ut),a==null||a.off("drag",vt),a==null||a.off("dragend",kt)),n(11,x=void 0),a==null||a.remove()}}}function be(){let ut=a==null?void 0:a.getLngLat();ut&&(Array.isArray(S)?n(10,S=[ut.lng,ut.lat]):S&&"lon"in S?n(10,S={lon:ut.lng,lat:ut.lat}):n(10,S=ut))}function Le(ut){ut.key===" "&&(ut.preventDefault(),ut.stopPropagation(),ke("click"))}function ke(ut){if(!C)return;let Ut=a==null?void 0:a.getLngLat();if(!Ut)return;const vt=[Ut.lng,Ut.lat];let kt={map:h,marker:a,lngLat:vt,features:[{type:"Feature",properties:(U==null?void 0:U.properties)??{},geometry:{type:"Point",coordinates:vt}}]};(ut==="click"||ut==="contextmenu")&&ce.handleClick(kt),Dn(ve,s={...kt,layerType:"marker",type:ut},s),Y(ut,kt)}const ye=()=>ke("click"),Ue=()=>ke("dblclick"),qe=()=>{ke("contextmenu")},pt=()=>{ke("mouseenter")},St=()=>{ke("mouseleave")},dt=()=>ke("mousemove");return r.$$set=ut=>{"marker"in ut&&n(11,x=ut.marker),"lngLat"in ut&&n(10,S=ut.lngLat),"class"in ut&&n(0,T=ut.class),"interactive"in ut&&n(12,C=ut.interactive),"asButton"in ut&&n(1,N=ut.asButton),"draggable"in ut&&n(13,B=ut.draggable),"feature"in ut&&n(14,U=ut.feature),"offset"in ut&&n(15,ee=ut.offset),"zIndex"in ut&&n(2,ie=ut.zIndex),"rotation"in ut&&n(16,se=ut.rotation),"opacity"in ut&&n(17,Q=ut.opacity),"$$scope"in ut&&n(18,l=ut.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(a==null||a.setLngLat(S)),r.$$.dirty&32776&&(a==null||a.setOffset(ee??[0,0])),r.$$.dirty&65544&&(a==null||a.setRotation(se)),r.$$.dirty&131080&&(a==null||a.setOpacity(Q.toString()))},[T,N,ie,a,_e,ve,Ae,xe,Le,ke,S,x,C,B,U,ee,se,Q,l,m,ye,Ue,qe,pt,St,dt]}class Zf extends fn{constructor(e){super(),hn(this,e,NI,PI,an,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}function oy(r){let e=r[0],n,s,a=ay(r);return{c(){a.c(),n=ii()},m(h,m){a.m(h,m),ae(h,n,m),s=!0},p(h,m){m&1&&an(e,e=h[0])?(zn(),Se(a,1,1,tt),Fn(),a=ay(h),a.c(),ge(a,1),a.m(n.parentNode,n)):a.p(h,m)},i(h){s||(ge(a),s=!0)},o(h){Se(a),s=!1},d(h){h&&oe(n),a.d(h)}}}function ay(r){let e;const n=r[15].default,s=Zi(n,r,r[14],null);return{c(){s&&s.c()},m(a,h){s&&s.m(a,h),e=!0},p(a,h){s&&s.p&&(!e||h&16384)&&Xi(s,n,a,a[14],e?Hi(n,a[14],h,null):Wi(a[14]),null)},i(a){e||(ge(s,a),e=!0)},o(a){Se(s,a),e=!1},d(a){s&&s.d(a)}}}function zI(r){let e,n,s=r[0]&&oy(r);return{c(){s&&s.c(),e=ii()},m(a,h){s&&s.m(a,h),ae(a,e,h),n=!0},p(a,[h]){a[0]?s?(s.p(a,h),h&1&&ge(s,1)):(s=oy(a),s.c(),ge(s,1),s.m(e.parentNode,e)):s&&(zn(),Se(s,1,1,()=>{s=null}),Fn())},i(a){n||(ge(s),n=!0)},o(a){Se(s),n=!1},d(a){a&&oe(e),s&&s.d(a)}}}function FI(r,e,n){let s,a,{$$slots:h={},$$scope:m}=e,{id:l=dc("vector")}=e,{url:x=null}=e,{tiles:S=null}=e,{promoteId:T=null}=e,{bounds:C=null}=e,{scheme:N=null}=e,{attribution:B=null}=e,{minzoom:U=null}=e,{maxzoom:ee=null}=e,{volatile:ie=null}=e;if(x&&x.includes("pmtiles://")&&!Cs.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let _e=new Mk;Cs.addProtocol("pmtiles",_e.tile)}const{map:se,self:Q}=Zv();zt(r,se,_e=>n(13,a=_e)),zt(r,Q,_e=>n(0,s=_e));let Y;return vo(()=>{s&&a&&(Xv(se,s,Y),Dn(Q,s=null,s),Y=void 0)}),r.$$set=_e=>{"id"in _e&&n(3,l=_e.id),"url"in _e&&n(4,x=_e.url),"tiles"in _e&&n(5,S=_e.tiles),"promoteId"in _e&&n(6,T=_e.promoteId),"bounds"in _e&&n(7,C=_e.bounds),"scheme"in _e&&n(8,N=_e.scheme),"attribution"in _e&&n(9,B=_e.attribution),"minzoom"in _e&&n(10,U=_e.minzoom),"maxzoom"in _e&&n(11,ee=_e.maxzoom),"volatile"in _e&&n(12,ie=_e.volatile),"$$scope"in _e&&n(14,m=_e.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&a&&s!==l&&(Dn(Q,s=l,s),Hv(a,s,Rh({type:"vector",url:x,tiles:S,promoteId:T,bounds:C,scheme:N,attribution:B,minzoom:U,maxzoom:ee,volatile:ie}),_e=>a&&_e===s,()=>{s&&(Y=a==null?void 0:a.getSource(s))})),r.$$.dirty&8200&&(a==null||a.on("style.load",()=>{Y=a==null?void 0:a.getSource(l)}))},[s,se,Q,l,x,S,T,C,N,B,U,ee,ie,a,m,h]}class Jp extends fn{constructor(e){super(),hn(this,e,FI,zI,an,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const OI=r=>({}),ly=r=>({}),BI=r=>({}),uy=r=>({}),UI=r=>({}),cy=r=>({}),jI=r=>({}),hy=r=>({});function qI(r){let e,n,s,a,h,m,l,x,S;const T=r[1].top,C=Zi(T,r,r[0],hy),N=r[1].left,B=Zi(N,r,r[0],cy),U=r[1].main,ee=Zi(U,r,r[0],uy),ie=r[1].right,se=Zi(ie,r,r[0],ly);return{c(){e=le("div"),C&&C.c(),n=Oe(),s=le("div"),a=le("div"),B&&B.c(),h=Oe(),m=le("div"),ee&&ee.c(),l=Oe(),x=le("div"),se&&se.c(),Ze(e,"class","top svelte-11kzs8g"),Ze(a,"class","left svelte-11kzs8g"),Ze(m,"class","main svelte-11kzs8g"),Ze(x,"class","right svelte-11kzs8g"),Ze(s,"class","main-row svelte-11kzs8g")},m(Q,Y){ae(Q,e,Y),C&&C.m(e,null),ae(Q,n,Y),ae(Q,s,Y),Z(s,a),B&&B.m(a,null),Z(s,h),Z(s,m),ee&&ee.m(m,null),Z(s,l),Z(s,x),se&&se.m(x,null),S=!0},p(Q,[Y]){C&&C.p&&(!S||Y&1)&&Xi(C,T,Q,Q[0],S?Hi(T,Q[0],Y,jI):Wi(Q[0]),hy),B&&B.p&&(!S||Y&1)&&Xi(B,N,Q,Q[0],S?Hi(N,Q[0],Y,UI):Wi(Q[0]),cy),ee&&ee.p&&(!S||Y&1)&&Xi(ee,U,Q,Q[0],S?Hi(U,Q[0],Y,BI):Wi(Q[0]),uy),se&&se.p&&(!S||Y&1)&&Xi(se,ie,Q,Q[0],S?Hi(ie,Q[0],Y,OI):Wi(Q[0]),ly)},i(Q){S||(ge(C,Q),ge(B,Q),ge(ee,Q),ge(se,Q),S=!0)},o(Q){Se(C,Q),Se(B,Q),Se(ee,Q),Se(se,Q),S=!1},d(Q){Q&&(oe(e),oe(n),oe(s)),C&&C.d(Q),B&&B.d(Q),ee&&ee.d(Q),se&&se.d(Q)}}}function VI(r,e,n){let{$$slots:s={},$$scope:a}=e;return r.$$set=h=>{"$$scope"in h&&n(0,a=h.$$scope)},[a,s]}class GI extends fn{constructor(e){super(),hn(this,e,VI,qI,an,{})}}const ZI=r=>({}),fy=r=>({}),HI=r=>({}),dy=r=>({}),XI=r=>({}),py=r=>({});function WI(r){let e,n,s,a,h,m;const l=r[4].left,x=Zi(l,r,r[3],py),S=r[4].map,T=Zi(S,r,r[3],dy),C=r[4].right,N=Zi(C,r,r[3],fy);return{c(){e=le("div"),x&&x.c(),n=Oe(),s=le("div"),T&&T.c(),a=Oe(),h=le("div"),N&&N.c()},m(B,U){ae(B,e,U),x&&x.m(e,null),r[5](e),ae(B,n,U),ae(B,s,U),T&&T.m(s,null),r[6](s),ae(B,a,U),ae(B,h,U),N&&N.m(h,null),r[7](h),m=!0},p(B,[U]){x&&x.p&&(!m||U&8)&&Xi(x,l,B,B[3],m?Hi(l,B[3],U,XI):Wi(B[3]),py),T&&T.p&&(!m||U&8)&&Xi(T,S,B,B[3],m?Hi(S,B[3],U,HI):Wi(B[3]),dy),N&&N.p&&(!m||U&8)&&Xi(N,C,B,B[3],m?Hi(C,B[3],U,ZI):Wi(B[3]),fy)},i(B){m||(ge(x,B),ge(T,B),ge(N,B),m=!0)},o(B){Se(x,B),Se(T,B),Se(N,B),m=!1},d(B){B&&(oe(e),oe(n),oe(s),oe(a),oe(h)),x&&x.d(B),r[5](null),T&&T.d(B),r[6](null),N&&N.d(B),r[7](null)}}}function KI(r,e,n){let s,a,h;zt(r,Mp,C=>n(0,s=C)),zt(r,Pp,C=>n(1,a=C)),zt(r,Rp,C=>n(2,h=C));let{$$slots:m={},$$scope:l}=e;function x(C){$n[C?"unshift":"push"](()=>{s=C,Mp.set(s)})}function S(C){$n[C?"unshift":"push"](()=>{a=C,Pp.set(a)})}function T(C){$n[C?"unshift":"push"](()=>{h=C,Rp.set(h)})}return r.$$set=C=>{"$$scope"in C&&n(3,l=C.$$scope)},[s,a,h,l,m,x,S,T]}class gc extends fn{constructor(e){super(),hn(this,e,KI,WI,an,{})}}let Mp=Jn(null),Rp=Jn(null),Pp=Jn(null);function my(r){let e,n;return{c(){e=le("div"),n=ze(r[0]),Ze(e,"class","svelte-1uuov7f")},m(s,a){ae(s,e,a),Z(e,n)},p(s,a){a&1&&Ct(n,s[0])},d(s){s&&oe(e)}}}function $I(r){let e,n=r[0]&&my(r);return{c(){n&&n.c(),e=ii()},m(s,a){n&&n.m(s,a),ae(s,e,a)},p(s,[a]){s[0]?n?n.p(s,a):(n=my(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:tt,o:tt,d(s){s&&oe(e),n&&n.d(s)}}}function YI(r,e,n){let{loading:s}=e;return r.$$set=a=>{"loading"in a&&n(0,s=a.loading)},[s]}class JI extends fn{constructor(e){super(),hn(this,e,YI,$I,an,{loading:0})}}const QI=r=>({dialog:r&1}),gy=r=>({dialog:r[0]});function eS(r){let e,n,s,a,h;const m=r[4].default,l=Zi(m,r,r[3],gy);return{c(){e=le("dialog"),n=le("article"),l&&l.c(),e.open=!0},m(x,S){ae(x,e,S),Z(e,n),l&&l.m(n,null),r[6](e),s=!0,a||(h=[Rt(window,"click",r[1]),Rt(window,"keydown",r[2]),Rt(e,"close",r[5])],a=!0)},p(x,[S]){l&&l.p&&(!s||S&9)&&Xi(l,m,x,x[3],s?Hi(m,x[3],S,QI):Wi(x[3]),gy)},i(x){s||(ge(l,x),s=!0)},o(x){Se(l,x),s=!1},d(x){x&&oe(e),l&&l.d(x),r[6](null),a=!1,$i(h)}}}function tS(r,e,n){let{$$slots:s={},$$scope:a}=e,h;function m(T){h.open&&T.target==h&&h.close()}function l(T){(T.key=="Escape"||T.key=="Enter")&&(T.stopPropagation(),h.close())}function x(T){ur.call(this,r,T)}function S(T){$n[T?"unshift":"push"](()=>{h=T,n(0,h)})}return r.$$set=T=>{"$$scope"in T&&n(3,a=T.$$scope)},[h,m,l,a,s,x,S]}class Kv extends fn{constructor(e){super(),hn(this,e,tS,eS,an,{})}}function _y(r,e,n){const s=r.slice();return s[1]=e[n][0],s[2]=e[n][1],s}function yy(r){let e,n,s=r[1]+"",a,h,m,l=r[2]+"",x,S;return{c(){e=le("tr"),n=le("td"),a=ze(s),h=Oe(),m=le("td"),x=ze(l),S=Oe()},m(T,C){ae(T,e,C),Z(e,n),Z(n,a),Z(e,h),Z(e,m),Z(m,x),Z(e,S)},p(T,C){C&1&&s!==(s=T[1]+"")&&Ct(a,s),C&1&&l!==(l=T[2]+"")&&Ct(x,l)},d(T){T&&oe(e)}}}function nS(r){let e,n,s=Vn(Object.entries(r[0])),a=[];for(let h=0;h<s.length;h+=1)a[h]=yy(_y(r,s,h));return{c(){e=le("table"),n=le("tbody");for(let h=0;h<a.length;h+=1)a[h].c();Ze(e,"class","svelte-lh2o9l")},m(h,m){ae(h,e,m),Z(e,n);for(let l=0;l<a.length;l+=1)a[l]&&a[l].m(n,null)},p(h,[m]){if(m&1){s=Vn(Object.entries(h[0]));let l;for(l=0;l<s.length;l+=1){const x=_y(h,s,l);a[l]?a[l].p(x,m):(a[l]=yy(x),a[l].c(),a[l].m(n,null))}for(;l<a.length;l+=1)a[l].d(1);a.length=s.length}},i:tt,o:tt,d(h){h&&oe(e),Er(a,h)}}}function iS(r,e,n){let{properties:s}=e;return r.$$set=a=>{"properties"in a&&n(0,s=a.properties)},[s]}class rS extends fn{constructor(e){super(),hn(this,e,iS,nS,an,{properties:0})}}function vy(r,e,n){const s=r.slice();return s[3]=e[n],s}function by(r,e,n){const s=r.slice();return s[6]=e[n],s}function xy(r){let e,n;return{c(){e=le("span"),n=ze(` 
    `),Rn(e,"background",r[6]),Rn(e,"width","100%"),Rn(e,"border","1px solid black")},m(s,a){ae(s,e,a),Z(e,n)},p(s,a){a&1&&Rn(e,"background",s[6])},d(s){s&&oe(e)}}}function sS(r){let e,n=r[3]+"",s;return{c(){e=le("span"),s=ze(n)},m(a,h){ae(a,e,h),Z(e,s)},p(a,h){h&2&&n!==(n=a[3]+"")&&Ct(s,n)},d(a){a&&oe(e)}}}function oS(r){let e,n=r[3].toFixed(r[2])+"",s;return{c(){e=le("span"),s=ze(n)},m(a,h){ae(a,e,h),Z(e,s)},p(a,h){h&6&&n!==(n=a[3].toFixed(a[2])+"")&&Ct(s,n)},d(a){a&&oe(e)}}}function wy(r){let e;function n(h,m){return h[2]>0?oS:sS}let s=n(r),a=s(r);return{c(){a.c(),e=ii()},m(h,m){a.m(h,m),ae(h,e,m)},p(h,m){s===(s=n(h))&&a?a.p(h,m):(a.d(1),a=s(h),a&&(a.c(),a.m(e.parentNode,e)))},d(h){h&&oe(e),a.d(h)}}}function aS(r){let e,n,s,a=Vn(r[0]),h=[];for(let x=0;x<a.length;x+=1)h[x]=xy(by(r,a,x));let m=Vn(r[1]),l=[];for(let x=0;x<m.length;x+=1)l[x]=wy(vy(r,m,x));return{c(){e=le("div");for(let x=0;x<h.length;x+=1)h[x].c();n=Oe(),s=le("div");for(let x=0;x<l.length;x+=1)l[x].c();Rn(e,"display","flex"),Rn(s,"display","flex"),Rn(s,"justify-content","space-between")},m(x,S){ae(x,e,S);for(let T=0;T<h.length;T+=1)h[T]&&h[T].m(e,null);ae(x,n,S),ae(x,s,S);for(let T=0;T<l.length;T+=1)l[T]&&l[T].m(s,null)},p(x,[S]){if(S&1){a=Vn(x[0]);let T;for(T=0;T<a.length;T+=1){const C=by(x,a,T);h[T]?h[T].p(C,S):(h[T]=xy(C),h[T].c(),h[T].m(e,null))}for(;T<h.length;T+=1)h[T].d(1);h.length=a.length}if(S&6){m=Vn(x[1]);let T;for(T=0;T<m.length;T+=1){const C=vy(x,m,T);l[T]?l[T].p(C,S):(l[T]=wy(C),l[T].c(),l[T].m(s,null))}for(;T<l.length;T+=1)l[T].d(1);l.length=m.length}},i:tt,o:tt,d(x){x&&(oe(e),oe(n),oe(s)),Er(h,x),Er(l,x)}}}function lS(r,e,n){let{colorScale:s}=e,{limits:a}=e,{decimalPlaces:h=0}=e;return r.$$set=m=>{"colorScale"in m&&n(0,s=m.colorScale),"limits"in m&&n(1,a=m.limits),"decimalPlaces"in m&&n(2,h=m.decimalPlaces)},[s,a,h]}class Qp extends fn{constructor(e){super(),hn(this,e,lS,aS,an,{colorScale:0,limits:1,decimalPlaces:2})}}function kl(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}let _t;const La=new Array(128).fill(void 0);La.push(void 0,null,!0,!1);function In(r){return La[r]}let Ih=La.length;function uS(r){r<132||(La[r]=Ih,Ih=r)}function Vi(r){const e=In(r);return uS(r),e}const $v=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&$v.decode();let _h=null;function ic(){return(_h===null||_h.byteLength===0)&&(_h=new Uint8Array(_t.memory.buffer)),_h}function Gi(r,e){return r=r>>>0,$v.decode(ic().subarray(r,r+e))}function Mi(r){Ih===La.length&&La.push(La.length+1);const e=Ih;return Ih=La[e],La[e]=r,e}let Do=0;const Rf=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},cS=typeof Rf.encodeInto=="function"?function(r,e){return Rf.encodeInto(r,e)}:function(r,e){const n=Rf.encode(r);return e.set(n),{read:r.length,written:n.length}};function nu(r,e,n){if(n===void 0){const l=Rf.encode(r),x=e(l.length,1)>>>0;return ic().subarray(x,x+l.length).set(l),Do=l.length,x}let s=r.length,a=e(s,1)>>>0;const h=ic();let m=0;for(;m<s;m++){const l=r.charCodeAt(m);if(l>127)break;h[a+m]=l}if(m!==s){m!==0&&(r=r.slice(m)),a=n(a,s,s=m+r.length*3,1)>>>0;const l=ic().subarray(a+m,a+s),x=cS(r,l);m+=x.written,a=n(a,s,m,1)>>>0}return Do=m,a}function eu(r){return r==null}let Ql=null;function Tt(){return(Ql===null||Ql.buffer.detached===!0||Ql.buffer.detached===void 0&&Ql.buffer!==_t.memory.buffer)&&(Ql=new DataView(_t.memory.buffer)),Ql}function Dp(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const a=r.description;return a==null?"Symbol":`Symbol(${a})`}if(e=="function"){const a=r.name;return typeof a=="string"&&a.length>0?`Function(${a})`:"Function"}if(Array.isArray(r)){const a=r.length;let h="[";a>0&&(h+=Dp(r[0]));for(let m=1;m<a;m++)h+=", "+Dp(r[m]);return h+="]",h}const n=/\[object ([^\]]+)\]/.exec(toString.call(r));let s;if(n.length>1)s=n[1];else return toString.call(r);if(s=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:s}function hS(r,e){const n=e(r.length*1,1)>>>0;return ic().set(r,n/1),Do=r.length,n}let yh=null;function fS(){return(yh===null||yh.byteLength===0)&&(yh=new Float64Array(_t.memory.buffer)),yh}function dS(r,e){return r=r>>>0,fS().subarray(r/8,r/8+e)}function pS(r,e){return r=r>>>0,ic().subarray(r/1,r/1+e)}function ml(r,e){try{return r.apply(this,e)}catch(n){_t.__wbindgen_exn_store(Mi(n))}}const ky=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>_t.__wbg_mapmodel_free(r>>>0,1));class mS{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ky.unregister(this),e}free(){const e=this.__destroy_into_raw();_t.__wbg_mapmodel_free(e,0)}constructor(e){try{const h=_t.__wbindgen_add_to_stack_pointer(-16),m=hS(e,_t.__wbindgen_malloc),l=Do;_t.mapmodel_new(h,m,l);var n=Tt().getInt32(h+4*0,!0),s=Tt().getInt32(h+4*1,!0),a=Tt().getInt32(h+4*2,!0);if(a)throw Vi(s);return this.__wbg_ptr=n>>>0,ky.register(this,this.__wbg_ptr,this),this}finally{_t.__wbindgen_add_to_stack_pointer(16)}}renderDebug(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderDebug(S,this.__wbg_ptr);var s=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,n=x,Gi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}getInvertedBoundary(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getInvertedBoundary(S,this.__wbg_ptr);var s=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,n=x,Gi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}getBounds(){try{const a=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getBounds(a,this.__wbg_ptr);var e=Tt().getInt32(a+4*0,!0),n=Tt().getInt32(a+4*1,!0),s=dS(e,n).slice();return _t.__wbindgen_free(e,n*8,8),s}finally{_t.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const a=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_toRouteSnapper(a,this.__wbg_ptr);var e=Tt().getInt32(a+4*0,!0),n=Tt().getInt32(a+4*1,!0),s=pS(e,n).slice();return _t.__wbindgen_free(e,n*1,1),s}finally{_t.__wbindgen_add_to_stack_pointer(16)}}setRoute(e,n){try{const m=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_setRoute(m,this.__wbg_ptr,!eu(e),eu(e)?0:e,Mi(n));var s=Tt().getInt32(m+4*0,!0),a=Tt().getInt32(m+4*1,!0),h=Tt().getInt32(m+4*2,!0);if(h)throw Vi(a);return s>>>0}finally{_t.__wbindgen_add_to_stack_pointer(16)}}deleteRoute(e){try{const a=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_deleteRoute(a,this.__wbg_ptr,e);var n=Tt().getInt32(a+4*0,!0),s=Tt().getInt32(a+4*1,!0);if(s)throw Vi(n)}finally{_t.__wbindgen_add_to_stack_pointer(16)}}clearAllRoutes(){_t.mapmodel_clearAllRoutes(this.__wbg_ptr)}renderRoutes(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderRoutes(S,this.__wbg_ptr);var s=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,n=x,Gi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}evaluateRoute(e){let n,s;try{const T=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_evaluateRoute(T,this.__wbg_ptr,Mi(e));var a=Tt().getInt32(T+4*0,!0),h=Tt().getInt32(T+4*1,!0),m=Tt().getInt32(T+4*2,!0),l=Tt().getInt32(T+4*3,!0),x=a,S=h;if(l)throw x=0,S=0,Vi(m);return n=x,s=S,Gi(x,S)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(n,s,1)}}debugReachablePath(e,n){let s,a;try{const C=_t.__wbindgen_add_to_stack_pointer(-16),N=nu(e,_t.__wbindgen_malloc,_t.__wbindgen_realloc),B=Do;_t.mapmodel_debugReachablePath(C,this.__wbg_ptr,N,B,n);var h=Tt().getInt32(C+4*0,!0),m=Tt().getInt32(C+4*1,!0),l=Tt().getInt32(C+4*2,!0),x=Tt().getInt32(C+4*3,!0),S=h,T=m;if(x)throw S=0,T=0,Vi(l);return s=S,a=T,Gi(S,T)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(s,a,1)}}debugUnreachablePath(e,n){let s,a;try{const C=_t.__wbindgen_add_to_stack_pointer(-16),N=nu(e,_t.__wbindgen_malloc,_t.__wbindgen_realloc),B=Do;_t.mapmodel_debugUnreachablePath(C,this.__wbg_ptr,N,B,n);var h=Tt().getInt32(C+4*0,!0),m=Tt().getInt32(C+4*1,!0),l=Tt().getInt32(C+4*2,!0),x=Tt().getInt32(C+4*3,!0),S=h,T=m;if(x)throw S=0,T=0,Vi(l);return s=S,a=T,Gi(S,T)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(s,a,1)}}evaluateOD(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_evaluateOD(S,this.__wbg_ptr);var s=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,n=x,Gi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}recalculateStats(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_recalculateStats(S,this.__wbg_ptr);var s=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,n=x,Gi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}toSavefile(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_toSavefile(S,this.__wbg_ptr);var s=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,n=x,Gi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}loadSavefile(e){try{const a=_t.__wbindgen_add_to_stack_pointer(-16),h=nu(e,_t.__wbindgen_malloc,_t.__wbindgen_realloc),m=Do;_t.mapmodel_loadSavefile(a,this.__wbg_ptr,h,m);var n=Tt().getInt32(a+4*0,!0),s=Tt().getInt32(a+4*1,!0);if(s)throw Vi(n)}finally{_t.__wbindgen_add_to_stack_pointer(16)}}meshDensity(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_meshDensity(S,this.__wbg_ptr);var s=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,n=x,Gi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}classifyExistingNetwork(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_classifyExistingNetwork(S,this.__wbg_ptr);var s=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,n=x,Gi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}importExistingRoutes(){return _t.mapmodel_importExistingRoutes(this.__wbg_ptr)>>>0}importCoreNetwork(){return _t.mapmodel_importCoreNetwork(this.__wbg_ptr)>>>0}getSchools(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getSchools(S,this.__wbg_ptr);var s=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,n=x,Gi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}getGPHospitals(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getGPHospitals(S,this.__wbg_ptr);var s=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,n=x,Gi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}getTownCentres(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getTownCentres(S,this.__wbg_ptr);var s=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,n=x,Gi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}getDataZones(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getDataZones(S,this.__wbg_ptr);var s=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,n=x,Gi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}renderReachableNetwork(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderReachableNetwork(S,this.__wbg_ptr);var s=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,n=x,Gi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}renderLevelOfService(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderLevelOfService(S,this.__wbg_ptr);var s=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,n=x,Gi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}renderCoreNetwork(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderCoreNetwork(S,this.__wbg_ptr);var s=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,n=x,Gi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}renderPrecalculatedFlows(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderPrecalculatedFlows(S,this.__wbg_ptr);var s=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,n=x,Gi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}getMajorJunctions(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getMajorJunctions(S,this.__wbg_ptr);var s=Tt().getInt32(S+4*0,!0),a=Tt().getInt32(S+4*1,!0),h=Tt().getInt32(S+4*2,!0),m=Tt().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,Vi(h);return e=l,n=x,Gi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}}async function gS(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(s){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",s);else throw s}const n=await r.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(r,e);return n instanceof WebAssembly.Instance?{instance:n,module:r}:n}}function _S(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Vi(e)},r.wbg.__wbindgen_string_new=function(e,n){const s=Gi(e,n);return Mi(s)},r.wbg.__wbindgen_string_get=function(e,n){const s=In(n),a=typeof s=="string"?s:void 0;var h=eu(a)?0:nu(a,_t.__wbindgen_malloc,_t.__wbindgen_realloc),m=Do;Tt().setInt32(e+4*1,m,!0),Tt().setInt32(e+4*0,h,!0)},r.wbg.__wbindgen_number_get=function(e,n){const s=In(n),a=typeof s=="number"?s:void 0;Tt().setFloat64(e+8*1,eu(a)?0:a,!0),Tt().setInt32(e+4*0,!eu(a),!0)},r.wbg.__wbindgen_error_new=function(e,n){const s=new Error(Gi(e,n));return Mi(s)},r.wbg.__wbindgen_boolean_get=function(e){const n=In(e);return typeof n=="boolean"?n?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof In(e)=="bigint"},r.wbg.__wbindgen_is_object=function(e){const n=In(e);return typeof n=="object"&&n!==null},r.wbg.__wbindgen_in=function(e,n){return In(e)in In(n)},r.wbg.__wbindgen_bigint_from_i64=function(e){return Mi(e)},r.wbg.__wbindgen_jsval_eq=function(e,n){return In(e)===In(n)},r.wbg.__wbindgen_bigint_from_u64=function(e){const n=BigInt.asUintN(64,e);return Mi(n)},r.wbg.__wbindgen_is_string=function(e){return typeof In(e)=="string"},r.wbg.__wbindgen_is_undefined=function(e){return In(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,n){return In(e)==In(n)},r.wbg.__wbindgen_as_number=function(e){return+In(e)},r.wbg.__wbg_String_b9412f8799faab3e=function(e,n){const s=String(In(n)),a=nu(s,_t.__wbindgen_malloc,_t.__wbindgen_realloc),h=Do;Tt().setInt32(e+4*1,h,!0),Tt().setInt32(e+4*0,a,!0)},r.wbg.__wbindgen_object_clone_ref=function(e){const n=In(e);return Mi(n)},r.wbg.__wbg_getwithrefkey_edc2c8960f0f1191=function(e,n){const s=In(e)[In(n)];return Mi(s)},r.wbg.__wbg_debug_5a33c41aeac15ee6=function(e){console.debug(In(e))},r.wbg.__wbg_error_09480e4aadca50ad=function(e){console.error(In(e))},r.wbg.__wbg_info_c261acb2deacd903=function(e){console.info(In(e))},r.wbg.__wbg_log_b103404cc5920657=function(e){console.log(In(e))},r.wbg.__wbg_warn_2b3adb99ce26c314=function(e){console.warn(In(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Mi(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const s=In(n).stack,a=nu(s,_t.__wbindgen_malloc,_t.__wbindgen_realloc),h=Do;Tt().setInt32(e+4*1,h,!0),Tt().setInt32(e+4*0,a,!0)},r.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let s,a;try{s=e,a=n,console.error(Gi(e,n))}finally{_t.__wbindgen_free(s,a,1)}},r.wbg.__wbg_performance_a1b8bde2ee512264=function(e){const n=In(e).performance;return Mi(n)},r.wbg.__wbg_now_abd80e969af37148=function(e){return In(e).now()},r.wbg.__wbg_get_3baa728f9d58d3f6=function(e,n){const s=In(e)[n>>>0];return Mi(s)},r.wbg.__wbg_length_ae22078168b726f5=function(e){return In(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof In(e)=="function"},r.wbg.__wbg_newnoargs_76313bd6ff35d0f2=function(e,n){const s=new Function(Gi(e,n));return Mi(s)},r.wbg.__wbg_next_de3e9db4440638b2=function(e){const n=In(e).next;return Mi(n)},r.wbg.__wbg_next_f9cb570345655b9a=function(){return ml(function(e){const n=In(e).next();return Mi(n)},arguments)},r.wbg.__wbg_done_bfda7aa8f252b39f=function(e){return In(e).done},r.wbg.__wbg_value_6d39332ab4788d86=function(e){const n=In(e).value;return Mi(n)},r.wbg.__wbg_iterator_888179a48810a9fe=function(){return Mi(Symbol.iterator)},r.wbg.__wbg_get_224d16597dbbfd96=function(){return ml(function(e,n){const s=Reflect.get(In(e),In(n));return Mi(s)},arguments)},r.wbg.__wbg_call_1084a111329e68ce=function(){return ml(function(e,n){const s=In(e).call(In(n));return Mi(s)},arguments)},r.wbg.__wbg_self_3093d5d1f7bcb682=function(){return ml(function(){const e=self.self;return Mi(e)},arguments)},r.wbg.__wbg_window_3bcfc4d31bc012f8=function(){return ml(function(){const e=window.window;return Mi(e)},arguments)},r.wbg.__wbg_globalThis_86b222e13bdf32ed=function(){return ml(function(){const e=globalThis.globalThis;return Mi(e)},arguments)},r.wbg.__wbg_global_e5a3fe56f8be9485=function(){return ml(function(){const e=global.global;return Mi(e)},arguments)},r.wbg.__wbg_isArray_8364a5371e9737d8=function(e){return Array.isArray(In(e))},r.wbg.__wbg_instanceof_ArrayBuffer_61dfc3198373c902=function(e){let n;try{n=In(e)instanceof ArrayBuffer}catch{n=!1}return n},r.wbg.__wbg_call_89af060b4e1523f2=function(){return ml(function(e,n,s){const a=In(e).call(In(n),In(s));return Mi(a)},arguments)},r.wbg.__wbg_instanceof_Map_763ce0e95960d55e=function(e){let n;try{n=In(e)instanceof Map}catch{n=!1}return n},r.wbg.__wbg_isSafeInteger_7f1ed56200d90674=function(e){return Number.isSafeInteger(In(e))},r.wbg.__wbg_entries_7a0e06255456ebcd=function(e){const n=Object.entries(In(e));return Mi(n)},r.wbg.__wbg_buffer_b7b08af79b0b0974=function(e){const n=In(e).buffer;return Mi(n)},r.wbg.__wbg_new_ea1883e1e5e86686=function(e){const n=new Uint8Array(In(e));return Mi(n)},r.wbg.__wbg_set_d1e79e2388520f18=function(e,n,s){In(e).set(In(n),s>>>0)},r.wbg.__wbg_length_8339fcf5d8ecd12e=function(e){return In(e).length},r.wbg.__wbg_instanceof_Uint8Array_247a91427532499e=function(e){let n;try{n=In(e)instanceof Uint8Array}catch{n=!1}return n},r.wbg.__wbindgen_bigint_get_as_i64=function(e,n){const s=In(n),a=typeof s=="bigint"?s:void 0;Tt().setBigInt64(e+8*1,eu(a)?BigInt(0):a,!0),Tt().setInt32(e+4*0,!eu(a),!0)},r.wbg.__wbindgen_debug_string=function(e,n){const s=Dp(In(n)),a=nu(s,_t.__wbindgen_malloc,_t.__wbindgen_realloc),h=Do;Tt().setInt32(e+4*1,h,!0),Tt().setInt32(e+4*0,a,!0)},r.wbg.__wbindgen_throw=function(e,n){throw new Error(Gi(e,n))},r.wbg.__wbindgen_memory=function(){const e=_t.memory;return Mi(e)},r}function yS(r,e){return _t=r.exports,Yv.__wbindgen_wasm_module=e,Ql=null,yh=null,_h=null,_t}async function Yv(r){if(_t!==void 0)return _t;typeof r<"u"&&Object.getPrototypeOf(r)===Object.prototype?{module_or_path:r}=r:console.warn("using deprecated parameters for the initialization function; pass a single object instead"),typeof r>"u"&&(r=new URL("backend_bg.wasm",self.location));const e=_S();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:n,module:s}=await gS(await r,e);return yS(n,s)}class vS{constructor(){lh(this,"inner");this.inner=null}async loadFile(e){await Yv(),this.inner=new mS(e)}getBounds(){return this.checkReady(),Array.from(this.inner.getBounds())}getInvertedBoundary(){return this.checkReady(),JSON.parse(this.inner.getInvertedBoundary())}renderDebug(){return this.checkReady(),JSON.parse(this.inner.renderDebug())}renderLevelOfService(){return this.checkReady(),JSON.parse(this.inner.renderLevelOfService())}renderCoreNetwork(){return this.checkReady(),JSON.parse(this.inner.renderCoreNetwork())}renderPrecalculatedFlows(){return this.checkReady(),JSON.parse(this.inner.renderPrecalculatedFlows())}toRouteSnapper(){return this.checkReady(),this.inner.toRouteSnapper()}renderRoutes(){return this.checkReady(),JSON.parse(this.inner.renderRoutes())}setRoute(e,n){return this.checkReady(),this.inner.setRoute(e??void 0,n)}deleteRoute(e){this.checkReady(),this.inner.deleteRoute(e)}clearAllRoutes(){this.checkReady(),this.inner.clearAllRoutes()}evaluateRoute(e){return this.checkReady(),JSON.parse(this.inner.evaluateRoute({x1:e.start.lng,y1:e.start.lat,x2:e.end[0],y2:e.end[1],breakdown:e.breakdown}))}evaluateOD(){return this.checkReady(),JSON.parse(this.inner.evaluateOD())}recalculateStats(){return this.checkReady(),JSON.parse(this.inner.recalculateStats())}meshDensity(){return this.checkReady(),JSON.parse(this.inner.meshDensity())}classifyExistingNetwork(){return this.checkReady(),JSON.parse(this.inner.classifyExistingNetwork())}importExistingRoutes(){return this.checkReady(),this.inner.importExistingRoutes()}importCoreNetwork(){return this.checkReady(),this.inner.importCoreNetwork()}toSavefile(){return this.checkReady(),this.inner.toSavefile()}loadSavefile(e){this.checkReady(),this.inner.loadSavefile(e)}getSchools(){return this.checkReady(),JSON.parse(this.inner.getSchools())}getGpHospitals(){return this.checkReady(),JSON.parse(this.inner.getGPHospitals())}getTownCentres(){return this.checkReady(),JSON.parse(this.inner.getTownCentres())}getDataZones(){return this.checkReady(),JSON.parse(this.inner.getDataZones())}renderReachableNetwork(){return this.checkReady(),JSON.parse(this.inner.renderReachableNetwork())}debugReachablePath(e,n){return this.checkReady(),JSON.parse(this.inner.debugReachablePath(e,n))}debugUnreachablePath(e,n){return this.checkReady(),JSON.parse(this.inner.debugUnreachablePath(e,n))}getMajorJunctions(){return this.checkReady(),JSON.parse(this.inner.getMajorJunctions())}checkReady(){if(!this.inner)throw new Error("Backend used without a file loaded")}}let Jv="MZEJTanw3WpxRvt7qDfo",Hf=Jn(""),Oi=Jn({kind:"main"}),_l=Jn("Primary"),bS=Jn(null),Ph=Jn(0),sr=Jn(null),Ju=Jn(null),Sh=Jn(null),em=[["SegregatedWide","Segregated Track (wide)","#054d05"],["OffRoad","Off Road Cycleway","#3a9120"],["SegregatedNarrow","Segregated Track (narrow)","#87d668"],["SharedFootway","Shared Footway","#ffbf00"],["CycleLane","Painted Cycle Lane","#FF0000"],["MixedTraffic","Mixed traffic","#EFD1C5"],["Unknown","Unknown","blue"]],ou=Object.fromEntries(em.map(([r,e,n])=>[r,[e,n]]));async function Dh(){let r=Df(sr),e=Df(Hf);if(!r||!e)return;let n=await r.toSavefile();window.localStorage.setItem(`tmp-npt-editor/${e}`,n)}let Np=Jn(!0);function rd(r){return Df(Np)?`https://assets.od2net.org/tmp_npt_editor/${r}`:r}let Iy=Jn(null);function xS(r){let e,n,s,a,h,m,l,x;return{c(){e=le("div"),n=le("h2"),n.textContent="Debug network mode",s=Oe(),a=le("button"),a.textContent="Back",h=Oe(),m=le("p"),m.textContent="Hover to see a segment's properties, and click to open OSM",Ze(e,"slot","left")},m(S,T){ae(S,e,T),Z(e,n),Z(e,s),Z(e,a),Z(e,h),Z(e,m),l||(x=Rt(a,"click",r[3]),l=!0)},p:tt,d(S){S&&oe(e),l=!1,x()}}}function wS(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function kS(r){let e,n;return e=new rr({props:{data:r[4],generateId:!0,$$slots:{default:[ES]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&1&&(h.data=s[4]),a&64&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function IS(r){let e,n;return e=new rS({props:{properties:r[5]}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&32&&(h.properties=s[5]),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function SS(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[IS,({props:s})=>({5:s}),({props:s})=>s?32:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&96&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function ES(r){let e,n;return e=new _r({props:{id:"network",paint:{"line-width":Ls(5,7),"line-color":"black"},manageHoverState:!0,hoverCursor:"pointer",eventsIfTopMost:!0,$$slots:{default:[SS]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&64&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function AS(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function TS(r){let e,n,s,a={ctx:r,current:null,token:null,hasCatch:!1,pending:AS,then:kS,catch:wS,value:4,blocks:[,,,]};return gs(n=kl(r[0]).renderDebug(),a),{c(){e=le("div"),a.block.c(),Ze(e,"slot","map")},m(h,m){ae(h,e,m),a.block.m(e,a.anchor=null),a.mount=()=>e,a.anchor=null,s=!0},p(h,m){r=h,a.ctx=r,m&1&&n!==(n=kl(r[0]).renderDebug())&&gs(n,a)||Il(a,r,m)},i(h){s||(ge(a.block),s=!0)},o(h){for(let m=0;m<3;m+=1){const l=a.blocks[m];Se(l)}s=!1},d(h){h&&oe(e),a.block.d(),a.token=null,a=null}}}function CS(r){let e,n;return e=new gc({props:{$$slots:{map:[TS],left:[xS]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,[a]){const h={};a&67&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function LS(r,e,n){let s,a;return zt(r,sr,l=>n(0,s=l)),zt(r,Oi,l=>n(1,a=l)),[s,a,l=>window.open(kl(l.detail.features[0].properties).way,"_blank"),()=>Dn(Oi,a={kind:"main"},a)]}class MS extends fn{constructor(e){super(),hn(this,e,LS,CS,an,{})}}function RS(r){let e,n,s,a,h,m;return{c(){e=le("div"),n=le("h2"),n.textContent="Debug mesh density mode",s=Oe(),a=le("button"),a.textContent="Back",Ze(e,"slot","left")},m(l,x){ae(l,e,x),Z(e,n),Z(e,s),Z(e,a),h||(m=Rt(a,"click",r[2]),h=!0)},p:tt,d(l){l&&oe(e),h=!1,m()}}}function PS(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function DS(r){let e,n;return e=new rr({props:{data:r[3],generateId:!0,$$slots:{default:[NS]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&1&&(h.data=s[3]),a&16&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function NS(r){let e,n,s,a;return e=new _r({props:{paint:{"line-color":"black"}}}),s=new mc({props:{paint:{"fill-color":"grey","fill-opacity":Ls(.5,1)},manageHoverState:!0}}),{c(){ot(e.$$.fragment),n=Oe(),ot(s.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(s,h,m),a=!0},p:tt,i(h){a||(ge(e.$$.fragment,h),ge(s.$$.fragment,h),a=!0)},o(h){Se(e.$$.fragment,h),Se(s.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(s,h)}}}function zS(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function FS(r){let e,n,s,a={ctx:r,current:null,token:null,hasCatch:!1,pending:zS,then:DS,catch:PS,value:3,blocks:[,,,]};return gs(n=kl(r[0]).meshDensity(),a),{c(){e=le("div"),a.block.c(),Ze(e,"slot","map")},m(h,m){ae(h,e,m),a.block.m(e,a.anchor=null),a.mount=()=>e,a.anchor=null,s=!0},p(h,m){r=h,a.ctx=r,m&1&&n!==(n=kl(r[0]).meshDensity())&&gs(n,a)||Il(a,r,m)},i(h){s||(ge(a.block),s=!0)},o(h){for(let m=0;m<3;m+=1){const l=a.blocks[m];Se(l)}s=!1},d(h){h&&oe(e),a.block.d(),a.token=null,a=null}}}function OS(r){let e,n;return e=new gc({props:{$$slots:{map:[FS],left:[RS]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,[a]){const h={};a&19&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function BS(r,e,n){let s,a;return zt(r,sr,m=>n(0,s=m)),zt(r,Oi,m=>n(1,a=m)),[s,a,()=>Dn(Oi,a={kind:"main"},a)]}class US extends fn{constructor(e){super(),hn(this,e,BS,OS,an,{})}}let Qv=Jn(new Map),zp=Jn(!0),Xf=Jn(!1),Wf=Jn(!1),Kf=Jn(!1),$f=Jn(!1),Yf=Jn(!1),Qu=Jn(!1),Fp=Jn(!0),Sy=Jn(!1);function jS(r){let e,n,s,a;const h=r[1].default,m=Zi(h,r,r[0],null);return{c(){e=le("a"),m&&m.c(),Ze(e,"href","#")},m(l,x){ae(l,e,x),m&&m.m(e,null),n=!0,s||(a=Rt(e,"click",Nh(r[2])),s=!0)},p(l,[x]){m&&m.p&&(!n||x&1)&&Xi(m,h,l,l[0],n?Hi(h,l[0],x,null):Wi(l[0]),null)},i(l){n||(ge(m,l),n=!0)},o(l){Se(m,l),n=!1},d(l){l&&oe(e),m&&m.d(l),s=!1,a()}}}function qS(r,e,n){let{$$slots:s={},$$scope:a}=e;function h(m){ur.call(this,r,m)}return r.$$set=m=>{"$$scope"in m&&n(0,a=m.$$scope)},[a,s,h]}class VS extends fn{constructor(e){super(),hn(this,e,qS,jS,an,{})}}let ps={primaryRoutes:"#c00000",secondaryRoutes:"#e97132",localAccessRoutes:"#ffc000",longDistanceRoutes:"#4ea72e"},tm={High:"mediumseagreen",Medium:"orange",Low:"red",ShouldNotBeUsed:"brown"},ac=Xp(["get","infra_type"],Object.fromEntries(em.map(r=>[r[0],r[2]])),"red"),Op=Xp(["get","los"],tm,"black");function Ey(r){let e,n,s,a,h=`2px solid ${ps.primaryRoutes}`;return{c(){e=le("details"),n=le("summary"),n.textContent="Primary Route Reference Layers",s=Oe(),a=le("div"),e.open=!0,Rn(e,"border",h)},m(m,l){ae(m,e,l),Z(e,n),Z(e,s),Z(e,a),r[8](a)},p:tt,d(m){m&&oe(e),r[8](null)}}}function Ay(r){let e,n,s,a,h=`2px solid ${ps.secondaryRoutes}`;return{c(){e=le("details"),n=le("summary"),n.textContent="Secondary Route Reference Layers",s=Oe(),a=le("div"),e.open=!0,Rn(e,"border",h)},m(m,l){ae(m,e,l),Z(e,n),Z(e,s),Z(e,a),r[9](a)},p:tt,d(m){m&&oe(e),r[9](null)}}}function Ty(r){let e,n,s,a,h=`2px solid ${ps.localAccessRoutes}`;return{c(){e=le("details"),n=le("summary"),n.textContent="Local Access Route Reference Layers",s=Oe(),a=le("div"),e.open=!0,Rn(e,"border",h)},m(m,l){ae(m,e,l),Z(e,n),Z(e,s),Z(e,a),r[10](a)},p:tt,d(m){m&&oe(e),r[10](null)}}}function Cy(r){let e,n,s,a,h=`2px solid ${ps.longDistanceRoutes}`;return{c(){e=le("details"),n=le("summary"),n.textContent="Long Disance Route Reference Layers",s=Oe(),a=le("div"),e.open=!0,Rn(e,"border",h)},m(m,l){ae(m,e,l),Z(e,n),Z(e,s),Z(e,a),r[11](a)},p:tt,d(m){m&&oe(e),r[11](null)}}}function GS(r){let e,n,s,a,h,m,l,x,S,T=r[5]=="Primary"&&Ey(r),C=r[5]=="Secondary"&&Ay(r),N=r[5]=="LocalAccess"&&Ty(r),B=r[5]=="LongDistance"&&Cy(r);return{c(){e=le("details"),n=le("summary"),n.textContent="Basic Reference Layers",s=Oe(),a=le("div"),h=Oe(),T&&T.c(),m=Oe(),C&&C.c(),l=Oe(),N&&N.c(),x=Oe(),B&&B.c(),S=ii(),e.open=!0,Rn(e,"border","2px solid black")},m(U,ee){ae(U,e,ee),Z(e,n),Z(e,s),Z(e,a),r[7](a),ae(U,h,ee),T&&T.m(U,ee),ae(U,m,ee),C&&C.m(U,ee),ae(U,l,ee),N&&N.m(U,ee),ae(U,x,ee),B&&B.m(U,ee),ae(U,S,ee)},p(U,[ee]){U[5]=="Primary"?T?T.p(U,ee):(T=Ey(U),T.c(),T.m(m.parentNode,m)):T&&(T.d(1),T=null),U[5]=="Secondary"?C?C.p(U,ee):(C=Ay(U),C.c(),C.m(l.parentNode,l)):C&&(C.d(1),C=null),U[5]=="LocalAccess"?N?N.p(U,ee):(N=Ty(U),N.c(),N.m(x.parentNode,x)):N&&(N.d(1),N=null),U[5]=="LongDistance"?B?B.p(U,ee):(B=Cy(U),B.c(),B.m(S.parentNode,S)):B&&(B.d(1),B=null)},i:tt,o:tt,d(U){U&&(oe(e),oe(h),oe(m),oe(l),oe(x),oe(S)),r[7](null),T&&T.d(U),C&&C.d(U),N&&N.d(U),B&&B.d(U)}}}function ph(r,e,n){if(r){r.innerHTML="";for(let s of n){let a=e.get(s);a&&r.appendChild(a)}}}function ZS(r,e,n){let s,a;zt(r,Qv,ee=>n(6,s=ee)),zt(r,_l,ee=>n(5,a=ee));let h=null,m=null,l=null,x=null,S=null;function T(ee){$n[ee?"unshift":"push"](()=>{h=ee,n(0,h)})}function C(ee){$n[ee?"unshift":"push"](()=>{m=ee,n(1,m)})}function N(ee){$n[ee?"unshift":"push"](()=>{l=ee,n(2,l)})}function B(ee){$n[ee?"unshift":"push"](()=>{x=ee,n(3,x)})}function U(ee){$n[ee?"unshift":"push"](()=>{S=ee,n(4,S)})}return r.$$.update=()=>{r.$$.dirty&65&&ph(h,s,["route network","simd","population density","core network","existing network","level of service","traffic volume","reachable network"]),r.$$.dirty&66&&ph(m,s,["high npt route coverage"]),r.$$.dirty&68&&ph(l,s,["town centres"]),r.$$.dirty&72&&ph(x,s,["schools","gp hospitals"]),r.$$.dirty&80&&ph(S,s,["urban areas"])},[h,m,l,x,S,a,s,T,C,N,B,U]}class HS extends fn{constructor(e){super(),hn(this,e,ZS,GS,an,{})}}function XS(r){let e,n,s,a,h,m=Math.round(r[2]*100)+"",l,x,S,T,C,N,B;return{c(){e=le("p"),n=le("a"),s=ze(r[1]),a=ze(`
  :
  `),h=le("b"),l=ze(m),x=ze("%"),S=Oe(),T=le("progress"),Ze(n,"href","#"),T.value=C=r[2]*100,Ze(T,"max","100")},m(U,ee){ae(U,e,ee),Z(e,n),Z(n,s),Z(e,a),Z(e,h),Z(h,l),Z(h,x),Z(e,S),Z(e,T),N||(B=Rt(n,"click",Nh(r[3])),N=!0)},p(U,[ee]){ee&2&&Ct(s,U[1]),ee&4&&m!==(m=Math.round(U[2]*100)+"")&&Ct(l,m),ee&4&&C!==(C=U[2]*100)&&(T.value=C)},i:tt,o:tt,d(U){U&&oe(e),N=!1,B()}}}function WS(r,e,n){let{label:s}=e,{showLayer:a}=e,{pct:h}=e;const m=()=>n(0,a=!0);return r.$$set=l=>{"label"in l&&n(1,s=l.label),"showLayer"in l&&n(0,a=l.showLayer),"pct"in l&&n(2,h=l.pct)},[a,s,h,m]}class Ma extends fn{constructor(e){super(),hn(this,e,WS,XS,an,{label:1,showLayer:0,pct:2})}}function Ly(r,e,n){const s=r.slice();return s[22]=e[n][0],s[23]=e[n][1],s}function My(r,e,n){const s=r.slice();return s[22]=e[n][0],s[23]=e[n][1],s}function Ry(r){let e,n,s,a=`2px solid ${ps.primaryRoutes}`,h,m,l,x,S,T,C,N,B=r[0].average_weighted_directness.toFixed(1)+"",U,ee,ie,se,Q,Y,_e,ve,Ae,ce,xe,be,Le,ke,ye;function Ue(ft){r[11](ft)}let qe={label:"High cycling flow coverage",pct:lc(r[0].covered_flow_quintile_sums[0],r[0].total_flow_quintile_sums[0])};r[1]!==void 0&&(qe.showLayer=r[1]),n=new Ma({props:qe}),$n.push(()=>gr(n,"showLayer",Ue));let pt=(r[2]=="Secondary"||r[2]=="LocalAccess"||r[2]=="LongDistance")&&Py(r),St=(r[2]=="LocalAccess"||r[2]=="LongDistance")&&Dy(r),dt=r[2]=="LongDistance"&&Ny(r),ut=Vn(Object.entries(r[0].od_percents_infra_type).toSorted(Oy)),Ut=[];for(let ft=0;ft<ut.length;ft+=1)Ut[ft]=zy(My(r,ut,ft));let vt=Vn(Object.entries(r[0].od_percents_los).toSorted(By)),kt=[];for(let ft=0;ft<vt.length;ft+=1)kt[ft]=Fy(Ly(r,vt,ft));return{c(){e=le("div"),ot(n.$$.fragment),h=Oe(),pt&&pt.c(),m=Oe(),St&&St.c(),l=Oe(),dt&&dt.c(),x=Oe(),S=le("div"),T=le("p"),C=le("a"),C.textContent="Average weighted directness",N=ze(`
      : `),U=ze(B),ee=ze("x"),ie=Oe(),se=le("details"),Q=le("summary"),Q.textContent="Percent of demand by infrastructure type",Y=Oe(),_e=le("ul");for(let ft=0;ft<Ut.length;ft+=1)Ut[ft].c();ve=Oe(),Ae=le("details"),ce=le("summary"),ce.textContent="Percent of demand by level of service:",xe=Oe(),be=le("ul");for(let ft=0;ft<kt.length;ft+=1)kt[ft].c();Rn(e,"border",a),Ze(C,"href","#"),Rn(S,"margin-top","4px"),Rn(S,"border","2px solid black")},m(ft,wt){ae(ft,e,wt),it(n,e,null),ae(ft,h,wt),pt&&pt.m(ft,wt),ae(ft,m,wt),St&&St.m(ft,wt),ae(ft,l,wt),dt&&dt.m(ft,wt),ae(ft,x,wt),ae(ft,S,wt),Z(S,T),Z(T,C),Z(T,N),Z(T,U),Z(T,ee),Z(S,ie),Z(S,se),Z(se,Q),Z(se,Y),Z(se,_e);for(let It=0;It<Ut.length;It+=1)Ut[It]&&Ut[It].m(_e,null);Z(S,ve),Z(S,Ae),Z(Ae,ce),Z(Ae,xe),Z(Ae,be);for(let It=0;It<kt.length;It+=1)kt[It]&&kt[It].m(be,null);Le=!0,ke||(ye=Rt(C,"click",Nh(r[20])),ke=!0)},p(ft,wt){const It={};if(wt&1&&(It.pct=lc(ft[0].covered_flow_quintile_sums[0],ft[0].total_flow_quintile_sums[0])),!s&&wt&2&&(s=!0,It.showLayer=ft[1],mr(()=>s=!1)),n.$set(It),ft[2]=="Secondary"||ft[2]=="LocalAccess"||ft[2]=="LongDistance"?pt?(pt.p(ft,wt),wt&4&&ge(pt,1)):(pt=Py(ft),pt.c(),ge(pt,1),pt.m(m.parentNode,m)):pt&&(zn(),Se(pt,1,1,()=>{pt=null}),Fn()),ft[2]=="LocalAccess"||ft[2]=="LongDistance"?St?(St.p(ft,wt),wt&4&&ge(St,1)):(St=Dy(ft),St.c(),ge(St,1),St.m(l.parentNode,l)):St&&(zn(),Se(St,1,1,()=>{St=null}),Fn()),ft[2]=="LongDistance"?dt?(dt.p(ft,wt),wt&4&&ge(dt,1)):(dt=Ny(ft),dt.c(),ge(dt,1),dt.m(x.parentNode,x)):dt&&(zn(),Se(dt,1,1,()=>{dt=null}),Fn()),(!Le||wt&1)&&B!==(B=ft[0].average_weighted_directness.toFixed(1)+"")&&Ct(U,B),wt&1){ut=Vn(Object.entries(ft[0].od_percents_infra_type).toSorted(Oy));let $t;for($t=0;$t<ut.length;$t+=1){const pn=My(ft,ut,$t);Ut[$t]?Ut[$t].p(pn,wt):(Ut[$t]=zy(pn),Ut[$t].c(),Ut[$t].m(_e,null))}for(;$t<Ut.length;$t+=1)Ut[$t].d(1);Ut.length=ut.length}if(wt&1){vt=Vn(Object.entries(ft[0].od_percents_los).toSorted(By));let $t;for($t=0;$t<vt.length;$t+=1){const pn=Ly(ft,vt,$t);kt[$t]?kt[$t].p(pn,wt):(kt[$t]=Fy(pn),kt[$t].c(),kt[$t].m(be,null))}for(;$t<kt.length;$t+=1)kt[$t].d(1);kt.length=vt.length}},i(ft){Le||(ge(n.$$.fragment,ft),ge(pt),ge(St),ge(dt),Le=!0)},o(ft){Se(n.$$.fragment,ft),Se(pt),Se(St),Se(dt),Le=!1},d(ft){ft&&(oe(e),oe(h),oe(m),oe(l),oe(x),oe(S)),rt(n),pt&&pt.d(ft),St&&St.d(ft),dt&&dt.d(ft),Er(Ut,ft),Er(kt,ft),ke=!1,ye()}}}function Py(r){let e,n,s,a,h,m,l=`2px solid ${ps.secondaryRoutes}`,x;function S(B){r[12](B)}let T={label:"Medium cycling flow coverage",pct:lc(r[0].covered_flow_quintile_sums[1],r[0].total_flow_quintile_sums[1])};r[1]!==void 0&&(T.showLayer=r[1]),n=new Ma({props:T}),$n.push(()=>gr(n,"showLayer",S));function C(B){r[13](B)}let N={label:"Town centres",pct:r[0].percent_reachable_town_centres};return r[3]!==void 0&&(N.showLayer=r[3]),h=new Ma({props:N}),$n.push(()=>gr(h,"showLayer",C)),{c(){e=le("div"),ot(n.$$.fragment),a=Oe(),ot(h.$$.fragment),Rn(e,"margin-top","4px"),Rn(e,"border",l)},m(B,U){ae(B,e,U),it(n,e,null),Z(e,a),it(h,e,null),x=!0},p(B,U){const ee={};U&1&&(ee.pct=lc(B[0].covered_flow_quintile_sums[1],B[0].total_flow_quintile_sums[1])),!s&&U&2&&(s=!0,ee.showLayer=B[1],mr(()=>s=!1)),n.$set(ee);const ie={};U&1&&(ie.pct=B[0].percent_reachable_town_centres),!m&&U&8&&(m=!0,ie.showLayer=B[3],mr(()=>m=!1)),h.$set(ie)},i(B){x||(ge(n.$$.fragment,B),ge(h.$$.fragment,B),x=!0)},o(B){Se(n.$$.fragment,B),Se(h.$$.fragment,B),x=!1},d(B){B&&oe(e),rt(n),rt(h)}}}function Dy(r){let e,n,s,a,h,m,l,x,S,T,C,N,B,U,ee,ie=`2px solid ${ps.localAccessRoutes}`,se;function Q(ye){r[14](ye)}let Y={label:"Low cycling flow coverage",pct:lc(r[0].covered_flow_quintile_sums[2],r[0].total_flow_quintile_sums[2])};r[1]!==void 0&&(Y.showLayer=r[1]),n=new Ma({props:Y}),$n.push(()=>gr(n,"showLayer",Q));function _e(ye){r[15](ye)}let ve={label:"Schools",pct:r[0].percent_reachable_schools};r[4]!==void 0&&(ve.showLayer=r[4]),h=new Ma({props:ve}),$n.push(()=>gr(h,"showLayer",_e));function Ae(ye){r[16](ye)}let ce={label:"GPs and hospitals",pct:r[0].percent_reachable_gp_hospitals};r[5]!==void 0&&(ce.showLayer=r[5]),x=new Ma({props:ce}),$n.push(()=>gr(x,"showLayer",Ae));function xe(ye){r[17](ye)}let be={label:"Deprived population coverage",pct:r[0].percent_reachable_imd_population};r[6]!==void 0&&(be.showLayer=r[6]),C=new Ma({props:be}),$n.push(()=>gr(C,"showLayer",xe));function Le(ye){r[18](ye)}let ke={label:"Population coverage",pct:r[0].percent_reachable_population};return r[7]!==void 0&&(ke.showLayer=r[7]),U=new Ma({props:ke}),$n.push(()=>gr(U,"showLayer",Le)),{c(){e=le("div"),ot(n.$$.fragment),a=Oe(),ot(h.$$.fragment),l=Oe(),ot(x.$$.fragment),T=Oe(),ot(C.$$.fragment),B=Oe(),ot(U.$$.fragment),Rn(e,"margin-top","4px"),Rn(e,"border",ie)},m(ye,Ue){ae(ye,e,Ue),it(n,e,null),Z(e,a),it(h,e,null),Z(e,l),it(x,e,null),Z(e,T),it(C,e,null),Z(e,B),it(U,e,null),se=!0},p(ye,Ue){const qe={};Ue&1&&(qe.pct=lc(ye[0].covered_flow_quintile_sums[2],ye[0].total_flow_quintile_sums[2])),!s&&Ue&2&&(s=!0,qe.showLayer=ye[1],mr(()=>s=!1)),n.$set(qe);const pt={};Ue&1&&(pt.pct=ye[0].percent_reachable_schools),!m&&Ue&16&&(m=!0,pt.showLayer=ye[4],mr(()=>m=!1)),h.$set(pt);const St={};Ue&1&&(St.pct=ye[0].percent_reachable_gp_hospitals),!S&&Ue&32&&(S=!0,St.showLayer=ye[5],mr(()=>S=!1)),x.$set(St);const dt={};Ue&1&&(dt.pct=ye[0].percent_reachable_imd_population),!N&&Ue&64&&(N=!0,dt.showLayer=ye[6],mr(()=>N=!1)),C.$set(dt);const ut={};Ue&1&&(ut.pct=ye[0].percent_reachable_population),!ee&&Ue&128&&(ee=!0,ut.showLayer=ye[7],mr(()=>ee=!1)),U.$set(ut)},i(ye){se||(ge(n.$$.fragment,ye),ge(h.$$.fragment,ye),ge(x.$$.fragment,ye),ge(C.$$.fragment,ye),ge(U.$$.fragment,ye),se=!0)},o(ye){Se(n.$$.fragment,ye),Se(h.$$.fragment,ye),Se(x.$$.fragment,ye),Se(C.$$.fragment,ye),Se(U.$$.fragment,ye),se=!1},d(ye){ye&&oe(e),rt(n),rt(h),rt(x),rt(C),rt(U)}}}function Ny(r){let e,n,s,a=`2px solid ${ps.longDistanceRoutes}`,h;function m(x){r[19](x)}let l={label:"Reachable settlements (TODO)",pct:0};return r[8]!==void 0&&(l.showLayer=r[8]),n=new Ma({props:l}),$n.push(()=>gr(n,"showLayer",m)),{c(){e=le("div"),ot(n.$$.fragment),Rn(e,"margin-top","4px"),Rn(e,"border",a)},m(x,S){ae(x,e,S),it(n,e,null),h=!0},p(x,S){const T={};!s&&S&256&&(s=!0,T.showLayer=x[8],mr(()=>s=!1)),n.$set(T)},i(x){h||(ge(n.$$.fragment,x),h=!0)},o(x){Se(n.$$.fragment,x),h=!1},d(x){x&&oe(e),rt(n)}}}function zy(r){let e,n=r[22]+"",s,a,h=Math.round(r[23]*100)+"",m,l;return{c(){e=le("li"),s=ze(n),a=ze(": "),m=ze(h),l=ze("%")},m(x,S){ae(x,e,S),Z(e,s),Z(e,a),Z(e,m),Z(e,l)},p(x,S){S&1&&n!==(n=x[22]+"")&&Ct(s,n),S&1&&h!==(h=Math.round(x[23]*100)+"")&&Ct(m,h)},d(x){x&&oe(e)}}}function Fy(r){let e,n=r[22]+"",s,a,h=Math.round(r[23]*100)+"",m,l;return{c(){e=le("li"),s=ze(n),a=ze(": "),m=ze(h),l=ze("%")},m(x,S){ae(x,e,S),Z(e,s),Z(e,a),Z(e,m),Z(e,l)},p(x,S){S&1&&n!==(n=x[22]+"")&&Ct(s,n),S&1&&h!==(h=Math.round(x[23]*100)+"")&&Ct(m,h)},d(x){x&&oe(e)}}}function KS(r){let e,n,s,a,h,m,l=r[0]&&Ry(r);return{c(){e=le("button"),e.textContent="Recalculate",n=Oe(),l&&l.c(),s=ii()},m(x,S){ae(x,e,S),ae(x,n,S),l&&l.m(x,S),ae(x,s,S),a=!0,h||(m=Rt(e,"click",r[10]),h=!0)},p(x,[S]){x[0]?l?(l.p(x,S),S&1&&ge(l,1)):(l=Ry(x),l.c(),ge(l,1),l.m(s.parentNode,s)):l&&(zn(),Se(l,1,1,()=>{l=null}),Fn())},i(x){a||(ge(l),a=!0)},o(x){Se(l),a=!1},d(x){x&&(oe(e),oe(n),oe(s)),l&&l.d(x),h=!1,m()}}}function lc(r,e){return e==0?0:r/e}const Oy=(r,e)=>e[1]-r[1],By=(r,e)=>e[1]-r[1];function $S(r,e,n){let s,a,h,m,l,x,S,T,C,N,B;zt(r,Iy,be=>n(0,s=be)),zt(r,sr,be=>n(21,a=be)),zt(r,Qu,be=>n(1,h=be)),zt(r,_l,be=>n(2,m=be)),zt(r,Kf,be=>n(3,l=be)),zt(r,Xf,be=>n(4,x=be)),zt(r,Wf,be=>n(5,S=be)),zt(r,$f,be=>n(6,T=be)),zt(r,Yf,be=>n(7,C=be)),zt(r,Sy,be=>n(8,N=be)),zt(r,Oi,be=>n(9,B=be));async function U(){Dn(Iy,s=await a.recalculateStats(),s)}cc(async()=>{s==null&&await U()});function ee(be){h=be,Qu.set(h)}function ie(be){h=be,Qu.set(h)}function se(be){l=be,Kf.set(l)}function Q(be){h=be,Qu.set(h)}function Y(be){x=be,Xf.set(x)}function _e(be){S=be,Wf.set(S)}function ve(be){T=be,$f.set(T)}function Ae(be){C=be,Yf.set(C)}function ce(be){N=be,Sy.set(N)}return[s,h,m,l,x,S,T,C,N,B,U,ee,ie,se,Q,Y,_e,ve,Ae,ce,()=>Dn(Oi,B={kind:"evaluate-route",browse:kl(s).worst_directness_routes},B)]}class YS extends fn{constructor(e){super(),hn(this,e,$S,KS,an,{})}}function Uy(r,e,n){const s=r.slice();return s[4]=e[n],s}function jy(r){let e,n=r[4]+"",s;return{c(){e=le("option"),s=ze(n),e.__value=r[4],ki(e,e.__value)},m(a,h){ae(a,e,h),Z(e,s)},p:tt,d(a){a&&oe(e)}}}function JS(r){let e,n,s,a,h,m=Vn(r[1]),l=[];for(let x=0;x<m.length;x+=1)l[x]=jy(Uy(r,m,x));return{c(){e=le("label"),n=ze(`Area:
  `),s=le("select");for(let x=0;x<l.length;x+=1)l[x].c();r[0]===void 0&&Ro(()=>r[3].call(s))},m(x,S){ae(x,e,S),Z(e,n),Z(e,s);for(let T=0;T<l.length;T+=1)l[T]&&l[T].m(s,null);ds(s,r[0],!0),a||(h=[Rt(s,"change",r[3]),Rt(s,"change",r[2])],a=!0)},p(x,[S]){if(S&2){m=Vn(x[1]);let T;for(T=0;T<m.length;T+=1){const C=Uy(x,m,T);l[T]?l[T].p(C,S):(l[T]=jy(C),l[T].c(),l[T].m(s,null))}for(;T<l.length;T+=1)l[T].d(1);l.length=m.length}S&3&&ds(s,x[0])},i:tt,o:tt,d(x){x&&oe(e),Er(l,x),a=!1,$i(h)}}}function QS(r,e,n){let{area:s}=e,a=["REGION_Aberdeen and North East","REGION_Edinburgh and Lothians","REGION_Glasgow and Strathclyde","REGION_Highlands and Islands","REGION_Scotland South","REGION_Tayside, Central and Fife","LAD_Clackmannanshire","LAD_Dumfries and Galloway","LAD_East Ayrshire","LAD_East Lothian","LAD_East Renfrewshire","LAD_Na h-Eileanan Siar","LAD_Falkirk","LAD_Highland","LAD_Inverclyde","LAD_Midlothian","LAD_Moray","LAD_North Ayrshire","LAD_Orkney Islands","LAD_Scottish Borders","LAD_Shetland Islands","LAD_South Ayrshire","LAD_South Lanarkshire","LAD_Stirling","LAD_Aberdeen City","LAD_Aberdeenshire","LAD_Argyll and Bute","LAD_City of Edinburgh","LAD_Renfrewshire","LAD_West Dunbartonshire","LAD_West Lothian","LAD_Angus","LAD_Dundee City","LAD_East Dunbartonshire","LAD_Fife","LAD_Perth and Kinross","LAD_Glasgow City","LAD_North Lanarkshire"];a.sort();function h(){window.location.href=`index.html?boundary=${s}`}function m(){s=yl(this),n(0,s),n(1,a)}return r.$$set=l=>{"area"in l&&n(0,s=l.area)},[s,a,h,m]}class eE extends fn{constructor(e){super(),hn(this,e,QS,JS,an,{area:0})}}const{window:tE}=J0;function qy(r,e,n){const s=r.slice();return s[19]=e[n],s}function Vy(r){let e,n,s=Vn(r[0].features),a=[];for(let m=0;m<s.length;m+=1)a[m]=Gy(qy(r,s,m));const h=m=>Se(a[m],1,1,()=>{a[m]=null});return{c(){e=le("ol");for(let m=0;m<a.length;m+=1)a[m].c()},m(m,l){ae(m,e,l);for(let x=0;x<a.length;x+=1)a[x]&&a[x].m(e,null);n=!0},p(m,l){if(l&65){s=Vn(m[0].features);let x;for(x=0;x<s.length;x+=1){const S=qy(m,s,x);a[x]?(a[x].p(S,l),ge(a[x],1)):(a[x]=Gy(S),a[x].c(),ge(a[x],1),a[x].m(e,null))}for(zn(),x=s.length;x<a.length;x+=1)h(x);Fn()}},i(m){if(!n){for(let l=0;l<s.length;l+=1)ge(a[l]);n=!0}},o(m){a=a.filter(Boolean);for(let l=0;l<a.length;l+=1)Se(a[l]);n=!1},d(m){m&&oe(e),Er(a,m)}}}function nE(r){var l,x;let e=(((l=r[19].properties)==null?void 0:l.name)||`Untitled route ${r[19].id}`)+"",n,s,a=((x=r[19].properties)==null?void 0:x.infra_type)+"",h,m;return{c(){n=ze(e),s=ze(" ("),h=ze(a),m=ze(")")},m(S,T){ae(S,n,T),ae(S,s,T),ae(S,h,T),ae(S,m,T)},p(S,T){var C,N;T&1&&e!==(e=(((C=S[19].properties)==null?void 0:C.name)||`Untitled route ${S[19].id}`)+"")&&Ct(n,e),T&1&&a!==(a=((N=S[19].properties)==null?void 0:N.infra_type)+"")&&Ct(h,a)},d(S){S&&(oe(n),oe(s),oe(h),oe(m))}}}function Gy(r){let e,n,s,a;function h(){return r[15](r[19])}return n=new VS({props:{$$slots:{default:[nE]},$$scope:{ctx:r}}}),n.$on("click",h),{c(){e=le("li"),ot(n.$$.fragment),s=Oe()},m(m,l){ae(m,e,l),it(n,e,null),Z(e,s),a=!0},p(m,l){r=m;const x={};l&4194305&&(x.$$scope={dirty:l,ctx:r}),n.$set(x)},i(m){a||(ge(n.$$.fragment,m),a=!0)},o(m){Se(n.$$.fragment,m),a=!1},d(m){m&&oe(e),rt(n)}}}function iE(r){let e,n,s,a,h,m,l,x,S,T,C,N,B,U,ee,ie,se,Q,Y,_e,ve,Ae;n=new eE({props:{area:r[3]}});let ce=r[0]&&Vy(r);return Y=new HS({}),{c(){e=le("div"),ot(n.$$.fragment),s=Oe(),a=le("div"),h=le("button"),h.innerHTML=`Draw new <u>r</u>
        oute line`,m=Oe(),l=le("button"),l.textContent="Clear all",x=Oe(),S=le("label"),T=le("input"),C=ze(`
      Show current network`),N=Oe(),B=le("details"),U=le("summary"),U.textContent="Current network routes",ee=Oe(),ce&&ce.c(),ie=Oe(),se=le("hr"),Q=Oe(),ot(Y.$$.fragment),Ze(l,"class","secondary"),Ze(T,"type","checkbox"),Ze(e,"slot","left")},m(xe,be){ae(xe,e,be),it(n,e,null),Z(e,s),Z(e,a),Z(a,h),Z(a,m),Z(a,l),Z(e,x),Z(e,S),Z(S,T),T.checked=r[2],Z(S,C),Z(e,N),Z(e,B),Z(B,U),Z(B,ee),ce&&ce.m(B,null),Z(e,ie),Z(e,se),Z(e,Q),it(Y,e,null),_e=!0,ve||(Ae=[Rt(h,"click",r[13]),Rt(l,"click",r[7]),Rt(T,"change",r[14])],ve=!0)},p(xe,be){const Le={};be&8&&(Le.area=xe[3]),n.$set(Le),be&4&&(T.checked=xe[2]),xe[0]?ce?(ce.p(xe,be),be&1&&ge(ce,1)):(ce=Vy(xe),ce.c(),ge(ce,1),ce.m(B,null)):ce&&(zn(),Se(ce,1,1,()=>{ce=null}),Fn())},i(xe){_e||(ge(n.$$.fragment,xe),ge(ce),ge(Y.$$.fragment,xe),_e=!0)},o(xe){Se(n.$$.fragment,xe),Se(ce),Se(Y.$$.fragment,xe),_e=!1},d(xe){xe&&oe(e),rt(n),ce&&ce.d(),rt(Y),ve=!1,$i(Ae)}}}function Zy(r){let e,n;return e=new rr({props:{data:r[0],$$slots:{default:[oE]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&1&&(h.data=s[0]),a&4194308&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function rE(r){let e=(r[18].name||"Untitled")+"",n,s,a=ou[r[18].infra_type][0]+"",h,m,l=r[18].tier+"",x,S;return{c(){n=ze(e),s=ze(" ("),h=ze(a),m=ze(`,
            `),x=ze(l),S=ze(")")},m(T,C){ae(T,n,C),ae(T,s,C),ae(T,h,C),ae(T,m,C),ae(T,x,C),ae(T,S,C)},p(T,C){C&262144&&e!==(e=(T[18].name||"Untitled")+"")&&Ct(n,e),C&262144&&a!==(a=ou[T[18].infra_type][0]+"")&&Ct(h,a),C&262144&&l!==(l=T[18].tier+"")&&Ct(x,l)},d(T){T&&(oe(n),oe(s),oe(h),oe(m),oe(x),oe(S))}}}function sE(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[rE,({props:s})=>({18:s}),({props:s})=>s?262144:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&4456448&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function oE(r){let e,n;return e=new _r({props:{id:"routes",paint:{"line-width":Ls(5,7),"line-color":ac},layout:{visibility:r[2]?"visible":"none"},manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[sE]},$$scope:{ctx:r}}}),e.$on("click",r[5]),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&4&&(h.layout={visibility:s[2]?"visible":"none"}),a&4194304&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function aE(r){let e,n,s=r[0]&&Zy(r);return{c(){e=le("div"),s&&s.c(),Ze(e,"slot","map")},m(a,h){ae(a,e,h),s&&s.m(e,null),n=!0},p(a,h){a[0]?s?(s.p(a,h),h&1&&ge(s,1)):(s=Zy(a),s.c(),ge(s,1),s.m(e,null)):s&&(zn(),Se(s,1,1,()=>{s=null}),Fn())},i(a){n||(ge(s),n=!0)},o(a){Se(s),n=!1},d(a){a&&oe(e),s&&s.d()}}}function lE(r){let e,n,s,a,h,m,l,x,S,T,C,N,B,U,ee,ie,se;return n=new YS({}),{c(){e=le("div"),ot(n.$$.fragment),s=Oe(),a=le("div"),h=le("button"),h.textContent="Evaluate a route",m=Oe(),l=le("div"),x=le("button"),x.textContent="Evaluate OD",S=Oe(),T=le("div"),C=le("button"),C.textContent="Debug network",N=Oe(),B=le("div"),U=le("button"),U.textContent="Debug mesh density",Ze(h,"class","secondary"),Ze(x,"class","secondary"),Ze(C,"class","secondary"),Ze(U,"class","secondary"),Ze(e,"slot","right")},m(Q,Y){ae(Q,e,Y),it(n,e,null),Z(e,s),Z(e,a),Z(a,h),Z(e,m),Z(e,l),Z(l,x),Z(e,S),Z(e,T),Z(T,C),Z(e,N),Z(e,B),Z(B,U),ee=!0,ie||(se=[Rt(h,"click",r[9]),Rt(x,"click",r[10]),Rt(C,"click",r[11]),Rt(U,"click",r[12])],ie=!0)},p:tt,i(Q){ee||(ge(n.$$.fragment,Q),ee=!0)},o(Q){Se(n.$$.fragment,Q),ee=!1},d(Q){Q&&oe(e),rt(n),ie=!1,$i(se)}}}function uE(r){let e,n,s,a;return e=new gc({props:{$$slots:{right:[lE],map:[aE],left:[iE]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(h,m){it(e,h,m),n=!0,s||(a=Rt(tE,"keydown",r[4]),s=!0)},p(h,[m]){const l={};m&4194319&&(l.$$scope={dirty:m,ctx:h}),e.$set(l)},i(h){n||(ge(e.$$.fragment,h),n=!0)},o(h){Se(e.$$.fragment,h),n=!1},d(h){rt(e,h),s=!1,a()}}}function cE(r,e,n){let s,a,h,m,l;zt(r,sr,ve=>n(16,s=ve)),zt(r,Oi,ve=>n(1,a=ve)),zt(r,Ph,ve=>n(8,h=ve)),zt(r,zp,ve=>n(2,m=ve)),zt(r,Hf,ve=>n(3,l=ve));let x=null;cc(S);async function S(){n(0,x=await s.renderRoutes())}function T(ve){ve.key=="r"&&(ve.preventDefault(),Dn(Oi,a={kind:"edit-route",id:null},a))}function C(ve){Dn(Oi,a={kind:"edit-route",id:ve.detail.features[0].id},a)}function N(ve){Dn(Oi,a={kind:"edit-route",id:ve},a)}async function B(){window.confirm("Clear everything? You can't undo this")&&(await(s==null?void 0:s.clearAllRoutes()),await Dh(),await S())}const U=()=>Dn(Oi,a={kind:"evaluate-route",browse:[]},a),ee=()=>Dn(Oi,a={kind:"evaluate-od"},a),ie=()=>Dn(Oi,a={kind:"debug-network"},a),se=()=>Dn(Oi,a={kind:"debug-mesh-density"},a),Q=()=>Dn(Oi,a={kind:"edit-route",id:null},a);function Y(){m=this.checked,zp.set(m)}const _e=ve=>N(ve.id);return r.$$.update=()=>{r.$$.dirty&256&&h>0&&S()},[x,a,m,l,T,C,N,B,h,U,ee,ie,se,Q,Y,_e]}class hE extends fn{constructor(e){super(),hn(this,e,cE,uE,an,{})}}function fE(r,e,n){const s=r.slice();return s[0]=e[n][0],s[1]=e[n][1],s[2]=e[n][2],s}function dE(r){let e,n,s;return{c(){e=le("span"),e.textContent=`${r[1]}`,n=Oe(),s=le("br"),Rn(e,"color",r[2])},m(a,h){ae(a,e,h),ae(a,n,h),ae(a,s,h)},p:tt,d(a){a&&(oe(e),oe(n),oe(s))}}}function pE(r){let e,n,s,a,h=Vn(em),m=[];for(let l=0;l<h.length;l+=1)m[l]=dE(fE(r,h,l));return{c(){e=le("div"),n=le("details"),s=le("summary"),s.textContent="Legend",a=Oe();for(let l=0;l<m.length;l+=1)m[l].c();Ze(e,"class","svelte-1oq1sox")},m(l,x){ae(l,e,x),Z(e,n),Z(n,s),Z(n,a);for(let S=0;S<m.length;S+=1)m[S]&&m[S].m(n,null)},p:tt,i:tt,o:tt,d(l){l&&oe(e),Er(m,l)}}}class mE extends fn{constructor(e){super(),hn(this,e,null,pE,an,{})}}const gE="/npw/assets/help-d011708a.svg";function Hy(r){let e,n;return e=new Kv({props:{$$slots:{default:[_E]},$$scope:{ctx:r}}}),e.$on("close",r[3]),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&16&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function _E(r){let e,n,s;const a=r[1].default,h=Zi(a,r,r[4],null);return{c(){e=le("h2"),e.textContent="Help",n=Oe(),h&&h.c()},m(m,l){ae(m,e,l),ae(m,n,l),h&&h.m(m,l),s=!0},p(m,l){h&&h.p&&(!s||l&16)&&Xi(h,a,m,m[4],s?Hi(a,m[4],l,null):Wi(m[4]),null)},i(m){s||(ge(h,m),s=!0)},o(m){Se(h,m),s=!1},d(m){m&&(oe(e),oe(n)),h&&h.d(m)}}}function yE(r){let e,n,s,a,h,m,l=r[0]&&Hy(r);return{c(){e=le("button"),e.innerHTML=`<img src="${gE}" title="Help" alt="Help"/>`,n=Oe(),l&&l.c(),s=ii(),Ze(e,"class","svelte-gb6dzm")},m(x,S){ae(x,e,S),ae(x,n,S),l&&l.m(x,S),ae(x,s,S),a=!0,h||(m=Rt(e,"click",r[2]),h=!0)},p(x,[S]){x[0]?l?(l.p(x,S),S&1&&ge(l,1)):(l=Hy(x),l.c(),ge(l,1),l.m(s.parentNode,s)):l&&(zn(),Se(l,1,1,()=>{l=null}),Fn())},i(x){a||(ge(l),a=!0)},o(x){Se(l),a=!1},d(x){x&&(oe(e),oe(n),oe(s)),l&&l.d(x),h=!1,m()}}}function vE(r,e,n){let{$$slots:s={},$$scope:a}=e,h=!1;const m=()=>n(0,h=!0),l=()=>n(0,h=!1);return r.$$set=x=>{"$$scope"in x&&n(4,a=x.$$scope)},[h,s,m,l,a]}class e1 extends fn{constructor(e){super(),hn(this,e,vE,yE,an,{})}}function Xy(r,e,n){const s=r.slice();return s[1]=e[n][0],s[2]=e[n][1],s}function Wy(r){let e,n,s,a=r[1]+"",h,m;return{c(){e=le("li"),n=le("span"),s=Oe(),h=ze(a),m=Oe(),Ze(n,"class","svelte-kzgqtg"),Rn(n,"background",r[2])},m(l,x){ae(l,e,x),Z(e,n),Z(e,s),Z(e,h),Z(e,m)},p(l,x){x&1&&Rn(n,"background",l[2]),x&1&&a!==(a=l[1]+"")&&Ct(h,a)},d(l){l&&oe(e)}}}function bE(r){let e,n=Vn(Object.entries(r[0])),s=[];for(let a=0;a<n.length;a+=1)s[a]=Wy(Xy(r,n,a));return{c(){e=le("ul");for(let a=0;a<s.length;a+=1)s[a].c()},m(a,h){ae(a,e,h);for(let m=0;m<s.length;m+=1)s[m]&&s[m].m(e,null)},p(a,[h]){if(h&1){n=Vn(Object.entries(a[0]));let m;for(m=0;m<n.length;m+=1){const l=Xy(a,n,m);s[m]?s[m].p(l,h):(s[m]=Wy(l),s[m].c(),s[m].m(e,null))}for(;m<s.length;m+=1)s[m].d(1);s.length=n.length}},i:tt,o:tt,d(a){a&&oe(e),Er(s,a)}}}function xE(r,e,n){let{colors:s}=e;return r.$$set=a=>{"colors"in a&&n(0,s=a.colors)},[s]}class _c extends fn{constructor(e){super(),hn(this,e,xE,bE,an,{colors:0})}}let un;const t1=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&t1.decode();let vh=null;function Eh(){return(vh===null||vh.byteLength===0)&&(vh=new Uint8Array(un.memory.buffer)),vh}function _o(r,e){return r=r>>>0,t1.decode(Eh().subarray(r,r+e))}const Ra=new Array(128).fill(void 0);Ra.push(void 0,null,!0,!1);let Ah=Ra.length;function lr(r){Ah===Ra.length&&Ra.push(Ra.length+1);const e=Ah;return Ah=Ra[e],Ra[e]=r,e}function Xn(r){return Ra[r]}function wE(r){r<132||(Ra[r]=Ah,Ah=r)}function $u(r){const e=Xn(r);return wE(r),e}function hp(r){return r==null}let bh=null;function kE(){return(bh===null||bh.byteLength===0)&&(bh=new Float64Array(un.memory.buffer)),bh}let xh=null;function li(){return(xh===null||xh.byteLength===0)&&(xh=new Int32Array(un.memory.buffer)),xh}let bl=0;const Pf=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},IE=typeof Pf.encodeInto=="function"?function(r,e){return Pf.encodeInto(r,e)}:function(r,e){const n=Pf.encode(r);return e.set(n),{read:r.length,written:n.length}};function kf(r,e,n){if(n===void 0){const l=Pf.encode(r),x=e(l.length,1)>>>0;return Eh().subarray(x,x+l.length).set(l),bl=l.length,x}let s=r.length,a=e(s,1)>>>0;const h=Eh();let m=0;for(;m<s;m++){const l=r.charCodeAt(m);if(l>127)break;h[a+m]=l}if(m!==s){m!==0&&(r=r.slice(m)),a=n(a,s,s=m+r.length*3,1)>>>0;const l=Eh().subarray(a+m,a+s),x=IE(r,l);m+=x.written}return bl=m,a}function Bp(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const a=r.description;return a==null?"Symbol":`Symbol(${a})`}if(e=="function"){const a=r.name;return typeof a=="string"&&a.length>0?`Function(${a})`:"Function"}if(Array.isArray(r)){const a=r.length;let h="[";a>0&&(h+=Bp(r[0]));for(let m=1;m<a;m++)h+=", "+Bp(r[m]);return h+="]",h}const n=/\[object ([^\]]+)\]/.exec(toString.call(r));let s;if(n.length>1)s=n[1];else return toString.call(r);if(s=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:s}function SE(r,e){const n=e(r.length*1,1)>>>0;return Eh().set(r,n/1),bl=r.length,n}function fp(r,e){try{return r.apply(this,e)}catch(n){un.__wbindgen_exn_store(lr(n))}}class Jf{static __wrap(e){e=e>>>0;const n=Object.create(Jf.prototype);return n.__wbg_ptr=e,n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();un.__wbg_jsroutesnapper_free(e)}constructor(e){try{const h=un.__wbindgen_add_to_stack_pointer(-16),m=SE(e,un.__wbindgen_malloc),l=bl;un.jsroutesnapper_new(h,m,l);var n=li()[h/4+0],s=li()[h/4+1],a=li()[h/4+2];if(a)throw $u(s);return Jf.__wrap(n)}finally{un.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){un.jsroutesnapper_setRouteConfig(this.__wbg_ptr,lr(e))}setAreaMode(){un.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,n;try{const h=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_getConfig(h,this.__wbg_ptr);var s=li()[h/4+0],a=li()[h/4+1];return e=s,n=a,_o(s,a)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(e,n,1)}}toFinalFeature(){try{const s=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_toFinalFeature(s,this.__wbg_ptr);var e=li()[s/4+0],n=li()[s/4+1];let a;return e!==0&&(a=_o(e,n).slice(),un.__wbindgen_free(e,n*1)),a}finally{un.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,n;try{const h=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_renderGeojson(h,this.__wbg_ptr);var s=li()[h/4+0],a=li()[h/4+1];return e=s,n=a,_o(s,a)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(e,n,1)}}toggleSnapMode(){un.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,n,s){return un.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,n,s)!==0}onClick(){un.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return un.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return un.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){un.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const a=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_editExisting(a,this.__wbg_ptr,lr(e));var n=li()[a/4+0],s=li()[a/4+1];if(s)throw $u(n)}finally{un.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,n;try{const h=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_debugRenderGraph(h,this.__wbg_ptr);var s=li()[h/4+0],a=li()[h/4+1];return e=s,n=a,_o(s,a)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(e,n,1)}}debugSnappableNodes(){let e,n;try{const h=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_debugSnappableNodes(h,this.__wbg_ptr);var s=li()[h/4+0],a=li()[h/4+1];return e=s,n=a,_o(s,a)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(e,n,1)}}routeNameForWaypoints(e){let n,s;try{const T=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_routeNameForWaypoints(T,this.__wbg_ptr,lr(e));var a=li()[T/4+0],h=li()[T/4+1],m=li()[T/4+2],l=li()[T/4+3],x=a,S=h;if(l)throw x=0,S=0,$u(m);return n=x,s=S,_o(x,S)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(n,s,1)}}addSnappedWaypoint(e,n){un.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,n)}undo(){un.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let n,s;try{const T=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_calculateRoute(T,this.__wbg_ptr,lr(e));var a=li()[T/4+0],h=li()[T/4+1],m=li()[T/4+2],l=li()[T/4+3],x=a,S=h;if(l)throw x=0,S=0,$u(m);return n=x,s=S,_o(x,S)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(n,s,1)}}getExtraNodes(e,n){let s,a;try{const C=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_getExtraNodes(C,this.__wbg_ptr,lr(e),lr(n));var h=li()[C/4+0],m=li()[C/4+1],l=li()[C/4+2],x=li()[C/4+3],S=h,T=m;if(x)throw S=0,T=0,$u(l);return s=S,a=T,_o(S,T)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(s,a,1)}}}async function EE(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(s){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",s);else throw s}const n=await r.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(r,e);return n instanceof WebAssembly.Instance?{instance:n,module:r}:n}}function AE(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,n){const s=_o(e,n);return lr(s)},r.wbg.__wbindgen_object_drop_ref=function(e){$u(e)},r.wbg.__wbindgen_error_new=function(e,n){const s=new Error(_o(e,n));return lr(s)},r.wbg.__wbindgen_number_get=function(e,n){const s=Xn(n),a=typeof s=="number"?s:void 0;kE()[e/8+1]=hp(a)?0:a,li()[e/4+0]=!hp(a)},r.wbg.__wbindgen_is_object=function(e){const n=Xn(e);return typeof n=="object"&&n!==null},r.wbg.__wbindgen_is_undefined=function(e){return Xn(e)===void 0},r.wbg.__wbindgen_in=function(e,n){return Xn(e)in Xn(n)},r.wbg.__wbindgen_boolean_get=function(e){const n=Xn(e);return typeof n=="boolean"?n?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,n){return Xn(e)==Xn(n)},r.wbg.__wbindgen_string_get=function(e,n){const s=Xn(n),a=typeof s=="string"?s:void 0;var h=hp(a)?0:kf(a,un.__wbindgen_malloc,un.__wbindgen_realloc),m=bl;li()[e/4+1]=m,li()[e/4+0]=h},r.wbg.__wbg_String_4370c5505c674d30=function(e,n){const s=String(Xn(n)),a=kf(s,un.__wbindgen_malloc,un.__wbindgen_realloc),h=bl;li()[e/4+1]=h,li()[e/4+0]=a},r.wbg.__wbindgen_object_clone_ref=function(e){const n=Xn(e);return lr(n)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,n){const s=Xn(e)[Xn(n)];return lr(s)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return lr(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const s=Xn(n).stack,a=kf(s,un.__wbindgen_malloc,un.__wbindgen_realloc),h=bl;li()[e/4+1]=h,li()[e/4+0]=a},r.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let s,a;try{s=e,a=n,console.error(_o(e,n))}finally{un.__wbindgen_free(s,a,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Xn(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Xn(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Xn(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Xn(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Xn(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,n){const s=Xn(e)[n>>>0];return lr(s)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Xn(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Xn(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const n=Xn(e).next;return lr(n)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return fp(function(e){const n=Xn(e).next();return lr(n)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Xn(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const n=Xn(e).value;return lr(n)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return lr(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return fp(function(e,n){const s=Reflect.get(Xn(e),Xn(n));return lr(s)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return fp(function(e,n){const s=Xn(e).call(Xn(n));return lr(s)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Xn(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let n;try{n=Xn(e)instanceof ArrayBuffer}catch{n=!1}return n},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const n=Xn(e).buffer;return lr(n)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const n=new Uint8Array(Xn(e));return lr(n)},r.wbg.__wbg_set_5cf90238115182c3=function(e,n,s){Xn(e).set(Xn(n),s>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Xn(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let n;try{n=Xn(e)instanceof Uint8Array}catch{n=!1}return n},r.wbg.__wbindgen_debug_string=function(e,n){const s=Bp(Xn(n)),a=kf(s,un.__wbindgen_malloc,un.__wbindgen_realloc),h=bl;li()[e/4+1]=h,li()[e/4+0]=a},r.wbg.__wbindgen_throw=function(e,n){throw new Error(_o(e,n))},r.wbg.__wbindgen_memory=function(){const e=un.memory;return lr(e)},r}function TE(r,e){return un=r.exports,n1.__wbindgen_wasm_module=e,bh=null,xh=null,vh=null,un}async function n1(r){if(un!==void 0)return un;typeof r>"u"&&(r="/npw/assets/route_snapper_bg.wasm");const e=AE();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:n,module:s}=await EE(await r,e);return TE(n,s)}const CE=30;class LE{constructor(e,n,s,a,h){this.onMouseMove=m=>{if(!this.active)return;const l=[m.point.x-CE,m.point.y],x=this.map.unproject(m.point).distanceTo(this.map.unproject(l));this.inner.onMouseMove(m.lngLat.lng,m.lngLat.lat,x)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=m=>{this.active&&(m.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=m=>{if(!this.active)return;let l=m.target.tagName;l=="INPUT"||l=="TEXTAREA"||m.key=="Escape"&&(m.stopPropagation(),this.cancel())},this.onKeyPress=m=>{if(!this.active)return;let l=m.target.tagName;l=="INPUT"||l=="TEXTAREA"||(m.key=="Enter"?(m.stopPropagation(),this.finish()):m.key=="s"||m.key=="S"?(m.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):m.key=="z"&&m.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Jf(n),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=s,this.snapMode=a,this.undoLength=h,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let n of this.eventListenersSuccess)n(JSON.parse(e));else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let n of this.eventListenersUpdated)n(JSON.parse(e))}}let Qf=Jn(null);const go=Jn([]);const ME=r=>({}),Ky=r=>({}),RE=r=>({}),$y=r=>({});function Yy(r,e,n){const s=r.slice();return s[51]=e[n],s[52]=e,s[53]=n,s}function Jy(r,e,n){const s=r.slice();return s[54]=e[n],s[55]=e,s[56]=n,s}const PE=r=>({}),Qy=r=>({});function DE(r){let e,n=r[10].length+"",s,a;return{c(){e=ze("Undo ("),s=ze(n),a=ze(")")},m(h,m){ae(h,e,m),ae(h,s,m),ae(h,a,m)},p(h,m){m[0]&1024&&n!==(n=h[10].length+"")&&Ct(s,n)},d(h){h&&(oe(e),oe(s),oe(a))}}}function NE(r){let e;return{c(){e=ze("Undo")},m(n,s){ae(n,e,s)},p:tt,d(n){n&&oe(e)}}}function zE(r){let e,n,s,a,h;return{c(){e=le("ul"),e.innerHTML=`<li><b>Click</b>
          the map to add new points, while extending from the start or end</li> <li><b>Click and drag</b>
          any point to move it</li> <li><b>Click</b>
          a waypoint to toggle snapping</li> <li><b>Right click</b>
          a waypoint to delete it</li>`,n=Oe(),s=le("p"),s.textContent="Keyboard shortcuts:",a=Oe(),h=le("ul"),h.innerHTML=`<li><b>1</b>
          to extend from start</li> <li><b>2</b>
          to extend from end</li> <li><b>3</b>
          to drag middle points</li> <li><b>s</b>
          to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
          to undo your last change</li> <li><b>Enter</b>
          to finish</li> <li><b>Escape</b>
          to cancel</li>`},m(m,l){ae(m,e,l),ae(m,n,l),ae(m,s,l),ae(m,a,l),ae(m,h,l)},p:tt,d(m){m&&(oe(e),oe(n),oe(s),oe(a),oe(h))}}}function FE(r){let e,n,s,a,h,m,l,x,S,T,C,N,B,U,ee,ie,se,Q,Y,_e,ve,Ae,ce,xe,be,Le,ke,ye,Ue,qe,pt,St,dt,ut,Ut,vt,kt,ft,wt,It,$t,pn,Pn,We,Wn,dn,Ot,Ee,lt,Ye,Lt,Ke,On;function bt(Qn,Jt){return Qn[10].length==0?NE:DE}let Ie=bt(r),Bt=Ie(r);ee=new e1({props:{$$slots:{default:[zE]},$$scope:{ctx:r}}});const Mn=r[29]["extra-left"],Nn=Zi(Mn,r,r[46],Ky);return Ye=qg(r[40][0]),Lt=qg(r[40][1]),{c(){e=le("div"),n=le("h2"),n.textContent="Editing a route",s=Oe(),a=le("button"),h=ze("Finish"),l=Oe(),x=le("button"),Bt.c(),T=Oe(),C=le("button"),C.textContent="Delete",N=Oe(),B=le("button"),B.textContent="Cancel",U=Oe(),ot(ee.$$.fragment),ie=Oe(),se=le("fieldset"),Q=le("label"),Y=le("input"),_e=ze(`
        Snap to roads`),ve=Oe(),Ae=le("label"),ce=le("input"),xe=ze(`
        Draw anywhere`),be=Oe(),Le=le("fieldset"),ke=le("label"),ye=le("input"),Ue=ze(`
        Extend from start (
        `),qe=le("b"),qe.textContent="1",pt=ze(`
        )`),St=Oe(),dt=le("label"),ut=le("input"),Ut=ze(`
        Extend from end (
        `),vt=le("b"),vt.textContent="2",kt=ze(`
        )`),ft=Oe(),wt=le("label"),It=le("input"),$t=ze(`
        Adjust middle points (
        `),pn=le("b"),pn.textContent="3",Pn=ze(`
        )`),We=Oe(),Wn=le("label"),dn=le("input"),Ot=ze(`
      Show major junctions`),Ee=Oe(),Nn&&Nn.c(),a.disabled=m=r[7].length<2,Ze(x,"class","secondary"),x.disabled=S=r[10].length==0,Ze(C,"class","secondary"),Ze(B,"class","secondary"),Ze(Y,"type","radio"),Y.__value="snap",ki(Y,Y.__value),Ze(ce,"type","radio"),ce.__value="free",ki(ce,ce.__value),Ze(ye,"type","radio"),ye.__value="append-start",ki(ye,ye.__value),Ze(ut,"type","radio"),ut.__value="append-end",ki(ut,ut.__value),Ze(It,"type","radio"),It.__value="adjust",ki(It,It.__value),Ze(dn,"type","checkbox"),Ze(e,"slot","left"),Ye.p(ye,ut,It),Lt.p(Y,ce)},m(Qn,Jt){ae(Qn,e,Jt),Z(e,n),Z(e,s),Z(e,a),Z(a,h),Z(e,l),Z(e,x),Bt.m(x,null),Z(e,T),Z(e,C),Z(e,N),Z(e,B),Z(e,U),it(ee,e,null),Z(e,ie),Z(e,se),Z(se,Q),Z(Q,Y),Y.checked=Y.__value===r[9],Z(Q,_e),Z(se,ve),Z(se,Ae),Z(Ae,ce),ce.checked=ce.__value===r[9],Z(Ae,xe),Z(e,be),Z(e,Le),Z(Le,ke),Z(ke,ye),ye.checked=ye.__value===r[3],Z(ke,Ue),Z(ke,qe),Z(ke,pt),Z(Le,St),Z(Le,dt),Z(dt,ut),ut.checked=ut.__value===r[3],Z(dt,Ut),Z(dt,vt),Z(dt,kt),Z(Le,ft),Z(Le,wt),Z(wt,It),It.checked=It.__value===r[3],Z(wt,$t),Z(wt,pn),Z(wt,Pn),Z(e,We),Z(e,Wn),Z(Wn,dn),dn.checked=r[13],Z(Wn,Ot),Z(e,Ee),Nn&&Nn.m(e,null),lt=!0,Ke||(On=[Rt(a,"click",function(){iu(r[0])&&r[0].apply(this,arguments)}),Rt(x,"click",r[14]),Rt(C,"click",function(){iu(r[2])&&r[2].apply(this,arguments)}),Rt(B,"click",function(){iu(r[1])&&r[1].apply(this,arguments)}),Rt(Y,"change",r[39]),Rt(Y,"change",r[15]),Rt(ce,"change",r[41]),Rt(ce,"change",r[15]),Rt(ye,"change",r[42]),Rt(ut,"change",r[43]),Rt(It,"change",r[44]),Rt(dn,"change",r[45])],Ke=!0)},p(Qn,Jt){r=Qn,(!lt||Jt[0]&128&&m!==(m=r[7].length<2))&&(a.disabled=m),Ie===(Ie=bt(r))&&Bt?Bt.p(r,Jt):(Bt.d(1),Bt=Ie(r),Bt&&(Bt.c(),Bt.m(x,null))),(!lt||Jt[0]&1024&&S!==(S=r[10].length==0))&&(x.disabled=S);const Ri={};Jt[1]&32768&&(Ri.$$scope={dirty:Jt,ctx:r}),ee.$set(Ri),Jt[0]&512&&(Y.checked=Y.__value===r[9]),Jt[0]&512&&(ce.checked=ce.__value===r[9]),Jt[0]&8&&(ye.checked=ye.__value===r[3]),Jt[0]&8&&(ut.checked=ut.__value===r[3]),Jt[0]&8&&(It.checked=It.__value===r[3]),Jt[0]&8192&&(dn.checked=r[13]),Nn&&Nn.p&&(!lt||Jt[1]&32768)&&Xi(Nn,Mn,r,r[46],lt?Hi(Mn,r[46],Jt,ME):Wi(r[46]),Ky)},i(Qn){lt||(ge(ee.$$.fragment,Qn),ge(Nn,Qn),lt=!0)},o(Qn){Se(ee.$$.fragment,Qn),Se(Nn,Qn),lt=!1},d(Qn){Qn&&oe(e),Bt.d(),rt(ee),Nn&&Nn.d(Qn),Ye.r(),Lt.r(),Ke=!1,$i(On)}}}function OE(r){let e;return{c(){e=le("span"),Ze(e,"class","dot svelte-1cj4rwq"),Sr(e,"snapped-node",r[54].snapped),Sr(e,"free-node",!r[54].snapped),Sr(e,"hide",r[6])},m(n,s){ae(n,e,s)},p(n,s){s[0]&2048&&Sr(e,"snapped-node",n[54].snapped),s[0]&2048&&Sr(e,"free-node",!n[54].snapped),s[0]&64&&Sr(e,"hide",n[6])},d(n){n&&oe(e)}}}function e0(r){let e,n,s;function a(x){r[30](x,r[54])}function h(){return r[31](r[54])}function m(){return r[32](r[54])}let l={draggable:!0,zIndex:0,$$slots:{default:[OE]},$$scope:{ctx:r}};return r[54].point!==void 0&&(l.lngLat=r[54].point),e=new Zf({props:l}),$n.push(()=>gr(e,"lngLat",a)),e.$on("dragstart",h),e.$on("drag",m),e.$on("dragend",r[23]),{c(){ot(e.$$.fragment)},m(x,S){it(e,x,S),s=!0},p(x,S){r=x;const T={};S[0]&2112|S[1]&32768&&(T.$$scope={dirty:S,ctx:r}),!n&&S[0]&2048&&(n=!0,T.lngLat=r[54].point,mr(()=>n=!1)),e.$set(T)},i(x){s||(ge(e.$$.fragment,x),s=!0)},o(x){Se(e.$$.fragment,x),s=!1},d(x){rt(e,x)}}}function BE(r){let e;return{c(){e=le("span"),e.textContent=`${r[53]+1}`,Ze(e,"class","dot svelte-1cj4rwq"),Sr(e,"snapped",r[51].snapped)},m(n,s){ae(n,e,s)},p(n,s){s[0]&128&&Sr(e,"snapped",n[51].snapped)},d(n){n&&oe(e)}}}function t0(r){let e,n,s;function a(x){r[33](x,r[51])}function h(){return r[34](r[53])}function m(){return r[35](r[53])}let l={draggable:!0,zIndex:1,$$slots:{default:[BE]},$$scope:{ctx:r}};return r[51].point!==void 0&&(l.lngLat=r[51].point),e=new Zf({props:l}),$n.push(()=>gr(e,"lngLat",a)),e.$on("click",h),e.$on("contextmenu",m),e.$on("mouseenter",r[36]),e.$on("mouseleave",r[37]),e.$on("dragstart",r[25]),e.$on("dragend",r[38]),{c(){ot(e.$$.fragment)},m(x,S){it(e,x,S),s=!0},p(x,S){r=x;const T={};S[0]&128|S[1]&32768&&(T.$$scope={dirty:S,ctx:r}),!n&&S[0]&128&&(n=!0,T.lngLat=r[51].point,mr(()=>n=!1)),e.$set(T)},i(x){s||(ge(e.$$.fragment,x),s=!0)},o(x){Se(e.$$.fragment,x),s=!1},d(x){rt(e,x)}}}function UE(r){let e,n;return e=new _r({props:{paint:{"line-color":"black","line-width":10}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p:tt,i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function jE(r){let e,n;return e=new _r({props:{paint:{"line-color":"black","line-width":3}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p:tt,i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function qE(r){let e,n,s,a,h,m,l,x,S,T;n=new Wv({}),n.$on("click",r[16]),n.$on("mousemove",r[17]);let C=Vn(r[11]),N=[];for(let Y=0;Y<C.length;Y+=1)N[Y]=e0(Jy(r,C,Y));const B=Y=>Se(N[Y],1,1,()=>{N[Y]=null});let U=Vn(r[7]),ee=[];for(let Y=0;Y<U.length;Y+=1)ee[Y]=t0(Yy(r,U,Y));const ie=Y=>Se(ee[Y],1,1,()=>{ee[Y]=null});m=new rr({props:{data:r[20](r[8],r[7]),generateId:!0,$$slots:{default:[UE]},$$scope:{ctx:r}}}),x=new rr({props:{data:r[12],$$slots:{default:[jE]},$$scope:{ctx:r}}});const se=r[29]["extra-map"],Q=Zi(se,r,r[46],$y);return{c(){e=le("div"),ot(n.$$.fragment),s=Oe();for(let Y=0;Y<N.length;Y+=1)N[Y].c();a=Oe();for(let Y=0;Y<ee.length;Y+=1)ee[Y].c();h=Oe(),ot(m.$$.fragment),l=Oe(),ot(x.$$.fragment),S=Oe(),Q&&Q.c(),Ze(e,"slot","map")},m(Y,_e){ae(Y,e,_e),it(n,e,null),Z(e,s);for(let ve=0;ve<N.length;ve+=1)N[ve]&&N[ve].m(e,null);Z(e,a);for(let ve=0;ve<ee.length;ve+=1)ee[ve]&&ee[ve].m(e,null);Z(e,h),it(m,e,null),Z(e,l),it(x,e,null),Z(e,S),Q&&Q.m(e,null),T=!0},p(Y,_e){if(_e[0]&14682176){C=Vn(Y[11]);let ce;for(ce=0;ce<C.length;ce+=1){const xe=Jy(Y,C,ce);N[ce]?(N[ce].p(xe,_e),ge(N[ce],1)):(N[ce]=e0(xe),N[ce].c(),ge(N[ce],1),N[ce].m(e,a))}for(zn(),ce=C.length;ce<N.length;ce+=1)B(ce);Fn()}if(_e[0]&34341040){U=Vn(Y[7]);let ce;for(ce=0;ce<U.length;ce+=1){const xe=Yy(Y,U,ce);ee[ce]?(ee[ce].p(xe,_e),ge(ee[ce],1)):(ee[ce]=t0(xe),ee[ce].c(),ge(ee[ce],1),ee[ce].m(e,h))}for(zn(),ce=U.length;ce<ee.length;ce+=1)ie(ce);Fn()}const ve={};_e[0]&384&&(ve.data=Y[20](Y[8],Y[7])),_e[1]&32768&&(ve.$$scope={dirty:_e,ctx:Y}),m.$set(ve);const Ae={};_e[0]&4096&&(Ae.data=Y[12]),_e[1]&32768&&(Ae.$$scope={dirty:_e,ctx:Y}),x.$set(Ae),Q&&Q.p&&(!T||_e[1]&32768)&&Xi(Q,se,Y,Y[46],T?Hi(se,Y[46],_e,RE):Wi(Y[46]),$y)},i(Y){if(!T){ge(n.$$.fragment,Y);for(let _e=0;_e<C.length;_e+=1)ge(N[_e]);for(let _e=0;_e<U.length;_e+=1)ge(ee[_e]);ge(m.$$.fragment,Y),ge(x.$$.fragment,Y),ge(Q,Y),T=!0}},o(Y){Se(n.$$.fragment,Y),N=N.filter(Boolean);for(let _e=0;_e<N.length;_e+=1)Se(N[_e]);ee=ee.filter(Boolean);for(let _e=0;_e<ee.length;_e+=1)Se(ee[_e]);Se(m.$$.fragment,Y),Se(x.$$.fragment,Y),Se(Q,Y),T=!1},d(Y){Y&&oe(e),rt(n),Er(N,Y),Er(ee,Y),rt(m),rt(x),Q&&Q.d(Y)}}}function VE(r){let e,n;const s=r[29]["extra-right"],a=Zi(s,r,r[46],Qy);return{c(){e=le("div"),a&&a.c(),Ze(e,"slot","right")},m(h,m){ae(h,e,m),a&&a.m(e,null),n=!0},p(h,m){a&&a.p&&(!n||m[1]&32768)&&Xi(a,s,h,h[46],n?Hi(s,h[46],m,PE):Wi(h[46]),Qy)},i(h){n||(ge(a,h),n=!0)},o(h){Se(a,h),n=!1},d(h){h&&oe(e),a&&a.d(h)}}}function GE(r){let e,n,s,a;return e=new gc({props:{$$slots:{right:[VE],map:[qE],left:[FE]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(h,m){it(e,h,m),n=!0,s||(a=Rt(window,"keydown",r[24]),s=!0)},p(h,m){const l={};m[0]&16383|m[1]&32768&&(l.$$scope={dirty:m,ctx:h}),e.$set(l)},i(h){n||(ge(e.$$.fragment,h),n=!0)},o(h){Se(e.$$.fragment,h),n=!1},d(h){rt(e,h),s=!1,a()}}}function ZE(r,e,n){let s,a,h,m;zt(r,go,bt=>n(7,a=bt)),zt(r,Qf,bt=>n(8,h=bt)),zt(r,Fp,bt=>n(13,m=bt));let{$$slots:l={},$$scope:x}=e,{map:S}=e,{finish:T}=e,{cancel:C}=e,{deleteRoute:N}=e,{editingExisting:B}=e;vo(()=>{Dn(go,a=[],a),h==null||h.stop(),S.getCanvas().style.cursor="inherit"});let U=B?"adjust":"append-end",ee="snap",ie=[],se=[],Q=null,Y=!1,_e=!1,ve=!1;function Ae(bt){let Ie=bt.length==0?"crosshair":"inherit";S.getCanvas().style.cursor=Ie}function ce(){let bt=ie.pop();n(10,ie),bt&&Dn(go,a=bt,a)}function xe(){ie.length==100&&ie.shift(),n(10,ie=[...ie,JSON.parse(JSON.stringify(a))])}function be(){n(9,ee=ee=="snap"?"free":"snap"),Q&&n(28,Q.snapped=ee=="snap",Q)}function Le(bt){xe(),go.update(Ie=>(U=="append-start"?Ie.splice(0,0,{point:bt.detail.lngLat.toArray(),snapped:ee=="snap"}):U=="append-end"&&Ie.push({point:bt.detail.lngLat.toArray(),snapped:ee=="snap"}),Ie))}function ke(bt){n(28,Q={point:bt.detail.lngLat.toArray(),snapped:ee=="snap"})}function ye(bt){xe(),go.update(Ie=>(Ie[bt].snapped=!Ie[bt].snapped,Ie))}function Ue(bt){xe(),go.update(Ie=>(Ie.splice(bt,1),Ie)),n(4,Y=!1)}function qe(bt,Ie){try{if(bt)return JSON.parse(bt.inner.calculateRoute(Ie))}catch{}return Mf()}function pt(bt,Ie,Bt,Mn,Nn){if(Nn)return Mf();try{if(bt&&Ie.length>0&&Mn){if(Bt=="append-start")return JSON.parse(bt.inner.calculateRoute([Mn,Ie[0]]));if(Bt=="append-end")return JSON.parse(bt.inner.calculateRoute([Ie[Ie.length-1],Mn]))}}catch{}return Mf()}function St(bt,Ie,Bt,Mn){if(Mn)return;if(!bt||Bt!="adjust"){n(11,se=[]);return}let Nn=[],Qn=1;for(let Jt=0;Jt<Ie.length-1;Jt++){let Ri=JSON.parse(bt.inner.getExtraNodes(Ie[Jt],Ie[Jt+1]));for(let[Yi,Jr,ct]of Ri)Nn.push({point:[Yi,Jr],snapped:ct,insertIdx:Qn});Qn++}n(11,se=Nn)}function dt(bt){xe(),go.update(Ie=>(Ie.splice(bt.insertIdx,0,{point:bt.point,snapped:bt.snapped}),Ie)),n(6,ve=!0)}function ut(bt){go.update(Ie=>(Ie[bt.insertIdx].point=bt.point,Ie))}function Ut(){n(6,ve=!1)}function vt(bt){let Ie=bt.target.tagName,Bt=Ie=="INPUT"||Ie=="TEXTAREA";bt.key==="Enter"&&!Bt?(bt.stopPropagation(),a.length>=2&&T()):bt.key==="Escape"?(bt.stopPropagation(),C()):bt.key=="s"&&!Bt?be():bt.key=="1"&&!Bt?n(3,U="append-start"):bt.key=="2"&&!Bt?n(3,U="append-end"):bt.key=="3"&&!Bt?n(3,U="adjust"):bt.key=="z"&&bt.ctrlKey&&(bt.stopPropagation(),ce())}function kt(){xe(),n(5,_e=!0)}const ft=[[],[]];function wt(bt,Ie){r.$$.not_equal(Ie.point,bt)&&(Ie.point=bt,n(11,se))}const It=bt=>dt(bt),$t=bt=>ut(bt);function pn(bt,Ie){r.$$.not_equal(Ie.point,bt)&&(Ie.point=bt,go.set(a))}const Pn=bt=>ye(bt),We=bt=>Ue(bt),Wn=()=>n(4,Y=!0),dn=()=>n(4,Y=!1),Ot=()=>n(5,_e=!1);function Ee(){ee=this.__value,n(9,ee)}function lt(){ee=this.__value,n(9,ee)}function Ye(){U=this.__value,n(3,U)}function Lt(){U=this.__value,n(3,U)}function Ke(){U=this.__value,n(3,U)}function On(){m=this.checked,Fp.set(m)}return r.$$set=bt=>{"map"in bt&&n(26,S=bt.map),"finish"in bt&&n(0,T=bt.finish),"cancel"in bt&&n(1,C=bt.cancel),"deleteRoute"in bt&&n(2,N=bt.deleteRoute),"editingExisting"in bt&&n(27,B=bt.editingExisting),"$$scope"in bt&&n(46,x=bt.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&456&&St(h,a,U,ve),r.$$.dirty[0]&268435896&&n(12,s=pt(h,a,U,Q,Y||_e)),r.$$.dirty[0]&128&&Ae(a)},[T,C,N,U,Y,_e,ve,a,h,ee,ie,se,s,m,ce,be,Le,ke,ye,Ue,qe,dt,ut,Ut,vt,kt,S,B,Q,l,wt,It,$t,pn,Pn,We,Wn,dn,Ot,Ee,ft,lt,Ye,Lt,Ke,On,x]}class HE extends fn{constructor(e){super(),hn(this,e,ZE,GE,an,{map:26,finish:0,cancel:1,deleteRoute:2,editingExisting:27},null,[-1,-1])}}const XE="/npw/assets/SegregatedWide-90b2a345.jpg",WE="/npw/assets/OffRoad-d9bc7e74.jpg",KE="/npw/assets/SegregatedNarrow-5cd3bb62.jpg",$E="/npw/assets/SharedFootway-9cec7d1e.jpg",YE="/npw/assets/CycleLane-4550fbbf.jpg",JE="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD//gA+Q1JFQVRPUjogZ2QtanBlZyB2MS4wICh1c2luZyBJSkcgSlBFRyB2ODApLCBkZWZhdWx0IHF1YWxpdHkK/9sAQwAIBgYHBgUIBwcHCQkICgwUDQwLCwwZEhMPFB0aHx4dGhwcICQuJyAiLCMcHCg3KSwwMTQ0NB8nOT04MjwuMzQy/9sAQwEJCQkMCwwYDQ0YMiEcITIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy/8AAEQgA4QEsAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A7Oiiivpj8NCiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAoq1aafdX+/7NFv2Y3fMBjPTqfarP/CP6p/z6/wDkRf8AGolVpxdnJfeddLAYqrFTp0pNPqotr8jMorT/AOEf1T/n1/8AIi/40f8ACP6p/wA+v/kRf8an29L+ZfeX/ZeO/wCfM/8AwF/5GZRWn/wj+qf8+v8A5EX/ABo/4R/VP+fX/wAiL/jR7el/MvvD+y8d/wA+Z/8AgL/yMyitP/hH9U/59f8AyIv+NH/CP6p/z6/+RF/xo9vS/mX3h/ZeO/58z/8AAX/kZlFaf/CP6p/z6/8AkRf8aP8AhH9U/wCfX/yIv+NHt6X8y+8P7Lx3/Pmf/gL/AMjMorT/AOEf1T/n1/8AIi/40f8ACP6p/wA+v/kRf8aPb0v5l94f2Xjv+fM//AX/AJGZRWn/AMI/qn/Pr/5EX/Gj/hH9U/59f/Ii/wCNHt6X8y+8P7Lx3/Pmf/gL/wAjMorT/wCEf1T/AJ9f/Ii/40f8I/qn/Pr/AORF/wAaPb0v5l94f2Xjv+fM/wDwF/5GZRWn/wAI/qn/AD6/+RF/xo/4R/VP+fX/AMiL/jR7el/MvvD+y8d/z5n/AOAv/IzKK0/+Ef1T/n1/8iL/AI1FcaPf2sDTTQbY1xk71OMnHY01Wpt2Ul94pZdjIRcpUpJL+6/8ijRRRWhxBRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAaFhql9pdsx07TVv7i4uobcI8xiRA2/LswRiAMeneof+E98RNJ4iji8LWM0ug7ftEcWqyM0uU3gRj7P8xx645rc8I/8vn/AAD/ANmrI8E/8lC8f/8AX5bf+ia8PGfx5fL8j9W4b/5FdL/t7/0pmpdeLp5ten0PQdK/tK+tY0kvGkuBBDbbhlVZ9rEsRzgKeKk0fxW+rT6lpb6f9j1+wUNJY3E3yOGHyOsig5Q9NwXI7isD4dg2Xi7x3p118t82rG7Abq0EgzGR6gcj2pIwb74/yz2fMWn6EIL116B3lLIh98fN+Fcp7hZ0Pxzr2t+HP7eh8LQvZh5FaG31EyXHyMVbajRKrdDgbsmtS68faLD4VstftmlvItQdYbKCFf3s8rHAjAPQ5BBz0wax/hFNHb/DSOaaRY4o7m7d3Y4CgTOSSfSvOvD0Etnb+BddukaPRn1+9dN4wqLNhYWPoNysQff3oA9Wm8ZX+jXFn/wkuhLptleSrAl3DeC4SKRvurL8q7c9MjcM9TXX1wHxndJPhre2AXzLu/mgt7SEfeklMqkBffAJ/Cu6tUkitIY5X3yLGqu3qQOTQBLRRRQAUUUUAFFFFABRRRQAUUUUAFZniD/kB3P/AAH/ANCFadZniD/kB3P/AAH/ANCFa0P4sfVHDmn+41v8EvyZw1FFFfQn42FFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB03hH/l8/wCAf+zVb0nwlo+iandajYR3SXV3g3DyX08olI4BYO5BIHAOMiuYtNQurDf9ml2b8bvlBzjp1HvVn/hINU/5+v8AyGv+FebiMHUqVHNNH22UcSYXB4OGHqRk2r7JW1bfddzo9W8M6RrdxFc31oTcxKVjuIZXhlVT1UOhDY9s4p1h4e0rStNm0+wtfssE24ymGRlkdj1YyA7y3+1nPvXNf8JBqn/P1/5DX/Cj/hINU/5+v/Ia/wCFY/2fV7r+vkej/rhgf5J/cv8A5IvQfDfwtbWa2SWV01kGLfZJdQuJICSckmNpCpyeeRXQ3WmWN7pr6bc2cEtk6CM27xgptHQY6YHH0rkP+Eg1T/n6/wDIa/4Uf8JBqn/P1/5DX/Cj+z6vdf18g/1wwP8AJP7l/wDJG3p/gzQdMvor23sma5hBWGS4uJJzCD12eYzbP+A4rerhv+Eg1T/n6/8AIa/4Uf8ACQap/wA/X/kNf8KP7Pq91/XyD/XDA/yT+5f/ACR3NFcN/wAJBqn/AD9f+Q1/wo/4SDVP+fr/AMhr/hR/Z9Xuv6+Qf64YH+Sf3L/5I7miuG/4SDVP+fr/AMhr/hR/wkGqf8/X/kNf8KP7Pq91/XyD/XDA/wAk/uX/AMkdzRXDf8JBqn/P1/5DX/Cj/hINU/5+v/Ia/wCFH9n1e6/r5B/rhgf5J/cv/kjuaK4b/hINU/5+v/Ia/wCFH/CQap/z9f8AkNf8KP7Pq91/XyD/AFwwP8k/uX/yR3NFcN/wkGqf8/X/AJDX/Cj/AISDVP8An6/8hr/hR/Z9Xuv6+Qf64YH+Sf3L/wCSO5rM8Qf8gO5/4D/6EK5n/hINU/5+v/Ia/wCFRXGsX91A0M0+6NsZGxRnBz2FXTwNSM1JtaP+uhzYzirB18NUpRjK8otbLqrdyjRRRXqnwIUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB//2Q==",QE="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD//gA+Q1JFQVRPUjogZ2QtanBlZyB2MS4wICh1c2luZyBJSkcgSlBFRyB2ODApLCBkZWZhdWx0IHF1YWxpdHkK/9sAQwAIBgYHBgUIBwcHCQkICgwUDQwLCwwZEhMPFB0aHx4dGhwcICQuJyAiLCMcHCg3KSwwMTQ0NB8nOT04MjwuMzQy/9sAQwEJCQkMCwwYDQ0YMiEcITIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy/8AAEQgA4QEsAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A7Oiiivpj8NCiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAoq1aafdX+/7NFv2Y3fMBjPTqfarP/CP6p/z6/wDkRf8AGolVpxdnJfeddLAYqrFTp0pNPqotr8jMorT/AOEf1T/n1/8AIi/40f8ACP6p/wA+v/kRf8an29L+ZfeX/ZeO/wCfM/8AwF/5GZRWn/wj+qf8+v8A5EX/ABo/4R/VP+fX/wAiL/jR7el/MvvD+y8d/wA+Z/8AgL/yMyitP/hH9U/59f8AyIv+NH/CP6p/z6/+RF/xo9vS/mX3h/ZeO/58z/8AAX/kZlFaf/CP6p/z6/8AkRf8aP8AhH9U/wCfX/yIv+NHt6X8y+8P7Lx3/Pmf/gL/AMjMorT/AOEf1T/n1/8AIi/40f8ACP6p/wA+v/kRf8aPb0v5l94f2Xjv+fM//AX/AJGZRWn/AMI/qn/Pr/5EX/Gj/hH9U/59f/Ii/wCNHt6X8y+8P7Lx3/Pmf/gL/wAjMorT/wCEf1T/AJ9f/Ii/40f8I/qn/Pr/AORF/wAaPb0v5l94f2Xjv+fM/wDwF/5GZRWn/wAI/qn/AD6/+RF/xo/4R/VP+fX/AMiL/jR7el/MvvD+y8d/z5n/AOAv/IzKK0/+Ef1T/n1/8iL/AI1FcaPf2sDTTQbY1xk71OMnHY01Wpt2Ul94pZdjIRcpUpJL+6/8ijRRRWhxBRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAaFhql9pdsx07TVv7i4uobcI8xiRA2/LswRiAMeneof+E98RNJ4iji8LWM0ug7ftEcWqyM0uU3gRj7P8xx645rc8I/8vn/AAD/ANmrI8E/8lC8f/8AX5bf+ia8PGfx5fL8j9W4b/5FdL/t7/0pmpdeLp5ten0PQdK/tK+tY0kvGkuBBDbbhlVZ9rEsRzgKeKk0fxW+rT6lpb6f9j1+wUNJY3E3yOGHyOsig5Q9NwXI7isD4dg2Xi7x3p118t82rG7Abq0EgzGR6gcj2pIwb74/yz2fMWn6EIL116B3lLIh98fN+Fcp7hZ0Pxzr2t+HP7eh8LQvZh5FaG31EyXHyMVbajRKrdDgbsmtS68faLD4VstftmlvItQdYbKCFf3s8rHAjAPQ5BBz0wax/hFNHb/DSOaaRY4o7m7d3Y4CgTOSSfSvOvD0Etnb+BddukaPRn1+9dN4wqLNhYWPoNysQff3oA9Wm8ZX+jXFn/wkuhLptleSrAl3DeC4SKRvurL8q7c9MjcM9TXX1wHxndJPhre2AXzLu/mgt7SEfeklMqkBffAJ/Cu6tUkitIY5X3yLGqu3qQOTQBLRRRQAUUUUAFFFFABRRRQAUUUUAFZniD/kB3P/AAH/ANCFadZniD/kB3P/AAH/ANCFa0P4sfVHDmn+41v8EvyZw1FFFfQn42FFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB03hH/l8/wCAf+zVb0nwlo+iandajYR3SXV3g3DyX08olI4BYO5BIHAOMiuYtNQurDf9ml2b8bvlBzjp1HvVn/hINU/5+v8AyGv+FebiMHUqVHNNH22UcSYXB4OGHqRk2r7JW1bfddzo9W8M6RrdxFc31oTcxKVjuIZXhlVT1UOhDY9s4p1h4e0rStNm0+wtfssE24ymGRlkdj1YyA7y3+1nPvXNf8JBqn/P1/5DX/Cj/hINU/5+v/Ia/wCFY/2fV7r+vkej/rhgf5J/cv8A5IvQfDfwtbWa2SWV01kGLfZJdQuJICSckmNpCpyeeRXQ3WmWN7pr6bc2cEtk6CM27xgptHQY6YHH0rkP+Eg1T/n6/wDIa/4Uf8JBqn/P1/5DX/Cj+z6vdf18g/1wwP8AJP7l/wDJG3p/gzQdMvor23sma5hBWGS4uJJzCD12eYzbP+A4rerhv+Eg1T/n6/8AIa/4Uf8ACQap/wA/X/kNf8KP7Pq91/XyD/XDA/yT+5f/ACR3NFcN/wAJBqn/AD9f+Q1/wo/4SDVP+fr/AMhr/hR/Z9Xuv6+Qf64YH+Sf3L/5I7miuG/4SDVP+fr/AMhr/hR/wkGqf8/X/kNf8KP7Pq91/XyD/XDA/wAk/uX/AMkdzRXDf8JBqn/P1/5DX/Cj/hINU/5+v/Ia/wCFH9n1e6/r5B/rhgf5J/cv/kjuaK4b/hINU/5+v/Ia/wCFH/CQap/z9f8AkNf8KP7Pq91/XyD/AFwwP8k/uX/yR3NFcN/wkGqf8/X/AJDX/Cj/AISDVP8An6/8hr/hR/Z9Xuv6+Qf64YH+Sf3L/wCSO5rM8Qf8gO5/4D/6EK5n/hINU/5+v/Ia/wCFRXGsX91A0M0+6NsZGxRnBz2FXTwNSM1JtaP+uhzYzirB18NUpRjK8otbLqrdyjRRRXqnwIUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQB//2Q==";function n0(r,e,n){const s=r.slice();s[3]=e[n][0],s[4]=e[n][1],s[5]=e[n][2];const a=ou[s[3]];return s[6]=a[0],s[7]=a[1],s}function i0(r){let e,n,s,a,h,m,l,x;function S(){return r[2](r[3])}return{c(){e=le("div"),n=le("img"),a=Oe(),h=le("span"),h.textContent=`${r[6]}`,m=Oe(),Yr(n.src,s=r[4])||Ze(n,"src",s),Ze(n,"alt",r[6]),Rn(h,"color",r[7]),Ze(e,"class","card svelte-o9mz9k"),Sr(e,"current",r[0]==r[3])},m(T,C){ae(T,e,C),Z(e,n),Z(e,a),Z(e,h),Z(e,m),l||(x=Rt(e,"click",S),l=!0)},p(T,C){r=T,C&3&&Sr(e,"current",r[0]==r[3])},d(T){T&&oe(e),l=!1,x()}}}function eA(r){let e,n=Vn(r[1]),s=[];for(let a=0;a<n.length;a+=1)s[a]=i0(n0(r,n,a));return{c(){e=le("div");for(let a=0;a<s.length;a+=1)s[a].c();Rn(e,"display","flex"),Rn(e,"flex-wrap","wrap"),Rn(e,"gap","4px")},m(a,h){ae(a,e,h);for(let m=0;m<s.length;m+=1)s[m]&&s[m].m(e,null)},p(a,[h]){if(h&3){n=Vn(a[1]);let m;for(m=0;m<n.length;m+=1){const l=n0(a,n,m);s[m]?s[m].p(l,h):(s[m]=i0(l),s[m].c(),s[m].m(e,null))}for(;m<s.length;m+=1)s[m].d(1);s.length=n.length}},i:tt,o:tt,d(a){a&&oe(e),Er(s,a)}}}function tA(r,e,n){let{current:s}=e,a=[["SegregatedWide",XE,"https://www.cyclestreets.net/location/81274/"],["OffRoad",WE,"https://www.cyclestreets.net/location/86744/"],["SegregatedNarrow",KE,"https://www.cyclestreets.net/location/196620/"],["SharedFootway",$E,"https://www.cyclestreets.net/location/92805/"],["CycleLane",YE,"https://www.cyclestreets.net/location/81341/"],["MixedTraffic",JE,""],["Unknown",QE,""]];const h=m=>n(0,s=m);return r.$$set=m=>{"current"in m&&n(0,s=m.current)},[s,a,h]}class nA extends fn{constructor(e){super(),hn(this,e,tA,eA,an,{current:0})}}function iA(r){let e,n,s,a,h,m,l,x,S,T;return{c(){e=le("div"),n=le("label"),s=ze(`Tier:
      `),a=le("select"),h=le("option"),h.textContent="Primary routes",m=le("option"),m.textContent="Secondary routes",l=le("option"),l.textContent="Local access routes",x=le("option"),x.textContent="Long distance routes",h.__value="Primary",ki(h,h.__value),m.__value="Secondary",ki(m,m.__value),l.__value="LocalAccess",ki(l,l.__value),x.__value="LongDistance",ki(x,x.__value),r[5]===void 0&&Ro(()=>r[13].call(a)),Ze(e,"slot","extra-left")},m(C,N){ae(C,e,N),Z(e,n),Z(n,s),Z(n,a),Z(a,h),Z(a,m),Z(a,l),Z(a,x),ds(a,r[5],!0),S||(T=Rt(a,"change",r[13]),S=!0)},p(C,N){N&32&&ds(a,C[5])},d(C){C&&oe(e),S=!1,T()}}}function r0(r){let e,n;return e=new rr({props:{data:r[6],$$slots:{default:[rA]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&64&&(h.data=s[6]),a&524290&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function rA(r){let e,n;return e=new _r({props:{id:"routes",filter:r[1]==null?void 0:["!=",["id"],r[1]],paint:{"line-width":5,"line-color":ac,"line-opacity":.5}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&2&&(h.filter=s[1]==null?void 0:["!=",["id"],s[1]]),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function sA(r){let e,n,s=r[6]&&r0(r);return{c(){e=le("span"),s&&s.c(),Ze(e,"slot","extra-map")},m(a,h){ae(a,e,h),s&&s.m(e,null),n=!0},p(a,h){a[6]?s?(s.p(a,h),h&64&&ge(s,1)):(s=r0(a),s.c(),ge(s,1),s.m(e,null)):s&&(zn(),Se(s,1,1,()=>{s=null}),Fn())},i(a){n||(ge(s),n=!0)},o(a){Se(s),n=!1},d(a){a&&oe(e),s&&s.d()}}}function oA(r){let e,n,s,a,h,m,l,x,S,T,C,N,B,U;function ee(se){r[11](se)}let ie={};return r[4]!==void 0&&(ie.current=r[4]),m=new nA({props:ie}),$n.push(()=>gr(m,"current",ee)),{c(){e=le("div"),n=le("label"),s=ze(`Name:
      `),a=le("input"),h=Oe(),ot(m.$$.fragment),x=Oe(),S=le("label"),T=ze(`Notes:
      `),C=le("textarea"),Ze(a,"type","text"),Ze(C,"rows","5"),Ze(e,"slot","extra-right")},m(se,Q){ae(se,e,Q),Z(e,n),Z(n,s),Z(n,a),ki(a,r[2]),Z(e,h),it(m,e,null),Z(e,x),Z(e,S),Z(S,T),Z(S,C),ki(C,r[3]),N=!0,B||(U=[Rt(a,"input",r[10]),Rt(C,"input",r[12])],B=!0)},p(se,Q){Q&4&&a.value!==se[2]&&ki(a,se[2]);const Y={};!l&&Q&16&&(l=!0,Y.current=se[4],mr(()=>l=!1)),m.$set(Y),Q&8&&ki(C,se[3])},i(se){N||(ge(m.$$.fragment,se),N=!0)},o(se){Se(m.$$.fragment,se),N=!1},d(se){se&&oe(e),rt(m),B=!1,$i(U)}}}function aA(r){let e,n;return e=new HE({props:{map:r[0],finish:r[8],cancel:r[9],deleteRoute:r[7],editingExisting:r[1]!=null,$$slots:{"extra-right":[oA],"extra-map":[sA],"extra-left":[iA]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,[a]){const h={};a&1&&(h.map=s[0]),a&2&&(h.editingExisting=s[1]!=null),a&524414&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function lA(r,e,n){let s,a,h,m,l;zt(r,Oi,Ae=>n(14,s=Ae)),zt(r,sr,Ae=>n(15,a=Ae)),zt(r,go,Ae=>n(16,h=Ae)),zt(r,Qf,Ae=>n(17,m=Ae)),zt(r,_l,Ae=>n(18,l=Ae));let{map:x}=e,{id:S}=e,T="",C="",N="Unknown",B=l,U=null;cc(async()=>{if(n(6,U=await a.renderRoutes()),Dn(go,h=[],h),S!=null){let Ae=U.features.find(ce=>ce.id==S);n(2,T=Ae.properties.name),n(3,C=Ae.properties.notes),n(4,N=Ae.properties.infra_type),n(5,B=Ae.properties.tier),Dn(go,h=Ae.properties.waypoints.map(ce=>({point:[ce.lon,ce.lat],snapped:ce.snapped})),h)}});async function ee(){S&&(await a.deleteRoute(S),await Dh()),Dn(Oi,s={kind:"main"},s)}async function ie(){try{let Ae=JSON.parse(m.inner.calculateRoute(h));if(!Ae){window.alert("No route drawn");return}await a.setRoute(S,{feature:Ae,name:T,notes:C,nodes:Ae.properties.full_path,infra_type:N,tier:B}),await Dh(),Dn(Oi,s={kind:"main"},s)}catch(Ae){window.alert(Ae)}}function se(){Dn(Oi,s={kind:"main"},s)}function Q(){T=this.value,n(2,T)}function Y(Ae){N=Ae,n(4,N)}function _e(){C=this.value,n(3,C)}function ve(){B=yl(this),n(5,B)}return r.$$set=Ae=>{"map"in Ae&&n(0,x=Ae.map),"id"in Ae&&n(1,S=Ae.id)},[x,S,T,C,N,B,U,ee,ie,se,Q,Y,_e,ve]}class uA extends fn{constructor(e){super(),hn(this,e,lA,aA,an,{map:0,id:1})}}function s0(r,e,n){const s=r.slice();return s[3]=e[n],s}function o0(r){let e,n,s,a=r[3].infra_type+"",h,m,l=r[3].name+"",x,S,T;return{c(){e=le("li"),n=le("a"),s=ze("["),h=ze(a),m=ze("] "),x=ze(l),T=Oe(),Ze(n,"href",S=r[3].way),Ze(n,"target","_blank")},m(C,N){ae(C,e,N),Z(e,n),Z(n,s),Z(n,h),Z(n,m),Z(n,x),Z(e,T)},p(C,N){N&1&&a!==(a=C[3].infra_type+"")&&Ct(h,a),N&1&&l!==(l=C[3].name+"")&&Ct(x,l),N&1&&S!==(S=C[3].way)&&Ze(n,"href",S)},d(C){C&&oe(e)}}}function cA(r){let e,n,s,a=(r[0].route_length/r[0].direct_length).toFixed(1)+"",h,m,l,x,S,T,C=(r[0].route_length/r[0].car_length).toFixed(1)+"",N,B,U,ee,ie,se,Q,Y,_e,ve=If(r[0],r[1])+"",Ae,ce,xe,be,Le,ke=Sf(r[0],r[1])+"",ye,Ue,qe,pt,St,dt=If(r[0],r[2])+"",ut,Ut,vt,kt,ft,wt=Sf(r[0],r[2])+"",It,$t,pn,Pn,We,Wn,dn,Ot,Ee=Vn(r[0].directions),lt=[];for(let Ye=0;Ye<Ee.length;Ye+=1)lt[Ye]=o0(s0(r,Ee,Ye));return{c(){e=le("p"),n=ze("Detour factor: "),s=le("b"),h=ze(a),m=ze("x"),l=ze(`
  longer than straight line`),x=Oe(),S=le("p"),T=le("b"),N=ze(C),B=ze("x"),U=ze(`
  longer than the driving route (in
  `),ee=le("span"),ee.textContent="red",ie=ze(`
  )`),se=Oe(),Q=le("hr"),Y=Oe(),_e=le("p"),Ae=ze(ve),ce=ze(" changes in infrastructure type"),xe=Oe(),be=le("p"),Le=ze("By length: "),ye=ze(ke),Ue=Oe(),qe=le("hr"),pt=Oe(),St=le("p"),ut=ze(dt),Ut=ze(" changes in level of service"),vt=Oe(),kt=le("p"),ft=ze("By length: "),It=ze(wt),$t=Oe(),pn=le("hr"),Pn=Oe(),We=le("details"),Wn=le("summary"),Wn.textContent="Route directions",dn=Oe(),Ot=le("ol");for(let Ye=0;Ye<lt.length;Ye+=1)lt[Ye].c();Rn(ee,"color","red")},m(Ye,Lt){ae(Ye,e,Lt),Z(e,n),Z(e,s),Z(s,h),Z(s,m),Z(e,l),ae(Ye,x,Lt),ae(Ye,S,Lt),Z(S,T),Z(T,N),Z(T,B),Z(S,U),Z(S,ee),Z(S,ie),ae(Ye,se,Lt),ae(Ye,Q,Lt),ae(Ye,Y,Lt),ae(Ye,_e,Lt),Z(_e,Ae),Z(_e,ce),ae(Ye,xe,Lt),ae(Ye,be,Lt),Z(be,Le),Z(be,ye),ae(Ye,Ue,Lt),ae(Ye,qe,Lt),ae(Ye,pt,Lt),ae(Ye,St,Lt),Z(St,ut),Z(St,Ut),ae(Ye,vt,Lt),ae(Ye,kt,Lt),Z(kt,ft),Z(kt,It),ae(Ye,$t,Lt),ae(Ye,pn,Lt),ae(Ye,Pn,Lt),ae(Ye,We,Lt),Z(We,Wn),Z(We,dn),Z(We,Ot);for(let Ke=0;Ke<lt.length;Ke+=1)lt[Ke]&&lt[Ke].m(Ot,null)},p(Ye,[Lt]){if(Lt&1&&a!==(a=(Ye[0].route_length/Ye[0].direct_length).toFixed(1)+"")&&Ct(h,a),Lt&1&&C!==(C=(Ye[0].route_length/Ye[0].car_length).toFixed(1)+"")&&Ct(N,C),Lt&1&&ve!==(ve=If(Ye[0],Ye[1])+"")&&Ct(Ae,ve),Lt&1&&ke!==(ke=Sf(Ye[0],Ye[1])+"")&&Ct(ye,ke),Lt&1&&dt!==(dt=If(Ye[0],Ye[2])+"")&&Ct(ut,dt),Lt&1&&wt!==(wt=Sf(Ye[0],Ye[2])+"")&&Ct(It,wt),Lt&1){Ee=Vn(Ye[0].directions);let Ke;for(Ke=0;Ke<Ee.length;Ke+=1){const On=s0(Ye,Ee,Ke);lt[Ke]?lt[Ke].p(On,Lt):(lt[Ke]=o0(On),lt[Ke].c(),lt[Ke].m(Ot,null))}for(;Ke<lt.length;Ke+=1)lt[Ke].d(1);lt.length=Ee.length}},i:tt,o:tt,d(Ye){Ye&&(oe(e),oe(x),oe(S),oe(se),oe(Q),oe(Y),oe(_e),oe(xe),oe(be),oe(Ue),oe(qe),oe(pt),oe(St),oe(vt),oe(kt),oe($t),oe(pn),oe(Pn),oe(We)),Er(lt,Ye)}}}function If(r,e){let n=0;for(let s=0;s<r.directions.length-1;s++){let a=e(r.directions[s]),h=e(r.directions[s+1]);a!=h&&n++}return n}function Sf(r,e){let n={};for(let h of r.directions){let m=e(h);Object.hasOwn(n,m)||(n[m]=0),n[m]+=h.length}let s=0;for(let h of Object.values(n))s+=h;let a=[];for(let[h,m]of Object.entries(n).toSorted((l,x)=>x[1]-l[1])){let l=Math.round(m/s*100);a.push(`${l}% ${h}`)}return a.join(", ")}function hA(r,e,n){let{gj:s}=e,a=m=>m.infra_type,h=m=>m.los;return r.$$set=m=>{"gj"in m&&n(0,s=m.gj)},[s,a,h]}class fA extends fn{constructor(e){super(),hn(this,e,hA,cA,an,{gj:0})}}function a0(r){let e,n;return{c(){e=le("p"),n=ze(r[6])},m(s,a){ae(s,e,a),Z(e,n)},p(s,a){a&64&&Ct(n,s[6])},d(s){s&&oe(e)}}}function l0(r){let e,n;return e=new _c({props:{colors:tm}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function u0(r){let e,n;return e=new fA({props:{gj:r[5]}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&32&&(h.gj=s[5]),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function dA(r){let e,n,s,a,h,m,l,x,S,T,C,N,B,U,ee,ie,se,Q,Y,_e=r[6]&&a0(r),ve=r[2]=="los"&&l0(),Ae=r[5]&&u0(r);return{c(){e=le("div"),n=le("h2"),n.textContent="Evaluate a route mode",s=Oe(),a=le("button"),a.textContent="Back",h=Oe(),m=le("p"),m.innerHTML=`Move the <b>A</b>
      and
      <b>B</b>
      pins to find a route. (Hint: right-click to set the first pin somewhere.)`,l=Oe(),_e&&_e.c(),x=Oe(),S=le("label"),T=ze(`Show details along route
      `),C=le("select"),N=le("option"),N.textContent="Just show route",B=le("option"),B.textContent="Level of service",U=le("option"),U.textContent="Infrastructure type",ee=Oe(),ve&&ve.c(),ie=Oe(),Ae&&Ae.c(),N.__value="",ki(N,N.__value),B.__value="los",ki(B,B.__value),U.__value="infra_type",ki(U,U.__value),r[2]===void 0&&Ro(()=>r[17].call(C)),Ze(e,"slot","left")},m(ce,xe){ae(ce,e,xe),Z(e,n),Z(e,s),Z(e,a),Z(e,h),Z(e,m),Z(e,l),_e&&_e.m(e,null),Z(e,x),Z(e,S),Z(S,T),Z(S,C),Z(C,N),Z(C,B),Z(C,U),ds(C,r[2],!0),Z(e,ee),ve&&ve.m(e,null),Z(e,ie),Ae&&Ae.m(e,null),se=!0,Q||(Y=[Rt(a,"click",r[16]),Rt(C,"change",r[17])],Q=!0)},p(ce,xe){ce[6]?_e?_e.p(ce,xe):(_e=a0(ce),_e.c(),_e.m(e,x)):_e&&(_e.d(1),_e=null),xe&4&&ds(C,ce[2]),ce[2]=="los"?ve?xe&4&&ge(ve,1):(ve=l0(),ve.c(),ge(ve,1),ve.m(e,ie)):ve&&(zn(),Se(ve,1,1,()=>{ve=null}),Fn()),ce[5]?Ae?(Ae.p(ce,xe),xe&32&&ge(Ae,1)):(Ae=u0(ce),Ae.c(),ge(Ae,1),Ae.m(e,null)):Ae&&(zn(),Se(Ae,1,1,()=>{Ae=null}),Fn())},i(ce){se||(ge(ve),ge(Ae),se=!0)},o(ce){Se(ve),Se(Ae),se=!1},d(ce){ce&&oe(e),_e&&_e.d(),ve&&ve.d(),Ae&&Ae.d(),Q=!1,$i(Y)}}}function pA(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function mA(r){let e,n;return e=new rr({props:{data:r[20],$$slots:{default:[gA]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&256&&(h.data=s[20]),a&2097664&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function gA(r){let e,n;return e=new _r({props:{id:"routes",paint:{"line-width":5,"line-color":ac},layout:{visibility:r[9]?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&512&&(h.layout={visibility:s[9]?"visible":"none"}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function _A(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function c0(r){let e,n,s,a,h,m;function l(C){r[14](C)}let x={draggable:!0,$$slots:{default:[yA]},$$scope:{ctx:r}};r[4]!==void 0&&(x.lngLat=r[4]),e=new Zf({props:x}),$n.push(()=>gr(e,"lngLat",l));function S(C){r[15](C)}let T={draggable:!0,$$slots:{default:[vA]},$$scope:{ctx:r}};return r[3]!==void 0&&(T.lngLat=r[3]),a=new Zf({props:T}),$n.push(()=>gr(a,"lngLat",S)),{c(){ot(e.$$.fragment),s=Oe(),ot(a.$$.fragment)},m(C,N){it(e,C,N),ae(C,s,N),it(a,C,N),m=!0},p(C,N){const B={};N&2097152&&(B.$$scope={dirty:N,ctx:C}),!n&&N&16&&(n=!0,B.lngLat=C[4],mr(()=>n=!1)),e.$set(B);const U={};N&2097152&&(U.$$scope={dirty:N,ctx:C}),!h&&N&8&&(h=!0,U.lngLat=C[3],mr(()=>h=!1)),a.$set(U)},i(C){m||(ge(e.$$.fragment,C),ge(a.$$.fragment,C),m=!0)},o(C){Se(e.$$.fragment,C),Se(a.$$.fragment,C),m=!1},d(C){C&&oe(s),rt(e,C),rt(a,C)}}}function yA(r){let e;return{c(){e=le("span"),e.textContent="A",Ze(e,"class","dot svelte-1ej0v4r")},m(n,s){ae(n,e,s)},p:tt,d(n){n&&oe(e)}}}function vA(r){let e;return{c(){e=le("span"),e.textContent="B",Ze(e,"class","dot svelte-1ej0v4r")},m(n,s){ae(n,e,s)},p:tt,d(n){n&&oe(e)}}}function h0(r){let e,n;return e=new rr({props:{data:r[5],generateId:!0,$$slots:{default:[bA]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&32&&(h.data=s[5]),a&2097156&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function bA(r){let e,n,s,a;return e=new _r({props:{filter:["!",["has","car_route"]],paint:{"line-width":20,"line-color":r[2]==""?"cyan":r[2]=="los"?Op:ac,"line-opacity":Ls(.5,1)},manageHoverState:!0}}),s=new _r({props:{filter:["has","car_route"],paint:{"line-width":10,"line-color":"red","line-opacity":Ls(.5,1)},manageHoverState:!0}}),{c(){ot(e.$$.fragment),n=Oe(),ot(s.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(s,h,m),a=!0},p(h,m){const l={};m&4&&(l.paint={"line-width":20,"line-color":h[2]==""?"cyan":h[2]=="los"?Op:ac,"line-opacity":Ls(.5,1)}),e.$set(l)},i(h){a||(ge(e.$$.fragment,h),ge(s.$$.fragment,h),a=!0)},o(h){Se(e.$$.fragment,h),Se(s.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(s,h)}}}function xA(r){let e,n,s,a,h,m,l;n=new Wv({}),n.$on("contextmenu",r[10]);let x={ctx:r,current:null,token:null,hasCatch:!1,pending:_A,then:mA,catch:pA,value:20,blocks:[,,,]};gs(a=kl(r[8]).renderRoutes(),x);let S=r[4]&&r[3]&&c0(r),T=r[5]&&h0(r);return{c(){e=le("div"),ot(n.$$.fragment),s=Oe(),x.block.c(),h=Oe(),S&&S.c(),m=Oe(),T&&T.c(),Ze(e,"slot","map")},m(C,N){ae(C,e,N),it(n,e,null),Z(e,s),x.block.m(e,x.anchor=null),x.mount=()=>e,x.anchor=h,Z(e,h),S&&S.m(e,null),Z(e,m),T&&T.m(e,null),l=!0},p(C,N){r=C,x.ctx=r,N&256&&a!==(a=kl(r[8]).renderRoutes())&&gs(a,x)||Il(x,r,N),r[4]&&r[3]?S?(S.p(r,N),N&24&&ge(S,1)):(S=c0(r),S.c(),ge(S,1),S.m(e,m)):S&&(zn(),Se(S,1,1,()=>{S=null}),Fn()),r[5]?T?(T.p(r,N),N&32&&ge(T,1)):(T=h0(r),T.c(),ge(T,1),T.m(e,null)):T&&(zn(),Se(T,1,1,()=>{T=null}),Fn())},i(C){l||(ge(n.$$.fragment,C),ge(x.block),ge(S),ge(T),l=!0)},o(C){Se(n.$$.fragment,C);for(let N=0;N<3;N+=1){const B=x.blocks[N];Se(B)}Se(S),Se(T),l=!1},d(C){C&&oe(e),rt(n),x.block.d(),x.token=null,x=null,S&&S.d(),T&&T.d()}}}function f0(r){let e,n,s,a,h,m,l,x=r[1]+1+"",S,T,C=r[0].length+"",N,B,U,ee,ie,se,Q;return{c(){e=le("p"),e.textContent="These routes, from a sample of the OD data, have the worst directness.",n=Oe(),s=le("div"),a=le("button"),h=ze("Previous"),l=Oe(),S=ze(x),T=ze(" / "),N=ze(C),B=Oe(),U=le("button"),ee=ze("Next"),Ze(a,"class","secondary"),a.disabled=m=r[1]==0,Ze(U,"class","secondary"),U.disabled=ie=r[1]==r[0].length-1},m(Y,_e){ae(Y,e,_e),ae(Y,n,_e),ae(Y,s,_e),Z(s,a),Z(a,h),Z(s,l),Z(s,S),Z(s,T),Z(s,N),Z(s,B),Z(s,U),Z(U,ee),se||(Q=[Rt(a,"click",r[12]),Rt(U,"click",r[13])],se=!0)},p(Y,_e){_e&2&&m!==(m=Y[1]==0)&&(a.disabled=m),_e&2&&x!==(x=Y[1]+1+"")&&Ct(S,x),_e&1&&C!==(C=Y[0].length+"")&&Ct(N,C),_e&3&&ie!==(ie=Y[1]==Y[0].length-1)&&(U.disabled=ie)},d(Y){Y&&(oe(e),oe(n),oe(s)),se=!1,$i(Q)}}}function wA(r){let e,n=r[0].length>0&&f0(r);return{c(){e=le("div"),n&&n.c(),Ze(e,"slot","right")},m(s,a){ae(s,e,a),n&&n.m(e,null)},p(s,a){s[0].length>0?n?n.p(s,a):(n=f0(s),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},d(s){s&&oe(e),n&&n.d()}}}function kA(r){let e,n,s,a;return e=new gc({props:{$$slots:{right:[wA],map:[xA],left:[dA]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(h,m){it(e,h,m),n=!0,s||(a=Rt(window,"keydown",r[11]),s=!0)},p(h,[m]){const l={};m&2098175&&(l.$$scope={dirty:m,ctx:h}),e.$set(l)},i(h){n||(ge(e.$$.fragment,h),n=!0)},o(h){Se(e.$$.fragment,h),n=!1},d(h){rt(e,h),s=!1,a()}}}function IA(r,e,n){let s,a,h,m,l;zt(r,Oi,ce=>n(7,s=ce)),zt(r,Sh,ce=>n(3,a=ce)),zt(r,Ju,ce=>n(4,h=ce)),zt(r,sr,ce=>n(8,m=ce)),zt(r,zp,ce=>n(9,l=ce));let{browse:x}=e,S=0,T=null,C="",N="los";async function B(ce,xe,be=""){try{n(5,T=await m.evaluateRoute({start:ce,end:[xe.lng,xe.lat],breakdown:be})),n(6,C="")}catch(Le){n(5,T=null),n(6,C=Le.toString())}}function U(ce){Dn(Ju,h=ce.detail.lngLat,h)}async function ee(ce){if(x.length==0)return;let xe=x[ce];Dn(Ju,h={lng:xe[0].x,lat:xe[0].y},h),Dn(Sh,a={lng:xe[1].x,lat:xe[1].y},a),B(h,a,N)}function ie(ce){ce.key==="Escape"&&(ce.stopPropagation(),Dn(Oi,s={kind:"main"},s))}const se=()=>n(1,S--,S),Q=()=>n(1,S++,S);function Y(ce){h=ce,Ju.set(h)}function _e(ce){a=ce,Sh.set(a)}const ve=()=>Dn(Oi,s={kind:"main"},s);function Ae(){N=yl(this),n(2,N)}return r.$$set=ce=>{"browse"in ce&&n(0,x=ce.browse)},r.$$.update=()=>{r.$$.dirty&28&&B(h,a,N),r.$$.dirty&2&&ee(S)},[x,S,N,a,h,T,C,s,m,l,U,ie,se,Q,Y,_e,ve,Ae]}class SA extends fn{constructor(e){super(),hn(this,e,IA,kA,an,{browse:0})}}function Ir(r,e){return e==0?"0%":`${Math.round(r/e*100)}%`}function ed(r){return r.reduce((e,n)=>e+n,0)}function td(r){return["interpolate",["linear"],["zoom"],12,["*",2.1,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]],14,["*",5.25,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]],15,["*",7.5,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]],16,["*",18,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]],18,["*",52.5,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]]]}function nm(r){return["step",["get",r],"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function d0(r,e,n){const s=r.slice();return s[5]=e[n][0],s[6]=e[n][1],s}function p0(r){let e,n=r[0].succeeded.toLocaleString()+"",s,a,h=r[0].failed.toLocaleString()+"",m,l,x,S,T,C=r[0].max_count.toLocaleString()+"",N,B,U,ee,ie,se,Q,Y=(100*r[0].percent_off_network).toFixed(1)+"",_e,ve,Ae,ce=Vn(Object.entries(r[0].percent_on_network)),xe=[];for(let be=0;be<ce.length;be+=1)xe[be]=m0(d0(r,ce,be));return{c(){e=le("p"),s=ze(n),a=ze(" routes succeeded, "),m=ze(h),l=ze(`
        failed`),x=Oe(),S=le("p"),T=ze("Highest count on any one road is "),N=ze(C),B=Oe(),U=le("p"),U.textContent="Percent of demand by infrastructure type:",ee=Oe(),ie=le("ul"),se=le("li"),Q=ze("Off the network: "),_e=ze(Y),ve=ze("%"),Ae=Oe();for(let be=0;be<xe.length;be+=1)xe[be].c()},m(be,Le){ae(be,e,Le),Z(e,s),Z(e,a),Z(e,m),Z(e,l),ae(be,x,Le),ae(be,S,Le),Z(S,T),Z(S,N),ae(be,B,Le),ae(be,U,Le),ae(be,ee,Le),ae(be,ie,Le),Z(ie,se),Z(se,Q),Z(se,_e),Z(se,ve),Z(ie,Ae);for(let ke=0;ke<xe.length;ke+=1)xe[ke]&&xe[ke].m(ie,null)},p(be,Le){if(Le&1&&n!==(n=be[0].succeeded.toLocaleString()+"")&&Ct(s,n),Le&1&&h!==(h=be[0].failed.toLocaleString()+"")&&Ct(m,h),Le&1&&C!==(C=be[0].max_count.toLocaleString()+"")&&Ct(N,C),Le&1&&Y!==(Y=(100*be[0].percent_off_network).toFixed(1)+"")&&Ct(_e,Y),Le&1){ce=Vn(Object.entries(be[0].percent_on_network));let ke;for(ke=0;ke<ce.length;ke+=1){const ye=d0(be,ce,ke);xe[ke]?xe[ke].p(ye,Le):(xe[ke]=m0(ye),xe[ke].c(),xe[ke].m(ie,null))}for(;ke<xe.length;ke+=1)xe[ke].d(1);xe.length=ce.length}},d(be){be&&(oe(e),oe(x),oe(S),oe(B),oe(U),oe(ee),oe(ie)),Er(xe,be)}}}function m0(r){let e,n=r[5]+"",s,a,h=(100*r[6]).toFixed(1)+"",m,l;return{c(){e=le("li"),s=ze(n),a=ze(": "),m=ze(h),l=ze("%")},m(x,S){ae(x,e,S),Z(e,s),Z(e,a),Z(e,m),Z(e,l)},p(x,S){S&1&&n!==(n=x[5]+"")&&Ct(s,n),S&1&&h!==(h=(100*x[6]).toFixed(1)+"")&&Ct(m,h)},d(x){x&&oe(e)}}}function EA(r){let e,n,s,a,h,m,l,x=r[0]&&p0(r);return{c(){e=le("div"),n=le("h2"),n.textContent="Evaluate OD mode",s=Oe(),a=le("button"),a.textContent="Back",h=Oe(),x&&x.c(),Ze(e,"slot","left")},m(S,T){ae(S,e,T),Z(e,n),Z(e,s),Z(e,a),Z(e,h),x&&x.m(e,null),m||(l=Rt(a,"click",r[2]),m=!0)},p(S,T){S[0]?x?x.p(S,T):(x=p0(S),x.c(),x.m(e,null)):x&&(x.d(1),x=null)},d(S){S&&oe(e),x&&x.d(),m=!1,l()}}}function g0(r){let e,n;return e=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[CA]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&1&&(h.data=s[0]),a&512&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function AA(r){let e=r[4].count+"",n,s,a=r[4].infra_type+"",h;return{c(){n=ze(e),s=ze(" on "),h=ze(a)},m(m,l){ae(m,n,l),ae(m,s,l),ae(m,h,l)},p(m,l){l&16&&e!==(e=m[4].count+"")&&Ct(n,e),l&16&&a!==(a=m[4].infra_type+"")&&Ct(h,a)},d(m){m&&(oe(n),oe(s),oe(h))}}}function TA(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[AA,({props:s})=>({4:s}),({props:s})=>s?16:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&528&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function CA(r){let e,n;return e=new _r({props:{paint:{"line-width":td("count"),"line-color":nm("count")},manageHoverState:!0,eventsIfTopMost:!0,$$slots:{default:[TA]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&512&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function LA(r){let e,n,s=r[0]&&g0(r);return{c(){e=le("div"),s&&s.c(),Ze(e,"slot","map")},m(a,h){ae(a,e,h),s&&s.m(e,null),n=!0},p(a,h){a[0]?s?(s.p(a,h),h&1&&ge(s,1)):(s=g0(a),s.c(),ge(s,1),s.m(e,null)):s&&(zn(),Se(s,1,1,()=>{s=null}),Fn())},i(a){n||(ge(s),n=!0)},o(a){Se(s),n=!1},d(a){a&&oe(e),s&&s.d()}}}function MA(r){let e,n;return e=new gc({props:{$$slots:{map:[LA],left:[EA]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,[a]){const h={};a&515&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function RA(r,e,n){let s,a;zt(r,sr,l=>n(3,s=l)),zt(r,Oi,l=>n(1,a=l));let h=null;return cc(async()=>{n(0,h=await s.evaluateOD())}),[h,a,()=>Dn(Oi,a={kind:"main"},a)]}class PA extends fn{constructor(e){super(),hn(this,e,RA,MA,an,{})}}function DA(r){let e;return{c(){e=le("ul"),e.innerHTML=`<li>Long distance routes connect EDJ reachable settlements out with main
          urban areas.</li> <li>Settlements should be connected by high demand routes forming a direct
          connection in most cases.</li> <li>Long distance routes should connect directly to primary routes within
          each settlement.</li> <li>Consider SIMD/transport poverty</li> <li>In limited circumstances, settlement can be connected by less
          direct/more scenic routes (NCN)</li>`},m(n,s){ae(n,e,s)},d(n){n&&oe(e)}}}function NA(r){let e;return{c(){e=le("p"),e.textContent=`To draw the local access route, connect schools, GPs, hospitals, green
        spaces, neighbourhoods (especially deprived and densely populated ones),
        and above-minimum cycling flow routes on the base map.`},m(n,s){ae(n,e,s)},d(n){n&&oe(e)}}}function zA(r){let e;return{c(){e=le("p"),e.textContent=`To draw the secondary route, please connect town centres and cover
        medium cycling flow routes on the base map.`},m(n,s){ae(n,e,s)},d(n){n&&oe(e)}}}function FA(r){let e;return{c(){e=le("p"),e.textContent=`The primary route should be direct, coherent, meet high demand, and
        potentially connect settlements. Key primary routes will form Active
        Freeways. To draw the primary route, connect the high cycling flow
        routes on the base map.`},m(n,s){ae(n,e,s)},d(n){n&&oe(e)}}}function OA(r){let e;function n(h,m){if(h[0]=="Primary")return FA;if(h[0]=="Secondary")return zA;if(h[0]=="LocalAccess")return NA;if(h[0]=="LongDistance")return DA}let s=n(r),a=s&&s(r);return{c(){a&&a.c(),e=ii()},m(h,m){a&&a.m(h,m),ae(h,e,m)},p(h,m){s!==(s=n(h))&&(a&&a.d(1),a=s&&s(h),a&&(a.c(),a.m(e.parentNode,e)))},d(h){h&&oe(e),a&&a.d(h)}}}function BA(r){let e,n,s,a,h,m,l,x,S,T,C,N,B;return T=new e1({props:{$$slots:{default:[OA]},$$scope:{ctx:r}}}),{c(){e=le("div"),n=le("button"),n.textContent="Primary routes",s=Oe(),a=le("button"),a.textContent="Secondary routes",h=Oe(),m=le("button"),m.textContent="Local access routes",l=Oe(),x=le("button"),x.textContent="Long distance routes",S=Oe(),ot(T.$$.fragment),Ze(n,"class","svelte-gv50c1"),Rn(n,"background",r[0]=="Primary"?ps.primaryRoutes:"grey"),Ze(a,"class","svelte-gv50c1"),Rn(a,"background",r[0]=="Secondary"?ps.secondaryRoutes:"grey"),Ze(m,"class","svelte-gv50c1"),Rn(m,"background",r[0]=="LocalAccess"?ps.localAccessRoutes:"grey"),Ze(x,"class","svelte-gv50c1"),Rn(x,"background",r[0]=="LongDistance"?ps.longDistanceRoutes:"grey"),Ze(e,"class","svelte-gv50c1")},m(U,ee){ae(U,e,ee),Z(e,n),Z(e,s),Z(e,a),Z(e,h),Z(e,m),Z(e,l),Z(e,x),Z(e,S),it(T,e,null),C=!0,N||(B=[Rt(n,"click",r[1]),Rt(a,"click",r[2]),Rt(m,"click",r[3]),Rt(x,"click",r[4])],N=!0)},p(U,[ee]){ee&1&&Rn(n,"background",U[0]=="Primary"?ps.primaryRoutes:"grey"),ee&1&&Rn(a,"background",U[0]=="Secondary"?ps.secondaryRoutes:"grey"),ee&1&&Rn(m,"background",U[0]=="LocalAccess"?ps.localAccessRoutes:"grey"),ee&1&&Rn(x,"background",U[0]=="LongDistance"?ps.longDistanceRoutes:"grey");const ie={};ee&33&&(ie.$$scope={dirty:ee,ctx:U}),T.$set(ie)},i(U){C||(ge(T.$$.fragment,U),C=!0)},o(U){Se(T.$$.fragment,U),C=!1},d(U){U&&oe(e),rt(T),N=!1,$i(B)}}}function UA(r,e,n){let s;return zt(r,_l,x=>n(0,s=x)),[s,()=>Dn(_l,s="Primary",s),()=>Dn(_l,s="Secondary",s),()=>Dn(_l,s="LocalAccess",s),()=>Dn(_l,s="LongDistance",s)]}class jA extends fn{constructor(e){super(),hn(this,e,UA,BA,an,{})}}function qA(r){let e,n;const s=r[3].default,a=Zi(s,r,r[2],null);return{c(){e=le("div"),a&&a.c()},m(h,m){ae(h,e,m),a&&a.m(e,null),r[4](e),n=!0},p(h,[m]){a&&a.p&&(!n||m&4)&&Xi(a,s,h,h[2],n?Hi(s,h[2],m,null):Wi(h[2]),null)},i(h){n||(ge(a,h),n=!0)},o(h){Se(a,h),n=!1},d(h){h&&oe(e),a&&a.d(h),r[4](null)}}}function VA(r,e,n){let{$$slots:s={},$$scope:a}=e,{name:h}=e,m=null;function l(x){$n[x?"unshift":"push"](()=>{m=x,n(0,m)})}return r.$$set=x=>{"name"in x&&n(1,h=x.name),"$$scope"in x&&n(2,a=x.$$scope)},r.$$.update=()=>{r.$$.dirty&3&&m&&Qv.update(x=>(x.set(h,m),x))},[m,h,a,s,l]}class to extends fn{constructor(e){super(),hn(this,e,VA,qA,an,{name:1})}}function _0(r){let e,n,s;return{c(){e=le("button"),e.textContent="Import existing routes",Ze(e,"class","outline")},m(a,h){ae(a,e,h),n||(s=Rt(e,"click",r[6]),n=!0)},p:tt,d(a){a&&oe(e),n=!1,s()}}}function GA(r){let e,n,s,a,h,m,l,x=r[0]&&_0(r);return{c(){e=le("label"),n=le("input"),s=ze(`
    Existing network`),a=Oe(),x&&x.c(),h=ii(),Ze(n,"type","checkbox")},m(S,T){ae(S,e,T),Z(e,n),n.checked=r[0],Z(e,s),ae(S,a,T),x&&x.m(S,T),ae(S,h,T),m||(l=Rt(n,"change",r[5]),m=!0)},p(S,T){T&1&&(n.checked=S[0]),S[0]?x?x.p(S,T):(x=_0(S),x.c(),x.m(h.parentNode,h)):x&&(x.d(1),x=null)},d(S){S&&(oe(e),oe(a),oe(h)),x&&x.d(S),m=!1,l()}}}function y0(r){let e,n;return e=new Kv({props:{$$slots:{default:[ZA]},$$scope:{ctx:r}}}),e.$on("close",r[8]),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&4100&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function ZA(r){let e,n,s,a,h,m,l,x,S;return{c(){e=le("h2"),e.textContent="Import existing routes from OpenStreetMap",n=Oe(),s=le("p"),a=ze(`This will add existing routes to your network. Only Segregated Tracks
      (wide and narrow) and Off Road Cycleways will be imported; other
      infrastructure types are not high-quality enough in practice to be
      considered part of the network. OpenStreetMap data and this tool's
      interpretation of it are imperfect, so please check the results carefully
      and remove / adjust any errors.

      `),h=le("button"),h.textContent="Import existing routes",m=Oe(),l=le("button"),l.textContent="Cancel",Ze(l,"class","secondary")},m(T,C){ae(T,e,C),ae(T,n,C),ae(T,s,C),Z(s,a),Z(s,h),Z(s,m),Z(s,l),x||(S=[Rt(h,"click",r[4]),Rt(l,"click",r[7])],x=!0)},p:tt,d(T){T&&(oe(e),oe(n),oe(s)),x=!1,$i(S)}}}function v0(r){let e,n,s,a={ctx:r,current:null,token:null,hasCatch:!1,pending:YA,then:XA,catch:HA,value:10,blocks:[,,,]};return gs(n=r[3].classifyExistingNetwork(),a),{c(){e=ii(),a.block.c()},m(h,m){ae(h,e,m),a.block.m(h,a.anchor=m),a.mount=()=>e.parentNode,a.anchor=e,s=!0},p(h,m){r=h,a.ctx=r,m&8&&n!==(n=r[3].classifyExistingNetwork())&&gs(n,a)||Il(a,r,m)},i(h){s||(ge(a.block),s=!0)},o(h){for(let m=0;m<3;m+=1){const l=a.blocks[m];Se(l)}s=!1},d(h){h&&oe(e),a.block.d(h),a.token=null,a=null}}}function HA(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function XA(r){let e,n;return e=new rr({props:{data:r[10],generateId:!0,$$slots:{default:[$A]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&8&&(h.data=s[10]),a&4097&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function WA(r){let e=ou[r[11].infra_type][0]+"",n;return{c(){n=ze(e)},m(s,a){ae(s,n,a)},p(s,a){a&2048&&e!==(e=ou[s[11].infra_type][0]+"")&&Ct(n,e)},d(s){s&&oe(n)}}}function KA(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[WA,({props:s})=>({11:s}),({props:s})=>s?2048:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&6144&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function $A(r){let e,n;return e=new _r({props:{layout:{visibility:r[0]?"visible":"none"},paint:{"line-width":Ls(5,7),"line-color":ac,"line-opacity":.8},manageHoverState:!0,$$slots:{default:[KA]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&1&&(h.layout={visibility:s[0]?"visible":"none"}),a&4096&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function YA(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function JA(r){let e,n,s,a,h;e=new to({props:{name:"existing network",$$slots:{default:[GA]},$$scope:{ctx:r}}});let m=r[2]&&y0(r),l=r[3]&&r[1]&&v0(r);return{c(){ot(e.$$.fragment),n=Oe(),m&&m.c(),s=Oe(),l&&l.c(),a=ii()},m(x,S){it(e,x,S),ae(x,n,S),m&&m.m(x,S),ae(x,s,S),l&&l.m(x,S),ae(x,a,S),h=!0},p(x,[S]){const T={};S&4101&&(T.$$scope={dirty:S,ctx:x}),e.$set(T),x[2]?m?(m.p(x,S),S&4&&ge(m,1)):(m=y0(x),m.c(),ge(m,1),m.m(s.parentNode,s)):m&&(zn(),Se(m,1,1,()=>{m=null}),Fn()),x[3]&&x[1]?l?(l.p(x,S),S&10&&ge(l,1)):(l=v0(x),l.c(),ge(l,1),l.m(a.parentNode,a)):l&&(zn(),Se(l,1,1,()=>{l=null}),Fn())},i(x){h||(ge(e.$$.fragment,x),ge(m),ge(l),h=!0)},o(x){Se(e.$$.fragment,x),Se(m),Se(l),h=!1},d(x){x&&(oe(n),oe(s),oe(a)),rt(e,x),m&&m.d(x),l&&l.d(x)}}}function QA(r,e,n){let s,a;zt(r,Ph,B=>n(9,s=B)),zt(r,sr,B=>n(3,a=B));let h=!1,m=!1,l=!1;async function x(){if(n(2,l=!1),a){let B=a.importExistingRoutes(),U=B==1?"route segment":"route segments";await Dh(),Dn(Ph,s+=1,s),window.alert(`Imported ${B} ${U}`),n(0,h=!1)}}function S(){h=this.checked,n(0,h)}const T=()=>n(2,l=!0),C=()=>n(2,l=!1),N=()=>n(2,l=!1);return r.$$.update=()=>{r.$$.dirty&1&&h&&n(1,m=!0)},[h,m,l,a,x,S,T,C,N]}class eT extends fn{constructor(e){super(),hn(this,e,QA,JA,an,{})}}function b0(r,e,n){const s=r.slice();return s[17]=e[n][0],s[18]=e[n][1],s}function x0(r,e,n){const s=r.slice();return s[17]=e[n][0],s[18]=e[n][1],s}function w0(r,e,n){const s=r.slice();return s[17]=e[n][0],s[18]=e[n][1],s}function k0(r,e,n){const s=r.slice();return s[17]=e[n][0],s[18]=e[n][1],s}function I0(r,e,n){const s=r.slice();return s[17]=e[n][0],s[18]=e[n][1],s}function S0(r,e,n){const s=r.slice();return s[17]=e[n][0],s[18]=e[n][1],s}function E0(r){let e,n,s,a,h,m,l,x,S,T,C,N,B,U,ee,ie,se,Q=Vn(r[7]),Y=[];for(let Le=0;Le<Q.length;Le+=1)Y[Le]=A0(S0(r,Q,Le));let _e=Vn(r[8]),ve=[];for(let Le=0;Le<_e.length;Le+=1)ve[Le]=T0(I0(r,_e,Le));let Ae=Vn(r[9]),ce=[];for(let Le=0;Le<Ae.length;Le+=1)ce[Le]=C0(k0(r,Ae,Le));let xe=Vn(r[10]),be=[];for(let Le=0;Le<xe.length;Le+=1)be[Le]=L0(w0(r,xe,Le));return{c(){e=le("label"),n=ze(`Trip purpose:
      `),s=le("select");for(let Le=0;Le<Y.length;Le+=1)Y[Le].c();a=Oe(),h=le("label"),m=ze(`Scenario:
      `),l=le("select");for(let Le=0;Le<ve.length;Le+=1)ve[Le].c();x=Oe(),S=le("label"),T=ze(`Network type:
      `),C=le("select");for(let Le=0;Le<ce.length;Le+=1)ce[Le].c();N=Oe(),B=le("label"),U=ze(`Color by:
      `),ee=le("select");for(let Le=0;Le<be.length;Le+=1)be[Le].c();r[0]===void 0&&Ro(()=>r[12].call(s)),r[1]===void 0&&Ro(()=>r[13].call(l)),r[2]===void 0&&Ro(()=>r[14].call(C)),r[3]===void 0&&Ro(()=>r[15].call(ee))},m(Le,ke){ae(Le,e,ke),Z(e,n),Z(e,s);for(let ye=0;ye<Y.length;ye+=1)Y[ye]&&Y[ye].m(s,null);ds(s,r[0],!0),ae(Le,a,ke),ae(Le,h,ke),Z(h,m),Z(h,l);for(let ye=0;ye<ve.length;ye+=1)ve[ye]&&ve[ye].m(l,null);ds(l,r[1],!0),ae(Le,x,ke),ae(Le,S,ke),Z(S,T),Z(S,C);for(let ye=0;ye<ce.length;ye+=1)ce[ye]&&ce[ye].m(C,null);ds(C,r[2],!0),ae(Le,N,ke),ae(Le,B,ke),Z(B,U),Z(B,ee);for(let ye=0;ye<be.length;ye+=1)be[ye]&&be[ye].m(ee,null);ds(ee,r[3],!0),ie||(se=[Rt(s,"change",r[12]),Rt(l,"change",r[13]),Rt(C,"change",r[14]),Rt(ee,"change",r[15])],ie=!0)},p(Le,ke){if(ke[0]&128){Q=Vn(Le[7]);let ye;for(ye=0;ye<Q.length;ye+=1){const Ue=S0(Le,Q,ye);Y[ye]?Y[ye].p(Ue,ke):(Y[ye]=A0(Ue),Y[ye].c(),Y[ye].m(s,null))}for(;ye<Y.length;ye+=1)Y[ye].d(1);Y.length=Q.length}if(ke[0]&129&&ds(s,Le[0]),ke[0]&256){_e=Vn(Le[8]);let ye;for(ye=0;ye<_e.length;ye+=1){const Ue=I0(Le,_e,ye);ve[ye]?ve[ye].p(Ue,ke):(ve[ye]=T0(Ue),ve[ye].c(),ve[ye].m(l,null))}for(;ye<ve.length;ye+=1)ve[ye].d(1);ve.length=_e.length}if(ke[0]&258&&ds(l,Le[1]),ke[0]&512){Ae=Vn(Le[9]);let ye;for(ye=0;ye<Ae.length;ye+=1){const Ue=k0(Le,Ae,ye);ce[ye]?ce[ye].p(Ue,ke):(ce[ye]=C0(Ue),ce[ye].c(),ce[ye].m(C,null))}for(;ye<ce.length;ye+=1)ce[ye].d(1);ce.length=Ae.length}if(ke[0]&516&&ds(C,Le[2]),ke[0]&1024){xe=Vn(Le[10]);let ye;for(ye=0;ye<xe.length;ye+=1){const Ue=w0(Le,xe,ye);be[ye]?be[ye].p(Ue,ke):(be[ye]=L0(Ue),be[ye].c(),be[ye].m(ee,null))}for(;ye<be.length;ye+=1)be[ye].d(1);be.length=xe.length}ke[0]&1032&&ds(ee,Le[3])},d(Le){Le&&(oe(e),oe(a),oe(h),oe(x),oe(S),oe(N),oe(B)),Er(Y,Le),Er(ve,Le),Er(ce,Le),Er(be,Le),ie=!1,$i(se)}}}function A0(r){let e,n=r[18]+"",s;return{c(){e=le("option"),s=ze(n),e.__value=r[17],ki(e,e.__value)},m(a,h){ae(a,e,h),Z(e,s)},p:tt,d(a){a&&oe(e)}}}function T0(r){let e,n=r[18]+"",s;return{c(){e=le("option"),s=ze(n),e.__value=r[17],ki(e,e.__value)},m(a,h){ae(a,e,h),Z(e,s)},p:tt,d(a){a&&oe(e)}}}function C0(r){let e,n=r[18]+"",s;return{c(){e=le("option"),s=ze(n),e.__value=r[17],ki(e,e.__value)},m(a,h){ae(a,e,h),Z(e,s)},p:tt,d(a){a&&oe(e)}}}function L0(r){let e,n=r[18]+"",s;return{c(){e=le("option"),s=ze(n),e.__value=r[17],ki(e,e.__value)},m(a,h){ae(a,e,h),Z(e,s)},p:tt,d(a){a&&oe(e)}}}function tT(r){let e,n,s,a,h,m,l,x=r[5]&&E0(r);return{c(){e=le("label"),n=le("input"),s=ze(`
    Route network`),a=Oe(),x&&x.c(),h=ii(),Ze(n,"type","checkbox")},m(S,T){ae(S,e,T),Z(e,n),n.checked=r[5],Z(e,s),ae(S,a,T),x&&x.m(S,T),ae(S,h,T),m||(l=Rt(n,"change",r[11]),m=!0)},p(S,T){T[0]&32&&(n.checked=S[5]),S[5]?x?x.p(S,T):(x=E0(S),x.c(),x.m(h.parentNode,h)):x&&(x.d(1),x=null)},d(S){S&&(oe(e),oe(a),oe(h)),x&&x.d(S),m=!1,l()}}}function M0(r){let e,n,s,a,h=r[16][`${r[17]}_fastest_bicycle`].toLocaleString()+"",m,l,x,S=r[16][`${r[17]}_fastest_bicycle_go_dutch`].toLocaleString()+"",T,C,N,B=r[16][`${r[17]}_fastest_bicycle_ebike`].toLocaleString()+"",U,ee;return{c(){e=le("tr"),n=le("th"),n.textContent=`${r[18]}`,s=Oe(),a=le("td"),m=ze(h),l=Oe(),x=le("td"),T=ze(S),C=Oe(),N=le("td"),U=ze(B),ee=Oe()},m(ie,se){ae(ie,e,se),Z(e,n),Z(e,s),Z(e,a),Z(a,m),Z(e,l),Z(e,x),Z(x,T),Z(e,C),Z(e,N),Z(N,U),Z(e,ee)},p(ie,se){se[0]&65536&&h!==(h=ie[16][`${ie[17]}_fastest_bicycle`].toLocaleString()+"")&&Ct(m,h),se[0]&65536&&S!==(S=ie[16][`${ie[17]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&Ct(T,S),se[0]&65536&&B!==(B=ie[16][`${ie[17]}_fastest_bicycle_ebike`].toLocaleString()+"")&&Ct(U,B)},d(ie){ie&&oe(e)}}}function R0(r){let e,n,s,a,h=r[16][`${r[17]}_quietest_bicycle`].toLocaleString()+"",m,l,x,S=r[16][`${r[17]}_quietest_bicycle_go_dutch`].toLocaleString()+"",T,C,N,B=r[16][`${r[17]}_quietest_bicycle_ebike`].toLocaleString()+"",U,ee;return{c(){e=le("tr"),n=le("th"),n.textContent=`${r[18]}`,s=Oe(),a=le("td"),m=ze(h),l=Oe(),x=le("td"),T=ze(S),C=Oe(),N=le("td"),U=ze(B),ee=Oe()},m(ie,se){ae(ie,e,se),Z(e,n),Z(e,s),Z(e,a),Z(a,m),Z(e,l),Z(e,x),Z(x,T),Z(e,C),Z(e,N),Z(N,U),Z(e,ee)},p(ie,se){se[0]&65536&&h!==(h=ie[16][`${ie[17]}_quietest_bicycle`].toLocaleString()+"")&&Ct(m,h),se[0]&65536&&S!==(S=ie[16][`${ie[17]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&Ct(T,S),se[0]&65536&&B!==(B=ie[16][`${ie[17]}_quietest_bicycle_ebike`].toLocaleString()+"")&&Ct(U,B)},d(ie){ie&&oe(e)}}}function nT(r){let e,n,s,a=r[16][r[4]].toLocaleString()+"",h,m,l,x,S=r[16].gradient+"",T,C,N,B,U,ee=r[16].quietness+"",ie,se,Q,Y,_e,ve,Ae,ce,xe,be,Le,ke,ye,Ue,qe,pt,St,dt=Vn(r[7]),ut=[];for(let kt=0;kt<dt.length;kt+=1)ut[kt]=M0(x0(r,dt,kt));let Ut=Vn(r[7]),vt=[];for(let kt=0;kt<Ut.length;kt+=1)vt[kt]=R0(b0(r,Ut,kt));return{c(){e=le("div"),n=le("p"),s=ze("Cyclists: "),h=ze(a),m=Oe(),l=le("p"),x=ze("Gradient: "),T=ze(S),C=ze("%"),N=Oe(),B=le("p"),U=ze("Cycle-friendliness: "),ie=ze(ee),se=ze("%"),Q=Oe(),Y=le("details"),_e=le("summary"),_e.textContent="All network details",ve=Oe(),Ae=le("p"),Ae.textContent="Fast/Direct network",ce=Oe(),xe=le("table"),be=le("tr"),be.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Le=Oe();for(let kt=0;kt<ut.length;kt+=1)ut[kt].c();ke=Oe(),ye=le("p"),ye.textContent="Quiet/Indirect network",Ue=Oe(),qe=le("table"),pt=le("tr"),pt.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",St=Oe();for(let kt=0;kt<vt.length;kt+=1)vt[kt].c();Rn(e,"max-width","30vw"),Rn(e,"max-height","60vh"),Rn(e,"overflow","auto")},m(kt,ft){ae(kt,e,ft),Z(e,n),Z(n,s),Z(n,h),Z(e,m),Z(e,l),Z(l,x),Z(l,T),Z(l,C),Z(e,N),Z(e,B),Z(B,U),Z(B,ie),Z(B,se),Z(e,Q),Z(e,Y),Z(Y,_e),Z(Y,ve),Z(Y,Ae),Z(Y,ce),Z(Y,xe),Z(xe,be),Z(xe,Le);for(let wt=0;wt<ut.length;wt+=1)ut[wt]&&ut[wt].m(xe,null);Z(Y,ke),Z(Y,ye),Z(Y,Ue),Z(Y,qe),Z(qe,pt),Z(qe,St);for(let wt=0;wt<vt.length;wt+=1)vt[wt]&&vt[wt].m(qe,null)},p(kt,ft){if(ft[0]&65552&&a!==(a=kt[16][kt[4]].toLocaleString()+"")&&Ct(h,a),ft[0]&65536&&S!==(S=kt[16].gradient+"")&&Ct(T,S),ft[0]&65536&&ee!==(ee=kt[16].quietness+"")&&Ct(ie,ee),ft[0]&65664){dt=Vn(kt[7]);let wt;for(wt=0;wt<dt.length;wt+=1){const It=x0(kt,dt,wt);ut[wt]?ut[wt].p(It,ft):(ut[wt]=M0(It),ut[wt].c(),ut[wt].m(xe,null))}for(;wt<ut.length;wt+=1)ut[wt].d(1);ut.length=dt.length}if(ft[0]&65664){Ut=Vn(kt[7]);let wt;for(wt=0;wt<Ut.length;wt+=1){const It=b0(kt,Ut,wt);vt[wt]?vt[wt].p(It,ft):(vt[wt]=R0(It),vt[wt].c(),vt[wt].m(qe,null))}for(;wt<vt.length;wt+=1)vt[wt].d(1);vt.length=Ut.length}},d(kt){kt&&oe(e),Er(ut,kt),Er(vt,kt)}}}function iT(r){let e,n;return e=new js({props:{openOn:"click",$$slots:{default:[nT,({props:s})=>({16:s}),({props:s})=>[s?65536:0]]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a[0]&65552|a[1]&1&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function rT(r){let e,n;return e=new _r({props:{sourceLayer:"rnet",paint:{"line-color":r[6],"line-width":td(r[4])},layout:{visibility:r[5]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[iT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a[0]&80&&(h.paint={"line-color":s[6],"line-width":td(s[4])}),a[0]&32&&(h.layout={visibility:s[5]?"visible":"none"}),a[0]&16|a[1]&1&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function sT(r){let e,n,s,a;return e=new to({props:{name:"route network",$$slots:{default:[tT]},$$scope:{ctx:r}}}),s=new Jp({props:{url:`pmtiles://${rd("route_network.pmtiles")}`,$$slots:{default:[rT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),n=Oe(),ot(s.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(s,h,m),a=!0},p(h,m){const l={};m[0]&47|m[1]&1&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m[0]&112|m[1]&1&&(x.$$scope={dirty:m,ctx:h}),s.$set(x)},i(h){a||(ge(e.$$.fragment,h),ge(s.$$.fragment,h),a=!0)},o(h){Se(e.$$.fragment,h),Se(s.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(s,h)}}}function oT(r,e,n){let s,a,h=!1,m="all",l="bicycle_go_dutch",x="fastest",S="flow",T=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],C=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],N=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],B=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]];function U(){h=this.checked,n(5,h)}function ee(){m=yl(this),n(0,m),n(7,T)}function ie(){l=yl(this),n(1,l),n(8,C)}function se(){x=yl(this),n(2,x),n(9,N)}function Q(){S=yl(this),n(3,S),n(10,B)}return r.$$.update=()=>{r.$$.dirty[0]&7&&n(4,s=`${m}_${x}_${l}`),r.$$.dirty[0]&24&&n(6,a={none:"#304ce7",flow:nm(s),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:["step",["get","gradient"],"#59ee19",3,"#37a009",5,"#FFC300",7,"#C70039",10,"#581845",100,"#000000"]}[S])},[m,l,x,S,s,h,a,T,C,N,B,U,ee,ie,se,Q]}class aT extends fn{constructor(e){super(),hn(this,e,oT,sT,an,{},null,[-1,-1])}}function P0(r){let e,n,s,a,h,m,l,x,S,T,C;return{c(){e=le("button"),e.textContent="Import core network",n=Oe(),s=le("label"),a=le("input"),h=ze(`
      Show actual core network`),m=Oe(),l=le("label"),x=le("input"),S=ze(`
      Show map-matched core network`),Ze(e,"class","outline"),Ze(a,"type","checkbox"),Ze(x,"type","checkbox"),Rn(l,"color","red")},m(N,B){ae(N,e,B),ae(N,n,B),ae(N,s,B),Z(s,a),a.checked=r[2],Z(s,h),ae(N,m,B),ae(N,l,B),Z(l,x),x.checked=r[3],Z(l,S),T||(C=[Rt(e,"click",r[5]),Rt(a,"change",r[7]),Rt(x,"change",r[8])],T=!0)},p(N,B){B&4&&(a.checked=N[2]),B&8&&(x.checked=N[3])},d(N){N&&(oe(e),oe(n),oe(s),oe(m),oe(l)),T=!1,$i(C)}}}function lT(r){let e,n,s,a,h,m,l,x=r[0]&&P0(r);return{c(){e=le("label"),n=le("input"),s=ze(`
    Core network`),a=Oe(),x&&x.c(),h=ii(),Ze(n,"type","checkbox")},m(S,T){ae(S,e,T),Z(e,n),n.checked=r[0],Z(e,s),ae(S,a,T),x&&x.m(S,T),ae(S,h,T),m||(l=Rt(n,"change",r[6]),m=!0)},p(S,T){T&1&&(n.checked=S[0]),S[0]?x?x.p(S,T):(x=P0(S),x.c(),x.m(h.parentNode,h)):x&&(x.d(1),x=null)},d(S){S&&(oe(e),oe(a),oe(h)),x&&x.d(S),m=!1,l()}}}function uT(r){let e,n=r[11].all_fastest_bicycle_go_dutch+"",s;return{c(){e=ze("Go Dutch value "),s=ze(n)},m(a,h){ae(a,e,h),ae(a,s,h)},p(a,h){h&2048&&n!==(n=a[11].all_fastest_bicycle_go_dutch+"")&&Ct(s,n)},d(a){a&&(oe(e),oe(s))}}}function cT(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[uT,({props:s})=>({11:s}),({props:s})=>s?2048:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&6144&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function hT(r){let e,n;return e=new _r({props:{sourceLayer:"coherent_networks",paint:{"line-color":"black","line-width":2},layout:{visibility:r[0]&&r[2]?"visible":"none"},$$slots:{default:[cT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&5&&(h.layout={visibility:s[0]&&s[2]?"visible":"none"}),a&4096&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function D0(r){let e,n,s,a={ctx:r,current:null,token:null,hasCatch:!1,pending:mT,then:dT,catch:fT,value:10,blocks:[,,,]};return gs(n=r[4].renderCoreNetwork(),a),{c(){e=ii(),a.block.c()},m(h,m){ae(h,e,m),a.block.m(h,a.anchor=m),a.mount=()=>e.parentNode,a.anchor=e,s=!0},p(h,m){r=h,a.ctx=r,m&16&&n!==(n=r[4].renderCoreNetwork())&&gs(n,a)||Il(a,r,m)},i(h){s||(ge(a.block),s=!0)},o(h){for(let m=0;m<3;m+=1){const l=a.blocks[m];Se(l)}s=!1},d(h){h&&oe(e),a.block.d(h),a.token=null,a=null}}}function fT(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function dT(r){let e,n;return e=new rr({props:{data:r[10],generateId:!0,$$slots:{default:[pT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&16&&(h.data=s[10]),a&4105&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function pT(r){let e,n;return e=new _r({props:{paint:{"line-color":"red","line-width":10,"line-opacity":.5},layout:{visibility:r[0]&&r[3]?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&9&&(h.layout={visibility:s[0]&&s[3]?"visible":"none"}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function mT(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function gT(r){let e,n,s,a,h,m;e=new to({props:{name:"core network",$$slots:{default:[lT]},$$scope:{ctx:r}}}),s=new Jp({props:{url:`pmtiles://${rd("core_network.pmtiles")}`,$$slots:{default:[hT]},$$scope:{ctx:r}}});let l=r[4]&&r[1]&&D0(r);return{c(){ot(e.$$.fragment),n=Oe(),ot(s.$$.fragment),a=Oe(),l&&l.c(),h=ii()},m(x,S){it(e,x,S),ae(x,n,S),it(s,x,S),ae(x,a,S),l&&l.m(x,S),ae(x,h,S),m=!0},p(x,[S]){const T={};S&4109&&(T.$$scope={dirty:S,ctx:x}),e.$set(T);const C={};S&4101&&(C.$$scope={dirty:S,ctx:x}),s.$set(C),x[4]&&x[1]?l?(l.p(x,S),S&18&&ge(l,1)):(l=D0(x),l.c(),ge(l,1),l.m(h.parentNode,h)):l&&(zn(),Se(l,1,1,()=>{l=null}),Fn())},i(x){m||(ge(e.$$.fragment,x),ge(s.$$.fragment,x),ge(l),m=!0)},o(x){Se(e.$$.fragment,x),Se(s.$$.fragment,x),Se(l),m=!1},d(x){x&&(oe(n),oe(a),oe(h)),rt(e,x),rt(s,x),l&&l.d(x)}}}function _T(r,e,n){let s,a;zt(r,Ph,B=>n(9,s=B)),zt(r,sr,B=>n(4,a=B));let h=!1,m=!1,l=!0,x=!0;async function S(){if(a){let B=a.importCoreNetwork(),U=B==1?"route segment":"route segments";await Dh(),Dn(Ph,s+=1,s),window.alert(`Imported ${B} ${U}`)}}function T(){h=this.checked,n(0,h)}function C(){l=this.checked,n(2,l)}function N(){x=this.checked,n(3,x)}return r.$$.update=()=>{r.$$.dirty&1&&h&&n(1,m=!0)},[h,m,l,x,a,S,T,C,N]}class yT extends fn{constructor(e){super(),hn(this,e,_T,gT,an,{})}}function vT(r){let e,n;return e=new _r({props:{paint:{"line-width":3,"line-color":["case",["==",["get","kind"],"severance"],"red","blue"]}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p:tt,i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function bT(r){let e,n;return e=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[vT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,[a]){const h={};a&1&&(h.data=s[0]),a&32&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function xT(r,e,n){let s;zt(r,sr,x=>n(3,s=x));let{kind:a}=e,{hovered:h}=e,m={type:"FeatureCollection",features:[]};async function l(x){s&&x?x.properties.reachable?n(0,m=await s.debugReachablePath(a,x.properties.idx)):n(0,m=await s.debugUnreachablePath(a,x.properties.idx)):n(0,m={type:"FeatureCollection",features:[]})}return r.$$set=x=>{"kind"in x&&n(1,a=x.kind),"hovered"in x&&n(2,h=x.hovered)},r.$$.update=()=>{r.$$.dirty&4&&l(h)},[m,a,h]}class im extends fn{constructor(e){super(),hn(this,e,xT,bT,an,{kind:1,hovered:2})}}function N0(r){let e,n,s,a=r[3].toLocaleString()+"",h,m,l=r[0].features.length.toLocaleString()+"",x,S,T=Ir(r[3],r[0].features.length)+"",C,N,B,U,ee,ie,se;return U=new _c({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=le("button"),e.textContent="Recalculate",n=Oe(),s=le("p"),h=ze(a),m=ze(" / "),x=ze(l),S=ze(" ("),C=ze(T),N=ze(") reachable"),B=Oe(),ot(U.$$.fragment),Ze(e,"class","outline")},m(Q,Y){ae(Q,e,Y),ae(Q,n,Y),ae(Q,s,Y),Z(s,h),Z(s,m),Z(s,x),Z(s,S),Z(s,C),Z(s,N),ae(Q,B,Y),it(U,Q,Y),ee=!0,ie||(se=Rt(e,"click",r[4]),ie=!0)},p(Q,Y){(!ee||Y&8)&&a!==(a=Q[3].toLocaleString()+"")&&Ct(h,a),(!ee||Y&1)&&l!==(l=Q[0].features.length.toLocaleString()+"")&&Ct(x,l),(!ee||Y&9)&&T!==(T=Ir(Q[3],Q[0].features.length)+"")&&Ct(C,T)},i(Q){ee||(ge(U.$$.fragment,Q),ee=!0)},o(Q){Se(U.$$.fragment,Q),ee=!1},d(Q){Q&&(oe(e),oe(n),oe(s),oe(B)),rt(U,Q),ie=!1,se()}}}function wT(r){let e,n,s,a,h,m,l,x,S=r[1]&&N0(r);return{c(){e=le("label"),n=le("input"),s=ze(`
    Schools`),a=Oe(),S&&S.c(),h=ii(),Ze(n,"type","checkbox")},m(T,C){ae(T,e,C),Z(e,n),n.checked=r[1],Z(e,s),ae(T,a,C),S&&S.m(T,C),ae(T,h,C),m=!0,l||(x=Rt(n,"change",r[5]),l=!0)},p(T,C){C&2&&(n.checked=T[1]),T[1]?S?(S.p(T,C),C&2&&ge(S,1)):(S=N0(T),S.c(),ge(S,1),S.m(h.parentNode,h)):S&&(zn(),Se(S,1,1,()=>{S=null}),Fn())},i(T){m||(ge(S),m=!0)},o(T){Se(S),m=!1},d(T){T&&(oe(e),oe(a),oe(h)),S&&S.d(T),l=!1,x()}}}function kT(r){let e=r[8].name+"",n,s,a=r[8].kind+"",h,m,l=r[8].pupils+"",x,S,T=r[8].reachable?"is":"is not",C,N;return{c(){n=ze(e),s=ze(" is a "),h=ze(a),m=ze(" school with "),x=ze(l),S=ze(" pupils. It "),C=ze(T),N=ze(" reachable.")},m(B,U){ae(B,n,U),ae(B,s,U),ae(B,h,U),ae(B,m,U),ae(B,x,U),ae(B,S,U),ae(B,C,U),ae(B,N,U)},p(B,U){U&256&&e!==(e=B[8].name+"")&&Ct(n,e),U&256&&a!==(a=B[8].kind+"")&&Ct(h,a),U&256&&l!==(l=B[8].pupils+"")&&Ct(x,l),U&256&&T!==(T=B[8].reachable?"is":"is not")&&Ct(C,T)},d(B){B&&(oe(n),oe(s),oe(h),oe(m),oe(x),oe(S),oe(C),oe(N))}}}function IT(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[kT,({props:s})=>({8:s}),({props:s})=>s?256:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&768&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function ST(r){let e,n,s;function a(m){r[6](m)}let h={manageHoverState:!0,paint:{"circle-color":["case",["get","reachable"],"purple","red"],"circle-radius":Ls(5,8)},layout:{visibility:r[1]?"visible":"none"},$$slots:{default:[IT]},$$scope:{ctx:r}};return r[2]!==void 0&&(h.hovered=r[2]),e=new Yp({props:h}),$n.push(()=>gr(e,"hovered",a)),{c(){ot(e.$$.fragment)},m(m,l){it(e,m,l),s=!0},p(m,l){const x={};l&2&&(x.layout={visibility:m[1]?"visible":"none"}),l&512&&(x.$$scope={dirty:l,ctx:m}),!n&&l&4&&(n=!0,x.hovered=m[2],mr(()=>n=!1)),e.$set(x)},i(m){s||(ge(e.$$.fragment,m),s=!0)},o(m){Se(e.$$.fragment,m),s=!1},d(m){rt(e,m)}}}function ET(r){let e,n,s,a,h,m;return e=new to({props:{name:"schools",$$slots:{default:[wT]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[ST]},$$scope:{ctx:r}}}),h=new im({props:{kind:"schools",hovered:r[2]}}),{c(){ot(e.$$.fragment),n=Oe(),ot(s.$$.fragment),a=Oe(),ot(h.$$.fragment)},m(l,x){it(e,l,x),ae(l,n,x),it(s,l,x),ae(l,a,x),it(h,l,x),m=!0},p(l,[x]){const S={};x&523&&(S.$$scope={dirty:x,ctx:l}),e.$set(S);const T={};x&1&&(T.data=l[0]),x&518&&(T.$$scope={dirty:x,ctx:l}),s.$set(T);const C={};x&4&&(C.hovered=l[2]),h.$set(C)},i(l){m||(ge(e.$$.fragment,l),ge(s.$$.fragment,l),ge(h.$$.fragment,l),m=!0)},o(l){Se(e.$$.fragment,l),Se(s.$$.fragment,l),Se(h.$$.fragment,l),m=!1},d(l){l&&(oe(n),oe(a)),rt(e,l),rt(s,l),rt(h,l)}}}function AT(r,e,n){let s,a,h;zt(r,Xf,C=>n(1,a=C)),zt(r,sr,C=>n(7,h=C));let m={type:"FeatureCollection",features:[]},l;async function x(){h&&n(0,m=await h.getSchools())}function S(){a=this.checked,Xf.set(a)}function T(C){l=C,n(2,l)}return r.$$.update=()=>{r.$$.dirty&3&&a&&m.features.length==0&&x(),r.$$.dirty&1&&n(3,s=m.features.filter(C=>C.properties.reachable).length)},[m,a,l,s,x,S,T]}class TT extends fn{constructor(e){super(),hn(this,e,AT,ET,an,{})}}function z0(r){let e,n,s,a=r[3].toLocaleString()+"",h,m,l=r[0].features.length.toLocaleString()+"",x,S,T=Ir(r[3],r[0].features.length)+"",C,N,B,U,ee,ie,se;return U=new _c({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=le("button"),e.textContent="Recalculate",n=Oe(),s=le("p"),h=ze(a),m=ze(" / "),x=ze(l),S=ze(" ("),C=ze(T),N=ze(") reachable"),B=Oe(),ot(U.$$.fragment),Ze(e,"class","outline")},m(Q,Y){ae(Q,e,Y),ae(Q,n,Y),ae(Q,s,Y),Z(s,h),Z(s,m),Z(s,x),Z(s,S),Z(s,C),Z(s,N),ae(Q,B,Y),it(U,Q,Y),ee=!0,ie||(se=Rt(e,"click",r[4]),ie=!0)},p(Q,Y){(!ee||Y&8)&&a!==(a=Q[3].toLocaleString()+"")&&Ct(h,a),(!ee||Y&1)&&l!==(l=Q[0].features.length.toLocaleString()+"")&&Ct(x,l),(!ee||Y&9)&&T!==(T=Ir(Q[3],Q[0].features.length)+"")&&Ct(C,T)},i(Q){ee||(ge(U.$$.fragment,Q),ee=!0)},o(Q){Se(U.$$.fragment,Q),ee=!1},d(Q){Q&&(oe(e),oe(n),oe(s),oe(B)),rt(U,Q),ie=!1,se()}}}function CT(r){let e,n,s,a,h,m,l,x,S=r[1]&&z0(r);return{c(){e=le("label"),n=le("input"),s=ze(`
    Town centres`),a=Oe(),S&&S.c(),h=ii(),Ze(n,"type","checkbox")},m(T,C){ae(T,e,C),Z(e,n),n.checked=r[1],Z(e,s),ae(T,a,C),S&&S.m(T,C),ae(T,h,C),m=!0,l||(x=Rt(n,"change",r[5]),l=!0)},p(T,C){C&2&&(n.checked=T[1]),T[1]?S?(S.p(T,C),C&2&&ge(S,1)):(S=z0(T),S.c(),ge(S,1),S.m(h.parentNode,h)):S&&(zn(),Se(S,1,1,()=>{S=null}),Fn())},i(T){m||(ge(S),m=!0)},o(T){Se(S),m=!1},d(T){T&&(oe(e),oe(a),oe(h)),S&&S.d(T),l=!1,x()}}}function LT(r){let e,n=(r[8].name||"")+"",s,a,h=r[8].reachable?"is":"is not",m,l;return{c(){e=ze("Town centre "),s=ze(n),a=Oe(),m=ze(h),l=ze(" reachable.")},m(x,S){ae(x,e,S),ae(x,s,S),ae(x,a,S),ae(x,m,S),ae(x,l,S)},p(x,S){S&256&&n!==(n=(x[8].name||"")+"")&&Ct(s,n),S&256&&h!==(h=x[8].reachable?"is":"is not")&&Ct(m,h)},d(x){x&&(oe(e),oe(s),oe(a),oe(m),oe(l))}}}function MT(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[LT,({props:s})=>({8:s}),({props:s})=>s?256:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&768&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function RT(r){let e,n,s;function a(m){r[6](m)}let h={manageHoverState:!0,paint:{"fill-color":["case",["get","reachable"],"purple","red"],"fill-opacity":Ls(.7,.9)},layout:{visibility:r[1]?"visible":"none"},$$slots:{default:[MT]},$$scope:{ctx:r}};return r[2]!==void 0&&(h.hovered=r[2]),e=new mc({props:h}),$n.push(()=>gr(e,"hovered",a)),{c(){ot(e.$$.fragment)},m(m,l){it(e,m,l),s=!0},p(m,l){const x={};l&2&&(x.layout={visibility:m[1]?"visible":"none"}),l&512&&(x.$$scope={dirty:l,ctx:m}),!n&&l&4&&(n=!0,x.hovered=m[2],mr(()=>n=!1)),e.$set(x)},i(m){s||(ge(e.$$.fragment,m),s=!0)},o(m){Se(e.$$.fragment,m),s=!1},d(m){rt(e,m)}}}function PT(r){let e,n,s,a,h,m;return e=new to({props:{name:"town centres",$$slots:{default:[CT]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[RT]},$$scope:{ctx:r}}}),h=new im({props:{kind:"town_centres",hovered:r[2]}}),{c(){ot(e.$$.fragment),n=Oe(),ot(s.$$.fragment),a=Oe(),ot(h.$$.fragment)},m(l,x){it(e,l,x),ae(l,n,x),it(s,l,x),ae(l,a,x),it(h,l,x),m=!0},p(l,[x]){const S={};x&523&&(S.$$scope={dirty:x,ctx:l}),e.$set(S);const T={};x&1&&(T.data=l[0]),x&518&&(T.$$scope={dirty:x,ctx:l}),s.$set(T);const C={};x&4&&(C.hovered=l[2]),h.$set(C)},i(l){m||(ge(e.$$.fragment,l),ge(s.$$.fragment,l),ge(h.$$.fragment,l),m=!0)},o(l){Se(e.$$.fragment,l),Se(s.$$.fragment,l),Se(h.$$.fragment,l),m=!1},d(l){l&&(oe(n),oe(a)),rt(e,l),rt(s,l),rt(h,l)}}}function DT(r,e,n){let s,a,h;zt(r,Kf,C=>n(1,a=C)),zt(r,sr,C=>n(7,h=C));let m={type:"FeatureCollection",features:[]},l;async function x(){h&&n(0,m=await h.getTownCentres())}function S(){a=this.checked,Kf.set(a)}function T(C){l=C,n(2,l)}return r.$$.update=()=>{r.$$.dirty&3&&a&&m.features.length==0&&x(),r.$$.dirty&1&&n(3,s=m.features.filter(C=>C.properties.reachable).length)},[m,a,l,s,x,S,T]}class NT extends fn{constructor(e){super(),hn(this,e,DT,PT,an,{})}}function F0(r){let e,n,s,a=r[3].toLocaleString()+"",h,m,l=r[0].features.length.toLocaleString()+"",x,S,T=Ir(r[3],r[0].features.length)+"",C,N,B,U,ee,ie,se;return U=new _c({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=le("button"),e.textContent="Recalculate",n=Oe(),s=le("p"),h=ze(a),m=ze(" / "),x=ze(l),S=ze(" ("),C=ze(T),N=ze(") reachable"),B=Oe(),ot(U.$$.fragment),Ze(e,"class","outline")},m(Q,Y){ae(Q,e,Y),ae(Q,n,Y),ae(Q,s,Y),Z(s,h),Z(s,m),Z(s,x),Z(s,S),Z(s,C),Z(s,N),ae(Q,B,Y),it(U,Q,Y),ee=!0,ie||(se=Rt(e,"click",r[4]),ie=!0)},p(Q,Y){(!ee||Y&8)&&a!==(a=Q[3].toLocaleString()+"")&&Ct(h,a),(!ee||Y&1)&&l!==(l=Q[0].features.length.toLocaleString()+"")&&Ct(x,l),(!ee||Y&9)&&T!==(T=Ir(Q[3],Q[0].features.length)+"")&&Ct(C,T)},i(Q){ee||(ge(U.$$.fragment,Q),ee=!0)},o(Q){Se(U.$$.fragment,Q),ee=!1},d(Q){Q&&(oe(e),oe(n),oe(s),oe(B)),rt(U,Q),ie=!1,se()}}}function zT(r){let e,n,s,a,h,m,l,x,S=r[1]&&F0(r);return{c(){e=le("label"),n=le("input"),s=ze(`
    GPs and hospitals`),a=Oe(),S&&S.c(),h=ii(),Ze(n,"type","checkbox")},m(T,C){ae(T,e,C),Z(e,n),n.checked=r[1],Z(e,s),ae(T,a,C),S&&S.m(T,C),ae(T,h,C),m=!0,l||(x=Rt(n,"change",r[5]),l=!0)},p(T,C){C&2&&(n.checked=T[1]),T[1]?S?(S.p(T,C),C&2&&ge(S,1)):(S=F0(T),S.c(),ge(S,1),S.m(h.parentNode,h)):S&&(zn(),Se(S,1,1,()=>{S=null}),Fn())},i(T){m||(ge(S),m=!0)},o(T){Se(S),m=!1},d(T){T&&(oe(e),oe(a),oe(h)),S&&S.d(T),l=!1,x()}}}function FT(r){let e=r[8].name+"",n,s,a=r[8].kind+"",h,m,l=r[8].reachable?"is":"is not",x,S;return{c(){n=ze(e),s=ze(" is a "),h=ze(a),m=ze(". It "),x=ze(l),S=ze(" reachable.")},m(T,C){ae(T,n,C),ae(T,s,C),ae(T,h,C),ae(T,m,C),ae(T,x,C),ae(T,S,C)},p(T,C){C&256&&e!==(e=T[8].name+"")&&Ct(n,e),C&256&&a!==(a=T[8].kind+"")&&Ct(h,a),C&256&&l!==(l=T[8].reachable?"is":"is not")&&Ct(x,l)},d(T){T&&(oe(n),oe(s),oe(h),oe(m),oe(x),oe(S))}}}function OT(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[FT,({props:s})=>({8:s}),({props:s})=>s?256:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&768&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function BT(r){let e,n,s;function a(m){r[6](m)}let h={manageHoverState:!0,paint:{"circle-color":["case",["get","reachable"],"purple","red"],"circle-radius":Ls(5,8)},layout:{visibility:r[1]?"visible":"none"},$$slots:{default:[OT]},$$scope:{ctx:r}};return r[2]!==void 0&&(h.hovered=r[2]),e=new Yp({props:h}),$n.push(()=>gr(e,"hovered",a)),{c(){ot(e.$$.fragment)},m(m,l){it(e,m,l),s=!0},p(m,l){const x={};l&2&&(x.layout={visibility:m[1]?"visible":"none"}),l&512&&(x.$$scope={dirty:l,ctx:m}),!n&&l&4&&(n=!0,x.hovered=m[2],mr(()=>n=!1)),e.$set(x)},i(m){s||(ge(e.$$.fragment,m),s=!0)},o(m){Se(e.$$.fragment,m),s=!1},d(m){rt(e,m)}}}function UT(r){let e,n,s,a,h,m;return e=new to({props:{name:"gp hospitals",$$slots:{default:[zT]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[BT]},$$scope:{ctx:r}}}),h=new im({props:{kind:"gp_hospitals",hovered:r[2]}}),{c(){ot(e.$$.fragment),n=Oe(),ot(s.$$.fragment),a=Oe(),ot(h.$$.fragment)},m(l,x){it(e,l,x),ae(l,n,x),it(s,l,x),ae(l,a,x),it(h,l,x),m=!0},p(l,[x]){const S={};x&523&&(S.$$scope={dirty:x,ctx:l}),e.$set(S);const T={};x&1&&(T.data=l[0]),x&518&&(T.$$scope={dirty:x,ctx:l}),s.$set(T);const C={};x&4&&(C.hovered=l[2]),h.$set(C)},i(l){m||(ge(e.$$.fragment,l),ge(s.$$.fragment,l),ge(h.$$.fragment,l),m=!0)},o(l){Se(e.$$.fragment,l),Se(s.$$.fragment,l),Se(h.$$.fragment,l),m=!1},d(l){l&&(oe(n),oe(a)),rt(e,l),rt(s,l),rt(h,l)}}}function jT(r,e,n){let s,a,h;zt(r,Wf,C=>n(1,a=C)),zt(r,sr,C=>n(7,h=C));let m={type:"FeatureCollection",features:[]},l;async function x(){h&&n(0,m=await h.getGpHospitals())}function S(){a=this.checked,Wf.set(a)}function T(C){l=C,n(2,l)}return r.$$.update=()=>{r.$$.dirty&3&&a&&m.features.length==0&&x(),r.$$.dirty&1&&n(3,s=m.features.filter(C=>C.properties.reachable).length)},[m,a,l,s,x,S,T]}class qT extends fn{constructor(e){super(),hn(this,e,jT,UT,an,{})}}function VT(r){let e,n,s,a,h;return{c(){e=le("label"),n=le("input"),s=ze(`
    Urban areas`),Ze(n,"type","checkbox")},m(m,l){ae(m,e,l),Z(e,n),n.checked=r[0],Z(e,s),a||(h=Rt(n,"change",r[1]),a=!0)},p(m,l){l&1&&(n.checked=m[0])},d(m){m&&oe(e),a=!1,h()}}}function GT(r){let e,n;return e=new mc({props:{sourceLayer:"urban_areas",manageHoverState:!0,paint:{"fill-color":"black","fill-opacity":Ls(1,.5)},layout:{visibility:r[0]?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&1&&(h.layout={visibility:s[0]?"visible":"none"}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function ZT(r){let e,n,s,a;return e=new to({props:{name:"urban areas",$$slots:{default:[VT]},$$scope:{ctx:r}}}),s=new Jp({props:{url:`pmtiles://${rd("urban_areas.pmtiles")}`,$$slots:{default:[GT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),n=Oe(),ot(s.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(s,h,m),a=!0},p(h,[m]){const l={};m&5&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&5&&(x.$$scope={dirty:m,ctx:h}),s.$set(x)},i(h){a||(ge(e.$$.fragment,h),ge(s.$$.fragment,h),a=!0)},o(h){Se(e.$$.fragment,h),Se(s.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(s,h)}}}function HT(r,e,n){let s=!1;function a(){s=this.checked,n(0,s)}return[s,a]}class XT extends fn{constructor(e){super(),hn(this,e,HT,ZT,an,{})}}function O0(r){let e,n,s,a,h,m;return s=new _c({props:{colors:r[3]}}),{c(){e=le("button"),e.textContent="Recalculate",n=Oe(),ot(s.$$.fragment),Ze(e,"class","outline")},m(l,x){ae(l,e,x),ae(l,n,x),it(s,l,x),a=!0,h||(m=Rt(e,"click",r[2]),h=!0)},p:tt,i(l){a||(ge(s.$$.fragment,l),a=!0)},o(l){Se(s.$$.fragment,l),a=!1},d(l){l&&(oe(e),oe(n)),rt(s,l),h=!1,m()}}}function WT(r){let e,n,s,a,h,m,l,x,S=r[0]&&O0(r);return{c(){e=le("label"),n=le("input"),s=ze(`
    Reachable network`),a=Oe(),S&&S.c(),h=ii(),Ze(n,"type","checkbox")},m(T,C){ae(T,e,C),Z(e,n),n.checked=r[0],Z(e,s),ae(T,a,C),S&&S.m(T,C),ae(T,h,C),m=!0,l||(x=Rt(n,"change",r[4]),l=!0)},p(T,C){C&1&&(n.checked=T[0]),T[0]?S?(S.p(T,C),C&1&&ge(S,1)):(S=O0(T),S.c(),ge(S,1),S.m(h.parentNode,h)):S&&(zn(),Se(S,1,1,()=>{S=null}),Fn())},i(T){m||(ge(S),m=!0)},o(T){Se(S),m=!1},d(T){T&&(oe(e),oe(a),oe(h)),S&&S.d(T),l=!1,x()}}}function KT(r){let e,n;return e=new _r({props:{layout:{visibility:r[0]?"visible":"none"},paint:{"line-width":Ls(5,7),"line-color":Xp(["get","kind"],r[3],"black"),"line-opacity":.8},manageHoverState:!0}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&1&&(h.layout={visibility:s[0]?"visible":"none"}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function $T(r){let e,n,s,a;return e=new to({props:{name:"reachable network",$$slots:{default:[WT]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[1],generateId:!0,$$slots:{default:[KT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),n=Oe(),ot(s.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(s,h,m),a=!0},p(h,[m]){const l={};m&65&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&2&&(x.data=h[1]),m&65&&(x.$$scope={dirty:m,ctx:h}),s.$set(x)},i(h){a||(ge(e.$$.fragment,h),ge(s.$$.fragment,h),a=!0)},o(h){Se(e.$$.fragment,h),Se(s.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(s,h)}}}function YT(r,e,n){let s;zt(r,sr,S=>n(5,s=S));let a=!1,h={type:"FeatureCollection",features:[]};async function m(){n(1,h=await s.renderReachableNetwork())}let l={network:"green",reachable:"purple",severance:"red"};function x(){a=this.checked,n(0,a)}return r.$$.update=()=>{r.$$.dirty&3&&a&&h.features.length==0&&m()},[a,h,m,l,x]}class JT extends fn{constructor(e){super(),hn(this,e,YT,$T,an,{})}}function B0(r){let e,n;return e=new _c({props:{colors:tm}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function QT(r){let e,n,s,a,h,m,l,x,S=r[0]&&B0();return{c(){e=le("label"),n=le("input"),s=ze(`
    Level of Service`),a=Oe(),S&&S.c(),h=ii(),Ze(n,"type","checkbox")},m(T,C){ae(T,e,C),Z(e,n),n.checked=r[0],Z(e,s),ae(T,a,C),S&&S.m(T,C),ae(T,h,C),m=!0,l||(x=Rt(n,"change",r[3]),l=!0)},p(T,C){C&1&&(n.checked=T[0]),T[0]?S?C&1&&ge(S,1):(S=B0(),S.c(),ge(S,1),S.m(h.parentNode,h)):S&&(zn(),Se(S,1,1,()=>{S=null}),Fn())},i(T){m||(ge(S),m=!0)},o(T){Se(S),m=!1},d(T){T&&(oe(e),oe(a),oe(h)),S&&S.d(T),l=!1,x()}}}function U0(r){let e,n,s,a={ctx:r,current:null,token:null,hasCatch:!1,pending:sC,then:tC,catch:eC,value:4,blocks:[,,,]};return gs(n=r[2].renderLevelOfService(),a),{c(){e=ii(),a.block.c()},m(h,m){ae(h,e,m),a.block.m(h,a.anchor=m),a.mount=()=>e.parentNode,a.anchor=e,s=!0},p(h,m){r=h,a.ctx=r,m&4&&n!==(n=r[2].renderLevelOfService())&&gs(n,a)||Il(a,r,m)},i(h){s||(ge(a.block),s=!0)},o(h){for(let m=0;m<3;m+=1){const l=a.blocks[m];Se(l)}s=!1},d(h){h&&oe(e),a.block.d(h),a.token=null,a=null}}}function eC(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function tC(r){let e,n;return e=new rr({props:{data:r[4],generateId:!0,$$slots:{default:[rC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&4&&(h.data=s[4]),a&65&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function nC(r){let e,n,s,a,h,m=r[5].los+"",l,x,S,T,C,N,B=ou[r[5].infra_type][0]+"",U,ee,ie,se,Q,Y,_e=r[5].speed+"",ve,Ae,ce,xe,be,Le,ke=r[5].traffic.toLocaleString()+"",ye;return{c(){e=le("table"),n=le("tr"),s=le("th"),s.textContent="Level of Service",a=Oe(),h=le("td"),l=ze(m),x=Oe(),S=le("tr"),T=le("th"),T.textContent="Infrastructure type",C=Oe(),N=le("td"),U=ze(B),ee=Oe(),ie=le("tr"),se=le("th"),se.textContent="Speed (mph)",Q=Oe(),Y=le("td"),ve=ze(_e),Ae=Oe(),ce=le("tr"),xe=le("th"),xe.textContent="Estimated daily traffic volume",be=Oe(),Le=le("td"),ye=ze(ke)},m(Ue,qe){ae(Ue,e,qe),Z(e,n),Z(n,s),Z(n,a),Z(n,h),Z(h,l),Z(e,x),Z(e,S),Z(S,T),Z(S,C),Z(S,N),Z(N,U),Z(e,ee),Z(e,ie),Z(ie,se),Z(ie,Q),Z(ie,Y),Z(Y,ve),Z(e,Ae),Z(e,ce),Z(ce,xe),Z(ce,be),Z(ce,Le),Z(Le,ye)},p(Ue,qe){qe&32&&m!==(m=Ue[5].los+"")&&Ct(l,m),qe&32&&B!==(B=ou[Ue[5].infra_type][0]+"")&&Ct(U,B),qe&32&&_e!==(_e=Ue[5].speed+"")&&Ct(ve,_e),qe&32&&ke!==(ke=Ue[5].traffic.toLocaleString()+"")&&Ct(ye,ke)},d(Ue){Ue&&oe(e)}}}function iC(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[nC,({props:s})=>({5:s}),({props:s})=>s?32:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&96&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function rC(r){let e,n;return e=new _r({props:{layout:{visibility:r[0]?"visible":"none"},paint:{"line-width":Ls(5,7),"line-color":Op,"line-opacity":.8},manageHoverState:!0,$$slots:{default:[iC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&1&&(h.layout={visibility:s[0]?"visible":"none"}),a&64&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function sC(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function oC(r){let e,n,s,a;e=new to({props:{name:"level of service",$$slots:{default:[QT]},$$scope:{ctx:r}}});let h=r[2]&&r[1]&&U0(r);return{c(){ot(e.$$.fragment),n=Oe(),h&&h.c(),s=ii()},m(m,l){it(e,m,l),ae(m,n,l),h&&h.m(m,l),ae(m,s,l),a=!0},p(m,[l]){const x={};l&65&&(x.$$scope={dirty:l,ctx:m}),e.$set(x),m[2]&&m[1]?h?(h.p(m,l),l&6&&ge(h,1)):(h=U0(m),h.c(),ge(h,1),h.m(s.parentNode,s)):h&&(zn(),Se(h,1,1,()=>{h=null}),Fn())},i(m){a||(ge(e.$$.fragment,m),ge(h),a=!0)},o(m){Se(e.$$.fragment,m),Se(h),a=!1},d(m){m&&(oe(n),oe(s)),rt(e,m),h&&h.d(m)}}}function aC(r,e,n){let s;zt(r,sr,l=>n(2,s=l));let a=!1,h=!1;function m(){a=this.checked,n(0,a)}return r.$$.update=()=>{r.$$.dirty&1&&a&&n(1,h=!0)},[a,h,s,m]}class lC extends fn{constructor(e){super(),hn(this,e,aC,oC,an,{})}}function j0(r){let e,n;return e=new Qp({props:{colorScale:r[3],limits:r[4]}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p:tt,i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function uC(r){let e,n,s,a,h,m,l,x,S=r[0]&&j0(r);return{c(){e=le("label"),n=le("input"),s=ze(`
    Estimated traffic volume`),a=Oe(),S&&S.c(),h=ii(),Ze(n,"type","checkbox")},m(T,C){ae(T,e,C),Z(e,n),n.checked=r[0],Z(e,s),ae(T,a,C),S&&S.m(T,C),ae(T,h,C),m=!0,l||(x=Rt(n,"change",r[5]),l=!0)},p(T,C){C&1&&(n.checked=T[0]),T[0]?S?(S.p(T,C),C&1&&ge(S,1)):(S=j0(T),S.c(),ge(S,1),S.m(h.parentNode,h)):S&&(zn(),Se(S,1,1,()=>{S=null}),Fn())},i(T){m||(ge(S),m=!0)},o(T){Se(S),m=!1},d(T){T&&(oe(e),oe(a),oe(h)),S&&S.d(T),l=!1,x()}}}function q0(r){let e,n,s,a={ctx:r,current:null,token:null,hasCatch:!1,pending:mC,then:hC,catch:cC,value:6,blocks:[,,,]};return gs(n=r[2].renderLevelOfService(),a),{c(){e=ii(),a.block.c()},m(h,m){ae(h,e,m),a.block.m(h,a.anchor=m),a.mount=()=>e.parentNode,a.anchor=e,s=!0},p(h,m){r=h,a.ctx=r,m&4&&n!==(n=r[2].renderLevelOfService())&&gs(n,a)||Il(a,r,m)},i(h){s||(ge(a.block),s=!0)},o(h){for(let m=0;m<3;m+=1){const l=a.blocks[m];Se(l)}s=!1},d(h){h&&oe(e),a.block.d(h),a.token=null,a=null}}}function cC(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function hC(r){let e,n;return e=new rr({props:{data:r[6],generateId:!0,$$slots:{default:[pC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&4&&(h.data=s[6]),a&257&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function fC(r){let e,n=r[7].traffic.toLocaleString()+"",s;return{c(){e=le("p"),s=ze(n)},m(a,h){ae(a,e,h),Z(e,s)},p(a,h){h&128&&n!==(n=a[7].traffic.toLocaleString()+"")&&Ct(s,n)},d(a){a&&oe(e)}}}function dC(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[fC,({props:s})=>({7:s}),({props:s})=>s?128:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&384&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function pC(r){let e,n;return e=new _r({props:{layout:{visibility:r[0]?"visible":"none"},paint:{"line-width":Gf(["get","traffic"],r[4],[1,2,3]),"line-color":Gf(["get","traffic"],r[4],r[3]),"line-opacity":.8},manageHoverState:!0,$$slots:{default:[dC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&1&&(h.layout={visibility:s[0]?"visible":"none"}),a&256&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function mC(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function gC(r){let e,n,s,a;e=new to({props:{name:"traffic volume",$$slots:{default:[uC]},$$scope:{ctx:r}}});let h=r[2]&&r[1]&&q0(r);return{c(){ot(e.$$.fragment),n=Oe(),h&&h.c(),s=ii()},m(m,l){it(e,m,l),ae(m,n,l),h&&h.m(m,l),ae(m,s,l),a=!0},p(m,[l]){const x={};l&257&&(x.$$scope={dirty:l,ctx:m}),e.$set(x),m[2]&&m[1]?h?(h.p(m,l),l&6&&ge(h,1)):(h=q0(m),h.c(),ge(h,1),h.m(s.parentNode,s)):h&&(zn(),Se(h,1,1,()=>{h=null}),Fn())},i(m){a||(ge(e.$$.fragment,m),ge(h),a=!0)},o(m){Se(e.$$.fragment,m),Se(h),a=!1},d(m){m&&(oe(n),oe(s)),rt(e,m),h&&h.d(m)}}}function _C(r,e,n){let s;zt(r,sr,S=>n(2,s=S));let a=!1,h=!1,m=["#27918d","#ffaa33","#440154"],l=[0,2e3,4e3,1e4];function x(){a=this.checked,n(0,a)}return r.$$.update=()=>{r.$$.dirty&1&&a&&n(1,h=!0)},[a,h,s,m,l,x]}class yC extends fn{constructor(e){super(),hn(this,e,_C,gC,an,{})}}function V0(r){let e,n,s,a,h,m=r[3].toLocaleString()+"",l,x,S=r[0].features.length.toLocaleString()+"",T,C,N=r[2].toLocaleString()+"",B,U,ee=r[4].toLocaleString()+"",ie,se,Q=Ir(r[2],r[4])+"",Y,_e,ve,Ae,ce,xe,be,Le,ke;return Ae=new Qp({props:{colorScale:r[6],limits:r[7]}}),{c(){e=le("button"),e.textContent="Recalculate",n=Oe(),s=le("p"),s.textContent="Only the top 20%ile most deprived zones are shown",a=Oe(),h=le("p"),l=ze(m),x=ze(" / "),T=ze(S),C=ze(` zones
      reachable. That's `),B=ze(N),U=ze(" / "),ie=ze(ee),se=ze(`
      (`),Y=ze(Q),_e=ze(") of the population."),ve=Oe(),ot(Ae.$$.fragment),ce=Oe(),xe=le("p"),xe.textContent=`Darker colours are more deprived. Zones with a red outline are not
      reachable by the current network.`,Ze(e,"class","outline")},m(ye,Ue){ae(ye,e,Ue),ae(ye,n,Ue),ae(ye,s,Ue),ae(ye,a,Ue),ae(ye,h,Ue),Z(h,l),Z(h,x),Z(h,T),Z(h,C),Z(h,B),Z(h,U),Z(h,ie),Z(h,se),Z(h,Y),Z(h,_e),ae(ye,ve,Ue),it(Ae,ye,Ue),ae(ye,ce,Ue),ae(ye,xe,Ue),be=!0,Le||(ke=Rt(e,"click",r[5]),Le=!0)},p(ye,Ue){(!be||Ue&8)&&m!==(m=ye[3].toLocaleString()+"")&&Ct(l,m),(!be||Ue&1)&&S!==(S=ye[0].features.length.toLocaleString()+"")&&Ct(T,S),(!be||Ue&4)&&N!==(N=ye[2].toLocaleString()+"")&&Ct(B,N),(!be||Ue&16)&&ee!==(ee=ye[4].toLocaleString()+"")&&Ct(ie,ee),(!be||Ue&20)&&Q!==(Q=Ir(ye[2],ye[4])+"")&&Ct(Y,Q)},i(ye){be||(ge(Ae.$$.fragment,ye),be=!0)},o(ye){Se(Ae.$$.fragment,ye),be=!1},d(ye){ye&&(oe(e),oe(n),oe(s),oe(a),oe(h),oe(ve),oe(ce),oe(xe)),rt(Ae,ye),Le=!1,ke()}}}function vC(r){let e,n,s,a,h,m,l,x,S=r[1]&&V0(r);return{c(){e=le("label"),n=le("input"),s=ze(`
    SIMD`),a=Oe(),S&&S.c(),h=ii(),Ze(n,"type","checkbox")},m(T,C){ae(T,e,C),Z(e,n),n.checked=r[1],Z(e,s),ae(T,a,C),S&&S.m(T,C),ae(T,h,C),m=!0,l||(x=Rt(n,"change",r[8]),l=!0)},p(T,C){C&2&&(n.checked=T[1]),T[1]?S?(S.p(T,C),C&2&&ge(S,1)):(S=V0(T),S.c(),ge(S,1),S.m(h.parentNode,h)):S&&(zn(),Se(S,1,1,()=>{S=null}),Fn())},i(T){m||(ge(S),m=!0)},o(T){Se(S),m=!1},d(T){T&&(oe(e),oe(a),oe(h)),S&&S.d(T),l=!1,x()}}}function bC(r){let e,n,s=r[10].id+"",a,h,m=r[10].reachable?"is":"is not",l,x,S=r[10].population.toLocaleString()+"",T,C,N=r[10].imd_rank+"",B,U,ee=r[10].imd_percentile+"",ie,se;return{c(){e=le("p"),n=ze("Data zone "),a=ze(s),h=Oe(),l=ze(m),x=ze(" reachable. It has "),T=ze(S),C=ze(`
        people, and a SIMD rank of `),B=ze(N),U=ze(", putting it in the "),ie=ze(ee),se=ze(`
        percentile.`)},m(Q,Y){ae(Q,e,Y),Z(e,n),Z(e,a),Z(e,h),Z(e,l),Z(e,x),Z(e,T),Z(e,C),Z(e,B),Z(e,U),Z(e,ie),Z(e,se)},p(Q,Y){Y&1024&&s!==(s=Q[10].id+"")&&Ct(a,s),Y&1024&&m!==(m=Q[10].reachable?"is":"is not")&&Ct(l,m),Y&1024&&S!==(S=Q[10].population.toLocaleString()+"")&&Ct(T,S),Y&1024&&N!==(N=Q[10].imd_rank+"")&&Ct(B,N),Y&1024&&ee!==(ee=Q[10].imd_percentile+"")&&Ct(ie,ee)},d(Q){Q&&oe(e)}}}function xC(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[bC,({props:s})=>({10:s}),({props:s})=>s?1024:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&3072&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function wC(r){let e,n,s,a;return e=new mc({props:{manageHoverState:!0,paint:{"fill-color":Gf(["get","imd_percentile"],r[7],r[6]),"fill-opacity":Ls(.7,.9)},layout:{visibility:r[1]?"visible":"none"},$$slots:{default:[xC]},$$scope:{ctx:r}}}),s=new _r({props:{filter:["!",["get","reachable"]],paint:{"line-color":"red","line-width":3},layout:{visibility:r[1]?"visible":"none"}}}),{c(){ot(e.$$.fragment),n=Oe(),ot(s.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(s,h,m),a=!0},p(h,m){const l={};m&2&&(l.layout={visibility:h[1]?"visible":"none"}),m&2048&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&2&&(x.layout={visibility:h[1]?"visible":"none"}),s.$set(x)},i(h){a||(ge(e.$$.fragment,h),ge(s.$$.fragment,h),a=!0)},o(h){Se(e.$$.fragment,h),Se(s.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(s,h)}}}function kC(r){let e,n,s,a;return e=new to({props:{name:"simd",$$slots:{default:[vC]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[wC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),n=Oe(),ot(s.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(s,h,m),a=!0},p(h,[m]){const l={};m&2079&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&1&&(x.data=h[0]),m&2050&&(x.$$scope={dirty:m,ctx:h}),s.$set(x)},i(h){a||(ge(e.$$.fragment,h),ge(s.$$.fragment,h),a=!0)},o(h){Se(e.$$.fragment,h),Se(s.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(s,h)}}}function IC(r,e,n){let s,a,h,m,l;zt(r,$f,B=>n(1,m=B)),zt(r,sr,B=>n(9,l=B));let x={type:"FeatureCollection",features:[]};async function S(){if(l){let B=await l.getDataZones();B.features=B.features.filter(U=>U.properties.imd_percentile<=20),n(0,x=B)}}let T=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],C=[0,4,8,12,16,20];function N(){m=this.checked,$f.set(m)}return r.$$.update=()=>{r.$$.dirty&3&&m&&x.features.length==0&&S(),r.$$.dirty&1&&n(4,s=ed(x.features.map(B=>B.properties.population))),r.$$.dirty&1&&n(3,a=x.features.filter(B=>B.properties.reachable).length),r.$$.dirty&1&&n(2,h=ed(x.features.filter(B=>B.properties.reachable).map(B=>B.properties.population)))},[x,m,h,a,s,S,T,C,N]}class SC extends fn{constructor(e){super(),hn(this,e,IC,kC,an,{})}}function G0(r){let e,n,s,a=r[3].toLocaleString()+"",h,m,l=r[0].features.length.toLocaleString()+"",x,S,T=r[2].toLocaleString()+"",C,N,B=r[4].toLocaleString()+"",U,ee,ie=Ir(r[2],r[4])+"",se,Q,Y,_e,ve,Ae,ce,xe,be;return _e=new Qp({props:{colorScale:r[6],limits:r[7]}}),{c(){e=le("button"),e.textContent="Recalculate",n=Oe(),s=le("p"),h=ze(a),m=ze(" / "),x=ze(l),S=ze(` zones
      reachable. That's `),C=ze(T),N=ze(" / "),U=ze(B),ee=ze(`
      (`),se=ze(ie),Q=ze(") of the population."),Y=Oe(),ot(_e.$$.fragment),ve=Oe(),Ae=le("p"),Ae.textContent=`Darker colours are denser. Zones with a red outline are not reachable by
      the current network. Only the top 3 densest quintiles are shown.`,Ze(e,"class","outline")},m(Le,ke){ae(Le,e,ke),ae(Le,n,ke),ae(Le,s,ke),Z(s,h),Z(s,m),Z(s,x),Z(s,S),Z(s,C),Z(s,N),Z(s,U),Z(s,ee),Z(s,se),Z(s,Q),ae(Le,Y,ke),it(_e,Le,ke),ae(Le,ve,ke),ae(Le,Ae,ke),ce=!0,xe||(be=Rt(e,"click",r[5]),xe=!0)},p(Le,ke){(!ce||ke&8)&&a!==(a=Le[3].toLocaleString()+"")&&Ct(h,a),(!ce||ke&1)&&l!==(l=Le[0].features.length.toLocaleString()+"")&&Ct(x,l),(!ce||ke&4)&&T!==(T=Le[2].toLocaleString()+"")&&Ct(C,T),(!ce||ke&16)&&B!==(B=Le[4].toLocaleString()+"")&&Ct(U,B),(!ce||ke&20)&&ie!==(ie=Ir(Le[2],Le[4])+"")&&Ct(se,ie)},i(Le){ce||(ge(_e.$$.fragment,Le),ce=!0)},o(Le){Se(_e.$$.fragment,Le),ce=!1},d(Le){Le&&(oe(e),oe(n),oe(s),oe(Y),oe(ve),oe(Ae)),rt(_e,Le),xe=!1,be()}}}function EC(r){let e,n,s,a,h,m,l,x,S=r[1]&&G0(r);return{c(){e=le("label"),n=le("input"),s=ze(`
    Population`),a=Oe(),S&&S.c(),h=ii(),Ze(n,"type","checkbox")},m(T,C){ae(T,e,C),Z(e,n),n.checked=r[1],Z(e,s),ae(T,a,C),S&&S.m(T,C),ae(T,h,C),m=!0,l||(x=Rt(n,"change",r[9]),l=!0)},p(T,C){C&2&&(n.checked=T[1]),T[1]?S?(S.p(T,C),C&2&&ge(S,1)):(S=G0(T),S.c(),ge(S,1),S.m(h.parentNode,h)):S&&(zn(),Se(S,1,1,()=>{S=null}),Fn())},i(T){m||(ge(S),m=!0)},o(T){Se(S),m=!1},d(T){T&&(oe(e),oe(a),oe(h)),S&&S.d(T),l=!1,x()}}}function AC(r){let e,n,s=r[11].id+"",a,h,m=r[11].reachable?"is":"is not",l,x,S=r[11].population.toLocaleString()+"",T,C,N=Math.round(r[11].population/r[11].area_km2).toLocaleString()+"",B,U,ee=r[11].density_quintile+"",ie,se;return{c(){e=le("p"),n=ze("Data zone "),a=ze(s),h=Oe(),l=ze(m),x=ze(" reachable. It has "),T=ze(S),C=ze(`
        people, with a density of `),B=ze(N),U=ze(" people per square kilometer, putting it in quintile "),ie=ze(ee),se=ze(`
        for this study area.`),Rn(e,"max-width","30vw")},m(Q,Y){ae(Q,e,Y),Z(e,n),Z(e,a),Z(e,h),Z(e,l),Z(e,x),Z(e,T),Z(e,C),Z(e,B),Z(e,U),Z(e,ie),Z(e,se)},p(Q,Y){Y&2048&&s!==(s=Q[11].id+"")&&Ct(a,s),Y&2048&&m!==(m=Q[11].reachable?"is":"is not")&&Ct(l,m),Y&2048&&S!==(S=Q[11].population.toLocaleString()+"")&&Ct(T,S),Y&2048&&N!==(N=Math.round(Q[11].population/Q[11].area_km2).toLocaleString()+"")&&Ct(B,N),Y&2048&&ee!==(ee=Q[11].density_quintile+"")&&Ct(ie,ee)},d(Q){Q&&oe(e)}}}function TC(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[AC,({props:s})=>({11:s}),({props:s})=>s?2048:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&6144&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function CC(r){let e,n,s,a;return e=new mc({props:{manageHoverState:!0,paint:{"fill-color":Gf(["get","density_quintile"],r[7],r[6]),"fill-opacity":r[8]},layout:{visibility:r[1]?"visible":"none"},$$slots:{default:[TC]},$$scope:{ctx:r}}}),s=new _r({props:{filter:["!",["get","reachable"]],paint:{"line-color":"red","line-width":3},layout:{visibility:r[1]?"visible":"none"}}}),{c(){ot(e.$$.fragment),n=Oe(),ot(s.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(s,h,m),a=!0},p(h,m){const l={};m&2&&(l.layout={visibility:h[1]?"visible":"none"}),m&4096&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&2&&(x.layout={visibility:h[1]?"visible":"none"}),s.$set(x)},i(h){a||(ge(e.$$.fragment,h),ge(s.$$.fragment,h),a=!0)},o(h){Se(e.$$.fragment,h),Se(s.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(s,h)}}}function LC(r){let e,n,s,a;return e=new to({props:{name:"population density",$$slots:{default:[EC]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[CC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),n=Oe(),ot(s.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(s,h,m),a=!0},p(h,[m]){const l={};m&4127&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&1&&(x.data=h[0]),m&4098&&(x.$$scope={dirty:m,ctx:h}),s.$set(x)},i(h){a||(ge(e.$$.fragment,h),ge(s.$$.fragment,h),a=!0)},o(h){Se(e.$$.fragment,h),Se(s.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(s,h)}}}function MC(r,e,n){let s,a,h,m,l;zt(r,Yf,U=>n(1,m=U)),zt(r,sr,U=>n(10,l=U));let x={type:"FeatureCollection",features:[]};async function S(){l&&n(0,x=await l.getDataZones())}let T=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],C=[0,1,2,3,4,5],N=Ls(["case",["<",["get","density_quintile"],4],.5,0],.9);function B(){m=this.checked,Yf.set(m)}return r.$$.update=()=>{r.$$.dirty&3&&m&&x.features.length==0&&S(),r.$$.dirty&1&&n(4,s=ed(x.features.map(U=>U.properties.population))),r.$$.dirty&1&&n(3,a=x.features.filter(U=>U.properties.reachable).length),r.$$.dirty&1&&n(2,h=ed(x.features.filter(U=>U.properties.reachable).map(U=>U.properties.population)))},[x,m,h,a,s,S,T,C,N,B]}class RC extends fn{constructor(e){super(),hn(this,e,MC,LC,an,{})}}function Z0(r){let e,n,s,a,h,m,l,x,S,T,C,N,B,U,ee,ie,se,Q,Y,_e=r[0].total_quintile_sums.length>0&&H0(r);return{c(){e=le("div"),n=le("button"),n.textContent="Recalculate",s=Oe(),a=le("label"),h=le("input"),m=ze(`
        Only show routes covered by current edits`),l=Oe(),x=le("label"),S=ze(`Only show quintile:
        `),T=le("select"),C=le("option"),C.textContent="Show all",N=le("option"),N.textContent="1",B=le("option"),B.textContent="2",U=le("option"),U.textContent="3",ee=le("option"),ee.textContent="4",ie=le("option"),ie.textContent="5",se=Oe(),_e&&_e.c(),Ze(n,"class","outline"),Ze(h,"type","checkbox"),C.__value="",ki(C,C.__value),N.__value="1",ki(N,N.__value),B.__value="2",ki(B,B.__value),U.__value="3",ki(U,U.__value),ee.__value="4",ki(ee,ee.__value),ie.__value="5",ki(ie,ie.__value),r[3]===void 0&&Ro(()=>r[7].call(T)),Rn(e,"border","1px solid black"),Rn(e,"padding","4px")},m(ve,Ae){ae(ve,e,Ae),Z(e,n),Z(e,s),Z(e,a),Z(a,h),h.checked=r[2],Z(a,m),Z(e,l),Z(e,x),Z(x,S),Z(x,T),Z(T,C),Z(T,N),Z(T,B),Z(T,U),Z(T,ee),Z(T,ie),ds(T,r[3],!0),Z(e,se),_e&&_e.m(e,null),Q||(Y=[Rt(n,"click",r[4]),Rt(h,"change",r[6]),Rt(T,"change",r[7])],Q=!0)},p(ve,Ae){Ae&4&&(h.checked=ve[2]),Ae&8&&ds(T,ve[3]),ve[0].total_quintile_sums.length>0?_e?_e.p(ve,Ae):(_e=H0(ve),_e.c(),_e.m(e,null)):_e&&(_e.d(1),_e=null)},d(ve){ve&&oe(e),_e&&_e.d(),Q=!1,$i(Y)}}}function H0(r){let e,n,s,a,h,m=Ir(r[0].covered_quintile_sums[0],r[0].total_quintile_sums[0])+"",l,x,S,T,C=Ir(r[0].covered_quintile_sums[1],r[0].total_quintile_sums[1])+"",N,B,U,ee,ie=Ir(r[0].covered_quintile_sums[2],r[0].total_quintile_sums[2])+"",se,Q,Y,_e,ve=Ir(r[0].covered_quintile_sums[3],r[0].total_quintile_sums[3])+"",Ae,ce,xe,be,Le=Ir(r[0].covered_quintile_sums[4],r[0].total_quintile_sums[4])+"",ke;return{c(){e=le("p"),e.textContent="Flow covered by current edits",n=Oe(),s=le("ul"),a=le("li"),h=ze("Quintile 1: "),l=ze(m),x=Oe(),S=le("li"),T=ze("Quintile 2: "),N=ze(C),B=Oe(),U=le("li"),ee=ze("Quintile 3: "),se=ze(ie),Q=Oe(),Y=le("li"),_e=ze("Quintile 4: "),Ae=ze(ve),ce=Oe(),xe=le("li"),be=ze("Quintile 5: "),ke=ze(Le)},m(ye,Ue){ae(ye,e,Ue),ae(ye,n,Ue),ae(ye,s,Ue),Z(s,a),Z(a,h),Z(a,l),Z(s,x),Z(s,S),Z(S,T),Z(S,N),Z(s,B),Z(s,U),Z(U,ee),Z(U,se),Z(s,Q),Z(s,Y),Z(Y,_e),Z(Y,Ae),Z(s,ce),Z(s,xe),Z(xe,be),Z(xe,ke)},p(ye,Ue){Ue&1&&m!==(m=Ir(ye[0].covered_quintile_sums[0],ye[0].total_quintile_sums[0])+"")&&Ct(l,m),Ue&1&&C!==(C=Ir(ye[0].covered_quintile_sums[1],ye[0].total_quintile_sums[1])+"")&&Ct(N,C),Ue&1&&ie!==(ie=Ir(ye[0].covered_quintile_sums[2],ye[0].total_quintile_sums[2])+"")&&Ct(se,ie),Ue&1&&ve!==(ve=Ir(ye[0].covered_quintile_sums[3],ye[0].total_quintile_sums[3])+"")&&Ct(Ae,ve),Ue&1&&Le!==(Le=Ir(ye[0].covered_quintile_sums[4],ye[0].total_quintile_sums[4])+"")&&Ct(ke,Le)},d(ye){ye&&(oe(e),oe(n),oe(s))}}}function PC(r){let e,n,s,a,h,m,l,x=r[1]&&Z0(r);return{c(){e=le("label"),n=le("input"),s=ze(`
    High NPT route coverage`),a=Oe(),x&&x.c(),h=ii(),Ze(n,"type","checkbox")},m(S,T){ae(S,e,T),Z(e,n),n.checked=r[1],Z(e,s),ae(S,a,T),x&&x.m(S,T),ae(S,h,T),m||(l=Rt(n,"change",r[5]),m=!0)},p(S,T){T&2&&(n.checked=S[1]),S[1]?x?x.p(S,T):(x=Z0(S),x.c(),x.m(h.parentNode,h)):x&&(x.d(1),x=null)},d(S){S&&(oe(e),oe(a),oe(h)),x&&x.d(S),m=!1,l()}}}function DC(r){let e,n=r[9].flow.toLocaleString()+"",s,a,h=r[9].quintile+"",m,l,x=r[9].covered+"",S;return{c(){e=ze("Flow "),s=ze(n),a=ze(" is in quintile "),m=ze(h),l=ze(`,
      covered `),S=ze(x)},m(T,C){ae(T,e,C),ae(T,s,C),ae(T,a,C),ae(T,m,C),ae(T,l,C),ae(T,S,C)},p(T,C){C&512&&n!==(n=T[9].flow.toLocaleString()+"")&&Ct(s,n),C&512&&h!==(h=T[9].quintile+"")&&Ct(m,h),C&512&&x!==(x=T[9].covered+"")&&Ct(S,x)},d(T){T&&(oe(e),oe(s),oe(a),oe(m),oe(l),oe(S))}}}function NC(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[DC,({props:s})=>({9:s}),({props:s})=>s?512:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&1536&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function zC(r){let e,n;return e=new _r({props:{layout:{visibility:r[1]?"visible":"none"},filter:X0(r[2],r[3]),paint:{"line-width":td("flow"),"line-color":nm("flow")},$$slots:{default:[NC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&2&&(h.layout={visibility:s[1]?"visible":"none"}),a&12&&(h.filter=X0(s[2],s[3])),a&1024&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function FC(r){let e,n,s,a;return e=new to({props:{name:"high npt route coverage",$$slots:{default:[PC]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[0],$$slots:{default:[zC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),n=Oe(),ot(s.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(s,h,m),a=!0},p(h,[m]){const l={};m&1039&&(l.$$scope={dirty:m,ctx:h}),e.$set(l);const x={};m&1&&(x.data=h[0]),m&1038&&(x.$$scope={dirty:m,ctx:h}),s.$set(x)},i(h){a||(ge(e.$$.fragment,h),ge(s.$$.fragment,h),a=!0)},o(h){Se(e.$$.fragment,h),Se(s.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(s,h)}}}function X0(r,e){let n=["all"];return r&&n.push(["get","covered"]),e.length>0&&n.push(["==",["get","quintile"],parseInt(e)]),n}function OC(r,e,n){let s,a;zt(r,Qu,N=>n(1,s=N)),zt(r,sr,N=>n(8,a=N));let h=!1,m="",l={type:"FeatureCollection",features:[],covered_quintile_sums:[],total_quintile_sums:[]};async function x(){a&&n(0,l=await a.renderPrecalculatedFlows())}function S(){s=this.checked,Qu.set(s)}function T(){h=this.checked,n(2,h)}function C(){m=yl(this),n(3,m)}return r.$$.update=()=>{r.$$.dirty&3&&s&&l.features.length==0&&x()},[l,s,h,m,x,S,T,C]}class BC extends fn{constructor(e){super(),hn(this,e,OC,FC,an,{})}}function UC(r){let e,n;return e=new Yp({props:{paint:{"circle-color":"purple","circle-radius":5},layout:{visibility:r[1]&&r[2].kind=="edit-route"?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&6&&(h.layout={visibility:s[1]&&s[2].kind=="edit-route"?"visible":"none"}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function jC(r){let e,n;return e=new rr({props:{data:r[0],$$slots:{default:[UC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,[a]){const h={};a&1&&(h.data=s[0]),a&38&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function qC(r,e,n){let s,a,h;zt(r,Fp,x=>n(1,s=x)),zt(r,sr,x=>n(3,a=x)),zt(r,Oi,x=>n(2,h=x));let m={type:"FeatureCollection",features:[]};async function l(){a&&n(0,m=await a.getMajorJunctions())}return r.$$.update=()=>{r.$$.dirty&3&&s&&m.features.length==0&&l()},[m,s,h]}class VC extends fn{constructor(e){super(),hn(this,e,qC,jC,an,{})}}function GC(r){let e,n,s,a,h,m,l,x,S,T,C,N,B,U,ee,ie,se,Q,Y,_e,ve,Ae,ce,xe,be,Le,ke,ye;return e=new eT({}),s=new aT({}),h=new BC({}),l=new yT({}),S=new TT({}),C=new NT({}),B=new qT({}),ee=new XT({}),se=new lC({}),Y=new yC({}),ve=new JT({}),ce=new SC({}),be=new RC({}),ke=new VC({}),{c(){ot(e.$$.fragment),n=Oe(),ot(s.$$.fragment),a=Oe(),ot(h.$$.fragment),m=Oe(),ot(l.$$.fragment),x=Oe(),ot(S.$$.fragment),T=Oe(),ot(C.$$.fragment),N=Oe(),ot(B.$$.fragment),U=Oe(),ot(ee.$$.fragment),ie=Oe(),ot(se.$$.fragment),Q=Oe(),ot(Y.$$.fragment),_e=Oe(),ot(ve.$$.fragment),Ae=Oe(),ot(ce.$$.fragment),xe=Oe(),ot(be.$$.fragment),Le=Oe(),ot(ke.$$.fragment)},m(Ue,qe){it(e,Ue,qe),ae(Ue,n,qe),it(s,Ue,qe),ae(Ue,a,qe),it(h,Ue,qe),ae(Ue,m,qe),it(l,Ue,qe),ae(Ue,x,qe),it(S,Ue,qe),ae(Ue,T,qe),it(C,Ue,qe),ae(Ue,N,qe),it(B,Ue,qe),ae(Ue,U,qe),it(ee,Ue,qe),ae(Ue,ie,qe),it(se,Ue,qe),ae(Ue,Q,qe),it(Y,Ue,qe),ae(Ue,_e,qe),it(ve,Ue,qe),ae(Ue,Ae,qe),it(ce,Ue,qe),ae(Ue,xe,qe),it(be,Ue,qe),ae(Ue,Le,qe),it(ke,Ue,qe),ye=!0},p:tt,i(Ue){ye||(ge(e.$$.fragment,Ue),ge(s.$$.fragment,Ue),ge(h.$$.fragment,Ue),ge(l.$$.fragment,Ue),ge(S.$$.fragment,Ue),ge(C.$$.fragment,Ue),ge(B.$$.fragment,Ue),ge(ee.$$.fragment,Ue),ge(se.$$.fragment,Ue),ge(Y.$$.fragment,Ue),ge(ve.$$.fragment,Ue),ge(ce.$$.fragment,Ue),ge(be.$$.fragment,Ue),ge(ke.$$.fragment,Ue),ye=!0)},o(Ue){Se(e.$$.fragment,Ue),Se(s.$$.fragment,Ue),Se(h.$$.fragment,Ue),Se(l.$$.fragment,Ue),Se(S.$$.fragment,Ue),Se(C.$$.fragment,Ue),Se(B.$$.fragment,Ue),Se(ee.$$.fragment,Ue),Se(se.$$.fragment,Ue),Se(Y.$$.fragment,Ue),Se(ve.$$.fragment,Ue),Se(ce.$$.fragment,Ue),Se(be.$$.fragment,Ue),Se(ke.$$.fragment,Ue),ye=!1},d(Ue){Ue&&(oe(n),oe(a),oe(m),oe(x),oe(T),oe(N),oe(U),oe(ie),oe(Q),oe(_e),oe(Ae),oe(xe),oe(Le)),rt(e,Ue),rt(s,Ue),rt(h,Ue),rt(l,Ue),rt(S,Ue),rt(C,Ue),rt(B,Ue),rt(ee,Ue),rt(se,Ue),rt(Y,Ue),rt(ve,Ue),rt(ce,Ue),rt(be,Ue),rt(ke,Ue)}}}class ZC extends fn{constructor(e){super(),hn(this,e,null,GC,an,{})}}function HC(r){let e,n,s;return n=new jA({}),{c(){e=le("div"),ot(n.$$.fragment),Ze(e,"slot","top")},m(a,h){ae(a,e,h),it(n,e,null),s=!0},p:tt,i(a){s||(ge(n.$$.fragment,a),s=!0)},o(a){Se(n.$$.fragment,a),s=!1},d(a){a&&oe(e),rt(n)}}}function XC(r){let e,n;return{c(){e=le("div"),n=le("div"),Ze(e,"slot","left")},m(s,a){ae(s,e,a),Z(e,n),r[14](n)},p:tt,d(s){s&&oe(e),r[14](null)}}}function WC(r){let e,n;return e=new X2({props:{map:r[0],apiKey:Jv}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&1&&(h.map=s[0]),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function W0(r){let e,n,s,a,h,m,l,x,S={ctx:r,current:null,token:null,hasCatch:!1,pending:JC,then:$C,catch:KC,value:21,blocks:[,,,]};gs(e=r[5].getInvertedBoundary(),S),s=new ZC({});const T=[rL,iL,nL,tL,eL,QC],C=[];function N(B,U){return B[6].kind=="main"?0:B[6].kind=="edit-route"&&B[0]?1:B[6].kind=="evaluate-route"?2:B[6].kind=="evaluate-od"?3:B[6].kind=="debug-network"?4:B[6].kind=="debug-mesh-density"?5:-1}return~(h=N(r))&&(m=C[h]=T[h](r)),{c(){S.block.c(),n=Oe(),ot(s.$$.fragment),a=Oe(),m&&m.c(),l=ii()},m(B,U){S.block.m(B,S.anchor=U),S.mount=()=>n.parentNode,S.anchor=n,ae(B,n,U),it(s,B,U),ae(B,a,U),~h&&C[h].m(B,U),ae(B,l,U),x=!0},p(B,U){r=B,S.ctx=r,U&32&&e!==(e=r[5].getInvertedBoundary())&&gs(e,S)||Il(S,r,U);let ee=h;h=N(r),h===ee?~h&&C[h].p(r,U):(m&&(zn(),Se(C[ee],1,1,()=>{C[ee]=null}),Fn()),~h?(m=C[h],m?m.p(r,U):(m=C[h]=T[h](r),m.c()),ge(m,1),m.m(l.parentNode,l)):m=null)},i(B){x||(ge(S.block),ge(s.$$.fragment,B),ge(m),x=!0)},o(B){for(let U=0;U<3;U+=1){const ee=S.blocks[U];Se(ee)}Se(s.$$.fragment,B),Se(m),x=!1},d(B){B&&(oe(n),oe(a),oe(l)),S.block.d(B),S.token=null,S=null,rt(s,B),~h&&C[h].d(B)}}}function KC(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function $C(r){let e,n;return e=new rr({props:{data:r[21],$$slots:{default:[YC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&32&&(h.data=s[21]),a&4194304&&(h.$$scope={dirty:a,ctx:s}),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function YC(r){let e,n;return e=new mc({props:{paint:{"fill-color":"black","fill-opacity":.3}}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p:tt,i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function JC(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function QC(r){let e,n;return e=new US({}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p:tt,i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function eL(r){let e,n;return e=new MS({}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p:tt,i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function tL(r){let e,n;return e=new PA({}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p:tt,i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function nL(r){let e,n;return e=new SA({props:{browse:r[6].browse}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&64&&(h.browse=s[6].browse),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function iL(r){let e,n;return e=new uA({props:{id:r[6].id,map:r[0]}}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p(s,a){const h={};a&64&&(h.id=s[6].id),a&1&&(h.map=s[0]),e.$set(h)},i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function rL(r){let e,n;return e=new hE({}),{c(){ot(e.$$.fragment)},m(s,a){it(e,s,a),n=!0},p:tt,i(s){n||(ge(e.$$.fragment,s),n=!0)},o(s){Se(e.$$.fragment,s),n=!1},d(s){rt(e,s)}}}function sL(r){let e,n,s,a,h,m,l,x=WC(r);n=new mE({});let S=r[5]&&W0(r);return{c(){x&&x.c(),e=Oe(),ot(n.$$.fragment),s=Oe(),a=le("div"),h=Oe(),S&&S.c(),m=ii()},m(T,C){x&&x.m(T,C),ae(T,e,C),it(n,T,C),ae(T,s,C),ae(T,a,C),r[11](a),ae(T,h,C),S&&S.m(T,C),ae(T,m,C),l=!0},p(T,C){x.p(T,C),T[5]?S?(S.p(T,C),C&32&&ge(S,1)):(S=W0(T),S.c(),ge(S,1),S.m(m.parentNode,m)):S&&(zn(),Se(S,1,1,()=>{S=null}),Fn())},i(T){l||(ge(x),ge(n.$$.fragment,T),ge(S),l=!0)},o(T){Se(x),Se(n.$$.fragment,T),Se(S),l=!1},d(T){T&&(oe(e),oe(s),oe(a),oe(h),oe(m)),x&&x.d(T),rt(n,T),r[11](null),S&&S.d(T)}}}function oL(r){let e,n,s,a;function h(l){r[12](l)}let m={style:`https://api.maptiler.com/maps/uk-openzoomstack-light/style.json?key=${Jv}`,standardControls:!0,$$slots:{default:[sL]},$$scope:{ctx:r}};return r[0]!==void 0&&(m.map=r[0]),n=new MI({props:m}),$n.push(()=>gr(n,"map",h)),n.$on("error",r[13]),{c(){e=le("div"),ot(n.$$.fragment),Ze(e,"slot","main"),Rn(e,"position","relative"),Rn(e,"width","100%"),Rn(e,"height","100%")},m(l,x){ae(l,e,x),it(n,e,null),a=!0},p(l,x){const S={};x&4194405&&(S.$$scope={dirty:x,ctx:l}),!s&&x&1&&(s=!0,S.map=l[0],mr(()=>s=!1)),n.$set(S)},i(l){a||(ge(n.$$.fragment,l),a=!0)},o(l){Se(n.$$.fragment,l),a=!1},d(l){l&&oe(e),rt(n)}}}function aL(r){let e,n;return{c(){e=le("div"),n=le("div"),Ze(e,"slot","right")},m(s,a){ae(s,e,a),Z(e,n),r[10](n)},p:tt,d(s){s&&oe(e),r[10](null)}}}function lL(r){let e,n,s,a;return e=new JI({props:{loading:r[4]}}),s=new GI({props:{$$slots:{right:[aL],main:[oL],left:[XC],top:[HC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),n=Oe(),ot(s.$$.fragment)},m(h,m){it(e,h,m),ae(h,n,m),it(s,h,m),a=!0},p(h,[m]){const l={};m&16&&(l.loading=h[4]),e.$set(l);const x={};m&4194415&&(x.$$scope={dirty:m,ctx:h}),s.$set(x)},i(h){a||(ge(e.$$.fragment,h),ge(s.$$.fragment,h),a=!0)},o(h){Se(e.$$.fragment,h),Se(s.$$.fragment,h),a=!1},d(h){h&&oe(n),rt(e,h),rt(s,h)}}}function Ef(r,e,n){return e+r*(n-e)}function uL(r,e,n){let s,a,h,m,l,x,S,T,C,N;zt(r,Rp,xe=>n(7,s=xe)),zt(r,Pp,xe=>n(8,a=xe)),zt(r,Mp,xe=>n(9,h=xe)),zt(r,sr,xe=>n(5,m=xe)),zt(r,Qf,xe=>n(15,l=xe)),zt(r,Sh,xe=>n(16,x=xe)),zt(r,Ju,xe=>n(17,S=xe)),zt(r,Hf,xe=>n(18,T=xe)),zt(r,Np,xe=>n(19,C=xe)),zt(r,Oi,xe=>n(6,N=xe));let B="",U;cc(async()=>{await n1();let xe=new URLSearchParams(window.location.search);Dn(Hf,T=xe.get("boundary")||"LAD_City of Edinburgh",T),n(4,B=`Loading ${T}`);let be=new vS,Le=await fetch(`areas/${T}.bin`);Le.ok?(console.log("Using locally hosted files"),Dn(Np,C=!1,C)):(console.log("Using remote hosted files"),Le=await fetch(rd(`areas/${T}.bin`)));let ke=await Le.arrayBuffer();try{await be.loadFile(new Uint8Array(ke))}catch(qe){window.alert(`Couldn't load: ${qe}`)}let ye=window.localStorage.getItem(`tmp-npt-editor/${T}`);if(ye)try{await be.loadSavefile(ye)}catch(qe){window.alert(`Couldn't restore saved state: ${qe}`)}n(4,B="");let Ue=await be.getBounds();Dn(Ju,S={lng:Ef(.4,Ue[0],Ue[2]),lat:Ef(.4,Ue[1],Ue[3])},S),Dn(Sh,x={lng:Ef(.6,Ue[0],Ue[2]),lat:Ef(.6,Ue[1],Ue[3])},x),Dn(Qf,l=new LE(U,be.toRouteSnapper(),Jn(Mf()),Jn(!0),Jn(0)),l),sr.set(be),await ee()});async function ee(){U&&m&&U.fitBounds(await m.getBounds(),{animate:!1})}let ie,se,Q;function Y(xe){$n[xe?"unshift":"push"](()=>{Q=xe,n(3,Q),n(7,s)})}function _e(xe){$n[xe?"unshift":"push"](()=>{se=xe,n(2,se),n(8,a)})}function ve(xe){U=xe,n(0,U)}const Ae=xe=>{console.log(xe.detail.error)};function ce(xe){$n[xe?"unshift":"push"](()=>{ie=xe,n(1,ie),n(9,h)})}return r.$$.update=()=>{r.$$.dirty&1&&U&&bS.set(U),r.$$.dirty&514&&ie&&h&&(n(1,ie.innerHTML="",ie),ie.appendChild(h)),r.$$.dirty&260&&se&&a&&(n(2,se.innerHTML="",se),se.appendChild(a)),r.$$.dirty&136&&Q&&s&&(n(3,Q.innerHTML="",Q),Q.appendChild(s))},[U,ie,se,Q,B,m,N,s,a,h,Y,_e,ve,Ae,ce]}class cL extends fn{constructor(e){super(),hn(this,e,uL,lL,an,{})}}new cL({target:document.getElementById("app")});
