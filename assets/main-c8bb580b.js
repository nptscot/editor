var Hb=Object.defineProperty;var Wb=(r,e,n)=>e in r?Hb(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n;var lh=(r,e,n)=>(Wb(r,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const f of a)if(f.type==="childList")for(const m of f.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function n(a){const f={};return a.integrity&&(f.integrity=a.integrity),a.referrerPolicy&&(f.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?f.credentials="include":a.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function s(a){if(a.ep)return;a.ep=!0;const f=n(a);fetch(a.href,f)}})();function tt(){}function Xb(r,e){for(const n in e)r[n]=e[n];return r}function $b(r){return!!r&&(typeof r=="object"||typeof r=="function")&&typeof r.then=="function"}function H0(r){return r()}function jg(){return Object.create(null)}function $i(r){r.forEach(H0)}function iu(r){return typeof r=="function"}function un(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let gf;function ms(r,e){return r===e?!0:(gf||(gf=document.createElement("a")),gf.href=e,r===gf.href)}function Yb(r){return Object.keys(r).length===0}function W0(r,...e){if(r==null){for(const s of e)s(void 0);return tt}const n=r.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Df(r){let e;return W0(r,n=>e=n)(),e}function Ot(r,e,n){r.$$.on_destroy.push(W0(e,n))}function Zi(r,e,n,s){if(r){const a=X0(r,e,n,s);return r[0](a)}}function X0(r,e,n,s){return r[1]&&s?Xb(n.ctx.slice(),r[1](s(e))):n.ctx}function Hi(r,e,n,s){if(r[2]&&s){const a=r[2](s(n));if(e.dirty===void 0)return a;if(typeof a=="object"){const f=[],m=Math.max(e.dirty.length,a.length);for(let l=0;l<m;l+=1)f[l]=e.dirty[l]|a[l];return f}return e.dirty|a}return e.dirty}function Wi(r,e,n,s,a,f){if(a){const m=X0(e,n,s,f);r.p(m,a)}}function Xi(r){if(r.ctx.length>32){const e=[],n=r.ctx.length/32;for(let s=0;s<n;s++)e[s]=-1;return e}return-1}function Jb(r){const e={};for(const n in r)e[n]=!0;return e}function Nf(r){return r??""}function Dn(r,e,n){return r.set(n),e}function pp(r){return r&&iu(r.destroy)?r.destroy:tt}const $0=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Z(r,e){r.appendChild(e)}function ae(r,e,n){r.insertBefore(e,n||null)}function oe(r){r.parentNode&&r.parentNode.removeChild(r)}function Sr(r,e){for(let n=0;n<r.length;n+=1)r[n]&&r[n].d(e)}function ue(r){return document.createElement(r)}function Da(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Oe(r){return document.createTextNode(r)}function Be(){return Oe(" ")}function ni(){return Oe("")}function Pt(r,e,n,s){return r.addEventListener(e,n,s),()=>r.removeEventListener(e,n,s)}function Nh(r){return function(e){return e.preventDefault(),r.call(this,e)}}function np(r){return function(e){return e.stopPropagation(),r.call(this,e)}}function He(r,e,n){n==null?r.removeAttribute(e):r.getAttribute(e)!==n&&r.setAttribute(e,n)}function Vg(r){let e;return{p(...n){e=n,e.forEach(s=>r.push(s))},r(){e.forEach(n=>r.splice(r.indexOf(n),1))}}}function Kb(r){return Array.from(r.childNodes)}function Mt(r,e){e=""+e,r.data!==e&&(r.data=e)}function zi(r,e){r.value=e??""}function Un(r,e,n,s){n==null?r.style.removeProperty(e):r.style.setProperty(e,n,s?"important":"")}function fs(r,e,n){for(let s=0;s<r.options.length;s+=1){const a=r.options[s];if(a.__value===e){a.selected=!0;return}}(!n||e!==void 0)&&(r.selectedIndex=-1)}function _l(r){const e=r.querySelector(":checked");return e&&e.__value}function Vr(r,e,n){r.classList.toggle(e,!!n)}function Qb(r,e,{bubbles:n=!1,cancelable:s=!1}={}){return new CustomEvent(r,{detail:e,bubbles:n,cancelable:s})}let Ch;function Ra(r){Ch=r}function uc(){if(!Ch)throw new Error("Function called outside component initialization");return Ch}function cc(r){uc().$$.on_mount.push(r)}function vo(r){uc().$$.on_destroy.push(r)}function hc(){const r=uc();return(e,n,{cancelable:s=!1}={})=>{const a=r.$$.callbacks[e];if(a){const f=Qb(e,n,{cancelable:s});return a.slice().forEach(m=>{m.call(r,f)}),!f.defaultPrevented}return!0}}function Y0(r,e){return uc().$$.context.set(r,e),e}function J0(r){return uc().$$.context.get(r)}function ur(r,e){const n=r.$$.callbacks[e.type];n&&n.slice().forEach(s=>s.call(this,e))}const Wu=[],Jn=[];let Qu=[];const mp=[],K0=Promise.resolve();let gp=!1;function Q0(){gp||(gp=!0,K0.then(jp))}function ex(){return Q0(),K0}function Po(r){Qu.push(r)}function kr(r){mp.push(r)}const ip=new Set;let ju=0;function jp(){if(ju!==0)return;const r=Ch;do{try{for(;ju<Wu.length;){const e=Wu[ju];ju++,Ra(e),tx(e.$$)}}catch(e){throw Wu.length=0,ju=0,e}for(Ra(null),Wu.length=0,ju=0;Jn.length;)Jn.pop()();for(let e=0;e<Qu.length;e+=1){const n=Qu[e];ip.has(n)||(ip.add(n),n())}Qu.length=0}while(Wu.length);for(;mp.length;)mp.pop()();gp=!1,ip.clear(),Ra(r)}function tx(r){if(r.fragment!==null){r.update(),$i(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(Po)}}function nx(r){const e=[],n=[];Qu.forEach(s=>r.indexOf(s)===-1?e.push(s):n.push(s)),n.forEach(s=>s()),Qu=e}const Tf=new Set;let tu;function Nn(){tu={r:0,c:[],p:tu}}function zn(){tu.r||$i(tu.c),tu=tu.p}function _e(r,e){r&&r.i&&(Tf.delete(r),r.i(e))}function Ie(r,e,n,s){if(r&&r.o){if(Tf.has(r))return;Tf.add(r),tu.c.push(()=>{Tf.delete(r),s&&(n&&r.d(1),s())}),r.o(e)}else s&&s()}function gs(r,e){const n=e.token={};function s(a,f,m,l){if(e.token!==n)return;e.resolved=l;let x=e.ctx;m!==void 0&&(x=x.slice(),x[m]=l);const S=a&&(e.current=a)(x);let C=!1;e.block&&(e.blocks?e.blocks.forEach((L,N)=>{N!==f&&L&&(Nn(),Ie(L,1,1,()=>{e.blocks[N]===L&&(e.blocks[N]=null)}),zn())}):e.block.d(1),S.c(),_e(S,1),S.m(e.mount(),e.anchor),C=!0),e.block=S,e.blocks&&(e.blocks[f]=S),C&&jp()}if($b(r)){const a=uc();if(r.then(f=>{Ra(a),s(e.then,1,e.value,f),Ra(null)},f=>{if(Ra(a),s(e.catch,2,e.error,f),Ra(null),!e.hasCatch)throw f}),e.current!==e.pending)return s(e.pending,0),!0}else{if(e.current!==e.then)return s(e.then,1,e.value,r),!0;e.resolved=r}}function kl(r,e,n){const s=e.slice(),{resolved:a}=r;r.current===r.then&&(s[r.value]=a),r.current===r.catch&&(s[r.error]=a),r.block.p(s,n)}function Hn(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function ix(r,e){Ie(r,1,1,()=>{e.delete(r.key)})}function rx(r,e,n,s,a,f,m,l,x,S,C,L){let N=r.length,B=f.length,U=N;const ee={};for(;U--;)ee[r[U].key]=U;const ie=[],re=new Map,Q=new Map,$=[];for(U=B;U--;){const he=L(a,f,U),xe=n(he);let be=m.get(xe);be?s&&$.push(()=>be.p(he,e)):(be=S(xe,he),be.c()),re.set(xe,ie[U]=be),xe in ee&&Q.set(xe,Math.abs(U-ee[xe]))}const pe=new Set,ve=new Set;function De(he){_e(he,1),he.m(l,C),m.set(he.key,he),C=he.first,B--}for(;N&&B;){const he=ie[B-1],xe=r[N-1],be=he.key,Le=xe.key;he===xe?(C=he.first,N--,B--):re.has(Le)?!m.has(be)||pe.has(be)?De(he):ve.has(Le)?N--:Q.get(be)>Q.get(Le)?(ve.add(be),De(he)):(pe.add(Le),N--):(x(xe,m),N--)}for(;N--;){const he=r[N];re.has(he.key)||x(he,m)}for(;B;)De(ie[B-1]);return $i($),ie}function Ir(r,e,n){const s=r.$$.props[e];s!==void 0&&(r.$$.bound[s]=n,n(r.$$.ctx[s]))}function ot(r){r&&r.c()}function rt(r,e,n){const{fragment:s,after_update:a}=r.$$;s&&s.m(e,n),Po(()=>{const f=r.$$.on_mount.map(H0).filter(iu);r.$$.on_destroy?r.$$.on_destroy.push(...f):$i(f),r.$$.on_mount=[]}),a.forEach(Po)}function st(r,e){const n=r.$$;n.fragment!==null&&(nx(n.after_update),$i(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function sx(r,e){r.$$.dirty[0]===-1&&(Wu.push(r),Q0(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function hn(r,e,n,s,a,f,m=null,l=[-1]){const x=Ch;Ra(r);const S=r.$$={fragment:null,ctx:[],props:f,update:tt,not_equal:a,bound:jg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(x?x.$$.context:[])),callbacks:jg(),dirty:l,skip_bound:!1,root:e.target||x.$$.root};m&&m(S.root);let C=!1;if(S.ctx=n?n(r,e.props||{},(L,N,...B)=>{const U=B.length?B[0]:N;return S.ctx&&a(S.ctx[L],S.ctx[L]=U)&&(!S.skip_bound&&S.bound[L]&&S.bound[L](U),C&&sx(r,L)),N}):[],S.update(),C=!0,$i(S.before_update),S.fragment=s?s(S.ctx):!1,e.target){if(e.hydrate){const L=Kb(e.target);S.fragment&&S.fragment.l(L),L.forEach(oe)}else S.fragment&&S.fragment.c();e.intro&&_e(r.$$.fragment),rt(r,e.target,e.anchor),jp()}Ra(x)}class fn{constructor(){lh(this,"$$");lh(this,"$$set")}$destroy(){st(this,1),this.$destroy=tt}$on(e,n){if(!iu(n))return tt;const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(n),()=>{const a=s.indexOf(n);a!==-1&&s.splice(a,1)}}$set(e){this.$$set&&!Yb(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ox="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ox);var ax=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lx(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ev={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.0/LICENSE.txt
 */(function(r,e){(function(n,s){r.exports=s()})(ax,function(){var n={},s={};function a(m,l,x){if(s[m]=x,m==="index"){var S="var sharedModule = {}; ("+s.shared+")(sharedModule); ("+s.worker+")(sharedModule);",C={};return s.shared(C),s.index(n,C),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([S],{type:"text/javascript"}))),n}}a("shared",["exports"],function(m){function l(o,i,u,g){return new(u||(u=Promise))(function(v,E){function T(O){try{R(g.next(O))}catch(j){E(j)}}function A(O){try{R(g.throw(O))}catch(j){E(j)}}function R(O){var j;O.done?v(O.value):(j=O.value,j instanceof u?j:new u(function(G){G(j)})).then(T,A)}R((g=g.apply(o,i||[])).next())})}function x(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}typeof SuppressedError=="function"&&SuppressedError;var S=C;function C(o,i){this.x=o,this.y=i}C.prototype={clone:function(){return new C(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,i){return this.clone()._rotateAround(o,i)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var i=o.x-this.x,u=o.y-this.y;return i*i+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,i){return Math.atan2(this.x*i-this.y*o,this.x*o+this.y*i)},_matMult:function(o){var i=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=i,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var i=Math.cos(o),u=Math.sin(o),g=u*this.x+i*this.y;return this.x=i*this.x-u*this.y,this.y=g,this},_rotateAround:function(o,i){var u=Math.cos(o),g=Math.sin(o),v=i.y+g*(this.x-i.x)+u*(this.y-i.y);return this.x=i.x+u*(this.x-i.x)-g*(this.y-i.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},C.convert=function(o){return o instanceof C?o:Array.isArray(o)?new C(o[0],o[1]):o};var L=x(S),N=B;function B(o,i,u,g){this.cx=3*o,this.bx=3*(u-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(g-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=i,this.p2x=u,this.p2y=g}B.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,i){if(i===void 0&&(i=1e-6),o<0)return 0;if(o>1)return 1;for(var u=o,g=0;g<8;g++){var v=this.sampleCurveX(u)-o;if(Math.abs(v)<i)return u;var E=this.sampleCurveDerivativeX(u);if(Math.abs(E)<1e-6)break;u-=v/E}var T=0,A=1;for(u=o,g=0;g<20&&(v=this.sampleCurveX(u),!(Math.abs(v-o)<i));g++)o>v?T=u:A=u,u=.5*(A-T)+T;return u},solve:function(o,i){return this.sampleCurveY(this.solveCurveX(o,i))}};var U=x(N);let ee,ie;function re(){return ee==null&&(ee=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ee}function Q(){if(ie==null&&(ie=!1,re())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let g=0;g<5*5;g++){const v=4*g;i.fillStyle=`rgb(${v},${v+1},${v+2})`,i.fillRect(g%5,Math.floor(g/5),1,1)}const u=i.getImageData(0,0,5,5).data;for(let g=0;g<5*5*4;g++)if(g%4!=3&&u[g]!==g){ie=!0;break}}}return ie||!1}function $(o,i,u,g){const v=new U(o,i,u,g);return E=>v.solve(E)}const pe=$(.25,.1,.25,1);function ve(o,i,u){return Math.min(u,Math.max(i,o))}function De(o,i,u){const g=u-i,v=((o-i)%g+g)%g+i;return v===i?u:v}function he(o,...i){for(const u of i)for(const g in u)o[g]=u[g];return o}let xe=1;function be(o,i,u){const g={};for(const v in o)g[v]=i.call(this,o[v],v,o);return g}function Le(o,i,u){const g={};for(const v in o)i.call(this,o[v],v,o)&&(g[v]=o[v]);return g}function we(o){return Array.isArray(o)?o.map(we):typeof o=="object"&&o?be(o,we):o}const ye={};function Ue(o){ye[o]||(typeof console<"u"&&console.warn(o),ye[o]=!0)}function Ve(o,i,u){return(u.y-o.y)*(i.x-o.x)>(i.y-o.y)*(u.x-o.x)}function pt(o){return typeof WorkerGlobalScope<"u"&&o!==void 0&&o instanceof WorkerGlobalScope}let St=null;function dt(o){return typeof ImageBitmap<"u"&&o instanceof ImageBitmap}const ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Bt(o,i,u,g,v){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const E=new VideoFrame(o,{timestamp:0});try{const T=E==null?void 0:E.format;if(!T||!T.startsWith("BGR")&&!T.startsWith("RGB"))throw new Error(`Unrecognized format ${T}`);const A=T.startsWith("BGR"),R=new Uint8ClampedArray(g*v*4);if(yield E.copyTo(R,function(O,j,G,X,te){const se=4*Math.max(-j,0),de=(Math.max(0,G)-G)*X*4+se,Ce=4*X,Re=Math.max(0,j),nt=Math.max(0,G);return{rect:{x:Re,y:nt,width:Math.min(O.width,j+X)-Re,height:Math.min(O.height,G+te)-nt},layout:[{offset:de,stride:Ce}]}}(o,i,u,g,v)),A)for(let O=0;O<R.length;O+=4){const j=R[O];R[O]=R[O+2],R[O+2]=j}return R}finally{E.close()}})}let vt,wt;const ft="AbortError";function xt(){return new Error(ft)}const It={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Jt(o){return It.REGISTERED_PROTOCOLS[o.substring(0,o.indexOf("://"))]}const pn="global-dispatcher";class Rn extends Error{constructor(i,u,g,v){super(`AJAXError: ${u} (${i}): ${g}`),this.status=i,this.statusText=u,this.url=g,this.body=v}}const Xe=()=>pt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Wn=function(o,i){if(/:\/\//.test(o.url)&&!/^https?:|^file:/.test(o.url)){const g=Jt(o.url);if(g)return g(o,i);if(pt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,targetMapId:pn},i)}if(!(/^file:/.test(u=o.url)||/^file:/.test(Xe())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(g,v){return l(this,void 0,void 0,function*(){const E=new Request(g.url,{method:g.method||"GET",body:g.body,credentials:g.credentials,headers:g.headers,cache:g.cache,referrer:Xe(),signal:v.signal});g.type!=="json"||E.headers.has("Accept")||E.headers.set("Accept","application/json");const T=yield fetch(E);if(!T.ok){const O=yield T.blob();throw new Rn(T.status,T.statusText,g.url,O)}let A;A=g.type==="arrayBuffer"||g.type==="image"?T.arrayBuffer():g.type==="json"?T.json():T.text();const R=yield A;if(v.signal.aborted)throw xt();return{data:R,cacheControl:T.headers.get("Cache-Control"),expires:T.headers.get("Expires")}})}(o,i);if(pt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,mustQueue:!0,targetMapId:pn},i)}var u;return function(g,v){return new Promise((E,T)=>{var A;const R=new XMLHttpRequest;R.open(g.method||"GET",g.url,!0),g.type!=="arrayBuffer"&&g.type!=="image"||(R.responseType="arraybuffer");for(const O in g.headers)R.setRequestHeader(O,g.headers[O]);g.type==="json"&&(R.responseType="text",!((A=g.headers)===null||A===void 0)&&A.Accept||R.setRequestHeader("Accept","application/json")),R.withCredentials=g.credentials==="include",R.onerror=()=>{T(new Error(R.statusText))},R.onload=()=>{if(!v.signal.aborted)if((R.status>=200&&R.status<300||R.status===0)&&R.response!==null){let O=R.response;if(g.type==="json")try{O=JSON.parse(R.response)}catch(j){return void T(j)}E({data:O,cacheControl:R.getResponseHeader("Cache-Control"),expires:R.getResponseHeader("Expires")})}else{const O=new Blob([R.response],{type:R.getResponseHeader("Content-Type")});T(new Rn(R.status,R.statusText,g.url,O))}},v.signal.addEventListener("abort",()=>{R.abort(),T(xt())}),R.send(g.body)})}(o,i)};function dn(o){if(!o||o.indexOf("://")<=0||o.indexOf("data:image/")===0||o.indexOf("blob:")===0)return!0;const i=new URL(o),u=window.location;return i.protocol===u.protocol&&i.host===u.host}function Ft(o,i,u){u[o]&&u[o].indexOf(i)!==-1||(u[o]=u[o]||[],u[o].push(i))}function Se(o,i,u){if(u&&u[o]){const g=u[o].indexOf(i);g!==-1&&u[o].splice(g,1)}}class lt{constructor(i,u={}){he(this,u),this.type=i}}class Je extends lt{constructor(i,u={}){super("error",he({error:i},u))}}class Lt{on(i,u){return this._listeners=this._listeners||{},Ft(i,u,this._listeners),this}off(i,u){return Se(i,u,this._listeners),Se(i,u,this._oneTimeListeners),this}once(i,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},Ft(i,u,this._oneTimeListeners),this):new Promise(g=>this.once(i,g))}fire(i,u){typeof i=="string"&&(i=new lt(i,u||{}));const g=i.type;if(this.listens(g)){i.target=this;const v=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(const A of v)A.call(this,i);const E=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(const A of E)Se(g,A,this._oneTimeListeners),A.call(this,i);const T=this._eventedParent;T&&(he(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(i))}else i instanceof Je&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,u){return this._eventedParent=i,this._eventedParentData=u,this}}var Ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const kt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Vt(o,i){const u={};for(const g in o)g!=="ref"&&(u[g]=o[g]);return kt.forEach(g=>{g in i&&(u[g]=i[g])}),u}function Ee(o,i){if(Array.isArray(o)){if(!Array.isArray(i)||o.length!==i.length)return!1;for(let u=0;u<o.length;u++)if(!Ee(o[u],i[u]))return!1;return!0}if(typeof o=="object"&&o!==null&&i!==null){if(typeof i!="object"||Object.keys(o).length!==Object.keys(i).length)return!1;for(const u in o)if(!Ee(o[u],i[u]))return!1;return!0}return o===i}function Gt(o,i){o.push(i)}function _n(o,i,u){Gt(u,{command:"addSource",args:[o,i[o]]})}function Kn(o,i,u){Gt(i,{command:"removeSource",args:[o]}),u[o]=!0}function Yi(o,i,u,g){Kn(o,u,g),_n(o,i,u)}function xn(o,i,u){let g;for(g in o[u])if(Object.prototype.hasOwnProperty.call(o[u],g)&&g!=="data"&&!Ee(o[u][g],i[u][g]))return!1;for(g in i[u])if(Object.prototype.hasOwnProperty.call(i[u],g)&&g!=="data"&&!Ee(o[u][g],i[u][g]))return!1;return!0}function qi(o,i,u,g,v,E){o=o||{},i=i||{};for(const T in o)Object.prototype.hasOwnProperty.call(o,T)&&(Ee(o[T],i[T])||u.push({command:E,args:[g,T,i[T],v]}));for(const T in i)Object.prototype.hasOwnProperty.call(i,T)&&!Object.prototype.hasOwnProperty.call(o,T)&&(Ee(o[T],i[T])||u.push({command:E,args:[g,T,i[T],v]}))}function Ji(o){return o.id}function Jr(o,i){return o[i.id]=i,o}class ct{constructor(i,u,g,v){this.message=(i?`${i}: `:"")+g,v&&(this.identifier=v),u!=null&&u.__line__&&(this.line=u.__line__)}}function gr(o,...i){for(const u of i)for(const g in u)o[g]=u[g];return o}class kn extends Error{constructor(i,u){super(u),this.message=u,this.key=i}}class mn{constructor(i,u=[]){this.parent=i,this.bindings={};for(const[g,v]of u)this.bindings[g]=v}concat(i){return new mn(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const As={kind:"null"},At={kind:"number"},Ln={kind:"string"},Tt={kind:"boolean"},_r={kind:"color"},Gr={kind:"object"},wn={kind:"value"},Mi={kind:"collator"},Er={kind:"formatted"},Ki={kind:"padding"},Zr={kind:"resolvedImage"},Ae={kind:"variableAnchorOffsetCollection"};function K(o,i){return{kind:"array",itemType:o,N:i}}function J(o){if(o.kind==="array"){const i=J(o.itemType);return typeof o.N=="number"?`array<${i}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${i}>`}return o.kind}const ce=[As,At,Ln,Tt,_r,Er,Gr,K(wn),Ki,Zr,Ae];function le(o,i){if(i.kind==="error")return null;if(o.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!le(o.itemType,i.itemType))&&(typeof o.N!="number"||o.N===i.N))return null}else{if(o.kind===i.kind)return null;if(o.kind==="value"){for(const u of ce)if(!le(u,i))return null}}return`Expected ${J(o)} but found ${J(i)} instead.`}function fe(o,i){return i.some(u=>u.kind===o.kind)}function je(o,i){return i.some(u=>u==="null"?o===null:u==="array"?Array.isArray(o):u==="object"?o&&!Array.isArray(o)&&typeof o=="object":u===typeof o)}function We(o,i){return o.kind==="array"&&i.kind==="array"?o.itemType.kind===i.itemType.kind&&typeof o.N=="number":o.kind===i.kind}const Pe=.96422,et=.82521,gt=4/29,at=6/29,Dt=3*at*at,en=at*at*at,an=Math.PI/180,Vn=180/Math.PI;function Mn(o){return(o%=360)<0&&(o+=360),o}function An([o,i,u,g]){let v,E;const T=wi((.2225045*(o=Fn(o))+.7168786*(i=Fn(i))+.0606169*(u=Fn(u)))/1);o===i&&i===u?v=E=T:(v=wi((.4360747*o+.3850649*i+.1430804*u)/Pe),E=wi((.0139322*o+.0971045*i+.7141733*u)/et));const A=116*T-16;return[A<0?0:A,500*(v-T),200*(T-E),g]}function Fn(o){return o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function wi(o){return o>en?Math.pow(o,1/3):o/Dt+gt}function ui([o,i,u,g]){let v=(o+16)/116,E=isNaN(i)?v:v+i/500,T=isNaN(u)?v:v-u/200;return v=1*ii(v),E=Pe*ii(E),T=et*ii(T),[Cn(3.1338561*E-1.6168667*v-.4906146*T),Cn(-.9787684*E+1.9161415*v+.033454*T),Cn(.0719453*E-.2289914*v+1.4052427*T),g]}function Cn(o){return(o=o<=.00304?12.92*o:1.055*Math.pow(o,1/2.4)-.055)<0?0:o>1?1:o}function ii(o){return o>at?o*o*o:Dt*(o-gt)}function hi(o){return parseInt(o.padEnd(2,o),16)/255}function Ai(o,i){return Xn(i?o/100:o,0,1)}function Xn(o,i,u){return Math.min(Math.max(i,o),u)}function Tr(o){return!o.some(Number.isNaN)}const No={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Qn{constructor(i,u,g,v=1,E=!0){this.r=i,this.g=u,this.b=g,this.a=v,E||(this.r*=v,this.g*=v,this.b*=v,v||this.overwriteGetter("rgb",[i,u,g,v]))}static parse(i){if(i instanceof Qn)return i;if(typeof i!="string")return;const u=function(g){if((g=g.toLowerCase().trim())==="transparent")return[0,0,0,0];const v=No[g];if(v){const[T,A,R]=v;return[T/255,A/255,R/255,1]}if(g.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(g)){const T=g.length<6?1:2;let A=1;return[hi(g.slice(A,A+=T)),hi(g.slice(A,A+=T)),hi(g.slice(A,A+=T)),hi(g.slice(A,A+T)||"ff")]}if(g.startsWith("rgb")){const T=g.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[A,R,O,j,G,X,te,se,de,Ce,Re,nt]=T,Ge=[j||" ",te||" ",Ce].join("");if(Ge==="  "||Ge==="  /"||Ge===",,"||Ge===",,,"){const Qe=[O,X,de].join(""),ht=Qe==="%%%"?100:Qe===""?255:0;if(ht){const Et=[Xn(+R/ht,0,1),Xn(+G/ht,0,1),Xn(+se/ht,0,1),Re?Ai(+Re,nt):1];if(Tr(Et))return Et}}return}}const E=g.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[T,A,R,O,j,G,X,te,se]=E,de=[R||" ",j||" ",X].join("");if(de==="  "||de==="  /"||de===",,"||de===",,,"){const Ce=[+A,Xn(+O,0,100),Xn(+G,0,100),te?Ai(+te,se):1];if(Tr(Ce))return function([Re,nt,Ge,Qe]){function ht(Et){const $t=(Et+Re/30)%12,yn=nt*Math.min(Ge,1-Ge);return Ge-yn*Math.max(-1,Math.min($t-3,9-$t,1))}return Re=Mn(Re),nt/=100,Ge/=100,[ht(0),ht(8),ht(4),Qe]}(Ce)}}}(i);return u?new Qn(...u,!1):void 0}get rgb(){const{r:i,g:u,b:g,a:v}=this,E=v||1/0;return this.overwriteGetter("rgb",[i/E,u/E,g/E,v])}get hcl(){return this.overwriteGetter("hcl",function(i){const[u,g,v,E]=An(i),T=Math.sqrt(g*g+v*v);return[Math.round(1e4*T)?Mn(Math.atan2(v,g)*Vn):NaN,T,u,E]}(this.rgb))}get lab(){return this.overwriteGetter("lab",An(this.rgb))}overwriteGetter(i,u){return Object.defineProperty(this,i,{value:u}),u}toString(){const[i,u,g,v]=this.rgb;return`rgba(${[i,u,g].map(E=>Math.round(255*E)).join(",")},${v})`}}Qn.black=new Qn(0,0,0,1),Qn.white=new Qn(1,1,1,1),Qn.transparent=new Qn(0,0,0,0),Qn.red=new Qn(1,0,0,1);class bo{constructor(i,u,g){this.sensitivity=i?u?"variant":"case":u?"accent":"base",this.locale=g,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,u){return this.collator.compare(i,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class aa{constructor(i,u,g,v,E){this.text=i,this.image=u,this.scale=g,this.fontStack=v,this.textColor=E}}class Cr{constructor(i){this.sections=i}static fromString(i){return new Cr([new aa(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof Cr?i:Cr.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class Dr{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Dr)return i;if(typeof i=="number")return new Dr([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const u of i)if(typeof u!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new Dr(i)}}toString(){return JSON.stringify(this.values)}}const yc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Pi{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Pi)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let u=0;u<i.length;u+=2){const g=i[u],v=i[u+1];if(typeof g!="string"||!yc.has(g)||!Array.isArray(v)||v.length!==2||typeof v[0]!="number"||typeof v[1]!="number")return}return new Pi(i)}}toString(){return JSON.stringify(this.values)}}class or{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new or({name:i,available:!1}):null}}function no(o,i,u,g){return typeof o=="number"&&o>=0&&o<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof u=="number"&&u>=0&&u<=255?g===void 0||typeof g=="number"&&g>=0&&g<=1?null:`Invalid rgba value [${[o,i,u,g].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof g=="number"?[o,i,u,g]:[o,i,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Kr(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof Qn||o instanceof bo||o instanceof Cr||o instanceof Dr||o instanceof Pi||o instanceof or)return!0;if(Array.isArray(o)){for(const i of o)if(!Kr(i))return!1;return!0}if(typeof o=="object"){for(const i in o)if(!Kr(o[i]))return!1;return!0}return!1}function Ri(o){if(o===null)return As;if(typeof o=="string")return Ln;if(typeof o=="boolean")return Tt;if(typeof o=="number")return At;if(o instanceof Qn)return _r;if(o instanceof bo)return Mi;if(o instanceof Cr)return Er;if(o instanceof Dr)return Ki;if(o instanceof Pi)return Ae;if(o instanceof or)return Zr;if(Array.isArray(o)){const i=o.length;let u;for(const g of o){const v=Ri(g);if(u){if(u===v)continue;u=wn;break}u=v}return K(u||wn,i)}return Gr}function la(o){const i=typeof o;return o===null?"":i==="string"||i==="number"||i==="boolean"?String(o):o instanceof Qn||o instanceof Cr||o instanceof Dr||o instanceof Pi||o instanceof or?o.toString():JSON.stringify(o)}class _s{constructor(i,u){this.type=i,this.value=u}static parse(i,u){if(i.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Kr(i[1]))return u.error("invalid value");const g=i[1];let v=Ri(g);const E=u.expectedType;return v.kind!=="array"||v.N!==0||!E||E.kind!=="array"||typeof E.N=="number"&&E.N!==0||(v=E),new _s(v,g)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Fi{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const ua={string:Ln,number:At,boolean:Tt,object:Gr};class Qr{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");let g,v=1;const E=i[0];if(E==="array"){let A,R;if(i.length>2){const O=i[1];if(typeof O!="string"||!(O in ua)||O==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);A=ua[O],v++}else A=wn;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return u.error('The length argument to "array" must be a positive integer literal',2);R=i[2],v++}g=K(A,R)}else{if(!ua[E])throw new Error(`Types doesn't contain name = ${E}`);g=ua[E]}const T=[];for(;v<i.length;v++){const A=u.parse(i[v],v,wn);if(!A)return null;T.push(A)}return new Qr(g,T)}evaluate(i){for(let u=0;u<this.args.length;u++){const g=this.args[u].evaluate(i);if(!le(this.type,Ri(g)))return g;if(u===this.args.length-1)throw new Fi(`Expected value to be of type ${J(this.type)}, but found ${J(Ri(g))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const zo={"to-boolean":Tt,"to-color":_r,"to-number":At,"to-string":Ln};class Qi{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");const g=i[0];if(!zo[g])throw new Error(`Can't parse ${g} as it is not part of the known types`);if((g==="to-boolean"||g==="to-string")&&i.length!==2)return u.error("Expected one argument.");const v=zo[g],E=[];for(let T=1;T<i.length;T++){const A=u.parse(i[T],T,wn);if(!A)return null;E.push(A)}return new Qi(v,E)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let u,g;for(const v of this.args){if(u=v.evaluate(i),g=null,u instanceof Qn)return u;if(typeof u=="string"){const E=i.parseColor(u);if(E)return E}else if(Array.isArray(u)&&(g=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:no(u[0],u[1],u[2],u[3]),!g))return new Qn(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new Fi(g||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const g of this.args){u=g.evaluate(i);const v=Dr.parse(u);if(v)return v}throw new Fi(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const g of this.args){u=g.evaluate(i);const v=Pi.parse(u);if(v)return v}throw new Fi(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const g of this.args){if(u=g.evaluate(i),u===null)return 0;const v=Number(u);if(!isNaN(v))return v}throw new Fi(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return Cr.fromString(la(this.args[0].evaluate(i)));case"resolvedImage":return or.fromString(la(this.args[0].evaluate(i)));default:return la(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const io=["Unknown","Point","LineString","Polygon"];class ca{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?io[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let u=this._parseColorCache[i];return u||(u=this._parseColorCache[i]=Qn.parse(i)),u}}class es{constructor(i,u,g=[],v,E=new mn,T=[]){this.registry=i,this.path=g,this.key=g.map(A=>`[${A}]`).join(""),this.scope=E,this.errors=T,this.expectedType=v,this._isConstant=u}parse(i,u,g,v,E={}){return u?this.concat(u,g,v)._parse(i,E):this._parse(i,E)}_parse(i,u){function g(v,E,T){return T==="assert"?new Qr(E,[v]):T==="coerce"?new Qi(E,[v]):v}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=i[0];if(typeof v!="string")return this.error(`Expression name must be a string, but found ${typeof v} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const E=this.registry[v];if(E){let T=E.parse(i,this);if(!T)return null;if(this.expectedType){const A=this.expectedType,R=T.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||R.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string")if(A.kind!=="padding"||R.kind!=="value"&&R.kind!=="number"&&R.kind!=="array")if(A.kind!=="variableAnchorOffsetCollection"||R.kind!=="value"&&R.kind!=="array"){if(this.checkSubtype(A,R))return null}else T=g(T,A,u.typeAnnotation||"coerce");else T=g(T,A,u.typeAnnotation||"coerce");else T=g(T,A,u.typeAnnotation||"coerce");else T=g(T,A,u.typeAnnotation||"assert")}if(!(T instanceof _s)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const A=new ca;try{T=new _s(T.type,T.evaluate(A))}catch(R){return this.error(R.message),null}}return T}return this.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,u,g){const v=typeof i=="number"?this.path.concat(i):this.path,E=g?this.scope.concat(g):this.scope;return new es(this.registry,this._isConstant,v,u||null,E,this.errors)}error(i,...u){const g=`${this.key}${u.map(v=>`[${v}]`).join("")}`;this.errors.push(new kn(g,i))}checkSubtype(i,u){const g=le(i,u);return g&&this.error(g),g}}class ro{constructor(i,u){this.type=u.type,this.bindings=[].concat(i),this.result=u}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const u of this.bindings)i(u[1]);i(this.result)}static parse(i,u){if(i.length<4)return u.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const g=[];for(let E=1;E<i.length-1;E+=2){const T=i[E];if(typeof T!="string")return u.error(`Expected string, but found ${typeof T} instead.`,E);if(/[^a-zA-Z0-9_]/.test(T))return u.error("Variable names must contain only alphanumeric characters or '_'.",E);const A=u.parse(i[E+1],E+1);if(!A)return null;g.push([T,A])}const v=u.parse(i[i.length-1],i.length-1,u.expectedType,g);return v?new ro(g,v):null}outputDefined(){return this.result.outputDefined()}}class ei{constructor(i,u){this.type=u.type,this.name=i,this.boundExpression=u}static parse(i,u){if(i.length!==2||typeof i[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const g=i[1];return u.scope.has(g)?new ei(g,u.scope.get(g)):u.error(`Unknown variable "${g}". Make sure "${g}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class Sl{constructor(i,u,g){this.type=i,this.index=u,this.input=g}static parse(i,u){if(i.length!==3)return u.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const g=u.parse(i[1],1,At),v=u.parse(i[2],2,K(u.expectedType||wn));return g&&v?new Sl(v.type.itemType,g,v):null}evaluate(i){const u=this.index.evaluate(i),g=this.input.evaluate(i);if(u<0)throw new Fi(`Array index out of bounds: ${u} < 0.`);if(u>=g.length)throw new Fi(`Array index out of bounds: ${u} > ${g.length-1}.`);if(u!==Math.floor(u))throw new Fi(`Array index must be an integer, but found ${u} instead.`);return g[u]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class El{constructor(i,u){this.type=Tt,this.needle=i,this.haystack=u}static parse(i,u){if(i.length!==3)return u.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const g=u.parse(i[1],1,wn),v=u.parse(i[2],2,wn);return g&&v?fe(g.type,[Tt,Ln,At,As,wn])?new El(g,v):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(g.type)} instead`):null}evaluate(i){const u=this.needle.evaluate(i),g=this.haystack.evaluate(i);if(!g)return!1;if(!je(u,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${J(Ri(u))} instead.`);if(!je(g,["string","array"]))throw new Fi(`Expected second argument to be of type array or string, but found ${J(Ri(g))} instead.`);return g.indexOf(u)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class xo{constructor(i,u,g){this.type=At,this.needle=i,this.haystack=u,this.fromIndex=g}static parse(i,u){if(i.length<=2||i.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const g=u.parse(i[1],1,wn),v=u.parse(i[2],2,wn);if(!g||!v)return null;if(!fe(g.type,[Tt,Ln,At,As,wn]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(g.type)} instead`);if(i.length===4){const E=u.parse(i[3],3,At);return E?new xo(g,v,E):null}return new xo(g,v)}evaluate(i){const u=this.needle.evaluate(i),g=this.haystack.evaluate(i);if(!je(u,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${J(Ri(u))} instead.`);let v;if(this.fromIndex&&(v=this.fromIndex.evaluate(i)),je(g,["string"])){const E=g.indexOf(u,v);return E===-1?-1:[...g.slice(0,E)].length}if(je(g,["array"]))return g.indexOf(u,v);throw new Fi(`Expected second argument to be of type array or string, but found ${J(Ri(g))} instead.`)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class wo{constructor(i,u,g,v,E,T){this.inputType=i,this.type=u,this.input=g,this.cases=v,this.outputs=E,this.otherwise=T}static parse(i,u){if(i.length<5)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return u.error("Expected an even number of arguments.");let g,v;u.expectedType&&u.expectedType.kind!=="value"&&(v=u.expectedType);const E={},T=[];for(let O=2;O<i.length-1;O+=2){let j=i[O];const G=i[O+1];Array.isArray(j)||(j=[j]);const X=u.concat(O);if(j.length===0)return X.error("Expected at least one branch label.");for(const se of j){if(typeof se!="number"&&typeof se!="string")return X.error("Branch labels must be numbers or strings.");if(typeof se=="number"&&Math.abs(se)>Number.MAX_SAFE_INTEGER)return X.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof se=="number"&&Math.floor(se)!==se)return X.error("Numeric branch labels must be integer values.");if(g){if(X.checkSubtype(g,Ri(se)))return null}else g=Ri(se);if(E[String(se)]!==void 0)return X.error("Branch labels must be unique.");E[String(se)]=T.length}const te=u.parse(G,O,v);if(!te)return null;v=v||te.type,T.push(te)}const A=u.parse(i[1],1,wn);if(!A)return null;const R=u.parse(i[i.length-1],i.length-1,v);return R?A.type.kind!=="value"&&u.concat(1).checkSubtype(g,A.type)?null:new wo(g,v,A,E,T,R):null}evaluate(i){const u=this.input.evaluate(i);return(Ri(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class ha{constructor(i,u,g){this.type=i,this.branches=u,this.otherwise=g}static parse(i,u){if(i.length<4)return u.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return u.error("Expected an odd number of arguments.");let g;u.expectedType&&u.expectedType.kind!=="value"&&(g=u.expectedType);const v=[];for(let T=1;T<i.length-1;T+=2){const A=u.parse(i[T],T,Tt);if(!A)return null;const R=u.parse(i[T+1],T+1,g);if(!R)return null;v.push([A,R]),g=g||R.type}const E=u.parse(i[i.length-1],i.length-1,g);if(!E)return null;if(!g)throw new Error("Can't infer output type");return new ha(g,v,E)}evaluate(i){for(const[u,g]of this.branches)if(u.evaluate(i))return g.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[u,g]of this.branches)i(u),i(g);i(this.otherwise)}outputDefined(){return this.branches.every(([i,u])=>u.outputDefined())&&this.otherwise.outputDefined()}}class fa{constructor(i,u,g,v){this.type=i,this.input=u,this.beginIndex=g,this.endIndex=v}static parse(i,u){if(i.length<=2||i.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const g=u.parse(i[1],1,wn),v=u.parse(i[2],2,At);if(!g||!v)return null;if(!fe(g.type,[K(wn),Ln,wn]))return u.error(`Expected first argument to be of type array or string, but found ${J(g.type)} instead`);if(i.length===4){const E=u.parse(i[3],3,At);return E?new fa(g.type,g,v,E):null}return new fa(g.type,g,v)}evaluate(i){const u=this.input.evaluate(i),g=this.beginIndex.evaluate(i);let v;if(this.endIndex&&(v=this.endIndex.evaluate(i)),je(u,["string"]))return[...u].slice(g,v).join("");if(je(u,["array"]))return u.slice(g,v);throw new Fi(`Expected first argument to be of type array or string, but found ${J(Ri(u))} instead.`)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function da(o,i){const u=o.length-1;let g,v,E=0,T=u,A=0;for(;E<=T;)if(A=Math.floor((E+T)/2),g=o[A],v=o[A+1],g<=i){if(A===u||i<v)return A;E=A+1}else{if(!(g>i))throw new Fi("Input is not a number.");T=A-1}return 0}class Oo{constructor(i,u,g){this.type=i,this.input=u,this.labels=[],this.outputs=[];for(const[v,E]of g)this.labels.push(v),this.outputs.push(E)}static parse(i,u){if(i.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return u.error("Expected an even number of arguments.");const g=u.parse(i[1],1,At);if(!g)return null;const v=[];let E=null;u.expectedType&&u.expectedType.kind!=="value"&&(E=u.expectedType);for(let T=1;T<i.length;T+=2){const A=T===1?-1/0:i[T],R=i[T+1],O=T,j=T+1;if(typeof A!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(v.length&&v[v.length-1][0]>=A)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const G=u.parse(R,j,E);if(!G)return null;E=E||G.type,v.push([A,G])}return new Oo(E,g,v)}evaluate(i){const u=this.labels,g=this.outputs;if(u.length===1)return g[0].evaluate(i);const v=this.input.evaluate(i);if(v<=u[0])return g[0].evaluate(i);const E=u.length;return v>=u[E-1]?g[E-1].evaluate(i):g[da(u,v)].evaluate(i)}eachChild(i){i(this.input);for(const u of this.outputs)i(u)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function za(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var ki=so;function so(o,i,u,g){this.cx=3*o,this.bx=3*(u-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(g-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=i,this.p2x=u,this.p2y=g}so.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,i){if(i===void 0&&(i=1e-6),o<0)return 0;if(o>1)return 1;for(var u=o,g=0;g<8;g++){var v=this.sampleCurveX(u)-o;if(Math.abs(v)<i)return u;var E=this.sampleCurveDerivativeX(u);if(Math.abs(E)<1e-6)break;u-=v/E}var T=0,A=1;for(u=o,g=0;g<20&&(v=this.sampleCurveX(u),!(Math.abs(v-o)<i));g++)o>v?T=u:A=u,u=.5*(A-T)+T;return u},solve:function(o,i){return this.sampleCurveY(this.solveCurveX(o,i))}};var vc=za(ki);function Vs(o,i,u){return o+u*(i-o)}function yr(o,i,u){return o.map((g,v)=>Vs(g,i[v],u))}const bi={number:Vs,color:function(o,i,u,g="rgb"){switch(g){case"rgb":{const[v,E,T,A]=yr(o.rgb,i.rgb,u);return new Qn(v,E,T,A,!1)}case"hcl":{const[v,E,T,A]=o.hcl,[R,O,j,G]=i.hcl;let X,te;if(isNaN(v)||isNaN(R))isNaN(v)?isNaN(R)?X=NaN:(X=R,T!==1&&T!==0||(te=O)):(X=v,j!==1&&j!==0||(te=E));else{let nt=R-v;R>v&&nt>180?nt-=360:R<v&&v-R>180&&(nt+=360),X=v+u*nt}const[se,de,Ce,Re]=function([nt,Ge,Qe,ht]){return nt=isNaN(nt)?0:nt*an,ui([Qe,Math.cos(nt)*Ge,Math.sin(nt)*Ge,ht])}([X,te??Vs(E,O,u),Vs(T,j,u),Vs(A,G,u)]);return new Qn(se,de,Ce,Re,!1)}case"lab":{const[v,E,T,A]=ui(yr(o.lab,i.lab,u));return new Qn(v,E,T,A,!1)}}},array:yr,padding:function(o,i,u){return new Dr(yr(o.values,i.values,u))},variableAnchorOffsetCollection:function(o,i,u){const g=o.values,v=i.values;if(g.length!==v.length)throw new Fi(`Cannot interpolate values of different length. from: ${o.toString()}, to: ${i.toString()}`);const E=[];for(let T=0;T<g.length;T+=2){if(g[T]!==v[T])throw new Fi(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${g[T]}, to[${T}]: ${v[T]}`);E.push(g[T]);const[A,R]=g[T+1],[O,j]=v[T+1];E.push([Vs(A,O,u),Vs(R,j,u)])}return new Pi(E)}};class cr{constructor(i,u,g,v,E){this.type=i,this.operator=u,this.interpolation=g,this.input=v,this.labels=[],this.outputs=[];for(const[T,A]of E)this.labels.push(T),this.outputs.push(A)}static interpolationFactor(i,u,g,v){let E=0;if(i.name==="exponential")E=Oa(u,i.base,g,v);else if(i.name==="linear")E=Oa(u,1,g,v);else if(i.name==="cubic-bezier"){const T=i.controlPoints;E=new vc(T[0],T[1],T[2],T[3]).solve(Oa(u,1,g,v))}return E}static parse(i,u){let[g,v,E,...T]=i;if(!Array.isArray(v)||v.length===0)return u.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const O=v[1];if(typeof O!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:O}}else{if(v[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const O=v.slice(1);if(O.length!==4||O.some(j=>typeof j!="number"||j<0||j>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:O}}}if(i.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(E=u.parse(E,2,At),!E)return null;const A=[];let R=null;g==="interpolate-hcl"||g==="interpolate-lab"?R=_r:u.expectedType&&u.expectedType.kind!=="value"&&(R=u.expectedType);for(let O=0;O<T.length;O+=2){const j=T[O],G=T[O+1],X=O+3,te=O+4;if(typeof j!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',X);if(A.length&&A[A.length-1][0]>=j)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',X);const se=u.parse(G,te,R);if(!se)return null;R=R||se.type,A.push([j,se])}return We(R,At)||We(R,_r)||We(R,Ki)||We(R,Ae)||We(R,K(At))?new cr(R,g,v,E,A):u.error(`Type ${J(R)} is not interpolatable.`)}evaluate(i){const u=this.labels,g=this.outputs;if(u.length===1)return g[0].evaluate(i);const v=this.input.evaluate(i);if(v<=u[0])return g[0].evaluate(i);const E=u.length;if(v>=u[E-1])return g[E-1].evaluate(i);const T=da(u,v),A=cr.interpolationFactor(this.interpolation,v,u[T],u[T+1]),R=g[T].evaluate(i),O=g[T+1].evaluate(i);switch(this.operator){case"interpolate":return bi[this.type.kind](R,O,A);case"interpolate-hcl":return bi.color(R,O,A,"hcl");case"interpolate-lab":return bi.color(R,O,A,"lab")}}eachChild(i){i(this.input);for(const u of this.outputs)i(u)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Oa(o,i,u,g){const v=g-u,E=o-u;return v===0?0:i===1?E/v:(Math.pow(i,E)-1)/(Math.pow(i,v)-1)}class Fa{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expectected at least one argument.");let g=null;const v=u.expectedType;v&&v.kind!=="value"&&(g=v);const E=[];for(const A of i.slice(1)){const R=u.parse(A,1+E.length,g,void 0,{typeAnnotation:"omit"});if(!R)return null;g=g||R.type,E.push(R)}if(!g)throw new Error("No output type");const T=v&&E.some(A=>le(v,A.type));return new Fa(T?wn:g,E)}evaluate(i){let u,g=null,v=0;for(const E of this.args)if(v++,g=E.evaluate(i),g&&g instanceof or&&!g.available&&(u||(u=g.name),g=null,v===this.args.length&&(g=u)),g!==null)break;return g}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}function pa(o,i){return o==="=="||o==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function ma(o,i,u,g){return g.compare(i,u)===0}function Fo(o,i,u){const g=o!=="=="&&o!=="!=";return class tv{constructor(E,T,A){this.type=Tt,this.lhs=E,this.rhs=T,this.collator=A,this.hasUntypedArgument=E.type.kind==="value"||T.type.kind==="value"}static parse(E,T){if(E.length!==3&&E.length!==4)return T.error("Expected two or three arguments.");const A=E[0];let R=T.parse(E[1],1,wn);if(!R)return null;if(!pa(A,R.type))return T.concat(1).error(`"${A}" comparisons are not supported for type '${J(R.type)}'.`);let O=T.parse(E[2],2,wn);if(!O)return null;if(!pa(A,O.type))return T.concat(2).error(`"${A}" comparisons are not supported for type '${J(O.type)}'.`);if(R.type.kind!==O.type.kind&&R.type.kind!=="value"&&O.type.kind!=="value")return T.error(`Cannot compare types '${J(R.type)}' and '${J(O.type)}'.`);g&&(R.type.kind==="value"&&O.type.kind!=="value"?R=new Qr(O.type,[R]):R.type.kind!=="value"&&O.type.kind==="value"&&(O=new Qr(R.type,[O])));let j=null;if(E.length===4){if(R.type.kind!=="string"&&O.type.kind!=="string"&&R.type.kind!=="value"&&O.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(j=T.parse(E[3],3,Mi),!j)return null}return new tv(R,O,j)}evaluate(E){const T=this.lhs.evaluate(E),A=this.rhs.evaluate(E);if(g&&this.hasUntypedArgument){const R=Ri(T),O=Ri(A);if(R.kind!==O.kind||R.kind!=="string"&&R.kind!=="number")throw new Fi(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${R.kind}, ${O.kind}) instead.`)}if(this.collator&&!g&&this.hasUntypedArgument){const R=Ri(T),O=Ri(A);if(R.kind!=="string"||O.kind!=="string")return i(E,T,A)}return this.collator?u(E,T,A,this.collator.evaluate(E)):i(E,T,A)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}}}const ou=Fo("==",function(o,i,u){return i===u},ma),ri=Fo("!=",function(o,i,u){return i!==u},function(o,i,u,g){return!ma(0,i,u,g)}),ys=Fo("<",function(o,i,u){return i<u},function(o,i,u,g){return g.compare(i,u)<0}),Tl=Fo(">",function(o,i,u){return i>u},function(o,i,u,g){return g.compare(i,u)>0}),au=Fo("<=",function(o,i,u){return i<=u},function(o,i,u,g){return g.compare(i,u)<=0}),Bo=Fo(">=",function(o,i,u){return i>=u},function(o,i,u,g){return g.compare(i,u)>=0});class Uo{constructor(i,u,g){this.type=Mi,this.locale=g,this.caseSensitive=i,this.diacriticSensitive=u}static parse(i,u){if(i.length!==2)return u.error("Expected one argument.");const g=i[1];if(typeof g!="object"||Array.isArray(g))return u.error("Collator options argument must be an object.");const v=u.parse(g["case-sensitive"]!==void 0&&g["case-sensitive"],1,Tt);if(!v)return null;const E=u.parse(g["diacritic-sensitive"]!==void 0&&g["diacritic-sensitive"],1,Tt);if(!E)return null;let T=null;return g.locale&&(T=u.parse(g.locale,1,Ln),!T)?null:new Uo(v,E,T)}evaluate(i){return new bo(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}class hr{constructor(i,u,g,v,E){this.type=Ln,this.number=i,this.locale=u,this.currency=g,this.minFractionDigits=v,this.maxFractionDigits=E}static parse(i,u){if(i.length!==3)return u.error("Expected two arguments.");const g=u.parse(i[1],1,At);if(!g)return null;const v=i[2];if(typeof v!="object"||Array.isArray(v))return u.error("NumberFormat options argument must be an object.");let E=null;if(v.locale&&(E=u.parse(v.locale,1,Ln),!E))return null;let T=null;if(v.currency&&(T=u.parse(v.currency,1,Ln),!T))return null;let A=null;if(v["min-fraction-digits"]&&(A=u.parse(v["min-fraction-digits"],1,At),!A))return null;let R=null;return v["max-fraction-digits"]&&(R=u.parse(v["max-fraction-digits"],1,At),!R)?null:new hr(g,E,T,A,R)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class ga{constructor(i){this.type=Er,this.sections=i}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");const g=i[1];if(!Array.isArray(g)&&typeof g=="object")return u.error("First argument must be an image or text section.");const v=[];let E=!1;for(let T=1;T<=i.length-1;++T){const A=i[T];if(E&&typeof A=="object"&&!Array.isArray(A)){E=!1;let R=null;if(A["font-scale"]&&(R=u.parse(A["font-scale"],1,At),!R))return null;let O=null;if(A["text-font"]&&(O=u.parse(A["text-font"],1,K(Ln)),!O))return null;let j=null;if(A["text-color"]&&(j=u.parse(A["text-color"],1,_r),!j))return null;const G=v[v.length-1];G.scale=R,G.font=O,G.textColor=j}else{const R=u.parse(i[T],1,wn);if(!R)return null;const O=R.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,v.push({content:R,scale:null,font:null,textColor:null})}}return new ga(v)}evaluate(i){return new Cr(this.sections.map(u=>{const g=u.content.evaluate(i);return Ri(g)===Zr?new aa("",g,null,null,null):new aa(la(g),null,u.scale?u.scale.evaluate(i):null,u.font?u.font.evaluate(i).join(","):null,u.textColor?u.textColor.evaluate(i):null)}))}eachChild(i){for(const u of this.sections)i(u.content),u.scale&&i(u.scale),u.font&&i(u.font),u.textColor&&i(u.textColor)}outputDefined(){return!1}}class _a{constructor(i){this.type=Zr,this.input=i}static parse(i,u){if(i.length!==2)return u.error("Expected two arguments.");const g=u.parse(i[1],1,Ln);return g?new _a(g):u.error("No image name provided.")}evaluate(i){const u=this.input.evaluate(i),g=or.fromString(u);return g&&i.availableImages&&(g.available=i.availableImages.indexOf(u)>-1),g}eachChild(i){i(this.input)}outputDefined(){return!1}}class Ba{constructor(i){this.type=At,this.input=i}static parse(i,u){if(i.length!==2)return u.error(`Expected 1 argument, but found ${i.length-1} instead.`);const g=u.parse(i[1],1);return g?g.type.kind!=="array"&&g.type.kind!=="string"&&g.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${J(g.type)} instead.`):new Ba(g):null}evaluate(i){const u=this.input.evaluate(i);if(typeof u=="string")return[...u].length;if(Array.isArray(u))return u.length;throw new Fi(`Expected value to be of type string or array, but found ${J(Ri(u))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const vs=8192;function bc(o,i){const u=(180+o[0])/360,g=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,v=Math.pow(2,i.z);return[Math.round(u*v*vs),Math.round(g*v*vs)]}function Ua(o,i){const u=Math.pow(2,i.z);return[(v=(o[0]/vs+i.x)/u,360*v-180),(g=(o[1]/vs+i.y)/u,360/Math.PI*Math.atan(Math.exp((180-360*g)*Math.PI/180))-90)];var g,v}function Lr(o,i){o[0]=Math.min(o[0],i[0]),o[1]=Math.min(o[1],i[1]),o[2]=Math.max(o[2],i[0]),o[3]=Math.max(o[3],i[1])}function bs(o,i){return!(o[0]<=i[0]||o[2]>=i[2]||o[1]<=i[1]||o[3]>=i[3])}function si(o,i,u){const g=o[0]-i[0],v=o[1]-i[1],E=o[0]-u[0],T=o[1]-u[1];return g*T-E*v==0&&g*E<=0&&v*T<=0}function Mr(o,i,u,g){return(v=[g[0]-u[0],g[1]-u[1]])[0]*(E=[i[0]-o[0],i[1]-o[1]])[1]-v[1]*E[0]!=0&&!(!lu(o,i,u,g)||!lu(u,g,o,i));var v,E}function jo(o,i,u){for(const g of u)for(let v=0;v<g.length-1;++v)if(Mr(o,i,g[v],g[v+1]))return!0;return!1}function Vo(o,i,u=!1){let g=!1;for(const A of i)for(let R=0;R<A.length-1;R++){if(si(o,A[R],A[R+1]))return u;(E=A[R])[1]>(v=o)[1]!=(T=A[R+1])[1]>v[1]&&v[0]<(T[0]-E[0])*(v[1]-E[1])/(T[1]-E[1])+E[0]&&(g=!g)}var v,E,T;return g}function qo(o,i){for(const u of i)if(Vo(o,u))return!0;return!1}function Cl(o,i){for(const u of o)if(!Vo(u,i))return!1;for(let u=0;u<o.length-1;++u)if(jo(o[u],o[u+1],i))return!1;return!0}function Go(o,i){for(const u of i)if(Cl(o,u))return!0;return!1}function lu(o,i,u,g){const v=g[0]-u[0],E=g[1]-u[1],T=(o[0]-u[0])*E-v*(o[1]-u[1]),A=(i[0]-u[0])*E-v*(i[1]-u[1]);return T>0&&A<0||T<0&&A>0}function ts(o,i,u){const g=[];for(let v=0;v<o.length;v++){const E=[];for(let T=0;T<o[v].length;T++){const A=bc(o[v][T],u);Lr(i,A),E.push(A)}g.push(E)}return g}function Ll(o,i,u){const g=[];for(let v=0;v<o.length;v++){const E=ts(o[v],i,u);g.push(E)}return g}function uu(o,i,u,g){if(o[0]<u[0]||o[0]>u[2]){const v=.5*g;let E=o[0]-u[0]>v?-g:u[0]-o[0]>v?g:0;E===0&&(E=o[0]-u[2]>v?-g:u[2]-o[0]>v?g:0),o[0]+=E}Lr(i,o)}function cu(o,i,u,g){const v=Math.pow(2,g.z)*vs,E=[g.x*vs,g.y*vs],T=[];for(const A of o)for(const R of A){const O=[R.x+E[0],R.y+E[1]];uu(O,i,u,v),T.push(O)}return T}function hu(o,i,u,g){const v=Math.pow(2,g.z)*vs,E=[g.x*vs,g.y*vs],T=[];for(const R of o){const O=[];for(const j of R){const G=[j.x+E[0],j.y+E[1]];Lr(i,G),O.push(G)}T.push(O)}if(i[2]-i[0]<=v/2){(A=i)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const R of T)for(const O of R)uu(O,i,u,v)}var A;return T}class ko{constructor(i,u){this.type=Tt,this.geojson=i,this.geometries=u}static parse(i,u){if(i.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Kr(i[1])){const g=i[1];if(g.type==="FeatureCollection"){const v=[];for(const E of g.features){const{type:T,coordinates:A}=E.geometry;T==="Polygon"&&v.push(A),T==="MultiPolygon"&&v.push(...A)}if(v.length)return new ko(g,{type:"MultiPolygon",coordinates:v})}else if(g.type==="Feature"){const v=g.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new ko(g,g.geometry)}else if(g.type==="Polygon"||g.type==="MultiPolygon")return new ko(g,g)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(u,g){const v=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],T=u.canonicalID();if(g.type==="Polygon"){const A=ts(g.coordinates,E,T),R=cu(u.geometry(),v,E,T);if(!bs(v,E))return!1;for(const O of R)if(!Vo(O,A))return!1}if(g.type==="MultiPolygon"){const A=Ll(g.coordinates,E,T),R=cu(u.geometry(),v,E,T);if(!bs(v,E))return!1;for(const O of R)if(!qo(O,A))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(u,g){const v=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],T=u.canonicalID();if(g.type==="Polygon"){const A=ts(g.coordinates,E,T),R=hu(u.geometry(),v,E,T);if(!bs(v,E))return!1;for(const O of R)if(!Cl(O,A))return!1}if(g.type==="MultiPolygon"){const A=Ll(g.coordinates,E,T),R=hu(u.geometry(),v,E,T);if(!bs(v,E))return!1;for(const O of R)if(!Go(O,A))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let fu=class{constructor(o=[],i=(u,g)=>u<g?-1:u>g?1:0){if(this.data=o,this.length=this.data.length,this.compare=i,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:i,compare:u}=this,g=i[o];for(;o>0;){const v=o-1>>1,E=i[v];if(u(g,E)>=0)break;i[o]=E,o=v}i[o]=g}_down(o){const{data:i,compare:u}=this,g=this.length>>1,v=i[o];for(;o<g;){let E=1+(o<<1);const T=E+1;if(T<this.length&&u(i[T],i[E])<0&&(E=T),u(i[E],v)>=0)break;i[o]=i[E],o=E}i[o]=v}};function xc(o,i,u,g,v){du(o,i,u,g||o.length-1,v||Hr)}function du(o,i,u,g,v){for(;g>u;){if(g-u>600){var E=g-u+1,T=i-u+1,A=Math.log(E),R=.5*Math.exp(2*A/3),O=.5*Math.sqrt(A*R*(E-R)/E)*(T-E/2<0?-1:1);du(o,i,Math.max(u,Math.floor(i-T*R/E+O)),Math.min(g,Math.floor(i+(E-T)*R/E+O)),v)}var j=o[i],G=u,X=g;for(xs(o,u,i),v(o[g],j)>0&&xs(o,u,g);G<X;){for(xs(o,G,X),G++,X--;v(o[G],j)<0;)G++;for(;v(o[X],j)>0;)X--}v(o[u],j)===0?xs(o,u,X):xs(o,++X,g),X<=i&&(u=X+1),i<=X&&(g=X-1)}}function xs(o,i,u){var g=o[i];o[i]=o[u],o[u]=g}function Hr(o,i){return o<i?-1:o>i?1:0}function ja(o,i){if(o.length<=1)return[o];const u=[];let g,v;for(const E of o){const T=wc(E);T!==0&&(E.area=Math.abs(T),v===void 0&&(v=T<0),v===T<0?(g&&u.push(g),g=[E]):g.push(E))}if(g&&u.push(g),i>1)for(let E=0;E<u.length;E++)u[E].length<=i||(xc(u[E],i,1,u[E].length-1,pu),u[E]=u[E].slice(0,i));return u}function pu(o,i){return i.area-o.area}function wc(o){let i=0;for(let u,g,v=0,E=o.length,T=E-1;v<E;T=v++)u=o[v],g=o[T],i+=(g.x-u.x)*(u.y+g.y);return i}const Va=1/298.257223563,Ml=Va*(2-Va),qa=Math.PI/180;class Ga{constructor(i){const u=6378.137*qa*1e3,g=Math.cos(i*qa),v=1/(1-Ml*(1-g*g)),E=Math.sqrt(v);this.kx=u*E*g,this.ky=u*E*v*(1-Ml)}distance(i,u){const g=this.wrap(i[0]-u[0])*this.kx,v=(i[1]-u[1])*this.ky;return Math.sqrt(g*g+v*v)}pointOnLine(i,u){let g,v,E,T,A=1/0;for(let R=0;R<i.length-1;R++){let O=i[R][0],j=i[R][1],G=this.wrap(i[R+1][0]-O)*this.kx,X=(i[R+1][1]-j)*this.ky,te=0;G===0&&X===0||(te=(this.wrap(u[0]-O)*this.kx*G+(u[1]-j)*this.ky*X)/(G*G+X*X),te>1?(O=i[R+1][0],j=i[R+1][1]):te>0&&(O+=G/this.kx*te,j+=X/this.ky*te)),G=this.wrap(u[0]-O)*this.kx,X=(u[1]-j)*this.ky;const se=G*G+X*X;se<A&&(A=se,g=O,v=j,E=R,T=te)}return{point:[g,v],index:E,t:Math.max(0,Math.min(1,T))}}wrap(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}}function ns(o,i){return i[0]-o[0]}function ya(o){return o[1]-o[0]+1}function Bi(o,i){return o[1]>=o[0]&&o[1]<i}function Io(o,i){if(o[0]>o[1])return[null,null];const u=ya(o);if(i){if(u===2)return[o,null];const v=Math.floor(u/2);return[[o[0],o[0]+v],[o[0]+v,o[1]]]}if(u===1)return[o,null];const g=Math.floor(u/2)-1;return[[o[0],o[0]+g],[o[0]+g+1,o[1]]]}function Al(o,i){if(!Bi(i,o.length))return[1/0,1/0,-1/0,-1/0];const u=[1/0,1/0,-1/0,-1/0];for(let g=i[0];g<=i[1];++g)Lr(u,o[g]);return u}function Za(o){const i=[1/0,1/0,-1/0,-1/0];for(const u of o)for(const g of u)Lr(i,g);return i}function va(o){return o[0]!==-1/0&&o[1]!==-1/0&&o[2]!==1/0&&o[3]!==1/0}function Ha(o,i,u){if(!va(o)||!va(i))return NaN;let g=0,v=0;return o[2]<i[0]&&(g=i[0]-o[2]),o[0]>i[2]&&(g=o[0]-i[2]),o[1]>i[3]&&(v=o[1]-i[3]),o[3]<i[1]&&(v=i[1]-o[3]),u.distance([0,0],[g,v])}function qs(o,i,u){const g=u.pointOnLine(i,o);return u.distance(o,g.point)}function Pl(o,i,u,g,v){const E=Math.min(qs(o,[u,g],v),qs(i,[u,g],v)),T=Math.min(qs(u,[o,i],v),qs(g,[o,i],v));return Math.min(E,T)}function kc(o,i,u,g,v){if(!Bi(i,o.length)||!Bi(g,u.length))return 1/0;let E=1/0;for(let T=i[0];T<i[1];++T){const A=o[T],R=o[T+1];for(let O=g[0];O<g[1];++O){const j=u[O],G=u[O+1];if(Mr(A,R,j,G))return 0;E=Math.min(E,Pl(A,R,j,G,v))}}return E}function Di(o,i,u,g,v){if(!Bi(i,o.length)||!Bi(g,u.length))return NaN;let E=1/0;for(let T=i[0];T<=i[1];++T)for(let A=g[0];A<=g[1];++A)if(E=Math.min(E,v.distance(o[T],u[A])),E===0)return E;return E}function Ic(o,i,u){if(Vo(o,i,!0))return 0;let g=1/0;for(const v of i){const E=v[0],T=v[v.length-1];if(E!==T&&(g=Math.min(g,qs(o,[T,E],u)),g===0))return g;const A=u.pointOnLine(v,o);if(g=Math.min(g,u.distance(o,A.point)),g===0)return g}return g}function Bn(o,i,u,g){if(!Bi(i,o.length))return NaN;for(let E=i[0];E<=i[1];++E)if(Vo(o[E],u,!0))return 0;let v=1/0;for(let E=i[0];E<i[1];++E){const T=o[E],A=o[E+1];for(const R of u)for(let O=0,j=R.length,G=j-1;O<j;G=O++){const X=R[G],te=R[O];if(Mr(T,A,X,te))return 0;v=Math.min(v,Pl(T,A,X,te,g))}}return v}function Wa(o,i){for(const u of o)for(const g of u)if(Vo(g,i,!0))return!0;return!1}function pi(o,i,u,g=1/0){const v=Za(o),E=Za(i);if(g!==1/0&&Ha(v,E,u)>=g)return g;if(bs(v,E)){if(Wa(o,i))return 0}else if(Wa(i,o))return 0;let T=1/0;for(const A of o)for(let R=0,O=A.length,j=O-1;R<O;j=R++){const G=A[j],X=A[R];for(const te of i)for(let se=0,de=te.length,Ce=de-1;se<de;Ce=se++){const Re=te[Ce],nt=te[se];if(Mr(G,X,Re,nt))return 0;T=Math.min(T,Pl(G,X,Re,nt,u))}}return T}function ci(o,i,u,g,v,E){if(!E)return;const T=Ha(Al(g,E),v,u);T<i&&o.push([T,E,[0,0]])}function oo(o,i,u,g,v,E,T){if(!E||!T)return;const A=Ha(Al(g,E),Al(v,T),u);A<i&&o.push([A,E,T])}function ba(o,i,u,g,v=1/0){let E=Math.min(g.distance(o[0],u[0][0]),v);if(E===0)return E;const T=new fu([[0,[0,o.length-1],[0,0]]],ns),A=Za(u);for(;T.length>0;){const R=T.pop();if(R[0]>=E)continue;const O=R[1],j=i?50:100;if(ya(O)<=j){if(!Bi(O,o.length))return NaN;if(i){const G=Bn(o,O,u,g);if(isNaN(G)||G===0)return G;E=Math.min(E,G)}else for(let G=O[0];G<=O[1];++G){const X=Ic(o[G],u,g);if(E=Math.min(E,X),E===0)return 0}}else{const G=Io(O,i);ci(T,E,g,o,A,G[0]),ci(T,E,g,o,A,G[1])}}return E}function Zo(o,i,u,g,v,E=1/0){let T=Math.min(E,v.distance(o[0],u[0]));if(T===0)return T;const A=new fu([[0,[0,o.length-1],[0,u.length-1]]],ns);for(;A.length>0;){const R=A.pop();if(R[0]>=T)continue;const O=R[1],j=R[2],G=i?50:100,X=g?50:100;if(ya(O)<=G&&ya(j)<=X){if(!Bi(O,o.length)&&Bi(j,u.length))return NaN;let te;if(i&&g)te=kc(o,O,u,j,v),T=Math.min(T,te);else if(i&&!g){const se=o.slice(O[0],O[1]+1);for(let de=j[0];de<=j[1];++de)if(te=qs(u[de],se,v),T=Math.min(T,te),T===0)return T}else if(!i&&g){const se=u.slice(j[0],j[1]+1);for(let de=O[0];de<=O[1];++de)if(te=qs(o[de],se,v),T=Math.min(T,te),T===0)return T}else te=Di(o,O,u,j,v),T=Math.min(T,te)}else{const te=Io(O,i),se=Io(j,g);oo(A,T,v,o,u,te[0],se[0]),oo(A,T,v,o,u,te[0],se[1]),oo(A,T,v,o,u,te[1],se[0]),oo(A,T,v,o,u,te[1],se[1])}}return T}function Rl(o){return o.type==="MultiPolygon"?o.coordinates.map(i=>({type:"Polygon",coordinates:i})):o.type==="MultiLineString"?o.coordinates.map(i=>({type:"LineString",coordinates:i})):o.type==="MultiPoint"?o.coordinates.map(i=>({type:"Point",coordinates:i})):[o]}class So{constructor(i,u){this.type=At,this.geojson=i,this.geometries=u}static parse(i,u){if(i.length!==2)return u.error(`'distance' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Kr(i[1])){const g=i[1];if(g.type==="FeatureCollection")return new So(g,g.features.map(v=>Rl(v.geometry)).flat());if(g.type==="Feature")return new So(g,Rl(g.geometry));if("type"in g&&"coordinates"in g)return new So(g,Rl(g))}return u.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(u,g){const v=u.geometry(),E=v.flat().map(R=>Ua([R.x,R.y],u.canonical));if(v.length===0)return NaN;const T=new Ga(E[0][1]);let A=1/0;for(const R of g){switch(R.type){case"Point":A=Math.min(A,Zo(E,!1,[R.coordinates],!1,T,A));break;case"LineString":A=Math.min(A,Zo(E,!1,R.coordinates,!0,T,A));break;case"Polygon":A=Math.min(A,ba(E,!1,R.coordinates,T,A))}if(A===0)return A}return A}(i,this.geometries);if(i.geometryType()==="LineString")return function(u,g){const v=u.geometry(),E=v.flat().map(R=>Ua([R.x,R.y],u.canonical));if(v.length===0)return NaN;const T=new Ga(E[0][1]);let A=1/0;for(const R of g){switch(R.type){case"Point":A=Math.min(A,Zo(E,!0,[R.coordinates],!1,T,A));break;case"LineString":A=Math.min(A,Zo(E,!0,R.coordinates,!0,T,A));break;case"Polygon":A=Math.min(A,ba(E,!0,R.coordinates,T,A))}if(A===0)return A}return A}(i,this.geometries);if(i.geometryType()==="Polygon")return function(u,g){const v=u.geometry();if(v.length===0||v[0].length===0)return NaN;const E=ja(v,0).map(R=>R.map(O=>O.map(j=>Ua([j.x,j.y],u.canonical)))),T=new Ga(E[0][0][0][1]);let A=1/0;for(const R of g)for(const O of E){switch(R.type){case"Point":A=Math.min(A,ba([R.coordinates],!1,O,T,A));break;case"LineString":A=Math.min(A,ba(R.coordinates,!0,O,T,A));break;case"Polygon":A=Math.min(A,pi(O,R.coordinates,T,A))}if(A===0)return A}return A}(i,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Ho={"==":ou,"!=":ri,">":Tl,"<":ys,">=":Bo,"<=":au,array:Qr,at:Sl,boolean:Qr,case:ha,coalesce:Fa,collator:Uo,format:ga,image:_a,in:El,"index-of":xo,interpolate:cr,"interpolate-hcl":cr,"interpolate-lab":cr,length:Ba,let:ro,literal:_s,match:wo,number:Qr,"number-format":hr,object:Qr,slice:fa,step:Oo,string:Qr,"to-boolean":Qi,"to-color":Qi,"to-number":Qi,"to-string":Qi,var:ei,within:ko,distance:So};class is{constructor(i,u,g,v){this.name=i,this.type=u,this._evaluate=g,this.args=v}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,u){const g=i[0],v=is.definitions[g];if(!v)return u.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0);const E=Array.isArray(v)?v[0]:v.type,T=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,A=T.filter(([O])=>!Array.isArray(O)||O.length===i.length-1);let R=null;for(const[O,j]of A){R=new es(u.registry,Wo,u.path,null,u.scope);const G=[];let X=!1;for(let te=1;te<i.length;te++){const se=i[te],de=Array.isArray(O)?O[te-1]:O.type,Ce=R.parse(se,1+G.length,de);if(!Ce){X=!0;break}G.push(Ce)}if(!X)if(Array.isArray(O)&&O.length!==G.length)R.error(`Expected ${O.length} arguments, but found ${G.length} instead.`);else{for(let te=0;te<G.length;te++){const se=Array.isArray(O)?O[te]:O.type,de=G[te];R.concat(te+1).checkSubtype(se,de.type)}if(R.errors.length===0)return new is(g,E,j,G)}}if(A.length===1)u.errors.push(...R.errors);else{const O=(A.length?A:T).map(([G])=>{return X=G,Array.isArray(X)?`(${X.map(J).join(", ")})`:`(${J(X.type)}...)`;var X}).join(" | "),j=[];for(let G=1;G<i.length;G++){const X=u.parse(i[G],1+j.length);if(!X)return null;j.push(J(X.type))}u.error(`Expected arguments of type ${O}, but found (${j.join(", ")}) instead.`)}return null}static register(i,u){is.definitions=u;for(const g in u)i[g]=is}}function Dl(o,[i,u,g,v]){i=i.evaluate(o),u=u.evaluate(o),g=g.evaluate(o);const E=v?v.evaluate(o):1,T=no(i,u,g,E);if(T)throw new Fi(T);return new Qn(i/255,u/255,g/255,E,!1)}function Nl(o,i){return o in i}function zl(o,i){const u=i[o];return u===void 0?null:u}function ao(o){return{type:o}}function Wo(o){if(o instanceof ei)return Wo(o.boundExpression);if(o instanceof is&&o.name==="error"||o instanceof Uo||o instanceof ko||o instanceof So)return!1;const i=o instanceof Qi||o instanceof Qr;let u=!0;return o.eachChild(g=>{u=i?u&&Wo(g):u&&g instanceof _s}),!!u&&Xo(o)&&Yo(o,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Xo(o){if(o instanceof is&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof ko||o instanceof So)return!1;let i=!0;return o.eachChild(u=>{i&&!Xo(u)&&(i=!1)}),i}function $o(o){if(o instanceof is&&o.name==="feature-state")return!1;let i=!0;return o.eachChild(u=>{i&&!$o(u)&&(i=!1)}),i}function Yo(o,i){if(o instanceof is&&i.indexOf(o.name)>=0)return!1;let u=!0;return o.eachChild(g=>{u&&!Yo(g,i)&&(u=!1)}),u}function Jo(o){return{result:"success",value:o}}function Ko(o){return{result:"error",value:o}}function Eo(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function Ol(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Fl(o){return!!o.expression&&o.expression.interpolated}function $n(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function Gs(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function Sc(o){return o}function Bl(o,i){const u=i.type==="color",g=o.stops&&typeof o.stops[0][0]=="object",v=g||!(g||o.property!==void 0),E=o.type||(Fl(i)?"exponential":"interval");if(u||i.type==="padding"){const j=u?Qn.parse:Dr.parse;(o=gr({},o)).stops&&(o.stops=o.stops.map(G=>[G[0],j(G[1])])),o.default=j(o.default?o.default:i.default)}if(o.colorSpace&&(T=o.colorSpace)!=="rgb"&&T!=="hcl"&&T!=="lab")throw new Error(`Unknown color space: "${o.colorSpace}"`);var T;let A,R,O;if(E==="exponential")A=c;else if(E==="interval")A=I;else if(E==="categorical"){A=ws,R=Object.create(null);for(const j of o.stops)R[j[0]]=j[1];O=typeof o.stops[0][0]}else{if(E!=="identity")throw new Error(`Unknown function type "${E}"`);A=d}if(g){const j={},G=[];for(let se=0;se<o.stops.length;se++){const de=o.stops[se],Ce=de[0].zoom;j[Ce]===void 0&&(j[Ce]={zoom:Ce,type:o.type,property:o.property,default:o.default,stops:[]},G.push(Ce)),j[Ce].stops.push([de[0].value,de[1]])}const X=[];for(const se of G)X.push([j[se].zoom,Bl(j[se],i)]);const te={name:"linear"};return{kind:"composite",interpolationType:te,interpolationFactor:cr.interpolationFactor.bind(void 0,te),zoomStops:X.map(se=>se[0]),evaluate:({zoom:se},de)=>c({stops:X,base:o.base},i,se).evaluate(se,de)}}if(v){const j=E==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:j,interpolationFactor:cr.interpolationFactor.bind(void 0,j),zoomStops:o.stops.map(G=>G[0]),evaluate:({zoom:G})=>A(o,i,G,R,O)}}return{kind:"source",evaluate(j,G){const X=G&&G.properties?G.properties[o.property]:void 0;return X===void 0?fr(o.default,i.default):A(o,i,X,R,O)}}}function fr(o,i,u){return o!==void 0?o:i!==void 0?i:u!==void 0?u:void 0}function ws(o,i,u,g,v){return fr(typeof u===v?g[u]:void 0,o.default,i.default)}function I(o,i,u){if($n(u)!=="number")return fr(o.default,i.default);const g=o.stops.length;if(g===1||u<=o.stops[0][0])return o.stops[0][1];if(u>=o.stops[g-1][0])return o.stops[g-1][1];const v=da(o.stops.map(E=>E[0]),u);return o.stops[v][1]}function c(o,i,u){const g=o.base!==void 0?o.base:1;if($n(u)!=="number")return fr(o.default,i.default);const v=o.stops.length;if(v===1||u<=o.stops[0][0])return o.stops[0][1];if(u>=o.stops[v-1][0])return o.stops[v-1][1];const E=da(o.stops.map(j=>j[0]),u),T=function(j,G,X,te){const se=te-X,de=j-X;return se===0?0:G===1?de/se:(Math.pow(G,de)-1)/(Math.pow(G,se)-1)}(u,g,o.stops[E][0],o.stops[E+1][0]),A=o.stops[E][1],R=o.stops[E+1][1],O=bi[i.type]||Sc;return typeof A.evaluate=="function"?{evaluate(...j){const G=A.evaluate.apply(void 0,j),X=R.evaluate.apply(void 0,j);if(G!==void 0&&X!==void 0)return O(G,X,T,o.colorSpace)}}:O(A,R,T,o.colorSpace)}function d(o,i,u){switch(i.type){case"color":u=Qn.parse(u);break;case"formatted":u=Cr.fromString(u.toString());break;case"resolvedImage":u=or.fromString(u.toString());break;case"padding":u=Dr.parse(u);break;default:$n(u)===i.type||i.type==="enum"&&i.values[u]||(u=void 0)}return fr(u,o.default,i.default)}is.register(Ho,{error:[{kind:"error"},[Ln],(o,[i])=>{throw new Fi(i.evaluate(o))}],typeof:[Ln,[wn],(o,[i])=>J(Ri(i.evaluate(o)))],"to-rgba":[K(At,4),[_r],(o,[i])=>{const[u,g,v,E]=i.evaluate(o).rgb;return[255*u,255*g,255*v,E]}],rgb:[_r,[At,At,At],Dl],rgba:[_r,[At,At,At,At],Dl],has:{type:Tt,overloads:[[[Ln],(o,[i])=>Nl(i.evaluate(o),o.properties())],[[Ln,Gr],(o,[i,u])=>Nl(i.evaluate(o),u.evaluate(o))]]},get:{type:wn,overloads:[[[Ln],(o,[i])=>zl(i.evaluate(o),o.properties())],[[Ln,Gr],(o,[i,u])=>zl(i.evaluate(o),u.evaluate(o))]]},"feature-state":[wn,[Ln],(o,[i])=>zl(i.evaluate(o),o.featureState||{})],properties:[Gr,[],o=>o.properties()],"geometry-type":[Ln,[],o=>o.geometryType()],id:[wn,[],o=>o.id()],zoom:[At,[],o=>o.globals.zoom],"heatmap-density":[At,[],o=>o.globals.heatmapDensity||0],"line-progress":[At,[],o=>o.globals.lineProgress||0],accumulated:[wn,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[At,ao(At),(o,i)=>{let u=0;for(const g of i)u+=g.evaluate(o);return u}],"*":[At,ao(At),(o,i)=>{let u=1;for(const g of i)u*=g.evaluate(o);return u}],"-":{type:At,overloads:[[[At,At],(o,[i,u])=>i.evaluate(o)-u.evaluate(o)],[[At],(o,[i])=>-i.evaluate(o)]]},"/":[At,[At,At],(o,[i,u])=>i.evaluate(o)/u.evaluate(o)],"%":[At,[At,At],(o,[i,u])=>i.evaluate(o)%u.evaluate(o)],ln2:[At,[],()=>Math.LN2],pi:[At,[],()=>Math.PI],e:[At,[],()=>Math.E],"^":[At,[At,At],(o,[i,u])=>Math.pow(i.evaluate(o),u.evaluate(o))],sqrt:[At,[At],(o,[i])=>Math.sqrt(i.evaluate(o))],log10:[At,[At],(o,[i])=>Math.log(i.evaluate(o))/Math.LN10],ln:[At,[At],(o,[i])=>Math.log(i.evaluate(o))],log2:[At,[At],(o,[i])=>Math.log(i.evaluate(o))/Math.LN2],sin:[At,[At],(o,[i])=>Math.sin(i.evaluate(o))],cos:[At,[At],(o,[i])=>Math.cos(i.evaluate(o))],tan:[At,[At],(o,[i])=>Math.tan(i.evaluate(o))],asin:[At,[At],(o,[i])=>Math.asin(i.evaluate(o))],acos:[At,[At],(o,[i])=>Math.acos(i.evaluate(o))],atan:[At,[At],(o,[i])=>Math.atan(i.evaluate(o))],min:[At,ao(At),(o,i)=>Math.min(...i.map(u=>u.evaluate(o)))],max:[At,ao(At),(o,i)=>Math.max(...i.map(u=>u.evaluate(o)))],abs:[At,[At],(o,[i])=>Math.abs(i.evaluate(o))],round:[At,[At],(o,[i])=>{const u=i.evaluate(o);return u<0?-Math.round(-u):Math.round(u)}],floor:[At,[At],(o,[i])=>Math.floor(i.evaluate(o))],ceil:[At,[At],(o,[i])=>Math.ceil(i.evaluate(o))],"filter-==":[Tt,[Ln,wn],(o,[i,u])=>o.properties()[i.value]===u.value],"filter-id-==":[Tt,[wn],(o,[i])=>o.id()===i.value],"filter-type-==":[Tt,[Ln],(o,[i])=>o.geometryType()===i.value],"filter-<":[Tt,[Ln,wn],(o,[i,u])=>{const g=o.properties()[i.value],v=u.value;return typeof g==typeof v&&g<v}],"filter-id-<":[Tt,[wn],(o,[i])=>{const u=o.id(),g=i.value;return typeof u==typeof g&&u<g}],"filter->":[Tt,[Ln,wn],(o,[i,u])=>{const g=o.properties()[i.value],v=u.value;return typeof g==typeof v&&g>v}],"filter-id->":[Tt,[wn],(o,[i])=>{const u=o.id(),g=i.value;return typeof u==typeof g&&u>g}],"filter-<=":[Tt,[Ln,wn],(o,[i,u])=>{const g=o.properties()[i.value],v=u.value;return typeof g==typeof v&&g<=v}],"filter-id-<=":[Tt,[wn],(o,[i])=>{const u=o.id(),g=i.value;return typeof u==typeof g&&u<=g}],"filter->=":[Tt,[Ln,wn],(o,[i,u])=>{const g=o.properties()[i.value],v=u.value;return typeof g==typeof v&&g>=v}],"filter-id->=":[Tt,[wn],(o,[i])=>{const u=o.id(),g=i.value;return typeof u==typeof g&&u>=g}],"filter-has":[Tt,[wn],(o,[i])=>i.value in o.properties()],"filter-has-id":[Tt,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Tt,[K(Ln)],(o,[i])=>i.value.indexOf(o.geometryType())>=0],"filter-id-in":[Tt,[K(wn)],(o,[i])=>i.value.indexOf(o.id())>=0],"filter-in-small":[Tt,[Ln,K(wn)],(o,[i,u])=>u.value.indexOf(o.properties()[i.value])>=0],"filter-in-large":[Tt,[Ln,K(wn)],(o,[i,u])=>function(g,v,E,T){for(;E<=T;){const A=E+T>>1;if(v[A]===g)return!0;v[A]>g?T=A-1:E=A+1}return!1}(o.properties()[i.value],u.value,0,u.value.length-1)],all:{type:Tt,overloads:[[[Tt,Tt],(o,[i,u])=>i.evaluate(o)&&u.evaluate(o)],[ao(Tt),(o,i)=>{for(const u of i)if(!u.evaluate(o))return!1;return!0}]]},any:{type:Tt,overloads:[[[Tt,Tt],(o,[i,u])=>i.evaluate(o)||u.evaluate(o)],[ao(Tt),(o,i)=>{for(const u of i)if(u.evaluate(o))return!0;return!1}]]},"!":[Tt,[Tt],(o,[i])=>!i.evaluate(o)],"is-supported-script":[Tt,[Ln],(o,[i])=>{const u=o.globals&&o.globals.isSupportedScript;return!u||u(i.evaluate(o))}],upcase:[Ln,[Ln],(o,[i])=>i.evaluate(o).toUpperCase()],downcase:[Ln,[Ln],(o,[i])=>i.evaluate(o).toLowerCase()],concat:[Ln,ao(wn),(o,i)=>i.map(u=>la(u.evaluate(o))).join("")],"resolved-locale":[Ln,[Mi],(o,[i])=>i.evaluate(o).resolvedLocale()]});class p{constructor(i,u){var g;this.expression=i,this._warningHistory={},this._evaluator=new ca,this._defaultValue=u?(g=u).type==="color"&&Gs(g.default)?new Qn(0,0,0,0):g.type==="color"?Qn.parse(g.default)||null:g.type==="padding"?Dr.parse(g.default)||null:g.type==="variableAnchorOffsetCollection"?Pi.parse(g.default)||null:g.default===void 0?null:g.default:null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(i,u,g,v,E,T){return this._evaluator.globals=i,this._evaluator.feature=u,this._evaluator.featureState=g,this._evaluator.canonical=v,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(i,u,g,v,E,T){this._evaluator.globals=i,this._evaluator.feature=u||null,this._evaluator.featureState=g||null,this._evaluator.canonical=v,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=T||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Fi(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(A.message)),this._defaultValue}}}function b(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Ho}function M(o,i){const u=new es(Ho,Wo,[],i?function(v){const E={color:_r,string:Ln,number:At,enum:Ln,boolean:Tt,formatted:Er,padding:Ki,resolvedImage:Zr,variableAnchorOffsetCollection:Ae};return v.type==="array"?K(E[v.value]||wn,v.length):E[v.type]}(i):void 0),g=u.parse(o,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?Jo(new p(g,i)):Ko(u.errors)}class F{constructor(i,u){this.kind=i,this._styleExpression=u,this.isStateDependent=i!=="constant"&&!$o(u.expression)}evaluateWithoutErrorHandling(i,u,g,v,E,T){return this._styleExpression.evaluateWithoutErrorHandling(i,u,g,v,E,T)}evaluate(i,u,g,v,E,T){return this._styleExpression.evaluate(i,u,g,v,E,T)}}class q{constructor(i,u,g,v){this.kind=i,this.zoomStops=g,this._styleExpression=u,this.isStateDependent=i!=="camera"&&!$o(u.expression),this.interpolationType=v}evaluateWithoutErrorHandling(i,u,g,v,E,T){return this._styleExpression.evaluateWithoutErrorHandling(i,u,g,v,E,T)}evaluate(i,u,g,v,E,T){return this._styleExpression.evaluate(i,u,g,v,E,T)}interpolationFactor(i,u,g){return this.interpolationType?cr.interpolationFactor(this.interpolationType,i,u,g):0}}function Y(o,i){const u=M(o,i);if(u.result==="error")return u;const g=u.value.expression,v=Xo(g);if(!v&&!Eo(i))return Ko([new kn("","data expressions not supported")]);const E=Yo(g,["zoom"]);if(!E&&!Ol(i))return Ko([new kn("","zoom expressions not supported")]);const T=Fe(g);return T||E?T instanceof kn?Ko([T]):T instanceof cr&&!Fl(i)?Ko([new kn("",'"interpolate" expressions cannot be used with this property')]):Jo(T?new q(v?"camera":"composite",u.value,T.labels,T instanceof cr?T.interpolation:void 0):new F(v?"constant":"source",u.value)):Ko([new kn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class me{constructor(i,u){this._parameters=i,this._specification=u,gr(this,Bl(this._parameters,this._specification))}static deserialize(i){return new me(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Fe(o){let i=null;if(o instanceof ro)i=Fe(o.result);else if(o instanceof Fa){for(const u of o.args)if(i=Fe(u),i)break}else(o instanceof Oo||o instanceof cr)&&o.input instanceof is&&o.input.name==="zoom"&&(i=o);return i instanceof kn||o.eachChild(u=>{const g=Fe(u);g instanceof kn?i=g:!i&&g?i=new kn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&g&&i!==g&&(i=new kn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function $e(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const i of o.slice(1))if(!$e(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const mt={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function zt(o){if(o==null)return{filter:()=>!0,needGeometry:!1};$e(o)||(o=bn(o));const i=M(o,mt);if(i.result==="error")throw new Error(i.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,g,v)=>i.value.evaluate(u,g,{},v),needGeometry:gn(o)}}function Nt(o,i){return o<i?-1:o>i?1:0}function gn(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let i=1;i<o.length;i++)if(gn(o[i]))return!0;return!1}function bn(o){if(!o)return!0;const i=o[0];return o.length<=1?i!=="any":i==="=="?Pn(o[1],o[2],"=="):i==="!="?li(Pn(o[1],o[2],"==")):i==="<"||i===">"||i==="<="||i===">="?Pn(o[1],o[2],i):i==="any"?(u=o.slice(1),["any"].concat(u.map(bn))):i==="all"?["all"].concat(o.slice(1).map(bn)):i==="none"?["all"].concat(o.slice(1).map(bn).map(li)):i==="in"?ti(o[1],o.slice(2)):i==="!in"?li(ti(o[1],o.slice(2))):i==="has"?mi(o[1]):i!=="!has"||li(mi(o[1]));var u}function Pn(o,i,u){switch(o){case"$type":return[`filter-type-${u}`,i];case"$id":return[`filter-id-${u}`,i];default:return[`filter-${u}`,o,i]}}function ti(o,i){if(i.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(u=>typeof u!=typeof i[0])?["filter-in-large",o,["literal",i.sort(Nt)]]:["filter-in-small",o,["literal",i]]}}function mi(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function li(o){return["!",o]}function er(o){const i=typeof o;if(i==="number"||i==="boolean"||i==="string"||o==null)return JSON.stringify(o);if(Array.isArray(o)){let v="[";for(const E of o)v+=`${er(E)},`;return`${v}]`}const u=Object.keys(o).sort();let g="{";for(let v=0;v<u.length;v++)g+=`${JSON.stringify(u[v])}:${er(o[u[v]])},`;return`${g}}`}function rs(o){let i="";for(const u of kt)i+=`/${er(o[u])}`;return i}function Ps(o){const i=o.value;return i?[new ct(o.key,i,"constants have been deprecated as of v8")]:[]}function fi(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Ar(o){if(Array.isArray(o))return o.map(Ar);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const i={};for(const u in o)i[u]=Ar(o[u]);return i}return fi(o)}function dr(o){const i=o.key,u=o.value,g=o.valueSpec||{},v=o.objectElementValidators||{},E=o.style,T=o.styleSpec,A=o.validateSpec;let R=[];const O=$n(u);if(O!=="object")return[new ct(i,u,`object expected, ${O} found`)];for(const j in u){const G=j.split(".")[0],X=g[G]||g["*"];let te;if(v[G])te=v[G];else if(g[G])te=A;else if(v["*"])te=v["*"];else{if(!g["*"]){R.push(new ct(i,u[j],`unknown property "${j}"`));continue}te=A}R=R.concat(te({key:(i&&`${i}.`)+j,value:u[j],valueSpec:X,style:E,styleSpec:T,object:u,objectKey:j,validateSpec:A},u))}for(const j in g)v[j]||g[j].required&&g[j].default===void 0&&u[j]===void 0&&R.push(new ct(i,u,`missing required property "${j}"`));return R}function Rs(o){const i=o.value,u=o.valueSpec,g=o.style,v=o.styleSpec,E=o.key,T=o.arrayElementValidator||o.validateSpec;if($n(i)!=="array")return[new ct(E,i,`array expected, ${$n(i)} found`)];if(u.length&&i.length!==u.length)return[new ct(E,i,`array length ${u.length} expected, length ${i.length} found`)];if(u["min-length"]&&i.length<u["min-length"])return[new ct(E,i,`array length at least ${u["min-length"]} expected, length ${i.length} found`)];let A={type:u.value,values:u.values};v.$version<7&&(A.function=u.function),$n(u.value)==="object"&&(A=u.value);let R=[];for(let O=0;O<i.length;O++)R=R.concat(T({array:i,arrayIndex:O,value:i[O],valueSpec:A,validateSpec:o.validateSpec,style:g,styleSpec:v,key:`${E}[${O}]`}));return R}function Xa(o){const i=o.key,u=o.value,g=o.valueSpec;let v=$n(u);return v==="number"&&u!=u&&(v="NaN"),v!=="number"?[new ct(i,u,`number expected, ${v} found`)]:"minimum"in g&&u<g.minimum?[new ct(i,u,`${u} is less than the minimum value ${g.minimum}`)]:"maximum"in g&&u>g.maximum?[new ct(i,u,`${u} is greater than the maximum value ${g.maximum}`)]:[]}function xa(o){const i=o.valueSpec,u=fi(o.value.type);let g,v,E,T={};const A=u!=="categorical"&&o.value.property===void 0,R=!A,O=$n(o.value.stops)==="array"&&$n(o.value.stops[0])==="array"&&$n(o.value.stops[0][0])==="object",j=dr({key:o.key,value:o.value,valueSpec:o.styleSpec.function,validateSpec:o.validateSpec,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(te){if(u==="identity")return[new ct(te.key,te.value,'identity function may not have a "stops" property')];let se=[];const de=te.value;return se=se.concat(Rs({key:te.key,value:de,valueSpec:te.valueSpec,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec,arrayElementValidator:G})),$n(de)==="array"&&de.length===0&&se.push(new ct(te.key,de,"array must have at least one stop")),se},default:function(te){return te.validateSpec({key:te.key,value:te.value,valueSpec:i,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec})}}});return u==="identity"&&A&&j.push(new ct(o.key,o.value,'missing required property "property"')),u==="identity"||o.value.stops||j.push(new ct(o.key,o.value,'missing required property "stops"')),u==="exponential"&&o.valueSpec.expression&&!Fl(o.valueSpec)&&j.push(new ct(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(R&&!Eo(o.valueSpec)?j.push(new ct(o.key,o.value,"property functions not supported")):A&&!Ol(o.valueSpec)&&j.push(new ct(o.key,o.value,"zoom functions not supported"))),u!=="categorical"&&!O||o.value.property!==void 0||j.push(new ct(o.key,o.value,'"property" property is required')),j;function G(te){let se=[];const de=te.value,Ce=te.key;if($n(de)!=="array")return[new ct(Ce,de,`array expected, ${$n(de)} found`)];if(de.length!==2)return[new ct(Ce,de,`array length 2 expected, length ${de.length} found`)];if(O){if($n(de[0])!=="object")return[new ct(Ce,de,`object expected, ${$n(de[0])} found`)];if(de[0].zoom===void 0)return[new ct(Ce,de,"object stop key must have zoom")];if(de[0].value===void 0)return[new ct(Ce,de,"object stop key must have value")];if(E&&E>fi(de[0].zoom))return[new ct(Ce,de[0].zoom,"stop zoom values must appear in ascending order")];fi(de[0].zoom)!==E&&(E=fi(de[0].zoom),v=void 0,T={}),se=se.concat(dr({key:`${Ce}[0]`,value:de[0],valueSpec:{zoom:{}},validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec,objectElementValidators:{zoom:Xa,value:X}}))}else se=se.concat(X({key:`${Ce}[0]`,value:de[0],valueSpec:{},validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec},de));return b(Ar(de[1]))?se.concat([new ct(`${Ce}[1]`,de[1],"expressions are not allowed in function stops.")]):se.concat(te.validateSpec({key:`${Ce}[1]`,value:de[1],valueSpec:i,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec}))}function X(te,se){const de=$n(te.value),Ce=fi(te.value),Re=te.value!==null?te.value:se;if(g){if(de!==g)return[new ct(te.key,Re,`${de} stop domain type must match previous stop domain type ${g}`)]}else g=de;if(de!=="number"&&de!=="string"&&de!=="boolean")return[new ct(te.key,Re,"stop domain value must be a number, string, or boolean")];if(de!=="number"&&u!=="categorical"){let nt=`number expected, ${de} found`;return Eo(i)&&u===void 0&&(nt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ct(te.key,Re,nt)]}return u!=="categorical"||de!=="number"||isFinite(Ce)&&Math.floor(Ce)===Ce?u!=="categorical"&&de==="number"&&v!==void 0&&Ce<v?[new ct(te.key,Re,"stop domain values must appear in ascending order")]:(v=Ce,u==="categorical"&&Ce in T?[new ct(te.key,Re,"stop domain values must be unique")]:(T[Ce]=!0,[])):[new ct(te.key,Re,`integer expected, found ${Ce}`)]}}function lo(o){const i=(o.expressionContext==="property"?Y:M)(Ar(o.value),o.valueSpec);if(i.result==="error")return i.value.map(g=>new ct(`${o.key}${g.key}`,o.value,g.message));const u=i.value.expression||i.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!u.outputDefined())return[new ct(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!$o(u))return[new ct(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!$o(u))return[new ct(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!Yo(u,["zoom","feature-state"]))return[new ct(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!Xo(u))return[new ct(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ks(o){const i=o.key,u=o.value,g=o.valueSpec,v=[];return Array.isArray(g.values)?g.values.indexOf(fi(u))===-1&&v.push(new ct(i,u,`expected one of [${g.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(g.values).indexOf(fi(u))===-1&&v.push(new ct(i,u,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(u)} found`)),v}function Ec(o){return $e(Ar(o.value))?lo(gr({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):mu(o)}function mu(o){const i=o.value,u=o.key;if($n(i)!=="array")return[new ct(u,i,`array expected, ${$n(i)} found`)];const g=o.styleSpec;let v,E=[];if(i.length<1)return[new ct(u,i,"filter array must have at least 1 element")];switch(E=E.concat(ks({key:`${u}[0]`,value:i[0],valueSpec:g.filter_operator,style:o.style,styleSpec:o.styleSpec})),fi(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&fi(i[1])==="$type"&&E.push(new ct(u,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&E.push(new ct(u,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(v=$n(i[1]),v!=="string"&&E.push(new ct(`${u}[1]`,i[1],`string expected, ${v} found`)));for(let T=2;T<i.length;T++)v=$n(i[T]),fi(i[1])==="$type"?E=E.concat(ks({key:`${u}[${T}]`,value:i[T],valueSpec:g.geometry_type,style:o.style,styleSpec:o.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&E.push(new ct(`${u}[${T}]`,i[T],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let T=1;T<i.length;T++)E=E.concat(mu({key:`${u}[${T}]`,value:i[T],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":v=$n(i[1]),i.length!==2?E.push(new ct(u,i,`filter array for "${i[0]}" operator must have 2 elements`)):v!=="string"&&E.push(new ct(`${u}[1]`,i[1],`string expected, ${v} found`))}return E}function Tc(o,i){const u=o.key,g=o.validateSpec,v=o.style,E=o.styleSpec,T=o.value,A=o.objectKey,R=E[`${i}_${o.layerType}`];if(!R)return[];const O=A.match(/^(.*)-transition$/);if(i==="paint"&&O&&R[O[1]]&&R[O[1]].transition)return g({key:u,value:T,valueSpec:E.transition,style:v,styleSpec:E});const j=o.valueSpec||R[A];if(!j)return[new ct(u,T,`unknown property "${A}"`)];let G;if($n(T)==="string"&&Eo(j)&&!j.tokens&&(G=/^{([^}]+)}$/.exec(T)))return[new ct(u,T,`"${A}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(G[1])} }\`.`)];const X=[];return o.layerType==="symbol"&&(A==="text-field"&&v&&!v.glyphs&&X.push(new ct(u,T,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&Gs(Ar(T))&&fi(T.type)==="identity"&&X.push(new ct(u,T,'"text-font" does not support identity functions'))),X.concat(g({key:o.key,value:T,valueSpec:j,style:v,styleSpec:E,expressionContext:"property",propertyType:i,propertyKey:A}))}function gu(o){return Tc(o,"paint")}function Cc(o){return Tc(o,"layout")}function Lc(o){let i=[];const u=o.value,g=o.key,v=o.style,E=o.styleSpec;u.type||u.ref||i.push(new ct(g,u,'either "type" or "ref" is required'));let T=fi(u.type);const A=fi(u.ref);if(u.id){const R=fi(u.id);for(let O=0;O<o.arrayIndex;O++){const j=v.layers[O];fi(j.id)===R&&i.push(new ct(g,u.id,`duplicate layer id "${u.id}", previously used at line ${j.id.__line__}`))}}if("ref"in u){let R;["type","source","source-layer","filter","layout"].forEach(O=>{O in u&&i.push(new ct(g,u[O],`"${O}" is prohibited for ref layers`))}),v.layers.forEach(O=>{fi(O.id)===A&&(R=O)}),R?R.ref?i.push(new ct(g,u.ref,"ref cannot reference another ref layer")):T=fi(R.type):i.push(new ct(g,u.ref,`ref layer "${A}" not found`))}else if(T!=="background")if(u.source){const R=v.sources&&v.sources[u.source],O=R&&fi(R.type);R?O==="vector"&&T==="raster"?i.push(new ct(g,u.source,`layer "${u.id}" requires a raster source`)):O!=="raster-dem"&&T==="hillshade"?i.push(new ct(g,u.source,`layer "${u.id}" requires a raster-dem source`)):O==="raster"&&T!=="raster"?i.push(new ct(g,u.source,`layer "${u.id}" requires a vector source`)):O!=="vector"||u["source-layer"]?O==="raster-dem"&&T!=="hillshade"?i.push(new ct(g,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):T!=="line"||!u.paint||!u.paint["line-gradient"]||O==="geojson"&&R.lineMetrics||i.push(new ct(g,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new ct(g,u,`layer "${u.id}" must specify a "source-layer"`)):i.push(new ct(g,u.source,`source "${u.source}" not found`))}else i.push(new ct(g,u,'missing required property "source"'));return i=i.concat(dr({key:g,value:u,valueSpec:E.layer,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,objectElementValidators:{"*":()=>[],type:()=>o.validateSpec({key:`${g}.type`,value:u.type,valueSpec:E.layer.type,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,object:u,objectKey:"type"}),filter:Ec,layout:R=>dr({layer:u,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":O=>Cc(gr({layerType:T},O))}}),paint:R=>dr({layer:u,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":O=>gu(gr({layerType:T},O))}})}})),i}function wa(o){const i=o.value,u=o.key,g=$n(i);return g!=="string"?[new ct(u,i,`string expected, ${g} found`)]:[]}const _u={promoteId:function({key:o,value:i}){if($n(i)==="string")return wa({key:o,value:i});{const u=[];for(const g in i)u.push(...wa({key:`${o}.${g}`,value:i[g]}));return u}}};function Ul(o){const i=o.value,u=o.key,g=o.styleSpec,v=o.style,E=o.validateSpec;if(!i.type)return[new ct(u,i,'"type" is required')];const T=fi(i.type);let A;switch(T){case"vector":case"raster":return A=dr({key:u,value:i,valueSpec:g[`source_${T.replace("-","_")}`],style:o.style,styleSpec:g,objectElementValidators:_u,validateSpec:E}),A;case"raster-dem":return A=function(R){var O;const j=(O=R.sourceName)!==null&&O!==void 0?O:"",G=R.value,X=R.styleSpec,te=X.source_raster_dem,se=R.style;let de=[];const Ce=$n(G);if(G===void 0)return de;if(Ce!=="object")return de.push(new ct("source_raster_dem",G,`object expected, ${Ce} found`)),de;const Re=fi(G.encoding)==="custom",nt=["redFactor","greenFactor","blueFactor","baseShift"],Ge=R.value.encoding?`"${R.value.encoding}"`:"Default";for(const Qe in G)!Re&&nt.includes(Qe)?de.push(new ct(Qe,G[Qe],`In "${j}": "${Qe}" is only valid when "encoding" is set to "custom". ${Ge} encoding found`)):te[Qe]?de=de.concat(R.validateSpec({key:Qe,value:G[Qe],valueSpec:te[Qe],validateSpec:R.validateSpec,style:se,styleSpec:X})):de.push(new ct(Qe,G[Qe],`unknown property "${Qe}"`));return de}({sourceName:u,value:i,style:o.style,styleSpec:g,validateSpec:E}),A;case"geojson":if(A=dr({key:u,value:i,valueSpec:g.source_geojson,style:v,styleSpec:g,validateSpec:E,objectElementValidators:_u}),i.cluster)for(const R in i.clusterProperties){const[O,j]=i.clusterProperties[R],G=typeof O=="string"?[O,["accumulated"],["get",R]]:O;A.push(...lo({key:`${u}.${R}.map`,value:j,validateSpec:E,expressionContext:"cluster-map"})),A.push(...lo({key:`${u}.${R}.reduce`,value:G,validateSpec:E,expressionContext:"cluster-reduce"}))}return A;case"video":return dr({key:u,value:i,valueSpec:g.source_video,style:v,validateSpec:E,styleSpec:g});case"image":return dr({key:u,value:i,valueSpec:g.source_image,style:v,validateSpec:E,styleSpec:g});case"canvas":return[new ct(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ks({key:`${u}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,validateSpec:E,styleSpec:g})}}function Mc(o){const i=o.value,u=o.styleSpec,g=u.light,v=o.style;let E=[];const T=$n(i);if(i===void 0)return E;if(T!=="object")return E=E.concat([new ct("light",i,`object expected, ${T} found`)]),E;for(const A in i){const R=A.match(/^(.*)-transition$/);E=E.concat(R&&g[R[1]]&&g[R[1]].transition?o.validateSpec({key:A,value:i[A],valueSpec:u.transition,validateSpec:o.validateSpec,style:v,styleSpec:u}):g[A]?o.validateSpec({key:A,value:i[A],valueSpec:g[A],validateSpec:o.validateSpec,style:v,styleSpec:u}):[new ct(A,i[A],`unknown property "${A}"`)])}return E}function Ac(o){const i=o.value,u=o.styleSpec,g=u.sky,v=o.style,E=$n(i);if(i===void 0)return[];if(E!=="object")return[new ct("sky",i,`object expected, ${E} found`)];let T=[];for(const A in i)T=T.concat(g[A]?o.validateSpec({key:A,value:i[A],valueSpec:g[A],style:v,styleSpec:u}):[new ct(A,i[A],`unknown property "${A}"`)]);return T}function Pc(o){const i=o.value,u=o.styleSpec,g=u.terrain,v=o.style;let E=[];const T=$n(i);if(i===void 0)return E;if(T!=="object")return E=E.concat([new ct("terrain",i,`object expected, ${T} found`)]),E;for(const A in i)E=E.concat(g[A]?o.validateSpec({key:A,value:i[A],valueSpec:g[A],validateSpec:o.validateSpec,style:v,styleSpec:u}):[new ct(A,i[A],`unknown property "${A}"`)]);return E}function Rc(o){let i=[];const u=o.value,g=o.key;if(Array.isArray(u)){const v=[],E=[];for(const T in u)u[T].id&&v.includes(u[T].id)&&i.push(new ct(g,u,`all the sprites' ids must be unique, but ${u[T].id} is duplicated`)),v.push(u[T].id),u[T].url&&E.includes(u[T].url)&&i.push(new ct(g,u,`all the sprites' URLs must be unique, but ${u[T].url} is duplicated`)),E.push(u[T].url),i=i.concat(dr({key:`${g}[${T}]`,value:u[T],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:o.validateSpec}));return i}return wa({key:g,value:u})}const yu={"*":()=>[],array:Rs,boolean:function(o){const i=o.value,u=o.key,g=$n(i);return g!=="boolean"?[new ct(u,i,`boolean expected, ${g} found`)]:[]},number:Xa,color:function(o){const i=o.key,u=o.value,g=$n(u);return g!=="string"?[new ct(i,u,`color expected, ${g} found`)]:Qn.parse(String(u))?[]:[new ct(i,u,`color expected, "${u}" found`)]},constants:Ps,enum:ks,filter:Ec,function:xa,layer:Lc,object:dr,source:Ul,light:Mc,sky:Ac,terrain:Pc,projection:function(o){const i=o.value,u=o.styleSpec,g=u.projection,v=o.style,E=$n(i);if(i===void 0)return[];if(E!=="object")return[new ct("projection",i,`object expected, ${E} found`)];let T=[];for(const A in i)T=T.concat(g[A]?o.validateSpec({key:A,value:i[A],valueSpec:g[A],style:v,styleSpec:u}):[new ct(A,i[A],`unknown property "${A}"`)]);return T},string:wa,formatted:function(o){return wa(o).length===0?[]:lo(o)},resolvedImage:function(o){return wa(o).length===0?[]:lo(o)},padding:function(o){const i=o.key,u=o.value;if($n(u)==="array"){if(u.length<1||u.length>4)return[new ct(i,u,`padding requires 1 to 4 values; ${u.length} values found`)];const g={type:"number"};let v=[];for(let E=0;E<u.length;E++)v=v.concat(o.validateSpec({key:`${i}[${E}]`,value:u[E],validateSpec:o.validateSpec,valueSpec:g}));return v}return Xa({key:i,value:u,valueSpec:{}})},variableAnchorOffsetCollection:function(o){const i=o.key,u=o.value,g=$n(u),v=o.styleSpec;if(g!=="array"||u.length<1||u.length%2!=0)return[new ct(i,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let E=[];for(let T=0;T<u.length;T+=2)E=E.concat(ks({key:`${i}[${T}]`,value:u[T],valueSpec:v.layout_symbol["text-anchor"]})),E=E.concat(Rs({key:`${i}[${T+1}]`,value:u[T+1],valueSpec:{length:2,value:"number"},validateSpec:o.validateSpec,style:o.style,styleSpec:v}));return E},sprite:Rc};function $a(o){const i=o.value,u=o.valueSpec,g=o.styleSpec;return o.validateSpec=$a,u.expression&&Gs(fi(i))?xa(o):u.expression&&b(Ar(i))?lo(o):u.type&&yu[u.type]?yu[u.type](o):dr(gr({},o,{valueSpec:u.type?g[u.type]:u}))}function Bh(o){const i=o.value,u=o.key,g=wa(o);return g.length||(i.indexOf("{fontstack}")===-1&&g.push(new ct(u,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&g.push(new ct(u,i,'"glyphs" url must include a "{range}" token'))),g}function Ds(o,i=Ye){let u=[];return u=u.concat($a({key:"",value:o,valueSpec:i.$root,styleSpec:i,style:o,validateSpec:$a,objectElementValidators:{glyphs:Bh,"*":()=>[]}})),o.constants&&(u=u.concat(Ps({key:"constants",value:o.constants,style:o,styleSpec:i,validateSpec:$a}))),Dc(u)}function uo(o){return function(i){return o({...i,validateSpec:$a})}}function Dc(o){return[].concat(o).sort((i,u)=>i.line-u.line)}function Zs(o){return function(...i){return Dc(o.apply(this,i))}}Ds.source=Zs(uo(Ul)),Ds.sprite=Zs(uo(Rc)),Ds.glyphs=Zs(uo(Bh)),Ds.light=Zs(uo(Mc)),Ds.sky=Zs(uo(Ac)),Ds.terrain=Zs(uo(Pc)),Ds.layer=Zs(uo(Lc)),Ds.filter=Zs(uo(Ec)),Ds.paintProperty=Zs(uo(gu)),Ds.layoutProperty=Zs(uo(Cc));const ka=Ds,od=ka.light,ad=ka.sky,Uh=ka.paintProperty,jh=ka.layoutProperty;function Nc(o,i){let u=!1;if(i&&i.length)for(const g of i)o.fire(new Je(new Error(g.message))),u=!0;return u}class Ya{constructor(i,u,g){const v=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const T=new Int32Array(this.arrayBuffer);i=T[0],this.d=(u=T[1])+2*(g=T[2]);for(let R=0;R<this.d*this.d;R++){const O=T[3+R],j=T[3+R+1];v.push(O===j?null:T.subarray(O,j))}const A=T[3+v.length+1];this.keys=T.subarray(T[3+v.length],A),this.bboxes=T.subarray(A),this.insert=this._insertReadonly}else{this.d=u+2*g;for(let T=0;T<this.d*this.d;T++)v.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=i,this.padding=g,this.scale=u/i,this.uid=0;const E=g/u*i;this.min=-E,this.max=i+E}insert(i,u,g,v,E){this._forEachCell(u,g,v,E,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(E)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,u,g,v,E,T){this.cells[E].push(T)}query(i,u,g,v,E){const T=this.min,A=this.max;if(i<=T&&u<=T&&A<=g&&A<=v&&!E)return Array.prototype.slice.call(this.keys);{const R=[];return this._forEachCell(i,u,g,v,this._queryCell,R,{},E),R}}_queryCell(i,u,g,v,E,T,A,R){const O=this.cells[E];if(O!==null){const j=this.keys,G=this.bboxes;for(let X=0;X<O.length;X++){const te=O[X];if(A[te]===void 0){const se=4*te;(R?R(G[se+0],G[se+1],G[se+2],G[se+3]):i<=G[se+2]&&u<=G[se+3]&&g>=G[se+0]&&v>=G[se+1])?(A[te]=!0,T.push(j[te])):A[te]=!1}}}}_forEachCell(i,u,g,v,E,T,A,R){const O=this._convertToCellCoord(i),j=this._convertToCellCoord(u),G=this._convertToCellCoord(g),X=this._convertToCellCoord(v);for(let te=O;te<=G;te++)for(let se=j;se<=X;se++){const de=this.d*se+te;if((!R||R(this._convertFromCellCoord(te),this._convertFromCellCoord(se),this._convertFromCellCoord(te+1),this._convertFromCellCoord(se+1)))&&E.call(this,i,u,g,v,de,T,A,R))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,u=3+this.cells.length+1+1;let g=0;for(let T=0;T<this.cells.length;T++)g+=this.cells[T].length;const v=new Int32Array(u+g+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;let E=u;for(let T=0;T<i.length;T++){const A=i[T];v[3+T]=E,v.set(A,E),E+=A.length}return v[3+i.length]=E,v.set(this.keys,E),E+=this.keys.length,v[3+i.length+1]=E,v.set(this.bboxes,E),E+=this.bboxes.length,v.buffer}static serialize(i,u){const g=i.toArrayBuffer();return u&&u.push(g),{buffer:g}}static deserialize(i){return new Ya(i.buffer)}}const Ns={};function Qt(o,i,u={}){if(Ns[o])throw new Error(`${o} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:o,writeable:!1}),Ns[o]={klass:i,omit:u.omit||[],shallow:u.shallow||[]}}Qt("Object",Object),Qt("TransferableGridIndex",Ya),Qt("Color",Qn),Qt("Error",Error),Qt("AJAXError",Rn),Qt("ResolvedImage",or),Qt("StylePropertyFunction",me),Qt("StyleExpression",p,{omit:["_evaluator"]}),Qt("ZoomDependentExpression",q),Qt("ZoomConstantExpression",F),Qt("CompoundExpression",is,{omit:["_evaluate"]});for(const o in Ho)Ho[o]._classRegistryKey||Qt(`Expression_${o}`,Ho[o]);function vu(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function zc(o){return o.$name||o.constructor._classRegistryKey}function Vh(o){return!function(i){if(i===null||typeof i!="object")return!1;const u=zc(i);return!(!u||u==="Object")}(o)&&(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob||o instanceof Error||vu(o)||dt(o)||ArrayBuffer.isView(o)||o instanceof ImageData)}function Ja(o,i){if(Vh(o))return(vu(o)||dt(o))&&i&&i.push(o),ArrayBuffer.isView(o)&&i&&i.push(o.buffer),o instanceof ImageData&&i&&i.push(o.data.buffer),o;if(Array.isArray(o)){const E=[];for(const T of o)E.push(Ja(T,i));return E}if(typeof o!="object")throw new Error("can't serialize object of type "+typeof o);const u=zc(o);if(!u)throw new Error(`can't serialize object of unregistered class ${o.constructor.name}`);if(!Ns[u])throw new Error(`${u} is not registered.`);const{klass:g}=Ns[u],v=g.serialize?g.serialize(o,i):{};if(g.serialize){if(i&&v===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const E in o){if(!o.hasOwnProperty(E)||Ns[u].omit.indexOf(E)>=0)continue;const T=o[E];v[E]=Ns[u].shallow.indexOf(E)>=0?T:Ja(T,i)}o instanceof Error&&(v.message=o.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(v.$name=u),v}function Ka(o){if(Vh(o))return o;if(Array.isArray(o))return o.map(Ka);if(typeof o!="object")throw new Error("can't deserialize object of type "+typeof o);const i=zc(o)||"Object";if(!Ns[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:u}=Ns[i];if(!u)throw new Error(`can't deserialize unregistered class ${i}`);if(u.deserialize)return u.deserialize(o);const g=Object.create(u.prototype);for(const v of Object.keys(o)){if(v==="$name")continue;const E=o[v];g[v]=Ns[i].shallow.indexOf(v)>=0?E:Ka(E)}return g}class Oc{constructor(){this.first=!0}update(i,u){const g=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=g,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=g,!0):(this.lastFloorZoom>g?(this.lastIntegerZoom=g+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<g&&(this.lastIntegerZoom=g,this.lastIntegerZoomTime=u),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=g,!0))}}const qn={"Latin-1 Supplement":o=>o>=128&&o<=255,"Hangul Jamo":o=>o>=4352&&o<=4607,Khmer:o=>o>=6016&&o<=6143,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Katakana:o=>o>=12448&&o<=12543,Kanbun:o=>o>=12688&&o<=12703,"CJK Strokes":o=>o>=12736&&o<=12783,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"Private Use Area":o=>o>=57344&&o<=63743,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function Fc(o){for(const i of o)if(Uc(i.charCodeAt(0)))return!0;return!1}function ld(o){for(const i of o)if(!Qa(i.charCodeAt(0)))return!1;return!0}function Bc(o){const i=o.map(u=>{try{return new RegExp(`\\p{sc=${u}}`,"u").source}catch{return null}}).filter(u=>u);return new RegExp(i.join("|"),"u")}const ud=Bc(["Arab","Dupl","Mong","Ougr","Syrc"]);function Qa(o){return!ud.test(String.fromCodePoint(o))}const qh=Bc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Uc(o){return!(o!==746&&o!==747&&(o<4352||!(qn["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||qn["CJK Compatibility"](o)||qn["CJK Strokes"](o)||!(!qn["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||qn["Enclosed CJK Letters and Months"](o)||qn["Ideographic Description Characters"](o)||qn.Kanbun(o)||qn.Katakana(o)&&o!==12540||!(!qn["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!qn["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||qn["Vertical Forms"](o)||qn["Yijing Hexagram Symbols"](o)||/\p{sc=Cans}/u.test(String.fromCodePoint(o))||/\p{sc=Hang}/u.test(String.fromCodePoint(o))||qh.test(String.fromCodePoint(o)))))}function Gh(o){return!(Uc(o)||function(i){return!!(qn["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||qn["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||qn["Letterlike Symbols"](i)||qn["Number Forms"](i)||qn["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||qn["Control Pictures"](i)&&i!==9251||qn["Optical Character Recognition"](i)||qn["Enclosed Alphanumerics"](i)||qn["Geometric Shapes"](i)||qn["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||qn["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||qn["CJK Symbols and Punctuation"](i)||qn.Katakana(i)||qn["Private Use Area"](i)||qn["CJK Compatibility Forms"](i)||qn["Small Form Variants"](i)||qn["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(o))}const cd=Bc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function jc(o){return cd.test(String.fromCodePoint(o))}function hd(o,i){return!(!i&&jc(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||qn.Khmer(o))}function fd(o){for(const i of o)if(jc(i.charCodeAt(0)))return!0;return!1}const Is=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(o){this.pluginStatus=o.pluginStatus,this.pluginURL=o.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(o){this.applyArabicShaping=o.applyArabicShaping,this.processBidirectionalText=o.processBidirectionalText,this.processStyledBidirectionalText=o.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ii{constructor(i,u){this.zoom=i,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Oc,this.transition={})}isSupportedScript(i){return function(u,g){for(const v of u)if(!hd(v.charCodeAt(0),g))return!1;return!0}(i,Is.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,u=i-Math.floor(i),g=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*g}:{fromScale:.5,toScale:1,t:1-(1-g)*u}}}class el{constructor(i,u){this.property=i,this.value=u,this.expression=function(g,v){if(Gs(g))return new me(g,v);if(b(g)){const E=Y(g,v);if(E.result==="error")throw new Error(E.value.map(T=>`${T.key}: ${T.message}`).join(", "));return E.value}{let E=g;return v.type==="color"&&typeof g=="string"?E=Qn.parse(g):v.type!=="padding"||typeof g!="number"&&!Array.isArray(g)?v.type==="variableAnchorOffsetCollection"&&Array.isArray(g)&&(E=Pi.parse(g)):E=Dr.parse(g),{kind:"constant",evaluate:()=>E}}}(u===void 0?i.specification.default:u,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,u,g){return this.property.possiblyEvaluate(this,i,u,g)}}class bu{constructor(i){this.property=i,this.value=new el(i,void 0)}transitioned(i,u){return new Zh(this.property,this.value,u,he({},i.transition,this.transition),i.now)}untransitioned(){return new Zh(this.property,this.value,null,{},0)}}class xu{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return we(this._values[i].value.value)}setValue(i,u){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new bu(this._values[i].property)),this._values[i].value=new el(this._values[i].property,u===null?void 0:we(u))}getTransition(i){return we(this._values[i].transition)}setTransition(i,u){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new bu(this._values[i].property)),this._values[i].transition=we(u)||void 0}serialize(){const i={};for(const u of Object.keys(this._values)){const g=this.getValue(u);g!==void 0&&(i[u]=g);const v=this.getTransition(u);v!==void 0&&(i[`${u}-transition`]=v)}return i}transitioned(i,u){const g=new jl(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].transitioned(i,u._values[v]);return g}untransitioned(){const i=new jl(this._properties);for(const u of Object.keys(this._values))i._values[u]=this._values[u].untransitioned();return i}}class Zh{constructor(i,u,g,v,E){this.property=i,this.value=u,this.begin=E+v.delay||0,this.end=this.begin+v.duration||0,i.specification.transition&&(v.delay||v.duration)&&(this.prior=g)}possiblyEvaluate(i,u,g){const v=i.now||0,E=this.value.possiblyEvaluate(i,u,g),T=this.prior;if(T){if(v>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(v<this.begin)return T.possiblyEvaluate(i,u,g);{const A=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(i,u,g),E,function(R){if(R<=0)return 0;if(R>=1)return 1;const O=R*R,j=O*R;return 4*(R<.5?j:3*(R-O)+j-.75)}(A))}}return E}}class jl{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,u,g){const v=new ql(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].possiblyEvaluate(i,u,g);return v}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Vl{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return we(this._values[i].value)}setValue(i,u){this._values[i]=new el(this._values[i].property,u===null?void 0:we(u))}serialize(){const i={};for(const u of Object.keys(this._values)){const g=this.getValue(u);g!==void 0&&(i[u]=g)}return i}possiblyEvaluate(i,u,g){const v=new ql(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].possiblyEvaluate(i,u,g);return v}}class co{constructor(i,u,g){this.property=i,this.value=u,this.parameters=g}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,u,g,v){return this.property.evaluate(this.value,this.parameters,i,u,g,v)}}class ql{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class nn{constructor(i){this.specification=i}possiblyEvaluate(i,u){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(u)}interpolate(i,u,g){const v=bi[this.specification.type];return v?v(i,u,g):i}}class vn{constructor(i,u){this.specification=i,this.overrides=u}possiblyEvaluate(i,u,g,v){return new co(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(u,null,{},g,v)}:i.expression,u)}interpolate(i,u,g){if(i.value.kind!=="constant"||u.value.kind!=="constant")return i;if(i.value.value===void 0||u.value.value===void 0)return new co(this,{kind:"constant",value:void 0},i.parameters);const v=bi[this.specification.type];if(v){const E=v(i.value.value,u.value.value,g);return new co(this,{kind:"constant",value:E},i.parameters)}return i}evaluate(i,u,g,v,E,T){return i.kind==="constant"?i.value:i.evaluate(u,g,v,E,T)}}class wu extends vn{possiblyEvaluate(i,u,g,v){if(i.value===void 0)return new co(this,{kind:"constant",value:void 0},u);if(i.expression.kind==="constant"){const E=i.expression.evaluate(u,null,{},g,v),T=i.property.specification.type==="resolvedImage"&&typeof E!="string"?E.name:E,A=this._calculate(T,T,T,u);return new co(this,{kind:"constant",value:A},u)}if(i.expression.kind==="camera"){const E=this._calculate(i.expression.evaluate({zoom:u.zoom-1}),i.expression.evaluate({zoom:u.zoom}),i.expression.evaluate({zoom:u.zoom+1}),u);return new co(this,{kind:"constant",value:E},u)}return new co(this,i.expression,u)}evaluate(i,u,g,v,E,T){if(i.kind==="source"){const A=i.evaluate(u,g,v,E,T);return this._calculate(A,A,A,u)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(u.zoom)-1},g,v),i.evaluate({zoom:Math.floor(u.zoom)},g,v),i.evaluate({zoom:Math.floor(u.zoom)+1},g,v),u):i.value}_calculate(i,u,g,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:i,to:u}:{from:g,to:u}}interpolate(i){return i}}class ku{constructor(i){this.specification=i}possiblyEvaluate(i,u,g,v){if(i.value!==void 0){if(i.expression.kind==="constant"){const E=i.expression.evaluate(u,null,{},g,v);return this._calculate(E,E,E,u)}return this._calculate(i.expression.evaluate(new Ii(Math.floor(u.zoom-1),u)),i.expression.evaluate(new Ii(Math.floor(u.zoom),u)),i.expression.evaluate(new Ii(Math.floor(u.zoom+1),u)),u)}}_calculate(i,u,g,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:i,to:u}:{from:g,to:u}}interpolate(i){return i}}class Vc{constructor(i){this.specification=i}possiblyEvaluate(i,u,g,v){return!!i.expression.evaluate(u,null,{},g,v)}interpolate(){return!1}}class k{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in i){const g=i[u];g.specification.overridable&&this.overridableProperties.push(u);const v=this.defaultPropertyValues[u]=new el(g,void 0),E=this.defaultTransitionablePropertyValues[u]=new bu(g);this.defaultTransitioningPropertyValues[u]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=v.possiblyEvaluate({})}}}Qt("DataDrivenProperty",vn),Qt("DataConstantProperty",nn),Qt("CrossFadedDataDrivenProperty",wu),Qt("CrossFadedProperty",ku),Qt("ColorRampProperty",Vc);const t="-transition";class h extends Lt{constructor(i,u){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),u.layout&&(this._unevaluatedLayout=new Vl(u.layout)),u.paint)){this._transitionablePaint=new xu(u.paint);for(const g in i.paint)this.setPaintProperty(g,i.paint[g],{validate:!1});for(const g in i.layout)this.setLayoutProperty(g,i.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ql(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,u,g={}){u!=null&&this._validate(jh,`layers.${this.id}.layout.${i}`,i,u,g)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,u):this.visibility=u)}getPaintProperty(i){return i.endsWith(t)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,u,g={}){if(u!=null&&this._validate(Uh,`layers.${this.id}.paint.${i}`,i,u,g))return!1;if(i.endsWith(t))return this._transitionablePaint.setTransition(i.slice(0,-11),u||void 0),!1;{const v=this._transitionablePaint._values[i],E=v.property.specification["property-type"]==="cross-faded-data-driven",T=v.value.isDataDriven(),A=v.value;this._transitionablePaint.setValue(i,u),this._handleSpecialPaintPropertyUpdate(i);const R=this._transitionablePaint._values[i].value;return R.isDataDriven()||T||E||this._handleOverridablePaintPropertyUpdate(i,A,R)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,u,g){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,u){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,u)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Le(i,(u,g)=>!(u===void 0||g==="layout"&&!Object.keys(u).length||g==="paint"&&!Object.keys(u).length))}_validate(i,u,g,v,E={}){return(!E||E.validate!==!1)&&Nc(this,i.call(ka,{key:u,layerType:this.type,objectKey:g,value:v,styleSpec:Ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const u=this.paint.get(i);if(u instanceof co&&Eo(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const _={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class y{constructor(i,u){this._structArray=i,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class w{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,u){return i._trim(),u&&(i.isTransferred=!0,u.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const u=Object.create(this.prototype);return u.arrayBuffer=i.arrayBuffer,u.length=i.length,u.capacity=i.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function P(o,i=1){let u=0,g=0;return{members:o.map(v=>{const E=_[v.type].BYTES_PER_ELEMENT,T=u=D(u,Math.max(i,E)),A=v.components||1;return g=Math.max(g,E),u+=E*A,{name:v.name,type:v.type,components:A,offset:T}}),size:D(u,Math.max(g,i)),alignment:i}}function D(o,i){return Math.ceil(o/i)*i}class z extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u){const g=this.length;return this.resize(g+1),this.emplace(g,i,u)}emplace(i,u,g){const v=2*i;return this.int16[v+0]=u,this.int16[v+1]=g,i}}z.prototype.bytesPerElement=4,Qt("StructArrayLayout2i4",z);class V extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=3*i;return this.int16[E+0]=u,this.int16[E+1]=g,this.int16[E+2]=v,i}}V.prototype.bytesPerElement=6,Qt("StructArrayLayout3i6",V);class H extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v){const E=this.length;return this.resize(E+1),this.emplace(E,i,u,g,v)}emplace(i,u,g,v,E){const T=4*i;return this.int16[T+0]=u,this.int16[T+1]=g,this.int16[T+2]=v,this.int16[T+3]=E,i}}H.prototype.bytesPerElement=8,Qt("StructArrayLayout4i8",H);class W extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,T){const A=this.length;return this.resize(A+1),this.emplace(A,i,u,g,v,E,T)}emplace(i,u,g,v,E,T,A){const R=6*i;return this.int16[R+0]=u,this.int16[R+1]=g,this.int16[R+2]=v,this.int16[R+3]=E,this.int16[R+4]=T,this.int16[R+5]=A,i}}W.prototype.bytesPerElement=12,Qt("StructArrayLayout2i4i12",W);class ne extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,T){const A=this.length;return this.resize(A+1),this.emplace(A,i,u,g,v,E,T)}emplace(i,u,g,v,E,T,A){const R=4*i,O=8*i;return this.int16[R+0]=u,this.int16[R+1]=g,this.uint8[O+4]=v,this.uint8[O+5]=E,this.uint8[O+6]=T,this.uint8[O+7]=A,i}}ne.prototype.bytesPerElement=8,Qt("StructArrayLayout2i4ub8",ne);class ge extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u){const g=this.length;return this.resize(g+1),this.emplace(g,i,u)}emplace(i,u,g){const v=2*i;return this.float32[v+0]=u,this.float32[v+1]=g,i}}ge.prototype.bytesPerElement=8,Qt("StructArrayLayout2f8",ge);class ke extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,T,A,R,O,j){const G=this.length;return this.resize(G+1),this.emplace(G,i,u,g,v,E,T,A,R,O,j)}emplace(i,u,g,v,E,T,A,R,O,j,G){const X=10*i;return this.uint16[X+0]=u,this.uint16[X+1]=g,this.uint16[X+2]=v,this.uint16[X+3]=E,this.uint16[X+4]=T,this.uint16[X+5]=A,this.uint16[X+6]=R,this.uint16[X+7]=O,this.uint16[X+8]=j,this.uint16[X+9]=G,i}}ke.prototype.bytesPerElement=20,Qt("StructArrayLayout10ui20",ke);class Me extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,T,A,R,O,j,G,X){const te=this.length;return this.resize(te+1),this.emplace(te,i,u,g,v,E,T,A,R,O,j,G,X)}emplace(i,u,g,v,E,T,A,R,O,j,G,X,te){const se=12*i;return this.int16[se+0]=u,this.int16[se+1]=g,this.int16[se+2]=v,this.int16[se+3]=E,this.uint16[se+4]=T,this.uint16[se+5]=A,this.uint16[se+6]=R,this.uint16[se+7]=O,this.int16[se+8]=j,this.int16[se+9]=G,this.int16[se+10]=X,this.int16[se+11]=te,i}}Me.prototype.bytesPerElement=24,Qt("StructArrayLayout4i4ui4i24",Me);class Ne extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=3*i;return this.float32[E+0]=u,this.float32[E+1]=g,this.float32[E+2]=v,i}}Ne.prototype.bytesPerElement=12,Qt("StructArrayLayout3f12",Ne);class ze extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.uint32[1*i+0]=u,i}}ze.prototype.bytesPerElement=4,Qt("StructArrayLayout1ul4",ze);class qe extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,T,A,R,O){const j=this.length;return this.resize(j+1),this.emplace(j,i,u,g,v,E,T,A,R,O)}emplace(i,u,g,v,E,T,A,R,O,j){const G=10*i,X=5*i;return this.int16[G+0]=u,this.int16[G+1]=g,this.int16[G+2]=v,this.int16[G+3]=E,this.int16[G+4]=T,this.int16[G+5]=A,this.uint32[X+3]=R,this.uint16[G+8]=O,this.uint16[G+9]=j,i}}qe.prototype.bytesPerElement=20,Qt("StructArrayLayout6i1ul2ui20",qe);class Te extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,T){const A=this.length;return this.resize(A+1),this.emplace(A,i,u,g,v,E,T)}emplace(i,u,g,v,E,T,A){const R=6*i;return this.int16[R+0]=u,this.int16[R+1]=g,this.int16[R+2]=v,this.int16[R+3]=E,this.int16[R+4]=T,this.int16[R+5]=A,i}}Te.prototype.bytesPerElement=12,Qt("StructArrayLayout2i2i2i12",Te);class Ze extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E){const T=this.length;return this.resize(T+1),this.emplace(T,i,u,g,v,E)}emplace(i,u,g,v,E,T){const A=4*i,R=8*i;return this.float32[A+0]=u,this.float32[A+1]=g,this.float32[A+2]=v,this.int16[R+6]=E,this.int16[R+7]=T,i}}Ze.prototype.bytesPerElement=16,Qt("StructArrayLayout2f1f2i16",Ze);class Ke extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,T){const A=this.length;return this.resize(A+1),this.emplace(A,i,u,g,v,E,T)}emplace(i,u,g,v,E,T,A){const R=16*i,O=4*i,j=8*i;return this.uint8[R+0]=u,this.uint8[R+1]=g,this.float32[O+1]=v,this.float32[O+2]=E,this.int16[j+6]=T,this.int16[j+7]=A,i}}Ke.prototype.bytesPerElement=16,Qt("StructArrayLayout2ub2f2i16",Ke);class it extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=3*i;return this.uint16[E+0]=u,this.uint16[E+1]=g,this.uint16[E+2]=v,i}}it.prototype.bytesPerElement=6,Qt("StructArrayLayout3ui6",it);class bt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,T,A,R,O,j,G,X,te,se,de,Ce,Re){const nt=this.length;return this.resize(nt+1),this.emplace(nt,i,u,g,v,E,T,A,R,O,j,G,X,te,se,de,Ce,Re)}emplace(i,u,g,v,E,T,A,R,O,j,G,X,te,se,de,Ce,Re,nt){const Ge=24*i,Qe=12*i,ht=48*i;return this.int16[Ge+0]=u,this.int16[Ge+1]=g,this.uint16[Ge+2]=v,this.uint16[Ge+3]=E,this.uint32[Qe+2]=T,this.uint32[Qe+3]=A,this.uint32[Qe+4]=R,this.uint16[Ge+10]=O,this.uint16[Ge+11]=j,this.uint16[Ge+12]=G,this.float32[Qe+7]=X,this.float32[Qe+8]=te,this.uint8[ht+36]=se,this.uint8[ht+37]=de,this.uint8[ht+38]=Ce,this.uint32[Qe+10]=Re,this.int16[Ge+22]=nt,i}}bt.prototype.bytesPerElement=48,Qt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",bt);class Rt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g,v,E,T,A,R,O,j,G,X,te,se,de,Ce,Re,nt,Ge,Qe,ht,Et,$t,yn,Wt,Zt,on,tn){const Kt=this.length;return this.resize(Kt+1),this.emplace(Kt,i,u,g,v,E,T,A,R,O,j,G,X,te,se,de,Ce,Re,nt,Ge,Qe,ht,Et,$t,yn,Wt,Zt,on,tn)}emplace(i,u,g,v,E,T,A,R,O,j,G,X,te,se,de,Ce,Re,nt,Ge,Qe,ht,Et,$t,yn,Wt,Zt,on,tn,Kt){const yt=32*i,cn=16*i;return this.int16[yt+0]=u,this.int16[yt+1]=g,this.int16[yt+2]=v,this.int16[yt+3]=E,this.int16[yt+4]=T,this.int16[yt+5]=A,this.int16[yt+6]=R,this.int16[yt+7]=O,this.uint16[yt+8]=j,this.uint16[yt+9]=G,this.uint16[yt+10]=X,this.uint16[yt+11]=te,this.uint16[yt+12]=se,this.uint16[yt+13]=de,this.uint16[yt+14]=Ce,this.uint16[yt+15]=Re,this.uint16[yt+16]=nt,this.uint16[yt+17]=Ge,this.uint16[yt+18]=Qe,this.uint16[yt+19]=ht,this.uint16[yt+20]=Et,this.uint16[yt+21]=$t,this.uint16[yt+22]=yn,this.uint32[cn+12]=Wt,this.float32[cn+13]=Zt,this.float32[cn+14]=on,this.uint16[yt+30]=tn,this.uint16[yt+31]=Kt,i}}Rt.prototype.bytesPerElement=64,Qt("StructArrayLayout8i15ui1ul2f2ui64",Rt);class Ht extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.float32[1*i+0]=u,i}}Ht.prototype.bytesPerElement=4,Qt("StructArrayLayout1f4",Ht);class Yt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=3*i;return this.uint16[6*i+0]=u,this.float32[E+1]=g,this.float32[E+2]=v,i}}Yt.prototype.bytesPerElement=12,Qt("StructArrayLayout1ui2f12",Yt);class jt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,g)}emplace(i,u,g,v){const E=4*i;return this.uint32[2*i+0]=u,this.uint16[E+2]=g,this.uint16[E+3]=v,i}}jt.prototype.bytesPerElement=8,Qt("StructArrayLayout1ul2ui8",jt);class Ut extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u){const g=this.length;return this.resize(g+1),this.emplace(g,i,u)}emplace(i,u,g){const v=2*i;return this.uint16[v+0]=u,this.uint16[v+1]=g,i}}Ut.prototype.bytesPerElement=4,Qt("StructArrayLayout2ui4",Ut);class rn extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.uint16[1*i+0]=u,i}}rn.prototype.bytesPerElement=2,Qt("StructArrayLayout1ui2",rn);class Tn extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,g,v){const E=this.length;return this.resize(E+1),this.emplace(E,i,u,g,v)}emplace(i,u,g,v,E){const T=4*i;return this.float32[T+0]=u,this.float32[T+1]=g,this.float32[T+2]=v,this.float32[T+3]=E,i}}Tn.prototype.bytesPerElement=16,Qt("StructArrayLayout4f16",Tn);class qt extends y{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new L(this.anchorPointX,this.anchorPointY)}}qt.prototype.size=20;class Xt extends qe{get(i){return new qt(this,i)}}Qt("CollisionBoxArray",Xt);class In extends y{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}In.prototype.size=48;class Si extends bt{get(i){return new In(this,i)}}Qt("PlacedSymbolArray",Si);class On extends y{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}On.prototype.size=64;class jn extends Rt{get(i){return new On(this,i)}}Qt("SymbolInstanceArray",jn);class Ei extends Ht{getoffsetX(i){return this.float32[1*i+0]}}Qt("GlyphOffsetArray",Ei);class Nr extends V{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Qt("SymbolLineVertexArray",Nr);class Hs extends y{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Hs.prototype.size=12;class Ti extends Yt{get(i){return new Hs(this,i)}}Qt("TextAnchorOffsetArray",Ti);class ss extends y{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ss.prototype.size=8;class Wr extends jt{get(i){return new ss(this,i)}}Qt("FeatureIndexArray",Wr);class zr extends z{}class Xr extends z{}class ho extends z{}class tl extends W{}class Iu extends ne{}class nl extends ge{}class zs extends ke{}class Su extends Me{}class qc extends Ne{}class Os extends ze{}class Fs extends Te{}class Qo extends Ke{}class Ws extends it{}class Pr extends Ut{}const Or=P([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ss}=Or;class Gn{constructor(i=[]){this.segments=i}prepareSegment(i,u,g,v){let E=this.segments[this.segments.length-1];return i>Gn.MAX_VERTEX_ARRAY_LENGTH&&Ue(`Max vertices per segment is ${Gn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!E||E.vertexLength+i>Gn.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==v)&&(E={vertexOffset:u.length,primitiveOffset:g.length,vertexLength:0,primitiveLength:0},v!==void 0&&(E.sortKey=v),this.segments.push(E)),E}get(){return this.segments}destroy(){for(const i of this.segments)for(const u in i.vaos)i.vaos[u].destroy()}static simpleSegment(i,u,g,v){return new Gn([{vertexOffset:i,primitiveOffset:u,vertexLength:g,primitiveLength:v,vaos:{},sortKey:0}])}}function Ia(o,i){return 256*(o=ve(Math.floor(o),0,255))+ve(Math.floor(i),0,255)}Gn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Qt("SegmentVector",Gn);const il=P([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var rl={exports:{}},Hh={exports:{}};Hh.exports=function(o,i){var u,g,v,E,T,A,R,O;for(g=o.length-(u=3&o.length),v=i,T=3432918353,A=461845907,O=0;O<g;)R=255&o.charCodeAt(O)|(255&o.charCodeAt(++O))<<8|(255&o.charCodeAt(++O))<<16|(255&o.charCodeAt(++O))<<24,++O,v=27492+(65535&(E=5*(65535&(v=(v^=R=(65535&(R=(R=(65535&R)*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*A+(((R>>>16)*A&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(R=0,u){case 3:R^=(255&o.charCodeAt(O+2))<<16;case 2:R^=(255&o.charCodeAt(O+1))<<8;case 1:v^=R=(65535&(R=(R=(65535&(R^=255&o.charCodeAt(O)))*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*A+(((R>>>16)*A&65535)<<16)&4294967295}return v^=o.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0};var dd=Hh.exports,Wh={exports:{}};Wh.exports=function(o,i){for(var u,g=o.length,v=i^g,E=0;g>=4;)u=1540483477*(65535&(u=255&o.charCodeAt(E)|(255&o.charCodeAt(++E))<<8|(255&o.charCodeAt(++E))<<16|(255&o.charCodeAt(++E))<<24))+((1540483477*(u>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),g-=4,++E;switch(g){case 3:v^=(255&o.charCodeAt(E+2))<<16;case 2:v^=(255&o.charCodeAt(E+1))<<8;case 1:v=1540483477*(65535&(v^=255&o.charCodeAt(E)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0};var ea=dd,Xh=Wh.exports;rl.exports=ea,rl.exports.murmur3=ea,rl.exports.murmur2=Xh;var Eu=x(rl.exports);class Gl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,u,g,v){this.ids.push(Tu(i)),this.positions.push(u,g,v)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=Tu(i);let g=0,v=this.ids.length-1;for(;g<v;){const T=g+v>>1;this.ids[T]>=u?v=T:g=T+1}const E=[];for(;this.ids[g]===u;)E.push({index:this.positions[3*g],start:this.positions[3*g+1],end:this.positions[3*g+2]}),g++;return E}static serialize(i,u){const g=new Float64Array(i.ids),v=new Uint32Array(i.positions);return Cu(g,v,0,g.length-1),u&&u.push(g.buffer,v.buffer),{ids:g,positions:v}}static deserialize(i){const u=new Gl;return u.ids=i.ids,u.positions=i.positions,u.indexed=!0,u}}function Tu(o){const i=+o;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:Eu(String(o))}function Cu(o,i,u,g){for(;u<g;){const v=o[u+g>>1];let E=u-1,T=g+1;for(;;){do E++;while(o[E]<v);do T--;while(o[T]>v);if(E>=T)break;sl(o,E,T),sl(i,3*E,3*T),sl(i,3*E+1,3*T+1),sl(i,3*E+2,3*T+2)}T-u<g-T?(Cu(o,i,u,T),u=T+1):(Cu(o,i,T+1,g),g=T)}}function sl(o,i,u){const g=o[i];o[i]=o[u],o[u]=g}Qt("FeaturePositionMap",Gl);class Zl{constructor(i,u){this.gl=i.gl,this.location=u}}class $h extends Zl{constructor(i,u){super(i,u),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class rm extends Zl{constructor(i,u){super(i,u),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class sm extends Zl{constructor(i,u){super(i,u),this.current=Qn.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const e1=new Float32Array(16);function pd(o){return[Ia(255*o.r,255*o.g),Ia(255*o.b,255*o.a)]}class Gc{constructor(i,u,g){this.value=i,this.uniformNames=u.map(v=>`u_${v}`),this.type=g}setUniform(i,u,g){i.set(g.constantOr(this.value))}getBinding(i,u,g){return this.type==="color"?new sm(i,u):new $h(i,u)}}class Lu{constructor(i,u){this.uniformNames=u.map(g=>`u_${g}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=i.tlbr}setUniform(i,u,g,v){const E=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;E&&i.set(E)}getBinding(i,u,g){return g.substr(0,9)==="u_pattern"?new rm(i,u):new $h(i,u)}}class Sa{constructor(i,u,g,v){this.expression=i,this.type=g,this.maxValue=0,this.paintVertexAttributes=u.map(E=>({name:`a_${E}`,type:"Float32",components:g==="color"?2:1,offset:0})),this.paintVertexArray=new v}populatePaintArray(i,u,g,v,E){const T=this.paintVertexArray.length,A=this.expression.evaluate(new Ii(0),u,{},v,[],E);this.paintVertexArray.resize(i),this._setPaintValue(T,i,A)}updatePaintArray(i,u,g,v){const E=this.expression.evaluate({zoom:0},g,v);this._setPaintValue(i,u,E)}_setPaintValue(i,u,g){if(this.type==="color"){const v=pd(g);for(let E=i;E<u;E++)this.paintVertexArray.emplace(E,v[0],v[1])}else{for(let v=i;v<u;v++)this.paintVertexArray.emplace(v,g);this.maxValue=Math.max(this.maxValue,Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class To{constructor(i,u,g,v,E,T){this.expression=i,this.uniformNames=u.map(A=>`u_${A}_t`),this.type=g,this.useIntegerZoom=v,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=u.map(A=>({name:`a_${A}`,type:"Float32",components:g==="color"?4:2,offset:0})),this.paintVertexArray=new T}populatePaintArray(i,u,g,v,E){const T=this.expression.evaluate(new Ii(this.zoom),u,{},v,[],E),A=this.expression.evaluate(new Ii(this.zoom+1),u,{},v,[],E),R=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(R,i,T,A)}updatePaintArray(i,u,g,v){const E=this.expression.evaluate({zoom:this.zoom},g,v),T=this.expression.evaluate({zoom:this.zoom+1},g,v);this._setPaintValue(i,u,E,T)}_setPaintValue(i,u,g,v){if(this.type==="color"){const E=pd(g),T=pd(v);for(let A=i;A<u;A++)this.paintVertexArray.emplace(A,E[0],E[1],T[0],T[1])}else{for(let E=i;E<u;E++)this.paintVertexArray.emplace(E,g,v);this.maxValue=Math.max(this.maxValue,Math.abs(g),Math.abs(v))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,u){const g=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,v=ve(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);i.set(v)}getBinding(i,u,g){return new $h(i,u)}}class ol{constructor(i,u,g,v,E,T){this.expression=i,this.type=u,this.useIntegerZoom=g,this.zoom=v,this.layerId=T,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E}populatePaintArray(i,u,g){const v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(v,i,u.patterns&&u.patterns[this.layerId],g)}updatePaintArray(i,u,g,v,E){this._setPaintValues(i,u,g.patterns&&g.patterns[this.layerId],E)}_setPaintValues(i,u,g,v){if(!v||!g)return;const{min:E,mid:T,max:A}=g,R=v[E],O=v[T],j=v[A];if(R&&O&&j)for(let G=i;G<u;G++)this.zoomInPaintVertexArray.emplace(G,O.tl[0],O.tl[1],O.br[0],O.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],O.pixelRatio,R.pixelRatio),this.zoomOutPaintVertexArray.emplace(G,O.tl[0],O.tl[1],O.br[0],O.br[1],j.tl[0],j.tl[1],j.br[0],j.br[1],O.pixelRatio,j.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,il.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,il.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class om{constructor(i,u,g){this.binders={},this._buffers=[];const v=[];for(const E in i.paint._values){if(!g(E))continue;const T=i.paint.get(E);if(!(T instanceof co&&Eo(T.property.specification)))continue;const A=t1(E,i.type),R=T.value,O=T.property.specification.type,j=T.property.useIntegerZoom,G=T.property.specification["property-type"],X=G==="cross-faded"||G==="cross-faded-data-driven";if(R.kind==="constant")this.binders[E]=X?new Lu(R.value,A):new Gc(R.value,A,O),v.push(`/u_${E}`);else if(R.kind==="source"||X){const te=am(E,O,"source");this.binders[E]=X?new ol(R,O,j,u,te,i.id):new Sa(R,A,O,te),v.push(`/a_${E}`)}else{const te=am(E,O,"composite");this.binders[E]=new To(R,A,O,j,u,te),v.push(`/z_${E}`)}}this.cacheKey=v.sort().join("")}getMaxValue(i){const u=this.binders[i];return u instanceof Sa||u instanceof To?u.maxValue:0}populatePaintArrays(i,u,g,v,E){for(const T in this.binders){const A=this.binders[T];(A instanceof Sa||A instanceof To||A instanceof ol)&&A.populatePaintArray(i,u,g,v,E)}}setConstantPatternPositions(i,u){for(const g in this.binders){const v=this.binders[g];v instanceof Lu&&v.setConstantPatternPositions(i,u)}}updatePaintArrays(i,u,g,v,E){let T=!1;for(const A in i){const R=u.getPositions(A);for(const O of R){const j=g.feature(O.index);for(const G in this.binders){const X=this.binders[G];if((X instanceof Sa||X instanceof To||X instanceof ol)&&X.expression.isStateDependent===!0){const te=v.paint.get(G);X.expression=te.value,X.updatePaintArray(O.start,O.end,j,i[A],E),T=!0}}}}return T}defines(){const i=[];for(const u in this.binders){const g=this.binders[u];(g instanceof Gc||g instanceof Lu)&&i.push(...g.uniformNames.map(v=>`#define HAS_UNIFORM_${v}`))}return i}getBinderAttributes(){const i=[];for(const u in this.binders){const g=this.binders[u];if(g instanceof Sa||g instanceof To)for(let v=0;v<g.paintVertexAttributes.length;v++)i.push(g.paintVertexAttributes[v].name);else if(g instanceof ol)for(let v=0;v<il.members.length;v++)i.push(il.members[v].name)}return i}getBinderUniforms(){const i=[];for(const u in this.binders){const g=this.binders[u];if(g instanceof Gc||g instanceof Lu||g instanceof To)for(const v of g.uniformNames)i.push(v)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,u){const g=[];for(const v in this.binders){const E=this.binders[v];if(E instanceof Gc||E instanceof Lu||E instanceof To){for(const T of E.uniformNames)if(u[T]){const A=E.getBinding(i,u[T],T);g.push({name:T,property:v,binding:A})}}}return g}setUniforms(i,u,g,v){for(const{name:E,property:T,binding:A}of u)this.binders[T].setUniform(A,v,g.get(T),E)}updatePaintBuffers(i){this._buffers=[];for(const u in this.binders){const g=this.binders[u];if(i&&g instanceof ol){const v=i.fromScale===2?g.zoomInPaintVertexBuffer:g.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(g instanceof Sa||g instanceof To)&&g.paintVertexBuffer&&this._buffers.push(g.paintVertexBuffer)}}upload(i){for(const u in this.binders){const g=this.binders[u];(g instanceof Sa||g instanceof To||g instanceof ol)&&g.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const u=this.binders[i];(u instanceof Sa||u instanceof To||u instanceof ol)&&u.destroy()}}}class Hl{constructor(i,u,g=()=>!0){this.programConfigurations={};for(const v of i)this.programConfigurations[v.id]=new om(v,u,g);this.needsUpload=!1,this._featureMap=new Gl,this._bufferOffset=0}populatePaintArrays(i,u,g,v,E,T){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(i,u,v,E,T);u.id!==void 0&&this._featureMap.add(u.id,g,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,u,g,v){for(const E of g)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(i,this._featureMap,u,E,v)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function t1(o,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(`${i}-`,"").replace(/-/g,"_")]}function am(o,i,u){const g={color:{source:ge,composite:Tn},number:{source:Ht,composite:ge}},v=function(E){return{"line-pattern":{source:zs,composite:zs},"fill-pattern":{source:zs,composite:zs},"fill-extrusion-pattern":{source:zs,composite:zs}}[E]}(o);return v&&v[u]||g[i][u]}Qt("ConstantBinder",Gc),Qt("CrossFadedConstantBinder",Lu),Qt("SourceExpressionBinder",Sa),Qt("CrossFadedCompositeBinder",ol),Qt("CompositeExpressionBinder",To),Qt("ProgramConfiguration",om,{omit:["_buffers"]}),Qt("ProgramConfigurationSet",Hl);const ar=8192,md=Math.pow(2,14)-1,lm=-md-1;function Wl(o){const i=ar/o.extent,u=o.loadGeometry();for(let g=0;g<u.length;g++){const v=u[g];for(let E=0;E<v.length;E++){const T=v[E],A=Math.round(T.x*i),R=Math.round(T.y*i);T.x=ve(A,lm,md),T.y=ve(R,lm,md),(A<T.x||A>T.x+1||R<T.y||R>T.y+1)&&Ue("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function Xl(o,i){return{type:o.type,id:o.id,properties:o.properties,geometry:i?Wl(o):[]}}function Yh(o,i,u,g,v){o.emplaceBack(2*i+(g+1)/2,2*u+(v+1)/2)}class gd{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Xr,this.indexArray=new Ws,this.segments=new Gn,this.programConfigurations=new Hl(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,g){const v=this.layers[0],E=[];let T=null,A=!1;v.type==="circle"&&(T=v.layout.get("circle-sort-key"),A=!T.isConstant());for(const{feature:R,id:O,index:j,sourceLayerIndex:G}of i){const X=this.layers[0]._featureFilter.needGeometry,te=Xl(R,X);if(!this.layers[0]._featureFilter.filter(new Ii(this.zoom),te,g))continue;const se=A?T.evaluate(te,{},g):void 0,de={id:O,properties:R.properties,type:R.type,sourceLayerIndex:G,index:j,geometry:X?te.geometry:Wl(R),patterns:{},sortKey:se};E.push(de)}A&&E.sort((R,O)=>R.sortKey-O.sortKey);for(const R of E){const{geometry:O,index:j,sourceLayerIndex:G}=R,X=i[j].feature;this.addFeature(R,O,j,g),u.featureIndex.insert(X,O,j,G,this.index)}}update(i,u,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Ss),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,u,g,v){for(const E of u)for(const T of E){const A=T.x,R=T.y;if(A<0||A>=ar||R<0||R>=ar)continue;const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),j=O.vertexLength;Yh(this.layoutVertexArray,A,R,-1,-1),Yh(this.layoutVertexArray,A,R,1,-1),Yh(this.layoutVertexArray,A,R,1,1),Yh(this.layoutVertexArray,A,R,-1,1),this.indexArray.emplaceBack(j,j+1,j+2),this.indexArray.emplaceBack(j,j+3,j+2),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,g,{},v)}}function um(o,i){for(let u=0;u<o.length;u++)if(Mu(i,o[u]))return!0;for(let u=0;u<i.length;u++)if(Mu(o,i[u]))return!0;return!!_d(o,i)}function n1(o,i,u){return!!Mu(o,i)||!!yd(i,o,u)}function cm(o,i){if(o.length===1)return fm(i,o[0]);for(let u=0;u<i.length;u++){const g=i[u];for(let v=0;v<g.length;v++)if(Mu(o,g[v]))return!0}for(let u=0;u<o.length;u++)if(fm(i,o[u]))return!0;for(let u=0;u<i.length;u++)if(_d(o,i[u]))return!0;return!1}function i1(o,i,u){if(o.length>1){if(_d(o,i))return!0;for(let g=0;g<i.length;g++)if(yd(i[g],o,u))return!0}for(let g=0;g<o.length;g++)if(yd(o[g],i,u))return!0;return!1}function _d(o,i){if(o.length===0||i.length===0)return!1;for(let u=0;u<o.length-1;u++){const g=o[u],v=o[u+1];for(let E=0;E<i.length-1;E++)if(r1(g,v,i[E],i[E+1]))return!0}return!1}function r1(o,i,u,g){return Ve(o,u,g)!==Ve(i,u,g)&&Ve(o,i,u)!==Ve(o,i,g)}function yd(o,i,u){const g=u*u;if(i.length===1)return o.distSqr(i[0])<g;for(let v=1;v<i.length;v++)if(hm(o,i[v-1],i[v])<g)return!0;return!1}function hm(o,i,u){const g=i.distSqr(u);if(g===0)return o.distSqr(i);const v=((o.x-i.x)*(u.x-i.x)+(o.y-i.y)*(u.y-i.y))/g;return o.distSqr(v<0?i:v>1?u:u.sub(i)._mult(v)._add(i))}function fm(o,i){let u,g,v,E=!1;for(let T=0;T<o.length;T++){u=o[T];for(let A=0,R=u.length-1;A<u.length;R=A++)g=u[A],v=u[R],g.y>i.y!=v.y>i.y&&i.x<(v.x-g.x)*(i.y-g.y)/(v.y-g.y)+g.x&&(E=!E)}return E}function Mu(o,i){let u=!1;for(let g=0,v=o.length-1;g<o.length;v=g++){const E=o[g],T=o[v];E.y>i.y!=T.y>i.y&&i.x<(T.x-E.x)*(i.y-E.y)/(T.y-E.y)+E.x&&(u=!u)}return u}function s1(o,i,u){const g=u[0],v=u[2];if(o.x<g.x&&i.x<g.x||o.x>v.x&&i.x>v.x||o.y<g.y&&i.y<g.y||o.y>v.y&&i.y>v.y)return!1;const E=Ve(o,i,u[0]);return E!==Ve(o,i,u[1])||E!==Ve(o,i,u[2])||E!==Ve(o,i,u[3])}function Zc(o,i,u){const g=i.paint.get(o).value;return g.kind==="constant"?g.value:u.programConfigurations.get(i.id).getMaxValue(o)}function Jh(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Kh(o,i,u,g,v){if(!i[0]&&!i[1])return o;const E=L.convert(i)._mult(v);u==="viewport"&&E._rotate(-g);const T=[];for(let A=0;A<o.length;A++)T.push(o[A].sub(E));return T}let dm,pm;Qt("CircleBucket",gd,{omit:["layers"]});var o1={get paint(){return pm=pm||new k({"circle-radius":new vn(Ye.paint_circle["circle-radius"]),"circle-color":new vn(Ye.paint_circle["circle-color"]),"circle-blur":new vn(Ye.paint_circle["circle-blur"]),"circle-opacity":new vn(Ye.paint_circle["circle-opacity"]),"circle-translate":new nn(Ye.paint_circle["circle-translate"]),"circle-translate-anchor":new nn(Ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new nn(Ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new nn(Ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new vn(Ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new vn(Ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new vn(Ye.paint_circle["circle-stroke-opacity"])})},get layout(){return dm=dm||new k({"circle-sort-key":new vn(Ye.layout_circle["circle-sort-key"])})}},os=1e-6,Au=typeof Float32Array<"u"?Float32Array:Array;function vd(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function mm(o,i,u){var g=i[0],v=i[1],E=i[2],T=i[3],A=i[4],R=i[5],O=i[6],j=i[7],G=i[8],X=i[9],te=i[10],se=i[11],de=i[12],Ce=i[13],Re=i[14],nt=i[15],Ge=u[0],Qe=u[1],ht=u[2],Et=u[3];return o[0]=Ge*g+Qe*A+ht*G+Et*de,o[1]=Ge*v+Qe*R+ht*X+Et*Ce,o[2]=Ge*E+Qe*O+ht*te+Et*Re,o[3]=Ge*T+Qe*j+ht*se+Et*nt,o[4]=(Ge=u[4])*g+(Qe=u[5])*A+(ht=u[6])*G+(Et=u[7])*de,o[5]=Ge*v+Qe*R+ht*X+Et*Ce,o[6]=Ge*E+Qe*O+ht*te+Et*Re,o[7]=Ge*T+Qe*j+ht*se+Et*nt,o[8]=(Ge=u[8])*g+(Qe=u[9])*A+(ht=u[10])*G+(Et=u[11])*de,o[9]=Ge*v+Qe*R+ht*X+Et*Ce,o[10]=Ge*E+Qe*O+ht*te+Et*Re,o[11]=Ge*T+Qe*j+ht*se+Et*nt,o[12]=(Ge=u[12])*g+(Qe=u[13])*A+(ht=u[14])*G+(Et=u[15])*de,o[13]=Ge*v+Qe*R+ht*X+Et*Ce,o[14]=Ge*E+Qe*O+ht*te+Et*Re,o[15]=Ge*T+Qe*j+ht*se+Et*nt,o}Math.hypot||(Math.hypot=function(){for(var o=0,i=arguments.length;i--;)o+=arguments[i]*arguments[i];return Math.sqrt(o)});var Hc,a1=mm;function Qh(o,i,u){var g=i[0],v=i[1],E=i[2],T=i[3];return o[0]=u[0]*g+u[4]*v+u[8]*E+u[12]*T,o[1]=u[1]*g+u[5]*v+u[9]*E+u[13]*T,o[2]=u[2]*g+u[6]*v+u[10]*E+u[14]*T,o[3]=u[3]*g+u[7]*v+u[11]*E+u[15]*T,o}Hc=new Au(4),Au!=Float32Array&&(Hc[0]=0,Hc[1]=0,Hc[2]=0,Hc[3]=0);class l1 extends h{constructor(i){super(i,o1)}createBucket(i){return new gd(i)}queryRadius(i){const u=i;return Zc("circle-radius",this,u)+Zc("circle-stroke-width",this,u)+Jh(this.paint.get("circle-translate"))}queryIntersectsFeature(i,u,g,v,E,T,A,R){const O=Kh(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),T.angle,A),j=this.paint.get("circle-radius").evaluate(u,g)+this.paint.get("circle-stroke-width").evaluate(u,g),G=this.paint.get("circle-pitch-alignment")==="map",X=G?O:function(se,de){return se.map(Ce=>gm(Ce,de))}(O,R),te=G?j*A:j;for(const se of v)for(const de of se){const Ce=G?de:gm(de,R);let Re=te;const nt=Qh([],[de.x,de.y,0,1],R);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Re*=nt[3]/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Re*=T.cameraToCenterDistance/nt[3]),n1(X,Ce,Re))return!0}return!1}}function gm(o,i){const u=Qh([],[o.x,o.y,0,1],i);return new L(u[0]/u[3],u[1]/u[3])}class _m extends gd{}let ym;Qt("HeatmapBucket",_m,{omit:["layers"]});var u1={get paint(){return ym=ym||new k({"heatmap-radius":new vn(Ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new vn(Ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new nn(Ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Vc(Ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new nn(Ye.paint_heatmap["heatmap-opacity"])})}};function bd(o,{width:i,height:u},g,v){if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==i*u*g)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${i*u*g}`)}else v=new Uint8Array(i*u*g);return o.width=i,o.height=u,o.data=v,o}function vm(o,{width:i,height:u},g){if(i===o.width&&u===o.height)return;const v=bd({},{width:i,height:u},g);xd(o,v,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,i),height:Math.min(o.height,u)},g),o.width=i,o.height=u,o.data=v.data}function xd(o,i,u,g,v,E){if(v.width===0||v.height===0)return i;if(v.width>o.width||v.height>o.height||u.x>o.width-v.width||u.y>o.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>i.width||v.height>i.height||g.x>i.width-v.width||g.y>i.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const T=o.data,A=i.data;if(T===A)throw new Error("srcData equals dstData, so image is already copied");for(let R=0;R<v.height;R++){const O=((u.y+R)*o.width+u.x)*E,j=((g.y+R)*i.width+g.x)*E;for(let G=0;G<v.width*E;G++)A[j+G]=T[O+G]}return i}class Wc{constructor(i,u){bd(this,i,1,u)}resize(i){vm(this,i,1)}clone(){return new Wc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,u,g,v,E){xd(i,u,g,v,E,1)}}class Xs{constructor(i,u){bd(this,i,4,u)}resize(i){vm(this,i,4)}replace(i,u){u?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Xs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,u,g,v,E){xd(i,u,g,v,E,4)}}function bm(o){const i={},u=o.resolution||256,g=o.clips?o.clips.length:1,v=o.image||new Xs({width:u,height:g});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const E=(T,A,R)=>{i[o.evaluationKey]=R;const O=o.expression.evaluate(i);v.data[T+A+0]=Math.floor(255*O.r/O.a),v.data[T+A+1]=Math.floor(255*O.g/O.a),v.data[T+A+2]=Math.floor(255*O.b/O.a),v.data[T+A+3]=Math.floor(255*O.a)};if(o.clips)for(let T=0,A=0;T<g;++T,A+=4*u)for(let R=0,O=0;R<u;R++,O+=4){const j=R/(u-1),{start:G,end:X}=o.clips[T];E(A,O,G*(1-j)+X*j)}else for(let T=0,A=0;T<u;T++,A+=4)E(0,A,T/(u-1));return v}Qt("AlphaImage",Wc),Qt("RGBAImage",Xs);const wd="big-fb";class c1 extends h{createBucket(i){return new _m(i)}constructor(i){super(i,u1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=bm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(wd)&&this.heatmapFbos.delete(wd)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let xm;var h1={get paint(){return xm=xm||new k({"hillshade-illumination-direction":new nn(Ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new nn(Ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new nn(Ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new nn(Ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new nn(Ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new nn(Ye.paint_hillshade["hillshade-accent-color"])})}};class f1 extends h{constructor(i){super(i,h1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const d1=P([{name:"a_pos",components:2,type:"Int16"}],4),{members:p1}=d1;function wm(o,i,u=2){const g=i&&i.length,v=g?i[0]*u:o.length;let E=km(o,0,v,u,!0);const T=[];if(!E||E.next===E.prev)return T;let A,R,O;if(g&&(E=function(j,G,X,te){const se=[];for(let de=0,Ce=G.length;de<Ce;de++){const Re=km(j,G[de]*te,de<Ce-1?G[de+1]*te:j.length,te,!1);Re===Re.next&&(Re.steiner=!0),se.push(w1(Re))}se.sort(v1);for(let de=0;de<se.length;de++)X=b1(se[de],X);return X}(o,i,E,u)),o.length>80*u){A=1/0,R=1/0;let j=-1/0,G=-1/0;for(let X=u;X<v;X+=u){const te=o[X],se=o[X+1];te<A&&(A=te),se<R&&(R=se),te>j&&(j=te),se>G&&(G=se)}O=Math.max(j-A,G-R),O=O!==0?32767/O:0}return Xc(E,T,u,A,R,O,0),T}function km(o,i,u,g,v){let E;if(v===function(T,A,R,O){let j=0;for(let G=A,X=R-O;G<R;G+=O)j+=(T[X]-T[G])*(T[G+1]+T[X+1]),X=G;return j}(o,i,u,g)>0)for(let T=i;T<u;T+=g)E=Em(T/g|0,o[T],o[T+1],E);else for(let T=u-g;T>=i;T-=g)E=Em(T/g|0,o[T],o[T+1],E);return E&&ef(E,E.next)&&(Yc(E),E=E.next),E}function $l(o,i){if(!o)return o;i||(i=o);let u,g=o;do if(u=!1,g.steiner||!ef(g,g.next)&&tr(g.prev,g,g.next)!==0)g=g.next;else{if(Yc(g),g=i=g.prev,g===g.next)break;u=!0}while(u||g!==i);return i}function Xc(o,i,u,g,v,E,T){if(!o)return;!T&&E&&function(R,O,j,G){let X=R;do X.z===0&&(X.z=kd(X.x,X.y,O,j,G)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==R);X.prevZ.nextZ=null,X.prevZ=null,function(te){let se,de=1;do{let Ce,Re=te;te=null;let nt=null;for(se=0;Re;){se++;let Ge=Re,Qe=0;for(let Et=0;Et<de&&(Qe++,Ge=Ge.nextZ,Ge);Et++);let ht=de;for(;Qe>0||ht>0&&Ge;)Qe!==0&&(ht===0||!Ge||Re.z<=Ge.z)?(Ce=Re,Re=Re.nextZ,Qe--):(Ce=Ge,Ge=Ge.nextZ,ht--),nt?nt.nextZ=Ce:te=Ce,Ce.prevZ=nt,nt=Ce;Re=Ge}nt.nextZ=null,de*=2}while(se>1)}(X)}(o,g,v,E);let A=o;for(;o.prev!==o.next;){const R=o.prev,O=o.next;if(E?g1(o,g,v,E):m1(o))i.push(R.i,o.i,O.i),Yc(o),o=O.next,A=O.next;else if((o=O)===A){T?T===1?Xc(o=_1($l(o),i),i,u,g,v,E,2):T===2&&y1(o,i,u,g,v,E):Xc($l(o),i,u,g,v,E,1);break}}}function m1(o){const i=o.prev,u=o,g=o.next;if(tr(i,u,g)>=0)return!1;const v=i.x,E=u.x,T=g.x,A=i.y,R=u.y,O=g.y,j=v<E?v<T?v:T:E<T?E:T,G=A<R?A<O?A:O:R<O?R:O,X=v>E?v>T?v:T:E>T?E:T,te=A>R?A>O?A:O:R>O?R:O;let se=g.next;for(;se!==i;){if(se.x>=j&&se.x<=X&&se.y>=G&&se.y<=te&&Pu(v,A,E,R,T,O,se.x,se.y)&&tr(se.prev,se,se.next)>=0)return!1;se=se.next}return!0}function g1(o,i,u,g){const v=o.prev,E=o,T=o.next;if(tr(v,E,T)>=0)return!1;const A=v.x,R=E.x,O=T.x,j=v.y,G=E.y,X=T.y,te=A<R?A<O?A:O:R<O?R:O,se=j<G?j<X?j:X:G<X?G:X,de=A>R?A>O?A:O:R>O?R:O,Ce=j>G?j>X?j:X:G>X?G:X,Re=kd(te,se,i,u,g),nt=kd(de,Ce,i,u,g);let Ge=o.prevZ,Qe=o.nextZ;for(;Ge&&Ge.z>=Re&&Qe&&Qe.z<=nt;){if(Ge.x>=te&&Ge.x<=de&&Ge.y>=se&&Ge.y<=Ce&&Ge!==v&&Ge!==T&&Pu(A,j,R,G,O,X,Ge.x,Ge.y)&&tr(Ge.prev,Ge,Ge.next)>=0||(Ge=Ge.prevZ,Qe.x>=te&&Qe.x<=de&&Qe.y>=se&&Qe.y<=Ce&&Qe!==v&&Qe!==T&&Pu(A,j,R,G,O,X,Qe.x,Qe.y)&&tr(Qe.prev,Qe,Qe.next)>=0))return!1;Qe=Qe.nextZ}for(;Ge&&Ge.z>=Re;){if(Ge.x>=te&&Ge.x<=de&&Ge.y>=se&&Ge.y<=Ce&&Ge!==v&&Ge!==T&&Pu(A,j,R,G,O,X,Ge.x,Ge.y)&&tr(Ge.prev,Ge,Ge.next)>=0)return!1;Ge=Ge.prevZ}for(;Qe&&Qe.z<=nt;){if(Qe.x>=te&&Qe.x<=de&&Qe.y>=se&&Qe.y<=Ce&&Qe!==v&&Qe!==T&&Pu(A,j,R,G,O,X,Qe.x,Qe.y)&&tr(Qe.prev,Qe,Qe.next)>=0)return!1;Qe=Qe.nextZ}return!0}function _1(o,i){let u=o;do{const g=u.prev,v=u.next.next;!ef(g,v)&&Im(g,u,u.next,v)&&$c(g,v)&&$c(v,g)&&(i.push(g.i,u.i,v.i),Yc(u),Yc(u.next),u=o=v),u=u.next}while(u!==o);return $l(u)}function y1(o,i,u,g,v,E){let T=o;do{let A=T.next.next;for(;A!==T.prev;){if(T.i!==A.i&&k1(T,A)){let R=Sm(T,A);return T=$l(T,T.next),R=$l(R,R.next),Xc(T,i,u,g,v,E,0),void Xc(R,i,u,g,v,E,0)}A=A.next}T=T.next}while(T!==o)}function v1(o,i){return o.x-i.x}function b1(o,i){const u=function(v,E){let T=E;const A=v.x,R=v.y;let O,j=-1/0;do{if(R<=T.y&&R>=T.next.y&&T.next.y!==T.y){const de=T.x+(R-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(de<=A&&de>j&&(j=de,O=T.x<T.next.x?T:T.next,de===A))return O}T=T.next}while(T!==E);if(!O)return null;const G=O,X=O.x,te=O.y;let se=1/0;T=O;do{if(A>=T.x&&T.x>=X&&A!==T.x&&Pu(R<te?A:j,R,X,te,R<te?j:A,R,T.x,T.y)){const de=Math.abs(R-T.y)/(A-T.x);$c(T,v)&&(de<se||de===se&&(T.x>O.x||T.x===O.x&&x1(O,T)))&&(O=T,se=de)}T=T.next}while(T!==G);return O}(o,i);if(!u)return i;const g=Sm(u,o);return $l(g,g.next),$l(u,u.next)}function x1(o,i){return tr(o.prev,o,i.prev)<0&&tr(i.next,o,o.next)<0}function kd(o,i,u,g,v){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-u)*v|0)|o<<8))|o<<4))|o<<2))|o<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-g)*v|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function w1(o){let i=o,u=o;do(i.x<u.x||i.x===u.x&&i.y<u.y)&&(u=i),i=i.next;while(i!==o);return u}function Pu(o,i,u,g,v,E,T,A){return(v-T)*(i-A)>=(o-T)*(E-A)&&(o-T)*(g-A)>=(u-T)*(i-A)&&(u-T)*(E-A)>=(v-T)*(g-A)}function k1(o,i){return o.next.i!==i.i&&o.prev.i!==i.i&&!function(u,g){let v=u;do{if(v.i!==u.i&&v.next.i!==u.i&&v.i!==g.i&&v.next.i!==g.i&&Im(v,v.next,u,g))return!0;v=v.next}while(v!==u);return!1}(o,i)&&($c(o,i)&&$c(i,o)&&function(u,g){let v=u,E=!1;const T=(u.x+g.x)/2,A=(u.y+g.y)/2;do v.y>A!=v.next.y>A&&v.next.y!==v.y&&T<(v.next.x-v.x)*(A-v.y)/(v.next.y-v.y)+v.x&&(E=!E),v=v.next;while(v!==u);return E}(o,i)&&(tr(o.prev,o,i.prev)||tr(o,i.prev,i))||ef(o,i)&&tr(o.prev,o,o.next)>0&&tr(i.prev,i,i.next)>0)}function tr(o,i,u){return(i.y-o.y)*(u.x-i.x)-(i.x-o.x)*(u.y-i.y)}function ef(o,i){return o.x===i.x&&o.y===i.y}function Im(o,i,u,g){const v=nf(tr(o,i,u)),E=nf(tr(o,i,g)),T=nf(tr(u,g,o)),A=nf(tr(u,g,i));return v!==E&&T!==A||!(v!==0||!tf(o,u,i))||!(E!==0||!tf(o,g,i))||!(T!==0||!tf(u,o,g))||!(A!==0||!tf(u,i,g))}function tf(o,i,u){return i.x<=Math.max(o.x,u.x)&&i.x>=Math.min(o.x,u.x)&&i.y<=Math.max(o.y,u.y)&&i.y>=Math.min(o.y,u.y)}function nf(o){return o>0?1:o<0?-1:0}function $c(o,i){return tr(o.prev,o,o.next)<0?tr(o,i,o.next)>=0&&tr(o,o.prev,i)>=0:tr(o,i,o.prev)<0||tr(o,o.next,i)<0}function Sm(o,i){const u=Id(o.i,o.x,o.y),g=Id(i.i,i.x,i.y),v=o.next,E=i.prev;return o.next=i,i.prev=o,u.next=v,v.prev=u,g.next=u,u.prev=g,E.next=g,g.prev=E,g}function Em(o,i,u,g){const v=Id(o,i,u);return g?(v.next=g.next,v.prev=g,g.next.prev=v,g.next=v):(v.prev=v,v.next=v),v}function Yc(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Id(o,i,u){return{i:o,x:i,y:u,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Sd(o,i,u){const g=u.patternDependencies;let v=!1;for(const E of i){const T=E.paint.get(`${o}-pattern`);T.isConstant()||(v=!0);const A=T.constantOr(null);A&&(v=!0,g[A.to]=!0,g[A.from]=!0)}return v}function Ed(o,i,u,g,v){const E=v.patternDependencies;for(const T of i){const A=T.paint.get(`${o}-pattern`).value;if(A.kind!=="constant"){let R=A.evaluate({zoom:g-1},u,{},v.availableImages),O=A.evaluate({zoom:g},u,{},v.availableImages),j=A.evaluate({zoom:g+1},u,{},v.availableImages);R=R&&R.name?R.name:R,O=O&&O.name?O.name:O,j=j&&j.name?j.name:j,E[R]=!0,E[O]=!0,E[j]=!0,u.patterns[T.id]={min:R,mid:O,max:j}}}return u}class Td{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ho,this.indexArray=new Ws,this.indexArray2=new Pr,this.programConfigurations=new Hl(i.layers,i.zoom),this.segments=new Gn,this.segments2=new Gn,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,g){this.hasPattern=Sd("fill",this.layers,u);const v=this.layers[0].layout.get("fill-sort-key"),E=!v.isConstant(),T=[];for(const{feature:A,id:R,index:O,sourceLayerIndex:j}of i){const G=this.layers[0]._featureFilter.needGeometry,X=Xl(A,G);if(!this.layers[0]._featureFilter.filter(new Ii(this.zoom),X,g))continue;const te=E?v.evaluate(X,{},g,u.availableImages):void 0,se={id:R,properties:A.properties,type:A.type,sourceLayerIndex:j,index:O,geometry:G?X.geometry:Wl(A),patterns:{},sortKey:te};T.push(se)}E&&T.sort((A,R)=>A.sortKey-R.sortKey);for(const A of T){const{geometry:R,index:O,sourceLayerIndex:j}=A;if(this.hasPattern){const G=Ed("fill",this.layers,A,this.zoom,u);this.patternFeatures.push(G)}else this.addFeature(A,R,O,g,{});u.featureIndex.insert(i[O].feature,R,O,j,this.index)}}update(i,u,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,g)}addFeatures(i,u,g){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,u,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,p1),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,u,g,v,E){for(const T of ja(u,500)){let A=0;for(const te of T)A+=te.length;const R=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray),O=R.vertexLength,j=[],G=[];for(const te of T){if(te.length===0)continue;te!==T[0]&&G.push(j.length/2);const se=this.segments2.prepareSegment(te.length,this.layoutVertexArray,this.indexArray2),de=se.vertexLength;this.layoutVertexArray.emplaceBack(te[0].x,te[0].y),this.indexArray2.emplaceBack(de+te.length-1,de),j.push(te[0].x),j.push(te[0].y);for(let Ce=1;Ce<te.length;Ce++)this.layoutVertexArray.emplaceBack(te[Ce].x,te[Ce].y),this.indexArray2.emplaceBack(de+Ce-1,de+Ce),j.push(te[Ce].x),j.push(te[Ce].y);se.vertexLength+=te.length,se.primitiveLength+=te.length}const X=wm(j,G);for(let te=0;te<X.length;te+=3)this.indexArray.emplaceBack(O+X[te],O+X[te+1],O+X[te+2]);R.vertexLength+=A,R.primitiveLength+=X.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,g,E,v)}}let Tm,Cm;Qt("FillBucket",Td,{omit:["layers","patternFeatures"]});var I1={get paint(){return Cm=Cm||new k({"fill-antialias":new nn(Ye.paint_fill["fill-antialias"]),"fill-opacity":new vn(Ye.paint_fill["fill-opacity"]),"fill-color":new vn(Ye.paint_fill["fill-color"]),"fill-outline-color":new vn(Ye.paint_fill["fill-outline-color"]),"fill-translate":new nn(Ye.paint_fill["fill-translate"]),"fill-translate-anchor":new nn(Ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new wu(Ye.paint_fill["fill-pattern"])})},get layout(){return Tm=Tm||new k({"fill-sort-key":new vn(Ye.layout_fill["fill-sort-key"])})}};class S1 extends h{constructor(i){super(i,I1)}recalculate(i,u){super.recalculate(i,u);const g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Td(i)}queryRadius(){return Jh(this.paint.get("fill-translate"))}queryIntersectsFeature(i,u,g,v,E,T,A){return cm(Kh(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),T.angle,A),v)}isTileClipped(){return!0}}const E1=P([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),T1=P([{name:"a_centroid",components:2,type:"Int16"}],4),{members:C1}=E1;var al={},L1=S,Lm=Ru;function Ru(o,i,u,g,v){this.properties={},this.extent=u,this.type=0,this._pbf=o,this._geometry=-1,this._keys=g,this._values=v,o.readFields(M1,this,i)}function M1(o,i,u){o==1?i.id=u.readVarint():o==2?function(g,v){for(var E=g.readVarint()+g.pos;g.pos<E;){var T=v._keys[g.readVarint()],A=v._values[g.readVarint()];v.properties[T]=A}}(u,i):o==3?i.type=u.readVarint():o==4&&(i._geometry=u.pos)}function A1(o){for(var i,u,g=0,v=0,E=o.length,T=E-1;v<E;T=v++)g+=((u=o[T]).x-(i=o[v]).x)*(i.y+u.y);return g}Ru.types=["Unknown","Point","LineString","Polygon"],Ru.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var i,u=o.readVarint()+o.pos,g=1,v=0,E=0,T=0,A=[];o.pos<u;){if(v<=0){var R=o.readVarint();g=7&R,v=R>>3}if(v--,g===1||g===2)E+=o.readSVarint(),T+=o.readSVarint(),g===1&&(i&&A.push(i),i=[]),i.push(new L1(E,T));else{if(g!==7)throw new Error("unknown command "+g);i&&i.push(i[0].clone())}}return i&&A.push(i),A},Ru.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var i=o.readVarint()+o.pos,u=1,g=0,v=0,E=0,T=1/0,A=-1/0,R=1/0,O=-1/0;o.pos<i;){if(g<=0){var j=o.readVarint();u=7&j,g=j>>3}if(g--,u===1||u===2)(v+=o.readSVarint())<T&&(T=v),v>A&&(A=v),(E+=o.readSVarint())<R&&(R=E),E>O&&(O=E);else if(u!==7)throw new Error("unknown command "+u)}return[T,R,A,O]},Ru.prototype.toGeoJSON=function(o,i,u){var g,v,E=this.extent*Math.pow(2,u),T=this.extent*o,A=this.extent*i,R=this.loadGeometry(),O=Ru.types[this.type];function j(te){for(var se=0;se<te.length;se++){var de=te[se];te[se]=[360*(de.x+T)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(de.y+A)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(g=0;g<R.length;g++)G[g]=R[g][0];j(R=G);break;case 2:for(g=0;g<R.length;g++)j(R[g]);break;case 3:for(R=function(te){var se=te.length;if(se<=1)return[te];for(var de,Ce,Re=[],nt=0;nt<se;nt++){var Ge=A1(te[nt]);Ge!==0&&(Ce===void 0&&(Ce=Ge<0),Ce===Ge<0?(de&&Re.push(de),de=[te[nt]]):de.push(te[nt]))}return de&&Re.push(de),Re}(R),g=0;g<R.length;g++)for(v=0;v<R[g].length;v++)j(R[g][v])}R.length===1?R=R[0]:O="Multi"+O;var X={type:"Feature",geometry:{type:O,coordinates:R},properties:this.properties};return"id"in this&&(X.id=this.id),X};var P1=Lm,Mm=Am;function Am(o,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(R1,this,i),this.length=this._features.length}function R1(o,i,u){o===15?i.version=u.readVarint():o===1?i.name=u.readString():o===5?i.extent=u.readVarint():o===2?i._features.push(u.pos):o===3?i._keys.push(u.readString()):o===4&&i._values.push(function(g){for(var v=null,E=g.readVarint()+g.pos;g.pos<E;){var T=g.readVarint()>>3;v=T===1?g.readString():T===2?g.readFloat():T===3?g.readDouble():T===4?g.readVarint64():T===5?g.readVarint():T===6?g.readSVarint():T===7?g.readBoolean():null}return v}(u))}Am.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var i=this._pbf.readVarint()+this._pbf.pos;return new P1(this._pbf,i,this.extent,this._keys,this._values)};var D1=Mm;function N1(o,i,u){if(o===3){var g=new D1(u,u.readVarint()+u.pos);g.length&&(i[g.name]=g)}}al.VectorTile=function(o,i){this.layers=o.readFields(N1,{},i)},al.VectorTileFeature=Lm,al.VectorTileLayer=Mm;const z1=al.VectorTileFeature.types,Cd=Math.pow(2,13);function Jc(o,i,u,g,v,E,T,A){o.emplaceBack(i,u,2*Math.floor(g*Cd)+T,v*Cd*2,E*Cd*2,Math.round(A))}class Ld{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new tl,this.centroidVertexArray=new zr,this.indexArray=new Ws,this.programConfigurations=new Hl(i.layers,i.zoom),this.segments=new Gn,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,g){this.features=[],this.hasPattern=Sd("fill-extrusion",this.layers,u);for(const{feature:v,id:E,index:T,sourceLayerIndex:A}of i){const R=this.layers[0]._featureFilter.needGeometry,O=Xl(v,R);if(!this.layers[0]._featureFilter.filter(new Ii(this.zoom),O,g))continue;const j={id:E,sourceLayerIndex:A,index:T,geometry:R?O.geometry:Wl(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(Ed("fill-extrusion",this.layers,j,this.zoom,u)):this.addFeature(j,j.geometry,T,g,{}),u.featureIndex.insert(v,j.geometry,T,A,this.index,!0)}}addFeatures(i,u,g){for(const v of this.features){const{geometry:E}=v;this.addFeature(v,E,v.index,u,g)}}update(i,u,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,C1),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,T1.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,u,g,v,E){for(const T of ja(u,500)){const A={x:0,y:0,vertexCount:0};let R=0;for(const se of T)R+=se.length;let O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const se of T){if(se.length===0||F1(se))continue;let de=0;for(let Ce=0;Ce<se.length;Ce++){const Re=se[Ce];if(Ce>=1){const nt=se[Ce-1];if(!O1(Re,nt)){O.vertexLength+4>Gn.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ge=Re.sub(nt)._perp()._unit(),Qe=nt.dist(Re);de+Qe>32768&&(de=0),Jc(this.layoutVertexArray,Re.x,Re.y,Ge.x,Ge.y,0,0,de),Jc(this.layoutVertexArray,Re.x,Re.y,Ge.x,Ge.y,0,1,de),A.x+=2*Re.x,A.y+=2*Re.y,A.vertexCount+=2,de+=Qe,Jc(this.layoutVertexArray,nt.x,nt.y,Ge.x,Ge.y,0,0,de),Jc(this.layoutVertexArray,nt.x,nt.y,Ge.x,Ge.y,0,1,de),A.x+=2*nt.x,A.y+=2*nt.y,A.vertexCount+=2;const ht=O.vertexLength;this.indexArray.emplaceBack(ht,ht+2,ht+1),this.indexArray.emplaceBack(ht+1,ht+2,ht+3),O.vertexLength+=4,O.primitiveLength+=2}}}}if(O.vertexLength+R>Gn.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(R,this.layoutVertexArray,this.indexArray)),z1[i.type]!=="Polygon")continue;const j=[],G=[],X=O.vertexLength;for(const se of T)if(se.length!==0){se!==T[0]&&G.push(j.length/2);for(let de=0;de<se.length;de++){const Ce=se[de];Jc(this.layoutVertexArray,Ce.x,Ce.y,0,0,1,1,0),A.x+=Ce.x,A.y+=Ce.y,A.vertexCount+=1,j.push(Ce.x),j.push(Ce.y)}}const te=wm(j,G);for(let se=0;se<te.length;se+=3)this.indexArray.emplaceBack(X+te[se],X+te[se+2],X+te[se+1]);O.primitiveLength+=te.length/3,O.vertexLength+=R;for(let se=0;se<A.vertexCount;se++){const de=Math.floor(A.x/A.vertexCount),Ce=Math.floor(A.y/A.vertexCount);this.centroidVertexArray.emplaceBack(de,Ce)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,g,E,v)}}function O1(o,i){return o.x===i.x&&(o.x<0||o.x>ar)||o.y===i.y&&(o.y<0||o.y>ar)}function F1(o){return o.every(i=>i.x<0)||o.every(i=>i.x>ar)||o.every(i=>i.y<0)||o.every(i=>i.y>ar)}let Pm;Qt("FillExtrusionBucket",Ld,{omit:["layers","features"]});var B1={get paint(){return Pm=Pm||new k({"fill-extrusion-opacity":new nn(Ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new vn(Ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new nn(Ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new nn(Ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new wu(Ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new vn(Ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new vn(Ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new nn(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class U1 extends h{constructor(i){super(i,B1)}createBucket(i){return new Ld(i)}queryRadius(){return Jh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,u,g,v,E,T,A,R){const O=Kh(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),T.angle,A),j=this.paint.get("fill-extrusion-height").evaluate(u,g),G=this.paint.get("fill-extrusion-base").evaluate(u,g),X=function(se,de,Ce,Re){const nt=[];for(const Ge of se){const Qe=[Ge.x,Ge.y,0,1];Qh(Qe,Qe,de),nt.push(new L(Qe[0]/Qe[3],Qe[1]/Qe[3]))}return nt}(O,R),te=function(se,de,Ce,Re){const nt=[],Ge=[],Qe=Re[8]*de,ht=Re[9]*de,Et=Re[10]*de,$t=Re[11]*de,yn=Re[8]*Ce,Wt=Re[9]*Ce,Zt=Re[10]*Ce,on=Re[11]*Ce;for(const tn of se){const Kt=[],yt=[];for(const cn of tn){const sn=cn.x,Sn=cn.y,vi=Re[0]*sn+Re[4]*Sn+Re[12],_i=Re[1]*sn+Re[5]*Sn+Re[13],vr=Re[2]*sn+Re[6]*Sn+Re[14],fo=Re[3]*sn+Re[7]*Sn+Re[15],Br=vr+Et,br=fo+$t,as=vi+yn,ls=_i+Wt,us=vr+Zt,Gi=fo+on,xr=new L((vi+Qe)/br,(_i+ht)/br);xr.z=Br/br,Kt.push(xr);const $r=new L(as/Gi,ls/Gi);$r.z=us/Gi,yt.push($r)}nt.push(Kt),Ge.push(yt)}return[nt,Ge]}(v,G,j,R);return function(se,de,Ce){let Re=1/0;cm(Ce,de)&&(Re=Rm(Ce,de[0]));for(let nt=0;nt<de.length;nt++){const Ge=de[nt],Qe=se[nt];for(let ht=0;ht<Ge.length-1;ht++){const Et=Ge[ht],$t=[Et,Ge[ht+1],Qe[ht+1],Qe[ht],Et];um(Ce,$t)&&(Re=Math.min(Re,Rm(Ce,$t)))}}return Re!==1/0&&Re}(te[0],te[1],X)}}function Kc(o,i){return o.x*i.x+o.y*i.y}function Rm(o,i){if(o.length===1){let u=0;const g=i[u++];let v;for(;!v||g.equals(v);)if(v=i[u++],!v)return 1/0;for(;u<i.length;u++){const E=i[u],T=o[0],A=v.sub(g),R=E.sub(g),O=T.sub(g),j=Kc(A,A),G=Kc(A,R),X=Kc(R,R),te=Kc(O,A),se=Kc(O,R),de=j*X-G*G,Ce=(X*te-G*se)/de,Re=(j*se-G*te)/de,nt=g.z*(1-Ce-Re)+v.z*Ce+E.z*Re;if(isFinite(nt))return nt}return 1/0}{let u=1/0;for(const g of i)u=Math.min(u,g.z);return u}}const j1=P([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:V1}=j1,q1=P([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:G1}=q1,Z1=al.VectorTileFeature.types,H1=Math.cos(Math.PI/180*37.5),Dm=Math.pow(2,14)/.5;class Md{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new Iu,this.layoutVertexArray2=new nl,this.indexArray=new Ws,this.programConfigurations=new Hl(i.layers,i.zoom),this.segments=new Gn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,g){this.hasPattern=Sd("line",this.layers,u);const v=this.layers[0].layout.get("line-sort-key"),E=!v.isConstant(),T=[];for(const{feature:A,id:R,index:O,sourceLayerIndex:j}of i){const G=this.layers[0]._featureFilter.needGeometry,X=Xl(A,G);if(!this.layers[0]._featureFilter.filter(new Ii(this.zoom),X,g))continue;const te=E?v.evaluate(X,{},g):void 0,se={id:R,properties:A.properties,type:A.type,sourceLayerIndex:j,index:O,geometry:G?X.geometry:Wl(A),patterns:{},sortKey:te};T.push(se)}E&&T.sort((A,R)=>A.sortKey-R.sortKey);for(const A of T){const{geometry:R,index:O,sourceLayerIndex:j}=A;if(this.hasPattern){const G=Ed("line",this.layers,A,this.zoom,u);this.patternFeatures.push(G)}else this.addFeature(A,R,O,g,{});u.featureIndex.insert(i[O].feature,R,O,j,this.index)}}update(i,u,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,g)}addFeatures(i,u,g){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,u,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,G1)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,V1),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,u,g,v,E){const T=this.layers[0].layout,A=T.get("line-join").evaluate(i,{}),R=T.get("line-cap"),O=T.get("line-miter-limit"),j=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const G of u)this.addLine(G,i,A,R,O,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,g,E,v)}addLine(i,u,g,v,E,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Re=0;Re<i.length-1;Re++)this.totalDistance+=i[Re].dist(i[Re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=Z1[u.type]==="Polygon";let R=i.length;for(;R>=2&&i[R-1].equals(i[R-2]);)R--;let O=0;for(;O<R-1&&i[O].equals(i[O+1]);)O++;if(R<(A?3:2))return;g==="bevel"&&(E=1.05);const j=this.overscaling<=16?15*ar/(512*this.overscaling):0,G=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let X,te,se,de,Ce;this.e1=this.e2=-1,A&&(X=i[R-2],Ce=i[O].sub(X)._unit()._perp());for(let Re=O;Re<R;Re++){if(se=Re===R-1?A?i[O+1]:void 0:i[Re+1],se&&i[Re].equals(se))continue;Ce&&(de=Ce),X&&(te=X),X=i[Re],Ce=se?se.sub(X)._unit()._perp():de,de=de||Ce;let nt=de.add(Ce);nt.x===0&&nt.y===0||nt._unit();const Ge=de.x*Ce.x+de.y*Ce.y,Qe=nt.x*Ce.x+nt.y*Ce.y,ht=Qe!==0?1/Qe:1/0,Et=2*Math.sqrt(2-2*Qe),$t=Qe<H1&&te&&se,yn=de.x*Ce.y-de.y*Ce.x>0;if($t&&Re>O){const on=X.dist(te);if(on>2*j){const tn=X.sub(X.sub(te)._mult(j/on)._round());this.updateDistance(te,tn),this.addCurrentVertex(tn,de,0,0,G),te=tn}}const Wt=te&&se;let Zt=Wt?g:A?"butt":v;if(Wt&&Zt==="round"&&(ht<T?Zt="miter":ht<=2&&(Zt="fakeround")),Zt==="miter"&&ht>E&&(Zt="bevel"),Zt==="bevel"&&(ht>2&&(Zt="flipbevel"),ht<E&&(Zt="miter")),te&&this.updateDistance(te,X),Zt==="miter")nt._mult(ht),this.addCurrentVertex(X,nt,0,0,G);else if(Zt==="flipbevel"){if(ht>100)nt=Ce.mult(-1);else{const on=ht*de.add(Ce).mag()/de.sub(Ce).mag();nt._perp()._mult(on*(yn?-1:1))}this.addCurrentVertex(X,nt,0,0,G),this.addCurrentVertex(X,nt.mult(-1),0,0,G)}else if(Zt==="bevel"||Zt==="fakeround"){const on=-Math.sqrt(ht*ht-1),tn=yn?on:0,Kt=yn?0:on;if(te&&this.addCurrentVertex(X,de,tn,Kt,G),Zt==="fakeround"){const yt=Math.round(180*Et/Math.PI/20);for(let cn=1;cn<yt;cn++){let sn=cn/yt;if(sn!==.5){const vi=sn-.5;sn+=sn*vi*(sn-1)*((1.0904+Ge*(Ge*(3.55645-1.43519*Ge)-3.2452))*vi*vi+(.848013+Ge*(.215638*Ge-1.06021)))}const Sn=Ce.sub(de)._mult(sn)._add(de)._unit()._mult(yn?-1:1);this.addHalfVertex(X,Sn.x,Sn.y,!1,yn,0,G)}}se&&this.addCurrentVertex(X,Ce,-tn,-Kt,G)}else if(Zt==="butt")this.addCurrentVertex(X,nt,0,0,G);else if(Zt==="square"){const on=te?1:-1;this.addCurrentVertex(X,nt,on,on,G)}else Zt==="round"&&(te&&(this.addCurrentVertex(X,de,0,0,G),this.addCurrentVertex(X,de,1,1,G,!0)),se&&(this.addCurrentVertex(X,Ce,-1,-1,G,!0),this.addCurrentVertex(X,Ce,0,0,G)));if($t&&Re<R-1){const on=X.dist(se);if(on>2*j){const tn=X.add(se.sub(X)._mult(j/on)._round());this.updateDistance(X,tn),this.addCurrentVertex(tn,Ce,0,0,G),X=tn}}}}addCurrentVertex(i,u,g,v,E,T=!1){const A=u.y*v-u.x,R=-u.y-u.x*v;this.addHalfVertex(i,u.x+u.y*g,u.y-u.x*g,T,!1,g,E),this.addHalfVertex(i,A,R,T,!0,-v,E),this.distance>Dm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,u,g,v,E,T))}addHalfVertex({x:i,y:u},g,v,E,T,A,R){const O=.5*(this.lineClips?this.scaledDistance*(Dm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(E?1:0),(u<<1)+(T?1:0),Math.round(63*g)+128,Math.round(63*v)+128,1+(A===0?0:A<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const j=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,j),R.primitiveLength++),T?this.e2=j:this.e1=j}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,u){this.distance+=i.dist(u),this.updateScaledDistance()}}let Nm,zm;Qt("LineBucket",Md,{omit:["layers","patternFeatures"]});var Om={get paint(){return zm=zm||new k({"line-opacity":new vn(Ye.paint_line["line-opacity"]),"line-color":new vn(Ye.paint_line["line-color"]),"line-translate":new nn(Ye.paint_line["line-translate"]),"line-translate-anchor":new nn(Ye.paint_line["line-translate-anchor"]),"line-width":new vn(Ye.paint_line["line-width"]),"line-gap-width":new vn(Ye.paint_line["line-gap-width"]),"line-offset":new vn(Ye.paint_line["line-offset"]),"line-blur":new vn(Ye.paint_line["line-blur"]),"line-dasharray":new ku(Ye.paint_line["line-dasharray"]),"line-pattern":new wu(Ye.paint_line["line-pattern"]),"line-gradient":new Vc(Ye.paint_line["line-gradient"])})},get layout(){return Nm=Nm||new k({"line-cap":new nn(Ye.layout_line["line-cap"]),"line-join":new vn(Ye.layout_line["line-join"]),"line-miter-limit":new nn(Ye.layout_line["line-miter-limit"]),"line-round-limit":new nn(Ye.layout_line["line-round-limit"]),"line-sort-key":new vn(Ye.layout_line["line-sort-key"])})}};class W1 extends vn{possiblyEvaluate(i,u){return u=new Ii(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(i,u)}evaluate(i,u,g,v){return u=he({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(i,u,g,v)}}let rf;class X1 extends h{constructor(i){super(i,Om),this.gradientVersion=0,rf||(rf=new W1(Om.paint.properties["line-width"].specification),rf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!function(g){return g._styleExpression!==void 0}(u)&&u._styleExpression.expression instanceof Oo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,u){super.recalculate(i,u),this.paint._values["line-floorwidth"]=rf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Md(i)}queryRadius(i){const u=i,g=Fm(Zc("line-width",this,u),Zc("line-gap-width",this,u)),v=Zc("line-offset",this,u);return g/2+Math.abs(v)+Jh(this.paint.get("line-translate"))}queryIntersectsFeature(i,u,g,v,E,T,A){const R=Kh(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),T.angle,A),O=A/2*Fm(this.paint.get("line-width").evaluate(u,g),this.paint.get("line-gap-width").evaluate(u,g)),j=this.paint.get("line-offset").evaluate(u,g);return j&&(v=function(G,X){const te=[];for(let se=0;se<G.length;se++){const de=G[se],Ce=[];for(let Re=0;Re<de.length;Re++){const nt=de[Re-1],Ge=de[Re],Qe=de[Re+1],ht=Re===0?new L(0,0):Ge.sub(nt)._unit()._perp(),Et=Re===de.length-1?new L(0,0):Qe.sub(Ge)._unit()._perp(),$t=ht._add(Et)._unit(),yn=$t.x*Et.x+$t.y*Et.y;yn!==0&&$t._mult(1/yn),Ce.push($t._mult(X)._add(Ge))}te.push(Ce)}return te}(v,j*A)),function(G,X,te){for(let se=0;se<X.length;se++){const de=X[se];if(G.length>=3){for(let Ce=0;Ce<de.length;Ce++)if(Mu(G,de[Ce]))return!0}if(i1(G,de,te))return!0}return!1}(R,v,O)}isTileClipped(){return!0}}function Fm(o,i){return i>0?i+2*o:o}const $1=P([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Y1=P([{name:"a_projected_pos",components:3,type:"Float32"}],4);P([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const J1=P([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);P([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Bm=P([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),K1=P([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Q1(o,i,u){return o.sections.forEach(g=>{g.text=function(v,E,T){const A=E.layout.get("text-transform").evaluate(T,{});return A==="uppercase"?v=v.toLocaleUpperCase():A==="lowercase"&&(v=v.toLocaleLowerCase()),Is.applyArabicShaping&&(v=Is.applyArabicShaping(v)),v}(g.text,i,u)}),o}P([{name:"triangle",components:3,type:"Uint16"}]),P([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),P([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),P([{type:"Float32",name:"offsetX"}]),P([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),P([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Qc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var pr=24,Um=gi,jm=function(o,i,u,g,v){var E,T,A=8*v-g-1,R=(1<<A)-1,O=R>>1,j=-7,G=u?v-1:0,X=u?-1:1,te=o[i+G];for(G+=X,E=te&(1<<-j)-1,te>>=-j,j+=A;j>0;E=256*E+o[i+G],G+=X,j-=8);for(T=E&(1<<-j)-1,E>>=-j,j+=g;j>0;T=256*T+o[i+G],G+=X,j-=8);if(E===0)E=1-O;else{if(E===R)return T?NaN:1/0*(te?-1:1);T+=Math.pow(2,g),E-=O}return(te?-1:1)*T*Math.pow(2,E-g)},Vm=function(o,i,u,g,v,E){var T,A,R,O=8*E-v-1,j=(1<<O)-1,G=j>>1,X=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,te=g?0:E-1,se=g?1:-1,de=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(A=isNaN(i)?1:0,T=j):(T=Math.floor(Math.log(i)/Math.LN2),i*(R=Math.pow(2,-T))<1&&(T--,R*=2),(i+=T+G>=1?X/R:X*Math.pow(2,1-G))*R>=2&&(T++,R/=2),T+G>=j?(A=0,T=j):T+G>=1?(A=(i*R-1)*Math.pow(2,v),T+=G):(A=i*Math.pow(2,G-1)*Math.pow(2,v),T=0));v>=8;o[u+te]=255&A,te+=se,A/=256,v-=8);for(T=T<<v|A,O+=v;O>0;o[u+te]=255&T,te+=se,T/=256,O-=8);o[u+te-se]|=128*de};function gi(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}gi.Varint=0,gi.Fixed64=1,gi.Bytes=2,gi.Fixed32=5;var Ad=4294967296,qm=1/Ad,Gm=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Ea(o){return o.type===gi.Bytes?o.readVarint()+o.pos:o.pos+1}function Du(o,i,u){return u?4294967296*i+(o>>>0):4294967296*(i>>>0)+(o>>>0)}function Zm(o,i,u){var g=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));u.realloc(g);for(var v=u.pos-1;v>=o;v--)u.buf[v+g]=u.buf[v]}function eb(o,i){for(var u=0;u<o.length;u++)i.writeVarint(o[u])}function tb(o,i){for(var u=0;u<o.length;u++)i.writeSVarint(o[u])}function nb(o,i){for(var u=0;u<o.length;u++)i.writeFloat(o[u])}function ib(o,i){for(var u=0;u<o.length;u++)i.writeDouble(o[u])}function rb(o,i){for(var u=0;u<o.length;u++)i.writeBoolean(o[u])}function sb(o,i){for(var u=0;u<o.length;u++)i.writeFixed32(o[u])}function ob(o,i){for(var u=0;u<o.length;u++)i.writeSFixed32(o[u])}function ab(o,i){for(var u=0;u<o.length;u++)i.writeFixed64(o[u])}function lb(o,i){for(var u=0;u<o.length;u++)i.writeSFixed64(o[u])}function sf(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+16777216*o[i+3]}function Nu(o,i,u){o[u]=i,o[u+1]=i>>>8,o[u+2]=i>>>16,o[u+3]=i>>>24}function Hm(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+(o[i+3]<<24)}gi.prototype={destroy:function(){this.buf=null},readFields:function(o,i,u){for(u=u||this.length;this.pos<u;){var g=this.readVarint(),v=g>>3,E=this.pos;this.type=7&g,o(v,i,this),this.pos===E&&this.skip(g)}return i},readMessage:function(o,i){return this.readFields(o,i,this.readVarint()+this.pos)},readFixed32:function(){var o=sf(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=Hm(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=sf(this.buf,this.pos)+sf(this.buf,this.pos+4)*Ad;return this.pos+=8,o},readSFixed64:function(){var o=sf(this.buf,this.pos)+Hm(this.buf,this.pos+4)*Ad;return this.pos+=8,o},readFloat:function(){var o=jm(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=jm(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var i,u,g=this.buf;return i=127&(u=g[this.pos++]),u<128?i:(i|=(127&(u=g[this.pos++]))<<7,u<128?i:(i|=(127&(u=g[this.pos++]))<<14,u<128?i:(i|=(127&(u=g[this.pos++]))<<21,u<128?i:function(v,E,T){var A,R,O=T.buf;if(A=(112&(R=O[T.pos++]))>>4,R<128||(A|=(127&(R=O[T.pos++]))<<3,R<128)||(A|=(127&(R=O[T.pos++]))<<10,R<128)||(A|=(127&(R=O[T.pos++]))<<17,R<128)||(A|=(127&(R=O[T.pos++]))<<24,R<128)||(A|=(1&(R=O[T.pos++]))<<31,R<128))return Du(v,A,E);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(u=g[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,i=this.pos;return this.pos=o,o-i>=12&&Gm?function(u,g,v){return Gm.decode(u.subarray(g,v))}(this.buf,i,o):function(u,g,v){for(var E="",T=g;T<v;){var A,R,O,j=u[T],G=null,X=j>239?4:j>223?3:j>191?2:1;if(T+X>v)break;X===1?j<128&&(G=j):X===2?(192&(A=u[T+1]))==128&&(G=(31&j)<<6|63&A)<=127&&(G=null):X===3?(R=u[T+2],(192&(A=u[T+1]))==128&&(192&R)==128&&((G=(15&j)<<12|(63&A)<<6|63&R)<=2047||G>=55296&&G<=57343)&&(G=null)):X===4&&(R=u[T+2],O=u[T+3],(192&(A=u[T+1]))==128&&(192&R)==128&&(192&O)==128&&((G=(15&j)<<18|(63&A)<<12|(63&R)<<6|63&O)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,X=1):G>65535&&(G-=65536,E+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),E+=String.fromCharCode(G),T+=X}return E}(this.buf,i,o)},readBytes:function(){var o=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,o);return this.pos=o,i},readPackedVarint:function(o,i){if(this.type!==gi.Bytes)return o.push(this.readVarint(i));var u=Ea(this);for(o=o||[];this.pos<u;)o.push(this.readVarint(i));return o},readPackedSVarint:function(o){if(this.type!==gi.Bytes)return o.push(this.readSVarint());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==gi.Bytes)return o.push(this.readBoolean());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==gi.Bytes)return o.push(this.readFloat());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==gi.Bytes)return o.push(this.readDouble());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==gi.Bytes)return o.push(this.readFixed32());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==gi.Bytes)return o.push(this.readSFixed32());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==gi.Bytes)return o.push(this.readFixed64());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==gi.Bytes)return o.push(this.readSFixed64());var i=Ea(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed64());return o},skip:function(o){var i=7&o;if(i===gi.Varint)for(;this.buf[this.pos++]>127;);else if(i===gi.Bytes)this.pos=this.readVarint()+this.pos;else if(i===gi.Fixed32)this.pos+=4;else{if(i!==gi.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(o,i){this.writeVarint(o<<3|i)},realloc:function(o){for(var i=this.length||16;i<this.pos+o;)i*=2;if(i!==this.length){var u=new Uint8Array(i);u.set(this.buf),this.buf=u,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Nu(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Nu(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Nu(this.buf,-1&o,this.pos),Nu(this.buf,Math.floor(o*qm),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Nu(this.buf,-1&o,this.pos),Nu(this.buf,Math.floor(o*qm),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(i,u){var g,v;if(i>=0?(g=i%4294967296|0,v=i/4294967296|0):(v=~(-i/4294967296),4294967295^(g=~(-i%4294967296))?g=g+1|0:(g=0,v=v+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(E,T,A){A.buf[A.pos++]=127&E|128,E>>>=7,A.buf[A.pos++]=127&E|128,E>>>=7,A.buf[A.pos++]=127&E|128,E>>>=7,A.buf[A.pos++]=127&E|128,A.buf[A.pos]=127&(E>>>=7)}(g,0,u),function(E,T){var A=(7&E)<<4;T.buf[T.pos++]|=A|((E>>>=3)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E|((E>>>=7)?128:0),E&&(T.buf[T.pos++]=127&E)))))}(v,u)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var i=this.pos;this.pos=function(g,v,E){for(var T,A,R=0;R<v.length;R++){if((T=v.charCodeAt(R))>55295&&T<57344){if(!A){T>56319||R+1===v.length?(g[E++]=239,g[E++]=191,g[E++]=189):A=T;continue}if(T<56320){g[E++]=239,g[E++]=191,g[E++]=189,A=T;continue}T=A-55296<<10|T-56320|65536,A=null}else A&&(g[E++]=239,g[E++]=191,g[E++]=189,A=null);T<128?g[E++]=T:(T<2048?g[E++]=T>>6|192:(T<65536?g[E++]=T>>12|224:(g[E++]=T>>18|240,g[E++]=T>>12&63|128),g[E++]=T>>6&63|128),g[E++]=63&T|128)}return E}(this.buf,o,this.pos);var u=this.pos-i;u>=128&&Zm(i,u,this),this.pos=i-1,this.writeVarint(u),this.pos+=u},writeFloat:function(o){this.realloc(4),Vm(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),Vm(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var i=o.length;this.writeVarint(i),this.realloc(i);for(var u=0;u<i;u++)this.buf[this.pos++]=o[u]},writeRawMessage:function(o,i){this.pos++;var u=this.pos;o(i,this);var g=this.pos-u;g>=128&&Zm(u,g,this),this.pos=u-1,this.writeVarint(g),this.pos+=g},writeMessage:function(o,i,u){this.writeTag(o,gi.Bytes),this.writeRawMessage(i,u)},writePackedVarint:function(o,i){i.length&&this.writeMessage(o,eb,i)},writePackedSVarint:function(o,i){i.length&&this.writeMessage(o,tb,i)},writePackedBoolean:function(o,i){i.length&&this.writeMessage(o,rb,i)},writePackedFloat:function(o,i){i.length&&this.writeMessage(o,nb,i)},writePackedDouble:function(o,i){i.length&&this.writeMessage(o,ib,i)},writePackedFixed32:function(o,i){i.length&&this.writeMessage(o,sb,i)},writePackedSFixed32:function(o,i){i.length&&this.writeMessage(o,ob,i)},writePackedFixed64:function(o,i){i.length&&this.writeMessage(o,ab,i)},writePackedSFixed64:function(o,i){i.length&&this.writeMessage(o,lb,i)},writeBytesField:function(o,i){this.writeTag(o,gi.Bytes),this.writeBytes(i)},writeFixed32Field:function(o,i){this.writeTag(o,gi.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(o,i){this.writeTag(o,gi.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(o,i){this.writeTag(o,gi.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(o,i){this.writeTag(o,gi.Fixed64),this.writeSFixed64(i)},writeVarintField:function(o,i){this.writeTag(o,gi.Varint),this.writeVarint(i)},writeSVarintField:function(o,i){this.writeTag(o,gi.Varint),this.writeSVarint(i)},writeStringField:function(o,i){this.writeTag(o,gi.Bytes),this.writeString(i)},writeFloatField:function(o,i){this.writeTag(o,gi.Fixed32),this.writeFloat(i)},writeDoubleField:function(o,i){this.writeTag(o,gi.Fixed64),this.writeDouble(i)},writeBooleanField:function(o,i){this.writeVarintField(o,!!i)}};var Pd=x(Um);const Rd=3;function ub(o,i,u){o===1&&u.readMessage(cb,i)}function cb(o,i,u){if(o===3){const{id:g,bitmap:v,width:E,height:T,left:A,top:R,advance:O}=u.readMessage(hb,{});i.push({id:g,bitmap:new Wc({width:E+2*Rd,height:T+2*Rd},v),metrics:{width:E,height:T,left:A,top:R,advance:O}})}}function hb(o,i,u){o===1?i.id=u.readVarint():o===2?i.bitmap=u.readBytes():o===3?i.width=u.readVarint():o===4?i.height=u.readVarint():o===5?i.left=u.readSVarint():o===6?i.top=u.readSVarint():o===7&&(i.advance=u.readVarint())}const Wm=Rd;function Xm(o){let i=0,u=0;for(const T of o)i+=T.w*T.h,u=Math.max(u,T.w);o.sort((T,A)=>A.h-T.h);const g=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),u),h:1/0}];let v=0,E=0;for(const T of o)for(let A=g.length-1;A>=0;A--){const R=g[A];if(!(T.w>R.w||T.h>R.h)){if(T.x=R.x,T.y=R.y,E=Math.max(E,T.y+T.h),v=Math.max(v,T.x+T.w),T.w===R.w&&T.h===R.h){const O=g.pop();A<g.length&&(g[A]=O)}else T.h===R.h?(R.x+=T.w,R.w-=T.w):T.w===R.w?(R.y+=T.h,R.h-=T.h):(g.push({x:R.x+T.w,y:R.y,w:R.w-T.w,h:T.h}),R.y+=T.h,R.h-=T.h);break}}return{w:v,h:E,fill:i/(v*E)||0}}const Es=1;class Dd{constructor(i,{pixelRatio:u,version:g,stretchX:v,stretchY:E,content:T,textFitWidth:A,textFitHeight:R}){this.paddedRect=i,this.pixelRatio=u,this.stretchX=v,this.stretchY=E,this.content=T,this.version=g,this.textFitWidth=A,this.textFitHeight=R}get tl(){return[this.paddedRect.x+Es,this.paddedRect.y+Es]}get br(){return[this.paddedRect.x+this.paddedRect.w-Es,this.paddedRect.y+this.paddedRect.h-Es]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Es)/this.pixelRatio,(this.paddedRect.h-2*Es)/this.pixelRatio]}}class $m{constructor(i,u){const g={},v={};this.haveRenderCallbacks=[];const E=[];this.addImages(i,g,E),this.addImages(u,v,E);const{w:T,h:A}=Xm(E),R=new Xs({width:T||1,height:A||1});for(const O in i){const j=i[O],G=g[O].paddedRect;Xs.copy(j.data,R,{x:0,y:0},{x:G.x+Es,y:G.y+Es},j.data)}for(const O in u){const j=u[O],G=v[O].paddedRect,X=G.x+Es,te=G.y+Es,se=j.data.width,de=j.data.height;Xs.copy(j.data,R,{x:0,y:0},{x:X,y:te},j.data),Xs.copy(j.data,R,{x:0,y:de-1},{x:X,y:te-1},{width:se,height:1}),Xs.copy(j.data,R,{x:0,y:0},{x:X,y:te+de},{width:se,height:1}),Xs.copy(j.data,R,{x:se-1,y:0},{x:X-1,y:te},{width:1,height:de}),Xs.copy(j.data,R,{x:0,y:0},{x:X+se,y:te},{width:1,height:de})}this.image=R,this.iconPositions=g,this.patternPositions=v}addImages(i,u,g){for(const v in i){const E=i[v],T={x:0,y:0,w:E.data.width+2*Es,h:E.data.height+2*Es};g.push(T),u[v]=new Dd(T,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(v)}}patchUpdatedImages(i,u){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const g in i.updatedImages)this.patchUpdatedImage(this.iconPositions[g],i.getImage(g),u),this.patchUpdatedImage(this.patternPositions[g],i.getImage(g),u)}patchUpdatedImage(i,u,g){if(!i||!u||i.version===u.version)return;i.version=u.version;const[v,E]=i.tl;g.update(u.data,void 0,{x:v,y:E})}}var ll;Qt("ImagePosition",Dd),Qt("ImageAtlas",$m),m.ah=void 0,(ll=m.ah||(m.ah={}))[ll.none=0]="none",ll[ll.horizontal=1]="horizontal",ll[ll.vertical=2]="vertical",ll[ll.horizontalOnly=3]="horizontalOnly";const eh=-17;class th{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,u){const g=new th;return g.scale=i||1,g.fontStack=u,g}static forImage(i){const u=new th;return u.imageName=i,u}}class zu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,u){const g=new zu;for(let v=0;v<i.sections.length;v++){const E=i.sections[v];E.image?g.addImageSection(E):g.addTextSection(E,u)}return g}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let u="";for(let g=0;g<i.length;g++){const v=i.charCodeAt(g+1)||null,E=i.charCodeAt(g-1)||null;u+=v&&Gh(v)&&!Qc[i[g+1]]||E&&Gh(E)&&!Qc[i[g-1]]||!Qc[i[g]]?i[g]:Qc[i[g]]}return u}(this.text)}trim(){let i=0;for(let g=0;g<this.text.length&&af[this.text.charCodeAt(g)];g++)i++;let u=this.text.length;for(let g=this.text.length-1;g>=0&&g>=i&&af[this.text.charCodeAt(g)];g--)u--;this.text=this.text.substring(i,u),this.sectionIndex=this.sectionIndex.slice(i,u)}substring(i,u){const g=new zu;return g.text=this.text.substring(i,u),g.sectionIndex=this.sectionIndex.slice(i,u),g.sections=this.sections,g}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,u)=>Math.max(i,this.sections[u].scale),0)}addTextSection(i,u){this.text+=i.text,this.sections.push(th.forText(i.scale,i.fontStack||u));const g=this.sections.length-1;for(let v=0;v<i.text.length;++v)this.sectionIndex.push(g)}addImageSection(i){const u=i.image?i.image.name:"";if(u.length===0)return void Ue("Can't add FormattedSection with an empty image.");const g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCharCode(g),this.sections.push(th.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Ue("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function of(o,i,u,g,v,E,T,A,R,O,j,G,X,te,se){const de=zu.fromFeature(o,v);let Ce;G===m.ah.vertical&&de.verticalizePunctuation();const{processBidirectionalText:Re,processStyledBidirectionalText:nt}=Is;if(Re&&de.sections.length===1){Ce=[];const ht=Re(de.toString(),Nd(de,O,E,i,g,te));for(const Et of ht){const $t=new zu;$t.text=Et,$t.sections=de.sections;for(let yn=0;yn<Et.length;yn++)$t.sectionIndex.push(0);Ce.push($t)}}else if(nt){Ce=[];const ht=nt(de.text,de.sectionIndex,Nd(de,O,E,i,g,te));for(const Et of ht){const $t=new zu;$t.text=Et[0],$t.sectionIndex=Et[1],$t.sections=de.sections,Ce.push($t)}}else Ce=function(ht,Et){const $t=[],yn=ht.text;let Wt=0;for(const Zt of Et)$t.push(ht.substring(Wt,Zt)),Wt=Zt;return Wt<yn.length&&$t.push(ht.substring(Wt,yn.length)),$t}(de,Nd(de,O,E,i,g,te));const Ge=[],Qe={positionedLines:Ge,text:de.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:G,iconsInText:!1,verticalizable:!1};return function(ht,Et,$t,yn,Wt,Zt,on,tn,Kt,yt,cn,sn){let Sn=0,vi=eh,_i=0,vr=0;const fo=tn==="right"?1:tn==="left"?0:.5;let Br=0;for(const Gi of Wt){Gi.trim();const xr=Gi.getMaxScale(),$r=(xr-1)*pr,Ur={positionedGlyphs:[],lineOffset:0};ht.positionedLines[Br]=Ur;const cs=Ur.positionedGlyphs;let jr=0;if(!Gi.length()){vi+=Zt,++Br;continue}for(let Ts=0;Ts<Gi.length();Ts++){const oi=Gi.getSection(Ts),xi=Gi.getSectionIndex(Ts),Ci=Gi.getCharCode(Ts);let Bs=0,Ui=null,Uu=null,na=null,ia=pr;const po=!(Kt===m.ah.horizontal||!cn&&!Uc(Ci)||cn&&(af[Ci]||(br=Ci,/\p{sc=Arab}/u.test(String.fromCodePoint(br)))));if(oi.imageName){const Js=yn[oi.imageName];if(!Js)continue;na=oi.imageName,ht.iconsInText=ht.iconsInText||!0,Uu=Js.paddedRect;const Rr=Js.displaySize;oi.scale=oi.scale*pr/sn,Ui={width:Rr[0],height:Rr[1],left:Es,top:-Wm,advance:po?Rr[1]:Rr[0]},Bs=$r+(pr-Rr[1]*oi.scale),ia=Ui.advance;const Ta=po?Rr[0]*oi.scale-pr*xr:Rr[1]*oi.scale-pr*xr;Ta>0&&Ta>jr&&(jr=Ta)}else{const Js=$t[oi.fontStack],Rr=Js&&Js[Ci];if(Rr&&Rr.rect)Uu=Rr.rect,Ui=Rr.metrics;else{const Ta=Et[oi.fontStack],ah=Ta&&Ta[Ci];if(!ah)continue;Ui=ah.metrics}Bs=(xr-oi.scale)*pr}po?(ht.verticalizable=!0,cs.push({glyph:Ci,imageName:na,x:Sn,y:vi+Bs,vertical:po,scale:oi.scale,fontStack:oi.fontStack,sectionIndex:xi,metrics:Ui,rect:Uu}),Sn+=ia*oi.scale+yt):(cs.push({glyph:Ci,imageName:na,x:Sn,y:vi+Bs,vertical:po,scale:oi.scale,fontStack:oi.fontStack,sectionIndex:xi,metrics:Ui,rect:Uu}),Sn+=Ui.advance*oi.scale+yt)}cs.length!==0&&(_i=Math.max(Sn-yt,_i),mb(cs,0,cs.length-1,fo,jr)),Sn=0;const Ys=Zt*xr+jr;Ur.lineOffset=Math.max(jr,$r),vi+=Ys,vr=Math.max(Ys,vr),++Br}var br;const as=vi-eh,{horizontalAlign:ls,verticalAlign:us}=zd(on);(function(Gi,xr,$r,Ur,cs,jr,Ys,Ts,oi){const xi=(xr-$r)*cs;let Ci=0;Ci=jr!==Ys?-Ts*Ur-eh:(-Ur*oi+.5)*Ys;for(const Bs of Gi)for(const Ui of Bs.positionedGlyphs)Ui.x+=xi,Ui.y+=Ci})(ht.positionedLines,fo,ls,us,_i,vr,Zt,as,Wt.length),ht.top+=-us*as,ht.bottom=ht.top+as,ht.left+=-ls*_i,ht.right=ht.left+_i}(Qe,i,u,g,Ce,T,A,R,G,O,X,se),!function(ht){for(const Et of ht)if(Et.positionedGlyphs.length!==0)return!1;return!0}(Ge)&&Qe}const af={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},fb={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},db={40:!0};function Ym(o,i,u,g,v,E){if(i.imageName){const T=g[i.imageName];return T?T.displaySize[0]*i.scale*pr/E+v:0}{const T=u[i.fontStack],A=T&&T[o];return A?A.metrics.advance*i.scale+v:0}}function Jm(o,i,u,g){const v=Math.pow(o-i,2);return g?o<i?v/2:2*v:v+Math.abs(u)*u}function pb(o,i,u){let g=0;return o===10&&(g-=1e4),u&&(g+=150),o!==40&&o!==65288||(g+=50),i!==41&&i!==65289||(g+=50),g}function Km(o,i,u,g,v,E){let T=null,A=Jm(i,u,v,E);for(const R of g){const O=Jm(i-R.x,u,v,E)+R.badness;O<=A&&(T=R,A=O)}return{index:o,x:i,priorBreak:T,badness:A}}function Qm(o){return o?Qm(o.priorBreak).concat(o.index):[]}function Nd(o,i,u,g,v,E){if(!o)return[];const T=[],A=function(G,X,te,se,de,Ce){let Re=0;for(let nt=0;nt<G.length();nt++){const Ge=G.getSection(nt);Re+=Ym(G.getCharCode(nt),Ge,se,de,X,Ce)}return Re/Math.max(1,Math.ceil(Re/te))}(o,i,u,g,v,E),R=o.text.indexOf("​")>=0;let O=0;for(let G=0;G<o.length();G++){const X=o.getSection(G),te=o.getCharCode(G);if(af[te]||(O+=Ym(te,X,g,v,i,E)),G<o.length()-1){const se=!((j=te)<11904)&&(!!qn["CJK Compatibility Forms"](j)||!!qn["CJK Compatibility"](j)||!!qn["CJK Strokes"](j)||!!qn["CJK Symbols and Punctuation"](j)||!!qn["Enclosed CJK Letters and Months"](j)||!!qn["Halfwidth and Fullwidth Forms"](j)||!!qn["Ideographic Description Characters"](j)||!!qn["Vertical Forms"](j)||qh.test(String.fromCodePoint(j)));(fb[te]||se||X.imageName||G!==o.length()-2&&db[o.getCharCode(G+1)])&&T.push(Km(G+1,O,A,T,pb(te,o.getCharCode(G+1),se&&R),!1))}}var j;return Qm(Km(o.length(),O,A,T,0,!0))}function zd(o){let i=.5,u=.5;switch(o){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:i,verticalAlign:u}}function mb(o,i,u,g,v){if(!g&&!v)return;const E=o[u],T=(o[u].x+E.metrics.advance*E.scale)*g;for(let A=i;A<=u;A++)o[A].x-=T,o[A].y+=v}function gb(o,i,u){const{horizontalAlign:g,verticalAlign:v}=zd(u),E=i[0]-o.displaySize[0]*g,T=i[1]-o.displaySize[1]*v;return{image:o,top:T,bottom:T+o.displaySize[1],left:E,right:E+o.displaySize[0]}}function eg(o){var i,u;let g=o.left,v=o.top,E=o.right-g,T=o.bottom-v;const A=(i=o.image.textFitWidth)!==null&&i!==void 0?i:"stretchOrShrink",R=(u=o.image.textFitHeight)!==null&&u!==void 0?u:"stretchOrShrink",O=(o.image.content[2]-o.image.content[0])/(o.image.content[3]-o.image.content[1]);if(R==="proportional"){if(A==="stretchOnly"&&E/T<O||A==="proportional"){const j=Math.ceil(T*O);g*=j/E,E=j}}else if(A==="proportional"&&R==="stretchOnly"&&O!==0&&E/T>O){const j=Math.ceil(E/O);v*=j/T,T=j}return{x1:g,y1:v,x2:g+E,y2:v+T}}function tg(o,i,u,g,v,E){const T=o.image;let A;if(T.content){const Ce=T.content,Re=T.pixelRatio||1;A=[Ce[0]/Re,Ce[1]/Re,T.displaySize[0]-Ce[2]/Re,T.displaySize[1]-Ce[3]/Re]}const R=i.left*E,O=i.right*E;let j,G,X,te;u==="width"||u==="both"?(te=v[0]+R-g[3],G=v[0]+O+g[1]):(te=v[0]+(R+O-T.displaySize[0])/2,G=te+T.displaySize[0]);const se=i.top*E,de=i.bottom*E;return u==="height"||u==="both"?(j=v[1]+se-g[0],X=v[1]+de+g[2]):(j=v[1]+(se+de-T.displaySize[1])/2,X=j+T.displaySize[1]),{image:T,top:j,right:G,bottom:X,left:te,collisionPadding:A}}const nh=255,ta=128,ul=nh*ta;function ng(o,i){const{expression:u}=i;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Ii(o+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:g,interpolationType:v}=u;let E=0;for(;E<g.length&&g[E]<=o;)E++;E=Math.max(0,E-1);let T=E;for(;T<g.length&&g[T]<o+1;)T++;T=Math.min(g.length-1,T);const A=g[E],R=g[T];return u.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:R,interpolationType:v}:{kind:"camera",minZoom:A,maxZoom:R,minSize:u.evaluate(new Ii(A)),maxSize:u.evaluate(new Ii(R)),interpolationType:v}}}function Od(o,i,u){let g="never";const v=o.get(i);return v?g=v:o.get(u)&&(g="always"),g}const _b=al.VectorTileFeature.types,yb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function lf(o,i,u,g,v,E,T,A,R,O,j,G,X){const te=A?Math.min(ul,Math.round(A[0])):0,se=A?Math.min(ul,Math.round(A[1])):0;o.emplaceBack(i,u,Math.round(32*g),Math.round(32*v),E,T,(te<<1)+(R?1:0),se,16*O,16*j,256*G,256*X)}function Fd(o,i,u){o.emplaceBack(i.x,i.y,u),o.emplaceBack(i.x,i.y,u),o.emplaceBack(i.x,i.y,u),o.emplaceBack(i.x,i.y,u)}function vb(o){for(const i of o.sections)if(fd(i.text))return!0;return!1}class Bd{constructor(i){this.layoutVertexArray=new Su,this.indexArray=new Ws,this.programConfigurations=i,this.segments=new Gn,this.dynamicLayoutVertexArray=new qc,this.opacityVertexArray=new Os,this.hasVisibleVertices=!1,this.placedSymbolArray=new Si}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,u,g,v){this.isEmpty()||(g&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,$1.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,Y1.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,yb,!0),this.opacityVertexBuffer.itemSize=1),(g||v)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Qt("SymbolBuffers",Bd);class Ud{constructor(i,u,g){this.layoutVertexArray=new i,this.layoutAttributes=u,this.indexArray=new g,this.segments=new Gn,this.collisionVertexArray=new Qo}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,J1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Qt("CollisionBuffers",Ud);class Ou{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(T=>T.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=vd([]),this.placementViewportMatrix=vd([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ng(this.zoom,u["text-size"]),this.iconSizeData=ng(this.zoom,u["icon-size"]);const g=this.layers[0].layout,v=g.get("symbol-sort-key"),E=g.get("symbol-z-order");this.canOverlap=Od(g,"text-overlap","text-allow-overlap")!=="never"||Od(g,"icon-overlap","icon-allow-overlap")!=="never"||g.get("text-ignore-placement")||g.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&!v.isConstant(),this.sortFeaturesByY=(E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,g.get("symbol-placement")==="point"&&(this.writingModes=g.get("text-writing-mode").map(T=>m.ah[T])),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.sourceID=i.sourceID}createArrays(){this.text=new Bd(new Hl(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Bd(new Hl(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new Ei,this.lineVertexArray=new Nr,this.symbolInstances=new jn,this.textAnchorOffsets=new Ti}calculateGlyphDependencies(i,u,g,v,E){for(let T=0;T<i.length;T++)if(u[i.charCodeAt(T)]=!0,(g||v)&&E){const A=Qc[i.charAt(T)];A&&(u[A.charCodeAt(0)]=!0)}}populate(i,u,g){const v=this.layers[0],E=v.layout,T=E.get("text-font"),A=E.get("text-field"),R=E.get("icon-image"),O=(A.value.kind!=="constant"||A.value.value instanceof Cr&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),j=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,G=E.get("symbol-sort-key");if(this.features=[],!O&&!j)return;const X=u.iconDependencies,te=u.glyphDependencies,se=u.availableImages,de=new Ii(this.zoom);for(const{feature:Ce,id:Re,index:nt,sourceLayerIndex:Ge}of i){const Qe=v._featureFilter.needGeometry,ht=Xl(Ce,Qe);if(!v._featureFilter.filter(de,ht,g))continue;let Et,$t;if(Qe||(ht.geometry=Wl(Ce)),O){const Wt=v.getValueAndResolveTokens("text-field",ht,g,se),Zt=Cr.factory(Wt),on=this.hasRTLText=this.hasRTLText||vb(Zt);(!on||Is.getRTLTextPluginStatus()==="unavailable"||on&&Is.isParsed())&&(Et=Q1(Zt,v,ht))}if(j){const Wt=v.getValueAndResolveTokens("icon-image",ht,g,se);$t=Wt instanceof or?Wt:or.fromString(Wt)}if(!Et&&!$t)continue;const yn=this.sortFeaturesByKey?G.evaluate(ht,{},g):void 0;if(this.features.push({id:Re,text:Et,icon:$t,index:nt,sourceLayerIndex:Ge,geometry:ht.geometry,properties:Ce.properties,type:_b[Ce.type],sortKey:yn}),$t&&(X[$t.name]=!0),Et){const Wt=T.evaluate(ht,{},g).join(","),Zt=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(m.ah.vertical)>=0;for(const on of Et.sections)if(on.image)X[on.image.name]=!0;else{const tn=Fc(Et.toString()),Kt=on.fontStack||Wt,yt=te[Kt]=te[Kt]||{};this.calculateGlyphDependencies(on.text,yt,Zt,this.allowVerticalPlacement,tn)}}}E.get("symbol-placement")==="line"&&(this.features=function(Ce){const Re={},nt={},Ge=[];let Qe=0;function ht(Wt){Ge.push(Ce[Wt]),Qe++}function Et(Wt,Zt,on){const tn=nt[Wt];return delete nt[Wt],nt[Zt]=tn,Ge[tn].geometry[0].pop(),Ge[tn].geometry[0]=Ge[tn].geometry[0].concat(on[0]),tn}function $t(Wt,Zt,on){const tn=Re[Zt];return delete Re[Zt],Re[Wt]=tn,Ge[tn].geometry[0].shift(),Ge[tn].geometry[0]=on[0].concat(Ge[tn].geometry[0]),tn}function yn(Wt,Zt,on){const tn=on?Zt[0][Zt[0].length-1]:Zt[0][0];return`${Wt}:${tn.x}:${tn.y}`}for(let Wt=0;Wt<Ce.length;Wt++){const Zt=Ce[Wt],on=Zt.geometry,tn=Zt.text?Zt.text.toString():null;if(!tn){ht(Wt);continue}const Kt=yn(tn,on),yt=yn(tn,on,!0);if(Kt in nt&&yt in Re&&nt[Kt]!==Re[yt]){const cn=$t(Kt,yt,on),sn=Et(Kt,yt,Ge[cn].geometry);delete Re[Kt],delete nt[yt],nt[yn(tn,Ge[sn].geometry,!0)]=sn,Ge[cn].geometry=null}else Kt in nt?Et(Kt,yt,on):yt in Re?$t(Kt,yt,on):(ht(Wt),Re[Kt]=Qe-1,nt[yt]=Qe-1)}return Ge.filter(Wt=>Wt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ce,Re)=>Ce.sortKey-Re.sortKey)}update(i,u,g){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,u,this.layers,g),this.icon.programConfigurations.updatePaintArrays(i,u,this.layers,g))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,u){const g=this.lineVertexArray.length;if(i.segment!==void 0){let v=i.dist(u[i.segment+1]),E=i.dist(u[i.segment]);const T={};for(let A=i.segment+1;A<u.length;A++)T[A]={x:u[A].x,y:u[A].y,tileUnitDistanceFromAnchor:v},A<u.length-1&&(v+=u[A+1].dist(u[A]));for(let A=i.segment||0;A>=0;A--)T[A]={x:u[A].x,y:u[A].y,tileUnitDistanceFromAnchor:E},A>0&&(E+=u[A-1].dist(u[A]));for(let A=0;A<u.length;A++){const R=T[A];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:g,lineLength:this.lineVertexArray.length-g}}addSymbols(i,u,g,v,E,T,A,R,O,j,G,X){const te=i.indexArray,se=i.layoutVertexArray,de=i.segments.prepareSegment(4*u.length,se,te,this.canOverlap?T.sortKey:void 0),Ce=this.glyphOffsetArray.length,Re=de.vertexLength,nt=this.allowVerticalPlacement&&A===m.ah.vertical?Math.PI/2:0,Ge=T.text&&T.text.sections;for(let Qe=0;Qe<u.length;Qe++){const{tl:ht,tr:Et,bl:$t,br:yn,tex:Wt,pixelOffsetTL:Zt,pixelOffsetBR:on,minFontScaleX:tn,minFontScaleY:Kt,glyphOffset:yt,isSDF:cn,sectionIndex:sn}=u[Qe],Sn=de.vertexLength,vi=yt[1];lf(se,R.x,R.y,ht.x,vi+ht.y,Wt.x,Wt.y,g,cn,Zt.x,Zt.y,tn,Kt),lf(se,R.x,R.y,Et.x,vi+Et.y,Wt.x+Wt.w,Wt.y,g,cn,on.x,Zt.y,tn,Kt),lf(se,R.x,R.y,$t.x,vi+$t.y,Wt.x,Wt.y+Wt.h,g,cn,Zt.x,on.y,tn,Kt),lf(se,R.x,R.y,yn.x,vi+yn.y,Wt.x+Wt.w,Wt.y+Wt.h,g,cn,on.x,on.y,tn,Kt),Fd(i.dynamicLayoutVertexArray,R,nt),te.emplaceBack(Sn,Sn+1,Sn+2),te.emplaceBack(Sn+1,Sn+2,Sn+3),de.vertexLength+=4,de.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(yt[0]),Qe!==u.length-1&&sn===u[Qe+1].sectionIndex||i.programConfigurations.populatePaintArrays(se.length,T,T.index,{},X,Ge&&Ge[sn])}i.placedSymbolArray.emplaceBack(R.x,R.y,Ce,this.glyphOffsetArray.length-Ce,Re,O,j,R.segment,g?g[0]:0,g?g[1]:0,v[0],v[1],A,0,!1,0,G)}_addCollisionDebugVertex(i,u,g,v,E,T){return u.emplaceBack(0,0),i.emplaceBack(g.x,g.y,v,E,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(i,u,g,v,E,T,A){const R=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),O=R.vertexLength,j=E.layoutVertexArray,G=E.collisionVertexArray,X=A.anchorX,te=A.anchorY;this._addCollisionDebugVertex(j,G,T,X,te,new L(i,u)),this._addCollisionDebugVertex(j,G,T,X,te,new L(g,u)),this._addCollisionDebugVertex(j,G,T,X,te,new L(g,v)),this._addCollisionDebugVertex(j,G,T,X,te,new L(i,v)),R.vertexLength+=4;const se=E.indexArray;se.emplaceBack(O,O+1),se.emplaceBack(O+1,O+2),se.emplaceBack(O+2,O+3),se.emplaceBack(O+3,O),R.primitiveLength+=4}addDebugCollisionBoxes(i,u,g,v){for(let E=i;E<u;E++){const T=this.collisionBoxArray.get(E);this.addCollisionDebugVertices(T.x1,T.y1,T.x2,T.y2,v?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,g)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ud(Fs,Bm.members,Pr),this.iconCollisionBox=new Ud(Fs,Bm.members,Pr);for(let i=0;i<this.symbolInstances.length;i++){const u=this.symbolInstances.get(i);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(i,u,g,v,E,T,A,R,O){const j={};for(let G=u;G<g;G++){const X=i.get(G);j.textBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},j.textFeatureIndex=X.featureIndex;break}for(let G=v;G<E;G++){const X=i.get(G);j.verticalTextBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},j.verticalTextFeatureIndex=X.featureIndex;break}for(let G=T;G<A;G++){const X=i.get(G);j.iconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},j.iconFeatureIndex=X.featureIndex;break}for(let G=R;G<O;G++){const X=i.get(G);j.verticalIconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},j.verticalIconFeatureIndex=X.featureIndex;break}return j}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const g=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,g.textBoxStartIndex,g.textBoxEndIndex,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g.iconBoxStartIndex,g.iconBoxEndIndex,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,u){const g=i.placedSymbolArray.get(u),v=g.vertexStartIndex+4*g.numGlyphs;for(let E=g.vertexStartIndex;E<v;E+=4)i.indexArray.emplaceBack(E,E+1,E+2),i.indexArray.emplaceBack(E+1,E+2,E+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(i),g=Math.cos(i),v=[],E=[],T=[];for(let A=0;A<this.symbolInstances.length;++A){T.push(A);const R=this.symbolInstances.get(A);v.push(0|Math.round(u*R.anchorX+g*R.anchorY)),E.push(R.featureIndex)}return T.sort((A,R)=>v[A]-v[R]||E[R]-E[A]),T}addToSortKeyRanges(i,u){const g=this.sortKeyRanges[this.sortKeyRanges.length-1];g&&g.sortKey===u?g.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const g=this.symbolInstances.get(u);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach((v,E,T)=>{v>=0&&T.indexOf(v)===E&&this.addIndicesForPlacedSymbol(this.text,v)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ig,rg;Qt("SymbolBucket",Ou,{omit:["layers","collisionBoxArray","features","compareText"]}),Ou.MAX_GLYPHS=65535,Ou.addDynamicAttributes=Fd;var jd={get paint(){return rg=rg||new k({"icon-opacity":new vn(Ye.paint_symbol["icon-opacity"]),"icon-color":new vn(Ye.paint_symbol["icon-color"]),"icon-halo-color":new vn(Ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new vn(Ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new vn(Ye.paint_symbol["icon-halo-blur"]),"icon-translate":new nn(Ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new nn(Ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new vn(Ye.paint_symbol["text-opacity"]),"text-color":new vn(Ye.paint_symbol["text-color"],{runtimeType:_r,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new vn(Ye.paint_symbol["text-halo-color"]),"text-halo-width":new vn(Ye.paint_symbol["text-halo-width"]),"text-halo-blur":new vn(Ye.paint_symbol["text-halo-blur"]),"text-translate":new nn(Ye.paint_symbol["text-translate"]),"text-translate-anchor":new nn(Ye.paint_symbol["text-translate-anchor"])})},get layout(){return ig=ig||new k({"symbol-placement":new nn(Ye.layout_symbol["symbol-placement"]),"symbol-spacing":new nn(Ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new nn(Ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new vn(Ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new nn(Ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new nn(Ye.layout_symbol["icon-allow-overlap"]),"icon-overlap":new nn(Ye.layout_symbol["icon-overlap"]),"icon-ignore-placement":new nn(Ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new nn(Ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new nn(Ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new vn(Ye.layout_symbol["icon-size"]),"icon-text-fit":new nn(Ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new nn(Ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new vn(Ye.layout_symbol["icon-image"]),"icon-rotate":new vn(Ye.layout_symbol["icon-rotate"]),"icon-padding":new vn(Ye.layout_symbol["icon-padding"]),"icon-keep-upright":new nn(Ye.layout_symbol["icon-keep-upright"]),"icon-offset":new vn(Ye.layout_symbol["icon-offset"]),"icon-anchor":new vn(Ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new nn(Ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new nn(Ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new nn(Ye.layout_symbol["text-rotation-alignment"]),"text-field":new vn(Ye.layout_symbol["text-field"]),"text-font":new vn(Ye.layout_symbol["text-font"]),"text-size":new vn(Ye.layout_symbol["text-size"]),"text-max-width":new vn(Ye.layout_symbol["text-max-width"]),"text-line-height":new nn(Ye.layout_symbol["text-line-height"]),"text-letter-spacing":new vn(Ye.layout_symbol["text-letter-spacing"]),"text-justify":new vn(Ye.layout_symbol["text-justify"]),"text-radial-offset":new vn(Ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new nn(Ye.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new vn(Ye.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new vn(Ye.layout_symbol["text-anchor"]),"text-max-angle":new nn(Ye.layout_symbol["text-max-angle"]),"text-writing-mode":new nn(Ye.layout_symbol["text-writing-mode"]),"text-rotate":new vn(Ye.layout_symbol["text-rotate"]),"text-padding":new nn(Ye.layout_symbol["text-padding"]),"text-keep-upright":new nn(Ye.layout_symbol["text-keep-upright"]),"text-transform":new vn(Ye.layout_symbol["text-transform"]),"text-offset":new vn(Ye.layout_symbol["text-offset"]),"text-allow-overlap":new nn(Ye.layout_symbol["text-allow-overlap"]),"text-overlap":new nn(Ye.layout_symbol["text-overlap"]),"text-ignore-placement":new nn(Ye.layout_symbol["text-ignore-placement"]),"text-optional":new nn(Ye.layout_symbol["text-optional"])})}};class sg{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:As,this.defaultValue=i}evaluate(i){if(i.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(i.formattedSection))return u.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Qt("FormatSectionOverride",sg,{omit:["defaultValue"]});class uf extends h{constructor(i){super(i,jd)}recalculate(i,u){if(super.recalculate(i,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const g=this.layout.get("text-writing-mode");if(g){const v=[];for(const E of g)v.indexOf(E)<0&&v.push(E);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,u,g,v){const E=this.layout.get(i).evaluate(u,{},g,v),T=this._unevaluatedLayout._values[i];return T.isDataDriven()||b(T.value)||!E?E:function(A,R){return R.replace(/{([^{}]+)}/g,(O,j)=>A&&j in A?String(A[j]):"")}(u.properties,E)}createBucket(i){return new Ou(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of jd.paint.overridableProperties){if(!uf.hasPaintOverride(this.layout,i))continue;const u=this.paint.get(i),g=new sg(u),v=new p(g,u.property.specification);let E=null;E=u.value.kind==="constant"||u.value.kind==="source"?new F("source",v):new q("composite",v,u.value.zoomStops),this.paint._values[i]=new co(u.property,E,u.parameters)}}_handleOverridablePaintPropertyUpdate(i,u,g){return!(!this.layout||u.isDataDriven()||g.isDataDriven())&&uf.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,u){const g=i.get("text-field"),v=jd.paint.properties[u];let E=!1;const T=A=>{for(const R of A)if(v.overrides&&v.overrides.hasOverride(R))return void(E=!0)};if(g.value.kind==="constant"&&g.value.value instanceof Cr)T(g.value.value.sections);else if(g.value.kind==="source"){const A=O=>{E||(O instanceof _s&&Ri(O.value)===Er?T(O.value.sections):O instanceof ga?T(O.sections):O.eachChild(A))},R=g.value;R._styleExpression&&A(R._styleExpression.expression)}return E}}let og;var bb={get paint(){return og=og||new k({"background-color":new nn(Ye.paint_background["background-color"]),"background-pattern":new ku(Ye.paint_background["background-pattern"]),"background-opacity":new nn(Ye.paint_background["background-opacity"])})}};class xb extends h{constructor(i){super(i,bb)}}let ag;var wb={get paint(){return ag=ag||new k({"raster-opacity":new nn(Ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new nn(Ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new nn(Ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new nn(Ye.paint_raster["raster-brightness-max"]),"raster-saturation":new nn(Ye.paint_raster["raster-saturation"]),"raster-contrast":new nn(Ye.paint_raster["raster-contrast"]),"raster-resampling":new nn(Ye.paint_raster["raster-resampling"]),"raster-fade-duration":new nn(Ye.paint_raster["raster-fade-duration"])})}};class kb extends h{constructor(i){super(i,wb)}}class Ib extends h{constructor(i){super(i,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Sb{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Vd=63710088e-1;class cl{constructor(i,u){if(isNaN(i)||isNaN(u))throw new Error(`Invalid LngLat object: (${i}, ${u})`);if(this.lng=+i,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new cl(De(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const u=Math.PI/180,g=this.lat*u,v=i.lat*u,E=Math.sin(g)*Math.sin(v)+Math.cos(g)*Math.cos(v)*Math.cos((i.lng-this.lng)*u);return Vd*Math.acos(Math.min(E,1))}static convert(i){if(i instanceof cl)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new cl(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new cl(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const lg=2*Math.PI*Vd;function ug(o){return lg*Math.cos(o*Math.PI/180)}function cg(o){return(180+o)/360}function hg(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function fg(o,i){return o/ug(i)}function qd(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}class ih{constructor(i,u,g=0){this.x=+i,this.y=+u,this.z=+g}static fromLngLat(i,u=0){const g=cl.convert(i);return new ih(cg(g.lng),hg(g.lat),fg(u,g.lat))}toLngLat(){return new cl(360*this.x-180,qd(this.y))}toAltitude(){return this.z*ug(qd(this.y))}meterInMercatorCoordinateUnits(){return 1/lg*(i=qd(this.y),1/Math.cos(i*Math.PI/180));var i}}function dg(o,i,u){var g=2*Math.PI*6378137/256/Math.pow(2,u);return[o*g-2*Math.PI*6378137/2,i*g-2*Math.PI*6378137/2]}class Gd{constructor(i,u,g){if(!function(v,E,T){return!(v<0||v>25||T<0||T>=Math.pow(2,v)||E<0||E>=Math.pow(2,v))}(i,u,g))throw new Error(`x=${u}, y=${g}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=u,this.y=g,this.key=rh(0,i,i,u,g)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,u,g){const v=(T=this.y,A=this.z,R=dg(256*(E=this.x),256*(T=Math.pow(2,A)-T-1),A),O=dg(256*(E+1),256*(T+1),A),R[0]+","+R[1]+","+O[0]+","+O[1]);var E,T,A,R,O;const j=function(G,X,te){let se,de="";for(let Ce=G;Ce>0;Ce--)se=1<<Ce-1,de+=(X&se?1:0)+(te&se?2:0);return de}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(g==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,j).replace(/{bbox-epsg-3857}/g,v)}isChildOf(i){const u=this.z-i.z;return u>0&&i.x===this.x>>u&&i.y===this.y>>u}getTilePoint(i){const u=Math.pow(2,this.z);return new L((i.x*u-this.x)*ar,(i.y*u-this.y)*ar)}toString(){return`${this.z}/${this.x}/${this.y}`}}class pg{constructor(i,u){this.wrap=i,this.canonical=u,this.key=rh(i,u.z,u.z,u.x,u.y)}}class $s{constructor(i,u,g,v,E){if(i<g)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${g}`);this.overscaledZ=i,this.wrap=u,this.canonical=new Gd(g,+v,+E),this.key=rh(u,i,g,v,E)}clone(){return new $s(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-i;return i>this.canonical.z?new $s(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $s(i,this.wrap,i,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(i,u){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const g=this.canonical.z-i;return i>this.canonical.z?rh(this.wrap*+u,i,this.canonical.z,this.canonical.x,this.canonical.y):rh(this.wrap*+u,i,i,this.canonical.x>>g,this.canonical.y>>g)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const u=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>u&&i.canonical.y===this.canonical.y>>u}children(i){if(this.overscaledZ>=i)return[new $s(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,g=2*this.canonical.x,v=2*this.canonical.y;return[new $s(u,this.wrap,u,g,v),new $s(u,this.wrap,u,g+1,v),new $s(u,this.wrap,u,g,v+1),new $s(u,this.wrap,u,g+1,v+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new $s(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new $s(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new pg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new ih(i.x-this.wrap,i.y))}}function rh(o,i,u,g,v){(o*=2)<0&&(o=-1*o-1);const E=1<<u;return(E*E*o+E*v+g).toString(36)+u.toString(36)+i.toString(36)}Qt("CanonicalTileID",Gd),Qt("OverscaledTileID",$s,{omit:["posMatrix"]});class mg{constructor(i,u,g,v=1,E=1,T=1,A=0){if(this.uid=i,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(g&&!["mapbox","terrarium","custom"].includes(g))return void Ue(`"${g}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const R=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),g){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=v,this.greenFactor=E,this.blueFactor=T,this.baseShift=A;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let O=0;O<R;O++)this.data[this._idx(-1,O)]=this.data[this._idx(0,O)],this.data[this._idx(R,O)]=this.data[this._idx(R-1,O)],this.data[this._idx(O,-1)]=this.data[this._idx(O,0)],this.data[this._idx(O,R)]=this.data[this._idx(O,R-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(R,-1)]=this.data[this._idx(R-1,0)],this.data[this._idx(-1,R)]=this.data[this._idx(0,R-1)],this.data[this._idx(R,R)]=this.data[this._idx(R-1,R-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let O=0;O<R;O++)for(let j=0;j<R;j++){const G=this.get(O,j);G>this.max&&(this.max=G),G<this.min&&(this.min=G)}}get(i,u){const g=new Uint8Array(this.data.buffer),v=4*this._idx(i,u);return this.unpack(g[v],g[v+1],g[v+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,u){if(i<-1||i>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(i+1)}unpack(i,u,g){return i*this.redFactor+u*this.greenFactor+g*this.blueFactor-this.baseShift}getPixels(){return new Xs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,u,g){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let v=u*this.dim,E=u*this.dim+this.dim,T=g*this.dim,A=g*this.dim+this.dim;switch(u){case-1:v=E-1;break;case 1:E=v+1}switch(g){case-1:T=A-1;break;case 1:A=T+1}const R=-u*this.dim,O=-g*this.dim;for(let j=T;j<A;j++)for(let G=v;G<E;G++)this.data[this._idx(G,j)]=i.data[this._idx(G+R,j+O)]}}Qt("DEMData",mg);class gg{constructor(i){this._stringToNumber={},this._numberToString=[];for(let u=0;u<i.length;u++){const g=i[u];this._stringToNumber[g]=u,this._numberToString[u]=g}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class _g{constructor(i,u,g,v,E){this.type="Feature",this._vectorTileFeature=i,i._z=u,i._x=g,i._y=v,this.properties=i.properties,this.id=E}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(i[u]=this[u]);return i}}class yg{constructor(i,u){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Ya(ar,16,0),this.grid3D=new Ya(ar,16,0),this.featureIndexArray=new Wr,this.promoteId=u}insert(i,u,g,v,E,T){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(g,v,E);const R=T?this.grid3D:this.grid;for(let O=0;O<u.length;O++){const j=u[O],G=[1/0,1/0,-1/0,-1/0];for(let X=0;X<j.length;X++){const te=j[X];G[0]=Math.min(G[0],te.x),G[1]=Math.min(G[1],te.y),G[2]=Math.max(G[2],te.x),G[3]=Math.max(G[3],te.y)}G[0]<ar&&G[1]<ar&&G[2]>=0&&G[3]>=0&&R.insert(A,G[0],G[1],G[2],G[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new al.VectorTile(new Pd(this.rawTileData)).layers,this.sourceLayerCoder=new gg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,u,g,v){this.loadVTLayers();const E=i.params||{},T=ar/i.tileSize/i.scale,A=zt(E.filter),R=i.queryGeometry,O=i.queryPadding*T,j=bg(R),G=this.grid.query(j.minX-O,j.minY-O,j.maxX+O,j.maxY+O),X=bg(i.cameraQueryGeometry),te=this.grid3D.query(X.minX-O,X.minY-O,X.maxX+O,X.maxY+O,(Ce,Re,nt,Ge)=>function(Qe,ht,Et,$t,yn){for(const Zt of Qe)if(ht<=Zt.x&&Et<=Zt.y&&$t>=Zt.x&&yn>=Zt.y)return!0;const Wt=[new L(ht,Et),new L(ht,yn),new L($t,yn),new L($t,Et)];if(Qe.length>2){for(const Zt of Wt)if(Mu(Qe,Zt))return!0}for(let Zt=0;Zt<Qe.length-1;Zt++)if(s1(Qe[Zt],Qe[Zt+1],Wt))return!0;return!1}(i.cameraQueryGeometry,Ce-O,Re-O,nt+O,Ge+O));for(const Ce of te)G.push(Ce);G.sort(Eb);const se={};let de;for(let Ce=0;Ce<G.length;Ce++){const Re=G[Ce];if(Re===de)continue;de=Re;const nt=this.featureIndexArray.get(Re);let Ge=null;this.loadMatchingFeature(se,nt.bucketIndex,nt.sourceLayerIndex,nt.featureIndex,A,E.layers,E.availableImages,u,g,v,(Qe,ht,Et)=>(Ge||(Ge=Wl(Qe)),ht.queryIntersectsFeature(R,Qe,Et,Ge,this.z,i.transform,T,i.pixelPosMatrix)))}return se}loadMatchingFeature(i,u,g,v,E,T,A,R,O,j,G){const X=this.bucketLayerIDs[u];if(T&&!function(Ce,Re){for(let nt=0;nt<Ce.length;nt++)if(Re.indexOf(Ce[nt])>=0)return!0;return!1}(T,X))return;const te=this.sourceLayerCoder.decode(g),se=this.vtLayers[te].feature(v);if(E.needGeometry){const Ce=Xl(se,!0);if(!E.filter(new Ii(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!E.filter(new Ii(this.tileID.overscaledZ),se))return;const de=this.getId(se,te);for(let Ce=0;Ce<X.length;Ce++){const Re=X[Ce];if(T&&T.indexOf(Re)<0)continue;const nt=R[Re];if(!nt)continue;let Ge={};de&&j&&(Ge=j.getState(nt.sourceLayer||"_geojsonTileLayer",de));const Qe=he({},O[Re]);Qe.paint=vg(Qe.paint,nt.paint,se,Ge,A),Qe.layout=vg(Qe.layout,nt.layout,se,Ge,A);const ht=!G||G(se,nt,Ge);if(!ht)continue;const Et=new _g(se,this.z,this.x,this.y,de);Et.layer=Qe;let $t=i[Re];$t===void 0&&($t=i[Re]=[]),$t.push({featureIndex:v,feature:Et,intersectionZ:ht})}}lookupSymbolFeatures(i,u,g,v,E,T,A,R){const O={};this.loadVTLayers();const j=zt(E);for(const G of i)this.loadMatchingFeature(O,g,v,G,j,T,A,R,u);return O}hasLayer(i){for(const u of this.bucketLayerIDs)for(const g of u)if(i===g)return!0;return!1}getId(i,u){let g=i.id;return this.promoteId&&(g=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof g=="boolean"&&(g=Number(g))),g}}function vg(o,i,u,g,v){return be(o,(E,T)=>{const A=i instanceof ql?i.get(T):null;return A&&A.evaluate?A.evaluate(u,g,v):A})}function bg(o){let i=1/0,u=1/0,g=-1/0,v=-1/0;for(const E of o)i=Math.min(i,E.x),u=Math.min(u,E.y),g=Math.max(g,E.x),v=Math.max(v,E.y);return{minX:i,minY:u,maxX:g,maxY:v}}function Eb(o,i){return i-o}function xg(o,i,u,g,v){const E=[];for(let T=0;T<o.length;T++){const A=o[T];let R;for(let O=0;O<A.length-1;O++){let j=A[O],G=A[O+1];j.x<i&&G.x<i||(j.x<i?j=new L(i,j.y+(i-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x<i&&(G=new L(i,j.y+(i-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y<u&&G.y<u||(j.y<u?j=new L(j.x+(u-j.y)/(G.y-j.y)*(G.x-j.x),u)._round():G.y<u&&(G=new L(j.x+(u-j.y)/(G.y-j.y)*(G.x-j.x),u)._round()),j.x>=g&&G.x>=g||(j.x>=g?j=new L(g,j.y+(g-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x>=g&&(G=new L(g,j.y+(g-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y>=v&&G.y>=v||(j.y>=v?j=new L(j.x+(v-j.y)/(G.y-j.y)*(G.x-j.x),v)._round():G.y>=v&&(G=new L(j.x+(v-j.y)/(G.y-j.y)*(G.x-j.x),v)._round()),R&&j.equals(R[R.length-1])||(R=[j],E.push(R)),R.push(G)))))}}return E}Qt("FeatureIndex",yg,{omit:["rawTileData","sourceLayerCoder"]});class hl extends L{constructor(i,u,g,v){super(i,u),this.angle=g,v!==void 0&&(this.segment=v)}clone(){return new hl(this.x,this.y,this.angle,this.segment)}}function wg(o,i,u,g,v){if(i.segment===void 0||u===0)return!0;let E=i,T=i.segment+1,A=0;for(;A>-u/2;){if(T--,T<0)return!1;A-=o[T].dist(E),E=o[T]}A+=o[T].dist(o[T+1]),T++;const R=[];let O=0;for(;A<u/2;){const j=o[T],G=o[T+1];if(!G)return!1;let X=o[T-1].angleTo(j)-j.angleTo(G);for(X=Math.abs((X+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:A,angleDelta:X}),O+=X;A-R[0].distance>g;)O-=R.shift().angleDelta;if(O>v)return!1;T++,A+=j.dist(G)}return!0}function kg(o){let i=0;for(let u=0;u<o.length-1;u++)i+=o[u].dist(o[u+1]);return i}function Ig(o,i,u){return o?.6*i*u:0}function Sg(o,i){return Math.max(o?o.right-o.left:0,i?i.right-i.left:0)}function Tb(o,i,u,g,v,E){const T=Ig(u,v,E),A=Sg(u,g)*E;let R=0;const O=kg(o)/2;for(let j=0;j<o.length-1;j++){const G=o[j],X=o[j+1],te=G.dist(X);if(R+te>O){const se=(O-R)/te,de=bi.number(G.x,X.x,se),Ce=bi.number(G.y,X.y,se),Re=new hl(de,Ce,X.angleTo(G),j);return Re._round(),!T||wg(o,Re,A,T,i)?Re:void 0}R+=te}}function Cb(o,i,u,g,v,E,T,A,R){const O=Ig(g,E,T),j=Sg(g,v),G=j*T,X=o[0].x===0||o[0].x===R||o[0].y===0||o[0].y===R;return i-G<i/4&&(i=G+i/4),Eg(o,X?i/2*A%i:(j/2+2*E)*T*A%i,i,O,u,G,X,!1,R)}function Eg(o,i,u,g,v,E,T,A,R){const O=E/2,j=kg(o);let G=0,X=i-u,te=[];for(let se=0;se<o.length-1;se++){const de=o[se],Ce=o[se+1],Re=de.dist(Ce),nt=Ce.angleTo(de);for(;X+u<G+Re;){X+=u;const Ge=(X-G)/Re,Qe=bi.number(de.x,Ce.x,Ge),ht=bi.number(de.y,Ce.y,Ge);if(Qe>=0&&Qe<R&&ht>=0&&ht<R&&X-O>=0&&X+O<=j){const Et=new hl(Qe,ht,nt,se);Et._round(),g&&!wg(o,Et,E,g,v)||te.push(Et)}}G+=Re}return A||te.length||T||(te=Eg(o,G/2,u,g,v,E,T,!0,R)),te}Qt("Anchor",hl);const Fu=Es;function Tg(o,i,u,g){const v=[],E=o.image,T=E.pixelRatio,A=E.paddedRect.w-2*Fu,R=E.paddedRect.h-2*Fu;let O={x1:o.left,y1:o.top,x2:o.right,y2:o.bottom};const j=E.stretchX||[[0,A]],G=E.stretchY||[[0,R]],X=(yt,cn)=>yt+cn[1]-cn[0],te=j.reduce(X,0),se=G.reduce(X,0),de=A-te,Ce=R-se;let Re=0,nt=te,Ge=0,Qe=se,ht=0,Et=de,$t=0,yn=Ce;if(E.content&&g){const yt=E.content,cn=yt[2]-yt[0],sn=yt[3]-yt[1];(E.textFitWidth||E.textFitHeight)&&(O=eg(o)),Re=cf(j,0,yt[0]),Ge=cf(G,0,yt[1]),nt=cf(j,yt[0],yt[2]),Qe=cf(G,yt[1],yt[3]),ht=yt[0]-Re,$t=yt[1]-Ge,Et=cn-nt,yn=sn-Qe}const Wt=O.x1,Zt=O.y1,on=O.x2-Wt,tn=O.y2-Zt,Kt=(yt,cn,sn,Sn)=>{const vi=hf(yt.stretch-Re,nt,on,Wt),_i=ff(yt.fixed-ht,Et,yt.stretch,te),vr=hf(cn.stretch-Ge,Qe,tn,Zt),fo=ff(cn.fixed-$t,yn,cn.stretch,se),Br=hf(sn.stretch-Re,nt,on,Wt),br=ff(sn.fixed-ht,Et,sn.stretch,te),as=hf(Sn.stretch-Ge,Qe,tn,Zt),ls=ff(Sn.fixed-$t,yn,Sn.stretch,se),us=new L(vi,vr),Gi=new L(Br,vr),xr=new L(Br,as),$r=new L(vi,as),Ur=new L(_i/T,fo/T),cs=new L(br/T,ls/T),jr=i*Math.PI/180;if(jr){const oi=Math.sin(jr),xi=Math.cos(jr),Ci=[xi,-oi,oi,xi];us._matMult(Ci),Gi._matMult(Ci),$r._matMult(Ci),xr._matMult(Ci)}const Ys=yt.stretch+yt.fixed,Ts=cn.stretch+cn.fixed;return{tl:us,tr:Gi,bl:$r,br:xr,tex:{x:E.paddedRect.x+Fu+Ys,y:E.paddedRect.y+Fu+Ts,w:sn.stretch+sn.fixed-Ys,h:Sn.stretch+Sn.fixed-Ts},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ur,pixelOffsetBR:cs,minFontScaleX:Et/T/on,minFontScaleY:yn/T/tn,isSDF:u}};if(g&&(E.stretchX||E.stretchY)){const yt=Cg(j,de,te),cn=Cg(G,Ce,se);for(let sn=0;sn<yt.length-1;sn++){const Sn=yt[sn],vi=yt[sn+1];for(let _i=0;_i<cn.length-1;_i++)v.push(Kt(Sn,cn[_i],vi,cn[_i+1]))}}else v.push(Kt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:R+1}));return v}function cf(o,i,u){let g=0;for(const v of o)g+=Math.max(i,Math.min(u,v[1]))-Math.max(i,Math.min(u,v[0]));return g}function Cg(o,i,u){const g=[{fixed:-Fu,stretch:0}];for(const[v,E]of o){const T=g[g.length-1];g.push({fixed:v-T.stretch,stretch:T.stretch}),g.push({fixed:v-T.stretch,stretch:T.stretch+(E-v)})}return g.push({fixed:i+Fu,stretch:u}),g}function hf(o,i,u,g){return o/i*u+g}function ff(o,i,u,g){return o-i*u/g}class df{constructor(i,u,g,v,E,T,A,R,O,j){var G;if(this.boxStartIndex=i.length,O){let X=T.top,te=T.bottom;const se=T.collisionPadding;se&&(X-=se[1],te+=se[3]);let de=te-X;de>0&&(de=Math.max(10,de),this.circleDiameter=de)}else{const X=!((G=T.image)===null||G===void 0)&&G.content&&(T.image.textFitWidth||T.image.textFitHeight)?eg(T):{x1:T.left,y1:T.top,x2:T.right,y2:T.bottom};X.y1=X.y1*A-R[0],X.y2=X.y2*A+R[2],X.x1=X.x1*A-R[3],X.x2=X.x2*A+R[1];const te=T.collisionPadding;if(te&&(X.x1-=te[0]*A,X.y1-=te[1]*A,X.x2+=te[2]*A,X.y2+=te[3]*A),j){const se=new L(X.x1,X.y1),de=new L(X.x2,X.y1),Ce=new L(X.x1,X.y2),Re=new L(X.x2,X.y2),nt=j*Math.PI/180;se._rotate(nt),de._rotate(nt),Ce._rotate(nt),Re._rotate(nt),X.x1=Math.min(se.x,de.x,Ce.x,Re.x),X.x2=Math.max(se.x,de.x,Ce.x,Re.x),X.y1=Math.min(se.y,de.y,Ce.y,Re.y),X.y2=Math.max(se.y,de.y,Ce.y,Re.y)}i.emplaceBack(u.x,u.y,X.x1,X.y1,X.x2,X.y2,g,v,E)}this.boxEndIndex=i.length}}class Lb{constructor(i=[],u=(g,v)=>g<v?-1:g>v?1:0){if(this.data=i,this.length=this.data.length,this.compare=u,this.length>0)for(let g=(this.length>>1)-1;g>=0;g--)this._down(g)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],u=this.data.pop();return--this.length>0&&(this.data[0]=u,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:u,compare:g}=this,v=u[i];for(;i>0;){const E=i-1>>1,T=u[E];if(g(v,T)>=0)break;u[i]=T,i=E}u[i]=v}_down(i){const{data:u,compare:g}=this,v=this.length>>1,E=u[i];for(;i<v;){let T=1+(i<<1);const A=T+1;if(A<this.length&&g(u[A],u[T])<0&&(T=A),g(u[T],E)>=0)break;u[i]=u[T],i=T}u[i]=E}}function Mb(o,i=1,u=!1){let g=1/0,v=1/0,E=-1/0,T=-1/0;const A=o[0];for(let te=0;te<A.length;te++){const se=A[te];(!te||se.x<g)&&(g=se.x),(!te||se.y<v)&&(v=se.y),(!te||se.x>E)&&(E=se.x),(!te||se.y>T)&&(T=se.y)}const R=Math.min(E-g,T-v);let O=R/2;const j=new Lb([],Ab);if(R===0)return new L(g,v);for(let te=g;te<E;te+=R)for(let se=v;se<T;se+=R)j.push(new Bu(te+O,se+O,O,o));let G=function(te){let se=0,de=0,Ce=0;const Re=te[0];for(let nt=0,Ge=Re.length,Qe=Ge-1;nt<Ge;Qe=nt++){const ht=Re[nt],Et=Re[Qe],$t=ht.x*Et.y-Et.x*ht.y;de+=(ht.x+Et.x)*$t,Ce+=(ht.y+Et.y)*$t,se+=3*$t}return new Bu(de/se,Ce/se,0,te)}(o),X=j.length;for(;j.length;){const te=j.pop();(te.d>G.d||!G.d)&&(G=te,u&&console.log("found best %d after %d probes",Math.round(1e4*te.d)/1e4,X)),te.max-G.d<=i||(O=te.h/2,j.push(new Bu(te.p.x-O,te.p.y-O,O,o)),j.push(new Bu(te.p.x+O,te.p.y-O,O,o)),j.push(new Bu(te.p.x-O,te.p.y+O,O,o)),j.push(new Bu(te.p.x+O,te.p.y+O,O,o)),X+=4)}return u&&(console.log(`num probes: ${X}`),console.log(`best distance: ${G.d}`)),G.p}function Ab(o,i){return i.max-o.max}function Bu(o,i,u,g){this.p=new L(o,i),this.h=u,this.d=function(v,E){let T=!1,A=1/0;for(let R=0;R<E.length;R++){const O=E[R];for(let j=0,G=O.length,X=G-1;j<G;X=j++){const te=O[j],se=O[X];te.y>v.y!=se.y>v.y&&v.x<(se.x-te.x)*(v.y-te.y)/(se.y-te.y)+te.x&&(T=!T),A=Math.min(A,hm(v,te,se))}}return(T?1:-1)*Math.sqrt(A)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}var Fr;m.aq=void 0,(Fr=m.aq||(m.aq={}))[Fr.center=1]="center",Fr[Fr.left=2]="left",Fr[Fr.right=3]="right",Fr[Fr.top=4]="top",Fr[Fr.bottom=5]="bottom",Fr[Fr["top-left"]=6]="top-left",Fr[Fr["top-right"]=7]="top-right",Fr[Fr["bottom-left"]=8]="bottom-left",Fr[Fr["bottom-right"]=9]="bottom-right";const fl=7,Zd=Number.POSITIVE_INFINITY;function Lg(o,i){return i[1]!==Zd?function(u,g,v){let E=0,T=0;switch(g=Math.abs(g),v=Math.abs(v),u){case"top-right":case"top-left":case"top":T=v-fl;break;case"bottom-right":case"bottom-left":case"bottom":T=-v+fl}switch(u){case"top-right":case"bottom-right":case"right":E=-g;break;case"top-left":case"bottom-left":case"left":E=g}return[E,T]}(o,i[0],i[1]):function(u,g){let v=0,E=0;g<0&&(g=0);const T=g/Math.SQRT2;switch(u){case"top-right":case"top-left":E=T-fl;break;case"bottom-right":case"bottom-left":E=-T+fl;break;case"bottom":E=-g+fl;break;case"top":E=g-fl}switch(u){case"top-right":case"bottom-right":v=-T;break;case"top-left":case"bottom-left":v=T;break;case"left":v=g;break;case"right":v=-g}return[v,E]}(o,i[0])}function Mg(o,i,u){var g;const v=o.layout,E=(g=v.get("text-variable-anchor-offset"))===null||g===void 0?void 0:g.evaluate(i,{},u);if(E){const A=E.values,R=[];for(let O=0;O<A.length;O+=2){const j=R[O]=A[O],G=A[O+1].map(X=>X*pr);j.startsWith("top")?G[1]-=fl:j.startsWith("bottom")&&(G[1]+=fl),R[O+1]=G}return new Pi(R)}const T=v.get("text-variable-anchor");if(T){let A;A=o._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[v.get("text-radial-offset").evaluate(i,{},u)*pr,Zd]:v.get("text-offset").evaluate(i,{},u).map(O=>O*pr);const R=[];for(const O of T)R.push(O,Lg(O,A));return new Pi(R)}return null}function Hd(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Pb(o,i,u,g,v,E,T,A,R,O,j){let G=E.textMaxSize.evaluate(i,{});G===void 0&&(G=T);const X=o.layers[0].layout,te=X.get("icon-offset").evaluate(i,{},j),se=Pg(u.horizontal),de=T/24,Ce=o.tilePixelRatio*de,Re=o.tilePixelRatio*G/24,nt=o.tilePixelRatio*A,Ge=o.tilePixelRatio*X.get("symbol-spacing"),Qe=X.get("text-padding")*o.tilePixelRatio,ht=function(yt,cn,sn,Sn=1){const vi=yt.get("icon-padding").evaluate(cn,{},sn),_i=vi&&vi.values;return[_i[0]*Sn,_i[1]*Sn,_i[2]*Sn,_i[3]*Sn]}(X,i,j,o.tilePixelRatio),Et=X.get("text-max-angle")/180*Math.PI,$t=X.get("text-rotation-alignment")!=="viewport"&&X.get("symbol-placement")!=="point",yn=X.get("icon-rotation-alignment")==="map"&&X.get("symbol-placement")!=="point",Wt=X.get("symbol-placement"),Zt=Ge/2,on=X.get("icon-text-fit");let tn;g&&on!=="none"&&(o.allowVerticalPlacement&&u.vertical&&(tn=tg(g,u.vertical,on,X.get("icon-text-fit-padding"),te,de)),se&&(g=tg(g,se,on,X.get("icon-text-fit-padding"),te,de)));const Kt=(yt,cn)=>{cn.x<0||cn.x>=ar||cn.y<0||cn.y>=ar||function(sn,Sn,vi,_i,vr,fo,Br,br,as,ls,us,Gi,xr,$r,Ur,cs,jr,Ys,Ts,oi,xi,Ci,Bs,Ui,Uu){const na=sn.addToLineVertexArray(Sn,vi);let ia,po,Js,Rr,Ta=0,ah=0,zg=0,Og=0,ep=-1,tp=-1;const Ca={};let Fg=Eu("");if(sn.allowVerticalPlacement&&_i.vertical){const Yr=br.layout.get("text-rotate").evaluate(xi,{},Ui)+90;Js=new df(as,Sn,ls,us,Gi,_i.vertical,xr,$r,Ur,Yr),Br&&(Rr=new df(as,Sn,ls,us,Gi,Br,jr,Ys,Ur,Yr))}if(vr){const Yr=br.layout.get("icon-rotate").evaluate(xi,{}),Ks=br.layout.get("icon-text-fit")!=="none",Yl=Tg(vr,Yr,Bs,Ks),Lo=Br?Tg(Br,Yr,Bs,Ks):void 0;po=new df(as,Sn,ls,us,Gi,vr,jr,Ys,!1,Yr),Ta=4*Yl.length;const Jl=sn.iconSizeData;let ra=null;Jl.kind==="source"?(ra=[ta*br.layout.get("icon-size").evaluate(xi,{})],ra[0]>ul&&Ue(`${sn.layerIds[0]}: Value for "icon-size" is >= ${nh}. Reduce your "icon-size".`)):Jl.kind==="composite"&&(ra=[ta*Ci.compositeIconSizes[0].evaluate(xi,{},Ui),ta*Ci.compositeIconSizes[1].evaluate(xi,{},Ui)],(ra[0]>ul||ra[1]>ul)&&Ue(`${sn.layerIds[0]}: Value for "icon-size" is >= ${nh}. Reduce your "icon-size".`)),sn.addSymbols(sn.icon,Yl,ra,oi,Ts,xi,m.ah.none,Sn,na.lineStartIndex,na.lineLength,-1,Ui),ep=sn.icon.placedSymbolArray.length-1,Lo&&(ah=4*Lo.length,sn.addSymbols(sn.icon,Lo,ra,oi,Ts,xi,m.ah.vertical,Sn,na.lineStartIndex,na.lineLength,-1,Ui),tp=sn.icon.placedSymbolArray.length-1)}const Bg=Object.keys(_i.horizontal);for(const Yr of Bg){const Ks=_i.horizontal[Yr];if(!ia){Fg=Eu(Ks.text);const Lo=br.layout.get("text-rotate").evaluate(xi,{},Ui);ia=new df(as,Sn,ls,us,Gi,Ks,xr,$r,Ur,Lo)}const Yl=Ks.positionedLines.length===1;if(zg+=Ag(sn,Sn,Ks,fo,br,Ur,xi,cs,na,_i.vertical?m.ah.horizontal:m.ah.horizontalOnly,Yl?Bg:[Yr],Ca,ep,Ci,Ui),Yl)break}_i.vertical&&(Og+=Ag(sn,Sn,_i.vertical,fo,br,Ur,xi,cs,na,m.ah.vertical,["vertical"],Ca,tp,Ci,Ui));const Nb=ia?ia.boxStartIndex:sn.collisionBoxArray.length,zb=ia?ia.boxEndIndex:sn.collisionBoxArray.length,Ob=Js?Js.boxStartIndex:sn.collisionBoxArray.length,Fb=Js?Js.boxEndIndex:sn.collisionBoxArray.length,Bb=po?po.boxStartIndex:sn.collisionBoxArray.length,Ub=po?po.boxEndIndex:sn.collisionBoxArray.length,jb=Rr?Rr.boxStartIndex:sn.collisionBoxArray.length,Vb=Rr?Rr.boxEndIndex:sn.collisionBoxArray.length;let Co=-1;const mf=(Yr,Ks)=>Yr&&Yr.circleDiameter?Math.max(Yr.circleDiameter,Ks):Ks;Co=mf(ia,Co),Co=mf(Js,Co),Co=mf(po,Co),Co=mf(Rr,Co);const Ug=Co>-1?1:0;Ug&&(Co*=Uu/pr),sn.glyphOffsetArray.length>=Ou.MAX_GLYPHS&&Ue("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xi.sortKey!==void 0&&sn.addToSortKeyRanges(sn.symbolInstances.length,xi.sortKey);const qb=Mg(br,xi,Ui),[Gb,Zb]=function(Yr,Ks){const Yl=Yr.length,Lo=Ks==null?void 0:Ks.values;if((Lo==null?void 0:Lo.length)>0)for(let Jl=0;Jl<Lo.length;Jl+=2){const ra=Lo[Jl+1];Yr.emplaceBack(m.aq[Lo[Jl]],ra[0],ra[1])}return[Yl,Yr.length]}(sn.textAnchorOffsets,qb);sn.symbolInstances.emplaceBack(Sn.x,Sn.y,Ca.right>=0?Ca.right:-1,Ca.center>=0?Ca.center:-1,Ca.left>=0?Ca.left:-1,Ca.vertical||-1,ep,tp,Fg,Nb,zb,Ob,Fb,Bb,Ub,jb,Vb,ls,zg,Og,Ta,ah,Ug,0,xr,Co,Gb,Zb)}(o,cn,yt,u,g,v,tn,o.layers[0],o.collisionBoxArray,i.index,i.sourceLayerIndex,o.index,Ce,[Qe,Qe,Qe,Qe],$t,R,nt,ht,yn,te,i,E,O,j,T)};if(Wt==="line")for(const yt of xg(i.geometry,0,0,ar,ar)){const cn=Cb(yt,Ge,Et,u.vertical||se,g,24,Re,o.overscaling,ar);for(const sn of cn)se&&Rb(o,se.text,Zt,sn)||Kt(yt,sn)}else if(Wt==="line-center"){for(const yt of i.geometry)if(yt.length>1){const cn=Tb(yt,Et,u.vertical||se,g,24,Re);cn&&Kt(yt,cn)}}else if(i.type==="Polygon")for(const yt of ja(i.geometry,0)){const cn=Mb(yt,16);Kt(yt[0],new hl(cn.x,cn.y,0))}else if(i.type==="LineString")for(const yt of i.geometry)Kt(yt,new hl(yt[0].x,yt[0].y,0));else if(i.type==="Point")for(const yt of i.geometry)for(const cn of yt)Kt([cn],new hl(cn.x,cn.y,0))}function Ag(o,i,u,g,v,E,T,A,R,O,j,G,X,te,se){const de=function(nt,Ge,Qe,ht,Et,$t,yn,Wt){const Zt=ht.layout.get("text-rotate").evaluate($t,{})*Math.PI/180,on=[];for(const tn of Ge.positionedLines)for(const Kt of tn.positionedGlyphs){if(!Kt.rect)continue;const yt=Kt.rect||{};let cn=Wm+1,sn=!0,Sn=1,vi=0;const _i=(Et||Wt)&&Kt.vertical,vr=Kt.metrics.advance*Kt.scale/2;if(Wt&&Ge.verticalizable&&(vi=tn.lineOffset/2-(Kt.imageName?-(pr-Kt.metrics.width*Kt.scale)/2:(Kt.scale-1)*pr)),Kt.imageName){const oi=yn[Kt.imageName];sn=oi.sdf,Sn=oi.pixelRatio,cn=Es/Sn}const fo=Et?[Kt.x+vr,Kt.y]:[0,0];let Br=Et?[0,0]:[Kt.x+vr+Qe[0],Kt.y+Qe[1]-vi],br=[0,0];_i&&(br=Br,Br=[0,0]);const as=Kt.metrics.isDoubleResolution?2:1,ls=(Kt.metrics.left-cn)*Kt.scale-vr+Br[0],us=(-Kt.metrics.top-cn)*Kt.scale+Br[1],Gi=ls+yt.w/as*Kt.scale/Sn,xr=us+yt.h/as*Kt.scale/Sn,$r=new L(ls,us),Ur=new L(Gi,us),cs=new L(ls,xr),jr=new L(Gi,xr);if(_i){const oi=new L(-vr,vr-eh),xi=-Math.PI/2,Ci=pr/2-vr,Bs=new L(5-eh-Ci,-(Kt.imageName?Ci:0)),Ui=new L(...br);$r._rotateAround(xi,oi)._add(Bs)._add(Ui),Ur._rotateAround(xi,oi)._add(Bs)._add(Ui),cs._rotateAround(xi,oi)._add(Bs)._add(Ui),jr._rotateAround(xi,oi)._add(Bs)._add(Ui)}if(Zt){const oi=Math.sin(Zt),xi=Math.cos(Zt),Ci=[xi,-oi,oi,xi];$r._matMult(Ci),Ur._matMult(Ci),cs._matMult(Ci),jr._matMult(Ci)}const Ys=new L(0,0),Ts=new L(0,0);on.push({tl:$r,tr:Ur,bl:cs,br:jr,tex:yt,writingMode:Ge.writingMode,glyphOffset:fo,sectionIndex:Kt.sectionIndex,isSDF:sn,pixelOffsetTL:Ys,pixelOffsetBR:Ts,minFontScaleX:0,minFontScaleY:0})}return on}(0,u,A,v,E,T,g,o.allowVerticalPlacement),Ce=o.textSizeData;let Re=null;Ce.kind==="source"?(Re=[ta*v.layout.get("text-size").evaluate(T,{})],Re[0]>ul&&Ue(`${o.layerIds[0]}: Value for "text-size" is >= ${nh}. Reduce your "text-size".`)):Ce.kind==="composite"&&(Re=[ta*te.compositeTextSizes[0].evaluate(T,{},se),ta*te.compositeTextSizes[1].evaluate(T,{},se)],(Re[0]>ul||Re[1]>ul)&&Ue(`${o.layerIds[0]}: Value for "text-size" is >= ${nh}. Reduce your "text-size".`)),o.addSymbols(o.text,de,Re,A,E,T,O,i,R.lineStartIndex,R.lineLength,X,se);for(const nt of j)G[nt]=o.text.placedSymbolArray.length-1;return 4*de.length}function Pg(o){for(const i in o)return o[i];return null}function Rb(o,i,u,g){const v=o.compareText;if(i in v){const E=v[i];for(let T=E.length-1;T>=0;T--)if(g.dist(E[T])<u)return!0}else v[i]=[];return v[i].push(g),!1}const Rg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Wd{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,g]=new Uint8Array(i,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const v=g>>4;if(v!==1)throw new Error(`Got v${v} data when expected v1.`);const E=Rg[15&g];if(!E)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(i,2,1),[A]=new Uint32Array(i,4,1);return new Wd(A,T,E,i)}constructor(i,u=64,g=Float64Array,v){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=g,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const E=Rg.indexOf(this.ArrayType),T=2*i*this.ArrayType.BYTES_PER_ELEMENT,A=i*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-A%8)%8;if(E<0)throw new Error(`Unexpected typed array class: ${g}.`);v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+A+R,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+T+A+R),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+A+R,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+E]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=i)}add(i,u){const g=this._pos>>1;return this.ids[g]=g,this.coords[this._pos++]=i,this.coords[this._pos++]=u,g}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return Xd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,u,g,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:E,coords:T,nodeSize:A}=this,R=[0,E.length-1,0],O=[];for(;R.length;){const j=R.pop()||0,G=R.pop()||0,X=R.pop()||0;if(G-X<=A){for(let Ce=X;Ce<=G;Ce++){const Re=T[2*Ce],nt=T[2*Ce+1];Re>=i&&Re<=g&&nt>=u&&nt<=v&&O.push(E[Ce])}continue}const te=X+G>>1,se=T[2*te],de=T[2*te+1];se>=i&&se<=g&&de>=u&&de<=v&&O.push(E[te]),(j===0?i<=se:u<=de)&&(R.push(X),R.push(te-1),R.push(1-j)),(j===0?g>=se:v>=de)&&(R.push(te+1),R.push(G),R.push(1-j))}return O}within(i,u,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:E,nodeSize:T}=this,A=[0,v.length-1,0],R=[],O=g*g;for(;A.length;){const j=A.pop()||0,G=A.pop()||0,X=A.pop()||0;if(G-X<=T){for(let Ce=X;Ce<=G;Ce++)Ng(E[2*Ce],E[2*Ce+1],i,u)<=O&&R.push(v[Ce]);continue}const te=X+G>>1,se=E[2*te],de=E[2*te+1];Ng(se,de,i,u)<=O&&R.push(v[te]),(j===0?i-g<=se:u-g<=de)&&(A.push(X),A.push(te-1),A.push(1-j)),(j===0?i+g>=se:u+g>=de)&&(A.push(te+1),A.push(G),A.push(1-j))}return R}}function Xd(o,i,u,g,v,E){if(v-g<=u)return;const T=g+v>>1;Dg(o,i,T,g,v,E),Xd(o,i,u,g,T-1,1-E),Xd(o,i,u,T+1,v,1-E)}function Dg(o,i,u,g,v,E){for(;v>g;){if(v-g>600){const O=v-g+1,j=u-g+1,G=Math.log(O),X=.5*Math.exp(2*G/3),te=.5*Math.sqrt(G*X*(O-X)/O)*(j-O/2<0?-1:1);Dg(o,i,u,Math.max(g,Math.floor(u-j*X/O+te)),Math.min(v,Math.floor(u+(O-j)*X/O+te)),E)}const T=i[2*u+E];let A=g,R=v;for(sh(o,i,g,u),i[2*v+E]>T&&sh(o,i,g,v);A<R;){for(sh(o,i,A,R),A++,R--;i[2*A+E]<T;)A++;for(;i[2*R+E]>T;)R--}i[2*g+E]===T?sh(o,i,g,R):(R++,sh(o,i,R,v)),R<=u&&(g=R+1),u<=R&&(v=R-1)}}function sh(o,i,u,g){$d(o,u,g),$d(i,2*u,2*g),$d(i,2*u+1,2*g+1)}function $d(o,i,u){const g=o[i];o[i]=o[u],o[u]=g}function Ng(o,i,u,g){const v=o-u,E=i-g;return v*v+E*E}var Yd;m.bg=void 0,(Yd=m.bg||(m.bg={})).create="create",Yd.load="load",Yd.fullLoad="fullLoad";let pf=null,oh=[];const Jd=1e3/60,Kd="loadTime",Qd="fullLoadTime",Db={mark(o){performance.mark(o)},frame(o){const i=o;pf!=null&&oh.push(i-pf),pf=i},clearMetrics(){pf=null,oh=[],performance.clearMeasures(Kd),performance.clearMeasures(Qd);for(const o in m.bg)performance.clearMarks(m.bg[o])},getPerformanceMetrics(){performance.measure(Kd,m.bg.create,m.bg.load),performance.measure(Qd,m.bg.create,m.bg.fullLoad);const o=performance.getEntriesByName(Kd)[0].duration,i=performance.getEntriesByName(Qd)[0].duration,u=oh.length,g=1/(oh.reduce((E,T)=>E+T,0)/u/1e3),v=oh.filter(E=>E>Jd).reduce((E,T)=>E+(T-Jd)/Jd,0);return{loadTime:o,fullLoadTime:i,fps:g,percentDroppedFrames:v/(u+v)*100,totalFrames:u}}};m.$=class extends H{},m.A=Au,m.B=ad,m.C=function(o){if(St==null){const i=o.navigator?o.navigator.userAgent:null;St=!!o.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return St},m.D=nn,m.E=Lt,m.F=class{constructor(o,i){this.target=o,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Sb(()=>this.process()),this.subscription=function(u,g,v,E){return u.addEventListener(g,v,!1),{unsubscribe:()=>{u.removeEventListener(g,v,!1)}}}(this.target,"message",u=>this.receive(u)),this.globalScope=pt(self)?o:window}registerMessageHandler(o,i){this.messageHandlers[o]=i}sendAsync(o,i){return new Promise((u,g)=>{const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[v]={resolve:u,reject:g},i&&i.signal.addEventListener("abort",()=>{delete this.resolveRejects[v];const A={id:v,type:"<cancel>",origin:location.origin,targetMapId:o.targetMapId,sourceMapId:this.mapId};this.target.postMessage(A)},{once:!0});const E=[],T=Object.assign(Object.assign({},o),{id:v,sourceMapId:this.mapId,origin:location.origin,data:Ja(o.data,E)});this.target.postMessage(T,{transfer:E})})}receive(o){const i=o.data,u=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!=="resource://android"&&location.origin!=="resource://android"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[u];const g=this.abortControllers[u];return delete this.abortControllers[u],void(g&&g.abort())}if(pt(self)||i.mustQueue)return this.tasks[u]=i,this.taskQueue.push(u),void this.invoker.trigger();this.processTask(u,i)}}process(){if(this.taskQueue.length===0)return;const o=this.taskQueue.shift(),i=this.tasks[o];delete this.tasks[o],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(o,i)}processTask(o,i){return l(this,void 0,void 0,function*(){if(i.type==="<response>"){const v=this.resolveRejects[o];return delete this.resolveRejects[o],v?void(i.error?v.reject(Ka(i.error)):v.resolve(Ka(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(o,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const u=Ka(i.data),g=new AbortController;this.abortControllers[o]=g;try{const v=yield this.messageHandlers[i.type](i.sourceMapId,u,g);this.completeTask(o,null,v)}catch(v){this.completeTask(o,v)}})}completeTask(o,i,u){const g=[];delete this.abortControllers[o];const v={id:o,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?Ja(i):null,data:Ja(u,g)};this.target.postMessage(v,{transfer:g})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},m.G=pn,m.H=function(){var o=new Au(16);return Au!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},m.I=Dd,m.J=function(o,i,u){var g,v,E,T,A,R,O,j,G,X,te,se,de=u[0],Ce=u[1],Re=u[2];return i===o?(o[12]=i[0]*de+i[4]*Ce+i[8]*Re+i[12],o[13]=i[1]*de+i[5]*Ce+i[9]*Re+i[13],o[14]=i[2]*de+i[6]*Ce+i[10]*Re+i[14],o[15]=i[3]*de+i[7]*Ce+i[11]*Re+i[15]):(v=i[1],E=i[2],T=i[3],A=i[4],R=i[5],O=i[6],j=i[7],G=i[8],X=i[9],te=i[10],se=i[11],o[0]=g=i[0],o[1]=v,o[2]=E,o[3]=T,o[4]=A,o[5]=R,o[6]=O,o[7]=j,o[8]=G,o[9]=X,o[10]=te,o[11]=se,o[12]=g*de+A*Ce+G*Re+i[12],o[13]=v*de+R*Ce+X*Re+i[13],o[14]=E*de+O*Ce+te*Re+i[14],o[15]=T*de+j*Ce+se*Re+i[15]),o},m.K=function(o,i,u){var g=u[0],v=u[1],E=u[2];return o[0]=i[0]*g,o[1]=i[1]*g,o[2]=i[2]*g,o[3]=i[3]*g,o[4]=i[4]*v,o[5]=i[5]*v,o[6]=i[6]*v,o[7]=i[7]*v,o[8]=i[8]*E,o[9]=i[9]*E,o[10]=i[10]*E,o[11]=i[11]*E,o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o},m.L=mm,m.M=function(o,i){const u={};for(let g=0;g<i.length;g++){const v=i[g];v in o&&(u[v]=o[v])}return u},m.N=cl,m.O=cg,m.P=L,m.Q=hg,m.R=Xs,m.S=$s,m.T=xu,m.U=re,m.V=Q,m.W=Bt,m.X=ar,m.Y=P,m.Z=ih,m._=l,m.a=It,m.a$=function(o,i){var u=o[0],g=o[1],v=o[2],E=o[3],T=o[4],A=o[5],R=o[6],O=o[7],j=o[8],G=o[9],X=o[10],te=o[11],se=o[12],de=o[13],Ce=o[14],Re=o[15],nt=i[0],Ge=i[1],Qe=i[2],ht=i[3],Et=i[4],$t=i[5],yn=i[6],Wt=i[7],Zt=i[8],on=i[9],tn=i[10],Kt=i[11],yt=i[12],cn=i[13],sn=i[14],Sn=i[15];return Math.abs(u-nt)<=os*Math.max(1,Math.abs(u),Math.abs(nt))&&Math.abs(g-Ge)<=os*Math.max(1,Math.abs(g),Math.abs(Ge))&&Math.abs(v-Qe)<=os*Math.max(1,Math.abs(v),Math.abs(Qe))&&Math.abs(E-ht)<=os*Math.max(1,Math.abs(E),Math.abs(ht))&&Math.abs(T-Et)<=os*Math.max(1,Math.abs(T),Math.abs(Et))&&Math.abs(A-$t)<=os*Math.max(1,Math.abs(A),Math.abs($t))&&Math.abs(R-yn)<=os*Math.max(1,Math.abs(R),Math.abs(yn))&&Math.abs(O-Wt)<=os*Math.max(1,Math.abs(O),Math.abs(Wt))&&Math.abs(j-Zt)<=os*Math.max(1,Math.abs(j),Math.abs(Zt))&&Math.abs(G-on)<=os*Math.max(1,Math.abs(G),Math.abs(on))&&Math.abs(X-tn)<=os*Math.max(1,Math.abs(X),Math.abs(tn))&&Math.abs(te-Kt)<=os*Math.max(1,Math.abs(te),Math.abs(Kt))&&Math.abs(se-yt)<=os*Math.max(1,Math.abs(se),Math.abs(yt))&&Math.abs(de-cn)<=os*Math.max(1,Math.abs(de),Math.abs(cn))&&Math.abs(Ce-sn)<=os*Math.max(1,Math.abs(Ce),Math.abs(sn))&&Math.abs(Re-Sn)<=os*Math.max(1,Math.abs(Re),Math.abs(Sn))},m.a0=Gn,m.a1=Gd,m.a2=ct,m.a3=o=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(u=>{i.onloadstart=()=>{u(i)};for(const g of o){const v=window.document.createElement("source");dn(g)||(i.crossOrigin="Anonymous"),v.src=g,i.appendChild(v)}})},m.a4=function(){return xe++},m.a5=Xt,m.a6=Ou,m.a7=zt,m.a8=Xl,m.a9=_g,m.aA=function(o){if(o.type==="custom")return new Ib(o);switch(o.type){case"background":return new xb(o);case"circle":return new l1(o);case"fill":return new S1(o);case"fill-extrusion":return new U1(o);case"heatmap":return new c1(o);case"hillshade":return new f1(o);case"line":return new X1(o);case"raster":return new kb(o);case"symbol":return new uf(o)}},m.aB=we,m.aC=function(o,i){if(!o)return[{command:"setStyle",args:[i]}];let u=[];try{if(!Ee(o.version,i.version))return[{command:"setStyle",args:[i]}];Ee(o.center,i.center)||u.push({command:"setCenter",args:[i.center]}),Ee(o.zoom,i.zoom)||u.push({command:"setZoom",args:[i.zoom]}),Ee(o.bearing,i.bearing)||u.push({command:"setBearing",args:[i.bearing]}),Ee(o.pitch,i.pitch)||u.push({command:"setPitch",args:[i.pitch]}),Ee(o.sprite,i.sprite)||u.push({command:"setSprite",args:[i.sprite]}),Ee(o.glyphs,i.glyphs)||u.push({command:"setGlyphs",args:[i.glyphs]}),Ee(o.transition,i.transition)||u.push({command:"setTransition",args:[i.transition]}),Ee(o.light,i.light)||u.push({command:"setLight",args:[i.light]}),Ee(o.terrain,i.terrain)||u.push({command:"setTerrain",args:[i.terrain]}),Ee(o.sky,i.sky)||u.push({command:"setSky",args:[i.sky]}),Ee(o.projection,i.projection)||u.push({command:"setProjection",args:[i.projection]});const g={},v=[];(function(T,A,R,O){let j;for(j in A=A||{},T=T||{})Object.prototype.hasOwnProperty.call(T,j)&&(Object.prototype.hasOwnProperty.call(A,j)||Kn(j,R,O));for(j in A)Object.prototype.hasOwnProperty.call(A,j)&&(Object.prototype.hasOwnProperty.call(T,j)?Ee(T[j],A[j])||(T[j].type==="geojson"&&A[j].type==="geojson"&&xn(T,A,j)?Gt(R,{command:"setGeoJSONSourceData",args:[j,A[j].data]}):Yi(j,A,R,O)):_n(j,A,R))})(o.sources,i.sources,v,g);const E=[];o.layers&&o.layers.forEach(T=>{"source"in T&&g[T.source]?u.push({command:"removeLayer",args:[T.id]}):E.push(T)}),u=u.concat(v),function(T,A,R){A=A||[];const O=(T=T||[]).map(Ji),j=A.map(Ji),G=T.reduce(Jr,{}),X=A.reduce(Jr,{}),te=O.slice(),se=Object.create(null);let de,Ce,Re,nt,Ge;for(let Qe=0,ht=0;Qe<O.length;Qe++)de=O[Qe],Object.prototype.hasOwnProperty.call(X,de)?ht++:(Gt(R,{command:"removeLayer",args:[de]}),te.splice(te.indexOf(de,ht),1));for(let Qe=0,ht=0;Qe<j.length;Qe++)de=j[j.length-1-Qe],te[te.length-1-Qe]!==de&&(Object.prototype.hasOwnProperty.call(G,de)?(Gt(R,{command:"removeLayer",args:[de]}),te.splice(te.lastIndexOf(de,te.length-ht),1)):ht++,nt=te[te.length-Qe],Gt(R,{command:"addLayer",args:[X[de],nt]}),te.splice(te.length-Qe,0,de),se[de]=!0);for(let Qe=0;Qe<j.length;Qe++)if(de=j[Qe],Ce=G[de],Re=X[de],!se[de]&&!Ee(Ce,Re))if(Ee(Ce.source,Re.source)&&Ee(Ce["source-layer"],Re["source-layer"])&&Ee(Ce.type,Re.type)){for(Ge in qi(Ce.layout,Re.layout,R,de,null,"setLayoutProperty"),qi(Ce.paint,Re.paint,R,de,null,"setPaintProperty"),Ee(Ce.filter,Re.filter)||Gt(R,{command:"setFilter",args:[de,Re.filter]}),Ee(Ce.minzoom,Re.minzoom)&&Ee(Ce.maxzoom,Re.maxzoom)||Gt(R,{command:"setLayerZoomRange",args:[de,Re.minzoom,Re.maxzoom]}),Ce)Object.prototype.hasOwnProperty.call(Ce,Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?qi(Ce[Ge],Re[Ge],R,de,Ge.slice(6),"setPaintProperty"):Ee(Ce[Ge],Re[Ge])||Gt(R,{command:"setLayerProperty",args:[de,Ge,Re[Ge]]}));for(Ge in Re)Object.prototype.hasOwnProperty.call(Re,Ge)&&!Object.prototype.hasOwnProperty.call(Ce,Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&(Ge.indexOf("paint.")===0?qi(Ce[Ge],Re[Ge],R,de,Ge.slice(6),"setPaintProperty"):Ee(Ce[Ge],Re[Ge])||Gt(R,{command:"setLayerProperty",args:[de,Ge,Re[Ge]]}))}else Gt(R,{command:"removeLayer",args:[de]}),nt=te[te.lastIndexOf(de)+1],Gt(R,{command:"addLayer",args:[Re,nt]})}(E,i.layers,u)}catch(g){console.warn("Unable to compute style diff:",g),u=[{command:"setStyle",args:[i]}]}return u},m.aD=function(o){const i=[],u=o.id;return u===void 0&&i.push({message:`layers.${u}: missing required property "id"`}),o.render===void 0&&i.push({message:`layers.${u}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&i.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),i},m.aE=function o(i,u){if(Array.isArray(i)){if(!Array.isArray(u)||i.length!==u.length)return!1;for(let g=0;g<i.length;g++)if(!o(i[g],u[g]))return!1;return!0}if(typeof i=="object"&&i!==null&&u!==null){if(typeof u!="object"||Object.keys(i).length!==Object.keys(u).length)return!1;for(const g in i)if(!o(i[g],u[g]))return!1;return!0}return i===u},m.aF=be,m.aG=Le,m.aH=class extends Zl{constructor(o,i){super(o,i),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},m.aI=$h,m.aJ=class extends Zl{constructor(o,i){super(o,i),this.current=e1}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let i=1;i<16;i++)if(o[i]!==this.current[i]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},m.aK=rm,m.aL=sm,m.aM=Qn,m.aN=class extends Zl{constructor(o,i){super(o,i),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},m.aO=class extends Zl{constructor(o,i){super(o,i),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},m.aP=function(o,i,u,g,v,E,T){var A=1/(i-u),R=1/(g-v),O=1/(E-T);return o[0]=-2*A,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*R,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*O,o[11]=0,o[12]=(i+u)*A,o[13]=(v+g)*R,o[14]=(T+E)*O,o[15]=1,o},m.aQ=a1,m.aR=class extends Ze{},m.aS=K1,m.aT=class extends it{},m.aU=wd,m.aV=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},m.aW=bm,m.aX=zr,m.aY=Ws,m.aZ=class extends rn{},m.a_=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]&&o[4]===i[4]&&o[5]===i[5]&&o[6]===i[6]&&o[7]===i[7]&&o[8]===i[8]&&o[9]===i[9]&&o[10]===i[10]&&o[11]===i[11]&&o[12]===i[12]&&o[13]===i[13]&&o[14]===i[14]&&o[15]===i[15]},m.aa=function(o){const i={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,g,v,E)=>{const T=v||E;return i[g]=!T||T.toLowerCase(),""}),i["max-age"]){const u=parseInt(i["max-age"],10);isNaN(u)?delete i["max-age"]:i["max-age"]=u}return i},m.ab=function(o,i){const u=[];for(const g in o)g in i||u.push(g);return u},m.ac=ve,m.ad=function(o,i,u){var g=Math.sin(u),v=Math.cos(u),E=i[0],T=i[1],A=i[2],R=i[3],O=i[4],j=i[5],G=i[6],X=i[7];return i!==o&&(o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=E*v+O*g,o[1]=T*v+j*g,o[2]=A*v+G*g,o[3]=R*v+X*g,o[4]=O*v-E*g,o[5]=j*v-T*g,o[6]=G*v-A*g,o[7]=X*v-R*g,o},m.ae=function(o){var i=new Au(16);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i[9]=o[9],i[10]=o[10],i[11]=o[11],i[12]=o[12],i[13]=o[13],i[14]=o[14],i[15]=o[15],i},m.af=Qh,m.ag=function(o,i){let u=0,g=0;if(o.kind==="constant")g=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:v,minZoom:E,maxZoom:T}=o,A=v?ve(cr.interpolationFactor(v,i,E,T),0,1):0;o.kind==="camera"?g=bi.number(o.minSize,o.maxSize,A):u=A}return{uSizeT:u,uSize:g}},m.ai=function(o,{uSize:i,uSizeT:u},{lowerSize:g,upperSize:v}){return o.kind==="source"?g/ta:o.kind==="composite"?bi.number(g/ta,v/ta,u):i},m.aj=Fd,m.ak=function(o,i,u,g){const v=i.y-o.y,E=i.x-o.x,T=g.y-u.y,A=g.x-u.x,R=T*E-A*v;if(R===0)return null;const O=(A*(o.y-u.y)-T*(o.x-u.x))/R;return new L(o.x+O*E,o.y+O*v)},m.al=xg,m.am=um,m.an=vd,m.ao=function(o){let i=1/0,u=1/0,g=-1/0,v=-1/0;for(const E of o)i=Math.min(i,E.x),u=Math.min(u,E.y),g=Math.max(g,E.x),v=Math.max(v,E.y);return[i,u,g,v]},m.ap=pr,m.ar=Od,m.as=function(o,i){var u=i[0],g=i[1],v=i[2],E=i[3],T=i[4],A=i[5],R=i[6],O=i[7],j=i[8],G=i[9],X=i[10],te=i[11],se=i[12],de=i[13],Ce=i[14],Re=i[15],nt=u*A-g*T,Ge=u*R-v*T,Qe=u*O-E*T,ht=g*R-v*A,Et=g*O-E*A,$t=v*O-E*R,yn=j*de-G*se,Wt=j*Ce-X*se,Zt=j*Re-te*se,on=G*Ce-X*de,tn=G*Re-te*de,Kt=X*Re-te*Ce,yt=nt*Kt-Ge*tn+Qe*on+ht*Zt-Et*Wt+$t*yn;return yt?(o[0]=(A*Kt-R*tn+O*on)*(yt=1/yt),o[1]=(v*tn-g*Kt-E*on)*yt,o[2]=(de*$t-Ce*Et+Re*ht)*yt,o[3]=(X*Et-G*$t-te*ht)*yt,o[4]=(R*Zt-T*Kt-O*Wt)*yt,o[5]=(u*Kt-v*Zt+E*Wt)*yt,o[6]=(Ce*Qe-se*$t-Re*Ge)*yt,o[7]=(j*$t-X*Qe+te*Ge)*yt,o[8]=(T*tn-A*Zt+O*yn)*yt,o[9]=(g*Zt-u*tn-E*yn)*yt,o[10]=(se*Et-de*Qe+Re*nt)*yt,o[11]=(G*Qe-j*Et-te*nt)*yt,o[12]=(A*Wt-T*on-R*yn)*yt,o[13]=(u*on-g*Wt+v*yn)*yt,o[14]=(de*Ge-se*ht-Ce*nt)*yt,o[15]=(j*ht-G*Ge+X*nt)*yt,o):null},m.at=Hd,m.au=zd,m.av=Wd,m.aw=function(){const o={},i=Ye.$version;for(const u in Ye.$root){const g=Ye.$root[u];if(g.required){let v=null;v=u==="version"?i:g.type==="array"?[]:{},v!=null&&(o[u]=v)}}return o},m.ax=Oc,m.ay=Xe,m.az=function(o){o=o.slice();const i=Object.create(null);for(let u=0;u<o.length;u++)i[o[u].id]=o[u];for(let u=0;u<o.length;u++)"ref"in o[u]&&(o[u]=Vt(o[u],i[o[u].ref]));return o},m.b=dt,m.b0=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o},m.b1=function(o,i,u){return o[0]=i[0]*u[0],o[1]=i[1]*u[1],o[2]=i[2]*u[2],o[3]=i[3]*u[3],o},m.b2=function(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]+o[3]*i[3]},m.b3=De,m.b4=pg,m.b5=fg,m.b6=function(o,i,u,g,v){var E,T=1/Math.tan(i/2);return o[0]=T/u,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=T,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,v!=null&&v!==1/0?(o[10]=(v+g)*(E=1/(g-v)),o[14]=2*v*g*E):(o[10]=-1,o[14]=-2*g),o},m.b7=function(o,i,u){var g=Math.sin(u),v=Math.cos(u),E=i[4],T=i[5],A=i[6],R=i[7],O=i[8],j=i[9],G=i[10],X=i[11];return i!==o&&(o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[4]=E*v+O*g,o[5]=T*v+j*g,o[6]=A*v+G*g,o[7]=R*v+X*g,o[8]=O*v-E*g,o[9]=j*v-T*g,o[10]=G*v-A*g,o[11]=X*v-R*g,o},m.b8=$,m.b9=pe,m.bA=Um,m.bB=function(o){return o.message===ft},m.bC=M,m.bD=Is,m.ba=function(o){return o*Math.PI/180},m.bb=function(o,i){const{x:u,y:g}=ih.fromLngLat(i);return!(o<0||o>25||g<0||g>=1||u<0||u>=1)},m.bc=function(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=i[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},m.bd=class extends V{},m.be=Vd,m.bf=Db,m.bh=Rn,m.bi=function(o,i){It.REGISTERED_PROTOCOLS[o]=i},m.bj=function(o){delete It.REGISTERED_PROTOCOLS[o]},m.bk=function(o,i){const u={};for(let v=0;v<o.length;v++){const E=i&&i[o[v].id]||rs(o[v]);i&&(i[o[v].id]=E);let T=u[E];T||(T=u[E]=[]),T.push(o[v])}const g=[];for(const v in u)g.push(u[v]);return g},m.bl=Qt,m.bm=gg,m.bn=yg,m.bo=$m,m.bp=function(o){o.bucket.createArrays(),o.bucket.tilePixelRatio=ar/(512*o.bucket.overscaling),o.bucket.compareText={},o.bucket.iconsNeedLinear=!1;const i=o.bucket.layers[0],u=i.layout,g=i._unevaluatedLayout._values,v={layoutIconSize:g["icon-size"].possiblyEvaluate(new Ii(o.bucket.zoom+1),o.canonical),layoutTextSize:g["text-size"].possiblyEvaluate(new Ii(o.bucket.zoom+1),o.canonical),textMaxSize:g["text-size"].possiblyEvaluate(new Ii(18))};if(o.bucket.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:j}=o.bucket.textSizeData;v.compositeTextSizes=[g["text-size"].possiblyEvaluate(new Ii(O),o.canonical),g["text-size"].possiblyEvaluate(new Ii(j),o.canonical)]}if(o.bucket.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:j}=o.bucket.iconSizeData;v.compositeIconSizes=[g["icon-size"].possiblyEvaluate(new Ii(O),o.canonical),g["icon-size"].possiblyEvaluate(new Ii(j),o.canonical)]}const E=u.get("text-line-height")*pr,T=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point",A=u.get("text-keep-upright"),R=u.get("text-size");for(const O of o.bucket.features){const j=u.get("text-font").evaluate(O,{},o.canonical).join(","),G=R.evaluate(O,{},o.canonical),X=v.layoutTextSize.evaluate(O,{},o.canonical),te=v.layoutIconSize.evaluate(O,{},o.canonical),se={horizontal:{},vertical:void 0},de=O.text;let Ce,Re=[0,0];if(de){const Qe=de.toString(),ht=u.get("text-letter-spacing").evaluate(O,{},o.canonical)*pr,Et=ld(Qe)?ht:0,$t=u.get("text-anchor").evaluate(O,{},o.canonical),yn=Mg(i,O,o.canonical);if(!yn){const tn=u.get("text-radial-offset").evaluate(O,{},o.canonical);Re=tn?Lg($t,[tn*pr,Zd]):u.get("text-offset").evaluate(O,{},o.canonical).map(Kt=>Kt*pr)}let Wt=T?"center":u.get("text-justify").evaluate(O,{},o.canonical);const Zt=u.get("symbol-placement")==="point"?u.get("text-max-width").evaluate(O,{},o.canonical)*pr:1/0,on=()=>{o.bucket.allowVerticalPlacement&&Fc(Qe)&&(se.vertical=of(de,o.glyphMap,o.glyphPositions,o.imagePositions,j,Zt,E,$t,"left",Et,Re,m.ah.vertical,!0,X,G))};if(!T&&yn){const tn=new Set;if(Wt==="auto")for(let yt=0;yt<yn.values.length;yt+=2)tn.add(Hd(yn.values[yt]));else tn.add(Wt);let Kt=!1;for(const yt of tn)if(!se.horizontal[yt])if(Kt)se.horizontal[yt]=se.horizontal[0];else{const cn=of(de,o.glyphMap,o.glyphPositions,o.imagePositions,j,Zt,E,"center",yt,Et,Re,m.ah.horizontal,!1,X,G);cn&&(se.horizontal[yt]=cn,Kt=cn.positionedLines.length===1)}on()}else{Wt==="auto"&&(Wt=Hd($t));const tn=of(de,o.glyphMap,o.glyphPositions,o.imagePositions,j,Zt,E,$t,Wt,Et,Re,m.ah.horizontal,!1,X,G);tn&&(se.horizontal[Wt]=tn),on(),Fc(Qe)&&T&&A&&(se.vertical=of(de,o.glyphMap,o.glyphPositions,o.imagePositions,j,Zt,E,$t,Wt,Et,Re,m.ah.vertical,!1,X,G))}}let nt=!1;if(O.icon&&O.icon.name){const Qe=o.imageMap[O.icon.name];Qe&&(Ce=gb(o.imagePositions[O.icon.name],u.get("icon-offset").evaluate(O,{},o.canonical),u.get("icon-anchor").evaluate(O,{},o.canonical)),nt=!!Qe.sdf,o.bucket.sdfIcons===void 0?o.bucket.sdfIcons=nt:o.bucket.sdfIcons!==nt&&Ue("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Qe.pixelRatio!==o.bucket.pixelRatio||u.get("icon-rotate").constantOr(1)!==0)&&(o.bucket.iconsNeedLinear=!0))}const Ge=Pg(se.horizontal)||se.vertical;o.bucket.iconsInText=!!Ge&&Ge.iconsInText,(Ge||Ce)&&Pb(o.bucket,O,se,Ce,o.imageMap,v,X,te,Re,nt,o.canonical)}o.showCollisionBoxes&&o.bucket.generateCollisionDebugBuffers()},m.bq=Md,m.br=Td,m.bs=Ld,m.bt=al,m.bu=Pd,m.bv=class{constructor(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let o=performance.getEntriesByName(this._marks.measure);return o.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),o=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),o}},m.bw=function(o,i,u,g,v){return l(this,void 0,void 0,function*(){if(Q())try{return yield Bt(o,i,u,g,v)}catch{}return function(E,T,A,R,O){const j=E.width,G=E.height;vt&&wt||(vt=new OffscreenCanvas(j,G),wt=vt.getContext("2d",{willReadFrequently:!0})),vt.width=j,vt.height=G,wt.drawImage(E,0,0,j,G);const X=wt.getImageData(T,A,R,O);return wt.clearRect(0,0,j,G),X.data}(o,i,u,g,v)})},m.bx=mg,m.by=x,m.bz=S,m.c=xt,m.d=o=>l(void 0,void 0,void 0,function*(){if(o.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(o)],{type:"image/png"});try{return createImageBitmap(i)}catch(u){throw new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),m.e=he,m.f=o=>new Promise((i,u)=>{const g=new Image;g.onload=()=>{i(g),URL.revokeObjectURL(g.src),g.onload=null,window.requestAnimationFrame(()=>{g.src=ut})},g.onerror=()=>u(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(o)],{type:"image/png"});g.src=o.byteLength?URL.createObjectURL(v):ut}),m.g=Jt,m.h=(o,i)=>Wn(he(o,{type:"json"}),i),m.i=pt,m.j=Je,m.k=lt,m.l=(o,i)=>Wn(he(o,{type:"arrayBuffer"}),i),m.m=Wn,m.n=function(o){return new Pd(o).readFields(ub,[])},m.o=Wc,m.p=Xm,m.q=k,m.r=od,m.s=dn,m.t=Nc,m.u=ka,m.v=Ye,m.w=Ue,m.x=function([o,i,u]){return i+=90,i*=Math.PI/180,u*=Math.PI/180,{x:o*Math.cos(i)*Math.sin(u),y:o*Math.sin(i)*Math.sin(u),z:o*Math.cos(u)}},m.y=bi,m.z=Ii}),a("worker",["./shared"],function(m){class l{constructor(K){this.keyCache={},K&&this.replace(K)}replace(K){this._layerConfigs={},this._layers={},this.update(K,[])}update(K,J){for(const le of K){this._layerConfigs[le.id]=le;const fe=this._layers[le.id]=m.aA(le);fe._featureFilter=m.a7(fe.filter),this.keyCache[le.id]&&delete this.keyCache[le.id]}for(const le of J)delete this.keyCache[le],delete this._layerConfigs[le],delete this._layers[le];this.familiesBySource={};const ce=m.bk(Object.values(this._layerConfigs),this.keyCache);for(const le of ce){const fe=le.map(at=>this._layers[at.id]),je=fe[0];if(je.visibility==="none")continue;const We=je.source||"";let Pe=this.familiesBySource[We];Pe||(Pe=this.familiesBySource[We]={});const et=je.sourceLayer||"_geojsonTileLayer";let gt=Pe[et];gt||(gt=Pe[et]=[]),gt.push(fe)}}}class x{constructor(K){const J={},ce=[];for(const We in K){const Pe=K[We],et=J[We]={};for(const gt in Pe){const at=Pe[+gt];if(!at||at.bitmap.width===0||at.bitmap.height===0)continue;const Dt={x:0,y:0,w:at.bitmap.width+2,h:at.bitmap.height+2};ce.push(Dt),et[gt]={rect:Dt,metrics:at.metrics}}}const{w:le,h:fe}=m.p(ce),je=new m.o({width:le||1,height:fe||1});for(const We in K){const Pe=K[We];for(const et in Pe){const gt=Pe[+et];if(!gt||gt.bitmap.width===0||gt.bitmap.height===0)continue;const at=J[We][et].rect;m.o.copy(gt.bitmap,je,{x:0,y:0},{x:at.x+1,y:at.y+1},gt.bitmap)}}this.image=je,this.positions=J}}m.bl("GlyphAtlas",x);class S{constructor(K){this.tileID=new m.S(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.uid=K.uid,this.zoom=K.zoom,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=K.showCollisionBoxes,this.collectResourceTiming=!!K.collectResourceTiming,this.returnDependencies=!!K.returnDependencies,this.promoteId=K.promoteId,this.inFlightDependencies=[]}parse(K,J,ce,le){return m._(this,void 0,void 0,function*(){this.status="parsing",this.data=K,this.collisionBoxArray=new m.a5;const fe=new m.bm(Object.keys(K.layers).sort()),je=new m.bn(this.tileID,this.promoteId);je.bucketLayerIDs=[];const We={},Pe={featureIndex:je,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ce},et=J.familiesBySource[this.source];for(const Cn in et){const ii=K.layers[Cn];if(!ii)continue;ii.version===1&&m.w(`Vector tile source "${this.source}" layer "${Cn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const hi=fe.encode(Cn),Ai=[];for(let Xn=0;Xn<ii.length;Xn++){const Tr=ii.feature(Xn),No=je.getId(Tr,Cn);Ai.push({feature:Tr,id:No,index:Xn,sourceLayerIndex:hi})}for(const Xn of et[Cn]){const Tr=Xn[0];Tr.source!==this.source&&m.w(`layer.source = ${Tr.source} does not equal this.source = ${this.source}`),Tr.minzoom&&this.zoom<Math.floor(Tr.minzoom)||Tr.maxzoom&&this.zoom>=Tr.maxzoom||Tr.visibility!=="none"&&(C(Xn,this.zoom,ce),(We[Tr.id]=Tr.createBucket({index:je.bucketLayerIDs.length,layers:Xn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:hi,sourceID:this.source})).populate(Ai,Pe,this.tileID.canonical),je.bucketLayerIDs.push(Xn.map(No=>No.id)))}}const gt=m.aF(Pe.glyphDependencies,Cn=>Object.keys(Cn).map(Number));this.inFlightDependencies.forEach(Cn=>Cn==null?void 0:Cn.abort()),this.inFlightDependencies=[];let at=Promise.resolve({});if(Object.keys(gt).length){const Cn=new AbortController;this.inFlightDependencies.push(Cn),at=le.sendAsync({type:"GG",data:{stacks:gt,source:this.source,tileID:this.tileID,type:"glyphs"}},Cn)}const Dt=Object.keys(Pe.iconDependencies);let en=Promise.resolve({});if(Dt.length){const Cn=new AbortController;this.inFlightDependencies.push(Cn),en=le.sendAsync({type:"GI",data:{icons:Dt,source:this.source,tileID:this.tileID,type:"icons"}},Cn)}const an=Object.keys(Pe.patternDependencies);let Vn=Promise.resolve({});if(an.length){const Cn=new AbortController;this.inFlightDependencies.push(Cn),Vn=le.sendAsync({type:"GI",data:{icons:an,source:this.source,tileID:this.tileID,type:"patterns"}},Cn)}const[Mn,An,Fn]=yield Promise.all([at,en,Vn]),wi=new x(Mn),ui=new m.bo(An,Fn);for(const Cn in We){const ii=We[Cn];ii instanceof m.a6?(C(ii.layers,this.zoom,ce),m.bp({bucket:ii,glyphMap:Mn,glyphPositions:wi.positions,imageMap:An,imagePositions:ui.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ii.hasPattern&&(ii instanceof m.bq||ii instanceof m.br||ii instanceof m.bs)&&(C(ii.layers,this.zoom,ce),ii.addFeatures(Pe,this.tileID.canonical,ui.patternPositions))}return this.status="done",{buckets:Object.values(We).filter(Cn=>!Cn.isEmpty()),featureIndex:je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:wi.image,imageAtlas:ui,glyphMap:this.returnDependencies?Mn:null,iconMap:this.returnDependencies?An:null,glyphPositions:this.returnDependencies?wi.positions:null}})}}function C(Ae,K,J){const ce=new m.z(K);for(const le of Ae)le.recalculate(ce,J)}class L{constructor(K,J,ce){this.actor=K,this.layerIndex=J,this.availableImages=ce,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(K,J){return m._(this,void 0,void 0,function*(){const ce=yield m.l(K.request,J);try{return{vectorTile:new m.bt.VectorTile(new m.bu(ce.data)),rawData:ce.data,cacheControl:ce.cacheControl,expires:ce.expires}}catch(le){const fe=new Uint8Array(ce.data);let je=`Unable to parse the tile at ${K.request.url}, `;throw je+=fe[0]===31&&fe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${le.message}`,new Error(je)}})}loadTile(K){return m._(this,void 0,void 0,function*(){const J=K.uid,ce=!!(K&&K.request&&K.request.collectResourceTiming)&&new m.bv(K.request),le=new S(K);this.loading[J]=le;const fe=new AbortController;le.abort=fe;try{const je=yield this.loadVectorTile(K,fe);if(delete this.loading[J],!je)return null;const We=je.rawData,Pe={};je.expires&&(Pe.expires=je.expires),je.cacheControl&&(Pe.cacheControl=je.cacheControl);const et={};if(ce){const at=ce.finish();at&&(et.resourceTiming=JSON.parse(JSON.stringify(at)))}le.vectorTile=je.vectorTile;const gt=le.parse(je.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[J]=le,this.fetching[J]={rawTileData:We,cacheControl:Pe,resourceTiming:et};try{const at=yield gt;return m.e({rawTileData:We.slice(0)},at,Pe,et)}finally{delete this.fetching[J]}}catch(je){throw delete this.loading[J],le.status="done",this.loaded[J]=le,je}})}reloadTile(K){return m._(this,void 0,void 0,function*(){const J=K.uid;if(!this.loaded||!this.loaded[J])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ce=this.loaded[J];if(ce.showCollisionBoxes=K.showCollisionBoxes,ce.status==="parsing"){const le=yield ce.parse(ce.vectorTile,this.layerIndex,this.availableImages,this.actor);let fe;if(this.fetching[J]){const{rawTileData:je,cacheControl:We,resourceTiming:Pe}=this.fetching[J];delete this.fetching[J],fe=m.e({rawTileData:je.slice(0)},le,We,Pe)}else fe=le;return fe}if(ce.status==="done"&&ce.vectorTile)return ce.parse(ce.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(K){return m._(this,void 0,void 0,function*(){const J=this.loading,ce=K.uid;J&&J[ce]&&J[ce].abort&&(J[ce].abort.abort(),delete J[ce])})}removeTile(K){return m._(this,void 0,void 0,function*(){this.loaded&&this.loaded[K.uid]&&delete this.loaded[K.uid]})}}class N{constructor(){this.loaded={}}loadTile(K){return m._(this,void 0,void 0,function*(){const{uid:J,encoding:ce,rawImageData:le,redFactor:fe,greenFactor:je,blueFactor:We,baseShift:Pe}=K,et=le.width+2,gt=le.height+2,at=m.b(le)?new m.R({width:et,height:gt},yield m.bw(le,-1,-1,et,gt)):le,Dt=new m.bx(J,at,ce,fe,je,We,Pe);return this.loaded=this.loaded||{},this.loaded[J]=Dt,Dt})}removeTile(K){const J=this.loaded,ce=K.uid;J&&J[ce]&&delete J[ce]}}function B(Ae,K){if(Ae.length!==0){U(Ae[0],K);for(var J=1;J<Ae.length;J++)U(Ae[J],!K)}}function U(Ae,K){for(var J=0,ce=0,le=0,fe=Ae.length,je=fe-1;le<fe;je=le++){var We=(Ae[le][0]-Ae[je][0])*(Ae[je][1]+Ae[le][1]),Pe=J+We;ce+=Math.abs(J)>=Math.abs(We)?J-Pe+We:We-Pe+J,J=Pe}J+ce>=0!=!!K&&Ae.reverse()}var ee=m.by(function Ae(K,J){var ce,le=K&&K.type;if(le==="FeatureCollection")for(ce=0;ce<K.features.length;ce++)Ae(K.features[ce],J);else if(le==="GeometryCollection")for(ce=0;ce<K.geometries.length;ce++)Ae(K.geometries[ce],J);else if(le==="Feature")Ae(K.geometry,J);else if(le==="Polygon")B(K.coordinates,J);else if(le==="MultiPolygon")for(ce=0;ce<K.coordinates.length;ce++)B(K.coordinates[ce],J);return K});const ie=m.bt.VectorTileFeature.prototype.toGeoJSON;var re={exports:{}},Q=m.bz,$=m.bt.VectorTileFeature,pe=ve;function ve(Ae,K){this.options=K||{},this.features=Ae,this.length=Ae.length}function De(Ae,K){this.id=typeof Ae.id=="number"?Ae.id:void 0,this.type=Ae.type,this.rawGeometry=Ae.type===1?[Ae.geometry]:Ae.geometry,this.properties=Ae.tags,this.extent=K||4096}ve.prototype.feature=function(Ae){return new De(this.features[Ae],this.options.extent)},De.prototype.loadGeometry=function(){var Ae=this.rawGeometry;this.geometry=[];for(var K=0;K<Ae.length;K++){for(var J=Ae[K],ce=[],le=0;le<J.length;le++)ce.push(new Q(J[le][0],J[le][1]));this.geometry.push(ce)}return this.geometry},De.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ae=this.geometry,K=1/0,J=-1/0,ce=1/0,le=-1/0,fe=0;fe<Ae.length;fe++)for(var je=Ae[fe],We=0;We<je.length;We++){var Pe=je[We];K=Math.min(K,Pe.x),J=Math.max(J,Pe.x),ce=Math.min(ce,Pe.y),le=Math.max(le,Pe.y)}return[K,ce,J,le]},De.prototype.toGeoJSON=$.prototype.toGeoJSON;var he=m.bA,xe=pe;function be(Ae){var K=new he;return function(J,ce){for(var le in J.layers)ce.writeMessage(3,Le,J.layers[le])}(Ae,K),K.finish()}function Le(Ae,K){var J;K.writeVarintField(15,Ae.version||1),K.writeStringField(1,Ae.name||""),K.writeVarintField(5,Ae.extent||4096);var ce={keys:[],values:[],keycache:{},valuecache:{}};for(J=0;J<Ae.length;J++)ce.feature=Ae.feature(J),K.writeMessage(2,we,ce);var le=ce.keys;for(J=0;J<le.length;J++)K.writeStringField(3,le[J]);var fe=ce.values;for(J=0;J<fe.length;J++)K.writeMessage(4,St,fe[J])}function we(Ae,K){var J=Ae.feature;J.id!==void 0&&K.writeVarintField(1,J.id),K.writeMessage(2,ye,Ae),K.writeVarintField(3,J.type),K.writeMessage(4,pt,J)}function ye(Ae,K){var J=Ae.feature,ce=Ae.keys,le=Ae.values,fe=Ae.keycache,je=Ae.valuecache;for(var We in J.properties){var Pe=J.properties[We],et=fe[We];if(Pe!==null){et===void 0&&(ce.push(We),fe[We]=et=ce.length-1),K.writeVarint(et);var gt=typeof Pe;gt!=="string"&&gt!=="boolean"&&gt!=="number"&&(Pe=JSON.stringify(Pe));var at=gt+":"+Pe,Dt=je[at];Dt===void 0&&(le.push(Pe),je[at]=Dt=le.length-1),K.writeVarint(Dt)}}}function Ue(Ae,K){return(K<<3)+(7&Ae)}function Ve(Ae){return Ae<<1^Ae>>31}function pt(Ae,K){for(var J=Ae.loadGeometry(),ce=Ae.type,le=0,fe=0,je=J.length,We=0;We<je;We++){var Pe=J[We],et=1;ce===1&&(et=Pe.length),K.writeVarint(Ue(1,et));for(var gt=ce===3?Pe.length-1:Pe.length,at=0;at<gt;at++){at===1&&ce!==1&&K.writeVarint(Ue(2,gt-1));var Dt=Pe[at].x-le,en=Pe[at].y-fe;K.writeVarint(Ve(Dt)),K.writeVarint(Ve(en)),le+=Dt,fe+=en}ce===3&&K.writeVarint(Ue(7,1))}}function St(Ae,K){var J=typeof Ae;J==="string"?K.writeStringField(1,Ae):J==="boolean"?K.writeBooleanField(7,Ae):J==="number"&&(Ae%1!=0?K.writeDoubleField(3,Ae):Ae<0?K.writeSVarintField(6,Ae):K.writeVarintField(5,Ae))}re.exports=be,re.exports.fromVectorTileJs=be,re.exports.fromGeojsonVt=function(Ae,K){K=K||{};var J={};for(var ce in Ae)J[ce]=new xe(Ae[ce].features,K),J[ce].name=ce,J[ce].version=K.version,J[ce].extent=K.extent;return be({layers:J})},re.exports.GeoJSONWrapper=xe;var dt=m.by(re.exports);const ut={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ae=>Ae},Bt=Math.fround||(vt=new Float32Array(1),Ae=>(vt[0]=+Ae,vt[0]));var vt;const wt=3,ft=5,xt=6;class It{constructor(K){this.options=Object.assign(Object.create(ut),K),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(K){const{log:J,minZoom:ce,maxZoom:le}=this.options;J&&console.time("total time");const fe=`prepare ${K.length} points`;J&&console.time(fe),this.points=K;const je=[];for(let Pe=0;Pe<K.length;Pe++){const et=K[Pe];if(!et.geometry)continue;const[gt,at]=et.geometry.coordinates,Dt=Bt(Rn(gt)),en=Bt(Xe(at));je.push(Dt,en,1/0,Pe,-1,1),this.options.reduce&&je.push(0)}let We=this.trees[le+1]=this._createTree(je);J&&console.timeEnd(fe);for(let Pe=le;Pe>=ce;Pe--){const et=+Date.now();We=this.trees[Pe]=this._createTree(this._cluster(We,Pe)),J&&console.log("z%d: %d clusters in %dms",Pe,We.numItems,+Date.now()-et)}return J&&console.timeEnd("total time"),this}getClusters(K,J){let ce=((K[0]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,K[1]));let fe=K[2]===180?180:((K[2]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,K[3]));if(K[2]-K[0]>=360)ce=-180,fe=180;else if(ce>fe){const at=this.getClusters([ce,le,180,je],J),Dt=this.getClusters([-180,le,fe,je],J);return at.concat(Dt)}const We=this.trees[this._limitZoom(J)],Pe=We.range(Rn(ce),Xe(je),Rn(fe),Xe(le)),et=We.data,gt=[];for(const at of Pe){const Dt=this.stride*at;gt.push(et[Dt+ft]>1?Jt(et,Dt,this.clusterProps):this.points[et[Dt+wt]])}return gt}getChildren(K){const J=this._getOriginId(K),ce=this._getOriginZoom(K),le="No cluster with the specified id.",fe=this.trees[ce];if(!fe)throw new Error(le);const je=fe.data;if(J*this.stride>=je.length)throw new Error(le);const We=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Pe=fe.within(je[J*this.stride],je[J*this.stride+1],We),et=[];for(const gt of Pe){const at=gt*this.stride;je[at+4]===K&&et.push(je[at+ft]>1?Jt(je,at,this.clusterProps):this.points[je[at+wt]])}if(et.length===0)throw new Error(le);return et}getLeaves(K,J,ce){const le=[];return this._appendLeaves(le,K,J=J||10,ce=ce||0,0),le}getTile(K,J,ce){const le=this.trees[this._limitZoom(K)],fe=Math.pow(2,K),{extent:je,radius:We}=this.options,Pe=We/je,et=(ce-Pe)/fe,gt=(ce+1+Pe)/fe,at={features:[]};return this._addTileFeatures(le.range((J-Pe)/fe,et,(J+1+Pe)/fe,gt),le.data,J,ce,fe,at),J===0&&this._addTileFeatures(le.range(1-Pe/fe,et,1,gt),le.data,fe,ce,fe,at),J===fe-1&&this._addTileFeatures(le.range(0,et,Pe/fe,gt),le.data,-1,ce,fe,at),at.features.length?at:null}getClusterExpansionZoom(K){let J=this._getOriginZoom(K)-1;for(;J<=this.options.maxZoom;){const ce=this.getChildren(K);if(J++,ce.length!==1)break;K=ce[0].properties.cluster_id}return J}_appendLeaves(K,J,ce,le,fe){const je=this.getChildren(J);for(const We of je){const Pe=We.properties;if(Pe&&Pe.cluster?fe+Pe.point_count<=le?fe+=Pe.point_count:fe=this._appendLeaves(K,Pe.cluster_id,ce,le,fe):fe<le?fe++:K.push(We),K.length===ce)break}return fe}_createTree(K){const J=new m.av(K.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<K.length;ce+=this.stride)J.add(K[ce],K[ce+1]);return J.finish(),J.data=K,J}_addTileFeatures(K,J,ce,le,fe,je){for(const We of K){const Pe=We*this.stride,et=J[Pe+ft]>1;let gt,at,Dt;if(et)gt=pn(J,Pe,this.clusterProps),at=J[Pe],Dt=J[Pe+1];else{const Vn=this.points[J[Pe+wt]];gt=Vn.properties;const[Mn,An]=Vn.geometry.coordinates;at=Rn(Mn),Dt=Xe(An)}const en={type:1,geometry:[[Math.round(this.options.extent*(at*fe-ce)),Math.round(this.options.extent*(Dt*fe-le))]],tags:gt};let an;an=et||this.options.generateId?J[Pe+wt]:this.points[J[Pe+wt]].id,an!==void 0&&(en.id=an),je.features.push(en)}}_limitZoom(K){return Math.max(this.options.minZoom,Math.min(Math.floor(+K),this.options.maxZoom+1))}_cluster(K,J){const{radius:ce,extent:le,reduce:fe,minPoints:je}=this.options,We=ce/(le*Math.pow(2,J)),Pe=K.data,et=[],gt=this.stride;for(let at=0;at<Pe.length;at+=gt){if(Pe[at+2]<=J)continue;Pe[at+2]=J;const Dt=Pe[at],en=Pe[at+1],an=K.within(Pe[at],Pe[at+1],We),Vn=Pe[at+ft];let Mn=Vn;for(const An of an){const Fn=An*gt;Pe[Fn+2]>J&&(Mn+=Pe[Fn+ft])}if(Mn>Vn&&Mn>=je){let An,Fn=Dt*Vn,wi=en*Vn,ui=-1;const Cn=((at/gt|0)<<5)+(J+1)+this.points.length;for(const ii of an){const hi=ii*gt;if(Pe[hi+2]<=J)continue;Pe[hi+2]=J;const Ai=Pe[hi+ft];Fn+=Pe[hi]*Ai,wi+=Pe[hi+1]*Ai,Pe[hi+4]=Cn,fe&&(An||(An=this._map(Pe,at,!0),ui=this.clusterProps.length,this.clusterProps.push(An)),fe(An,this._map(Pe,hi)))}Pe[at+4]=Cn,et.push(Fn/Mn,wi/Mn,1/0,Cn,-1,Mn),fe&&et.push(ui)}else{for(let An=0;An<gt;An++)et.push(Pe[at+An]);if(Mn>1)for(const An of an){const Fn=An*gt;if(!(Pe[Fn+2]<=J)){Pe[Fn+2]=J;for(let wi=0;wi<gt;wi++)et.push(Pe[Fn+wi])}}}}return et}_getOriginId(K){return K-this.points.length>>5}_getOriginZoom(K){return(K-this.points.length)%32}_map(K,J,ce){if(K[J+ft]>1){const je=this.clusterProps[K[J+xt]];return ce?Object.assign({},je):je}const le=this.points[K[J+wt]].properties,fe=this.options.map(le);return ce&&fe===le?Object.assign({},fe):fe}}function Jt(Ae,K,J){return{type:"Feature",id:Ae[K+wt],properties:pn(Ae,K,J),geometry:{type:"Point",coordinates:[(ce=Ae[K],360*(ce-.5)),Wn(Ae[K+1])]}};var ce}function pn(Ae,K,J){const ce=Ae[K+ft],le=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,fe=Ae[K+xt],je=fe===-1?{}:Object.assign({},J[fe]);return Object.assign(je,{cluster:!0,cluster_id:Ae[K+wt],point_count:ce,point_count_abbreviated:le})}function Rn(Ae){return Ae/360+.5}function Xe(Ae){const K=Math.sin(Ae*Math.PI/180),J=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return J<0?0:J>1?1:J}function Wn(Ae){const K=(180-360*Ae)*Math.PI/180;return 360*Math.atan(Math.exp(K))/Math.PI-90}function dn(Ae,K,J,ce){let le=ce;const fe=K+(J-K>>1);let je,We=J-K;const Pe=Ae[K],et=Ae[K+1],gt=Ae[J],at=Ae[J+1];for(let Dt=K+3;Dt<J;Dt+=3){const en=Ft(Ae[Dt],Ae[Dt+1],Pe,et,gt,at);if(en>le)je=Dt,le=en;else if(en===le){const an=Math.abs(Dt-fe);an<We&&(je=Dt,We=an)}}le>ce&&(je-K>3&&dn(Ae,K,je,ce),Ae[je+2]=le,J-je>3&&dn(Ae,je,J,ce))}function Ft(Ae,K,J,ce,le,fe){let je=le-J,We=fe-ce;if(je!==0||We!==0){const Pe=((Ae-J)*je+(K-ce)*We)/(je*je+We*We);Pe>1?(J=le,ce=fe):Pe>0&&(J+=je*Pe,ce+=We*Pe)}return je=Ae-J,We=K-ce,je*je+We*We}function Se(Ae,K,J,ce){const le={id:Ae??null,type:K,geometry:J,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(K==="Point"||K==="MultiPoint"||K==="LineString")lt(le,J);else if(K==="Polygon")lt(le,J[0]);else if(K==="MultiLineString")for(const fe of J)lt(le,fe);else if(K==="MultiPolygon")for(const fe of J)lt(le,fe[0]);return le}function lt(Ae,K){for(let J=0;J<K.length;J+=3)Ae.minX=Math.min(Ae.minX,K[J]),Ae.minY=Math.min(Ae.minY,K[J+1]),Ae.maxX=Math.max(Ae.maxX,K[J]),Ae.maxY=Math.max(Ae.maxY,K[J+1])}function Je(Ae,K,J,ce){if(!K.geometry)return;const le=K.geometry.coordinates;if(le&&le.length===0)return;const fe=K.geometry.type,je=Math.pow(J.tolerance/((1<<J.maxZoom)*J.extent),2);let We=[],Pe=K.id;if(J.promoteId?Pe=K.properties[J.promoteId]:J.generateId&&(Pe=ce||0),fe==="Point")Lt(le,We);else if(fe==="MultiPoint")for(const et of le)Lt(et,We);else if(fe==="LineString")Ye(le,We,je,!1);else if(fe==="MultiLineString"){if(J.lineMetrics){for(const et of le)We=[],Ye(et,We,je,!1),Ae.push(Se(Pe,"LineString",We,K.properties));return}kt(le,We,je,!1)}else if(fe==="Polygon")kt(le,We,je,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(const et of K.geometry.geometries)Je(Ae,{id:Pe,geometry:et,properties:K.properties},J,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const et of le){const gt=[];kt(et,gt,je,!0),We.push(gt)}}Ae.push(Se(Pe,fe,We,K.properties))}function Lt(Ae,K){K.push(Vt(Ae[0]),Ee(Ae[1]),0)}function Ye(Ae,K,J,ce){let le,fe,je=0;for(let Pe=0;Pe<Ae.length;Pe++){const et=Vt(Ae[Pe][0]),gt=Ee(Ae[Pe][1]);K.push(et,gt,0),Pe>0&&(je+=ce?(le*gt-et*fe)/2:Math.sqrt(Math.pow(et-le,2)+Math.pow(gt-fe,2))),le=et,fe=gt}const We=K.length-3;K[2]=1,dn(K,0,We,J),K[We+2]=1,K.size=Math.abs(je),K.start=0,K.end=K.size}function kt(Ae,K,J,ce){for(let le=0;le<Ae.length;le++){const fe=[];Ye(Ae[le],fe,J,ce),K.push(fe)}}function Vt(Ae){return Ae/360+.5}function Ee(Ae){const K=Math.sin(Ae*Math.PI/180),J=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return J<0?0:J>1?1:J}function Gt(Ae,K,J,ce,le,fe,je,We){if(ce/=K,fe>=(J/=K)&&je<ce)return Ae;if(je<J||fe>=ce)return null;const Pe=[];for(const et of Ae){const gt=et.geometry;let at=et.type;const Dt=le===0?et.minX:et.minY,en=le===0?et.maxX:et.maxY;if(Dt>=J&&en<ce){Pe.push(et);continue}if(en<J||Dt>=ce)continue;let an=[];if(at==="Point"||at==="MultiPoint")_n(gt,an,J,ce,le);else if(at==="LineString")Kn(gt,an,J,ce,le,!1,We.lineMetrics);else if(at==="MultiLineString")xn(gt,an,J,ce,le,!1);else if(at==="Polygon")xn(gt,an,J,ce,le,!0);else if(at==="MultiPolygon")for(const Vn of gt){const Mn=[];xn(Vn,Mn,J,ce,le,!0),Mn.length&&an.push(Mn)}if(an.length){if(We.lineMetrics&&at==="LineString"){for(const Vn of an)Pe.push(Se(et.id,at,Vn,et.tags));continue}at!=="LineString"&&at!=="MultiLineString"||(an.length===1?(at="LineString",an=an[0]):at="MultiLineString"),at!=="Point"&&at!=="MultiPoint"||(at=an.length===3?"Point":"MultiPoint"),Pe.push(Se(et.id,at,an,et.tags))}}return Pe.length?Pe:null}function _n(Ae,K,J,ce,le){for(let fe=0;fe<Ae.length;fe+=3){const je=Ae[fe+le];je>=J&&je<=ce&&qi(K,Ae[fe],Ae[fe+1],Ae[fe+2])}}function Kn(Ae,K,J,ce,le,fe,je){let We=Yi(Ae);const Pe=le===0?Ji:Jr;let et,gt,at=Ae.start;for(let Mn=0;Mn<Ae.length-3;Mn+=3){const An=Ae[Mn],Fn=Ae[Mn+1],wi=Ae[Mn+2],ui=Ae[Mn+3],Cn=Ae[Mn+4],ii=le===0?An:Fn,hi=le===0?ui:Cn;let Ai=!1;je&&(et=Math.sqrt(Math.pow(An-ui,2)+Math.pow(Fn-Cn,2))),ii<J?hi>J&&(gt=Pe(We,An,Fn,ui,Cn,J),je&&(We.start=at+et*gt)):ii>ce?hi<ce&&(gt=Pe(We,An,Fn,ui,Cn,ce),je&&(We.start=at+et*gt)):qi(We,An,Fn,wi),hi<J&&ii>=J&&(gt=Pe(We,An,Fn,ui,Cn,J),Ai=!0),hi>ce&&ii<=ce&&(gt=Pe(We,An,Fn,ui,Cn,ce),Ai=!0),!fe&&Ai&&(je&&(We.end=at+et*gt),K.push(We),We=Yi(Ae)),je&&(at+=et)}let Dt=Ae.length-3;const en=Ae[Dt],an=Ae[Dt+1],Vn=le===0?en:an;Vn>=J&&Vn<=ce&&qi(We,en,an,Ae[Dt+2]),Dt=We.length-3,fe&&Dt>=3&&(We[Dt]!==We[0]||We[Dt+1]!==We[1])&&qi(We,We[0],We[1],We[2]),We.length&&K.push(We)}function Yi(Ae){const K=[];return K.size=Ae.size,K.start=Ae.start,K.end=Ae.end,K}function xn(Ae,K,J,ce,le,fe){for(const je of Ae)Kn(je,K,J,ce,le,fe,!1)}function qi(Ae,K,J,ce){Ae.push(K,J,ce)}function Ji(Ae,K,J,ce,le,fe){const je=(fe-K)/(ce-K);return qi(Ae,fe,J+(le-J)*je,1),je}function Jr(Ae,K,J,ce,le,fe){const je=(fe-J)/(le-J);return qi(Ae,K+(ce-K)*je,fe,1),je}function ct(Ae,K){const J=[];for(let ce=0;ce<Ae.length;ce++){const le=Ae[ce],fe=le.type;let je;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")je=gr(le.geometry,K);else if(fe==="MultiLineString"||fe==="Polygon"){je=[];for(const We of le.geometry)je.push(gr(We,K))}else if(fe==="MultiPolygon"){je=[];for(const We of le.geometry){const Pe=[];for(const et of We)Pe.push(gr(et,K));je.push(Pe)}}J.push(Se(le.id,fe,je,le.tags))}return J}function gr(Ae,K){const J=[];J.size=Ae.size,Ae.start!==void 0&&(J.start=Ae.start,J.end=Ae.end);for(let ce=0;ce<Ae.length;ce+=3)J.push(Ae[ce]+K,Ae[ce+1],Ae[ce+2]);return J}function kn(Ae,K){if(Ae.transformed)return Ae;const J=1<<Ae.z,ce=Ae.x,le=Ae.y;for(const fe of Ae.features){const je=fe.geometry,We=fe.type;if(fe.geometry=[],We===1)for(let Pe=0;Pe<je.length;Pe+=2)fe.geometry.push(mn(je[Pe],je[Pe+1],K,J,ce,le));else for(let Pe=0;Pe<je.length;Pe++){const et=[];for(let gt=0;gt<je[Pe].length;gt+=2)et.push(mn(je[Pe][gt],je[Pe][gt+1],K,J,ce,le));fe.geometry.push(et)}}return Ae.transformed=!0,Ae}function mn(Ae,K,J,ce,le,fe){return[Math.round(J*(Ae*ce-le)),Math.round(J*(K*ce-fe))]}function As(Ae,K,J,ce,le){const fe=K===le.maxZoom?0:le.tolerance/((1<<K)*le.extent),je={features:[],numPoints:0,numSimplified:0,numFeatures:Ae.length,source:null,x:J,y:ce,z:K,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const We of Ae)At(je,We,fe,le);return je}function At(Ae,K,J,ce){const le=K.geometry,fe=K.type,je=[];if(Ae.minX=Math.min(Ae.minX,K.minX),Ae.minY=Math.min(Ae.minY,K.minY),Ae.maxX=Math.max(Ae.maxX,K.maxX),Ae.maxY=Math.max(Ae.maxY,K.maxY),fe==="Point"||fe==="MultiPoint")for(let We=0;We<le.length;We+=3)je.push(le[We],le[We+1]),Ae.numPoints++,Ae.numSimplified++;else if(fe==="LineString")Ln(je,le,Ae,J,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(let We=0;We<le.length;We++)Ln(je,le[We],Ae,J,fe==="Polygon",We===0);else if(fe==="MultiPolygon")for(let We=0;We<le.length;We++){const Pe=le[We];for(let et=0;et<Pe.length;et++)Ln(je,Pe[et],Ae,J,!0,et===0)}if(je.length){let We=K.tags||null;if(fe==="LineString"&&ce.lineMetrics){We={};for(const et in K.tags)We[et]=K.tags[et];We.mapbox_clip_start=le.start/le.size,We.mapbox_clip_end=le.end/le.size}const Pe={geometry:je,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:We};K.id!==null&&(Pe.id=K.id),Ae.features.push(Pe)}}function Ln(Ae,K,J,ce,le,fe){const je=ce*ce;if(ce>0&&K.size<(le?je:ce))return void(J.numPoints+=K.length/3);const We=[];for(let Pe=0;Pe<K.length;Pe+=3)(ce===0||K[Pe+2]>je)&&(J.numSimplified++,We.push(K[Pe],K[Pe+1])),J.numPoints++;le&&function(Pe,et){let gt=0;for(let at=0,Dt=Pe.length,en=Dt-2;at<Dt;en=at,at+=2)gt+=(Pe[at]-Pe[en])*(Pe[at+1]+Pe[en+1]);if(gt>0===et)for(let at=0,Dt=Pe.length;at<Dt/2;at+=2){const en=Pe[at],an=Pe[at+1];Pe[at]=Pe[Dt-2-at],Pe[at+1]=Pe[Dt-1-at],Pe[Dt-2-at]=en,Pe[Dt-1-at]=an}}(We,fe),Ae.push(We)}const Tt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class _r{constructor(K,J){const ce=(J=this.options=function(fe,je){for(const We in je)fe[We]=je[We];return fe}(Object.create(Tt),J)).debug;if(ce&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");let le=function(fe,je){const We=[];if(fe.type==="FeatureCollection")for(let Pe=0;Pe<fe.features.length;Pe++)Je(We,fe.features[Pe],je,Pe);else Je(We,fe.type==="Feature"?fe:{geometry:fe},je);return We}(K,J);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),le=function(fe,je){const We=je.buffer/je.extent;let Pe=fe;const et=Gt(fe,1,-1-We,We,0,-1,2,je),gt=Gt(fe,1,1-We,2+We,0,-1,2,je);return(et||gt)&&(Pe=Gt(fe,1,-We,1+We,0,-1,2,je)||[],et&&(Pe=ct(et,1).concat(Pe)),gt&&(Pe=Pe.concat(ct(gt,-1)))),Pe}(le,J),le.length&&this.splitTile(le,0,0,0),ce&&(le.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(K,J,ce,le,fe,je,We){const Pe=[K,J,ce,le],et=this.options,gt=et.debug;for(;Pe.length;){le=Pe.pop(),ce=Pe.pop(),J=Pe.pop(),K=Pe.pop();const at=1<<J,Dt=Gr(J,ce,le);let en=this.tiles[Dt];if(!en&&(gt>1&&console.time("creation"),en=this.tiles[Dt]=As(K,J,ce,le,et),this.tileCoords.push({z:J,x:ce,y:le}),gt)){gt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,ce,le,en.numFeatures,en.numPoints,en.numSimplified),console.timeEnd("creation"));const Ai=`z${J}`;this.stats[Ai]=(this.stats[Ai]||0)+1,this.total++}if(en.source=K,fe==null){if(J===et.indexMaxZoom||en.numPoints<=et.indexMaxPoints)continue}else{if(J===et.maxZoom||J===fe)continue;if(fe!=null){const Ai=fe-J;if(ce!==je>>Ai||le!==We>>Ai)continue}}if(en.source=null,K.length===0)continue;gt>1&&console.time("clipping");const an=.5*et.buffer/et.extent,Vn=.5-an,Mn=.5+an,An=1+an;let Fn=null,wi=null,ui=null,Cn=null,ii=Gt(K,at,ce-an,ce+Mn,0,en.minX,en.maxX,et),hi=Gt(K,at,ce+Vn,ce+An,0,en.minX,en.maxX,et);K=null,ii&&(Fn=Gt(ii,at,le-an,le+Mn,1,en.minY,en.maxY,et),wi=Gt(ii,at,le+Vn,le+An,1,en.minY,en.maxY,et),ii=null),hi&&(ui=Gt(hi,at,le-an,le+Mn,1,en.minY,en.maxY,et),Cn=Gt(hi,at,le+Vn,le+An,1,en.minY,en.maxY,et),hi=null),gt>1&&console.timeEnd("clipping"),Pe.push(Fn||[],J+1,2*ce,2*le),Pe.push(wi||[],J+1,2*ce,2*le+1),Pe.push(ui||[],J+1,2*ce+1,2*le),Pe.push(Cn||[],J+1,2*ce+1,2*le+1)}}getTile(K,J,ce){K=+K,J=+J,ce=+ce;const le=this.options,{extent:fe,debug:je}=le;if(K<0||K>24)return null;const We=1<<K,Pe=Gr(K,J=J+We&We-1,ce);if(this.tiles[Pe])return kn(this.tiles[Pe],fe);je>1&&console.log("drilling down to z%d-%d-%d",K,J,ce);let et,gt=K,at=J,Dt=ce;for(;!et&&gt>0;)gt--,at>>=1,Dt>>=1,et=this.tiles[Gr(gt,at,Dt)];return et&&et.source?(je>1&&(console.log("found parent tile z%d-%d-%d",gt,at,Dt),console.time("drilling down")),this.splitTile(et.source,gt,at,Dt,K,J,ce),je>1&&console.timeEnd("drilling down"),this.tiles[Pe]?kn(this.tiles[Pe],fe):null):null}}function Gr(Ae,K,J){return 32*((1<<Ae)*J+K)+Ae}function wn(Ae,K){return K?Ae.properties[K]:Ae.id}function Mi(Ae,K){if(Ae==null)return!0;if(Ae.type==="Feature")return wn(Ae,K)!=null;if(Ae.type==="FeatureCollection"){const J=new Set;for(const ce of Ae.features){const le=wn(ce,K);if(le==null||J.has(le))return!1;J.add(le)}return!0}return!1}function Er(Ae,K){const J=new Map;if(Ae!=null)if(Ae.type==="Feature")J.set(wn(Ae,K),Ae);else for(const ce of Ae.features)J.set(wn(ce,K),ce);return J}class Ki extends L{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(K,J){return m._(this,void 0,void 0,function*(){const ce=K.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const le=this._geoJSONIndex.getTile(ce.z,ce.x,ce.y);if(!le)return null;const fe=new class{constructor(We){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.X,this.length=We.length,this._features=We}feature(We){return new class{constructor(Pe){this._feature=Pe,this.extent=m.X,this.type=Pe.type,this.properties=Pe.tags,"id"in Pe&&!isNaN(Pe.id)&&(this.id=parseInt(Pe.id,10))}loadGeometry(){if(this._feature.type===1){const Pe=[];for(const et of this._feature.geometry)Pe.push([new m.P(et[0],et[1])]);return Pe}{const Pe=[];for(const et of this._feature.geometry){const gt=[];for(const at of et)gt.push(new m.P(at[0],at[1]));Pe.push(gt)}return Pe}}toGeoJSON(Pe,et,gt){return ie.call(this,Pe,et,gt)}}(this._features[We])}}(le.features);let je=dt(fe);return je.byteOffset===0&&je.byteLength===je.buffer.byteLength||(je=new Uint8Array(je)),{vectorTile:fe,rawData:je.buffer}})}loadData(K){return m._(this,void 0,void 0,function*(){var J;(J=this._pendingRequest)===null||J===void 0||J.abort();const ce=!!(K&&K.request&&K.request.collectResourceTiming)&&new m.bv(K.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(K,this._pendingRequest),this._geoJSONIndex=K.cluster?new It(function({superclusterOptions:je,clusterProperties:We}){if(!We||!je)return je;const Pe={},et={},gt={accumulated:null,zoom:0},at={properties:null},Dt=Object.keys(We);for(const en of Dt){const[an,Vn]=We[en],Mn=m.bC(Vn),An=m.bC(typeof an=="string"?[an,["accumulated"],["get",en]]:an);Pe[en]=Mn.value,et[en]=An.value}return je.map=en=>{at.properties=en;const an={};for(const Vn of Dt)an[Vn]=Pe[Vn].evaluate(gt,at);return an},je.reduce=(en,an)=>{at.properties=an;for(const Vn of Dt)gt.accumulated=en[Vn],en[Vn]=et[Vn].evaluate(gt,at)},je}(K)).load((yield this._pendingData).features):(le=yield this._pendingData,new _r(le,K.geojsonVtOptions)),this.loaded={};const fe={};if(ce){const je=ce.finish();je&&(fe.resourceTiming={},fe.resourceTiming[K.source]=JSON.parse(JSON.stringify(je)))}return fe}catch(fe){if(delete this._pendingRequest,m.bB(fe))return{abandoned:!0};throw fe}var le})}getData(){return m._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(K){const J=this.loaded;return J&&J[K.uid]?super.reloadTile(K):this.loadTile(K)}loadAndProcessGeoJSON(K,J){return m._(this,void 0,void 0,function*(){let ce=yield this.loadGeoJSON(K,J);if(delete this._pendingRequest,typeof ce!="object")throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`);if(ee(ce,!0),K.filter){const le=m.bC(K.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(le.result==="error")throw new Error(le.value.map(je=>`${je.key}: ${je.message}`).join(", "));ce={type:"FeatureCollection",features:ce.features.filter(je=>le.value.evaluate({zoom:0},je))}}return ce})}loadGeoJSON(K,J){return m._(this,void 0,void 0,function*(){const{promoteId:ce}=K;if(K.request){const le=yield m.h(K.request,J);return this._dataUpdateable=Mi(le.data,ce)?Er(le.data,ce):void 0,le.data}if(typeof K.data=="string")try{const le=JSON.parse(K.data);return this._dataUpdateable=Mi(le,ce)?Er(le,ce):void 0,le}catch{throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`)}if(!K.dataDiff)throw new Error(`Input data given to '${K.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${K.source}`);return function(le,fe,je){var We,Pe,et,gt;if(fe.removeAll&&le.clear(),fe.remove)for(const at of fe.remove)le.delete(at);if(fe.add)for(const at of fe.add){const Dt=wn(at,je);Dt!=null&&le.set(Dt,at)}if(fe.update)for(const at of fe.update){let Dt=le.get(at.id);if(Dt==null)continue;const en=!at.removeAllProperties&&(((We=at.removeProperties)===null||We===void 0?void 0:We.length)>0||((Pe=at.addOrUpdateProperties)===null||Pe===void 0?void 0:Pe.length)>0);if((at.newGeometry||at.removeAllProperties||en)&&(Dt=Object.assign({},Dt),le.set(at.id,Dt),en&&(Dt.properties=Object.assign({},Dt.properties))),at.newGeometry&&(Dt.geometry=at.newGeometry),at.removeAllProperties)Dt.properties={};else if(((et=at.removeProperties)===null||et===void 0?void 0:et.length)>0)for(const an of at.removeProperties)Object.prototype.hasOwnProperty.call(Dt.properties,an)&&delete Dt.properties[an];if(((gt=at.addOrUpdateProperties)===null||gt===void 0?void 0:gt.length)>0)for(const{key:an,value:Vn}of at.addOrUpdateProperties)Dt.properties[an]=Vn}}(this._dataUpdateable,K.dataDiff,ce),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(K){return m._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(K){return this._geoJSONIndex.getClusterExpansionZoom(K.clusterId)}getClusterChildren(K){return this._geoJSONIndex.getChildren(K.clusterId)}getClusterLeaves(K){return this._geoJSONIndex.getLeaves(K.clusterId,K.limit,K.offset)}}class Zr{constructor(K){this.self=K,this.actor=new m.F(K),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(J,ce)=>{if(this.externalWorkerSourceTypes[J])throw new Error(`Worker source with name "${J}" already registered.`);this.externalWorkerSourceTypes[J]=ce},this.self.addProtocol=m.bi,this.self.removeProtocol=m.bj,this.self.registerRTLTextPlugin=J=>{if(m.bD.isParsed())throw new Error("RTL text plugin already registered.");m.bD.setMethods(J)},this.actor.registerMessageHandler("LDT",(J,ce)=>this._getDEMWorkerSource(J,ce.source).loadTile(ce)),this.actor.registerMessageHandler("RDT",(J,ce)=>m._(this,void 0,void 0,function*(){this._getDEMWorkerSource(J,ce.source).removeTile(ce)})),this.actor.registerMessageHandler("GCEZ",(J,ce)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(J,ce.type,ce.source).getClusterExpansionZoom(ce)})),this.actor.registerMessageHandler("GCC",(J,ce)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(J,ce.type,ce.source).getClusterChildren(ce)})),this.actor.registerMessageHandler("GCL",(J,ce)=>m._(this,void 0,void 0,function*(){return this._getWorkerSource(J,ce.type,ce.source).getClusterLeaves(ce)})),this.actor.registerMessageHandler("LD",(J,ce)=>this._getWorkerSource(J,ce.type,ce.source).loadData(ce)),this.actor.registerMessageHandler("GD",(J,ce)=>this._getWorkerSource(J,ce.type,ce.source).getData()),this.actor.registerMessageHandler("LT",(J,ce)=>this._getWorkerSource(J,ce.type,ce.source).loadTile(ce)),this.actor.registerMessageHandler("RT",(J,ce)=>this._getWorkerSource(J,ce.type,ce.source).reloadTile(ce)),this.actor.registerMessageHandler("AT",(J,ce)=>this._getWorkerSource(J,ce.type,ce.source).abortTile(ce)),this.actor.registerMessageHandler("RMT",(J,ce)=>this._getWorkerSource(J,ce.type,ce.source).removeTile(ce)),this.actor.registerMessageHandler("RS",(J,ce)=>m._(this,void 0,void 0,function*(){if(!this.workerSources[J]||!this.workerSources[J][ce.type]||!this.workerSources[J][ce.type][ce.source])return;const le=this.workerSources[J][ce.type][ce.source];delete this.workerSources[J][ce.type][ce.source],le.removeSource!==void 0&&le.removeSource(ce)})),this.actor.registerMessageHandler("RM",J=>m._(this,void 0,void 0,function*(){delete this.layerIndexes[J],delete this.availableImages[J],delete this.workerSources[J],delete this.demWorkerSources[J]})),this.actor.registerMessageHandler("SR",(J,ce)=>m._(this,void 0,void 0,function*(){this.referrer=ce})),this.actor.registerMessageHandler("SRPS",(J,ce)=>this._syncRTLPluginState(J,ce)),this.actor.registerMessageHandler("IS",(J,ce)=>m._(this,void 0,void 0,function*(){this.self.importScripts(ce)})),this.actor.registerMessageHandler("SI",(J,ce)=>this._setImages(J,ce)),this.actor.registerMessageHandler("UL",(J,ce)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(J).update(ce.layers,ce.removedIds)})),this.actor.registerMessageHandler("SL",(J,ce)=>m._(this,void 0,void 0,function*(){this._getLayerIndex(J).replace(ce)}))}_setImages(K,J){return m._(this,void 0,void 0,function*(){this.availableImages[K]=J;for(const ce in this.workerSources[K]){const le=this.workerSources[K][ce];for(const fe in le)le[fe].availableImages=J}})}_syncRTLPluginState(K,J){return m._(this,void 0,void 0,function*(){if(m.bD.isParsed())return m.bD.getState();if(J.pluginStatus!=="loading")return m.bD.setState(J),J;const ce=J.pluginURL;if(this.self.importScripts(ce),m.bD.isParsed()){const le={pluginStatus:"loaded",pluginURL:ce};return m.bD.setState(le),le}throw m.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ce}`)})}_getAvailableImages(K){let J=this.availableImages[K];return J||(J=[]),J}_getLayerIndex(K){let J=this.layerIndexes[K];return J||(J=this.layerIndexes[K]=new l),J}_getWorkerSource(K,J,ce){if(this.workerSources[K]||(this.workerSources[K]={}),this.workerSources[K][J]||(this.workerSources[K][J]={}),!this.workerSources[K][J][ce]){const le={sendAsync:(fe,je)=>(fe.targetMapId=K,this.actor.sendAsync(fe,je))};switch(J){case"vector":this.workerSources[K][J][ce]=new L(le,this._getLayerIndex(K),this._getAvailableImages(K));break;case"geojson":this.workerSources[K][J][ce]=new Ki(le,this._getLayerIndex(K),this._getAvailableImages(K));break;default:this.workerSources[K][J][ce]=new this.externalWorkerSourceTypes[J](le,this._getLayerIndex(K),this._getAvailableImages(K))}}return this.workerSources[K][J][ce]}_getDEMWorkerSource(K,J){return this.demWorkerSources[K]||(this.demWorkerSources[K]={}),this.demWorkerSources[K][J]||(this.demWorkerSources[K][J]=new N),this.demWorkerSources[K][J]}}return m.i(self)&&(self.worker=new Zr(self)),Zr}),a("index",["exports","./shared"],function(m,l){var x="4.7.0";let S,C;const L={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:k=>new Promise((t,h)=>{const _=requestAnimationFrame(t);k.signal.addEventListener("abort",()=>{cancelAnimationFrame(_),h(l.c())})}),getImageData(k,t=0){return this.getImageCanvasContext(k).getImageData(-t,-t,k.width+2*t,k.height+2*t)},getImageCanvasContext(k){const t=window.document.createElement("canvas"),h=t.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return t.width=k.width,t.height=k.height,h.drawImage(k,0,0,k.width,k.height),h},resolveURL:k=>(S||(S=document.createElement("a")),S.href=k,S.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(C==null&&(C=matchMedia("(prefers-reduced-motion: reduce)")),C.matches)}};class N{static testProp(t){if(!N.docStyle)return t[0];for(let h=0;h<t.length;h++)if(t[h]in N.docStyle)return t[h];return t[0]}static create(t,h,_){const y=window.document.createElement(t);return h!==void 0&&(y.className=h),_&&_.appendChild(y),y}static createNS(t,h){return window.document.createElementNS(t,h)}static disableDrag(){N.docStyle&&N.selectProp&&(N.userSelect=N.docStyle[N.selectProp],N.docStyle[N.selectProp]="none")}static enableDrag(){N.docStyle&&N.selectProp&&(N.docStyle[N.selectProp]=N.userSelect)}static setTransform(t,h){t.style[N.transformProp]=h}static addEventListener(t,h,_,y={}){t.addEventListener(h,_,"passive"in y?y:y.capture)}static removeEventListener(t,h,_,y={}){t.removeEventListener(h,_,"passive"in y?y:y.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",N.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",N.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",N.suppressClickInternal,!0)},0)}static getScale(t){const h=t.getBoundingClientRect();return{x:h.width/t.offsetWidth||1,y:h.height/t.offsetHeight||1,boundingClientRect:h}}static getPoint(t,h,_){const y=h.boundingClientRect;return new l.P((_.clientX-y.left)/h.x-t.clientLeft,(_.clientY-y.top)/h.y-t.clientTop)}static mousePos(t,h){const _=N.getScale(t);return N.getPoint(t,_,h)}static touchPos(t,h){const _=[],y=N.getScale(t);for(let w=0;w<h.length;w++)_.push(N.getPoint(t,y,h[w]));return _}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}N.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,N.selectProp=N.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),N.transformProp=N.testProp(["transform","WebkitTransform"]);const B={supported:!1,testSupport:function(k){!ie&&ee&&(re?Q(k):U=k)}};let U,ee,ie=!1,re=!1;function Q(k){const t=k.createTexture();k.bindTexture(k.TEXTURE_2D,t);try{if(k.texImage2D(k.TEXTURE_2D,0,k.RGBA,k.RGBA,k.UNSIGNED_BYTE,ee),k.isContextLost())return;B.supported=!0}catch{}k.deleteTexture(t),ie=!0}var $;typeof document<"u"&&(ee=document.createElement("img"),ee.onload=()=>{U&&Q(U),U=null,re=!0},ee.onerror=()=>{ie=!0,U=null},ee.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(k){let t,h,_,y;k.resetRequestQueue=()=>{t=[],h=0,_=0,y={}},k.addThrottleControl=z=>{const V=_++;return y[V]=z,V},k.removeThrottleControl=z=>{delete y[z],P()},k.getImage=(z,V,H=!0)=>new Promise((W,ne)=>{B.supported&&(z.headers||(z.headers={}),z.headers.accept="image/webp,*/*"),l.e(z,{type:"image"}),t.push({abortController:V,requestParameters:z,supportImageRefresh:H,state:"queued",onError:ge=>{ne(ge)},onSuccess:ge=>{W(ge)}}),P()});const w=z=>l._(this,void 0,void 0,function*(){z.state="running";const{requestParameters:V,supportImageRefresh:H,onError:W,onSuccess:ne,abortController:ge}=z,ke=H===!1&&!l.i(self)&&!l.g(V.url)&&(!V.headers||Object.keys(V.headers).reduce((ze,qe)=>ze&&qe==="accept",!0));h++;const Me=ke?D(V,ge):l.m(V,ge);try{const ze=yield Me;delete z.abortController,z.state="completed",ze.data instanceof HTMLImageElement||l.b(ze.data)?ne(ze):ze.data&&ne({data:yield(Ne=ze.data,typeof createImageBitmap=="function"?l.d(Ne):l.f(Ne)),cacheControl:ze.cacheControl,expires:ze.expires})}catch(ze){delete z.abortController,W(ze)}finally{h--,P()}var Ne}),P=()=>{const z=(()=>{for(const V of Object.keys(y))if(y[V]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let V=h;V<z&&t.length>0;V++){const H=t.shift();H.abortController.signal.aborted?V--:w(H)}},D=(z,V)=>new Promise((H,W)=>{const ne=new Image,ge=z.url,ke=z.credentials;ke&&ke==="include"?ne.crossOrigin="use-credentials":(ke&&ke==="same-origin"||!l.s(ge))&&(ne.crossOrigin="anonymous"),V.signal.addEventListener("abort",()=>{ne.src="",W(l.c())}),ne.fetchPriority="high",ne.onload=()=>{ne.onerror=ne.onload=null,H({data:ne})},ne.onerror=()=>{ne.onerror=ne.onload=null,V.signal.aborted||W(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ne.src=ge})}($||($={})),$.resetRequestQueue();class pe{constructor(t){this._transformRequestFn=t}transformRequest(t,h){return this._transformRequestFn&&this._transformRequestFn(t,h)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function ve(k){var t=new l.A(3);return t[0]=k[0],t[1]=k[1],t[2]=k[2],t}var De,he=function(k,t,h){return k[0]=t[0]-h[0],k[1]=t[1]-h[1],k[2]=t[2]-h[2],k};De=new l.A(3),l.A!=Float32Array&&(De[0]=0,De[1]=0,De[2]=0);var xe=function(k){var t=k[0],h=k[1];return t*t+h*h};function be(k){const t=[];if(typeof k=="string")t.push({id:"default",url:k});else if(k&&k.length>0){const h=[];for(const{id:_,url:y}of k){const w=`${_}${y}`;h.indexOf(w)===-1&&(h.push(w),t.push({id:_,url:y}))}}return t}function Le(k,t,h){const _=k.split("?");return _[0]+=`${t}${h}`,_.join("?")}(function(){var k=new l.A(2);l.A!=Float32Array&&(k[0]=0,k[1]=0)})();class we{constructor(t,h,_,y){this.context=t,this.format=_,this.texture=t.gl.createTexture(),this.update(h,y)}update(t,h,_){const{width:y,height:w}=t,P=!(this.size&&this.size[0]===y&&this.size[1]===w||_),{context:D}=this,{gl:z}=D;if(this.useMipmap=!!(h&&h.useMipmap),z.bindTexture(z.TEXTURE_2D,this.texture),D.pixelStoreUnpackFlipY.set(!1),D.pixelStoreUnpack.set(1),D.pixelStoreUnpackPremultiplyAlpha.set(this.format===z.RGBA&&(!h||h.premultiply!==!1)),P)this.size=[y,w],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.b(t)?z.texImage2D(z.TEXTURE_2D,0,this.format,this.format,z.UNSIGNED_BYTE,t):z.texImage2D(z.TEXTURE_2D,0,this.format,y,w,0,this.format,z.UNSIGNED_BYTE,t.data);else{const{x:V,y:H}=_||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.b(t)?z.texSubImage2D(z.TEXTURE_2D,0,V,H,z.RGBA,z.UNSIGNED_BYTE,t):z.texSubImage2D(z.TEXTURE_2D,0,V,H,y,w,z.RGBA,z.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&z.generateMipmap(z.TEXTURE_2D)}bind(t,h,_){const{context:y}=this,{gl:w}=y;w.bindTexture(w.TEXTURE_2D,this.texture),_!==w.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_=w.LINEAR),t!==this.filter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,t),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,_||t),this.filter=t),h!==this.wrap&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,h),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function ye(k){const{userImage:t}=k;return!!(t&&t.render&&t.render())&&(k.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ue extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:h,promiseResolve:_}of this.requestors)_(this._getImagesForIds(h));this.requestors=[]}}getImage(t){const h=this.images[t];if(h&&!h.data&&h.spriteData){const _=h.spriteData;h.data=new l.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),h.spriteData=null}return h}addImage(t,h){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,h)&&(this.images[t]=h)}_validate(t,h){let _=!0;const y=h.data||h.spriteData;return this._validateStretch(h.stretchX,y&&y.width)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,y&&y.height)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new l.j(new Error(`Image "${t}" has invalid "content" value`))),_=!1),_}_validateStretch(t,h){if(!t)return!0;let _=0;for(const y of t){if(y[0]<_||y[1]<y[0]||h<y[1])return!1;_=y[1]}return!0}_validateContent(t,h){if(!t)return!0;if(t.length!==4)return!1;const _=h.spriteData,y=_&&_.width||h.data.width,w=_&&_.height||h.data.height;return!(t[0]<0||y<t[0]||t[1]<0||w<t[1]||t[2]<0||y<t[2]||t[3]<0||w<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,h,_=!0){const y=this.getImage(t);if(_&&(y.data.width!==h.data.width||y.data.height!==h.data.height))throw new Error(`size mismatch between old image (${y.data.width}x${y.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=y.version+1,this.images[t]=h,this.updatedImages[t]=!0}removeImage(t){const h=this.images[t];delete this.images[t],delete this.patterns[t],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((h,_)=>{let y=!0;if(!this.isLoaded())for(const w of t)this.images[w]||(y=!1);this.isLoaded()||y?h(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:h})})}_getImagesForIds(t){const h={};for(const _ of t){let y=this.getImage(_);y||(this.fire(new l.k("styleimagemissing",{id:_})),y=this.getImage(_)),y?h[_]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,textFitWidth:y.textFitWidth,textFitHeight:y.textFitHeight,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:l.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:t,height:h}=this.atlasImage;return{width:t,height:h}}getPattern(t){const h=this.patterns[t],_=this.getImage(t);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{const y={w:_.data.width+2,h:_.data.height+2,x:0,y:0},w=new l.I(y,_);this.patterns[t]={bin:y,position:w}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const h=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new we(t,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const w in this.patterns)t.push(this.patterns[w].bin);const{w:h,h:_}=l.p(t),y=this.atlasImage;y.resize({width:h||1,height:_||1});for(const w in this.patterns){const{bin:P}=this.patterns[w],D=P.x+1,z=P.y+1,V=this.getImage(w).data,H=V.width,W=V.height;l.R.copy(V,y,{x:0,y:0},{x:D,y:z},{width:H,height:W}),l.R.copy(V,y,{x:0,y:W-1},{x:D,y:z-1},{width:H,height:1}),l.R.copy(V,y,{x:0,y:0},{x:D,y:z+W},{width:H,height:1}),l.R.copy(V,y,{x:H-1,y:0},{x:D-1,y:z},{width:1,height:W}),l.R.copy(V,y,{x:0,y:0},{x:D+H,y:z},{width:1,height:W})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const h of t){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const _=this.getImage(h);_||l.w(`Image with ID: "${h}" was not found`),ye(_)&&this.updateImage(h,_)}}}const Ve=1e20;function pt(k,t,h,_,y,w,P,D,z){for(let V=t;V<t+_;V++)St(k,h*w+V,w,y,P,D,z);for(let V=h;V<h+y;V++)St(k,V*w+t,1,_,P,D,z)}function St(k,t,h,_,y,w,P){w[0]=0,P[0]=-Ve,P[1]=Ve,y[0]=k[t];for(let D=1,z=0,V=0;D<_;D++){y[D]=k[t+D*h];const H=D*D;do{const W=w[z];V=(y[D]-y[W]+H-W*W)/(D-W)/2}while(V<=P[z]&&--z>-1);z++,w[z]=D,P[z]=V,P[z+1]=Ve}for(let D=0,z=0;D<_;D++){for(;P[z+1]<D;)z++;const V=w[z],H=D-V;k[t+D*h]=y[V]+H*H}}class dt{constructor(t,h){this.requestManager=t,this.localIdeographFontFamily=h,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return l._(this,void 0,void 0,function*(){const h=[];for(const w in t)for(const P of t[w])h.push(this._getAndCacheGlyphsPromise(w,P));const _=yield Promise.all(h),y={};for(const{stack:w,id:P,glyph:D}of _)y[w]||(y[w]={}),y[w][P]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics};return y})}_getAndCacheGlyphsPromise(t,h){return l._(this,void 0,void 0,function*(){let _=this.entries[t];_||(_=this.entries[t]={glyphs:{},requests:{},ranges:{}});let y=_.glyphs[h];if(y!==void 0)return{stack:t,id:h,glyph:y};if(y=this._tinySDF(_,t,h),y)return _.glyphs[h]=y,{stack:t,id:h,glyph:y};const w=Math.floor(h/256);if(256*w>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[w])return{stack:t,id:h,glyph:y};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[w]){const D=dt.loadGlyphRange(t,w,this.url,this.requestManager);_.requests[w]=D}const P=yield _.requests[w];for(const D in P)this._doesCharSupportLocalGlyph(+D)||(_.glyphs[+D]=P[+D]);return _.ranges[w]=!0,{stack:t,id:h,glyph:P[h]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(t))}_tinySDF(t,h,_){const y=this.localIdeographFontFamily;if(!y||!this._doesCharSupportLocalGlyph(_))return;let w=t.tinySDF;if(!w){let D="400";/bold/i.test(h)?D="900":/medium/i.test(h)?D="500":/light/i.test(h)&&(D="200"),w=t.tinySDF=new dt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:y,fontWeight:D})}const P=w.draw(String.fromCharCode(_));return{id:_,bitmap:new l.o({width:P.width||60,height:P.height||60},P.data),metrics:{width:P.glyphWidth/2||24,height:P.glyphHeight/2||24,left:P.glyphLeft/2+.5||0,top:P.glyphTop/2-27.5||-8,advance:P.glyphAdvance/2||24,isDoubleResolution:!0}}}}dt.loadGlyphRange=function(k,t,h,_){return l._(this,void 0,void 0,function*(){const y=256*t,w=y+255,P=_.transformRequest(h.replace("{fontstack}",k).replace("{range}",`${y}-${w}`),"Glyphs"),D=yield l.l(P,new AbortController);if(!D||!D.data)throw new Error(`Could not load glyph range. range: ${t}, ${y}-${w}`);const z={};for(const V of l.n(D.data))z[V.id]=V;return z})},dt.TinySDF=class{constructor({fontSize:k=24,buffer:t=3,radius:h=8,cutoff:_=.25,fontFamily:y="sans-serif",fontWeight:w="normal",fontStyle:P="normal"}={}){this.buffer=t,this.cutoff=_,this.radius=h;const D=this.size=k+4*t,z=this._createCanvas(D),V=this.ctx=z.getContext("2d",{willReadFrequently:!0});V.font=`${P} ${w} ${k}px ${y}`,V.textBaseline="alphabetic",V.textAlign="left",V.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(k){const t=document.createElement("canvas");return t.width=t.height=k,t}draw(k){const{width:t,actualBoundingBoxAscent:h,actualBoundingBoxDescent:_,actualBoundingBoxLeft:y,actualBoundingBoxRight:w}=this.ctx.measureText(k),P=Math.ceil(h),D=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(w-y))),z=Math.min(this.size-this.buffer,P+Math.ceil(_)),V=D+2*this.buffer,H=z+2*this.buffer,W=Math.max(V*H,0),ne=new Uint8ClampedArray(W),ge={data:ne,width:V,height:H,glyphWidth:D,glyphHeight:z,glyphTop:P,glyphLeft:0,glyphAdvance:t};if(D===0||z===0)return ge;const{ctx:ke,buffer:Me,gridInner:Ne,gridOuter:ze}=this;ke.clearRect(Me,Me,D,z),ke.fillText(k,Me,Me+P);const qe=ke.getImageData(Me,Me,D,z);ze.fill(Ve,0,W),Ne.fill(0,0,W);for(let Te=0;Te<z;Te++)for(let Ze=0;Ze<D;Ze++){const Ke=qe.data[4*(Te*D+Ze)+3]/255;if(Ke===0)continue;const it=(Te+Me)*V+Ze+Me;if(Ke===1)ze[it]=0,Ne[it]=Ve;else{const bt=.5-Ke;ze[it]=bt>0?bt*bt:0,Ne[it]=bt<0?bt*bt:0}}pt(ze,0,0,V,H,V,this.f,this.v,this.z),pt(Ne,Me,Me,D,z,V,this.f,this.v,this.z);for(let Te=0;Te<W;Te++){const Ze=Math.sqrt(ze[Te])-Math.sqrt(Ne[Te]);ne[Te]=Math.round(255-255*(Ze/this.radius+this.cutoff))}return ge}};class ut{constructor(){this.specification=l.v.light.position}possiblyEvaluate(t,h){return l.x(t.expression.evaluate(h))}interpolate(t,h,_){return{x:l.y.number(t.x,h.x,_),y:l.y.number(t.y,h.y,_),z:l.y.number(t.z,h.z,_)}}}let Bt;class vt extends l.E{constructor(t){super(),Bt=Bt||new l.q({anchor:new l.D(l.v.light.anchor),position:new ut,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(Bt),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,h={}){if(!this._validate(l.r,t,h))for(const _ in t){const y=t[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),y):this._transitionable.setValue(_,y)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,h,_){return(!_||_.validate!==!1)&&l.t(this,t.call(l.u,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}const wt=new l.q({"sky-color":new l.D(l.v.sky["sky-color"]),"horizon-color":new l.D(l.v.sky["horizon-color"]),"fog-color":new l.D(l.v.sky["fog-color"]),"fog-ground-blend":new l.D(l.v.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.v.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.v.sky["atmosphere-blend"])});class ft extends l.E{constructor(t){super(),this._transitionable=new l.T(wt),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.z(0))}setSky(t,h={}){if(!this._validate(l.B,t,h)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const _ in t){const y=t[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),y):this._transitionable.setValue(_,y)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,h,_={}){return(_==null?void 0:_.validate)!==!1&&l.t(this,t.call(l.u,l.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class xt{constructor(t,h){this.width=t,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,h){const _=t.join(",")+String(h);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(t,h)),this.dashEntry[_]}getDashRanges(t,h,_){const y=[];let w=t.length%2==1?-t[t.length-1]*_:0,P=t[0]*_,D=!0;y.push({left:w,right:P,isDash:D,zeroLength:t[0]===0});let z=t[0];for(let V=1;V<t.length;V++){D=!D;const H=t[V];w=z*_,z+=H,P=z*_,y.push({left:w,right:P,isDash:D,zeroLength:H===0})}return y}addRoundDash(t,h,_){const y=h/2;for(let w=-_;w<=_;w++){const P=this.width*(this.nextRow+_+w);let D=0,z=t[D];for(let V=0;V<this.width;V++){V/z.right>1&&(z=t[++D]);const H=Math.abs(V-z.left),W=Math.abs(V-z.right),ne=Math.min(H,W);let ge;const ke=w/_*(y+1);if(z.isDash){const Me=y-Math.abs(ke);ge=Math.sqrt(ne*ne+Me*Me)}else ge=y-Math.sqrt(ne*ne+ke*ke);this.data[P+V]=Math.max(0,Math.min(255,ge+128))}}}addRegularDash(t){for(let D=t.length-1;D>=0;--D){const z=t[D],V=t[D+1];z.zeroLength?t.splice(D,1):V&&V.isDash===z.isDash&&(V.left=z.left,t.splice(D,1))}const h=t[0],_=t[t.length-1];h.isDash===_.isDash&&(h.left=_.left-this.width,_.right=h.right+this.width);const y=this.width*this.nextRow;let w=0,P=t[w];for(let D=0;D<this.width;D++){D/P.right>1&&(P=t[++w]);const z=Math.abs(D-P.left),V=Math.abs(D-P.right),H=Math.min(z,V);this.data[y+D]=Math.max(0,Math.min(255,(P.isDash?H:-H)+128))}}addDash(t,h){const _=h?7:0,y=2*_+1;if(this.nextRow+y>this.height)return l.w("LineAtlas out of space"),null;let w=0;for(let D=0;D<t.length;D++)w+=t[D];if(w!==0){const D=this.width/w,z=this.getDashRanges(t,this.width,D);h?this.addRoundDash(z,D,_):this.addRegularDash(z)}const P={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:w};return this.nextRow+=y,this.dirty=!0,P}bind(t){const h=t.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const It="maplibre_preloaded_worker_pool";class Jt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Jt.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[It]}numActive(){return Object.keys(this.active).length}}const pn=Math.floor(L.hardwareConcurrency/2);let Rn,Xe;function Wn(){return Rn||(Rn=new Jt),Rn}Jt.workerCount=l.C(globalThis)?Math.max(Math.min(pn,3),1):1;class dn{constructor(t,h){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=h;const _=this.workerPool.acquire(h);for(let y=0;y<_.length;y++){const w=new l.F(_[y],h);w.name=`Worker ${y}`,this.actors.push(w)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,h){const _=[];for(const y of this.actors)_.push(y.sendAsync({type:t,data:h}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,h){for(const _ of this.actors)_.registerMessageHandler(t,h)}}function Ft(){return Xe||(Xe=new dn(Wn(),l.G),Xe.registerMessageHandler("GR",(k,t,h)=>l.m(t,h))),Xe}function Se(k,t){const h=l.H();return l.J(h,h,[1,1,0]),l.K(h,h,[.5*k.width,.5*k.height,1]),l.L(h,h,k.calculatePosMatrix(t.toUnwrapped()))}function lt(k,t,h,_,y,w){const P=function(W,ne,ge){if(W)for(const ke of W){const Me=ne[ke];if(Me&&Me.source===ge&&Me.type==="fill-extrusion")return!0}else for(const ke in ne){const Me=ne[ke];if(Me.source===ge&&Me.type==="fill-extrusion")return!0}return!1}(y&&y.layers,t,k.id),D=w.maxPitchScaleFactor(),z=k.tilesIn(_,D,P);z.sort(Je);const V=[];for(const W of z)V.push({wrappedTileID:W.tileID.wrapped().key,queryResults:W.tile.queryRenderedFeatures(t,h,k._state,W.queryGeometry,W.cameraQueryGeometry,W.scale,y,w,D,Se(k.transform,W.tileID))});const H=function(W){const ne={},ge={};for(const ke of W){const Me=ke.queryResults,Ne=ke.wrappedTileID,ze=ge[Ne]=ge[Ne]||{};for(const qe in Me){const Te=Me[qe],Ze=ze[qe]=ze[qe]||{},Ke=ne[qe]=ne[qe]||[];for(const it of Te)Ze[it.featureIndex]||(Ze[it.featureIndex]=!0,Ke.push(it))}}return ne}(V);for(const W in H)H[W].forEach(ne=>{const ge=ne.feature,ke=k.getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=ke});return H}function Je(k,t){const h=k.tileID,_=t.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function Lt(k,t,h){return l._(this,void 0,void 0,function*(){let _=k;if(k.url?_=(yield l.h(t.transformRequest(k.url,"Source"),h)).data:yield L.frameAsync(h),!_)return null;const y=l.M(l.e(_,k),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(y.vectorLayerIds=_.vector_layers.map(w=>w.id)),y})}class Ye{constructor(t,h){t&&(h?this.setSouthWest(t).setNorthEast(h):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof l.N?new l.N(t.lng,t.lat):l.N.convert(t),this}setSouthWest(t){return this._sw=t instanceof l.N?new l.N(t.lng,t.lat):l.N.convert(t),this}extend(t){const h=this._sw,_=this._ne;let y,w;if(t instanceof l.N)y=t,w=t;else{if(!(t instanceof Ye))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ye.convert(t)):this.extend(l.N.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(l.N.convert(t)):this;if(y=t._sw,w=t._ne,!y||!w)return this}return h||_?(h.lng=Math.min(y.lng,h.lng),h.lat=Math.min(y.lat,h.lat),_.lng=Math.max(w.lng,_.lng),_.lat=Math.max(w.lat,_.lat)):(this._sw=new l.N(y.lng,y.lat),this._ne=new l.N(w.lng,w.lat)),this}getCenter(){return new l.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.N(this.getWest(),this.getNorth())}getSouthEast(){return new l.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:h,lat:_}=l.N.convert(t);let y=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&y}static convert(t){return t instanceof Ye?t:t&&new Ye(t)}static fromLngLat(t,h=0){const _=360*h/40075017,y=_/Math.cos(Math.PI/180*t.lat);return new Ye(new l.N(t.lng-y,t.lat-_),new l.N(t.lng+y,t.lat+_))}adjustAntiMeridian(){const t=new l.N(this._sw.lng,this._sw.lat),h=new l.N(this._ne.lng,this._ne.lat);return new Ye(t,t.lng>h.lng?new l.N(h.lng+360,h.lat):h)}}class kt{constructor(t,h,_){this.bounds=Ye.convert(this.validateBounds(t)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const h=Math.pow(2,t.z),_=Math.floor(l.O(this.bounds.getWest())*h),y=Math.floor(l.Q(this.bounds.getNorth())*h),w=Math.ceil(l.O(this.bounds.getEast())*h),P=Math.ceil(l.Q(this.bounds.getSouth())*h);return t.x>=_&&t.x<w&&t.y>=y&&t.y<P}}class Vt extends l.E{constructor(t,h,_,y){if(super(),this.id=t,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.M(h,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Lt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(l.e(this,t),t.bounds&&(this.tileBounds=new kt(t.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new l.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(t){return l._(this,void 0,void 0,function*(){const h=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(h,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};_.request.collectResourceTiming=this._collectResourceTiming;let y="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((w,P)=>{t.reloadPromise={resolve:w,reject:P}})}else t.actor=this.dispatcher.getActor(),y="LT";t.abortController=new AbortController;try{const w=yield t.actor.sendAsync({type:y,data:_},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,w)}catch(w){if(delete t.abortController,t.aborted)return;if(w&&w.status!==404)throw w;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,h){if(h&&h.resourceTiming&&(t.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&t.setExpiryData(h),t.loadVectorData(h,this.map.painter),t.reloadPromise){const _=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(_.resolve).catch(_.reject)}}abortTile(t){return l._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return l._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ee extends l.E{constructor(t,h,_,y){super(),this.id=t,this.dispatcher=_,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},h),l.e(this,l.M(h,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Lt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(l.e(this,t),t.bounds&&(this.tileBounds=new kt(t.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new l.j(t))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return l.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return l._(this,void 0,void 0,function*(){const h=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const _=yield $.getImage(this.map._requestManager.transformRequest(h,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&t.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const y=this.map.painter.context,w=y.gl,P=_.data;t.texture=this.map.painter.getTileTexture(P.width),t.texture?t.texture.update(P,{useMipmap:!0}):(t.texture=new we(y,P,w.RGBA,{useMipmap:!0}),t.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(_){if(delete t.abortController,t.aborted)t.state="unloaded";else if(_)throw t.state="errored",_}})}abortTile(t){return l._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return l._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class Gt extends Ee{constructor(t,h,_,y){super(t,h,_,y),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(t){return l._(this,void 0,void 0,function*(){const h=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(h,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const y=yield $.getImage(_,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(y&&y.data){const w=y.data;this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&t.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const P=l.b(w)&&l.U()?w:yield this.readImageNow(w),D={type:this.type,uid:t.uid,source:this.id,rawImageData:P,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const z=yield t.actor.sendAsync({type:"LDT",data:D});t.dem=z,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(y){if(delete t.abortController,t.aborted)t.state="unloaded";else if(y)throw t.state="errored",y}})}readImageNow(t){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.V()){const h=t.width+2,_=t.height+2;try{return new l.R({width:h,height:_},yield l.W(t,-1,-1,h,_))}catch{}}return L.getImageData(t,1)})}_getNeighboringTiles(t){const h=t.canonical,_=Math.pow(2,h.z),y=(h.x-1+_)%_,w=h.x===0?t.wrap-1:t.wrap,P=(h.x+1+_)%_,D=h.x+1===_?t.wrap+1:t.wrap,z={};return z[new l.S(t.overscaledZ,w,h.z,y,h.y).key]={backfilled:!1},z[new l.S(t.overscaledZ,D,h.z,P,h.y).key]={backfilled:!1},h.y>0&&(z[new l.S(t.overscaledZ,w,h.z,y,h.y-1).key]={backfilled:!1},z[new l.S(t.overscaledZ,t.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},z[new l.S(t.overscaledZ,D,h.z,P,h.y-1).key]={backfilled:!1}),h.y+1<_&&(z[new l.S(t.overscaledZ,w,h.z,y,h.y+1).key]={backfilled:!1},z[new l.S(t.overscaledZ,t.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},z[new l.S(t.overscaledZ,D,h.z,P,h.y+1).key]={backfilled:!1}),z}unloadTile(t){return l._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class _n extends l.E{constructor(t,h,_,y){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_.getActor(),this.setEventedParent(y),this._data=h.data,this._options=l.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const w=l.X/this.tileSize;h.clusterMaxZoom!==void 0&&this.maxzoom<=h.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${h.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*w,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*w,extent:l.X,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:l.X,radius:(h.clusterRadius||50)*w,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return l._(this,void 0,void 0,function*(){const t=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,h,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:h,offset:_}})}_updateWorkerData(t){return l._(this,void 0,void 0,function*(){const h=l.e({type:this.type},this.workerOptions);t?h.dataDiff=t:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(L.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const _=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||_.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let y=null;_.resourceTiming&&_.resourceTiming[this.id]&&(y=_.resourceTiming[this.id].slice(0));const w={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&l.e(w,{resourceTiming:y}),this.fire(new l.k("data",Object.assign(Object.assign({},w),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},w),{sourceDataType:"content"})))}catch(_){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(_))}})}loaded(){return this._pendingLoads===0}loadTile(t){return l._(this,void 0,void 0,function*(){const h=t.actor?"RT":"LT";t.actor=this.actor;const _={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const y=yield this.actor.sendAsync({type:h,data:_},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(y,this.map.painter,h==="RT")})}abortTile(t){return l._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return l._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Kn=l.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Yi extends l.E{constructor(t,h,_,y){super(),this.id=t,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=h}load(t){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield $.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,t&&(this.coordinates=t),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new l.j(h))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const h=t.map(l.Z.fromLngLat);this.tileID=function(y){let w=1/0,P=1/0,D=-1/0,z=-1/0;for(const ne of y)w=Math.min(w,ne.x),P=Math.min(P,ne.y),D=Math.max(D,ne.x),z=Math.max(z,ne.y);const V=Math.max(D-w,z-P),H=Math.max(0,Math.floor(-Math.log(V)/Math.LN2)),W=Math.pow(2,H);return new l.a1(H,Math.floor((w+D)/2*W),Math.floor((P+z)/2*W))}(h),this.minzoom=this.maxzoom=this.tileID.z;const _=h.map(y=>this.tileID.getTilePoint(y)._round());return this._boundsArray=new l.$,this._boundsArray.emplaceBack(_[0].x,_[0].y,0,0),this._boundsArray.emplaceBack(_[1].x,_[1].y,l.X,0),this._boundsArray.emplaceBack(_[3].x,_[3].y,0,l.X),this._boundsArray.emplaceBack(_[2].x,_[2].y,l.X,l.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,h=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Kn.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new we(t,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let _=!1;for(const y in this.tiles){const w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,_=!0)}_&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class xn extends Yi{constructor(t,h,_,y){super(t,h,_,y),this.roundZoom=!0,this.type="video",this.options=h}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const h of t.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield l.a3(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new l.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const h=this.video.seekable;t<h.start(0)||t>h.end(0)?this.fire(new l.j(new l.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,h=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Kn.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new we(t,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let _=!1;for(const y in this.tiles){const w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,_=!0)}_&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class qi extends Yi{constructor(t,h,_,y){super(t,h,_,y),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(P=>typeof P!="number"))||this.fire(new l.j(new l.a2(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a2(`sources.${t}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new l.j(new l.a2(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a2(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a2(`sources.${t}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,_=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Kn.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new we(h,this.canvas,_.RGBA,{premultiply:!0});let y=!1;for(const w in this.tiles){const P=this.tiles[w];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture,y=!0)}y&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Ji={},Jr=k=>{switch(k){case"geojson":return _n;case"image":return Yi;case"raster":return Ee;case"raster-dem":return Gt;case"vector":return Vt;case"video":return xn;case"canvas":return qi}return Ji[k]},ct="RTLPluginLoaded";class gr extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ft()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return l._(this,arguments,void 0,function*(h,_=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=L.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!_)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(ct))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let kn=null;function mn(){return kn||(kn=new gr),kn}class As{constructor(t,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=l.a4(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const h=t+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,h,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(y,w){const P={};if(!w)return P;for(const D of y){const z=D.layerIds.map(V=>w.getLayer(V)).filter(Boolean);if(z.length!==0){D.layers=z,D.stateDependentLayerIds&&(D.stateDependentLayers=D.stateDependentLayerIds.map(V=>z.filter(H=>H.id===V)[0]));for(const V of z)P[V.id]=D}}return P}(t.buckets,h.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const w=this.buckets[y];if(w instanceof l.a6){if(this.hasSymbolBuckets=!0,!_)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const w=this.buckets[y];if(w instanceof l.a6&&w.hasRTLText){this.hasRTLText=!0,mn().lazyLoad();break}}this.queryPadding=0;for(const y in this.buckets){const w=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(y).queryRadius(w))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new l.a5}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const _ in this.buckets){const y=this.buckets[_];y.uploadPending()&&y.upload(t)}const h=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new we(t,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new we(t,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,h,_,y,w,P,D,z,V,H){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:y,cameraQueryGeometry:w,scale:P,tileSize:this.tileSize,pixelPosMatrix:H,transform:z,params:D,queryPadding:this.queryPadding*V},t,h,_):{}}querySourceFeatures(t,h){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const y=_.loadVTLayers(),w=h&&h.sourceLayer?h.sourceLayer:"",P=y._geojsonTileLayer||y[w];if(!P)return;const D=l.a7(h&&h.filter),{z,x:V,y:H}=this.tileID.canonical,W={z,x:V,y:H};for(let ne=0;ne<P.length;ne++){const ge=P.feature(ne);if(D.needGeometry){const Ne=l.a8(ge,!0);if(!D.filter(new l.z(this.tileID.overscaledZ),Ne,this.tileID.canonical))continue}else if(!D.filter(new l.z(this.tileID.overscaledZ),ge))continue;const ke=_.getId(ge,w),Me=new l.a9(ge,z,V,H,ke);Me.tile=W,t.push(Me)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const h=this.expirationTime;if(t.cacheControl){const _=l.aa(t.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const _=Date.now();let y=!1;if(this.expirationTime>_)y=!1;else if(h)if(this.expirationTime<h)y=!0;else{const w=this.expirationTime-h;w?this.expirationTime=_+Math.max(w,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const y in this.buckets){if(!h.style.hasLayer(y))continue;const w=this.buckets[y],P=w.layers[0].sourceLayer||"_geojsonTileLayer",D=_[P],z=t[P];if(!D||!z||Object.keys(z).length===0)continue;w.update(z,D,this.imageAtlas&&this.imageAtlas.patternPositions||{});const V=h&&h.style&&h.style.getLayer(y);V&&(this.queryPadding=Math.max(this.queryPadding,V.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<L.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=L.now()+t}setDependencies(t,h){const _={};for(const y of h)_[y]=!0;this.dependencies[t]=_}hasDependency(t,h){for(const _ of t){const y=this.dependencies[_];if(y){for(const w of h)if(y[w])return!0}}return!1}}class At{constructor(t,h){this.max=t,this.onRemove=h,this.reset()}reset(){for(const t in this.data)for(const h of this.data[t])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(t,h,_){const y=t.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const w={value:h,timeout:void 0};if(_!==void 0&&(w.timeout=setTimeout(()=>{this.remove(t,w)},_)),this.data[y].push(w),this.order.push(y),this.order.length>this.max){const P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const h=this.data[t].shift();return h.timeout&&clearTimeout(h.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),h.value}getByKey(t){const h=this.data[t];return h?h[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,h){if(!this.has(t))return this;const _=t.wrapped().key,y=h===void 0?0:this.data[_].indexOf(h),w=this.data[_][y];return this.data[_].splice(y,1),w.timeout&&clearTimeout(w.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(w.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(t){const h=[];for(const _ in this.data)for(const y of this.data[_])t(y.value)||h.push(y);for(const _ of h)this.remove(_.value.tileID,_)}}class Ln{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,h,_){const y=String(h);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][y]=this.stateChanges[t][y]||{},l.e(this.stateChanges[t][y],_),this.deletedStates[t]===null){this.deletedStates[t]={};for(const w in this.state[t])w!==y&&(this.deletedStates[t][w]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][y]===null){this.deletedStates[t][y]={};for(const w in this.state[t][y])_[w]||(this.deletedStates[t][y][w]=null)}else for(const w in _)this.deletedStates[t]&&this.deletedStates[t][y]&&this.deletedStates[t][y][w]===null&&delete this.deletedStates[t][y][w]}removeFeatureState(t,h,_){if(this.deletedStates[t]===null)return;const y=String(h);if(this.deletedStates[t]=this.deletedStates[t]||{},_&&h!==void 0)this.deletedStates[t][y]!==null&&(this.deletedStates[t][y]=this.deletedStates[t][y]||{},this.deletedStates[t][y][_]=null);else if(h!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][y])for(_ in this.deletedStates[t][y]={},this.stateChanges[t][y])this.deletedStates[t][y][_]=null;else this.deletedStates[t][y]=null;else this.deletedStates[t]=null}getState(t,h){const _=String(h),y=l.e({},(this.state[t]||{})[_],(this.stateChanges[t]||{})[_]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const w=this.deletedStates[t][h];if(w===null)return{};for(const P in w)delete y[P]}return y}initializeTileState(t,h){t.setFeatureState(this.state,h)}coalesceChanges(t,h){const _={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const w={};for(const P in this.stateChanges[y])this.state[y][P]||(this.state[y][P]={}),l.e(this.state[y][P],this.stateChanges[y][P]),w[P]=this.state[y][P];_[y]=w}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const w={};if(this.deletedStates[y]===null)for(const P in this.state[y])w[P]={},this.state[y][P]={};else for(const P in this.deletedStates[y]){if(this.deletedStates[y][P]===null)this.state[y][P]={};else for(const D of Object.keys(this.deletedStates[y][P]))delete this.state[y][P][D];w[P]=this.state[y][P]}_[y]=_[y]||{},l.e(_[y],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const y in t)t[y].setFeatureState(_,h)}}class Tt extends l.E{constructor(t,h,_){super(),this.id=t,this.dispatcher=_,this.on("data",y=>this._dataHandler(y)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((y,w,P,D)=>{const z=new(Jr(w.type))(y,w,P,D);if(z.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${z.id}`);return z})(t,h,_,this),this._tiles={},this._cache=new At(0,y=>this._unloadTile(y)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ln,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const h=this._tiles[t];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,h,_){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,h,_)}catch(y){t.state="errored",y.status!==404?this._source.fire(new l.j(y,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new l.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const _=this._tiles[h];_.upload(t),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(_r).map(t=>t.key)}getRenderableIds(t){const h=[];for(const _ in this._tiles)this._isIdRenderable(_,t)&&h.push(this._tiles[_]);return t?h.sort((_,y)=>{const w=_.tileID,P=y.tileID,D=new l.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),z=new l.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-P.overscaledZ||z.y-D.y||z.x-D.x}).map(_=>_.tileID.key):h.map(_=>_.tileID).sort(_r).map(_=>_.key)}hasRenderableParent(t){const h=this.findLoadedParent(t,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(t,h){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(h||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,h){return l._(this,void 0,void 0,function*(){const _=this._tiles[t];_&&(_.state!=="loading"&&(_.state=h),yield this._loadTile(_,t,h))})}_tileLoaded(t,h,_){t.timeAdded=L.now(),_==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(h,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const h=this.getRenderableIds();for(let y=0;y<h.length;y++){const w=h[y];if(t.neighboringTiles&&t.neighboringTiles[w]){const P=this.getTileByID(w);_(t,P),_(P,t)}}function _(y,w){y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let P=w.tileID.canonical.x-y.tileID.canonical.x;const D=w.tileID.canonical.y-y.tileID.canonical.y,z=Math.pow(2,y.tileID.canonical.z),V=w.tileID.key;P===0&&D===0||Math.abs(D)>1||(Math.abs(P)>1&&(Math.abs(P+z)===1?P+=z:Math.abs(P-z)===1&&(P-=z)),w.dem&&y.dem&&(y.dem.backfillBorder(w.dem,P,D),y.neighboringTiles&&y.neighboringTiles[V]&&(y.neighboringTiles[V].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,h,_,y){for(const w in this._tiles){let P=this._tiles[w];if(y[w]||!P.hasData()||P.tileID.overscaledZ<=h||P.tileID.overscaledZ>_)continue;let D=P.tileID;for(;P&&P.tileID.overscaledZ>h+1;){const V=P.tileID.scaledTo(P.tileID.overscaledZ-1);P=this._tiles[V.key],P&&P.hasData()&&(D=V)}let z=D;for(;z.overscaledZ>h;)if(z=z.scaledTo(z.overscaledZ-1),t[z.key]){y[D.key]=D;break}}}findLoadedParent(t,h){if(t.key in this._loadedParentTiles){const _=this._loadedParentTiles[t.key];return _&&_.tileID.overscaledZ>=h?_:null}for(let _=t.overscaledZ-1;_>=h;_--){const y=t.scaledTo(_),w=this._getLoadedTile(y);if(w)return w}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const h=this._tiles[t.key];return h&&h.hasData()?h:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const h=Math.ceil(t.width/this._source.tileSize)+1,_=Math.ceil(t.height/this._source.tileSize)+1,y=Math.floor(h*_*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(w)}handleWrapJump(t){const h=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,h){const _={};for(const y in this._tiles){const w=this._tiles[y];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+h),_[w.tileID.key]=w}this._tiles=_;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(y,this._tiles[y])}}_updateCoveredAndRetainedTiles(t,h,_,y,w,P){const D={},z={},V=Object.keys(t),H=L.now();for(const W of V){const ne=t[W],ge=this._tiles[W];if(!ge||ge.fadeEndTime!==0&&ge.fadeEndTime<=H)continue;const ke=this.findLoadedParent(ne,h),Me=this.findLoadedSibling(ne),Ne=ke||Me||null;Ne&&(this._addTile(Ne.tileID),D[Ne.tileID.key]=Ne.tileID),z[W]=ne}this._retainLoadedChildren(z,y,_,t);for(const W in D)t[W]||(this._coveredTiles[W]=!0,t[W]=D[W]);if(P){const W={},ne={};for(const ge of w)this._tiles[ge.key].hasData()?W[ge.key]=ge:ne[ge.key]=ge;for(const ge in ne){const ke=ne[ge].children(this._source.maxzoom);this._tiles[ke[0].key]&&this._tiles[ke[1].key]&&this._tiles[ke[2].key]&&this._tiles[ke[3].key]&&(W[ke[0].key]=t[ke[0].key]=ke[0],W[ke[1].key]=t[ke[1].key]=ke[1],W[ke[2].key]=t[ke[2].key]=ke[2],W[ke[3].key]=t[ke[3].key]=ke[3],delete ne[ge])}for(const ge in ne){const ke=ne[ge],Me=this.findLoadedParent(ke,this._source.minzoom),Ne=this.findLoadedSibling(ke),ze=Me||Ne||null;if(ze){W[ze.tileID.key]=t[ze.tileID.key]=ze.tileID;for(const qe in W)W[qe].isChildOf(ze.tileID)&&delete W[qe]}}for(const ge in this._tiles)W[ge]||(this._coveredTiles[ge]=!0)}}update(t,h){if(!this._sourceLoaded||this._paused)return;let _;this.transform=t,this.terrain=h,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(H=>new l.S(H.canonical.z,H.wrap,H.canonical.z,H.canonical.x,H.canonical.y)):(_=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(_=_.filter(H=>this._source.hasTile(H)))):_=[];const y=t.coveringZoomLevel(this._source),w=Math.max(y-Tt.maxOverzooming,this._source.minzoom),P=Math.max(y+Tt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const H={};for(const W of _)if(W.canonical.z>this._source.minzoom){const ne=W.scaledTo(W.canonical.z-1);H[ne.key]=ne;const ge=W.scaledTo(Math.max(this._source.minzoom,Math.min(W.canonical.z,5)));H[ge.key]=ge}_=_.concat(Object.values(H))}const D=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,D&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const z=this._updateRetainedTiles(_,y);Gr(this._source.type)&&this._updateCoveredAndRetainedTiles(z,w,P,y,_,h);for(const H in z)this._tiles[H].clearFadeHold();const V=l.ab(this._tiles,z);for(const H of V){const W=this._tiles[H];W.hasSymbolBuckets&&!W.holdingForFade()?W.setHoldDuration(this.map._fadeDuration):W.hasSymbolBuckets&&!W.symbolFadeFinished()||this._removeTile(H)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,h){var _;const y={},w={},P=Math.max(h-Tt.maxOverzooming,this._source.minzoom),D=Math.max(h+Tt.maxUnderzooming,this._source.minzoom),z={};for(const V of t){const H=this._addTile(V);y[V.key]=V,H.hasData()||h<this._source.maxzoom&&(z[V.key]=V)}this._retainLoadedChildren(z,h,D,y);for(const V of t){let H=this._tiles[V.key];if(H.hasData())continue;if(h+1>this._source.maxzoom){const ne=V.children(this._source.maxzoom)[0],ge=this.getTile(ne);if(ge&&ge.hasData()){y[ne.key]=ne;continue}}else{const ne=V.children(this._source.maxzoom);if(y[ne[0].key]&&y[ne[1].key]&&y[ne[2].key]&&y[ne[3].key])continue}let W=H.wasRequested();for(let ne=V.overscaledZ-1;ne>=P;--ne){const ge=V.scaledTo(ne);if(w[ge.key])break;if(w[ge.key]=!0,H=this.getTile(ge),!H&&W&&(H=this._addTile(ge)),H){const ke=H.hasData();if((ke||!(!((_=this.map)===null||_===void 0)&&_.cancelPendingTileRequestsWhileZooming)||W)&&(y[ge.key]=ge),W=H.wasRequested(),ke)break}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const h=[];let _,y=this._tiles[t].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){_=this._loadedParentTiles[y.key];break}h.push(y.key);const w=y.scaledTo(y.overscaledZ-1);if(_=this._getLoadedTile(w),_)break;y=w}for(const w of h)this._loadedParentTiles[w]=_}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const h=this._tiles[t].tileID,_=this._getLoadedTile(h);this._loadedSiblingTiles[h.key]=_}}_addTile(t){let h=this._tiles[t.key];if(h)return h;h=this._cache.getAndRemove(t),h&&(this._setTileReloadTimer(t.key,h),h.tileID=t,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,h)));const _=h;return h||(h=new As(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(h,t.key,h.state)),h.uses++,this._tiles[t.key]=h,_||this._source.fire(new l.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(t,h){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const _=h.getExpiryTimeout();_&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},_))}_removeTile(t){const h=this._tiles[t];h&&(h.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(t){const h=t.sourceDataType;t.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,h,_){const y=[],w=this.transform;if(!w)return y;const P=_?w.getCameraQueryGeometry(t):t,D=t.map(ke=>w.pointCoordinate(ke,this.terrain)),z=P.map(ke=>w.pointCoordinate(ke,this.terrain)),V=this.getIds();let H=1/0,W=1/0,ne=-1/0,ge=-1/0;for(const ke of z)H=Math.min(H,ke.x),W=Math.min(W,ke.y),ne=Math.max(ne,ke.x),ge=Math.max(ge,ke.y);for(let ke=0;ke<V.length;ke++){const Me=this._tiles[V[ke]];if(Me.holdingForFade())continue;const Ne=Me.tileID,ze=Math.pow(2,w.zoom-Me.tileID.overscaledZ),qe=h*Me.queryPadding*l.X/Me.tileSize/ze,Te=[Ne.getTilePoint(new l.Z(H,W)),Ne.getTilePoint(new l.Z(ne,ge))];if(Te[0].x-qe<l.X&&Te[0].y-qe<l.X&&Te[1].x+qe>=0&&Te[1].y+qe>=0){const Ze=D.map(it=>Ne.getTilePoint(it)),Ke=z.map(it=>Ne.getTilePoint(it));y.push({tile:Me,tileID:Ne,queryGeometry:Ze,cameraQueryGeometry:Ke,scale:ze})}}return y}getVisibleCoordinates(t){const h=this.getRenderableIds(t).map(_=>this._tiles[_].tileID);for(const _ of h)_.posMatrix=this.transform.calculatePosMatrix(_.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(Gr(this._source.type)){const t=L.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=t)return!0}return!1}setFeatureState(t,h,_){this._state.updateState(t=t||"_geojsonTileLayer",h,_)}removeFeatureState(t,h,_){this._state.removeFeatureState(t=t||"_geojsonTileLayer",h,_)}getFeatureState(t,h){return this._state.getState(t=t||"_geojsonTileLayer",h)}setDependencies(t,h,_){const y=this._tiles[t];y&&y.setDependencies(h,_)}reloadTilesForDependencies(t,h){for(const _ in this._tiles)this._tiles[_].hasDependency(t,h)&&this._reloadTile(_,"reloading");this._cache.filter(_=>!_.hasDependency(t,h))}}function _r(k,t){const h=Math.abs(2*k.wrap)-+(k.wrap<0),_=Math.abs(2*t.wrap)-+(t.wrap<0);return k.overscaledZ-t.overscaledZ||_-h||t.canonical.y-k.canonical.y||t.canonical.x-k.canonical.x}function Gr(k){return k==="raster"||k==="image"||k==="video"}Tt.maxOverzooming=10,Tt.maxUnderzooming=3;class wn{constructor(t,h){this.reset(t,h)}reset(t,h){this.points=t||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=l.ac(t,0,1);let h=1,_=this._distances[h];const y=t*this.paddedLength+this.padding;for(;_<y&&h<this._distances.length;)_=this._distances[++h];const w=h-1,P=this._distances[w],D=_-P,z=D>0?(y-P)/D:0;return this.points[w].mult(1-z).add(this.points[h].mult(z))}}function Mi(k,t){let h=!0;return k==="always"||k!=="never"&&t!=="never"||(h=!1),h}class Er{constructor(t,h,_){const y=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(t/_),this.yCellCount=Math.ceil(h/_);for(let P=0;P<this.xCellCount*this.yCellCount;P++)y.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=h,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,h,_,y,w){this._forEachCell(h,_,y,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(y),this.bboxes.push(w)}insertCircle(t,h,_,y){this._forEachCell(h-y,_-y,h+y,_+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(h),this.circles.push(_),this.circles.push(y)}_insertBoxCell(t,h,_,y,w,P){this.boxCells[w].push(P)}_insertCircleCell(t,h,_,y,w,P){this.circleCells[w].push(P)}_query(t,h,_,y,w,P,D){if(_<0||t>this.width||y<0||h>this.height)return[];const z=[];if(t<=0&&h<=0&&this.width<=_&&this.height<=y){if(w)return[{key:null,x1:t,y1:h,x2:_,y2:y}];for(let V=0;V<this.boxKeys.length;V++)z.push({key:this.boxKeys[V],x1:this.bboxes[4*V],y1:this.bboxes[4*V+1],x2:this.bboxes[4*V+2],y2:this.bboxes[4*V+3]});for(let V=0;V<this.circleKeys.length;V++){const H=this.circles[3*V],W=this.circles[3*V+1],ne=this.circles[3*V+2];z.push({key:this.circleKeys[V],x1:H-ne,y1:W-ne,x2:H+ne,y2:W+ne})}}else this._forEachCell(t,h,_,y,this._queryCell,z,{hitTest:w,overlapMode:P,seenUids:{box:{},circle:{}}},D);return z}query(t,h,_,y){return this._query(t,h,_,y,!1,null)}hitTest(t,h,_,y,w,P){return this._query(t,h,_,y,!0,w,P).length>0}hitTestCircle(t,h,_,y,w){const P=t-_,D=t+_,z=h-_,V=h+_;if(D<0||P>this.width||V<0||z>this.height)return!1;const H=[];return this._forEachCell(P,z,D,V,this._queryCellCircle,H,{hitTest:!0,overlapMode:y,circle:{x:t,y:h,radius:_},seenUids:{box:{},circle:{}}},w),H.length>0}_queryCell(t,h,_,y,w,P,D,z){const{seenUids:V,hitTest:H,overlapMode:W}=D,ne=this.boxCells[w];if(ne!==null){const ke=this.bboxes;for(const Me of ne)if(!V.box[Me]){V.box[Me]=!0;const Ne=4*Me,ze=this.boxKeys[Me];if(t<=ke[Ne+2]&&h<=ke[Ne+3]&&_>=ke[Ne+0]&&y>=ke[Ne+1]&&(!z||z(ze))&&(!H||!Mi(W,ze.overlapMode))&&(P.push({key:ze,x1:ke[Ne],y1:ke[Ne+1],x2:ke[Ne+2],y2:ke[Ne+3]}),H))return!0}}const ge=this.circleCells[w];if(ge!==null){const ke=this.circles;for(const Me of ge)if(!V.circle[Me]){V.circle[Me]=!0;const Ne=3*Me,ze=this.circleKeys[Me];if(this._circleAndRectCollide(ke[Ne],ke[Ne+1],ke[Ne+2],t,h,_,y)&&(!z||z(ze))&&(!H||!Mi(W,ze.overlapMode))){const qe=ke[Ne],Te=ke[Ne+1],Ze=ke[Ne+2];if(P.push({key:ze,x1:qe-Ze,y1:Te-Ze,x2:qe+Ze,y2:Te+Ze}),H)return!0}}}return!1}_queryCellCircle(t,h,_,y,w,P,D,z){const{circle:V,seenUids:H,overlapMode:W}=D,ne=this.boxCells[w];if(ne!==null){const ke=this.bboxes;for(const Me of ne)if(!H.box[Me]){H.box[Me]=!0;const Ne=4*Me,ze=this.boxKeys[Me];if(this._circleAndRectCollide(V.x,V.y,V.radius,ke[Ne+0],ke[Ne+1],ke[Ne+2],ke[Ne+3])&&(!z||z(ze))&&!Mi(W,ze.overlapMode))return P.push(!0),!0}}const ge=this.circleCells[w];if(ge!==null){const ke=this.circles;for(const Me of ge)if(!H.circle[Me]){H.circle[Me]=!0;const Ne=3*Me,ze=this.circleKeys[Me];if(this._circlesCollide(ke[Ne],ke[Ne+1],ke[Ne+2],V.x,V.y,V.radius)&&(!z||z(ze))&&!Mi(W,ze.overlapMode))return P.push(!0),!0}}}_forEachCell(t,h,_,y,w,P,D,z){const V=this._convertToXCellCoord(t),H=this._convertToYCellCoord(h),W=this._convertToXCellCoord(_),ne=this._convertToYCellCoord(y);for(let ge=V;ge<=W;ge++)for(let ke=H;ke<=ne;ke++)if(w.call(this,t,h,_,y,this.xCellCount*ke+ge,P,D,z))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,h,_,y,w,P){const D=y-t,z=w-h,V=_+P;return V*V>D*D+z*z}_circleAndRectCollide(t,h,_,y,w,P,D){const z=(P-y)/2,V=Math.abs(t-(y+z));if(V>z+_)return!1;const H=(D-w)/2,W=Math.abs(h-(w+H));if(W>H+_)return!1;if(V<=z||W<=H)return!0;const ne=V-z,ge=W-H;return ne*ne+ge*ge<=_*_}}function Ki(k,t,h,_,y){const w=l.H();return t?(l.K(w,w,[1/y,1/y,1]),h||l.ad(w,w,_.angle)):l.L(w,_.labelPlaneMatrix,k),w}function Zr(k,t,h,_,y){if(t){const w=l.ae(k);return l.K(w,w,[y,y,1]),h||l.ad(w,w,-_.angle),w}return _.glCoordMatrix}function Ae(k,t,h,_){let y;_?(y=[k,t,_(k,t),1],l.af(y,y,h)):(y=[k,t,0,1],Vn(y,y,h));const w=y[3];return{point:new l.P(y[0]/w,y[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}function K(k,t){return .5+k/t*.5}function J(k,t){return k.x>=-t[0]&&k.x<=t[0]&&k.y>=-t[1]&&k.y<=t[1]}function ce(k,t,h,_,y,w,P,D,z,V,H,W,ne,ge,ke){const Me=_?k.textSizeData:k.iconSizeData,Ne=l.ag(Me,h.transform.zoom),ze=[256/h.width*2+1,256/h.height*2+1],qe=_?k.text.dynamicLayoutVertexArray:k.icon.dynamicLayoutVertexArray;qe.clear();const Te=k.lineVertexArray,Ze=_?k.text.placedSymbolArray:k.icon.placedSymbolArray,Ke=h.transform.width/h.transform.height;let it=!1;for(let bt=0;bt<Ze.length;bt++){const Rt=Ze.get(bt);if(Rt.hidden||Rt.writingMode===l.ah.vertical&&!it){an(Rt.numGlyphs,qe);continue}it=!1;const Ht=Ae(Rt.anchorX,Rt.anchorY,t,ke);if(!J(Ht.point,ze)){an(Rt.numGlyphs,qe);continue}const Yt=K(h.transform.cameraToCenterDistance,Ht.signedDistanceFromCamera),jt=l.ai(Me,Ne,Rt),Ut=P?jt/Yt:jt*Yt,rn={getElevation:ke,labelPlaneMatrix:y,lineVertexArray:Te,pitchWithMap:P,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:V,tileAnchorPoint:new l.P(Rt.anchorX,Rt.anchorY),unwrappedTileID:H,width:W,height:ne,translation:ge},Tn=je(rn,Rt,Ut,!1,D,t,w,k.glyphOffsetArray,qe,Ke,z);it=Tn.useVertical,(Tn.notEnoughRoom||it||Tn.needsFlipping&&je(rn,Rt,Ut,!0,D,t,w,k.glyphOffsetArray,qe,Ke,z).notEnoughRoom)&&an(Rt.numGlyphs,qe)}_?k.text.dynamicLayoutVertexBuffer.updateData(qe):k.icon.dynamicLayoutVertexBuffer.updateData(qe)}function le(k,t,h,_,y,w,P,D){const z=w.glyphStartIndex+w.numGlyphs,V=w.lineStartIndex,H=w.lineStartIndex+w.lineLength,W=t.getoffsetX(w.glyphStartIndex),ne=t.getoffsetX(z-1),ge=Dt(k*W,h,_,y,w.segment,V,H,D,P);if(!ge)return null;const ke=Dt(k*ne,h,_,y,w.segment,V,H,D,P);return ke?D.projectionCache.anyProjectionOccluded?null:{first:ge,last:ke}:null}function fe(k,t,h,_){return k===l.ah.horizontal&&Math.abs(h.y-t.y)>Math.abs(h.x-t.x)*_?{useVertical:!0}:(k===l.ah.vertical?t.y<h.y:t.x>h.x)?{needsFlipping:!0}:null}function je(k,t,h,_,y,w,P,D,z,V,H){const W=h/24,ne=t.lineOffsetX*W,ge=t.lineOffsetY*W;let ke;if(t.numGlyphs>1){const Me=t.glyphStartIndex+t.numGlyphs,Ne=t.lineStartIndex,ze=t.lineStartIndex+t.lineLength,qe=le(W,D,ne,ge,_,t,H,k);if(!qe)return{notEnoughRoom:!0};const Te=Ae(qe.first.point.x,qe.first.point.y,P,k.getElevation).point,Ze=Ae(qe.last.point.x,qe.last.point.y,P,k.getElevation).point;if(y&&!_){const Ke=fe(t.writingMode,Te,Ze,V);if(Ke)return Ke}ke=[qe.first];for(let Ke=t.glyphStartIndex+1;Ke<Me-1;Ke++)ke.push(Dt(W*D.getoffsetX(Ke),ne,ge,_,t.segment,Ne,ze,k,H));ke.push(qe.last)}else{if(y&&!_){const Ne=Ae(k.tileAnchorPoint.x,k.tileAnchorPoint.y,w,k.getElevation).point,ze=t.lineStartIndex+t.segment+1,qe=new l.P(k.lineVertexArray.getx(ze),k.lineVertexArray.gety(ze)),Te=Ae(qe.x,qe.y,w,k.getElevation),Ze=Te.signedDistanceFromCamera>0?Te.point:function(it,bt,Rt,Ht,Yt,jt){return We(it,bt,Rt,1,Yt,jt)}(k.tileAnchorPoint,qe,Ne,0,w,k),Ke=fe(t.writingMode,Ne,Ze,V);if(Ke)return Ke}const Me=Dt(W*D.getoffsetX(t.glyphStartIndex),ne,ge,_,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,k,H);if(!Me||k.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ke=[Me]}for(const Me of ke)l.aj(z,Me.point,Me.angle);return{}}function We(k,t,h,_,y,w){const P=k.add(k.sub(t)._unit()),D=y!==void 0?Ae(P.x,P.y,y,w.getElevation).point:et(P.x,P.y,w).point,z=h.sub(D);return h.add(z._mult(_/z.mag()))}function Pe(k,t,h){const _=t.projectionCache;if(_.projections[k])return _.projections[k];const y=new l.P(t.lineVertexArray.getx(k),t.lineVertexArray.gety(k)),w=et(y.x,y.y,t);if(w.signedDistanceFromCamera>0)return _.projections[k]=w.point,_.anyProjectionOccluded=_.anyProjectionOccluded||w.isOccluded,w.point;const P=k-h.direction;return function(D,z,V,H,W){return We(D,z,V,H,void 0,W)}(h.distanceFromAnchor===0?t.tileAnchorPoint:new l.P(t.lineVertexArray.getx(P),t.lineVertexArray.gety(P)),y,h.previousVertex,h.absOffsetX-h.distanceFromAnchor+1,t)}function et(k,t,h){const _=k+h.translation[0],y=t+h.translation[1];let w;return!h.pitchWithMap&&h.projection.useSpecialProjectionForSymbols?(w=h.projection.projectTileCoordinates(_,y,h.unwrappedTileID,h.getElevation),w.point.x=(.5*w.point.x+.5)*h.width,w.point.y=(.5*-w.point.y+.5)*h.height):(w=Ae(_,y,h.labelPlaneMatrix,h.getElevation),w.isOccluded=!1),w}function gt(k,t,h){return k._unit()._perp()._mult(t*h)}function at(k,t,h,_,y,w,P,D,z){if(D.projectionCache.offsets[k])return D.projectionCache.offsets[k];const V=h.add(t);if(k+z.direction<_||k+z.direction>=y)return D.projectionCache.offsets[k]=V,V;const H=Pe(k+z.direction,D,z),W=gt(H.sub(h),P,z.direction),ne=h.add(W),ge=H.add(W);return D.projectionCache.offsets[k]=l.ak(w,V,ne,ge)||V,D.projectionCache.offsets[k]}function Dt(k,t,h,_,y,w,P,D,z){const V=_?k-t:k+t;let H=V>0?1:-1,W=0;_&&(H*=-1,W=Math.PI),H<0&&(W+=Math.PI);let ne,ge=H>0?w+y:w+y+1;D.projectionCache.cachedAnchorPoint?ne=D.projectionCache.cachedAnchorPoint:(ne=et(D.tileAnchorPoint.x,D.tileAnchorPoint.y,D).point,D.projectionCache.cachedAnchorPoint=ne);let ke,Me,Ne=ne,ze=ne,qe=0,Te=0;const Ze=Math.abs(V),Ke=[];let it;for(;qe+Te<=Ze;){if(ge+=H,ge<w||ge>=P)return null;qe+=Te,ze=Ne,Me=ke;const Ht={absOffsetX:Ze,direction:H,distanceFromAnchor:qe,previousVertex:ze};if(Ne=Pe(ge,D,Ht),h===0)Ke.push(ze),it=Ne.sub(ze);else{let Yt;const jt=Ne.sub(ze);Yt=jt.mag()===0?gt(Pe(ge+H,D,Ht).sub(Ne),h,H):gt(jt,h,H),Me||(Me=ze.add(Yt)),ke=at(ge,Yt,Ne,w,P,Me,h,D,Ht),Ke.push(Me),it=ke.sub(Me)}Te=it.mag()}const bt=it._mult((Ze-qe)/Te)._add(Me||ze),Rt=W+Math.atan2(Ne.y-ze.y,Ne.x-ze.x);return Ke.push(bt),{point:bt,angle:z?Rt:0,path:Ke}}const en=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function an(k,t){for(let h=0;h<k;h++){const _=t.length;t.resize(_+4),t.float32.set(en,3*_)}}function Vn(k,t,h){const _=t[0],y=t[1];return k[0]=h[0]*_+h[4]*y+h[12],k[1]=h[1]*_+h[5]*y+h[13],k[3]=h[3]*_+h[7]*y+h[15],k}const Mn=100;class An{constructor(t,h,_=new Er(t.width+200,t.height+200,25),y=new Er(t.width+200,t.height+200,25)){this.transform=t,this.mapProjection=h,this.grid=_,this.ignoredGrid=y,this.pitchFactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Mn,this.screenBottomBoundary=t.height+Mn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,h,_,y,w,P,D,z,V,H,W){const ne=t.anchorPointX+z[0],ge=t.anchorPointY+z[1],ke=this.projectAndGetPerspectiveRatio(y,ne,ge,w,H),Me=_*ke.perspectiveRatio;let Ne;if(P||D)Ne=this._projectCollisionBox(t,Me,y,w,P,D,z,ke,H,W);else{const Ke=ke.point.x+(W?W.x*Me:0),it=ke.point.y+(W?W.y*Me:0);Ne={allPointsOccluded:!1,box:[Ke+t.x1*Me,it+t.y1*Me,Ke+t.x2*Me,it+t.y2*Me]}}const[ze,qe,Te,Ze]=Ne.box;return this.mapProjection.useSpecialProjectionForSymbols&&(P?Ne.allPointsOccluded:this.mapProjection.isOccluded(ne,ge,w))||ke.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(ze,qe,Te,Ze)||h!=="always"&&this.grid.hitTest(ze,qe,Te,Ze,h,V)?{box:[ze,qe,Te,Ze],placeable:!1,offscreen:!1}:{box:[ze,qe,Te,Ze],placeable:!0,offscreen:this.isOffscreen(ze,qe,Te,Ze)}}placeCollisionCircles(t,h,_,y,w,P,D,z,V,H,W,ne,ge,ke,Me,Ne){const ze=[],qe=new l.P(h.anchorX,h.anchorY),Te=this.getPerspectiveRatio(P,qe.x,qe.y,D,Ne),Ze=(W?w/Te:w*Te)/l.ap,Ke={getElevation:Ne,labelPlaneMatrix:z,lineVertexArray:_,pitchWithMap:W,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:qe,unwrappedTileID:D,width:this.transform.width,height:this.transform.height,translation:Me},it=le(Ze,y,h.lineOffsetX*Ze,h.lineOffsetY*Ze,!1,h,!1,Ke);let bt=!1,Rt=!1,Ht=!0;if(it){const Yt=.5*ge*Te+ke,jt=new l.P(-100,-100),Ut=new l.P(this.screenRightBoundary,this.screenBottomBoundary),rn=new wn,Tn=it.first,qt=it.last;let Xt=[];for(let On=Tn.path.length-1;On>=1;On--)Xt.push(Tn.path[On]);for(let On=1;On<qt.path.length;On++)Xt.push(qt.path[On]);const In=2.5*Yt;if(V){const On=this.projectPathToScreenSpace(Xt,Ke,V);Xt=On.some(jn=>jn.signedDistanceFromCamera<=0)?[]:On.map(jn=>jn.point)}let Si=[];if(Xt.length>0){const On=Xt[0].clone(),jn=Xt[0].clone();for(let Ei=1;Ei<Xt.length;Ei++)On.x=Math.min(On.x,Xt[Ei].x),On.y=Math.min(On.y,Xt[Ei].y),jn.x=Math.max(jn.x,Xt[Ei].x),jn.y=Math.max(jn.y,Xt[Ei].y);Si=On.x>=jt.x&&jn.x<=Ut.x&&On.y>=jt.y&&jn.y<=Ut.y?[Xt]:jn.x<jt.x||On.x>Ut.x||jn.y<jt.y||On.y>Ut.y?[]:l.al([Xt],jt.x,jt.y,Ut.x,Ut.y)}for(const On of Si){rn.reset(On,.25*Yt);let jn=0;jn=rn.length<=.5*Yt?1:Math.ceil(rn.paddedLength/In)+1;for(let Ei=0;Ei<jn;Ei++){const Nr=Ei/Math.max(jn-1,1),Hs=rn.lerp(Nr),Ti=Hs.x+Mn,ss=Hs.y+Mn;ze.push(Ti,ss,Yt,0);const Wr=Ti-Yt,zr=ss-Yt,Xr=Ti+Yt,ho=ss+Yt;if(Ht=Ht&&this.isOffscreen(Wr,zr,Xr,ho),Rt=Rt||this.isInsideGrid(Wr,zr,Xr,ho),t!=="always"&&this.grid.hitTestCircle(Ti,ss,Yt,t,ne)&&(bt=!0,!H))return{circles:[],offscreen:!1,collisionDetected:bt}}}}return{circles:!H&&bt||!Rt||Te<this.perspectiveRatioCutoff?[]:ze,offscreen:Ht,collisionDetected:bt}}projectPathToScreenSpace(t,h,_){return t.map(y=>Ae(y.x,y.y,_,h.getElevation))}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let _=1/0,y=1/0,w=-1/0,P=-1/0;for(const H of t){const W=new l.P(H.x+Mn,H.y+Mn);_=Math.min(_,W.x),y=Math.min(y,W.y),w=Math.max(w,W.x),P=Math.max(P,W.y),h.push(W)}const D=this.grid.query(_,y,w,P).concat(this.ignoredGrid.query(_,y,w,P)),z={},V={};for(const H of D){const W=H.key;if(z[W.bucketInstanceId]===void 0&&(z[W.bucketInstanceId]={}),z[W.bucketInstanceId][W.featureIndex])continue;const ne=[new l.P(H.x1,H.y1),new l.P(H.x2,H.y1),new l.P(H.x2,H.y2),new l.P(H.x1,H.y2)];l.am(h,ne)&&(z[W.bucketInstanceId][W.featureIndex]=!0,V[W.bucketInstanceId]===void 0&&(V[W.bucketInstanceId]=[]),V[W.bucketInstanceId].push(W.featureIndex))}return V}insertCollisionBox(t,h,_,y,w,P){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:w,collisionGroupID:P,overlapMode:h},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,h,_,y,w,P){const D=_?this.ignoredGrid:this.grid,z={bucketInstanceId:y,featureIndex:w,collisionGroupID:P,overlapMode:h};for(let V=0;V<t.length;V+=4)D.insertCircle(z,t[V],t[V+1],t[V+2])}projectAndGetPerspectiveRatio(t,h,_,y,w){let P;w?(P=[h,_,w(h,_),1],l.af(P,P,t)):(P=[h,_,0,1],Vn(P,P,t));const D=P[3];return{point:new l.P((P[0]/D+1)/2*this.transform.width+Mn,(-P[1]/D+1)/2*this.transform.height+Mn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/D*.5,isOccluded:!1,signedDistanceFromCamera:D}}getPerspectiveRatio(t,h,_,y,w){const P=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(h,_,y,w):Ae(h,_,t,w);return .5+this.transform.cameraToCenterDistance/P.signedDistanceFromCamera*.5}isOffscreen(t,h,_,y){return _<Mn||t>=this.screenRightBoundary||y<Mn||h>this.screenBottomBoundary}isInsideGrid(t,h,_,y){return _>=0&&t<this.gridRightBoundary&&y>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const t=l.an([]);return l.J(t,t,[-100,-100,0]),t}_projectCollisionBox(t,h,_,y,w,P,D,z,V,H){let W=new l.P(1,0),ne=new l.P(0,1);const ge=new l.P(t.anchorPointX+D[0],t.anchorPointY+D[1]);if(P&&!w){const Ht=this.projectAndGetPerspectiveRatio(_,ge.x+1,ge.y,y,V).point.sub(z.point).unit(),Yt=Math.atan(Ht.y/Ht.x)+(Ht.x<0?Math.PI:0),jt=Math.sin(Yt),Ut=Math.cos(Yt);W=new l.P(Ut,jt),ne=new l.P(-jt,Ut)}else if(!P&&w){const Ht=-this.transform.angle,Yt=Math.sin(Ht),jt=Math.cos(Ht);W=new l.P(jt,Yt),ne=new l.P(-Yt,jt)}let ke=z.point,Me=h;if(w){ke=ge;const Ht=this.transform.zoom-Math.floor(this.transform.zoom);Me=Math.pow(2,-Ht),Me*=this.mapProjection.getPitchedTextCorrection(this.transform,ge,y),H||(Me*=l.ac(.5+z.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}H&&(ke=ke.add(W.mult(H.x*Me)).add(ne.mult(H.y*Me)));const Ne=t.x1*Me,ze=t.x2*Me,qe=(Ne+ze)/2,Te=t.y1*Me,Ze=t.y2*Me,Ke=(Te+Ze)/2,it=[{offsetX:Ne,offsetY:Te},{offsetX:qe,offsetY:Te},{offsetX:ze,offsetY:Te},{offsetX:ze,offsetY:Ke},{offsetX:ze,offsetY:Ze},{offsetX:qe,offsetY:Ze},{offsetX:Ne,offsetY:Ze},{offsetX:Ne,offsetY:Ke}];let bt=[];for(const{offsetX:Ht,offsetY:Yt}of it)bt.push(new l.P(ke.x+W.x*Ht+ne.x*Yt,ke.y+W.y*Ht+ne.y*Yt));let Rt=!1;if(w){const Ht=bt.map(Yt=>this.projectAndGetPerspectiveRatio(_,Yt.x,Yt.y,y,V));Rt=Ht.some(Yt=>!Yt.isOccluded),bt=Ht.map(Yt=>Yt.point)}else Rt=!0;return{box:l.ao(bt),allPointsOccluded:!Rt}}}function Fn(k,t,h){return t*(l.X/(k.tileSize*Math.pow(2,h-k.tileID.overscaledZ)))}class wi{constructor(t,h,_,y){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?h:-h))):y&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class ui{constructor(t,h,_,y,w){this.text=new wi(t?t.text:null,h,_,w),this.icon=new wi(t?t.icon:null,h,y,w)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Cn{constructor(t,h,_){this.text=t,this.icon=h,this.skipFade=_}}class ii{constructor(){this.invProjMatrix=l.H(),this.viewportMatrix=l.H(),this.circles=[]}}class hi{constructor(t,h,_,y,w){this.bucketInstanceId=t,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=y,this.tileID=w}}class Ai{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const h=++this.maxGroupID;this.collisionGroups[t]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[t]}}function Xn(k,t,h,_,y){const{horizontalAlign:w,verticalAlign:P}=l.au(k);return new l.P(-(w-.5)*t+_[0]*y,-(P-.5)*h+_[1]*y)}class Tr{constructor(t,h,_,y,w,P){this.transform=t.clone(),this.terrain=_,this.collisionIndex=new An(this.transform,h),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=y,this.retainedQueryData={},this.collisionGroups=new Ai(w),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=P,P&&(P.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const h=this.terrain;return h?(_,y)=>h.getElevation(t,_,y):null}getBucketParts(t,h,_,y){const w=_.getBucket(h),P=_.latestFeatureIndex;if(!w||!P||h.id!==w.layerIds[0])return;const D=_.collisionBoxArray,z=w.layers[0].layout,V=w.layers[0].paint,H=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),W=_.tileSize/l.X,ne=_.tileID.toUnwrapped(),ge=this.transform.calculatePosMatrix(ne),ke=z.get("text-pitch-alignment")==="map",Me=z.get("text-rotation-alignment")==="map",Ne=Fn(_,1,this.transform.zoom),ze=this.collisionIndex.mapProjection.translatePosition(this.transform,_,V.get("text-translate"),V.get("text-translate-anchor")),qe=this.collisionIndex.mapProjection.translatePosition(this.transform,_,V.get("icon-translate"),V.get("icon-translate-anchor")),Te=Ki(ge,ke,Me,this.transform,Ne);let Ze=null;if(ke){const it=Zr(ge,ke,Me,this.transform,Ne);Ze=l.L([],this.transform.labelPlaneMatrix,it)}this.retainedQueryData[w.bucketInstanceId]=new hi(w.bucketInstanceId,P,w.sourceLayerIndex,w.index,_.tileID);const Ke={bucket:w,layout:z,translationText:ze,translationIcon:qe,posMatrix:ge,unwrappedTileID:ne,textLabelPlaneMatrix:Te,labelToScreenMatrix:Ze,scale:H,textPixelRatio:W,holdingForFade:_.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:l.ag(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(y)for(const it of w.sortKeyRanges){const{sortKey:bt,symbolInstanceStart:Rt,symbolInstanceEnd:Ht}=it;t.push({sortKey:bt,symbolInstanceStart:Rt,symbolInstanceEnd:Ht,parameters:Ke})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Ke})}attemptAnchorPlacement(t,h,_,y,w,P,D,z,V,H,W,ne,ge,ke,Me,Ne,ze,qe,Te){const Ze=l.aq[t.textAnchor],Ke=[t.textOffset0,t.textOffset1],it=Xn(Ze,_,y,Ke,w),bt=this.collisionIndex.placeCollisionBox(h,ne,z,V,H,D,P,Ne,W.predicate,Te,it);if((!qe||this.collisionIndex.placeCollisionBox(qe,ne,z,V,H,D,P,ze,W.predicate,Te,it).placeable)&&bt.placeable){let Rt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ge.crossTileID]&&this.prevPlacement.placements[ge.crossTileID]&&this.prevPlacement.placements[ge.crossTileID].text&&(Rt=this.prevPlacement.variableOffsets[ge.crossTileID].anchor),ge.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ge.crossTileID]={textOffset:Ke,width:_,height:y,anchor:Ze,textBoxScale:w,prevAnchor:Rt},this.markUsedJustification(ke,Ze,ge,Me),ke.allowVerticalPlacement&&(this.markUsedOrientation(ke,Me,ge),this.placedOrientations[ge.crossTileID]=Me),{shift:it,placedGlyphBoxes:bt}}}placeLayerBucketPart(t,h,_){const{bucket:y,layout:w,translationText:P,translationIcon:D,posMatrix:z,unwrappedTileID:V,textLabelPlaneMatrix:H,labelToScreenMatrix:W,textPixelRatio:ne,holdingForFade:ge,collisionBoxArray:ke,partiallyEvaluatedTextSize:Me,collisionGroup:Ne}=t.parameters,ze=w.get("text-optional"),qe=w.get("icon-optional"),Te=l.ar(w,"text-overlap","text-allow-overlap"),Ze=Te==="always",Ke=l.ar(w,"icon-overlap","icon-allow-overlap"),it=Ke==="always",bt=w.get("text-rotation-alignment")==="map",Rt=w.get("text-pitch-alignment")==="map",Ht=w.get("icon-text-fit")!=="none",Yt=w.get("symbol-z-order")==="viewport-y",jt=Ze&&(it||!y.hasIconData()||qe),Ut=it&&(Ze||!y.hasTextData()||ze);!y.collisionArrays&&ke&&y.deserializeCollisionBoxes(ke);const rn=this._getTerrainElevationFunc(this.retainedQueryData[y.bucketInstanceId].tileID),Tn=(qt,Xt,In)=>{var Si,On;if(h[qt.crossTileID])return;if(ge)return void(this.placements[qt.crossTileID]=new Cn(!1,!1,!1));let jn=!1,Ei=!1,Nr=!0,Hs=null,Ti={box:null,placeable:!1,offscreen:null},ss={box:null,placeable:!1,offscreen:null},Wr=null,zr=null,Xr=null,ho=0,tl=0,Iu=0;Xt.textFeatureIndex?ho=Xt.textFeatureIndex:qt.useRuntimeCollisionCircles&&(ho=qt.featureIndex),Xt.verticalTextFeatureIndex&&(tl=Xt.verticalTextFeatureIndex);const nl=Xt.textBox;if(nl){const Os=Pr=>{let Or=l.ah.horizontal;if(y.allowVerticalPlacement&&!Pr&&this.prevPlacement){const Ss=this.prevPlacement.placedOrientations[qt.crossTileID];Ss&&(this.placedOrientations[qt.crossTileID]=Ss,Or=Ss,this.markUsedOrientation(y,Or,qt))}return Or},Fs=(Pr,Or)=>{if(y.allowVerticalPlacement&&qt.numVerticalGlyphVertices>0&&Xt.verticalTextBox){for(const Ss of y.writingModes)if(Ss===l.ah.vertical?(Ti=Or(),ss=Ti):Ti=Pr(),Ti&&Ti.placeable)break}else Ti=Pr()},Qo=qt.textAnchorOffsetStartIndex,Ws=qt.textAnchorOffsetEndIndex;if(Ws===Qo){const Pr=(Or,Ss)=>{const Gn=this.collisionIndex.placeCollisionBox(Or,Te,ne,z,V,Rt,bt,P,Ne.predicate,rn);return Gn&&Gn.placeable&&(this.markUsedOrientation(y,Ss,qt),this.placedOrientations[qt.crossTileID]=Ss),Gn};Fs(()=>Pr(nl,l.ah.horizontal),()=>{const Or=Xt.verticalTextBox;return y.allowVerticalPlacement&&qt.numVerticalGlyphVertices>0&&Or?Pr(Or,l.ah.vertical):{box:null,offscreen:null}}),Os(Ti&&Ti.placeable)}else{let Pr=l.aq[(On=(Si=this.prevPlacement)===null||Si===void 0?void 0:Si.variableOffsets[qt.crossTileID])===null||On===void 0?void 0:On.anchor];const Or=(Gn,Ia,il)=>{const rl=Gn.x2-Gn.x1,Hh=Gn.y2-Gn.y1,dd=qt.textBoxScale,Wh=Ht&&Ke==="never"?Ia:null;let ea=null,Xh=Te==="never"?1:2,Eu="never";Pr&&Xh++;for(let Gl=0;Gl<Xh;Gl++){for(let Tu=Qo;Tu<Ws;Tu++){const Cu=y.textAnchorOffsets.get(Tu);if(Pr&&Cu.textAnchor!==Pr)continue;const sl=this.attemptAnchorPlacement(Cu,Gn,rl,Hh,dd,bt,Rt,ne,z,V,Ne,Eu,qt,y,il,P,D,Wh,rn);if(sl&&(ea=sl.placedGlyphBoxes,ea&&ea.placeable))return jn=!0,Hs=sl.shift,ea}Pr?Pr=null:Eu=Te}return _&&!ea&&(ea={box:this.collisionIndex.placeCollisionBox(nl,"always",ne,z,V,Rt,bt,P,Ne.predicate,rn,new l.P(0,0)).box,offscreen:!1,placeable:!1}),ea};Fs(()=>Or(nl,Xt.iconBox,l.ah.horizontal),()=>{const Gn=Xt.verticalTextBox;return y.allowVerticalPlacement&&(!Ti||!Ti.placeable)&&qt.numVerticalGlyphVertices>0&&Gn?Or(Gn,Xt.verticalIconBox,l.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Ti&&(jn=Ti.placeable,Nr=Ti.offscreen);const Ss=Os(Ti&&Ti.placeable);if(!jn&&this.prevPlacement){const Gn=this.prevPlacement.variableOffsets[qt.crossTileID];Gn&&(this.variableOffsets[qt.crossTileID]=Gn,this.markUsedJustification(y,Gn.anchor,qt,Ss))}}}if(Wr=Ti,jn=Wr&&Wr.placeable,Nr=Wr&&Wr.offscreen,qt.useRuntimeCollisionCircles){const Os=y.text.placedSymbolArray.get(qt.centerJustifiedTextSymbolIndex),Fs=l.ai(y.textSizeData,Me,Os),Qo=w.get("text-padding");zr=this.collisionIndex.placeCollisionCircles(Te,Os,y.lineVertexArray,y.glyphOffsetArray,Fs,z,V,H,W,_,Rt,Ne.predicate,qt.collisionCircleDiameter,Qo,P,rn),zr.circles.length&&zr.collisionDetected&&!_&&l.w("Collisions detected, but collision boxes are not shown"),jn=Ze||zr.circles.length>0&&!zr.collisionDetected,Nr=Nr&&zr.offscreen}if(Xt.iconFeatureIndex&&(Iu=Xt.iconFeatureIndex),Xt.iconBox){const Os=Fs=>this.collisionIndex.placeCollisionBox(Fs,Ke,ne,z,V,Rt,bt,D,Ne.predicate,rn,Ht&&Hs?Hs:void 0);ss&&ss.placeable&&Xt.verticalIconBox?(Xr=Os(Xt.verticalIconBox),Ei=Xr.placeable):(Xr=Os(Xt.iconBox),Ei=Xr.placeable),Nr=Nr&&Xr.offscreen}const zs=ze||qt.numHorizontalGlyphVertices===0&&qt.numVerticalGlyphVertices===0,Su=qe||qt.numIconVertices===0;zs||Su?Su?zs||(Ei=Ei&&jn):jn=Ei&&jn:Ei=jn=Ei&&jn;const qc=Ei&&Xr.placeable;if(jn&&Wr.placeable&&this.collisionIndex.insertCollisionBox(Wr.box,Te,w.get("text-ignore-placement"),y.bucketInstanceId,ss&&ss.placeable&&tl?tl:ho,Ne.ID),qc&&this.collisionIndex.insertCollisionBox(Xr.box,Ke,w.get("icon-ignore-placement"),y.bucketInstanceId,Iu,Ne.ID),zr&&jn&&this.collisionIndex.insertCollisionCircles(zr.circles,Te,w.get("text-ignore-placement"),y.bucketInstanceId,ho,Ne.ID),_&&this.storeCollisionData(y.bucketInstanceId,In,Xt,Wr,Xr,zr),qt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(y.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[qt.crossTileID]=new Cn(jn||jt,Ei||Ut,Nr||y.justReloaded),h[qt.crossTileID]=!0};if(Yt){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const qt=y.getSortedSymbolIndexes(this.transform.angle);for(let Xt=qt.length-1;Xt>=0;--Xt){const In=qt[Xt];Tn(y.symbolInstances.get(In),y.collisionArrays[In],In)}}else for(let qt=t.symbolInstanceStart;qt<t.symbolInstanceEnd;qt++)Tn(y.symbolInstances.get(qt),y.collisionArrays[qt],qt);if(_&&y.bucketInstanceId in this.collisionCircleArrays){const qt=this.collisionCircleArrays[y.bucketInstanceId];l.as(qt.invProjMatrix,z),qt.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}storeCollisionData(t,h,_,y,w,P){if(_.textBox||_.iconBox){let D,z;this.collisionBoxArrays.has(t)?D=this.collisionBoxArrays.get(t):(D=new Map,this.collisionBoxArrays.set(t,D)),D.has(h)?z=D.get(h):(z={text:null,icon:null},D.set(h,z)),_.textBox&&(z.text=y.box),_.iconBox&&(z.icon=w.box)}if(P){let D=this.collisionCircleArrays[t];D===void 0&&(D=this.collisionCircleArrays[t]=new ii);for(let z=0;z<P.circles.length;z+=4)D.circles.push(P.circles[z+0]),D.circles.push(P.circles[z+1]),D.circles.push(P.circles[z+2]),D.circles.push(P.collisionDetected?1:0)}}markUsedJustification(t,h,_,y){let w;w=y===l.ah.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[l.at(h)];const P=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const D of P)D>=0&&(t.text.placedSymbolArray.get(D).crossTileID=w>=0&&D!==w?0:_.crossTileID)}markUsedOrientation(t,h,_){const y=h===l.ah.horizontal||h===l.ah.horizontalOnly?h:0,w=h===l.ah.vertical?h:0,P=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const D of P)t.text.placedSymbolArray.get(D).placedOrientation=y;_.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const y=h?h.symbolFadeChange(t):1,w=h?h.opacities:{},P=h?h.variableOffsets:{},D=h?h.placedOrientations:{};for(const z in this.placements){const V=this.placements[z],H=w[z];H?(this.opacities[z]=new ui(H,y,V.text,V.icon),_=_||V.text!==H.text.placed||V.icon!==H.icon.placed):(this.opacities[z]=new ui(null,y,V.text,V.icon,V.skipFade),_=_||V.text||V.icon)}for(const z in w){const V=w[z];if(!this.opacities[z]){const H=new ui(V,y,!1,!1);H.isHidden()||(this.opacities[z]=H,_=_||V.text.placed||V.icon.placed)}}for(const z in P)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=P[z]);for(const z in D)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=D[z]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:t)}updateLayerOpacities(t,h){const _={};for(const y of h){const w=y.getBucket(t);w&&y.latestFeatureIndex&&t.id===w.layerIds[0]&&this.updateBucketOpacities(w,y.tileID,_,y.collisionBoxArray)}}updateBucketOpacities(t,h,_,y){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const w=t.layers[0],P=w.layout,D=new ui(null,0,!1,!1,!0),z=P.get("text-allow-overlap"),V=P.get("icon-allow-overlap"),H=w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"),W=P.get("text-rotation-alignment")==="map",ne=P.get("text-pitch-alignment")==="map",ge=P.get("icon-text-fit")!=="none",ke=new ui(null,0,z&&(V||!t.hasIconData()||P.get("icon-optional")),V&&(z||!t.hasTextData()||P.get("text-optional")),!0);!t.collisionArrays&&y&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(y);const Me=(ze,qe,Te)=>{for(let Ze=0;Ze<qe/4;Ze++)ze.opacityVertexArray.emplaceBack(Te);ze.hasVisibleVertices=ze.hasVisibleVertices||Te!==no},Ne=this.collisionBoxArrays.get(t.bucketInstanceId);for(let ze=0;ze<t.symbolInstances.length;ze++){const qe=t.symbolInstances.get(ze),{numHorizontalGlyphVertices:Te,numVerticalGlyphVertices:Ze,crossTileID:Ke}=qe;let it=this.opacities[Ke];_[Ke]?it=D:it||(it=ke,this.opacities[Ke]=it),_[Ke]=!0;const bt=qe.numIconVertices>0,Rt=this.placedOrientations[qe.crossTileID],Ht=Rt===l.ah.vertical,Yt=Rt===l.ah.horizontal||Rt===l.ah.horizontalOnly;if(Te>0||Ze>0){const Ut=or(it.text);Me(t.text,Te,Ht?no:Ut),Me(t.text,Ze,Yt?no:Ut);const rn=it.text.isHidden();[qe.rightJustifiedTextSymbolIndex,qe.centerJustifiedTextSymbolIndex,qe.leftJustifiedTextSymbolIndex].forEach(Xt=>{Xt>=0&&(t.text.placedSymbolArray.get(Xt).hidden=rn||Ht?1:0)}),qe.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(qe.verticalPlacedTextSymbolIndex).hidden=rn||Yt?1:0);const Tn=this.variableOffsets[qe.crossTileID];Tn&&this.markUsedJustification(t,Tn.anchor,qe,Rt);const qt=this.placedOrientations[qe.crossTileID];qt&&(this.markUsedJustification(t,"left",qe,qt),this.markUsedOrientation(t,qt,qe))}if(bt){const Ut=or(it.icon),rn=!(ge&&qe.verticalPlacedIconSymbolIndex&&Ht);qe.placedIconSymbolIndex>=0&&(Me(t.icon,qe.numIconVertices,rn?Ut:no),t.icon.placedSymbolArray.get(qe.placedIconSymbolIndex).hidden=it.icon.isHidden()),qe.verticalPlacedIconSymbolIndex>=0&&(Me(t.icon,qe.numVerticalIconVertices,rn?no:Ut),t.icon.placedSymbolArray.get(qe.verticalPlacedIconSymbolIndex).hidden=it.icon.isHidden())}const jt=Ne&&Ne.has(ze)?Ne.get(ze):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ut=t.collisionArrays[ze];if(Ut){let rn=new l.P(0,0);if(Ut.textBox||Ut.verticalTextBox){let Tn=!0;if(H){const qt=this.variableOffsets[Ke];qt?(rn=Xn(qt.anchor,qt.width,qt.height,qt.textOffset,qt.textBoxScale),W&&rn._rotate(ne?this.transform.angle:-this.transform.angle)):Tn=!1}if(Ut.textBox||Ut.verticalTextBox){let qt;Ut.textBox&&(qt=Ht),Ut.verticalTextBox&&(qt=Yt),No(t.textCollisionBox.collisionVertexArray,it.text.placed,!Tn||qt,jt.text,rn.x,rn.y)}}if(Ut.iconBox||Ut.verticalIconBox){const Tn=!!(!Yt&&Ut.verticalIconBox);let qt;Ut.iconBox&&(qt=Tn),Ut.verticalIconBox&&(qt=!Tn),No(t.iconCollisionBox.collisionVertexArray,it.icon.placed,qt,jt.icon,ge?rn.x:0,ge?rn.y:0)}}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const ze=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ze.invProjMatrix,t.placementViewportMatrix=ze.viewportMatrix,t.collisionCircleArray=ze.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>t}setStale(){this.stale=!0}}function No(k,t,h,_,y,w){_&&_.length!==0||(_=[0,0,0,0]);const P=_[0]-Mn,D=_[1]-Mn,z=_[2]-Mn,V=_[3]-Mn;k.emplaceBack(t?1:0,h?1:0,y||0,w||0,P,D),k.emplaceBack(t?1:0,h?1:0,y||0,w||0,z,D),k.emplaceBack(t?1:0,h?1:0,y||0,w||0,z,V),k.emplaceBack(t?1:0,h?1:0,y||0,w||0,P,V)}const Qn=Math.pow(2,25),bo=Math.pow(2,24),aa=Math.pow(2,17),Cr=Math.pow(2,16),Dr=Math.pow(2,9),yc=Math.pow(2,8),Pi=Math.pow(2,1);function or(k){if(k.opacity===0&&!k.placed)return 0;if(k.opacity===1&&k.placed)return 4294967295;const t=k.placed?1:0,h=Math.floor(127*k.opacity);return h*Qn+t*bo+h*aa+t*Cr+h*Dr+t*yc+h*Pi+t}const no=0;function Kr(){return{isOccluded:(k,t,h)=>!1,getPitchedTextCorrection:(k,t,h)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(k,t,h,_){throw new Error("Not implemented.")},translatePosition:(k,t,h,_)=>function(y,w,P,D,z=!1){if(!P[0]&&!P[1])return[0,0];const V=z?D==="map"?y.angle:0:D==="viewport"?-y.angle:0;if(V){const H=Math.sin(V),W=Math.cos(V);P=[P[0]*W-P[1]*H,P[0]*H+P[1]*W]}return[z?P[0]:Fn(w,P[0],y.zoom),z?P[1]:Fn(w,P[1],y.zoom)]}(k,t,h,_),getCircleRadiusCorrection:k=>1}}class Ri{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,h,_,y,w){const P=this._bucketParts;for(;this._currentTileIndex<t.length;)if(h.getBucketParts(P,y,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((D,z)=>D.sortKey-z.sortKey));this._currentPartIndex<P.length;)if(h.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,w())return!0;return!1}}class la{constructor(t,h,_,y,w,P,D,z){this.placement=new Tr(t,Kr(),h,P,D,z),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(t,h,_){const y=L.now(),w=()=>!this._forceFullPlacement&&L.now()-y>2;for(;this._currentPlacementIndex>=0;){const P=h[t[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=D)&&(!P.maxzoom||P.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new Ri(P)),this._inProgressLayer.continuePlacement(_[P.source],this.placement,this._showCollisionBoxes,P,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const _s=512/l.X/2;class Fi{constructor(t,h,_){this.tileID=t,this.bucketInstanceId=_,this._symbolsByKey={};const y=new Map;for(let w=0;w<h.length;w++){const P=h.get(w),D=P.key,z=y.get(D);z?z.push(P):y.set(D,[P])}for(const[w,P]of y){const D={positions:P.map(z=>({x:Math.floor(z.anchorX*_s),y:Math.floor(z.anchorY*_s)})),crossTileIDs:P.map(z=>z.crossTileID)};if(D.positions.length>128){const z=new l.av(D.positions.length,16,Uint16Array);for(const{x:V,y:H}of D.positions)z.add(V,H);z.finish(),delete D.positions,D.index=z}this._symbolsByKey[w]=D}}getScaledCoordinates(t,h){const{x:_,y,z:w}=this.tileID.canonical,{x:P,y:D,z}=h.canonical,V=_s/Math.pow(2,z-w),H=(D*l.X+t.anchorY)*V,W=y*l.X*_s;return{x:Math.floor((P*l.X+t.anchorX)*V-_*l.X*_s),y:Math.floor(H-W)}}findMatches(t,h,_){const y=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let w=0;w<t.length;w++){const P=t.get(w);if(P.crossTileID)continue;const D=this._symbolsByKey[P.key];if(!D)continue;const z=this.getScaledCoordinates(P,h);if(D.index){const V=D.index.range(z.x-y,z.y-y,z.x+y,z.y+y).sort();for(const H of V){const W=D.crossTileIDs[H];if(!_[W]){_[W]=!0,P.crossTileID=W;break}}}else if(D.positions)for(let V=0;V<D.positions.length;V++){const H=D.positions[V],W=D.crossTileIDs[V];if(Math.abs(H.x-z.x)<=y&&Math.abs(H.y-z.y)<=y&&!_[W]){_[W]=!0,P.crossTileID=W;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class ua{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Qr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const h=Math.round((t-this.lng)/360);if(h!==0)for(const _ in this.indexes){const y=this.indexes[_],w={};for(const P in y){const D=y[P];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+h),w[D.tileID.key]=D}this.indexes[_]=w}this.lng=t}addBucket(t,h,_){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let w=0;w<h.symbolInstances.length;w++)h.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const y=this.usedCrossTileIDs[t.overscaledZ];for(const w in this.indexes){const P=this.indexes[w];if(Number(w)>t.overscaledZ)for(const D in P){const z=P[D];z.tileID.isChildOf(t)&&z.findMatches(h.symbolInstances,t,y)}else{const D=P[t.scaledTo(Number(w)).key];D&&D.findMatches(h.symbolInstances,t,y)}}for(let w=0;w<h.symbolInstances.length;w++){const P=h.symbolInstances.get(w);P.crossTileID||(P.crossTileID=_.generate(),y[P.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Fi(t,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(t,h){for(const _ of h.getCrossTileIDsLists())for(const y of _)delete this.usedCrossTileIDs[t][y]}removeStaleBuckets(t){let h=!1;for(const _ in this.indexes){const y=this.indexes[_];for(const w in y)t[y[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,y[w]),delete y[w],h=!0)}return h}}class zo{constructor(){this.layerIndexes={},this.crossTileIDs=new ua,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,h,_){let y=this.layerIndexes[t.id];y===void 0&&(y=this.layerIndexes[t.id]=new Qr);let w=!1;const P={};y.handleWrapJump(_);for(const D of h){const z=D.getBucket(t);z&&t.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(D.tileID,z,this.crossTileIDs)&&(w=!0),P[z.bucketInstanceId]=!0)}return y.removeStaleBuckets(P)&&(w=!0),w}pruneUnusedLayers(t){const h={};t.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}const Qi=(k,t)=>l.t(k,t&&t.filter(h=>h.identifier!=="source.canvas")),io=l.aw();class ca extends l.E{constructor(t,h={}){super(),this._rtlPluginLoaded=()=>{for(const _ in this.sourceCaches){const y=this.sourceCaches[_].getSource().type;y!=="vector"&&y!=="geojson"||this.sourceCaches[_].reload()}},this.map=t,this.dispatcher=new dn(Wn(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(_,y)=>this.getGlyphs(_,y)),this.dispatcher.registerMessageHandler("GI",(_,y)=>this.getImages(_,y)),this.imageManager=new Ue,this.imageManager.setEventedParent(this),this.glyphManager=new dt(t._requestManager,h.localIdeographFontFamily),this.lineAtlas=new xt(256,512),this.crossTileSymbolIndex=new zo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.ay()),mn().on(ct,this._rtlPluginLoaded),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const y=this.sourceCaches[_.sourceId];if(!y)return;const w=y.getSource();if(w&&w.vectorLayerIds)for(const P in this._layers){const D=this._layers[P];D.source===w.id&&this._validateLayer(D)}})}loadURL(t,h={},_){this.fire(new l.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const y=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const w=this._loadStyleRequest;l.h(y,this._loadStyleRequest).then(P=>{this._loadStyleRequest=null,this._load(P.data,h,_)}).catch(P=>{this._loadStyleRequest=null,P&&!w.signal.aborted&&this.fire(new l.j(P))})}loadJSON(t,h={},_){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,L.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(t,h,_)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(io,{validate:!1})}_load(t,h,_){var y;const w=h.transformStyle?h.transformStyle(_,t):t;if(!h.validate||!Qi(this,l.u(w))){this._loaded=!0,this.stylesheet=w;for(const P in w.sources)this.addSource(P,w.sources[P],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new vt(this.stylesheet.light),this.sky=new ft(this.stylesheet.sky),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const t=l.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of t){const _=l.aA(h);_.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=_}}_loadSprite(t,h=!1,_=void 0){let y;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(w,P,D,z){return l._(this,void 0,void 0,function*(){const V=be(w),H=D>1?"@2x":"",W={},ne={};for(const{id:ge,url:ke}of V){const Me=P.transformRequest(Le(ke,H,".json"),"SpriteJSON");W[ge]=l.h(Me,z);const Ne=P.transformRequest(Le(ke,H,".png"),"SpriteImage");ne[ge]=$.getImage(Ne,z)}return yield Promise.all([...Object.values(W),...Object.values(ne)]),function(ge,ke){return l._(this,void 0,void 0,function*(){const Me={};for(const Ne in ge){Me[Ne]={};const ze=L.getImageCanvasContext((yield ke[Ne]).data),qe=(yield ge[Ne]).data;for(const Te in qe){const{width:Ze,height:Ke,x:it,y:bt,sdf:Rt,pixelRatio:Ht,stretchX:Yt,stretchY:jt,content:Ut,textFitWidth:rn,textFitHeight:Tn}=qe[Te];Me[Ne][Te]={data:null,pixelRatio:Ht,sdf:Rt,stretchX:Yt,stretchY:jt,content:Ut,textFitWidth:rn,textFitHeight:Tn,spriteData:{width:Ze,height:Ke,x:it,y:bt,context:ze}}}}return Me})}(W,ne)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(w=>{if(this._spriteRequest=null,w)for(const P in w){this._spritesImagesIds[P]=[];const D=this._spritesImagesIds[P]?this._spritesImagesIds[P].filter(z=>!(z in w)):[];for(const z of D)this.imageManager.removeImage(z),this._changedImages[z]=!0;for(const z in w[P]){const V=P==="default"?z:`${P}:${z}`;this._spritesImagesIds[P].push(V),V in this.imageManager.images?this.imageManager.updateImage(V,w[P][z],!1):this.imageManager.addImage(V,w[P][z]),h&&(this._changedImages[V]=!0)}}}).catch(w=>{this._spriteRequest=null,y=w,this.fire(new l.j(y))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),_&&_(y)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(t){const h=this.sourceCaches[t.source];if(!h)return;const _=t.sourceLayer;if(!_)return;const y=h.getSource();(y.type==="geojson"||y.vectorLayerIds&&y.vectorLayerIds.indexOf(_)===-1)&&this.fire(new l.j(new Error(`Source layer "${_}" does not exist on source "${y.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,h=!1){const _=this._serializedAllLayers();if(!t||t.length===0)return Object.values(h?l.aB(_):_);const y=[];for(const w of t)if(_[w]){const P=h?l.aB(_[w]):_[w];y.push(P)}return y}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const h=Object.keys(this._layers);for(const _ of h){const y=this._layers[_];y.type!=="custom"&&(t[_]=y.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const h=this._changed;if(h){const y=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(y.length||w.length)&&this._updateWorkerLayers(y,w);for(const P in this._updatedSources){const D=this._updatedSources[P];if(D==="reload")this._reloadSource(P);else{if(D!=="clear")throw new Error(`Invalid action ${D}`);this._clearSource(P)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const P in this._updatedPaintProps)this._layers[P].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const _={};for(const y in this.sourceCaches){const w=this.sourceCaches[y];_[y]=w.used,w.used=!1}for(const y of this._order){const w=this._layers[y];w.recalculate(t,this._availableImages),!w.isHidden(t.zoom)&&w.source&&(this.sourceCaches[w.source].used=!0)}for(const y in _){const w=this.sourceCaches[y];!!_[y]!=!!w.used&&w.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:y}))}this.light.recalculate(t),this.sky.recalculate(t),this.z=t.zoom,h&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,h={}){var _;this._checkLoaded();const y=this.serialize();if(t=h.transformStyle?h.transformStyle(y,t):t,((_=h.validate)===null||_===void 0||_)&&Qi(this,l.u(t)))return!1;(t=l.aB(t)).layers=l.az(t.layers);const w=l.aC(y,t),P=this._getOperationsToPerform(w);if(P.unimplemented.length>0)throw new Error(`Unimplemented: ${P.unimplemented.join(", ")}.`);if(P.operations.length===0)return!1;for(const D of P.operations)D();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const h=[],_=[];for(const y of t)switch(y.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,y.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,y.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,y.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,y.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,y.args));break;case"addSource":h.push(()=>this.addSource.apply(this,y.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,y.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,y.args));break;case"setLight":h.push(()=>this.setLight.apply(this,y.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,y.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,y.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,y.args));break;case"setSky":h.push(()=>this.setSky.apply(this,y.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,y.args));break;case"setTransition":h.push(()=>{});break;default:_.push(y.command)}return{operations:h,unimplemented:_}}addImage(t,h){if(this.getImage(t))return this.fire(new l.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,h),this._afterImageUpdated(t)}updateImage(t,h){this.imageManager.updateImage(t,h)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new l.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,h,_={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(l.u.source,`sources.${t}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const y=this.sourceCaches[t]=new Tt(t,h,this.dispatcher);y.style=this,y.setEventedParent(this,()=>({isSourceLoaded:y.loaded(),source:y.serialize(),sourceId:t})),y.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===t)return this.fire(new l.j(new Error(`Source "${t}" cannot be removed while layer "${_}" is using it.`)));const h=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],h.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,h){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const _=this.sourceCaches[t].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(h),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,h,_={}){this._checkLoaded();const y=t.id;if(this.getLayer(y))return void this.fire(new l.j(new Error(`Layer "${y}" already exists on this map.`)));let w;if(t.type==="custom"){if(Qi(this,l.aD(t)))return;w=l.aA(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(y,t.source),t=l.aB(t),t=l.e(t,{source:y})),this._validate(l.u.layer,`layers.${y}`,t,{arrayIndex:-1},_))return;w=l.aA(t),this._validateLayer(w),w.setEventedParent(this,{layer:{id:y}})}const P=h?this._order.indexOf(h):this._order.length;if(h&&P===-1)this.fire(new l.j(new Error(`Cannot add layer "${y}" before non-existing layer "${h}".`)));else{if(this._order.splice(P,0,y),this._layerOrderChanged=!0,this._layers[y]=w,this._removedLayers[y]&&w.source&&w.type!=="custom"){const D=this._removedLayers[y];delete this._removedLayers[y],D.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",this.sourceCaches[w.source].pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map)}}moveLayer(t,h){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new l.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===h)return;const _=this._order.indexOf(t);this._order.splice(_,1);const y=h?this._order.indexOf(h):this._order.length;h&&y===-1?this.fire(new l.j(new Error(`Cannot move layer "${t}" before non-existing layer "${h}".`))):(this._order.splice(y,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const h=this._layers[t];if(!h)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${t}".`)));h.setEventedParent(null);const _=this._order.indexOf(t);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=h,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],h.onRemove&&h.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,h,_){this._checkLoaded();const y=this.getLayer(t);y?y.minzoom===h&&y.maxzoom===_||(h!=null&&(y.minzoom=h),_!=null&&(y.maxzoom=_),this._updateLayer(y)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,h,_={}){this._checkLoaded();const y=this.getLayer(t);if(y){if(!l.aE(y.filter,h))return h==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(l.u.filter,`layers.${y.id}.filter`,h,null,_)||(y.filter=l.aB(h),this._updateLayer(y)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return l.aB(this.getLayer(t).filter)}setLayoutProperty(t,h,_,y={}){this._checkLoaded();const w=this.getLayer(t);w?l.aE(w.getLayoutProperty(h),_)||(w.setLayoutProperty(h,_,y),this._updateLayer(w)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,h){const _=this.getLayer(t);if(_)return _.getLayoutProperty(h);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,h,_,y={}){this._checkLoaded();const w=this.getLayer(t);w?l.aE(w.getPaintProperty(h),_)||(w.setPaintProperty(h,_,y)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new l.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,h){return this.getLayer(t).getPaintProperty(h)}setFeatureState(t,h){this._checkLoaded();const _=t.source,y=t.sourceLayer,w=this.sourceCaches[_];if(w===void 0)return void this.fire(new l.j(new Error(`The source '${_}' does not exist in the map's style.`)));const P=w.getSource().type;P==="geojson"&&y?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):P!=="vector"||y?(t.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),w.setFeatureState(y,t.id,h)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,h){this._checkLoaded();const _=t.source,y=this.sourceCaches[_];if(y===void 0)return void this.fire(new l.j(new Error(`The source '${_}' does not exist in the map's style.`)));const w=y.getSource().type,P=w==="vector"?t.sourceLayer:void 0;w!=="vector"||P?h&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):y.removeFeatureState(P,t.id,h):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const h=t.source,_=t.sourceLayer,y=this.sourceCaches[h];if(y!==void 0)return y.getSource().type!=="vector"||_?(t.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),y.getFeatureState(_,t.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=l.aF(this.sourceCaches,w=>w.serialize()),h=this._serializeByIds(this._order,!0),_=this.map.getTerrain()||void 0,y=this.stylesheet;return l.aG({version:y.version,name:y.name,metadata:y.metadata,light:y.light,sky:y.sky,center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch,sprite:y.sprite,glyphs:y.glyphs,transition:y.transition,sources:t,layers:h,terrain:_},w=>w!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const h=P=>this._layers[P].type==="fill-extrusion",_={},y=[];for(let P=this._order.length-1;P>=0;P--){const D=this._order[P];if(h(D)){_[D]=P;for(const z of t){const V=z[D];if(V)for(const H of V)y.push(H)}}}y.sort((P,D)=>D.intersectionZ-P.intersectionZ);const w=[];for(let P=this._order.length-1;P>=0;P--){const D=this._order[P];if(h(D))for(let z=y.length-1;z>=0;z--){const V=y[z].feature;if(_[V.layer.id]<P)break;w.push(V),y.pop()}else for(const z of t){const V=z[D];if(V)for(const H of V)w.push(H.feature)}}return w}queryRenderedFeatures(t,h,_){h&&h.filter&&this._validate(l.u.filter,"queryRenderedFeatures.filter",h.filter,null,h);const y={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const D of h.layers){const z=this._layers[D];if(!z)return this.fire(new l.j(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];y[z.source]=!0}}const w=[];h.availableImages=this._availableImages;const P=this._serializedAllLayers();for(const D in this.sourceCaches)h.layers&&!y[D]||w.push(lt(this.sourceCaches[D],this._layers,P,t,h,_));return this.placement&&w.push(function(D,z,V,H,W,ne,ge){const ke={},Me=ne.queryRenderedSymbols(H),Ne=[];for(const ze of Object.keys(Me).map(Number))Ne.push(ge[ze]);Ne.sort(Je);for(const ze of Ne){const qe=ze.featureIndex.lookupSymbolFeatures(Me[ze.bucketInstanceId],z,ze.bucketIndex,ze.sourceLayerIndex,W.filter,W.layers,W.availableImages,D);for(const Te in qe){const Ze=ke[Te]=ke[Te]||[],Ke=qe[Te];Ke.sort((it,bt)=>{const Rt=ze.featureSortOrder;if(Rt){const Ht=Rt.indexOf(it.featureIndex);return Rt.indexOf(bt.featureIndex)-Ht}return bt.featureIndex-it.featureIndex});for(const it of Ke)Ze.push(it)}}for(const ze in ke)ke[ze].forEach(qe=>{const Te=qe.feature,Ze=V[D[ze].source].getFeatureState(Te.layer["source-layer"],Te.id);Te.source=Te.layer.source,Te.layer["source-layer"]&&(Te.sourceLayer=Te.layer["source-layer"]),Te.state=Ze});return ke}(this._layers,P,this.sourceCaches,t,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(t,h){h&&h.filter&&this._validate(l.u.filter,"querySourceFeatures.filter",h.filter,null,h);const _=this.sourceCaches[t];return _?function(y,w){const P=y.getRenderableIds().map(V=>y.getTileByID(V)),D=[],z={};for(let V=0;V<P.length;V++){const H=P[V],W=H.tileID.canonical.key;z[W]||(z[W]=!0,H.querySourceFeatures(D,w))}return D}(_,h):[]}getLight(){return this.light.getLight()}setLight(t,h={}){this._checkLoaded();const _=this.light.getLight();let y=!1;for(const P in t)if(!l.aE(t[P],_[P])){y=!0;break}if(!y)return;const w={now:L.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,h),this.light.updateTransitions(w)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,h={}){const _=this.getSky();let y=!1;if(!t&&!_)return;if(t&&!_)y=!0;else if(!t&&_)y=!0;else for(const P in t)if(!l.aE(t[P],_[P])){y=!0;break}if(!y)return;const w={now:L.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,h),this.sky.updateTransitions(w)}_validate(t,h,_,y,w={}){return(!w||w.validate!==!1)&&Qi(this,t.call(l.u,l.e({key:h,style:this.serialize(),value:_,styleSpec:l.v},y)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),mn().off(ct,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const _=this.sourceCaches[h];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const h in this.sourceCaches)this.sourceCaches[h].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,h,_,y,w=!1){let P=!1,D=!1;const z={};for(const V of this._order){const H=this._layers[V];if(H.type!=="symbol")continue;if(!z[H.source]){const ne=this.sourceCaches[H.source];z[H.source]=ne.getRenderableIds(!0).map(ge=>ne.getTileByID(ge)).sort((ge,ke)=>ke.tileID.overscaledZ-ge.tileID.overscaledZ||(ge.tileID.isLessThan(ke.tileID)?-1:1))}const W=this.crossTileSymbolIndex.addLayer(H,z[H.source],t.center.lng);P=P||W}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((w=w||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(L.now(),t.zoom))&&(this.pauseablePlacement=new la(t,this.map.terrain,this._order,w,h,_,y,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(L.now()),D=!0),P&&this.pauseablePlacement.placement.setStale()),D||P)for(const V of this._order){const H=this._layers[V];H.type==="symbol"&&this.placement.updateLayerOpacities(H,z[H.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(L.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,h){return l._(this,void 0,void 0,function*(){const _=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const y=this.sourceCaches[h.source];return y&&y.setDependencies(h.tileID.key,h.type,h.icons),_})}getGlyphs(t,h){return l._(this,void 0,void 0,function*(){const _=yield this.glyphManager.getGlyphs(h.stacks),y=this.sourceCaches[h.source];return y&&y.setDependencies(h.tileID.key,h.type,[""]),_})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,h={}){this._checkLoaded(),t&&this._validate(l.u.glyphs,"glyphs",t,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,h,_={},y){this._checkLoaded();const w=[{id:t,url:h}],P=[...be(this.stylesheet.sprite),...w];this._validate(l.u.sprite,"sprite",P,null,_)||(this.stylesheet.sprite=P,this._loadSprite(w,!0,y))}removeSprite(t){this._checkLoaded();const h=be(this.stylesheet.sprite);if(h.find(_=>_.id===t)){if(this._spritesImagesIds[t])for(const _ of this._spritesImagesIds[t])this.imageManager.removeImage(_),this._changedImages[_]=!0;h.splice(h.findIndex(_=>_.id===t),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return be(this.stylesheet.sprite)}setSprite(t,h={},_){this._checkLoaded(),t&&this._validate(l.u.sprite,"sprite",t,null,h)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,_):(this._unloadSprite(),_&&_(null)))}}var es=l.Y([{name:"a_pos",type:"Int16",components:2}]);const ro={prelude:ei(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ei(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ei(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ei(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ei("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ei(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:ei(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ei("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ei("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ei("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ei(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ei(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ei(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ei(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ei(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ei(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ei(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ei(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ei(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ei(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ei(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ei(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ei(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ei(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ei(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ei(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ei("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ei("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ei("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:ei("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ei(k,t){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=t.match(/attribute ([\w]+) ([\w]+)/g),y=k.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=w?w.concat(y):y,D={};return{fragmentSource:k=k.replace(h,(z,V,H,W,ne)=>(D[ne]=!0,V==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
varying ${H} ${W} ${ne};
#else
uniform ${H} ${W} u_${ne};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ne}
    ${H} ${W} ${ne} = u_${ne};
#endif
`)),vertexSource:t=t.replace(h,(z,V,H,W,ne)=>{const ge=W==="float"?"vec2":"vec4",ke=ne.match(/color/)?"color":ge;return D[ne]?V==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
attribute ${H} ${ge} a_${ne};
varying ${H} ${W} ${ne};
#else
uniform ${H} ${W} u_${ne};
#endif
`:ke==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = a_${ne};
#else
    ${H} ${W} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = unpack_mix_${ke}(a_${ne}, u_${ne}_t);
#else
    ${H} ${W} ${ne} = u_${ne};
#endif
`:V==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
attribute ${H} ${ge} a_${ne};
#else
uniform ${H} ${W} u_${ne};
#endif
`:ke==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${H} ${W} ${ne} = a_${ne};
#else
    ${H} ${W} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${H} ${W} ${ne} = unpack_mix_${ke}(a_${ne}, u_${ne}_t);
#else
    ${H} ${W} ${ne} = u_${ne};
#endif
`}),staticAttributes:_,staticUniforms:P}}class Sl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,h,_,y,w,P,D,z,V){this.context=t;let H=this.boundPaintVertexBuffers.length!==y.length;for(let W=0;!H&&W<y.length;W++)this.boundPaintVertexBuffers[W]!==y[W]&&(H=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==_||H||this.boundIndexBuffer!==w||this.boundVertexOffset!==P||this.boundDynamicVertexBuffer!==D||this.boundDynamicVertexBuffer2!==z||this.boundDynamicVertexBuffer3!==V?this.freshBind(h,_,y,w,P,D,z,V):(t.bindVertexArray.set(this.vao),D&&D.bind(),w&&w.dynamicDraw&&w.bind(),z&&z.bind(),V&&V.bind())}freshBind(t,h,_,y,w,P,D,z){const V=t.numAttributes,H=this.context,W=H.gl;this.vao&&this.destroy(),this.vao=H.createVertexArray(),H.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=y,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=D,this.boundDynamicVertexBuffer3=z,h.enableAttributes(W,t);for(const ne of _)ne.enableAttributes(W,t);P&&P.enableAttributes(W,t),D&&D.enableAttributes(W,t),z&&z.enableAttributes(W,t),h.bind(),h.setVertexAttribPointers(W,t,w);for(const ne of _)ne.bind(),ne.setVertexAttribPointers(W,t,w);P&&(P.bind(),P.setVertexAttribPointers(W,t,w)),y&&y.bind(),D&&(D.bind(),D.setVertexAttribPointers(W,t,w)),z&&(z.bind(),z.setVertexAttribPointers(W,t,w)),H.currentNumAttributes=V}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const El=(k,t,h,_,y)=>({u_matrix:k,u_texture:0,u_ele_delta:t,u_fog_matrix:h,u_fog_color:_?_.properties.get("fog-color"):l.aM.white,u_fog_ground_blend:_?_.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:_?_.calculateFogBlendOpacity(y):0,u_horizon_color:_?_.properties.get("horizon-color"):l.aM.white,u_horizon_fog_blend:_?_.properties.get("horizon-fog-blend"):1});function xo(k){const t=[];for(let h=0;h<k.length;h++){if(k[h]===null)continue;const _=k[h].split(" ");t.push(_.pop())}return t}class wo{constructor(t,h,_,y,w,P){const D=t.gl;this.program=D.createProgram();const z=xo(h.staticAttributes),V=_?_.getBinderAttributes():[],H=z.concat(V),W=ro.prelude.staticUniforms?xo(ro.prelude.staticUniforms):[],ne=h.staticUniforms?xo(h.staticUniforms):[],ge=_?_.getBinderUniforms():[],ke=W.concat(ne).concat(ge),Me=[];for(const it of ke)Me.indexOf(it)<0&&Me.push(it);const Ne=_?_.defines():[];w&&Ne.push("#define OVERDRAW_INSPECTOR;"),P&&Ne.push("#define TERRAIN3D;");const ze=Ne.concat(ro.prelude.fragmentSource,h.fragmentSource).join(`
`),qe=Ne.concat(ro.prelude.vertexSource,h.vertexSource).join(`
`),Te=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Te,ze),D.compileShader(Te),!D.getShaderParameter(Te,D.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${D.getShaderInfoLog(Te)}`);D.attachShader(this.program,Te);const Ze=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Ze,qe),D.compileShader(Ze),!D.getShaderParameter(Ze,D.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${D.getShaderInfoLog(Ze)}`);D.attachShader(this.program,Ze),this.attributes={};const Ke={};this.numAttributes=H.length;for(let it=0;it<this.numAttributes;it++)H[it]&&(D.bindAttribLocation(this.program,it,H[it]),this.attributes[H[it]]=it);if(D.linkProgram(this.program),!D.getProgramParameter(this.program,D.LINK_STATUS))throw new Error(`Program failed to link: ${D.getProgramInfoLog(this.program)}`);D.deleteShader(Ze),D.deleteShader(Te);for(let it=0;it<Me.length;it++){const bt=Me[it];if(bt&&!Ke[bt]){const Rt=D.getUniformLocation(this.program,bt);Rt&&(Ke[bt]=Rt)}}this.fixedUniforms=y(t,Ke),this.terrainUniforms=((it,bt)=>({u_depth:new l.aH(it,bt.u_depth),u_terrain:new l.aH(it,bt.u_terrain),u_terrain_dim:new l.aI(it,bt.u_terrain_dim),u_terrain_matrix:new l.aJ(it,bt.u_terrain_matrix),u_terrain_unpack:new l.aK(it,bt.u_terrain_unpack),u_terrain_exaggeration:new l.aI(it,bt.u_terrain_exaggeration)}))(t,Ke),this.binderUniforms=_?_.getUniforms(t,Ke):[]}draw(t,h,_,y,w,P,D,z,V,H,W,ne,ge,ke,Me,Ne,ze,qe){const Te=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(_),t.setStencilMode(y),t.setColorMode(w),t.setCullFace(P),z){t.activeTexture.set(Te.TEXTURE2),Te.bindTexture(Te.TEXTURE_2D,z.depthTexture),t.activeTexture.set(Te.TEXTURE3),Te.bindTexture(Te.TEXTURE_2D,z.texture);for(const Ke in this.terrainUniforms)this.terrainUniforms[Ke].set(z[Ke])}for(const Ke in this.fixedUniforms)this.fixedUniforms[Ke].set(D[Ke]);Me&&Me.setUniforms(t,this.binderUniforms,ge,{zoom:ke});let Ze=0;switch(h){case Te.LINES:Ze=2;break;case Te.TRIANGLES:Ze=3;break;case Te.LINE_STRIP:Ze=1}for(const Ke of ne.get()){const it=Ke.vaos||(Ke.vaos={});(it[V]||(it[V]=new Sl)).bind(t,this,H,Me?Me.getPaintVertexBuffers():[],W,Ke.vertexOffset,Ne,ze,qe),Te.drawElements(h,Ke.primitiveLength*Ze,Te.UNSIGNED_SHORT,Ke.primitiveOffset*Ze*2)}}}function ha(k,t,h){const _=1/Fn(h,1,t.transform.tileZoom),y=Math.pow(2,h.tileID.overscaledZ),w=h.tileSize*Math.pow(2,t.transform.tileZoom)/y,P=w*(h.tileID.canonical.x+h.tileID.wrap*y),D=w*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[_,k.fromScale,k.toScale],u_fade:k.t,u_pixel_coord_upper:[P>>16,D>>16],u_pixel_coord_lower:[65535&P,65535&D]}}const fa=(k,t,h,_)=>{const y=t.style.light,w=y.properties.get("position"),P=[w.x,w.y,w.z],D=function(){var V=new l.A(9);return l.A!=Float32Array&&(V[1]=0,V[2]=0,V[3]=0,V[5]=0,V[6]=0,V[7]=0),V[0]=1,V[4]=1,V[8]=1,V}();y.properties.get("anchor")==="viewport"&&function(V,H){var W=Math.sin(H),ne=Math.cos(H);V[0]=ne,V[1]=W,V[2]=0,V[3]=-W,V[4]=ne,V[5]=0,V[6]=0,V[7]=0,V[8]=1}(D,-t.transform.angle),function(V,H,W){var ne=H[0],ge=H[1],ke=H[2];V[0]=ne*W[0]+ge*W[3]+ke*W[6],V[1]=ne*W[1]+ge*W[4]+ke*W[7],V[2]=ne*W[2]+ge*W[5]+ke*W[8]}(P,P,D);const z=y.properties.get("color");return{u_matrix:k,u_lightpos:P,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+h,u_opacity:_}},da=(k,t,h,_,y,w,P)=>l.e(fa(k,t,h,_),ha(w,t,P),{u_height_factor:-Math.pow(2,y.overscaledZ)/P.tileSize/8}),Oo=k=>({u_matrix:k}),za=(k,t,h,_)=>l.e(Oo(k),ha(h,t,_)),ki=(k,t)=>({u_matrix:k,u_world:t}),so=(k,t,h,_,y)=>l.e(za(k,t,h,_),{u_world:y}),vc=(k,t,h,_)=>{const y=k.transform;let w,P;if(_.paint.get("circle-pitch-alignment")==="map"){const D=Fn(h,1,y.zoom);w=!0,P=[D,D]}else w=!1,P=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(_.paint.get("circle-pitch-scale")==="map"),u_matrix:k.translatePosMatrix(t.posMatrix,h,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_pitch_with_map:+w,u_device_pixel_ratio:k.pixelRatio,u_extrude_scale:P}},Vs=(k,t,h)=>({u_matrix:k,u_inv_matrix:t,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}),yr=(k,t,h=1)=>({u_matrix:k,u_color:t,u_overlay:0,u_overlay_scale:h}),bi=k=>({u_matrix:k}),cr=(k,t,h,_)=>({u_matrix:k,u_extrude_scale:Fn(t,1,h),u_intensity:_}),Oa=(k,t,h,_)=>{const y=l.H();l.aP(y,0,k.width,k.height,0,0,1);const w=k.context.gl;return{u_matrix:y,u_world:[w.drawingBufferWidth,w.drawingBufferHeight],u_image:h,u_color_ramp:_,u_opacity:t.paint.get("heatmap-opacity")}};function Fa(k,t){const h=Math.pow(2,t.canonical.z),_=t.canonical.y;return[new l.Z(0,_/h).toLngLat().lat,new l.Z(0,(_+1)/h).toLngLat().lat]}const pa=(k,t,h,_)=>{const y=k.transform;return{u_matrix:ys(k,t,h,_),u_ratio:1/Fn(t,1,y.zoom),u_device_pixel_ratio:k.pixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},ma=(k,t,h,_,y)=>l.e(pa(k,t,h,y),{u_image:0,u_image_height:_}),Fo=(k,t,h,_,y)=>{const w=k.transform,P=ri(t,w);return{u_matrix:ys(k,t,h,y),u_texsize:t.imageAtlasTexture.size,u_ratio:1/Fn(t,1,w.zoom),u_device_pixel_ratio:k.pixelRatio,u_image:0,u_scale:[P,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},ou=(k,t,h,_,y,w)=>{const P=k.lineAtlas,D=ri(t,k.transform),z=h.layout.get("line-cap")==="round",V=P.getDash(_.from,z),H=P.getDash(_.to,z),W=V.width*y.fromScale,ne=H.width*y.toScale;return l.e(pa(k,t,h,w),{u_patternscale_a:[D/W,-V.height/2],u_patternscale_b:[D/ne,-H.height/2],u_sdfgamma:P.width/(256*Math.min(W,ne)*k.pixelRatio)/2,u_image:0,u_tex_y_a:V.y,u_tex_y_b:H.y,u_mix:y.t})};function ri(k,t){return 1/Fn(k,1,t.tileZoom)}function ys(k,t,h,_){return k.translatePosMatrix(_?_.posMatrix:t.tileID.posMatrix,t,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Tl=(k,t,h,_,y)=>{return{u_matrix:k,u_tl_parent:t,u_scale_parent:h,u_buffer_scale:1,u_fade_t:_.mix,u_opacity:_.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(P=y.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(w=y.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:au(y.paint.get("raster-hue-rotate"))};var w,P};function au(k){k*=Math.PI/180;const t=Math.sin(k),h=Math.cos(k);return[(2*h+1)/3,(-Math.sqrt(3)*t-h+1)/3,(Math.sqrt(3)*t-h+1)/3]}const Bo=(k,t,h,_,y,w,P,D,z,V,H,W,ne,ge)=>{const ke=P.transform;return{u_is_size_zoom_constant:+(k==="constant"||k==="source"),u_is_size_feature_constant:+(k==="constant"||k==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ke.cameraToCenterDistance,u_pitch:ke.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:ke.width/ke.height,u_fade_change:P.options.fadeDuration?P.symbolFadeChange:1,u_matrix:D,u_label_plane_matrix:z,u_coord_matrix:V,u_is_text:+W,u_pitch_with_map:+_,u_is_along_line:y,u_is_variable_anchor:w,u_texsize:ne,u_texture:0,u_translation:H,u_pitched_scale:ge}},Uo=(k,t,h,_,y,w,P,D,z,V,H,W,ne,ge,ke)=>{const Me=P.transform;return l.e(Bo(k,t,h,_,y,w,P,D,z,V,H,W,ne,ke),{u_gamma_scale:_?Math.cos(Me._pitch)*Me.cameraToCenterDistance:1,u_device_pixel_ratio:P.pixelRatio,u_is_halo:+ge})},hr=(k,t,h,_,y,w,P,D,z,V,H,W,ne,ge)=>l.e(Uo(k,t,h,_,y,w,P,D,z,V,H,!0,W,!0,ge),{u_texsize_icon:ne,u_texture_icon:1}),ga=(k,t,h)=>({u_matrix:k,u_opacity:t,u_color:h}),_a=(k,t,h,_,y,w)=>l.e(function(P,D,z,V){const H=z.imageManager.getPattern(P.from.toString()),W=z.imageManager.getPattern(P.to.toString()),{width:ne,height:ge}=z.imageManager.getPixelSize(),ke=Math.pow(2,V.tileID.overscaledZ),Me=V.tileSize*Math.pow(2,z.transform.tileZoom)/ke,Ne=Me*(V.tileID.canonical.x+V.tileID.wrap*ke),ze=Me*V.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:H.tl,u_pattern_br_a:H.br,u_pattern_tl_b:W.tl,u_pattern_br_b:W.br,u_texsize:[ne,ge],u_mix:D.t,u_pattern_size_a:H.displaySize,u_pattern_size_b:W.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/Fn(V,1,z.transform.tileZoom),u_pixel_coord_upper:[Ne>>16,ze>>16],u_pixel_coord_lower:[65535&Ne,65535&ze]}}(_,w,h,y),{u_matrix:k,u_opacity:t}),Ba={fillExtrusion:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_lightpos:new l.aN(k,t.u_lightpos),u_lightintensity:new l.aI(k,t.u_lightintensity),u_lightcolor:new l.aN(k,t.u_lightcolor),u_vertical_gradient:new l.aI(k,t.u_vertical_gradient),u_opacity:new l.aI(k,t.u_opacity)}),fillExtrusionPattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_lightpos:new l.aN(k,t.u_lightpos),u_lightintensity:new l.aI(k,t.u_lightintensity),u_lightcolor:new l.aN(k,t.u_lightcolor),u_vertical_gradient:new l.aI(k,t.u_vertical_gradient),u_height_factor:new l.aI(k,t.u_height_factor),u_image:new l.aH(k,t.u_image),u_texsize:new l.aO(k,t.u_texsize),u_pixel_coord_upper:new l.aO(k,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,t.u_pixel_coord_lower),u_scale:new l.aN(k,t.u_scale),u_fade:new l.aI(k,t.u_fade),u_opacity:new l.aI(k,t.u_opacity)}),fill:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix)}),fillPattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_image:new l.aH(k,t.u_image),u_texsize:new l.aO(k,t.u_texsize),u_pixel_coord_upper:new l.aO(k,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,t.u_pixel_coord_lower),u_scale:new l.aN(k,t.u_scale),u_fade:new l.aI(k,t.u_fade)}),fillOutline:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_world:new l.aO(k,t.u_world)}),fillOutlinePattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_world:new l.aO(k,t.u_world),u_image:new l.aH(k,t.u_image),u_texsize:new l.aO(k,t.u_texsize),u_pixel_coord_upper:new l.aO(k,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,t.u_pixel_coord_lower),u_scale:new l.aN(k,t.u_scale),u_fade:new l.aI(k,t.u_fade)}),circle:(k,t)=>({u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_scale_with_map:new l.aH(k,t.u_scale_with_map),u_pitch_with_map:new l.aH(k,t.u_pitch_with_map),u_extrude_scale:new l.aO(k,t.u_extrude_scale),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_matrix:new l.aJ(k,t.u_matrix)}),collisionBox:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_pixel_extrude_scale:new l.aO(k,t.u_pixel_extrude_scale)}),collisionCircle:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_inv_matrix:new l.aJ(k,t.u_inv_matrix),u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_viewport_size:new l.aO(k,t.u_viewport_size)}),debug:(k,t)=>({u_color:new l.aL(k,t.u_color),u_matrix:new l.aJ(k,t.u_matrix),u_overlay:new l.aH(k,t.u_overlay),u_overlay_scale:new l.aI(k,t.u_overlay_scale)}),clippingMask:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix)}),heatmap:(k,t)=>({u_extrude_scale:new l.aI(k,t.u_extrude_scale),u_intensity:new l.aI(k,t.u_intensity),u_matrix:new l.aJ(k,t.u_matrix)}),heatmapTexture:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_world:new l.aO(k,t.u_world),u_image:new l.aH(k,t.u_image),u_color_ramp:new l.aH(k,t.u_color_ramp),u_opacity:new l.aI(k,t.u_opacity)}),hillshade:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_image:new l.aH(k,t.u_image),u_latrange:new l.aO(k,t.u_latrange),u_light:new l.aO(k,t.u_light),u_shadow:new l.aL(k,t.u_shadow),u_highlight:new l.aL(k,t.u_highlight),u_accent:new l.aL(k,t.u_accent)}),hillshadePrepare:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_image:new l.aH(k,t.u_image),u_dimension:new l.aO(k,t.u_dimension),u_zoom:new l.aI(k,t.u_zoom),u_unpack:new l.aK(k,t.u_unpack)}),line:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_ratio:new l.aI(k,t.u_ratio),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_units_to_pixels:new l.aO(k,t.u_units_to_pixels)}),lineGradient:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_ratio:new l.aI(k,t.u_ratio),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_units_to_pixels:new l.aO(k,t.u_units_to_pixels),u_image:new l.aH(k,t.u_image),u_image_height:new l.aI(k,t.u_image_height)}),linePattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_texsize:new l.aO(k,t.u_texsize),u_ratio:new l.aI(k,t.u_ratio),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_image:new l.aH(k,t.u_image),u_units_to_pixels:new l.aO(k,t.u_units_to_pixels),u_scale:new l.aN(k,t.u_scale),u_fade:new l.aI(k,t.u_fade)}),lineSDF:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_ratio:new l.aI(k,t.u_ratio),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_units_to_pixels:new l.aO(k,t.u_units_to_pixels),u_patternscale_a:new l.aO(k,t.u_patternscale_a),u_patternscale_b:new l.aO(k,t.u_patternscale_b),u_sdfgamma:new l.aI(k,t.u_sdfgamma),u_image:new l.aH(k,t.u_image),u_tex_y_a:new l.aI(k,t.u_tex_y_a),u_tex_y_b:new l.aI(k,t.u_tex_y_b),u_mix:new l.aI(k,t.u_mix)}),raster:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_tl_parent:new l.aO(k,t.u_tl_parent),u_scale_parent:new l.aI(k,t.u_scale_parent),u_buffer_scale:new l.aI(k,t.u_buffer_scale),u_fade_t:new l.aI(k,t.u_fade_t),u_opacity:new l.aI(k,t.u_opacity),u_image0:new l.aH(k,t.u_image0),u_image1:new l.aH(k,t.u_image1),u_brightness_low:new l.aI(k,t.u_brightness_low),u_brightness_high:new l.aI(k,t.u_brightness_high),u_saturation_factor:new l.aI(k,t.u_saturation_factor),u_contrast_factor:new l.aI(k,t.u_contrast_factor),u_spin_weights:new l.aN(k,t.u_spin_weights)}),symbolIcon:(k,t)=>({u_is_size_zoom_constant:new l.aH(k,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(k,t.u_is_size_feature_constant),u_size_t:new l.aI(k,t.u_size_t),u_size:new l.aI(k,t.u_size),u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_pitch:new l.aI(k,t.u_pitch),u_rotate_symbol:new l.aH(k,t.u_rotate_symbol),u_aspect_ratio:new l.aI(k,t.u_aspect_ratio),u_fade_change:new l.aI(k,t.u_fade_change),u_matrix:new l.aJ(k,t.u_matrix),u_label_plane_matrix:new l.aJ(k,t.u_label_plane_matrix),u_coord_matrix:new l.aJ(k,t.u_coord_matrix),u_is_text:new l.aH(k,t.u_is_text),u_pitch_with_map:new l.aH(k,t.u_pitch_with_map),u_is_along_line:new l.aH(k,t.u_is_along_line),u_is_variable_anchor:new l.aH(k,t.u_is_variable_anchor),u_texsize:new l.aO(k,t.u_texsize),u_texture:new l.aH(k,t.u_texture),u_translation:new l.aO(k,t.u_translation),u_pitched_scale:new l.aI(k,t.u_pitched_scale)}),symbolSDF:(k,t)=>({u_is_size_zoom_constant:new l.aH(k,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(k,t.u_is_size_feature_constant),u_size_t:new l.aI(k,t.u_size_t),u_size:new l.aI(k,t.u_size),u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_pitch:new l.aI(k,t.u_pitch),u_rotate_symbol:new l.aH(k,t.u_rotate_symbol),u_aspect_ratio:new l.aI(k,t.u_aspect_ratio),u_fade_change:new l.aI(k,t.u_fade_change),u_matrix:new l.aJ(k,t.u_matrix),u_label_plane_matrix:new l.aJ(k,t.u_label_plane_matrix),u_coord_matrix:new l.aJ(k,t.u_coord_matrix),u_is_text:new l.aH(k,t.u_is_text),u_pitch_with_map:new l.aH(k,t.u_pitch_with_map),u_is_along_line:new l.aH(k,t.u_is_along_line),u_is_variable_anchor:new l.aH(k,t.u_is_variable_anchor),u_texsize:new l.aO(k,t.u_texsize),u_texture:new l.aH(k,t.u_texture),u_gamma_scale:new l.aI(k,t.u_gamma_scale),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_is_halo:new l.aH(k,t.u_is_halo),u_translation:new l.aO(k,t.u_translation),u_pitched_scale:new l.aI(k,t.u_pitched_scale)}),symbolTextAndIcon:(k,t)=>({u_is_size_zoom_constant:new l.aH(k,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(k,t.u_is_size_feature_constant),u_size_t:new l.aI(k,t.u_size_t),u_size:new l.aI(k,t.u_size),u_camera_to_center_distance:new l.aI(k,t.u_camera_to_center_distance),u_pitch:new l.aI(k,t.u_pitch),u_rotate_symbol:new l.aH(k,t.u_rotate_symbol),u_aspect_ratio:new l.aI(k,t.u_aspect_ratio),u_fade_change:new l.aI(k,t.u_fade_change),u_matrix:new l.aJ(k,t.u_matrix),u_label_plane_matrix:new l.aJ(k,t.u_label_plane_matrix),u_coord_matrix:new l.aJ(k,t.u_coord_matrix),u_is_text:new l.aH(k,t.u_is_text),u_pitch_with_map:new l.aH(k,t.u_pitch_with_map),u_is_along_line:new l.aH(k,t.u_is_along_line),u_is_variable_anchor:new l.aH(k,t.u_is_variable_anchor),u_texsize:new l.aO(k,t.u_texsize),u_texsize_icon:new l.aO(k,t.u_texsize_icon),u_texture:new l.aH(k,t.u_texture),u_texture_icon:new l.aH(k,t.u_texture_icon),u_gamma_scale:new l.aI(k,t.u_gamma_scale),u_device_pixel_ratio:new l.aI(k,t.u_device_pixel_ratio),u_is_halo:new l.aH(k,t.u_is_halo),u_translation:new l.aO(k,t.u_translation),u_pitched_scale:new l.aI(k,t.u_pitched_scale)}),background:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_opacity:new l.aI(k,t.u_opacity),u_color:new l.aL(k,t.u_color)}),backgroundPattern:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_opacity:new l.aI(k,t.u_opacity),u_image:new l.aH(k,t.u_image),u_pattern_tl_a:new l.aO(k,t.u_pattern_tl_a),u_pattern_br_a:new l.aO(k,t.u_pattern_br_a),u_pattern_tl_b:new l.aO(k,t.u_pattern_tl_b),u_pattern_br_b:new l.aO(k,t.u_pattern_br_b),u_texsize:new l.aO(k,t.u_texsize),u_mix:new l.aI(k,t.u_mix),u_pattern_size_a:new l.aO(k,t.u_pattern_size_a),u_pattern_size_b:new l.aO(k,t.u_pattern_size_b),u_scale_a:new l.aI(k,t.u_scale_a),u_scale_b:new l.aI(k,t.u_scale_b),u_pixel_coord_upper:new l.aO(k,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(k,t.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aI(k,t.u_tile_units_to_pixels)}),terrain:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_texture:new l.aH(k,t.u_texture),u_ele_delta:new l.aI(k,t.u_ele_delta),u_fog_matrix:new l.aJ(k,t.u_fog_matrix),u_fog_color:new l.aL(k,t.u_fog_color),u_fog_ground_blend:new l.aI(k,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.aI(k,t.u_fog_ground_blend_opacity),u_horizon_color:new l.aL(k,t.u_horizon_color),u_horizon_fog_blend:new l.aI(k,t.u_horizon_fog_blend)}),terrainDepth:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_ele_delta:new l.aI(k,t.u_ele_delta)}),terrainCoords:(k,t)=>({u_matrix:new l.aJ(k,t.u_matrix),u_texture:new l.aH(k,t.u_texture),u_terrain_coords_id:new l.aI(k,t.u_terrain_coords_id),u_ele_delta:new l.aI(k,t.u_ele_delta)}),sky:(k,t)=>({u_sky_color:new l.aL(k,t.u_sky_color),u_horizon_color:new l.aL(k,t.u_horizon_color),u_horizon:new l.aI(k,t.u_horizon),u_sky_horizon_blend:new l.aI(k,t.u_sky_horizon_blend)})};class vs{constructor(t,h,_){this.context=t;const y=t.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const bc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ua{constructor(t,h,_,y){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=y,this.context=t;const w=t.gl;this.buffer=w.createBuffer(),t.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,h){for(let _=0;_<this.attributes.length;_++){const y=h.attributes[this.attributes[_].name];y!==void 0&&t.enableVertexAttribArray(y)}}setVertexAttribPointers(t,h,_){for(let y=0;y<this.attributes.length;y++){const w=this.attributes[y],P=h.attributes[w.name];P!==void 0&&t.vertexAttribPointer(P,w.components,t[bc[w.type]],!1,this.itemSize,w.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Lr=new WeakMap;function bs(k){var t;if(Lr.has(k))return Lr.get(k);{const h=(t=k.getParameter(k.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Lr.set(k,h),h}}class si{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Mr extends si{getDefault(){return l.aM.transparent}set(t){const h=this.current;(t.r!==h.r||t.g!==h.g||t.b!==h.b||t.a!==h.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class jo extends si{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Vo extends si{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class qo extends si{getDefault(){return[!0,!0,!0,!0]}set(t){const h=this.current;(t[0]!==h[0]||t[1]!==h[1]||t[2]!==h[2]||t[3]!==h[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Cl extends si{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Go extends si{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class lu extends si{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const h=this.current;(t.func!==h.func||t.ref!==h.ref||t.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ts extends si{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const h=this.current;(t[0]!==h[0]||t[1]!==h[1]||t[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Ll extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;t?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=t,this.dirty=!1}}class uu extends si{getDefault(){return[0,1]}set(t){const h=this.current;(t[0]!==h[0]||t[1]!==h[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class cu extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;t?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=t,this.dirty=!1}}class hu extends si{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ko extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;t?h.enable(h.BLEND):h.disable(h.BLEND),this.current=t,this.dirty=!1}}class fu extends si{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const h=this.current;(t[0]!==h[0]||t[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class xc extends si{getDefault(){return l.aM.transparent}set(t){const h=this.current;(t.r!==h.r||t.g!==h.g||t.b!==h.b||t.a!==h.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class du extends si{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class xs extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;t?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=t,this.dirty=!1}}class Hr extends si{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ja extends si{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class pu extends si{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class wc extends si{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Va extends si{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const h=this.current;(t[0]!==h[0]||t[1]!==h[1]||t[2]!==h[2]||t[3]!==h[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ml extends si{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class qa extends si{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ga extends si{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class ns extends si{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ya extends si{getDefault(){return null}set(t){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Bi extends si{getDefault(){return null}set(t){var h;if(t===this.current&&!this.dirty)return;const _=this.gl;bs(_)?_.bindVertexArray(t):(h=_.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Io extends si{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Al extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Za extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class va extends si{constructor(t,h){super(t),this.context=t,this.parent=h}getDefault(){return null}}class Ha extends va{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class qs extends va{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Pl extends va{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class kc{constructor(t,h,_,y,w){this.context=t,this.width=h,this.height=_;const P=t.gl,D=this.framebuffer=P.createFramebuffer();if(this.colorAttachment=new Ha(t,D),y)this.depthAttachment=w?new Pl(t,D):new qs(t,D);else if(w)throw new Error("Stencil cannot be set without depth");if(P.checkFramebufferStatus(P.FRAMEBUFFER)!==P.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,h=this.colorAttachment.get();if(h&&t.deleteTexture(h),this.depthAttachment){const _=this.depthAttachment.get();_&&t.deleteRenderbuffer(_)}t.deleteFramebuffer(this.framebuffer)}}class Di{constructor(t,h,_){this.blendFunction=t,this.blendColor=h,this.mask=_}}Di.Replace=[1,0],Di.disabled=new Di(Di.Replace,l.aM.transparent,[!1,!1,!1,!1]),Di.unblended=new Di(Di.Replace,l.aM.transparent,[!0,!0,!0,!0]),Di.alphaBlended=new Di([1,771],l.aM.transparent,[!0,!0,!0,!0]);class Ic{constructor(t){var h,_;if(this.gl=t,this.clearColor=new Mr(this),this.clearDepth=new jo(this),this.clearStencil=new Vo(this),this.colorMask=new qo(this),this.depthMask=new Cl(this),this.stencilMask=new Go(this),this.stencilFunc=new lu(this),this.stencilOp=new ts(this),this.stencilTest=new Ll(this),this.depthRange=new uu(this),this.depthTest=new cu(this),this.depthFunc=new hu(this),this.blend=new ko(this),this.blendFunc=new fu(this),this.blendColor=new xc(this),this.blendEquation=new du(this),this.cullFace=new xs(this),this.cullFaceSide=new Hr(this),this.frontFace=new ja(this),this.program=new pu(this),this.activeTexture=new wc(this),this.viewport=new Va(this),this.bindFramebuffer=new Ml(this),this.bindRenderbuffer=new qa(this),this.bindTexture=new Ga(this),this.bindVertexBuffer=new ns(this),this.bindElementBuffer=new ya(this),this.bindVertexArray=new Bi(this),this.pixelStoreUnpack=new Io(this),this.pixelStoreUnpackPremultiplyAlpha=new Al(this),this.pixelStoreUnpackFlipY=new Za(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),bs(t)){this.HALF_FLOAT=t.HALF_FLOAT;const y=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=t.RGBA16F)!==null&&h!==void 0?h:y==null?void 0:y.RGBA16F_EXT,this.RGB16F=(_=t.RGB16F)!==null&&_!==void 0?_:y==null?void 0:y.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const y=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=y==null?void 0:y.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,h){return new vs(this,t,h)}createVertexBuffer(t,h,_){return new Ua(this,t,h,_)}createRenderbuffer(t,h,_){const y=this.gl,w=y.createRenderbuffer();return this.bindRenderbuffer.set(w),y.renderbufferStorage(y.RENDERBUFFER,t,h,_),this.bindRenderbuffer.set(null),w}createFramebuffer(t,h,_,y){return new kc(this,t,h,_,y)}clear({color:t,depth:h,stencil:_}){const y=this.gl;let w=0;t&&(w|=y.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(w|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),_!==void 0&&(w|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),y.clear(w)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){l.aE(t.blendFunction,Di.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return bs(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var h;return bs(this.gl)?this.gl.deleteVertexArray(t):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Bn{constructor(t,h,_){this.func=t,this.mask=h,this.range=_}}Bn.ReadOnly=!1,Bn.ReadWrite=!0,Bn.disabled=new Bn(519,Bn.ReadOnly,[0,1]);const Wa=7680;class pi{constructor(t,h,_,y,w,P){this.test=t,this.ref=h,this.mask=_,this.fail=y,this.depthFail=w,this.pass=P}}pi.disabled=new pi({func:519,mask:0},0,0,Wa,Wa,Wa);class ci{constructor(t,h,_){this.enable=t,this.mode=h,this.frontFace=_}}let oo;function ba(k,t,h,_,y){const w=k.context,P=w.gl,D=k.useProgram("collisionBox"),z=[];let V=0,H=0;for(let ze=0;ze<_.length;ze++){const qe=_[ze],Te=t.getTile(qe).getBucket(h);if(!Te)continue;const Ze=y?Te.textCollisionBox:Te.iconCollisionBox,Ke=Te.collisionCircleArray;if(Ke.length>0){const it=l.H();l.aQ(it,Te.placementInvProjMatrix,k.transform.glCoordMatrix),l.aQ(it,it,Te.placementViewportMatrix),z.push({circleArray:Ke,circleOffset:H,transform:qe.posMatrix,invTransform:it,coord:qe}),V+=Ke.length/4,H=V}Ze&&D.draw(w,P.LINES,Bn.disabled,pi.disabled,k.colorModeForRenderPass(),ci.disabled,{u_matrix:qe.posMatrix,u_pixel_extrude_scale:[1/(W=k.transform).width,1/W.height]},k.style.map.terrain&&k.style.map.terrain.getTerrainData(qe),h.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,null,k.transform.zoom,null,null,Ze.collisionVertexBuffer)}var W;if(!y||!z.length)return;const ne=k.useProgram("collisionCircle"),ge=new l.aR;ge.resize(4*V),ge._trim();let ke=0;for(const ze of z)for(let qe=0;qe<ze.circleArray.length/4;qe++){const Te=4*qe,Ze=ze.circleArray[Te+0],Ke=ze.circleArray[Te+1],it=ze.circleArray[Te+2],bt=ze.circleArray[Te+3];ge.emplace(ke++,Ze,Ke,it,bt,0),ge.emplace(ke++,Ze,Ke,it,bt,1),ge.emplace(ke++,Ze,Ke,it,bt,2),ge.emplace(ke++,Ze,Ke,it,bt,3)}(!oo||oo.length<2*V)&&(oo=function(ze){const qe=2*ze,Te=new l.aT;Te.resize(qe),Te._trim();for(let Ze=0;Ze<qe;Ze++){const Ke=6*Ze;Te.uint16[Ke+0]=4*Ze+0,Te.uint16[Ke+1]=4*Ze+1,Te.uint16[Ke+2]=4*Ze+2,Te.uint16[Ke+3]=4*Ze+2,Te.uint16[Ke+4]=4*Ze+3,Te.uint16[Ke+5]=4*Ze+0}return Te}(V));const Me=w.createIndexBuffer(oo,!0),Ne=w.createVertexBuffer(ge,l.aS.members,!0);for(const ze of z){const qe=Vs(ze.transform,ze.invTransform,k.transform);ne.draw(w,P.TRIANGLES,Bn.disabled,pi.disabled,k.colorModeForRenderPass(),ci.disabled,qe,k.style.map.terrain&&k.style.map.terrain.getTerrainData(ze.coord),h.id,Ne,Me,l.a0.simpleSegment(0,2*ze.circleOffset,ze.circleArray.length,ze.circleArray.length/2),null,k.transform.zoom,null,null,null)}Ne.destroy(),Me.destroy()}ci.disabled=new ci(!1,1029,2305),ci.backCCW=new ci(!0,1029,2305);const Zo=l.an(new Float32Array(16));function Rl(k,t,h,_,y,w){const{horizontalAlign:P,verticalAlign:D}=l.au(k);return new l.P((-(P-.5)*t/y+_[0])*w,(-(D-.5)*h/y+_[1])*w)}function So(k,t,h,_,y,w){const P=t.tileAnchorPoint.add(new l.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let D=_.mult(w);h||(D=D.rotate(-y));const z=P.add(D);return Ae(z.x,z.y,t.labelPlaneMatrix,t.getElevation).point}if(h){const D=et(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(k),z=Math.atan(D.y/D.x)+(D.x<0?Math.PI:0);return k.add(_.rotate(z))}return k.add(_)}function Ho(k,t,h,_,y,w,P,D,z,V,H,W,ne,ge){const ke=k.text.placedSymbolArray,Me=k.text.dynamicLayoutVertexArray,Ne=k.icon.dynamicLayoutVertexArray,ze={};Me.clear();for(let qe=0;qe<ke.length;qe++){const Te=ke.get(qe),Ze=Te.hidden||!Te.crossTileID||k.allowVerticalPlacement&&!Te.placedOrientation?null:_[Te.crossTileID];if(Ze){const Ke=new l.P(Te.anchorX,Te.anchorY),it={getElevation:ge,width:y.width,height:y.height,labelPlaneMatrix:w,lineVertexArray:null,pitchWithMap:h,projection:H,projectionCache:null,tileAnchorPoint:Ke,translation:W,unwrappedTileID:ne},bt=h?Ae(Ke.x,Ke.y,P,ge):et(Ke.x,Ke.y,it),Rt=K(y.cameraToCenterDistance,bt.signedDistanceFromCamera);let Ht=l.ai(k.textSizeData,z,Te)*Rt/l.ap;h&&(Ht*=k.tilePixelRatio/D);const{width:Yt,height:jt,anchor:Ut,textOffset:rn,textBoxScale:Tn}=Ze,qt=Rl(Ut,Yt,jt,rn,Tn,Ht),Xt=H.getPitchedTextCorrection(y,Ke.add(new l.P(W[0],W[1])),ne),In=So(bt.point,it,t,qt,y.angle,Xt),Si=k.allowVerticalPlacement&&Te.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let On=0;On<Te.numGlyphs;On++)l.aj(Me,In,Si);V&&Te.associatedIconIndex>=0&&(ze[Te.associatedIconIndex]={shiftedAnchor:In,angle:Si})}else an(Te.numGlyphs,Me)}if(V){Ne.clear();const qe=k.icon.placedSymbolArray;for(let Te=0;Te<qe.length;Te++){const Ze=qe.get(Te);if(Ze.hidden)an(Ze.numGlyphs,Ne);else{const Ke=ze[Te];if(Ke)for(let it=0;it<Ze.numGlyphs;it++)l.aj(Ne,Ke.shiftedAnchor,Ke.angle);else an(Ze.numGlyphs,Ne)}}k.icon.dynamicLayoutVertexBuffer.updateData(Ne)}k.text.dynamicLayoutVertexBuffer.updateData(Me)}function is(k,t,h){return h.iconsInText&&t?"symbolTextAndIcon":k?"symbolSDF":"symbolIcon"}function Dl(k,t,h,_,y,w,P,D,z,V,H,W){const ne=k.context,ge=ne.gl,ke=k.transform,Me=Kr(),Ne=D==="map",ze=z==="map",qe=D!=="viewport"&&h.layout.get("symbol-placement")!=="point",Te=Ne&&!ze&&!qe,Ze=!ze&&qe,Ke=!h.layout.get("symbol-sort-key").isConstant();let it=!1;const bt=k.depthModeForSublayer(0,Bn.ReadOnly),Rt=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ht=[],Yt=Me.getCircleRadiusCorrection(ke);for(const jt of _){const Ut=t.getTile(jt),rn=Ut.getBucket(h);if(!rn)continue;const Tn=y?rn.text:rn.icon;if(!Tn||!Tn.segments.get().length||!Tn.hasVisibleVertices)continue;const qt=Tn.programConfigurations.get(h.id),Xt=y||rn.sdfIcons,In=y?rn.textSizeData:rn.iconSizeData,Si=ze||ke.pitch!==0,On=k.useProgram(is(Xt,y,rn),qt),jn=l.ag(In,ke.zoom),Ei=k.style.map.terrain&&k.style.map.terrain.getTerrainData(jt);let Nr,Hs,Ti,ss,Wr=[0,0],zr=null;if(y)Hs=Ut.glyphAtlasTexture,Ti=ge.LINEAR,Nr=Ut.glyphAtlasTexture.size,rn.iconsInText&&(Wr=Ut.imageAtlasTexture.size,zr=Ut.imageAtlasTexture,ss=Si||k.options.rotating||k.options.zooming||In.kind==="composite"||In.kind==="camera"?ge.LINEAR:ge.NEAREST);else{const Gn=h.layout.get("icon-size").constantOr(0)!==1||rn.iconsNeedLinear;Hs=Ut.imageAtlasTexture,Ti=Xt||k.options.rotating||k.options.zooming||Gn||Si?ge.LINEAR:ge.NEAREST,Nr=Ut.imageAtlasTexture.size}const Xr=Fn(Ut,1,k.transform.zoom),ho=Ze?jt.posMatrix:Zo,tl=Ki(ho,ze,Ne,k.transform,Xr),Iu=Zr(ho,ze,Ne,k.transform,Xr),nl=Zr(jt.posMatrix,ze,Ne,k.transform,Xr),zs=Me.translatePosition(k.transform,Ut,w,P),Su=Rt&&rn.hasTextData(),qc=h.layout.get("icon-text-fit")!=="none"&&Su&&rn.hasIconData();if(qe){const Gn=k.style.map.terrain?(il,rl)=>k.style.map.terrain.getElevation(jt,il,rl):null,Ia=h.layout.get("text-rotation-alignment")==="map";ce(rn,jt.posMatrix,k,y,tl,nl,ze,V,Ia,Me,jt.toUnwrapped(),ke.width,ke.height,zs,Gn)}const Os=jt.posMatrix,Fs=y&&Rt||qc,Qo=qe||Fs?Zo:tl,Ws=Iu,Pr=Xt&&h.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Or;Or=Xt?rn.iconsInText?hr(In.kind,jn,Te,ze,qe,Fs,k,Os,Qo,Ws,zs,Nr,Wr,Yt):Uo(In.kind,jn,Te,ze,qe,Fs,k,Os,Qo,Ws,zs,y,Nr,!0,Yt):Bo(In.kind,jn,Te,ze,qe,Fs,k,Os,Qo,Ws,zs,y,Nr,Yt);const Ss={program:On,buffers:Tn,uniformValues:Or,atlasTexture:Hs,atlasTextureIcon:zr,atlasInterpolation:Ti,atlasInterpolationIcon:ss,isSDF:Xt,hasHalo:Pr};if(Ke&&rn.canOverlap){it=!0;const Gn=Tn.segments.get();for(const Ia of Gn)Ht.push({segments:new l.a0([Ia]),sortKey:Ia.sortKey,state:Ss,terrainData:Ei})}else Ht.push({segments:Tn.segments,sortKey:0,state:Ss,terrainData:Ei})}it&&Ht.sort((jt,Ut)=>jt.sortKey-Ut.sortKey);for(const jt of Ht){const Ut=jt.state;if(ne.activeTexture.set(ge.TEXTURE0),Ut.atlasTexture.bind(Ut.atlasInterpolation,ge.CLAMP_TO_EDGE),Ut.atlasTextureIcon&&(ne.activeTexture.set(ge.TEXTURE1),Ut.atlasTextureIcon&&Ut.atlasTextureIcon.bind(Ut.atlasInterpolationIcon,ge.CLAMP_TO_EDGE)),Ut.isSDF){const rn=Ut.uniformValues;Ut.hasHalo&&(rn.u_is_halo=1,Nl(Ut.buffers,jt.segments,h,k,Ut.program,bt,H,W,rn,jt.terrainData)),rn.u_is_halo=0}Nl(Ut.buffers,jt.segments,h,k,Ut.program,bt,H,W,Ut.uniformValues,jt.terrainData)}}function Nl(k,t,h,_,y,w,P,D,z,V){const H=_.context;y.draw(H,H.gl.TRIANGLES,w,P,D,ci.disabled,z,V,h.id,k.layoutVertexBuffer,k.indexBuffer,t,h.paint,_.transform.zoom,k.programConfigurations.get(h.id),k.dynamicLayoutVertexBuffer,k.opacityVertexBuffer)}function zl(k,t,h,_){const y=k.context,w=y.gl,P=pi.disabled,D=new Di([w.ONE,w.ONE],l.aM.transparent,[!0,!0,!0,!0]),z=t.getBucket(h);if(!z)return;const V=_.key;let H=h.heatmapFbos.get(V);H||(H=Wo(y,t.tileSize,t.tileSize),h.heatmapFbos.set(V,H)),y.bindFramebuffer.set(H.framebuffer),y.viewport.set([0,0,t.tileSize,t.tileSize]),y.clear({color:l.aM.transparent});const W=z.programConfigurations.get(h.id),ne=k.useProgram("heatmap",W),ge=k.style.map.terrain.getTerrainData(_);ne.draw(y,w.TRIANGLES,Bn.disabled,P,D,ci.disabled,cr(_.posMatrix,t,k.transform.zoom,h.paint.get("heatmap-intensity")),ge,h.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,h.paint,k.transform.zoom,W)}function ao(k,t,h){const _=k.context,y=_.gl;_.setColorMode(k.colorModeForRenderPass());const w=Xo(_,t),P=h.key,D=t.heatmapFbos.get(P);D&&(_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,D.colorAttachment.get()),_.activeTexture.set(y.TEXTURE1),w.bind(y.LINEAR,y.CLAMP_TO_EDGE),k.useProgram("heatmapTexture").draw(_,y.TRIANGLES,Bn.disabled,pi.disabled,k.colorModeForRenderPass(),ci.disabled,Oa(k,t,0,1),null,t.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments,t.paint,k.transform.zoom),D.destroy(),t.heatmapFbos.delete(P))}function Wo(k,t,h){var _,y;const w=k.gl,P=w.createTexture();w.bindTexture(w.TEXTURE_2D,P),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.LINEAR);const D=(_=k.HALF_FLOAT)!==null&&_!==void 0?_:w.UNSIGNED_BYTE,z=(y=k.RGBA16F)!==null&&y!==void 0?y:w.RGBA;w.texImage2D(w.TEXTURE_2D,0,z,t,h,0,w.RGBA,D,null);const V=k.createFramebuffer(t,h,!1,!1);return V.colorAttachment.set(P),V}function Xo(k,t){return t.colorRampTexture||(t.colorRampTexture=new we(k,t.colorRamp,k.gl.RGBA)),t.colorRampTexture}function $o(k,t,h,_,y){if(!h||!_||!_.imageAtlas)return;const w=_.imageAtlas.patternPositions;let P=w[h.to.toString()],D=w[h.from.toString()];if(!P&&D&&(P=D),!D&&P&&(D=P),!P||!D){const z=y.getPaintProperty(t);P=w[z],D=w[z]}P&&D&&k.setConstantPatternPositions(P,D)}function Yo(k,t,h,_,y,w,P){const D=k.context.gl,z="fill-pattern",V=h.paint.get(z),H=V&&V.constantOr(1),W=h.getCrossfadeParameters();let ne,ge,ke,Me,Ne;P?(ge=H&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ne=D.LINES):(ge=H?"fillPattern":"fill",ne=D.TRIANGLES);const ze=V.constantOr(null);for(const qe of _){const Te=t.getTile(qe);if(H&&!Te.patternsLoaded())continue;const Ze=Te.getBucket(h);if(!Ze)continue;const Ke=Ze.programConfigurations.get(h.id),it=k.useProgram(ge,Ke),bt=k.style.map.terrain&&k.style.map.terrain.getTerrainData(qe);H&&(k.context.activeTexture.set(D.TEXTURE0),Te.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Ke.updatePaintBuffers(W)),$o(Ke,z,ze,Te,h);const Rt=bt?qe:null,Ht=k.translatePosMatrix(Rt?Rt.posMatrix:qe.posMatrix,Te,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(P){Me=Ze.indexBuffer2,Ne=Ze.segments2;const Yt=[D.drawingBufferWidth,D.drawingBufferHeight];ke=ge==="fillOutlinePattern"&&H?so(Ht,k,W,Te,Yt):ki(Ht,Yt)}else Me=Ze.indexBuffer,Ne=Ze.segments,ke=H?za(Ht,k,W,Te):Oo(Ht);it.draw(k.context,ne,y,k.stencilModeForClipping(qe),w,ci.disabled,ke,bt,h.id,Ze.layoutVertexBuffer,Me,Ne,h.paint,k.transform.zoom,Ke)}}function Jo(k,t,h,_,y,w,P){const D=k.context,z=D.gl,V="fill-extrusion-pattern",H=h.paint.get(V),W=H.constantOr(1),ne=h.getCrossfadeParameters(),ge=h.paint.get("fill-extrusion-opacity"),ke=H.constantOr(null);for(const Me of _){const Ne=t.getTile(Me),ze=Ne.getBucket(h);if(!ze)continue;const qe=k.style.map.terrain&&k.style.map.terrain.getTerrainData(Me),Te=ze.programConfigurations.get(h.id),Ze=k.useProgram(W?"fillExtrusionPattern":"fillExtrusion",Te);W&&(k.context.activeTexture.set(z.TEXTURE0),Ne.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Te.updatePaintBuffers(ne)),$o(Te,V,ke,Ne,h);const Ke=k.translatePosMatrix(Me.posMatrix,Ne,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),it=h.paint.get("fill-extrusion-vertical-gradient"),bt=W?da(Ke,k,it,ge,Me,ne,Ne):fa(Ke,k,it,ge);Ze.draw(D,D.gl.TRIANGLES,y,w,P,ci.backCCW,bt,qe,h.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,h.paint,k.transform.zoom,Te,k.style.map.terrain&&ze.centroidVertexBuffer)}}function Ko(k,t,h,_,y,w,P){const D=k.context,z=D.gl,V=h.fbo;if(!V)return;const H=k.useProgram("hillshade"),W=k.style.map.terrain&&k.style.map.terrain.getTerrainData(t);D.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,V.colorAttachment.get()),H.draw(D,z.TRIANGLES,y,w,P,ci.disabled,((ne,ge,ke,Me)=>{const Ne=ke.paint.get("hillshade-shadow-color"),ze=ke.paint.get("hillshade-highlight-color"),qe=ke.paint.get("hillshade-accent-color");let Te=ke.paint.get("hillshade-illumination-direction")*(Math.PI/180);ke.paint.get("hillshade-illumination-anchor")==="viewport"&&(Te-=ne.transform.angle);const Ze=!ne.options.moving;return{u_matrix:Me?Me.posMatrix:ne.transform.calculatePosMatrix(ge.tileID.toUnwrapped(),Ze),u_image:0,u_latrange:Fa(0,ge.tileID),u_light:[ke.paint.get("hillshade-exaggeration"),Te],u_shadow:Ne,u_highlight:ze,u_accent:qe}})(k,h,_,W?t:null),W,_.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments)}function Eo(k,t,h,_,y,w){const P=k.context,D=P.gl,z=t.dem;if(z&&z.data){const V=z.dim,H=z.stride,W=z.getPixels();if(P.activeTexture.set(D.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||k.getTileTexture(H),t.demTexture){const ge=t.demTexture;ge.update(W,{premultiply:!1}),ge.bind(D.NEAREST,D.CLAMP_TO_EDGE)}else t.demTexture=new we(P,W,D.RGBA,{premultiply:!1}),t.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);P.activeTexture.set(D.TEXTURE0);let ne=t.fbo;if(!ne){const ge=new we(P,{width:V,height:V,data:null},D.RGBA);ge.bind(D.LINEAR,D.CLAMP_TO_EDGE),ne=t.fbo=P.createFramebuffer(V,V,!0,!1),ne.colorAttachment.set(ge.texture)}P.bindFramebuffer.set(ne.framebuffer),P.viewport.set([0,0,V,V]),k.useProgram("hillshadePrepare").draw(P,D.TRIANGLES,_,y,w,ci.disabled,((ge,ke)=>{const Me=ke.stride,Ne=l.H();return l.aP(Ne,0,l.X,-l.X,0,0,1),l.J(Ne,Ne,[0,-l.X,0]),{u_matrix:Ne,u_image:1,u_dimension:[Me,Me],u_zoom:ge.overscaledZ,u_unpack:ke.getUnpackVector()}})(t.tileID,z),null,h.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Ol(k,t,h,_,y,w){const P=_.paint.get("raster-fade-duration");if(!w&&P>0){const D=L.now(),z=(D-k.timeAdded)/P,V=t?(D-t.timeAdded)/P:-1,H=h.getSource(),W=y.coveringZoomLevel({tileSize:H.tileSize,roundZoom:H.roundZoom}),ne=!t||Math.abs(t.tileID.overscaledZ-W)>Math.abs(k.tileID.overscaledZ-W),ge=ne&&k.refreshedUponExpiration?1:l.ac(ne?z:1-V,0,1);return k.refreshedUponExpiration&&z>=1&&(k.refreshedUponExpiration=!1),t?{opacity:1,mix:1-ge}:{opacity:ge,mix:0}}return{opacity:1,mix:0}}const Fl=new l.aM(1,0,0,1),$n=new l.aM(0,1,0,1),Gs=new l.aM(0,0,1,1),Sc=new l.aM(1,0,1,1),Bl=new l.aM(0,1,1,1);function fr(k,t,h,_){I(k,0,t+h/2,k.transform.width,h,_)}function ws(k,t,h,_){I(k,t-h/2,0,h,k.transform.height,_)}function I(k,t,h,_,y,w){const P=k.context,D=P.gl;D.enable(D.SCISSOR_TEST),D.scissor(t*k.pixelRatio,h*k.pixelRatio,_*k.pixelRatio,y*k.pixelRatio),P.clear({color:w}),D.disable(D.SCISSOR_TEST)}function c(k,t,h){const _=k.context,y=_.gl,w=h.posMatrix,P=k.useProgram("debug"),D=Bn.disabled,z=pi.disabled,V=k.colorModeForRenderPass(),H="$debug",W=k.style.map.terrain&&k.style.map.terrain.getTerrainData(h);_.activeTexture.set(y.TEXTURE0);const ne=t.getTileByID(h.key).latestRawTileData,ge=Math.floor((ne&&ne.byteLength||0)/1024),ke=t.getTile(h).tileSize,Me=512/Math.min(ke,512)*(h.overscaledZ/k.transform.zoom)*.5;let Ne=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Ne+=` => ${h.overscaledZ}`),function(ze,qe){ze.initDebugOverlayCanvas();const Te=ze.debugOverlayCanvas,Ze=ze.context.gl,Ke=ze.debugOverlayCanvas.getContext("2d");Ke.clearRect(0,0,Te.width,Te.height),Ke.shadowColor="white",Ke.shadowBlur=2,Ke.lineWidth=1.5,Ke.strokeStyle="white",Ke.textBaseline="top",Ke.font="bold 36px Open Sans, sans-serif",Ke.fillText(qe,5,5),Ke.strokeText(qe,5,5),ze.debugOverlayTexture.update(Te),ze.debugOverlayTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE)}(k,`${Ne} ${ge}kB`),P.draw(_,y.TRIANGLES,D,z,Di.alphaBlended,ci.disabled,yr(w,l.aM.transparent,Me),null,H,k.debugBuffer,k.quadTriangleIndexBuffer,k.debugSegments),P.draw(_,y.LINE_STRIP,D,z,V,ci.disabled,yr(w,l.aM.red),W,H,k.debugBuffer,k.tileBorderIndexBuffer,k.debugSegments)}function d(k,t,h){const _=k.context,y=_.gl,w=k.colorModeForRenderPass(),P=new Bn(y.LEQUAL,Bn.ReadWrite,k.depthRangeFor3D),D=k.useProgram("terrain"),z=t.getTerrainMesh();_.bindFramebuffer.set(null),_.viewport.set([0,0,k.width,k.height]);for(const V of h){const H=k.renderToTexture.getTexture(V),W=t.getTerrainData(V.tileID);_.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,H.texture);const ne=k.transform.calculatePosMatrix(V.tileID.toUnwrapped()),ge=t.getMeshFrameDelta(k.transform.zoom),ke=k.transform.calculateFogMatrix(V.tileID.toUnwrapped()),Me=El(ne,ge,ke,k.style.sky,k.transform.pitch);D.draw(_,y.TRIANGLES,P,pi.disabled,w,ci.backCCW,Me,W,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}}class p{constructor(t,h,_){this.vertexBuffer=t,this.indexBuffer=h,this.segments=_}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class b{constructor(t,h){this.context=new Ic(t),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Tt.maxUnderzooming+Tt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new zo}resize(t,h,_){if(this.width=Math.floor(t*_),this.height=Math.floor(h*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style._order)this.style._layers[y].resize()}setup(){const t=this.context,h=new l.aX;h.emplaceBack(0,0),h.emplaceBack(l.X,0),h.emplaceBack(0,l.X),h.emplaceBack(l.X,l.X),this.tileExtentBuffer=t.createVertexBuffer(h,es.members),this.tileExtentSegments=l.a0.simpleSegment(0,0,4,2);const _=new l.aX;_.emplaceBack(0,0),_.emplaceBack(l.X,0),_.emplaceBack(0,l.X),_.emplaceBack(l.X,l.X),this.debugBuffer=t.createVertexBuffer(_,es.members),this.debugSegments=l.a0.simpleSegment(0,0,4,5);const y=new l.$;y.emplaceBack(0,0,0,0),y.emplaceBack(l.X,0,l.X,0),y.emplaceBack(0,l.X,0,l.X),y.emplaceBack(l.X,l.X,l.X,l.X),this.rasterBoundsBuffer=t.createVertexBuffer(y,Kn.members),this.rasterBoundsSegments=l.a0.simpleSegment(0,0,4,2);const w=new l.aX;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(w,es.members),this.viewportSegments=l.a0.simpleSegment(0,0,4,2);const P=new l.aZ;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(P);const D=new l.aY;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(D);const z=this.context.gl;this.stencilClearMode=new pi({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO)}clearStencil(){const t=this.context,h=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=l.H();l.aP(_,0,this.width,this.height,0,0,1),l.K(_,_,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,h.TRIANGLES,Bn.disabled,this.stencilClearMode,Di.disabled,ci.disabled,bi(_),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,h){if(this.currentStencilSource===t.source||!t.isTileClipped()||!h||!h.length)return;this.currentStencilSource=t.source;const _=this.context,y=_.gl;this.nextStencilID+h.length>256&&this.clearStencil(),_.setColorMode(Di.disabled),_.setDepthMode(Bn.disabled);const w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of h){const D=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(P);w.draw(_,y.TRIANGLES,Bn.disabled,new pi({func:y.ALWAYS,mask:0},D,255,y.KEEP,y.KEEP,y.REPLACE),Di.disabled,ci.disabled,bi(P.posMatrix),z,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,h=this.context.gl;return new pi({func:h.NOTEQUAL,mask:255},t,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(t){const h=this.context.gl;return new pi({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(t){const h=this.context.gl,_=t.sort((P,D)=>D.overscaledZ-P.overscaledZ),y=_[_.length-1].overscaledZ,w=_[0].overscaledZ-y+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const P={};for(let D=0;D<w;D++)P[D+y]=new pi({func:h.GEQUAL,mask:255},D+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=w,[P,_]}return[{[y]:pi.disabled},_]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Di([t.CONSTANT_COLOR,t.ONE],new l.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Di.unblended:Di.alphaBlended}depthModeForSublayer(t,h,_){if(!this.opaquePassEnabledForLayer())return Bn.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Bn(_||this.context.gl.LEQUAL,h,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,h){this.style=t,this.options=h,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(L.now()),this.imageManager.beginFrame();const _=this.style._order,y=this.style.sourceCaches,w={},P={},D={};for(const z in y){const V=y[z];V.used&&V.prepare(this.context),w[z]=V.getVisibleCoordinates(),P[z]=w[z].slice().reverse(),D[z]=V.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<_.length;z++)if(this.style._layers[_[z]].is3D()){this.opaquePassCutoff=z;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const z of _){const V=this.style._layers[z];if(!V.hasOffscreenPass()||V.isHidden(this.transform.zoom))continue;const H=P[V.source];(V.type==="custom"||H.length)&&this.renderLayer(this,y[V.source],V,H)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?l.aM.black:l.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(z,V){const H=z.context,W=H.gl,ne=((ze,qe,Te)=>({u_sky_color:ze.properties.get("sky-color"),u_horizon_color:ze.properties.get("horizon-color"),u_horizon:(qe.height/2+qe.getHorizon())*Te,u_sky_horizon_blend:ze.properties.get("sky-horizon-blend")*qe.height/2*Te}))(V,z.style.map.transform,z.pixelRatio),ge=new Bn(W.LEQUAL,Bn.ReadWrite,[0,1]),ke=pi.disabled,Me=z.colorModeForRenderPass(),Ne=z.useProgram("sky");if(!V.mesh){const ze=new l.aX;ze.emplaceBack(-1,-1),ze.emplaceBack(1,-1),ze.emplaceBack(1,1),ze.emplaceBack(-1,1);const qe=new l.aY;qe.emplaceBack(0,1,2),qe.emplaceBack(0,2,3),V.mesh=new p(H.createVertexBuffer(ze,es.members),H.createIndexBuffer(qe),l.a0.simpleSegment(0,0,ze.length,qe.length))}Ne.draw(H,W.TRIANGLES,ge,ke,Me,ci.disabled,ne,void 0,"sky",V.mesh.vertexBuffer,V.mesh.indexBuffer,V.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const z=this.style._layers[_[this.currentLayer]],V=y[z.source],H=w[z.source];this._renderTileClippingMasks(z,H),this.renderLayer(this,V,z,H)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const z=this.style._layers[_[this.currentLayer]],V=y[z.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(z))continue;const H=(z.type==="symbol"?D:P)[z.source];this._renderTileClippingMasks(z,w[z.source]),this.renderLayer(this,V,z,H)}if(this.options.showTileBoundaries){const z=function(V,H){let W=null;const ne=Object.values(V._layers).flatMap(Ne=>Ne.source&&!Ne.isHidden(H)?[V.sourceCaches[Ne.source]]:[]),ge=ne.filter(Ne=>Ne.getSource().type==="vector"),ke=ne.filter(Ne=>Ne.getSource().type!=="vector"),Me=Ne=>{(!W||W.getSource().maxzoom<Ne.getSource().maxzoom)&&(W=Ne)};return ge.forEach(Ne=>Me(Ne)),W||ke.forEach(Ne=>Me(Ne)),W}(this.style,this.transform.zoom);z&&function(V,H,W){for(let ne=0;ne<W.length;ne++)c(V,H,W[ne])}(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){const V=z.transform.padding;fr(z,z.transform.height-(V.top||0),3,Fl),fr(z,V.bottom||0,3,$n),ws(z,V.left||0,3,Gs),ws(z,z.transform.width-(V.right||0),3,Sc);const H=z.transform.centerPoint;(function(W,ne,ge,ke){I(W,ne-1,ge-10,2,20,ke),I(W,ne-10,ge-1,20,2,ke)})(z,H.x,z.transform.height-H.y,Bl)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,_=this.transform.modelViewProjectionMatrix;let y=this.terrainFacilitator.dirty;y||(y=t?!l.a_(h,_):!l.a$(h,_)),y||(y=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),y&&(l.b0(h,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(w,P){const D=w.context,z=D.gl,V=Di.unblended,H=new Bn(z.LEQUAL,Bn.ReadWrite,[0,1]),W=P.getTerrainMesh(),ne=P.sourceCache.getRenderableTiles(),ge=w.useProgram("terrainDepth");D.bindFramebuffer.set(P.getFramebuffer("depth").framebuffer),D.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),D.clear({color:l.aM.transparent,depth:1});for(const ke of ne){const Me=P.getTerrainData(ke.tileID),Ne={u_matrix:w.transform.calculatePosMatrix(ke.tileID.toUnwrapped()),u_ele_delta:P.getMeshFrameDelta(w.transform.zoom)};ge.draw(D,z.TRIANGLES,H,pi.disabled,V,ci.backCCW,Ne,Me,"terrain",W.vertexBuffer,W.indexBuffer,W.segments)}D.bindFramebuffer.set(null),D.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain),function(w,P){const D=w.context,z=D.gl,V=Di.unblended,H=new Bn(z.LEQUAL,Bn.ReadWrite,[0,1]),W=P.getTerrainMesh(),ne=P.getCoordsTexture(),ge=P.sourceCache.getRenderableTiles(),ke=w.useProgram("terrainCoords");D.bindFramebuffer.set(P.getFramebuffer("coords").framebuffer),D.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),D.clear({color:l.aM.transparent,depth:1}),P.coordsIndex=[];for(const Me of ge){const Ne=P.getTerrainData(Me.tileID);D.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,ne.texture);const ze={u_matrix:w.transform.calculatePosMatrix(Me.tileID.toUnwrapped()),u_terrain_coords_id:(255-P.coordsIndex.length)/255,u_texture:0,u_ele_delta:P.getMeshFrameDelta(w.transform.zoom)};ke.draw(D,z.TRIANGLES,H,pi.disabled,V,ci.backCCW,ze,Ne,"terrain",W.vertexBuffer,W.indexBuffer,W.segments),P.coordsIndex.push(Me.tileID.key)}D.bindFramebuffer.set(null),D.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain))}renderLayer(t,h,_,y){if(!_.isHidden(this.transform.zoom)&&(_.type==="background"||_.type==="custom"||(y||[]).length))switch(this.id=_.id,_.type){case"symbol":(function(w,P,D,z,V){if(w.renderPass!=="translucent")return;const H=pi.disabled,W=w.colorModeForRenderPass();(D._unevaluatedLayout.hasValue("text-variable-anchor")||D._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ne,ge,ke,Me,Ne,ze,qe,Te,Ze){const Ke=ge.transform,it=Kr(),bt=Ne==="map",Rt=ze==="map";for(const Ht of ne){const Yt=Me.getTile(Ht),jt=Yt.getBucket(ke);if(!jt||!jt.text||!jt.text.segments.get().length)continue;const Ut=l.ag(jt.textSizeData,Ke.zoom),rn=Fn(Yt,1,ge.transform.zoom),Tn=Ki(Ht.posMatrix,Rt,bt,ge.transform,rn),qt=ke.layout.get("icon-text-fit")!=="none"&&jt.hasIconData();if(Ut){const Xt=Math.pow(2,Ke.zoom-Yt.tileID.overscaledZ),In=ge.style.map.terrain?(On,jn)=>ge.style.map.terrain.getElevation(Ht,On,jn):null,Si=it.translatePosition(Ke,Yt,qe,Te);Ho(jt,bt,Rt,Ze,Ke,Tn,Ht.posMatrix,Xt,Ut,qt,it,Si,Ht.toUnwrapped(),In)}}}(z,w,D,P,D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),V),D.paint.get("icon-opacity").constantOr(1)!==0&&Dl(w,P,D,z,!1,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),D.layout.get("icon-rotation-alignment"),D.layout.get("icon-pitch-alignment"),D.layout.get("icon-keep-upright"),H,W),D.paint.get("text-opacity").constantOr(1)!==0&&Dl(w,P,D,z,!0,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.layout.get("text-keep-upright"),H,W),P.map.showCollisionBoxes&&(ba(w,P,D,z,!0),ba(w,P,D,z,!1))})(t,h,_,y,this.style.placement.variableOffsets);break;case"circle":(function(w,P,D,z){if(w.renderPass!=="translucent")return;const V=D.paint.get("circle-opacity"),H=D.paint.get("circle-stroke-width"),W=D.paint.get("circle-stroke-opacity"),ne=!D.layout.get("circle-sort-key").isConstant();if(V.constantOr(1)===0&&(H.constantOr(1)===0||W.constantOr(1)===0))return;const ge=w.context,ke=ge.gl,Me=w.depthModeForSublayer(0,Bn.ReadOnly),Ne=pi.disabled,ze=w.colorModeForRenderPass(),qe=[];for(let Te=0;Te<z.length;Te++){const Ze=z[Te],Ke=P.getTile(Ze),it=Ke.getBucket(D);if(!it)continue;const bt=it.programConfigurations.get(D.id),Rt=w.useProgram("circle",bt),Ht=it.layoutVertexBuffer,Yt=it.indexBuffer,jt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ze),Ut={programConfiguration:bt,program:Rt,layoutVertexBuffer:Ht,indexBuffer:Yt,uniformValues:vc(w,Ze,Ke,D),terrainData:jt};if(ne){const rn=it.segments.get();for(const Tn of rn)qe.push({segments:new l.a0([Tn]),sortKey:Tn.sortKey,state:Ut})}else qe.push({segments:it.segments,sortKey:0,state:Ut})}ne&&qe.sort((Te,Ze)=>Te.sortKey-Ze.sortKey);for(const Te of qe){const{programConfiguration:Ze,program:Ke,layoutVertexBuffer:it,indexBuffer:bt,uniformValues:Rt,terrainData:Ht}=Te.state;Ke.draw(ge,ke.TRIANGLES,Me,Ne,ze,ci.disabled,Rt,Ht,D.id,it,bt,Te.segments,D.paint,w.transform.zoom,Ze)}})(t,h,_,y);break;case"heatmap":(function(w,P,D,z){if(D.paint.get("heatmap-opacity")===0)return;const V=w.context;if(w.style.map.terrain){for(const H of z){const W=P.getTile(H);P.hasRenderableParent(H)||(w.renderPass==="offscreen"?zl(w,W,D,H):w.renderPass==="translucent"&&ao(w,D,H))}V.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?function(H,W,ne,ge){const ke=H.context,Me=ke.gl,Ne=pi.disabled,ze=new Di([Me.ONE,Me.ONE],l.aM.transparent,[!0,!0,!0,!0]);(function(qe,Te,Ze){const Ke=qe.gl;qe.activeTexture.set(Ke.TEXTURE1),qe.viewport.set([0,0,Te.width/4,Te.height/4]);let it=Ze.heatmapFbos.get(l.aU);it?(Ke.bindTexture(Ke.TEXTURE_2D,it.colorAttachment.get()),qe.bindFramebuffer.set(it.framebuffer)):(it=Wo(qe,Te.width/4,Te.height/4),Ze.heatmapFbos.set(l.aU,it))})(ke,H,ne),ke.clear({color:l.aM.transparent});for(let qe=0;qe<ge.length;qe++){const Te=ge[qe];if(W.hasRenderableParent(Te))continue;const Ze=W.getTile(Te),Ke=Ze.getBucket(ne);if(!Ke)continue;const it=Ke.programConfigurations.get(ne.id),bt=H.useProgram("heatmap",it),{zoom:Rt}=H.transform;bt.draw(ke,Me.TRIANGLES,Bn.disabled,Ne,ze,ci.disabled,cr(Te.posMatrix,Ze,Rt,ne.paint.get("heatmap-intensity")),null,ne.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,ne.paint,H.transform.zoom,it)}ke.viewport.set([0,0,H.width,H.height])}(w,P,D,z):w.renderPass==="translucent"&&function(H,W){const ne=H.context,ge=ne.gl;ne.setColorMode(H.colorModeForRenderPass());const ke=W.heatmapFbos.get(l.aU);ke&&(ne.activeTexture.set(ge.TEXTURE0),ge.bindTexture(ge.TEXTURE_2D,ke.colorAttachment.get()),ne.activeTexture.set(ge.TEXTURE1),Xo(ne,W).bind(ge.LINEAR,ge.CLAMP_TO_EDGE),H.useProgram("heatmapTexture").draw(ne,ge.TRIANGLES,Bn.disabled,pi.disabled,H.colorModeForRenderPass(),ci.disabled,Oa(H,W,0,1),null,W.id,H.viewportBuffer,H.quadTriangleIndexBuffer,H.viewportSegments,W.paint,H.transform.zoom))}(w,D)})(t,h,_,y);break;case"line":(function(w,P,D,z){if(w.renderPass!=="translucent")return;const V=D.paint.get("line-opacity"),H=D.paint.get("line-width");if(V.constantOr(1)===0||H.constantOr(1)===0)return;const W=w.depthModeForSublayer(0,Bn.ReadOnly),ne=w.colorModeForRenderPass(),ge=D.paint.get("line-dasharray"),ke=D.paint.get("line-pattern"),Me=ke.constantOr(1),Ne=D.paint.get("line-gradient"),ze=D.getCrossfadeParameters(),qe=Me?"linePattern":ge?"lineSDF":Ne?"lineGradient":"line",Te=w.context,Ze=Te.gl;let Ke=!0;for(const it of z){const bt=P.getTile(it);if(Me&&!bt.patternsLoaded())continue;const Rt=bt.getBucket(D);if(!Rt)continue;const Ht=Rt.programConfigurations.get(D.id),Yt=w.context.program.get(),jt=w.useProgram(qe,Ht),Ut=Ke||jt.program!==Yt,rn=w.style.map.terrain&&w.style.map.terrain.getTerrainData(it),Tn=ke.constantOr(null);if(Tn&&bt.imageAtlas){const In=bt.imageAtlas,Si=In.patternPositions[Tn.to.toString()],On=In.patternPositions[Tn.from.toString()];Si&&On&&Ht.setConstantPatternPositions(Si,On)}const qt=rn?it:null,Xt=Me?Fo(w,bt,D,ze,qt):ge?ou(w,bt,D,ge,ze,qt):Ne?ma(w,bt,D,Rt.lineClipsArray.length,qt):pa(w,bt,D,qt);if(Me)Te.activeTexture.set(Ze.TEXTURE0),bt.imageAtlasTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE),Ht.updatePaintBuffers(ze);else if(ge&&(Ut||w.lineAtlas.dirty))Te.activeTexture.set(Ze.TEXTURE0),w.lineAtlas.bind(Te);else if(Ne){const In=Rt.gradients[D.id];let Si=In.texture;if(D.gradientVersion!==In.version){let On=256;if(D.stepInterpolant){const jn=P.getSource().maxzoom,Ei=it.canonical.z===jn?Math.ceil(1<<w.transform.maxZoom-it.canonical.z):1;On=l.ac(l.aV(Rt.maxLineLength/l.X*1024*Ei),256,Te.maxTextureSize)}In.gradient=l.aW({expression:D.gradientExpression(),evaluationKey:"lineProgress",resolution:On,image:In.gradient||void 0,clips:Rt.lineClipsArray}),In.texture?In.texture.update(In.gradient):In.texture=new we(Te,In.gradient,Ze.RGBA),In.version=D.gradientVersion,Si=In.texture}Te.activeTexture.set(Ze.TEXTURE0),Si.bind(D.stepInterpolant?Ze.NEAREST:Ze.LINEAR,Ze.CLAMP_TO_EDGE)}jt.draw(Te,Ze.TRIANGLES,W,w.stencilModeForClipping(it),ne,ci.disabled,Xt,rn,D.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Rt.segments,D.paint,w.transform.zoom,Ht,Rt.layoutVertexBuffer2),Ke=!1}})(t,h,_,y);break;case"fill":(function(w,P,D,z){const V=D.paint.get("fill-color"),H=D.paint.get("fill-opacity");if(H.constantOr(1)===0)return;const W=w.colorModeForRenderPass(),ne=D.paint.get("fill-pattern"),ge=w.opaquePassEnabledForLayer()&&!ne.constantOr(1)&&V.constantOr(l.aM.transparent).a===1&&H.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===ge){const ke=w.depthModeForSublayer(1,w.renderPass==="opaque"?Bn.ReadWrite:Bn.ReadOnly);Yo(w,P,D,z,ke,W,!1)}if(w.renderPass==="translucent"&&D.paint.get("fill-antialias")){const ke=w.depthModeForSublayer(D.getPaintProperty("fill-outline-color")?2:0,Bn.ReadOnly);Yo(w,P,D,z,ke,W,!0)}})(t,h,_,y);break;case"fill-extrusion":(function(w,P,D,z){const V=D.paint.get("fill-extrusion-opacity");if(V!==0&&w.renderPass==="translucent"){const H=new Bn(w.context.gl.LEQUAL,Bn.ReadWrite,w.depthRangeFor3D);if(V!==1||D.paint.get("fill-extrusion-pattern").constantOr(1))Jo(w,P,D,z,H,pi.disabled,Di.disabled),Jo(w,P,D,z,H,w.stencilModeFor3D(),w.colorModeForRenderPass());else{const W=w.colorModeForRenderPass();Jo(w,P,D,z,H,pi.disabled,W)}}})(t,h,_,y);break;case"hillshade":(function(w,P,D,z){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const V=w.context,H=w.depthModeForSublayer(0,Bn.ReadOnly),W=w.colorModeForRenderPass(),[ne,ge]=w.renderPass==="translucent"?w.stencilConfigForOverlap(z):[{},z];for(const ke of ge){const Me=P.getTile(ke);Me.needsHillshadePrepare!==void 0&&Me.needsHillshadePrepare&&w.renderPass==="offscreen"?Eo(w,Me,D,H,pi.disabled,W):w.renderPass==="translucent"&&Ko(w,ke,Me,D,H,ne[ke.overscaledZ],W)}V.viewport.set([0,0,w.width,w.height])})(t,h,_,y);break;case"raster":(function(w,P,D,z){if(w.renderPass!=="translucent"||D.paint.get("raster-opacity")===0||!z.length)return;const V=w.context,H=V.gl,W=P.getSource(),ne=w.useProgram("raster"),ge=w.colorModeForRenderPass(),[ke,Me]=W instanceof Yi?[{},z]:w.stencilConfigForOverlap(z),Ne=Me[Me.length-1].overscaledZ,ze=!w.options.moving;for(const qe of Me){const Te=w.depthModeForSublayer(qe.overscaledZ-Ne,D.paint.get("raster-opacity")===1?Bn.ReadWrite:Bn.ReadOnly,H.LESS),Ze=P.getTile(qe);Ze.registerFadeDuration(D.paint.get("raster-fade-duration"));const Ke=P.findLoadedParent(qe,0),it=P.findLoadedSibling(qe),bt=Ol(Ze,Ke||it||null,P,D,w.transform,w.style.map.terrain);let Rt,Ht;const Yt=D.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR;V.activeTexture.set(H.TEXTURE0),Ze.texture.bind(Yt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),V.activeTexture.set(H.TEXTURE1),Ke?(Ke.texture.bind(Yt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),Rt=Math.pow(2,Ke.tileID.overscaledZ-Ze.tileID.overscaledZ),Ht=[Ze.tileID.canonical.x*Rt%1,Ze.tileID.canonical.y*Rt%1]):Ze.texture.bind(Yt,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),Ze.texture.useMipmap&&V.extTextureFilterAnisotropic&&w.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax);const jt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(qe),Ut=jt?qe:null,rn=Ut?Ut.posMatrix:w.transform.calculatePosMatrix(qe.toUnwrapped(),ze),Tn=Tl(rn,Ht||[0,0],Rt||1,bt,D);W instanceof Yi?ne.draw(V,H.TRIANGLES,Te,pi.disabled,ge,ci.disabled,Tn,jt,D.id,W.boundsBuffer,w.quadTriangleIndexBuffer,W.boundsSegments):ne.draw(V,H.TRIANGLES,Te,ke[qe.overscaledZ],ge,ci.disabled,Tn,jt,D.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}})(t,h,_,y);break;case"background":(function(w,P,D,z){const V=D.paint.get("background-color"),H=D.paint.get("background-opacity");if(H===0)return;const W=w.context,ne=W.gl,ge=w.transform,ke=ge.tileSize,Me=D.paint.get("background-pattern");if(w.isPatternMissing(Me))return;const Ne=!Me&&V.a===1&&H===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==Ne)return;const ze=pi.disabled,qe=w.depthModeForSublayer(0,Ne==="opaque"?Bn.ReadWrite:Bn.ReadOnly),Te=w.colorModeForRenderPass(),Ze=w.useProgram(Me?"backgroundPattern":"background"),Ke=z||ge.coveringTiles({tileSize:ke,terrain:w.style.map.terrain});Me&&(W.activeTexture.set(ne.TEXTURE0),w.imageManager.bind(w.context));const it=D.getCrossfadeParameters();for(const bt of Ke){const Rt=z?bt.posMatrix:w.transform.calculatePosMatrix(bt.toUnwrapped()),Ht=Me?_a(Rt,H,w,Me,{tileID:bt,tileSize:ke},it):ga(Rt,H,V),Yt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(bt);Ze.draw(W,ne.TRIANGLES,qe,ze,Te,ci.disabled,Ht,Yt,D.id,w.tileExtentBuffer,w.quadTriangleIndexBuffer,w.tileExtentSegments)}})(t,0,_,y);break;case"custom":(function(w,P,D){const z=w.context,V=D.implementation;if(w.renderPass==="offscreen"){const H=V.prerender;H&&(w.setCustomLayerDefaults(),z.setColorMode(w.colorModeForRenderPass()),H.call(V,z.gl,w.transform.customLayerMatrix()),z.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),z.setColorMode(w.colorModeForRenderPass()),z.setStencilMode(pi.disabled);const H=V.renderingMode==="3d"?new Bn(w.context.gl.LEQUAL,Bn.ReadWrite,w.depthRangeFor3D):w.depthModeForSublayer(0,Bn.ReadOnly);z.setDepthMode(H),V.render(z.gl,w.transform.customLayerMatrix(),{farZ:w.transform.farZ,nearZ:w.transform.nearZ,fov:w.transform._fov,modelViewProjectionMatrix:w.transform.modelViewProjectionMatrix,projectionMatrix:w.transform.projectionMatrix}),z.setDirty(),w.setBaseState(),z.bindFramebuffer.set(null)}})(t,0,_)}}translatePosMatrix(t,h,_,y,w){if(!_[0]&&!_[1])return t;const P=w?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(P){const V=Math.sin(P),H=Math.cos(P);_=[_[0]*H-_[1]*V,_[0]*V+_[1]*H]}const D=[w?_[0]:Fn(h,_[0],this.transform.zoom),w?_[1]:Fn(h,_[1],this.transform.zoom),0],z=new Float32Array(16);return l.J(z,t,D),z}saveTileTexture(t){const h=this._tileTextures[t.size[0]];h?h.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const h=this._tileTextures[t];return h&&h.length>0?h.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const h=this.imageManager.getPattern(t.from.toString()),_=this.imageManager.getPattern(t.to.toString());return!h||!_}useProgram(t,h){this.cache=this.cache||{};const _=t+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[_]||(this.cache[_]=new wo(this.context,ro[t],h,Ba[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new we(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:h}=this.context.gl;return this.width!==t||this.height!==h}}class M{constructor(t,h){this.points=t,this.planes=h}static fromInvProjectionMatrix(t,h,_){const y=Math.pow(2,_),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const z=1/(D=l.af([],D,t))[3]/h*y;return l.b1(D,D,[z,z,1/D[3],z])}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const z=function(ne,ge){var ke=ge[0],Me=ge[1],Ne=ge[2],ze=ke*ke+Me*Me+Ne*Ne;return ze>0&&(ze=1/Math.sqrt(ze)),ne[0]=ge[0]*ze,ne[1]=ge[1]*ze,ne[2]=ge[2]*ze,ne}([],function(ne,ge,ke){var Me=ge[0],Ne=ge[1],ze=ge[2],qe=ke[0],Te=ke[1],Ze=ke[2];return ne[0]=Ne*Ze-ze*Te,ne[1]=ze*qe-Me*Ze,ne[2]=Me*Te-Ne*qe,ne}([],he([],w[D[0]],w[D[1]]),he([],w[D[2]],w[D[1]]))),V=-((H=z)[0]*(W=w[D[1]])[0]+H[1]*W[1]+H[2]*W[2]);var H,W;return z.concat(V)});return new M(w,P)}}class F{constructor(t,h){this.min=t,this.max=h,this.center=function(_,y,w){return _[0]=.5*y[0],_[1]=.5*y[1],_[2]=.5*y[2],_}([],function(_,y,w){return _[0]=y[0]+w[0],_[1]=y[1]+w[1],_[2]=y[2]+w[2],_}([],this.min,this.max))}quadrant(t){const h=[t%2==0,t<2],_=ve(this.min),y=ve(this.max);for(let w=0;w<h.length;w++)_[w]=h[w]?this.min[w]:this.center[w],y[w]=h[w]?this.center[w]:this.max[w];return y[2]=this.max[2],new F(_,y)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let _=!0;for(let y=0;y<t.planes.length;y++){const w=t.planes[y];let P=0;for(let D=0;D<h.length;D++)l.b2(w,h[D])>=0&&P++;if(P===0)return 0;P!==h.length&&(_=!1)}if(_)return 2;for(let y=0;y<3;y++){let w=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let D=0;D<t.points.length;D++){const z=t.points[D][y]-this.min[y];w=Math.min(w,z),P=Math.max(P,z)}if(P<0||w>this.max[y]-this.min[y])return 0}return 1}}class q{constructor(t=0,h=0,_=0,y=0){if(isNaN(t)||t<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=h,this.left=_,this.right=y}interpolate(t,h,_){return h.top!=null&&t.top!=null&&(this.top=l.y.number(t.top,h.top,_)),h.bottom!=null&&t.bottom!=null&&(this.bottom=l.y.number(t.bottom,h.bottom,_)),h.left!=null&&t.left!=null&&(this.left=l.y.number(t.left,h.left,_)),h.right!=null&&t.right!=null&&(this.right=l.y.number(t.right,h.right,_)),this}getCenter(t,h){const _=l.ac((this.left+t-this.right)/2,0,t),y=l.ac((this.top+h-this.bottom)/2,0,h);return new l.P(_,y)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new q(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Y=85.051129;class me{constructor(t,h,_,y,w){this.tileSize=512,this._renderWorldCopies=w===void 0||!!w,this._minZoom=t||0,this._maxZoom=h||22,this._minPitch=_??0,this._maxPitch=y??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new q,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new me(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.lngRange=t.lngRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const h=-l.b3(t,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var _=new l.A(4);return l.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}(),function(_,y,w){var P=y[0],D=y[1],z=y[2],V=y[3],H=Math.sin(w),W=Math.cos(w);_[0]=P*W+z*H,_[1]=D*W+V*H,_[2]=P*-H+z*W,_[3]=D*-H+V*W}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const h=l.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const h=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,h,_){this._unmodified=!1,this._edgeInsets.interpolate(t,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const h=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(t){const h=[new l.b4(0,t)];if(this._renderWorldCopies){const _=this.pointCoordinate(new l.P(0,0)),y=this.pointCoordinate(new l.P(this.width,0)),w=this.pointCoordinate(new l.P(this.width,this.height)),P=this.pointCoordinate(new l.P(0,this.height)),D=Math.floor(Math.min(_.x,y.x,w.x,P.x)),z=Math.floor(Math.max(_.x,y.x,w.x,P.x)),V=1;for(let H=D-V;H<=z+V;H++)H!==0&&h.push(new l.b4(H,t))}return h}coveringTiles(t){var h,_;let y=this.coveringZoomLevel(t);const w=y;if(t.minzoom!==void 0&&y<t.minzoom)return[];t.maxzoom!==void 0&&y>t.maxzoom&&(y=t.maxzoom);const P=this.pointCoordinate(this.getCameraPoint()),D=l.Z.fromLngLat(this.center),z=Math.pow(2,y),V=[z*P.x,z*P.y,0],H=[z*D.x,z*D.y,0],W=M.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,y);let ne=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ne=y);const ge=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,ke=Te=>({aabb:new F([Te*z,0,0],[(Te+1)*z,z,0]),zoom:0,x:0,y:0,wrap:Te,fullyVisible:!1}),Me=[],Ne=[],ze=y,qe=t.reparseOverscaled?w:y;if(this._renderWorldCopies)for(let Te=1;Te<=3;Te++)Me.push(ke(-Te)),Me.push(ke(Te));for(Me.push(ke(0));Me.length>0;){const Te=Me.pop(),Ze=Te.x,Ke=Te.y;let it=Te.fullyVisible;if(!it){const jt=Te.aabb.intersects(W);if(jt===0)continue;it=jt===2}const bt=t.terrain?V:H,Rt=Te.aabb.distanceX(bt),Ht=Te.aabb.distanceY(bt),Yt=Math.max(Math.abs(Rt),Math.abs(Ht));if(Te.zoom===ze||Yt>ge+(1<<ze-Te.zoom)-2&&Te.zoom>=ne){const jt=ze-Te.zoom,Ut=V[0]-.5-(Ze<<jt),rn=V[1]-.5-(Ke<<jt);Ne.push({tileID:new l.S(Te.zoom===ze?qe:Te.zoom,Te.wrap,Te.zoom,Ze,Ke),distanceSq:xe([H[0]-.5-Ze,H[1]-.5-Ke]),tileDistanceToCamera:Math.sqrt(Ut*Ut+rn*rn)})}else for(let jt=0;jt<4;jt++){const Ut=(Ze<<1)+jt%2,rn=(Ke<<1)+(jt>>1),Tn=Te.zoom+1;let qt=Te.aabb.quadrant(jt);if(t.terrain){const Xt=new l.S(Tn,Te.wrap,Tn,Ut,rn),In=t.terrain.getMinMaxElevation(Xt),Si=(h=In.minElevation)!==null&&h!==void 0?h:this.elevation,On=(_=In.maxElevation)!==null&&_!==void 0?_:this.elevation;qt=new F([qt.min[0],qt.min[1],Si],[qt.max[0],qt.max[1],On])}Me.push({aabb:qt,zoom:Tn,x:Ut,y:rn,wrap:Te.wrap,fullyVisible:it})}}return Ne.sort((Te,Ze)=>Te.distanceSq-Ze.distanceSq).map(Te=>Te.tileID)}resize(t,h){this.width=t,this.height=h,this.pixelsToGLUnits=[2/t,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const h=l.ac(t.lat,-85.051129,Y);return new l.P(l.O(t.lng)*this.worldSize,l.Q(h)*this.worldSize)}unproject(t){return new l.Z(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const h=this.elevation,_=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,y=this.pointLocation(this.centerPoint,t),w=t.getElevationForLngLatZoom(y,this.tileZoom);if(!(this.elevation-w))return;const P=_+h-w,D=Math.cos(this._pitch)*this.cameraToCenterDistance/P/l.b5(1,y.lat),z=this.scaleZoom(D/this.tileSize);this._elevation=w,this._center=y,this.zoom=z}setLocationAtPoint(t,h){const _=this.pointCoordinate(h),y=this.pointCoordinate(this.centerPoint),w=this.locationCoordinate(t),P=new l.Z(w.x-(_.x-y.x),w.y-(_.y-y.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,h){return h?this.coordinatePoint(this.locationCoordinate(t),h.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,h){return this.coordinateLocation(this.pointCoordinate(t,h))}locationCoordinate(t){return l.Z.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,h){if(h){const ne=h.pointCoordinate(t);if(ne!=null)return ne}const _=[t.x,t.y,0,1],y=[t.x,t.y,1,1];l.af(_,_,this.pixelMatrixInverse),l.af(y,y,this.pixelMatrixInverse);const w=_[3],P=y[3],D=_[1]/w,z=y[1]/P,V=_[2]/w,H=y[2]/P,W=V===H?0:(0-V)/(H-V);return new l.Z(l.y.number(_[0]/w,y[0]/P,W)/this.worldSize,l.y.number(D,z,W)/this.worldSize)}coordinatePoint(t,h=0,_=this.pixelMatrix){const y=[t.x*this.worldSize,t.y*this.worldSize,h,1];return l.af(y,y,_),new l.P(y[0]/y[3],y[1]/y[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Ye().extend(this.pointLocation(new l.P(0,t))).extend(this.pointLocation(new l.P(this.width,t))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ye([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Y])}calculateTileMatrix(t){const h=t.canonical,_=this.worldSize/this.zoomScale(h.z),y=h.x+Math.pow(2,h.z)*t.wrap,w=l.an(new Float64Array(16));return l.J(w,w,[y*_,h.y*_,0]),l.K(w,w,[_/l.X,_/l.X,1]),w}calculatePosMatrix(t,h=!1){const _=t.key,y=h?this._alignedPosMatrixCache:this._posMatrixCache;if(y[_])return y[_];const w=this.calculateTileMatrix(t);return l.L(w,h?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,w),y[_]=new Float32Array(w),y[_]}calculateFogMatrix(t){const h=t.key,_=this._fogMatrixCache;if(_[h])return _[h];const y=this.calculateTileMatrix(t);return l.L(y,this.fogMatrix,y),_[h]=new Float32Array(y),_[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,h){h=l.ac(+h,this.minZoom,this.maxZoom);const _={center:new l.N(t.lng,t.lat),zoom:h};let y=this.lngRange;if(!this._renderWorldCopies&&y===null){const Te=179.9999999999;y=[-Te,Te]}const w=this.tileSize*this.zoomScale(_.zoom);let P=0,D=w,z=0,V=w,H=0,W=0;const{x:ne,y:ge}=this.size;if(this.latRange){const Te=this.latRange;P=l.Q(Te[1])*w,D=l.Q(Te[0])*w,D-P<ge&&(H=ge/(D-P))}y&&(z=l.b3(l.O(y[0])*w,0,w),V=l.b3(l.O(y[1])*w,0,w),V<z&&(V+=w),V-z<ne&&(W=ne/(V-z)));const{x:ke,y:Me}=this.project.call({worldSize:w},t);let Ne,ze;const qe=Math.max(W||0,H||0);if(qe){const Te=new l.P(W?(V+z)/2:ke,H?(D+P)/2:Me);return _.center=this.unproject.call({worldSize:w},Te).wrap(),_.zoom+=this.scaleZoom(qe),_}if(this.latRange){const Te=ge/2;Me-Te<P&&(ze=P+Te),Me+Te>D&&(ze=D-Te)}if(y){const Te=(z+V)/2;let Ze=ke;this._renderWorldCopies&&(Ze=l.b3(ke,Te-w/2,Te+w/2));const Ke=ne/2;Ze-Ke<z&&(Ne=z+Ke),Ze+Ke>V&&(Ne=V-Ke)}if(Ne!==void 0||ze!==void 0){const Te=new l.P(Ne??ke,ze??Me);_.center=this.unproject.call({worldSize:w},Te).wrap()}return _}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:h,zoom:_}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=_,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,h=this.point.x,_=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b5(1,this.center.lat)*this.worldSize;let y=l.an(new Float64Array(16));l.K(y,y,[this.width/2,-this.height/2,1]),l.J(y,y,[1,-1,0]),this.labelPlaneMatrix=y,y=l.an(new Float64Array(16)),l.K(y,y,[1,-1,1]),l.J(y,y,[-1,-1,0]),l.K(y,y,[2/this.width,2/this.height,1]),this.glCoordMatrix=y;const w=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),P=Math.min(this.elevation,this.minElevationForCurrentTile),D=w-P*this._pixelPerMeter/Math.cos(this._pitch),z=P<0?D:w,V=Math.PI/2+this._pitch,H=this._fov*(.5+t.y/this.height),W=Math.sin(H)*z/Math.sin(l.ac(Math.PI-V-H,.01,Math.PI-.01)),ne=this.getHorizon(),ge=2*Math.atan(ne/this.cameraToCenterDistance)*(.5+t.y/(2*ne)),ke=Math.sin(ge)*z/Math.sin(l.ac(Math.PI-V-ge,.01,Math.PI-.01)),Me=Math.min(W,ke);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Me+z),this.nearZ=this.height/50,y=new Float64Array(16),l.b6(y,this._fov,this.width/this.height,this.nearZ,this.farZ),y[8]=2*-t.x/this.width,y[9]=2*t.y/this.height,this.projectionMatrix=l.ae(y),l.K(y,y,[1,-1,1]),l.J(y,y,[0,0,-this.cameraToCenterDistance]),l.b7(y,y,this._pitch),l.ad(y,y,this.angle),l.J(y,y,[-h,-_,0]),this.mercatorMatrix=l.K([],y,[this.worldSize,this.worldSize,this.worldSize]),l.K(y,y,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.L(new Float64Array(16),this.labelPlaneMatrix,y),l.J(y,y,[0,0,-this.elevation]),this.modelViewProjectionMatrix=y,this.invModelViewProjectionMatrix=l.as([],y),this.fogMatrix=new Float64Array(16),l.b6(this.fogMatrix,this._fov,this.width/this.height,w,this.farZ),this.fogMatrix[8]=2*-t.x/this.width,this.fogMatrix[9]=2*t.y/this.height,l.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),l.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),l.b7(this.fogMatrix,this.fogMatrix,this._pitch),l.ad(this.fogMatrix,this.fogMatrix,this.angle),l.J(this.fogMatrix,this.fogMatrix,[-h,-_,0]),l.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),l.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=l.L(new Float64Array(16),this.labelPlaneMatrix,y);const Ne=this.width%2/2,ze=this.height%2/2,qe=Math.cos(this.angle),Te=Math.sin(this.angle),Ze=h-Math.round(h)+qe*Ne+Te*ze,Ke=_-Math.round(_)+qe*ze+Te*Ne,it=new Float64Array(y);if(l.J(it,it,[Ze>.5?Ze-1:Ze,Ke>.5?Ke-1:Ke,0]),this.alignedModelViewProjectionMatrix=it,y=l.as(new Float64Array(16),this.pixelMatrix),!y)throw new Error("failed to invert matrix");this.pixelMatrixInverse=y,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new l.P(0,0)),h=[t.x*this.worldSize,t.y*this.worldSize,0,1];return l.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,t))}getCameraQueryGeometry(t){const h=this.getCameraPoint();if(t.length===1)return[t[0],h];{let _=h.x,y=h.y,w=h.x,P=h.y;for(const D of t)_=Math.min(_,D.x),y=Math.min(y,D.y),w=Math.max(w,D.x),P=Math.max(P,D.y);return[new l.P(_,y),new l.P(w,y),new l.P(w,P),new l.P(_,P),new l.P(_,y)]}}lngLatToCameraDepth(t,h){const _=this.locationCoordinate(t),y=[_.x*this.worldSize,_.y*this.worldSize,h,1];return l.af(y,y,this.modelViewProjectionMatrix),y[2]/y[3]}}function Fe(k,t){let h,_=!1,y=null,w=null;const P=()=>{y=null,_&&(k.apply(w,h),y=setTimeout(P,t),_=!1)};return(...D)=>(_=!0,w=this,h=D,y||P(),y)}class $e{constructor(t){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let _;return h.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(_=y)}),(_&&_[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(_=>isNaN(_))){const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());window.history.replaceState(window.history.state,null,h)},this._removeHash=()=>{const h=this._getCurrentHash();if(h.length===0)return;const _=h.join("/");let y=_;y.split("&").length>0&&(y=y.split("&")[0]),this._hashName&&(y=`${this._hashName}=${_}`);let w=window.location.hash.replace(y,"");w.startsWith("#&")?w=w.slice(0,1)+w.slice(2):w==="#"&&(w="");let P=window.location.href.replace(/(#.+)?$/,w);P=P.replace("&&","&"),window.history.replaceState(window.history.state,null,P)},this._updateHash=Fe(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const h=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,y=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,y),P=Math.round(h.lng*w)/w,D=Math.round(h.lat*w)/w,z=this._map.getBearing(),V=this._map.getPitch();let H="";if(H+=t?`/${P}/${D}/${_}`:`${_}/${D}/${P}`,(z||V)&&(H+="/"+Math.round(10*z)/10),V&&(H+=`/${Math.round(V)}`),this._hashName){const W=this._hashName;let ne=!1;const ge=window.location.hash.slice(1).split("&").map(ke=>{const Me=ke.split("=")[0];return Me===W?(ne=!0,`${Me}=${H}`):ke}).filter(ke=>ke);return ne||ge.push(`${W}=${H}`),`#${ge.join("&")}`}return`#${H}`}}const mt={linearity:.3,easing:l.b8(0,0,.3,1)},zt=l.e({deceleration:2500,maxSpeed:1400},mt),Nt=l.e({deceleration:20,maxSpeed:1400},mt),gn=l.e({deceleration:1e3,maxSpeed:360},mt),bn=l.e({deceleration:1e3,maxSpeed:90},mt);class Pn{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:L.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,h=L.now();for(;t.length>0&&h-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)h.zoom+=w.zoomDelta||0,h.bearing+=w.bearingDelta||0,h.pitch+=w.pitchDelta||0,w.panDelta&&h.pan._add(w.panDelta),w.around&&(h.around=w.around),w.pinchAround&&(h.pinchAround=w.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(h.pan.mag()){const w=mi(h.pan.mag(),_,l.e({},zt,t||{}));y.offset=h.pan.mult(w.amount/h.pan.mag()),y.center=this._map.transform.center,ti(y,w)}if(h.zoom){const w=mi(h.zoom,_,Nt);y.zoom=this._map.transform.zoom+w.amount,ti(y,w)}if(h.bearing){const w=mi(h.bearing,_,gn);y.bearing=this._map.transform.bearing+l.ac(w.amount,-179,179),ti(y,w)}if(h.pitch){const w=mi(h.pitch,_,bn);y.pitch=this._map.transform.pitch+w.amount,ti(y,w)}if(y.zoom||y.bearing){const w=h.pinchAround===void 0?h.around:h.pinchAround;y.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),l.e(y,{noMoveStart:!0})}}function ti(k,t){(!k.duration||k.duration<t.duration)&&(k.duration=t.duration,k.easing=t.easing)}function mi(k,t,h){const{maxSpeed:_,linearity:y,deceleration:w}=h,P=l.ac(k*y/(t/1e3),-_,_),D=Math.abs(P)/(w*y);return{easing:h.easing,duration:1e3*D,amount:P*(D/2)}}class li extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,h,_,y={}){const w=N.mousePos(h.getCanvas(),_),P=h.unproject(w);super(t,l.e({point:w,lngLat:P,originalEvent:_},y)),this._defaultPrevented=!1,this.target=h}}class er extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,h,_){const y=t==="touchend"?_.changedTouches:_.touches,w=N.touchPos(h.getCanvasContainer(),y),P=w.map(z=>h.unproject(z)),D=w.reduce((z,V,H,W)=>z.add(V.div(W.length)),new l.P(0,0));super(t,{points:w,point:D,lngLats:P,lngLat:h.unproject(D),originalEvent:_}),this._defaultPrevented=!1}}class rs extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,h,_){super(t,{originalEvent:_}),this._defaultPrevented=!1}}class Ps{constructor(t,h){this._map=t,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new rs(t.type,this._map,t))}mousedown(t,h){return this._mousedownPos=h,this._firePreventable(new li(t.type,this._map,t))}mouseup(t){this._map.fire(new li(t.type,this._map,t))}click(t,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new li(t.type,this._map,t))}dblclick(t){return this._firePreventable(new li(t.type,this._map,t))}mouseover(t){this._map.fire(new li(t.type,this._map,t))}mouseout(t){this._map.fire(new li(t.type,this._map,t))}touchstart(t){return this._firePreventable(new er(t.type,this._map,t))}touchmove(t){this._map.fire(new er(t.type,this._map,t))}touchend(t){this._map.fire(new er(t.type,this._map,t))}touchcancel(t){this._map.fire(new er(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fi{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new li(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new li("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new li(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ar{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(l.P.convert(t),this._map.terrain)}}class dr{constructor(t,h){this._map=t,this._tr=new Ar(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,h){this.isEnabled()&&t.shiftKey&&t.button===0&&(N.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(t,h){if(!this._active)return;const _=h;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=_,this._box||(this._box=N.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const w=Math.min(y.x,_.x),P=Math.max(y.x,_.x),D=Math.min(y.y,_.y),z=Math.max(y.y,_.y);N.setTransform(this._box,`translate(${w}px,${D}px)`),this._box.style.width=P-w+"px",this._box.style.height=z-D+"px"}mouseupWindow(t,h){if(!this._active||t.button!==0)return;const _=this._startPos,y=h;if(this.reset(),N.suppressClick(),_.x!==y.x||_.y!==y.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:t})),{cameraAnimation:w=>w.fitScreenCoordinates(_,y,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(N.remove(this._box),this._box=null),N.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,h){return this._map.fire(new l.k(t,{originalEvent:h}))}}function Rs(k,t){if(k.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${k.length}, points ${t.length}`);const h={};for(let _=0;_<k.length;_++)h[k[_].identifier]=t[_];return h}class Xa{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),_.length===this.numTouches&&(this.centroid=function(y){const w=new l.P(0,0);for(const P of y)w._add(P);return w.div(y.length)}(h),this.touches=Rs(_,h)))}touchmove(t,h,_){if(this.aborted||!this.centroid)return;const y=Rs(_,h);for(const w in this.touches){const P=y[w];(!P||P.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(t,h,_){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class xa{constructor(t){this.singleTap=new Xa(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,h,_){this.singleTap.touchstart(t,h,_)}touchmove(t,h,_){this.singleTap.touchmove(t,h,_)}touchend(t,h,_){const y=this.singleTap.touchend(t,h,_);if(y){const w=t.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(y)<30;if(w&&P||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class lo{constructor(t){this._tr=new Ar(t),this._zoomIn=new xa({numTouches:1,numTaps:2}),this._zoomOut=new xa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,h,_){this._zoomIn.touchstart(t,h,_),this._zoomOut.touchstart(t,h,_)}touchmove(t,h,_){this._zoomIn.touchmove(t,h,_),this._zoomOut.touchmove(t,h,_)}touchend(t,h,_){const y=this._zoomIn.touchend(t,h,_),w=this._zoomOut.touchend(t,h,_),P=this._tr;return y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:P.zoom+1,around:P.unproject(y)},{originalEvent:t})}):w?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:P.zoom-1,around:P.unproject(w)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ks{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const h=this._moveFunction(...t);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(t,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,h){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const y=h.length?h[0]:h;return!this._moved&&y.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=y,this._move(_,y))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&N.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ec={0:1,2:2};class mu{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const h=N.mouseButton(t);this._eventButton=h}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(h,_){const y=Ec[_];return h.buttons===void 0||(h.buttons&y)!==y}(t,this._eventButton)}isValidEndEvent(t){return N.mouseButton(t)===this._eventButton}}class Tc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const gu=k=>{k.mousedown=k.dragStart,k.mousemoveWindow=k.dragMove,k.mouseup=k.dragEnd,k.contextmenu=t=>{t.preventDefault()}},Cc=({enable:k,clickTolerance:t,bearingDegreesPerPixelMoved:h=.8})=>{const _=new mu({checkCorrectEvent:y=>N.mouseButton(y)===0&&y.ctrlKey||N.mouseButton(y)===2});return new ks({clickTolerance:t,move:(y,w)=>({bearingDelta:(w.x-y.x)*h}),moveStateManager:_,enable:k,assignEvents:gu})},Lc=({enable:k,clickTolerance:t,pitchDegreesPerPixelMoved:h=-.5})=>{const _=new mu({checkCorrectEvent:y=>N.mouseButton(y)===0&&y.ctrlKey||N.mouseButton(y)===2});return new ks({clickTolerance:t,move:(y,w)=>({pitchDelta:(w.y-y.y)*h}),moveStateManager:_,enable:k,assignEvents:gu})};class wa{constructor(t,h){this._clickTolerance=t.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,h,_){return this._calculateTransform(t,h,_)}touchmove(t,h,_){if(this._active){if(!this._shouldBePrevented(_.length))return t.preventDefault(),this._calculateTransform(t,h,_);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,h,_){this._calculateTransform(t,h,_),this._active&&this._shouldBePrevented(_.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,h,_){_.length>0&&(this._active=!0);const y=Rs(_,h),w=new l.P(0,0),P=new l.P(0,0);let D=0;for(const V in y){const H=y[V],W=this._touches[V];W&&(w._add(H),P._add(H.sub(W)),D++,y[V]=H)}if(this._touches=y,this._shouldBePrevented(D)||!P.mag())return;const z=P.div(D);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(D),panDelta:z}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _u{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(t,h,_){if(!this._firstTwoTouches)return;t.preventDefault();const[y,w]=this._firstTwoTouches,P=Ul(_,h,y),D=Ul(_,h,w);if(!P||!D)return;const z=this._aroundCenter?null:P.add(D).div(2);return this._move([P,D],z,t)}touchend(t,h,_){if(!this._firstTwoTouches)return;const[y,w]=this._firstTwoTouches,P=Ul(_,h,y),D=Ul(_,h,w);P&&D||(this._active&&N.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ul(k,t,h){for(let _=0;_<k.length;_++)if(k[_].identifier===h)return t[_]}function Mc(k,t){return Math.log(k/t)/Math.LN2}class Ac extends _u{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,h){const _=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Mc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Mc(this._distance,_),pinchAround:h}}}function Pc(k,t){return 180*k.angleWith(t)/Math.PI}class Rc extends _u{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,h,_){const y=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Pc(this._vector,y),pinchAround:h}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const h=25/(Math.PI*this._minDiameter)*360,_=Pc(t,this._startVector);return Math.abs(_)<h}}function yu(k){return Math.abs(k.y)>Math.abs(k.x)}class $a extends _u{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,h,_){super.touchstart(t,h,_),this._currentTouchCount=_.length}_start(t){this._lastPoints=t,yu(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,h,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const y=t[0].sub(this._lastPoints[0]),w=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(y,w,_.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(y.y+w.y)/2*-.5}):void 0}gestureBeginsVertically(t,h,_){if(this._valid!==void 0)return this._valid;const y=t.mag()>=2,w=h.mag()>=2;if(!y&&!w)return;if(!y||!w)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const P=t.y>0==h.y>0;return yu(t)&&yu(h)&&P}}const Bh={panStep:100,bearingStep:15,pitchStep:10};class Ds{constructor(t){this._tr=new Ar(t);const h=Bh;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let h=0,_=0,y=0,w=0,P=0;switch(t.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:t.shiftKey?_=-1:(t.preventDefault(),w=-1);break;case 39:t.shiftKey?_=1:(t.preventDefault(),w=1);break;case 38:t.shiftKey?y=1:(t.preventDefault(),P=-1);break;case 40:t.shiftKey?y=-1:(t.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(_=0,y=0),{cameraAnimation:D=>{const z=this._tr;D.easeTo({duration:300,easeId:"keyboardHandler",easing:uo,zoom:h?Math.round(z.zoom)+h*(t.shiftKey?2:1):z.zoom,bearing:z.bearing+_*this._bearingStep,pitch:z.pitch+y*this._pitchStep,offset:[-w*this._panStep,-P*this._panStep],center:z.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function uo(k){return k*(2-k)}const Dc=4.000244140625;class Zs{constructor(t,h){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=t,this._tr=new Ar(t),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let h=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const _=L.now(),y=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,h!==0&&h%Dc==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(y*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),t.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=t,this._delta-=h,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=N.mousePos(this._map.getCanvas(),t),_=this._tr;this._around=h.y>_.transform.height/2-_.transform.getHorizon()?l.N.convert(this._aroundCenter?_.center:_.unproject(h)):l.N.convert(_.center),this._aroundPoint=_.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>Dc?this._wheelZoomRate:this._defaultZoomRate;let V=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&V!==0&&(V=1/V);const H=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(H*V))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,_=this._startZoom,y=this._easing;let w,P=!1;const D=L.now()-this._lastWheelEventTime;if(this._type==="wheel"&&_&&y&&D){const z=Math.min(D/200,1),V=y(z);w=l.y.number(_,h,V),z<1?this._frameId||(this._frameId=!0):P=!0}else w=h,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:w-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let h=l.b9;if(this._prevEase){const _=this._prevEase,y=(L.now()-_.start)/_.duration,w=_.easing(y+.01)-_.easing(y),P=.27/Math.sqrt(w*w+1e-4)*.01,D=Math.sqrt(.0729-P*P);h=l.b8(P,D,.25,1)}return this._prevEase={start:L.now(),duration:t,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ka{constructor(t,h){this._clickZoom=t,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class od{constructor(t){this._tr=new Ar(t),this.reset()}reset(){this._active=!1}dblclick(t,h){return t.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ad{constructor(){this._tap=new xa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,h,_){if(!this._swipePoint)if(this._tapTime){const y=h[0],w=t.timeStamp-this._tapTime<500,P=this._tapPoint.dist(y)<30;w&&P?_.length>0&&(this._swipePoint=y,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(t,h,_)}touchmove(t,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const y=h[0],w=y.y-this._swipePoint.y;return this._swipePoint=y,t.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(t,h,_)}touchend(t,h,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const y=this._tap.touchend(t,h,_);y&&(this._tapTime=t.timeStamp,this._tapPoint=y)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uh{constructor(t,h,_){this._el=t,this._mousePan=h,this._touchPan=_}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class jh{constructor(t,h,_){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Nc{constructor(t,h,_,y){this._el=t,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ya{constructor(t,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=N.create("div","maplibregl-cooperative-gesture-screen",t);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),y=document.createElement("div");y.className="maplibregl-desktop-message",y.textContent=h,this._container.appendChild(y);const w=document.createElement("div");w.className="maplibregl-mobile-message",w.textContent=_,this._container.appendChild(w),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(N.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,h){this._enabled&&(this._map.fire(new l.k("cooperativegestureprevented",{gestureType:t,originalEvent:h})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Ns=k=>k.zoom||k.drag||k.pitch||k.rotate;class Qt extends l.k{}function vu(k){return k.panDelta&&k.panDelta.mag()||k.zoomDelta||k.bearingDelta||k.pitchDelta}class zc{constructor(t,h){this.handleWindowEvent=y=>{this.handleEvent(y,`${y.type}Window`)},this.handleEvent=(y,w)=>{if(y.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const P=y.type==="renderFrame"?void 0:y,D={needsRenderFrame:!1},z={},V={},H=y.touches,W=H?this._getMapTouches(H):void 0,ne=W?N.touchPos(this._map.getCanvas(),W):N.mousePos(this._map.getCanvas(),y);for(const{handlerName:Me,handler:Ne,allowed:ze}of this._handlers){if(!Ne.isEnabled())continue;let qe;this._blockedByActive(V,ze,Me)?Ne.reset():Ne[w||y.type]&&(qe=Ne[w||y.type](y,ne,W),this.mergeHandlerResult(D,z,qe,Me,P),qe&&qe.needsRenderFrame&&this._triggerRenderFrame()),(qe||Ne.isActive())&&(V[Me]=Ne)}const ge={};for(const Me in this._previousActiveHandlers)V[Me]||(ge[Me]=P);this._previousActiveHandlers=V,(Object.keys(ge).length||vu(D))&&(this._changes.push([D,z,ge]),this._triggerRenderFrame()),(Object.keys(V).length||vu(D))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ke}=D;ke&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ke(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pn(t),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,w,P]of this._listeners)N.addEventListener(y,w,y===document?this.handleWindowEvent:this.handleEvent,P)}destroy(){for(const[t,h,_]of this._listeners)N.removeEventListener(t,h,t===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(t){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new Ps(h,t));const y=h.boxZoom=new dr(h,t);this._add("boxZoom",y),t.interactive&&t.boxZoom&&y.enable();const w=h.cooperativeGestures=new Ya(h,t.cooperativeGestures);this._add("cooperativeGestures",w),t.cooperativeGestures&&w.enable();const P=new lo(h),D=new od(h);h.doubleClickZoom=new ka(D,P),this._add("tapZoom",P),this._add("clickZoom",D),t.interactive&&t.doubleClickZoom&&h.doubleClickZoom.enable();const z=new ad;this._add("tapDragZoom",z);const V=h.touchPitch=new $a(h);this._add("touchPitch",V),t.interactive&&t.touchPitch&&h.touchPitch.enable(t.touchPitch);const H=Cc(t),W=Lc(t);h.dragRotate=new jh(t,H,W),this._add("mouseRotate",H,["mousePitch"]),this._add("mousePitch",W,["mouseRotate"]),t.interactive&&t.dragRotate&&h.dragRotate.enable();const ne=(({enable:qe,clickTolerance:Te})=>{const Ze=new mu({checkCorrectEvent:Ke=>N.mouseButton(Ke)===0&&!Ke.ctrlKey});return new ks({clickTolerance:Te,move:(Ke,it)=>({around:it,panDelta:it.sub(Ke)}),activateOnStart:!0,moveStateManager:Ze,enable:qe,assignEvents:gu})})(t),ge=new wa(t,h);h.dragPan=new Uh(_,ne,ge),this._add("mousePan",ne),this._add("touchPan",ge,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&h.dragPan.enable(t.dragPan);const ke=new Rc,Me=new Ac;h.touchZoomRotate=new Nc(_,Me,ke,z),this._add("touchRotate",ke,["touchPan","touchZoom"]),this._add("touchZoom",Me,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&h.touchZoomRotate.enable(t.touchZoomRotate);const Ne=h.scrollZoom=new Zs(h,()=>this._triggerRenderFrame());this._add("scrollZoom",Ne,["mousePan"]),t.interactive&&t.scrollZoom&&h.scrollZoom.enable(t.scrollZoom);const ze=h.keyboard=new Ds(h);this._add("keyboard",ze),t.interactive&&t.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new fi(h))}_add(t,h,_){this._handlers.push({handlerName:t,handler:h,allowed:_}),this._handlersById[t]=h}stop(t){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ns(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,h,_){for(const y in t)if(y!==_&&(!h||h.indexOf(y)<0))return!0;return!1}_getMapTouches(t){const h=[];for(const _ of t)this._el.contains(_.target)&&h.push(_);return h}mergeHandlerResult(t,h,_,y,w){if(!_)return;l.e(t,_);const P={handlerName:y,originalEvent:_.originalEvent||w};_.zoomDelta!==void 0&&(h.zoom=P),_.panDelta!==void 0&&(h.drag=P),_.pitchDelta!==void 0&&(h.pitch=P),_.bearingDelta!==void 0&&(h.rotate=P)}_applyChanges(){const t={},h={},_={};for(const[y,w,P]of this._changes)y.panDelta&&(t.panDelta=(t.panDelta||new l.P(0,0))._add(y.panDelta)),y.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(t.around=y.around),y.pinchAround!==void 0&&(t.pinchAround=y.pinchAround),y.noInertia&&(t.noInertia=y.noInertia),l.e(h,w),l.e(_,P);this._updateMapTransform(t,h,_),this._changes=[]}_updateMapTransform(t,h,_){const y=this._map,w=y._getTransformForUpdate(),P=y.terrain;if(!(vu(t)||P&&this._terrainMovement))return this._fireEvents(h,_,!0);let{panDelta:D,zoomDelta:z,bearingDelta:V,pitchDelta:H,around:W,pinchAround:ne}=t;ne!==void 0&&(W=ne),y._stop(!0),W=W||y.transform.centerPoint;const ge=w.pointLocation(D?W.sub(D):W);V&&(w.bearing+=V),H&&(w.pitch+=H),z&&(w.zoom+=z),P?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?w.center=w.pointLocation(w.centerPoint.sub(D)):w.setLocationAtPoint(ge,W):(this._terrainMovement=!0,this._map._elevationFreeze=!0,w.setLocationAtPoint(ge,W)):w.setLocationAtPoint(ge,W),y._applyUpdatedTransform(w),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(h,_,!0)}_fireEvents(t,h,_){const y=Ns(this._eventsInProgress),w=Ns(t),P={};for(const W in t){const{originalEvent:ne}=t[W];this._eventsInProgress[W]||(P[`${W}start`]=ne),this._eventsInProgress[W]=t[W]}!y&&w&&this._fireEvent("movestart",w.originalEvent);for(const W in P)this._fireEvent(W,P[W]);w&&this._fireEvent("move",w.originalEvent);for(const W in t){const{originalEvent:ne}=t[W];this._fireEvent(W,ne)}const D={};let z;for(const W in this._eventsInProgress){const{handlerName:ne,originalEvent:ge}=this._eventsInProgress[W];this._handlersById[ne].isActive()||(delete this._eventsInProgress[W],z=h[ne]||ge,D[`${W}end`]=z)}for(const W in D)this._fireEvent(W,D[W]);const V=Ns(this._eventsInProgress),H=(y||w)&&!V;if(H&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const W=this._map._getTransformForUpdate();W.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(W)}if(_&&H){this._updatingCamera=!0;const W=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ne=ge=>ge!==0&&-this._bearingSnap<ge&&ge<this._bearingSnap;!W||!W.essential&&L.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:z})),ne(this._map.getBearing())&&this._map.resetNorth()):(ne(W.bearing||this._map.getBearing())&&(W.bearing=0),W.freezeElevation=!0,this._map.easeTo(W,{originalEvent:z})),this._updatingCamera=!1}}_fireEvent(t,h){this._map.fire(new l.k(t,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Qt("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Vh extends l.E{constructor(t,h){super(),this._renderFrameCallback=()=>{const _=Math.min((L.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.N(this.transform.center.lng,this.transform.center.lat)}setCenter(t,h){return this.jumpTo({center:t},h)}panBy(t,h,_){return t=l.P.convert(t).mult(-1),this.panTo(this.transform.center,l.e({offset:t},h),_)}panTo(t,h,_){return this.easeTo(l.e({center:t},h),_)}getZoom(){return this.transform.zoom}setZoom(t,h){return this.jumpTo({zoom:t},h),this}zoomTo(t,h,_){return this.easeTo(l.e({zoom:t},h),_)}zoomIn(t,h){return this.zoomTo(this.getZoom()+1,t,h),this}zoomOut(t,h){return this.zoomTo(this.getZoom()-1,t,h),this}getBearing(){return this.transform.bearing}setBearing(t,h){return this.jumpTo({bearing:t},h),this}getPadding(){return this.transform.padding}setPadding(t,h){return this.jumpTo({padding:t},h),this}rotateTo(t,h,_){return this.easeTo(l.e({bearing:t},h),_)}resetNorth(t,h){return this.rotateTo(0,l.e({duration:1e3},t),h),this}resetNorthPitch(t,h){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},t),h),this}snapToNorth(t,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,h):this}getPitch(){return this.transform.pitch}setPitch(t,h){return this.jumpTo({pitch:t},h),this}cameraForBounds(t,h){t=Ye.convert(t).adjustAntiMeridian();const _=h&&h.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),_,h)}_cameraForBoxAndBearing(t,h,_,y){const w={top:0,bottom:0,right:0,left:0};if(typeof(y=l.e({padding:w,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding=="number"){const jt=y.padding;y.padding={top:jt,bottom:jt,right:jt,left:jt}}y.padding=l.e(w,y.padding);const P=this.transform,D=P.padding,z=new Ye(t,h),V=P.project(z.getNorthWest()),H=P.project(z.getNorthEast()),W=P.project(z.getSouthEast()),ne=P.project(z.getSouthWest()),ge=l.ba(-_),ke=V.rotate(ge),Me=H.rotate(ge),Ne=W.rotate(ge),ze=ne.rotate(ge),qe=new l.P(Math.max(ke.x,Me.x,ze.x,Ne.x),Math.max(ke.y,Me.y,ze.y,Ne.y)),Te=new l.P(Math.min(ke.x,Me.x,ze.x,Ne.x),Math.min(ke.y,Me.y,ze.y,Ne.y)),Ze=qe.sub(Te),Ke=(P.width-(D.left+D.right+y.padding.left+y.padding.right))/Ze.x,it=(P.height-(D.top+D.bottom+y.padding.top+y.padding.bottom))/Ze.y;if(it<0||Ke<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const bt=Math.min(P.scaleZoom(P.scale*Math.min(Ke,it)),y.maxZoom),Rt=l.P.convert(y.offset),Ht=new l.P((y.padding.left-y.padding.right)/2,(y.padding.top-y.padding.bottom)/2).rotate(l.ba(_)),Yt=Rt.add(Ht).mult(P.scale/P.zoomScale(bt));return{center:P.unproject(V.add(W).div(2).sub(Yt)),zoom:bt,bearing:_}}fitBounds(t,h,_){return this._fitInternal(this.cameraForBounds(t,h),h,_)}fitScreenCoordinates(t,h,_,y,w){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(t)),this.transform.pointLocation(l.P.convert(h)),_,y),y,w)}_fitInternal(t,h,_){return t?(delete(h=l.e(t,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this}jumpTo(t,h){this.stop();const _=this._getTransformForUpdate();let y=!1,w=!1,P=!1;return"zoom"in t&&_.zoom!==+t.zoom&&(y=!0,_.zoom=+t.zoom),t.center!==void 0&&(_.center=l.N.convert(t.center)),"bearing"in t&&_.bearing!==+t.bearing&&(w=!0,_.bearing=+t.bearing),"pitch"in t&&_.pitch!==+t.pitch&&(P=!0,_.pitch=+t.pitch),t.padding==null||_.isPaddingEqual(t.padding)||(_.padding=t.padding),this._applyUpdatedTransform(_),this.fire(new l.k("movestart",h)).fire(new l.k("move",h)),y&&this.fire(new l.k("zoomstart",h)).fire(new l.k("zoom",h)).fire(new l.k("zoomend",h)),w&&this.fire(new l.k("rotatestart",h)).fire(new l.k("rotate",h)).fire(new l.k("rotateend",h)),P&&this.fire(new l.k("pitchstart",h)).fire(new l.k("pitch",h)).fire(new l.k("pitchend",h)),this.fire(new l.k("moveend",h))}calculateCameraOptionsFromTo(t,h,_,y=0){const w=l.Z.fromLngLat(t,h),P=l.Z.fromLngLat(_,y),D=P.x-w.x,z=P.y-w.y,V=P.z-w.z,H=Math.hypot(D,z,V);if(H===0)throw new Error("Can't calculate camera options with same From and To");const W=Math.hypot(D,z),ne=this.transform.scaleZoom(this.transform.cameraToCenterDistance/H/this.transform.tileSize),ge=180*Math.atan2(D,-z)/Math.PI;let ke=180*Math.acos(W/H)/Math.PI;return ke=V<0?90-ke:90+ke,{center:P.toLngLat(),zoom:ne,pitch:ke,bearing:ge}}easeTo(t,h){var _;this._stop(!1,t.easeId),((t=l.e({offset:[0,0],duration:500,easing:l.b9},t)).animate===!1||!t.essential&&L.prefersReducedMotion)&&(t.duration=0);const y=this._getTransformForUpdate(),w=y.zoom,P=y.bearing,D=y.pitch,z=y.padding,V="bearing"in t?this._normalizeBearing(t.bearing,P):P,H="pitch"in t?+t.pitch:D,W="padding"in t?t.padding:y.padding,ne=l.P.convert(t.offset);let ge=y.centerPoint.add(ne);const ke=y.pointLocation(ge),{center:Me,zoom:Ne}=y.getConstrained(l.N.convert(t.center||ke),(_=t.zoom)!==null&&_!==void 0?_:w);this._normalizeCenter(Me,y);const ze=y.project(ke),qe=y.project(Me).sub(ze),Te=y.zoomScale(Ne-w);let Ze,Ke;t.around&&(Ze=l.N.convert(t.around),Ke=y.locationPoint(Ze));const it={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Ne!==w,this._rotating=this._rotating||P!==V,this._pitching=this._pitching||H!==D,this._padding=!y.isPaddingEqual(W),this._easeId=t.easeId,this._prepareEase(h,t.noMoveStart,it),this.terrain&&this._prepareElevation(Me),this._ease(bt=>{if(this._zooming&&(y.zoom=l.y.number(w,Ne,bt)),this._rotating&&(y.bearing=l.y.number(P,V,bt)),this._pitching&&(y.pitch=l.y.number(D,H,bt)),this._padding&&(y.interpolatePadding(z,W,bt),ge=y.centerPoint.add(ne)),this.terrain&&!t.freezeElevation&&this._updateElevation(bt),Ze)y.setLocationAtPoint(Ze,Ke);else{const Rt=y.zoomScale(y.zoom-w),Ht=Ne>w?Math.min(2,Te):Math.max(.5,Te),Yt=Math.pow(Ht,1-bt),jt=y.unproject(ze.add(qe.mult(bt*Yt)).mult(Rt));y.setLocationAtPoint(y.renderWorldCopies?jt.wrap():jt,ge)}this._applyUpdatedTransform(y),this._fireMoveEvents(h)},bt=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(h,bt)},t),this}_prepareEase(t,h,_={}){this._moving=!0,h||_.moving||this.fire(new l.k("movestart",t)),this._zooming&&!_.zooming&&this.fire(new l.k("zoomstart",t)),this._rotating&&!_.rotating&&this.fire(new l.k("rotatestart",t)),this._pitching&&!_.pitching&&this.fire(new l.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&h!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(_-(h-(_*t+this._elevationStart))/(1-t)),this._elevationTarget=h}this.transform.elevation=l.y.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){const h=t.getCameraPosition(),_=this.terrain.getElevationForLngLatZoom(h.lngLat,t.zoom);if(h.altitude<_){const y=this.calculateCameraOptionsFromTo(h.lngLat,_,t.center,t.elevation);return{pitch:y.pitch,zoom:y.zoom}}return{}}_applyUpdatedTransform(t){const h=[];if(this.terrain&&h.push(y=>this._elevateCameraIfInsideTerrain(y)),this.transformCameraUpdate&&h.push(y=>this.transformCameraUpdate(y)),!h.length)return;const _=t.clone();for(const y of h){const w=_.clone(),{center:P,zoom:D,pitch:z,bearing:V,elevation:H}=y(w);P&&(w.center=P),D!==void 0&&(w.zoom=D),z!==void 0&&(w.pitch=z),V!==void 0&&(w.bearing=V),H!==void 0&&(w.elevation=H),_.apply(w)}this.transform.apply(_)}_fireMoveEvents(t){this.fire(new l.k("move",t)),this._zooming&&this.fire(new l.k("zoom",t)),this._rotating&&this.fire(new l.k("rotate",t)),this._pitching&&this.fire(new l.k("pitch",t))}_afterEase(t,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const _=this._zooming,y=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new l.k("zoomend",t)),y&&this.fire(new l.k("rotateend",t)),w&&this.fire(new l.k("pitchend",t)),this.fire(new l.k("moveend",t))}flyTo(t,h){var _;if(!t.essential&&L.prefersReducedMotion){const Xt=l.M(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Xt,h)}this.stop(),t=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b9},t);const y=this._getTransformForUpdate(),w=y.zoom,P=y.bearing,D=y.pitch,z=y.padding,V="bearing"in t?this._normalizeBearing(t.bearing,P):P,H="pitch"in t?+t.pitch:D,W="padding"in t?t.padding:y.padding,ne=l.P.convert(t.offset);let ge=y.centerPoint.add(ne);const ke=y.pointLocation(ge),{center:Me,zoom:Ne}=y.getConstrained(l.N.convert(t.center||ke),(_=t.zoom)!==null&&_!==void 0?_:w);this._normalizeCenter(Me,y);const ze=y.zoomScale(Ne-w),qe=y.project(ke),Te=y.project(Me).sub(qe);let Ze=t.curve;const Ke=Math.max(y.width,y.height),it=Ke/ze,bt=Te.mag();if("minZoom"in t){const Xt=l.ac(Math.min(t.minZoom,w,Ne),y.minZoom,y.maxZoom),In=Ke/y.zoomScale(Xt-w);Ze=Math.sqrt(In/bt*2)}const Rt=Ze*Ze;function Ht(Xt){const In=(it*it-Ke*Ke+(Xt?-1:1)*Rt*Rt*bt*bt)/(2*(Xt?it:Ke)*Rt*bt);return Math.log(Math.sqrt(In*In+1)-In)}function Yt(Xt){return(Math.exp(Xt)-Math.exp(-Xt))/2}function jt(Xt){return(Math.exp(Xt)+Math.exp(-Xt))/2}const Ut=Ht(!1);let rn=function(Xt){return jt(Ut)/jt(Ut+Ze*Xt)},Tn=function(Xt){return Ke*((jt(Ut)*(Yt(In=Ut+Ze*Xt)/jt(In))-Yt(Ut))/Rt)/bt;var In},qt=(Ht(!0)-Ut)/Ze;if(Math.abs(bt)<1e-6||!isFinite(qt)){if(Math.abs(Ke-it)<1e-6)return this.easeTo(t,h);const Xt=it<Ke?-1:1;qt=Math.abs(Math.log(it/Ke))/Ze,Tn=()=>0,rn=In=>Math.exp(Xt*Ze*In)}return t.duration="duration"in t?+t.duration:1e3*qt/("screenSpeed"in t?+t.screenSpeed/Ze:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=P!==V,this._pitching=H!==D,this._padding=!y.isPaddingEqual(W),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(Me),this._ease(Xt=>{const In=Xt*qt,Si=1/rn(In);y.zoom=Xt===1?Ne:w+y.scaleZoom(Si),this._rotating&&(y.bearing=l.y.number(P,V,Xt)),this._pitching&&(y.pitch=l.y.number(D,H,Xt)),this._padding&&(y.interpolatePadding(z,W,Xt),ge=y.centerPoint.add(ne)),this.terrain&&!t.freezeElevation&&this._updateElevation(Xt);const On=Xt===1?Me:y.unproject(qe.add(Te.mult(Tn(In))).mult(Si));y.setLocationAtPoint(y.renderWorldCopies?On.wrap():On,ge),this._applyUpdatedTransform(y),this._fireMoveEvents(h)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(h)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,h){var _;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,h)}return t||(_=this.handlers)===null||_===void 0||_.stop(!1),this}_ease(t,h,_){_.animate===!1||_.duration===0?(t(1),h()):(this._easeStart=L.now(),this._easeOptions=_,this._onEaseFrame=t,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,h){t=l.b3(t,-180,180);const _=Math.abs(t-h);return Math.abs(t-360-h)<_&&(t-=360),Math.abs(t+360-h)<_&&(t+=360),t}_normalizeCenter(t,h){if(!h.renderWorldCopies||h.lngRange)return;const _=t.lng-h.center.lng;t.lng+=_>180?-360:_<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(l.N.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const Ja={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ka{constructor(t=Ja){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=N.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=N.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=N.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){N.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,h){const _=this._map._getUIString(`AttributionControl.${h}`);t.title=_,t.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(y=>typeof y!="string"?"":y)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const h=this._map.style.sourceCaches;for(const y in h){const w=h[y];if(w.used||w.usedForTerrain){const P=w.getSource();P.attribution&&t.indexOf(P.attribution)<0&&t.push(P.attribution)}}t=t.filter(y=>String(y).trim()),t.sort((y,w)=>y.length-w.length),t=t.filter((y,w)=>{for(let P=w+1;P<t.length;P++)if(t[P].indexOf(y)>=0)return!1;return!0});const _=t.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,t.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Oc{constructor(t={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const _=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=N.create("div","maplibregl-ctrl");const h=N.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){N.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class qn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const h=++this._id;return this._queue.push({callback:t,id:h,cancelled:!1}),h}remove(t){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const y of _)if(y.id===t)return void(y.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Fc=l.Y([{name:"a_pos3d",type:"Int16",components:3}]);class ld extends l.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,h){this.sourceCache.update(t,h),this._renderableTilesKeys=[];const _={};for(const y of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))_[y.key]=!0,this._renderableTilesKeys.push(y.key),this._tiles[y.key]||(y.posMatrix=new Float64Array(16),l.aP(y.posMatrix,0,l.X,0,l.X,0,1),this._tiles[y.key]=new As(y,this.tileSize));for(const y in this._tiles)_[y]||delete this._tiles[y]}freeRtt(t){for(const h in this._tiles){const _=this._tiles[h];(!t||_.tileID.equals(t)||_.tileID.isChildOf(t)||t.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const h={};for(const _ of this._renderableTilesKeys){const y=this._tiles[_].tileID;if(y.canonical.equals(t.canonical)){const w=t.clone();w.posMatrix=new Float64Array(16),l.aP(w.posMatrix,0,l.X,0,l.X,0,1),h[_]=w}else if(y.canonical.isChildOf(t.canonical)){const w=t.clone();w.posMatrix=new Float64Array(16);const P=y.canonical.z-t.canonical.z,D=y.canonical.x-(y.canonical.x>>P<<P),z=y.canonical.y-(y.canonical.y>>P<<P),V=l.X>>P;l.aP(w.posMatrix,0,V,0,V,0,1),l.J(w.posMatrix,w.posMatrix,[-D*V,-z*V,0]),h[_]=w}else if(t.canonical.isChildOf(y.canonical)){const w=t.clone();w.posMatrix=new Float64Array(16);const P=t.canonical.z-y.canonical.z,D=t.canonical.x-(t.canonical.x>>P<<P),z=t.canonical.y-(t.canonical.y>>P<<P),V=l.X>>P;l.aP(w.posMatrix,0,l.X,0,l.X,0,1),l.J(w.posMatrix,w.posMatrix,[D*V,z*V,0]),l.K(w.posMatrix,w.posMatrix,[1/2**P,1/2**P,0]),h[_]=w}}return h}getSourceTile(t,h){const _=this.sourceCache._source;let y=t.overscaledZ-this.deltaZoom;if(y>_.maxzoom&&(y=_.maxzoom),y<_.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(y).key);let w=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!w||!w.dem)&&h)for(;y>=_.minzoom&&(!w||!w.dem);)w=this.sourceCache.getTileByID(t.scaledTo(y--).key);return w}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=t)}}class Bc{constructor(t,h,_){this.painter=t,this.sourceCache=new ld(h),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,h,_,y=l.X){var w;if(!(h>=0&&h<y&&_>=0&&_<y))return 0;const P=this.getTerrainData(t),D=(w=P.tile)===null||w===void 0?void 0:w.dem;if(!D)return 0;const z=function(ke,Me,Ne){var ze=Me[0],qe=Me[1];return ke[0]=Ne[0]*ze+Ne[4]*qe+Ne[12],ke[1]=Ne[1]*ze+Ne[5]*qe+Ne[13],ke}([],[h/y*l.X,_/y*l.X],P.u_terrain_matrix),V=[z[0]*D.dim,z[1]*D.dim],H=Math.floor(V[0]),W=Math.floor(V[1]),ne=V[0]-H,ge=V[1]-W;return D.get(H,W)*(1-ne)*(1-ge)+D.get(H+1,W)*ne*(1-ge)+D.get(H,W+1)*(1-ne)*ge+D.get(H+1,W+1)*ne*ge}getElevationForLngLatZoom(t,h){if(!l.bb(h,t.wrap()))return 0;const{tileID:_,mercatorX:y,mercatorY:w}=this._getOverscaledTileIDFromLngLatZoom(t,h);return this.getElevation(_,y%l.X,w%l.X,l.X)}getElevation(t,h,_,y=l.X){return this.getDEMElevation(t,h,_,y)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const y=this.painter.context,w=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new we(y,w,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new we(y,new l.R({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const h=this.sourceCache.getSourceTile(t,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const y=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new we(y,h.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),h.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const _=h&&h+h.tileID.key+t.key;if(_&&!this._demMatrixCache[_]){const y=this.sourceCache.sourceCache._source.maxzoom;let w=t.canonical.z-h.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=y?w=t.canonical.z-y:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const P=t.canonical.x-(t.canonical.x>>w<<w),D=t.canonical.y-(t.canonical.y>>w<<w),z=l.bc(new Float64Array(16),[1/(l.X<<w),1/(l.X<<w),0]);l.J(z,z,[P*l.X,D*l.X,0]),this._demMatrixCache[t.key]={matrix:z,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(t){const h=this.painter,_=h.width/devicePixelRatio,y=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===y||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new we(h.context,{width:_,height:y,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new we(h.context,{width:_,height:y,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(_,y,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,_,y))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let w=0,P=0;w<this._coordsTextureSize;w++)for(let D=0;D<this._coordsTextureSize;D++,P+=4)h[P+0]=255&D,h[P+1]=255&w,h[P+2]=D>>8<<4|w>>8,h[P+3]=0;const _=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),y=new we(t,_,t.gl.RGBA,{premultiply:!1});return y.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=y,y}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),_=this.painter.context,y=_.gl,w=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),P=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),D=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),y.readPixels(w,D-P-1,1,1,y.RGBA,y.UNSIGNED_BYTE,h),_.bindFramebuffer.set(null);const z=h[0]+(h[2]>>4<<8),V=h[1]+((15&h[2])<<8),H=this.coordsIndex[255-h[3]],W=H&&this.sourceCache.getTileByID(H);if(!W)return null;const ne=this._coordsTextureSize,ge=(1<<W.tileID.canonical.z)*ne;return new l.Z((W.tileID.canonical.x*ne+z)/ge+W.tileID.wrap,(W.tileID.canonical.y*ne+V)/ge,this.getElevation(W.tileID,z,V,ne))}depthAtPoint(t){const h=new Uint8Array(4),_=this.painter.context,y=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),y.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,y.RGBA,y.UNSIGNED_BYTE,h),_.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,h=new l.bd,_=new l.aY,y=this.meshSize,w=l.X/y,P=y*y;for(let W=0;W<=y;W++)for(let ne=0;ne<=y;ne++)h.emplaceBack(ne*w,W*w,0);for(let W=0;W<P;W+=y+1)for(let ne=0;ne<y;ne++)_.emplaceBack(ne+W,y+ne+W+1,y+ne+W+2),_.emplaceBack(ne+W,y+ne+W+2,ne+W+1);const D=h.length,z=D+2*(y+1);for(const W of[0,1])for(let ne=0;ne<=y;ne++)for(const ge of[0,1])h.emplaceBack(ne*w,W*l.X,ge);for(let W=0;W<2*y;W+=2)_.emplaceBack(z+W,z+W+1,z+W+3),_.emplaceBack(z+W,z+W+3,z+W+2),_.emplaceBack(D+W,D+W+3,D+W+1),_.emplaceBack(D+W,D+W+2,D+W+3);const V=h.length,H=V+2*(y+1);for(const W of[0,1])for(let ne=0;ne<=y;ne++)for(const ge of[0,1])h.emplaceBack(W*l.X,ne*w,ge);for(let W=0;W<2*y;W+=2)_.emplaceBack(V+W,V+W+1,V+W+3),_.emplaceBack(V+W,V+W+3,V+W+2),_.emplaceBack(H+W,H+W+3,H+W+1),_.emplaceBack(H+W,H+W+2,H+W+3);return this._mesh=new p(t.createVertexBuffer(h,Fc.members),t.createIndexBuffer(_),l.a0.simpleSegment(0,0,h.length,_.length)),this._mesh}getMeshFrameDelta(t){return 2*Math.PI*l.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,h){var _;const{tileID:y}=this._getOverscaledTileIDFromLngLatZoom(t,h);return(_=this.getMinMaxElevation(y).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(t){const h=this.getTerrainData(t).tile,_={minElevation:null,maxElevation:null};return h&&h.dem&&(_.minElevation=h.dem.min*this.exaggeration,_.maxElevation=h.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(t,h){const _=l.Z.fromLngLat(t.wrap()),y=(1<<h)*l.X,w=_.x*y,P=_.y*y,D=Math.floor(w/l.X),z=Math.floor(P/l.X);return{tileID:new l.S(h,0,h,D,z),mercatorX:w,mercatorY:P}}}class ud{constructor(t,h,_){this._context=t,this._size=h,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new we(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(_.texture),{id:t,fbo:h,texture:_,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>t.id!==h),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Qa={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class qh{constructor(t,h){this.painter=t,this.terrain=h,this.pool=new ud(t.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(_=>!t._layers[_].isHidden(h)),this._coordsDescendingInv={};for(const _ in t.sourceCaches){this._coordsDescendingInv[_]={};const y=t.sourceCaches[_].getVisibleCoordinates();for(const w of y){const P=this.terrain.sourceCache.getTerrainCoords(w);for(const D in P)this._coordsDescendingInv[_][D]||(this._coordsDescendingInv[_][D]=[]),this._coordsDescendingInv[_][D].push(P[D])}}this._coordsDescendingInvStr={};for(const _ of t._order){const y=t._layers[_],w=y.source;if(Qa[y.type]&&!this._coordsDescendingInvStr[w]){this._coordsDescendingInvStr[w]={};for(const P in this._coordsDescendingInv[w])this._coordsDescendingInvStr[w][P]=this._coordsDescendingInv[w][P].map(D=>D.key).sort().join()}}for(const _ of this._renderableTiles)for(const y in this._coordsDescendingInvStr){const w=this._coordsDescendingInvStr[y][_.tileID.key];w&&w!==_.rttCoords[y]&&(_.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const h=t.type,_=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Qa[h]&&(this._prevType&&Qa[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(t.id),!y))return!0;if(Qa[this._prevType]||Qa[h]&&y){this._prevType=h;const w=this._stacks.length-1,P=this._stacks[w]||[];for(const D of this._renderableTiles){if(this.pool.isFull()&&(d(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(D),D.rtt[w]){const V=this.pool.getObjectForId(D.rtt[w].id);if(V.stamp===D.rtt[w].stamp){this.pool.useObject(V);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),D.rtt[w]={id:z.id,stamp:z.stamp},_.context.bindFramebuffer.set(z.fbo.framebuffer),_.context.clear({color:l.aM.transparent,stencil:0}),_.currentStencilSource=void 0;for(let V=0;V<P.length;V++){const H=_.style._layers[P[V]],W=H.source?this._coordsDescendingInv[H.source][D.tileID.key]:[D.tileID];_.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),_._renderTileClippingMasks(H,W),_.renderLayer(_,_.style.sourceCaches[H.source],H,W),H.source&&(D.rttCoords[H.source]=this._coordsDescendingInvStr[H.source][D.tileID.key])}}return d(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Qa[h]}return!1}}const Uc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Gh=x,cd={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ja,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},jc=k=>{k.touchstart=k.dragStart,k.touchmoveWindow=k.dragMove,k.touchend=k.dragEnd},hd={showCompass:!0,showZoom:!0,visualizePitch:!1};class fd{constructor(t,h,_=!1){this.mousedown=P=>{this.startMouse(l.e({},P,{ctrlKey:!0,preventDefault:()=>P.preventDefault()}),N.mousePos(this.element,P)),N.addEventListener(window,"mousemove",this.mousemove),N.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=P=>{this.moveMouse(P,N.mousePos(this.element,P))},this.mouseup=P=>{this.mouseRotate.dragEnd(P),this.mousePitch&&this.mousePitch.dragEnd(P),this.offTemp()},this.touchstart=P=>{P.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=N.touchPos(this.element,P.targetTouches)[0],this.startTouch(P,this._startPos),N.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.addEventListener(window,"touchend",this.touchend))},this.touchmove=P=>{P.targetTouches.length!==1?this.reset():(this._lastPos=N.touchPos(this.element,P.targetTouches)[0],this.moveTouch(P,this._lastPos))},this.touchend=P=>{P.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const y=t.dragRotate._mouseRotate.getClickTolerance(),w=t.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=Cc({clickTolerance:y,enable:!0}),this.touchRotate=(({enable:P,clickTolerance:D,bearingDegreesPerPixelMoved:z=.8})=>{const V=new Tc;return new ks({clickTolerance:D,move:(H,W)=>({bearingDelta:(W.x-H.x)*z}),moveStateManager:V,enable:P,assignEvents:jc})})({clickTolerance:y,enable:!0}),this.map=t,_&&(this.mousePitch=Lc({clickTolerance:w,enable:!0}),this.touchPitch=(({enable:P,clickTolerance:D,pitchDegreesPerPixelMoved:z=-.5})=>{const V=new Tc;return new ks({clickTolerance:D,move:(H,W)=>({pitchDelta:(W.y-H.y)*z}),moveStateManager:V,enable:P,assignEvents:jc})})({clickTolerance:w,enable:!0})),N.addEventListener(h,"mousedown",this.mousedown),N.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),N.addEventListener(h,"touchcancel",this.reset)}startMouse(t,h){this.mouseRotate.dragStart(t,h),this.mousePitch&&this.mousePitch.dragStart(t,h),N.disableDrag()}startTouch(t,h){this.touchRotate.dragStart(t,h),this.touchPitch&&this.touchPitch.dragStart(t,h),N.disableDrag()}moveMouse(t,h){const _=this.map,{bearingDelta:y}=this.mouseRotate.dragMove(t,h)||{};if(y&&_.setBearing(_.getBearing()+y),this.mousePitch){const{pitchDelta:w}=this.mousePitch.dragMove(t,h)||{};w&&_.setPitch(_.getPitch()+w)}}moveTouch(t,h){const _=this.map,{bearingDelta:y}=this.touchRotate.dragMove(t,h)||{};if(y&&_.setBearing(_.getBearing()+y),this.touchPitch){const{pitchDelta:w}=this.touchPitch.dragMove(t,h)||{};w&&_.setPitch(_.getPitch()+w)}}off(){const t=this.element;N.removeEventListener(t,"mousedown",this.mousedown),N.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend),N.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){N.enableDrag(),N.removeEventListener(window,"mousemove",this.mousemove),N.removeEventListener(window,"mouseup",this.mouseup),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend)}}let Is;function Ii(k,t,h){const _=new l.N(k.lng,k.lat);if(k=new l.N(k.lng,k.lat),t){const y=new l.N(k.lng-360,k.lat),w=new l.N(k.lng+360,k.lat),P=h.locationPoint(k).distSqr(t);h.locationPoint(y).distSqr(t)<P?k=y:h.locationPoint(w).distSqr(t)<P&&(k=w)}for(;Math.abs(k.lng-h.center.lng)>180;){const y=h.locationPoint(k);if(y.x>=0&&y.y>=0&&y.x<=h.width&&y.y<=h.height)break;k.lng>h.center.lng?k.lng-=360:k.lng+=360}return k.lng!==_.lng&&h.locationPoint(k).y>h.height/2-h.getHorizon()?k:_}const el={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function bu(k,t,h){const _=k.classList;for(const y in el)_.remove(`maplibregl-${h}-anchor-${y}`);_.add(`maplibregl-${h}-anchor-${t}`)}class xu extends l.E{constructor(t){if(super(),this._onKeyPress=h=>{const _=h.code,y=h.charCode||h.keyCode;_!=="Space"&&_!=="Enter"&&y!==32&&y!==13||this.togglePopup()},this._onMapClick=h=>{const _=h.originalEvent.target,y=this._element;this._popup&&(_===y||y.contains(_))&&this.togglePopup()},this._update=h=>{var _;if(!this._map)return;const y=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!y)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ii(this._lngLat,this._flatPos,this._map.transform):(_=this._lngLat)===null||_===void 0?void 0:_.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let w="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?w=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(w=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let P="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?P="rotateX(0deg)":this._pitchAlignment==="map"&&(P=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||h&&h.type!=="moveend"||(this._pos=this._pos.round()),N.setTransform(this._element,`${el[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${P} ${w}`),L.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=l.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=N.create("div");const h=N.createNS("http://www.w3.org/2000/svg","svg"),_=41,y=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${_}px`),h.setAttributeNS(null,"width",`${y}px`),h.setAttributeNS(null,"viewBox",`0 0 ${y} ${_}`);const w=N.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");const P=N.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");const D=N.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(3.0, 29.0)"),D.setAttributeNS(null,"fill","#000000");const z=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ze of z){const qe=N.createNS("http://www.w3.org/2000/svg","ellipse");qe.setAttributeNS(null,"opacity","0.04"),qe.setAttributeNS(null,"cx","10.5"),qe.setAttributeNS(null,"cy","5.80029008"),qe.setAttributeNS(null,"rx",ze.rx),qe.setAttributeNS(null,"ry",ze.ry),D.appendChild(qe)}const V=N.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"fill",this._color);const H=N.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),V.appendChild(H);const W=N.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"fill","#000000");const ne=N.createNS("http://www.w3.org/2000/svg","path");ne.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),W.appendChild(ne);const ge=N.createNS("http://www.w3.org/2000/svg","g");ge.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ge.setAttributeNS(null,"fill","#FFFFFF");const ke=N.createNS("http://www.w3.org/2000/svg","g");ke.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Me=N.createNS("http://www.w3.org/2000/svg","circle");Me.setAttributeNS(null,"fill","#000000"),Me.setAttributeNS(null,"opacity","0.25"),Me.setAttributeNS(null,"cx","5.5"),Me.setAttributeNS(null,"cy","5.5"),Me.setAttributeNS(null,"r","5.4999962");const Ne=N.createNS("http://www.w3.org/2000/svg","circle");Ne.setAttributeNS(null,"fill","#FFFFFF"),Ne.setAttributeNS(null,"cx","5.5"),Ne.setAttributeNS(null,"cy","5.5"),Ne.setAttributeNS(null,"r","5.4999962"),ke.appendChild(Me),ke.appendChild(Ne),P.appendChild(D),P.appendChild(V),P.appendChild(W),P.appendChild(ge),P.appendChild(ke),h.appendChild(P),h.setAttributeNS(null,"height",_*this._scale+"px"),h.setAttributeNS(null,"width",y*this._scale+"px"),this._element.appendChild(h),this._offset=l.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),bu(this._element,this._anchor,"marker"),t&&t.className)for(const h of t.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),N.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=l.N.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const y=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var h,_;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const y=this._map,w=y.terrain.depthAtPoint(this._pos),P=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,P)-w<.006)return void(this._element.style.opacity=this._opacity);const D=-this._offset.y/y.transform._pixelPerMeter,z=Math.sin(y.getPitch()*Math.PI/180)*D,V=y.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),H=y.transform.lngLatToCameraDepth(this._lngLat,P+z)-V>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&H&&this._popup.remove(),this._element.style.opacity=H?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=l.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,h){return t===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const Zh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let jl=0,Vl=!1;const co={maxWidth:100,unit:"metric"};function ql(k,t,h){const _=h&&h.maxWidth||100,y=k._container.clientHeight/2,w=k.unproject([0,y]),P=k.unproject([_,y]),D=w.distanceTo(P);if(h&&h.unit==="imperial"){const z=3.2808*D;z>5280?nn(t,_,z/5280,k._getUIString("ScaleControl.Miles")):nn(t,_,z,k._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?nn(t,_,D/1852,k._getUIString("ScaleControl.NauticalMiles")):D>=1e3?nn(t,_,D/1e3,k._getUIString("ScaleControl.Kilometers")):nn(t,_,D,k._getUIString("ScaleControl.Meters"))}function nn(k,t,h,_){const y=function(w){const P=Math.pow(10,`${Math.floor(w)}`.length-1);let D=w/P;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function(z){const V=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*V)/V}(D),P*D}(h);k.style.width=t*(y/h)+"px",k.innerHTML=`${y}&nbsp;${_}`}const vn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},wu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ku(k){if(k){if(typeof k=="number"){const t=Math.round(Math.abs(k)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,k),"top-left":new l.P(t,t),"top-right":new l.P(-t,t),bottom:new l.P(0,-k),"bottom-left":new l.P(t,-t),"bottom-right":new l.P(-t,-t),left:new l.P(k,0),right:new l.P(-k,0)}}if(k instanceof l.P||Array.isArray(k)){const t=l.P.convert(k);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:l.P.convert(k.center||[0,0]),top:l.P.convert(k.top||[0,0]),"top-left":l.P.convert(k["top-left"]||[0,0]),"top-right":l.P.convert(k["top-right"]||[0,0]),bottom:l.P.convert(k.bottom||[0,0]),"bottom-left":l.P.convert(k["bottom-left"]||[0,0]),"bottom-right":l.P.convert(k["bottom-right"]||[0,0]),left:l.P.convert(k.left||[0,0]),right:l.P.convert(k.right||[0,0])}}return ku(new l.P(0,0))}const Vc=x;m.AJAXError=l.bh,m.Evented=l.E,m.LngLat=l.N,m.MercatorCoordinate=l.Z,m.Point=l.P,m.addProtocol=l.bi,m.config=l.a,m.removeProtocol=l.bj,m.AttributionControl=Ka,m.BoxZoomHandler=dr,m.CanvasSource=qi,m.CooperativeGesturesHandler=Ya,m.DoubleClickZoomHandler=ka,m.DragPanHandler=Uh,m.DragRotateHandler=jh,m.EdgeInsets=q,m.FullscreenControl=class extends l.E{constructor(k={}){super(),this._onFullscreenChange=()=>{var t;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=h==null?void 0:h.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,k&&k.container&&(k.container instanceof HTMLElement?this._container=k.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(k){return this._map=k,this._container||(this._container=this._map.getContainer()),this._controlContainer=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){N.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const k=this._fullscreenButton=N.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);N.create("span","maplibregl-ctrl-icon",k).setAttribute("aria-hidden","true"),k.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const k=this._getTitle();this._fullscreenButton.setAttribute("aria-label",k),this._fullscreenButton.title=k}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},m.GeoJSONSource=_n,m.GeolocateControl=class extends l.E{constructor(k){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const h=new l.N(t.coords.longitude,t.coords.latitude),_=t.coords.accuracy,y=this._map.getBearing(),w=l.e({bearing:y},this.options.fitBoundsOptions),P=Ye.fromLngLat(h,_);this._map.fitBounds(P,w,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const h=new l.N(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Vl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=N.create("button","maplibregl-ctrl-geolocate",this._container),N.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new xu({element:this._dotElement}),this._circleElement=N.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new xu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")),this.fire(new l.k("userlocationlostfocus")))})}},this.options=l.e({},Zh,k)}onAdd(k){return this._map=k,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return l._(this,arguments,void 0,function*(t=!1){if(Is!==void 0&&!t)return Is;if(window.navigator.permissions===void 0)return Is=!!window.navigator.geolocation,Is;try{Is=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Is=!!window.navigator.geolocation}return Is})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),N.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,jl=0,Vl=!1}_isOutOfMapMaxBounds(k){const t=this._map.getMaxBounds(),h=k.coords;return t&&(h.longitude<t.getWest()||h.longitude>t.getEast()||h.latitude<t.getSouth()||h.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const k=this._map.getBounds(),t=k.getSouthEast(),h=k.getNorthEast(),_=t.distanceTo(h),y=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":jl--,Vl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart")),this.fire(new l.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let k;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),jl++,jl>1?(k={maximumAge:6e5,timeout:0},Vl=!0):(k=this.options.positionOptions,Vl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,k)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},m.Hash=$e,m.ImageSource=Yi,m.KeyboardHandler=Ds,m.LngLatBounds=Ye,m.LogoControl=Oc,m.Map=class extends Vh{constructor(k){l.bf.mark(l.bg.create);const t=Object.assign(Object.assign({},cd),k);if(t.minZoom!=null&&t.maxZoom!=null&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(t.minPitch!=null&&t.maxPitch!=null&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(t.minPitch!=null&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(t.maxPitch!=null&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new me(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),{bearingSnap:t.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new qn,this._controls=[],this._mapId=l.a4(),this._contextLost=h=>{h.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:h}))},this._contextRestored=h=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:h}))},this._onMapScroll=h=>{if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._maxTileCacheZoomLevels=t.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=t.preserveDrawingBuffer===!0,this._antialias=t.antialias===!0,this._trackResize=t.trackResize===!0,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles===!0,this._fadeDuration=t.fadeDuration,this._crossSourceCollisions=t.crossSourceCollisions===!0,this._collectResourceTiming=t.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Uc),t.locale),this._clickTolerance=t.clickTolerance,this._overridePixelRatio=t.pixelRatio,this._maxCanvasSize=t.maxCanvasSize,this.transformCameraUpdate=t.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=t.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=$.addThrottleControl(()=>this.isMoving()),this._requestManager=new pe(t.transformRequest),typeof t.container=="string"){if(this._container=document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container}' not found.`)}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(t.maxBounds&&this.setMaxBounds(t.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let h=!1;const _=Fe(y=>{this._trackResize&&!this._removed&&(this.resize(y),this.redraw())},50);this._resizeObserver=new ResizeObserver(y=>{h?_(y):h=!0}),this._resizeObserver.observe(this._container)}this.handlers=new zc(this,t),this._hash=t.hash&&new $e(typeof t.hash=="string"&&t.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(this.resize(),this.fitBounds(t.bounds,l.e({},t.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=t.localIdeographFontFamily,this._validateStyle=t.validateStyle,t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily}),t.attributionControl&&this.addControl(new Ka(typeof t.attributionControl=="boolean"?void 0:t.attributionControl)),t.maplibreLogo&&this.addControl(new Oc,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new l.k(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new l.k(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new l.k("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(k,t){if(t===void 0&&(t=k.getDefaultPosition?k.getDefaultPosition():"top-right"),!k||!k.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=k.onAdd(this);this._controls.push(k);const _=this._controlPositions[t];return t.indexOf("bottom")!==-1?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(k){if(!k||!k.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(k);return t>-1&&this._controls.splice(t,1),k.onRemove(this),this}hasControl(k){return this._controls.indexOf(k)>-1}calculateCameraOptionsFromTo(k,t,h,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(k,t,h,_)}resize(k){var t;const h=this._containerDimensions(),_=h[0],y=h[1],w=this._getClampedPixelRatio(_,y);if(this._resizeCanvas(_,y,w),this.painter.resize(_,y,w),this.painter.overLimit()){const D=this.painter.context.gl;this._maxCanvasSize=[D.drawingBufferWidth,D.drawingBufferHeight];const z=this._getClampedPixelRatio(_,y);this._resizeCanvas(_,y,z),this.painter.resize(_,y,z)}this.transform.resize(_,y),(t=this._requestedCameraState)===null||t===void 0||t.resize(_,y);const P=!this._moving;return P&&(this.stop(),this.fire(new l.k("movestart",k)).fire(new l.k("move",k))),this.fire(new l.k("resize",k)),P&&this.fire(new l.k("moveend",k)),this}_getClampedPixelRatio(k,t){const{0:h,1:_}=this._maxCanvasSize,y=this.getPixelRatio(),w=k*y,P=t*y;return Math.min(w>h?h/w:1,P>_?_/P:1)*y}getPixelRatio(){var k;return(k=this._overridePixelRatio)!==null&&k!==void 0?k:devicePixelRatio}setPixelRatio(k){this._overridePixelRatio=k,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(k){return this.transform.setMaxBounds(Ye.convert(k)),this._update()}setMinZoom(k){if((k=k??-2)>=-2&&k<=this.transform.maxZoom)return this.transform.minZoom=k,this._update(),this.getZoom()<k&&this.setZoom(k),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(k){if((k=k??22)>=this.transform.minZoom)return this.transform.maxZoom=k,this._update(),this.getZoom()>k&&this.setZoom(k),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(k){if((k=k??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(k>=0&&k<=this.transform.maxPitch)return this.transform.minPitch=k,this._update(),this.getPitch()<k&&this.setPitch(k),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(k){if((k=k??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(k>=this.transform.minPitch)return this.transform.maxPitch=k,this._update(),this.getPitch()>k&&this.setPitch(k),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(k){return this.transform.renderWorldCopies=k,this._update()}project(k){return this.transform.locationPoint(l.N.convert(k),this.style&&this.terrain)}unproject(k){return this.transform.pointLocation(l.P.convert(k),this.terrain)}isMoving(){var k;return this._moving||((k=this.handlers)===null||k===void 0?void 0:k.isMoving())}isZooming(){var k;return this._zooming||((k=this.handlers)===null||k===void 0?void 0:k.isZooming())}isRotating(){var k;return this._rotating||((k=this.handlers)===null||k===void 0?void 0:k.isRotating())}_createDelegatedListener(k,t,h){if(k==="mouseenter"||k==="mouseover"){let _=!1;return{layers:t,listener:h,delegates:{mousemove:w=>{const P=t.filter(z=>this.getLayer(z)),D=P.length!==0?this.queryRenderedFeatures(w.point,{layers:P}):[];D.length?_||(_=!0,h.call(this,new li(k,this,w.originalEvent,{features:D}))):_=!1},mouseout:()=>{_=!1}}}}if(k==="mouseleave"||k==="mouseout"){let _=!1;return{layers:t,listener:h,delegates:{mousemove:P=>{const D=t.filter(z=>this.getLayer(z));(D.length!==0?this.queryRenderedFeatures(P.point,{layers:D}):[]).length?_=!0:_&&(_=!1,h.call(this,new li(k,this,P.originalEvent)))},mouseout:P=>{_&&(_=!1,h.call(this,new li(k,this,P.originalEvent)))}}}}{const _=y=>{const w=t.filter(D=>this.getLayer(D)),P=w.length!==0?this.queryRenderedFeatures(y.point,{layers:w}):[];P.length&&(y.features=P,h.call(this,y),delete y.features)};return{layers:t,listener:h,delegates:{[k]:_}}}}_saveDelegatedListener(k,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[k]=this._delegatedListeners[k]||[],this._delegatedListeners[k].push(t)}_removeDelegatedListener(k,t,h){if(!this._delegatedListeners||!this._delegatedListeners[k])return;const _=this._delegatedListeners[k];for(let y=0;y<_.length;y++){const w=_[y];if(w.listener===h&&w.layers.length===t.length&&w.layers.every(P=>t.includes(P))){for(const P in w.delegates)this.off(P,w.delegates[P]);return void _.splice(y,1)}}}on(k,t,h){if(h===void 0)return super.on(k,t);const _=this._createDelegatedListener(k,typeof t=="string"?[t]:t,h);this._saveDelegatedListener(k,_);for(const y in _.delegates)this.on(y,_.delegates[y]);return this}once(k,t,h){if(h===void 0)return super.once(k,t);const _=typeof t=="string"?[t]:t,y=this._createDelegatedListener(k,_,h);for(const w in y.delegates){const P=y.delegates[w];y.delegates[w]=(...D)=>{this._removeDelegatedListener(k,_,h),P(...D)}}this._saveDelegatedListener(k,y);for(const w in y.delegates)this.once(w,y.delegates[w]);return this}off(k,t,h){return h===void 0?super.off(k,t):(this._removeDelegatedListener(k,typeof t=="string"?[t]:t,h),this)}queryRenderedFeatures(k,t){if(!this.style)return[];let h;const _=k instanceof l.P||Array.isArray(k),y=_?k:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(_?{}:k)||{},y instanceof l.P||typeof y[0]=="number")h=[l.P.convert(y)];else{const w=l.P.convert(y[0]),P=l.P.convert(y[1]);h=[w,new l.P(P.x,w.y),P,new l.P(w.x,P.y),w]}return this.style.queryRenderedFeatures(h,t,this.transform)}querySourceFeatures(k,t){return this.style.querySourceFeatures(k,t)}setStyle(k,t){return(t=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&k?(this._diffStyle(k,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(k,t))}setTransformRequest(k){return this._requestManager.setTransformRequest(k),this}_getUIString(k){const t=this._locale[k];if(t==null)throw new Error(`Missing UI string '${k}'`);return t}_updateStyle(k,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(k,t));const h=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!k)),k?(this.style=new ca(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof k=="string"?this.style.loadURL(k,t,h):this.style.loadJSON(k,t,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ca(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(k,t){if(typeof k=="string"){const h=this._requestManager.transformRequest(k,"Style");l.h(h,new AbortController).then(_=>{this._updateDiff(_.data,t)}).catch(_=>{_&&this.fire(new l.j(_))})}else typeof k=="object"&&this._updateDiff(k,t)}_updateDiff(k,t){try{this.style.setState(k,t)&&this._update(!0)}catch(h){l.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(k,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(k,t){return this._lazyInitEmptyStyle(),this.style.addSource(k,t),this._update(!0)}isSourceLoaded(k){const t=this.style&&this.style.sourceCaches[k];if(t!==void 0)return t.loaded();this.fire(new l.j(new Error(`There is no source with ID '${k}'`)))}setTerrain(k){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),k){const t=this.style.sourceCaches[k.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${k.source}`);this.terrain===null&&t.reload();for(const h in this.style._layers){const _=this.style._layers[h];_.type==="hillshade"&&_.source===k.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Bc(this.painter,t,k),this.painter.renderToTexture=new qh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==k.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:k})),this}getTerrain(){var k,t;return(t=(k=this.terrain)===null||k===void 0?void 0:k.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const k=this.style&&this.style.sourceCaches;for(const t in k){const h=k[t]._tiles;for(const _ in h){const y=h[_];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}removeSource(k){return this.style.removeSource(k),this._update(!0)}getSource(k){return this.style.getSource(k)}addImage(k,t,h={}){const{pixelRatio:_=1,sdf:y=!1,stretchX:w,stretchY:P,content:D,textFitWidth:z,textFitHeight:V}=h;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||l.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:H,height:W,data:ne}=t,ge=t;return this.style.addImage(k,{data:new l.R({width:H,height:W},new Uint8Array(ne)),pixelRatio:_,stretchX:w,stretchY:P,content:D,textFitWidth:z,textFitHeight:V,sdf:y,version:0,userImage:ge}),ge.onAdd&&ge.onAdd(this,k),this}}{const{width:H,height:W,data:ne}=L.getImageData(t);this.style.addImage(k,{data:new l.R({width:H,height:W},ne),pixelRatio:_,stretchX:w,stretchY:P,content:D,textFitWidth:z,textFitHeight:V,sdf:y,version:0})}}updateImage(k,t){const h=this.style.getImage(k);if(!h)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=t instanceof HTMLImageElement||l.b(t)?L.getImageData(t):t,{width:y,height:w,data:P}=_;if(y===void 0||w===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==h.data.width||w!==h.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const D=!(t instanceof HTMLImageElement||l.b(t));return h.data.replace(P,D),this.style.updateImage(k,h),this}getImage(k){return this.style.getImage(k)}hasImage(k){return k?!!this.style.getImage(k):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(k){this.style.removeImage(k)}loadImage(k){return $.getImage(this._requestManager.transformRequest(k,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(k,t){return this._lazyInitEmptyStyle(),this.style.addLayer(k,t),this._update(!0)}moveLayer(k,t){return this.style.moveLayer(k,t),this._update(!0)}removeLayer(k){return this.style.removeLayer(k),this._update(!0)}getLayer(k){return this.style.getLayer(k)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(k,t,h){return this.style.setLayerZoomRange(k,t,h),this._update(!0)}setFilter(k,t,h={}){return this.style.setFilter(k,t,h),this._update(!0)}getFilter(k){return this.style.getFilter(k)}setPaintProperty(k,t,h,_={}){return this.style.setPaintProperty(k,t,h,_),this._update(!0)}getPaintProperty(k,t){return this.style.getPaintProperty(k,t)}setLayoutProperty(k,t,h,_={}){return this.style.setLayoutProperty(k,t,h,_),this._update(!0)}getLayoutProperty(k,t){return this.style.getLayoutProperty(k,t)}setGlyphs(k,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(k,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(k,t,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(k,t,h,_=>{_||this._update(!0)}),this}removeSprite(k){return this._lazyInitEmptyStyle(),this.style.removeSprite(k),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(k,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(k,t,h=>{h||this._update(!0)}),this}setLight(k,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(k,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(k){return this._lazyInitEmptyStyle(),this.style.setSky(k),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(k,t){return this.style.setFeatureState(k,t),this._update()}removeFeatureState(k,t){return this.style.removeFeatureState(k,t),this._update()}getFeatureState(k){return this.style.getFeatureState(k)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let k=0,t=0;return this._container&&(k=this._container.clientWidth||400,t=this._container.clientHeight||300),[k,t]}_setupContainer(){const k=this._container;k.classList.add("maplibregl-map");const t=this._canvasContainer=N.create("div","maplibregl-canvas-container",k);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=N.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),_=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],_);const y=this._controlContainer=N.create("div","maplibregl-control-container",k),w=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(P=>{w[P]=N.create("div",`maplibregl-ctrl-${P} `,y)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(k,t,h){this._canvas.width=Math.floor(h*k),this._canvas.height=Math.floor(h*t),this._canvas.style.width=`${k}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const k={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",_=>{t={requestedAttributes:k},_&&(t.statusMessage=_.statusMessage,t.type=_.type)},{once:!0});const h=this._canvas.getContext("webgl2",k)||this._canvas.getContext("webgl",k);if(!h){const _="Failed to initialize WebGL";throw t?(t.message=_,new Error(JSON.stringify(t))):new Error(_)}this.painter=new b(h,this.transform),B.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(k){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||k,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(k){return this._update(),this._renderTaskQueue.add(k)}_cancelRenderFrame(k){this._renderTaskQueue.remove(k)}_render(k){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(k),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const y=this.transform.zoom,w=L.now();this.style.zoomHistory.update(y,w);const P=new l.z(y,{now:w,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),D=P.crossFadingFactor();D===1&&D===this._crossFadingFactor||(h=!0,this._crossFadingFactor=D),this.style.update(P)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bf.mark(l.bg.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const _=this._sourcesDirty||this._styleDirty||this._placementDirty;return _||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||_||(this._fullyLoaded=!0,l.bf.mark(l.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var k;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),$.removeThrottleControl(this._imageQueueHandle),(k=this._resizeObserver)===null||k===void 0||k.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t!=null&&t.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),N.remove(this._canvasContainer),N.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bf.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,L.frameAsync(this._frameRequest).then(k=>{l.bf.frame(k),this._frameRequest=null,this._render(k)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(k){this._showTileBoundaries!==k&&(this._showTileBoundaries=k,this._update())}get showPadding(){return!!this._showPadding}set showPadding(k){this._showPadding!==k&&(this._showPadding=k,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(k){this._showCollisionBoxes!==k&&(this._showCollisionBoxes=k,k?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(k){this._showOverdrawInspector!==k&&(this._showOverdrawInspector=k,this._update())}get repaint(){return!!this._repaint}set repaint(k){this._repaint!==k&&(this._repaint=k,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(k){this._vertices=k,this._update()}get version(){return Gh}getCameraTargetElevation(){return this.transform.elevation}},m.MapMouseEvent=li,m.MapTouchEvent=er,m.MapWheelEvent=rs,m.Marker=xu,m.NavigationControl=class{constructor(k){this._updateZoomButtons=()=>{const t=this._map.getZoom(),h=t===this._map.getMaxZoom(),_=t===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,h)=>{const _=this._map._getUIString(`NavigationControl.${h}`);t.title=_,t.setAttribute("aria-label",_)},this.options=l.e({},hd,k),this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),N.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),N.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=N.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(k){return this._map=k,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new fd(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){N.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(k,t){const h=N.create("button",k,this._container);return h.type="button",h.addEventListener("click",t),h}},m.Popup=class extends l.E{constructor(k){super(),this.remove=()=>(this._content&&N.remove(this._content),this._container&&(N.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=N.create("div","maplibregl-popup",this._map.getContainer()),this._tip=N.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const D of this.options.className.split(" "))this._container.classList.add(D);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ii(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!t)return;const _=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationPoint(this._lngLat));let y=this.options.anchor;const w=ku(this.options.offset);if(!y){const D=this._container.offsetWidth,z=this._container.offsetHeight;let V;V=_.y+w.bottom.y<z?["top"]:_.y>this._map.transform.height-z?["bottom"]:[],_.x<D/2?V.push("left"):_.x>this._map.transform.width-D/2&&V.push("right"),y=V.length===0?"bottom":V.join("-")}let P=_.add(w[y]);this.options.subpixelPositioning||(P=P.round()),N.setTransform(this._container,`${el[y]} translate(${P.x}px,${P.y}px)`),bu(this._container,y,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(vn),k)}addTo(k){return this._map&&this.remove(),this._map=k,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(k){return this._lngLat=l.N.convert(k),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(k){return this.setDOMContent(document.createTextNode(k))}setHTML(k){const t=document.createDocumentFragment(),h=document.createElement("body");let _;for(h.innerHTML=k;_=h.firstChild,_;)t.appendChild(_);return this.setDOMContent(t)}getMaxWidth(){var k;return(k=this._container)===null||k===void 0?void 0:k.style.maxWidth}setMaxWidth(k){return this.options.maxWidth=k,this._update(),this}setDOMContent(k){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=N.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(k),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(k){return this._container&&this._container.classList.add(k),this}removeClassName(k){return this._container&&this._container.classList.remove(k),this}setOffset(k){return this.options.offset=k,this._update(),this}toggleClassName(k){if(this._container)return this._container.classList.toggle(k)}setSubpixelPositioning(k){this.options.subpixelPositioning=k}_createCloseButton(){this.options.closeButton&&(this._closeButton=N.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const k=this._container.querySelector(wu);k&&k.focus()}},m.RasterDEMTileSource=Gt,m.RasterTileSource=Ee,m.ScaleControl=class{constructor(k){this._onMove=()=>{ql(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,ql(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},co),k)}getDefaultPosition(){return"bottom-left"}onAdd(k){return this._map=k,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-scale",k.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){N.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},m.ScrollZoomHandler=Zs,m.Style=ca,m.TerrainControl=class{constructor(k){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=k}onAdd(k){return this._map=k,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=N.create("button","maplibregl-ctrl-terrain",this._container),N.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){N.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},m.TwoFingersTouchPitchHandler=$a,m.TwoFingersTouchRotateHandler=Rc,m.TwoFingersTouchZoomHandler=Ac,m.TwoFingersTouchZoomRotateHandler=Nc,m.VectorTileSource=Vt,m.VideoSource=xn,m.addSourceType=(k,t)=>l._(void 0,void 0,void 0,function*(){if(Jr(k))throw new Error(`A source type called "${k}" already exists.`);((h,_)=>{Ji[h]=_})(k,t)}),m.clearPrewarmedResources=function(){const k=Rn;k&&(k.isPreloaded()&&k.numActive()===1?(k.release(It),Rn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},m.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},m.getRTLTextPluginStatus=function(){return mn().getRTLTextPluginStatus()},m.getVersion=function(){return Vc},m.getWorkerCount=function(){return Jt.workerCount},m.getWorkerUrl=function(){return l.a.WORKER_URL},m.importScriptInWorkers=function(k){return Ft().broadcast("IS",k)},m.prewarm=function(){Wn().acquire(It)},m.setMaxParallelImageRequests=function(k){l.a.MAX_PARALLEL_IMAGE_REQUESTS=k},m.setRTLTextPlugin=function(k,t){return mn().setRTLTextPlugin(k,t)},m.setWorkerCount=function(k){Jt.workerCount=k},m.setWorkerUrl=function(k){l.a.WORKER_URL=k}});var f=n;return f})})(ev);var ux=ev.exports;const Ls=lx(ux);var cx=Object.defineProperty,hx=(r,e,n)=>e in r?cx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n,qg=(r,e,n)=>hx(r,typeof e!="symbol"?e+"":e,n);function Lh(){}function nv(r){return r()}function Gg(){return Object.create(null)}function nd(r){r.forEach(nv)}function iv(r){return typeof r=="function"}function fx(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}function dx(r){return Object.keys(r).length===0}function px(r,e){r.appendChild(e)}function mx(r,e,n){r.insertBefore(e,n||null)}function rv(r){r.parentNode&&r.parentNode.removeChild(r)}function Zg(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function dl(r,e,n){n==null?r.removeAttribute(e):r.getAttribute(e)!==n&&r.setAttribute(e,n)}function gx(r){return Array.from(r.childNodes)}function _f(r,e,n){r.classList.toggle(e,!!n)}let Vp;function wh(r){Vp=r}const Xu=[],Hg=[];let ec=[];const Wg=[],_x=Promise.resolve();let _p=!1;function yx(){_p||(_p=!0,_x.then(sv))}function yp(r){ec.push(r)}const rp=new Set;let Vu=0;function sv(){if(Vu!==0)return;const r=Vp;do{try{for(;Vu<Xu.length;){const e=Xu[Vu];Vu++,wh(e),vx(e.$$)}}catch(e){throw Xu.length=0,Vu=0,e}for(wh(null),Xu.length=0,Vu=0;Hg.length;)Hg.pop()();for(let e=0;e<ec.length;e+=1){const n=ec[e];rp.has(n)||(rp.add(n),n())}ec.length=0}while(Xu.length);for(;Wg.length;)Wg.pop()();_p=!1,rp.clear(),wh(r)}function vx(r){if(r.fragment!==null){r.update(),nd(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(yp)}}function bx(r){const e=[],n=[];ec.forEach(s=>r.indexOf(s)===-1?e.push(s):n.push(s)),n.forEach(s=>s()),ec=e}const xx=new Set;function wx(r,e){r&&r.i&&(xx.delete(r),r.i(e))}function kx(r,e,n){const{fragment:s,after_update:a}=r.$$;s&&s.m(e,n),yp(()=>{const f=r.$$.on_mount.map(nv).filter(iv);r.$$.on_destroy?r.$$.on_destroy.push(...f):nd(f),r.$$.on_mount=[]}),a.forEach(yp)}function Ix(r,e){const n=r.$$;n.fragment!==null&&(bx(n.after_update),nd(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Sx(r,e){r.$$.dirty[0]===-1&&(Xu.push(r),yx(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Ex(r,e,n,s,a,f,m=null,l=[-1]){const x=Vp;wh(r);const S=r.$$={fragment:null,ctx:[],props:f,update:Lh,not_equal:a,bound:Gg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(x?x.$$.context:[])),callbacks:Gg(),dirty:l,skip_bound:!1,root:e.target||x.$$.root};m&&m(S.root);let C=!1;if(S.ctx=n?n(r,e.props||{},(L,N,...B)=>{const U=B.length?B[0]:N;return S.ctx&&a(S.ctx[L],S.ctx[L]=U)&&(!S.skip_bound&&S.bound[L]&&S.bound[L](U),C&&Sx(r,L)),N}):[],S.update(),C=!0,nd(S.before_update),S.fragment=s?s(S.ctx):!1,e.target){if(e.hydrate){const L=gx(e.target);S.fragment&&S.fragment.l(L),L.forEach(rv)}else S.fragment&&S.fragment.c();e.intro&&wx(r.$$.fragment),kx(r,e.target,e.anchor),sv()}wh(x)}class Tx{constructor(){qg(this,"$$"),qg(this,"$$set")}$destroy(){Ix(this,1),this.$destroy=Lh}$on(e,n){if(!iv(n))return Lh;const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(n),()=>{const a=s.indexOf(n);a!==-1&&s.splice(a,1)}}$set(e){this.$$set&&!dx(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Cx="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Cx);function Lx(r){let e,n,s;return{c(){e=Zg("svg"),n=Zg("path"),dl(n,"stroke-width","4"),dl(n,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),dl(n,"class","svelte-gzo3ar"),dl(e,"width",s=r[0]==="list"?20:void 0),dl(e,"viewBox","0 0 70 85"),dl(e,"fill","none"),dl(e,"class","svelte-gzo3ar"),_f(e,"in-map",r[0]!=="list"),_f(e,"list-icon",r[0]==="list")},m(a,f){mx(a,e,f),px(e,n)},p(a,[f]){f&1&&s!==(s=a[0]==="list"?20:void 0)&&dl(e,"width",s),f&1&&_f(e,"in-map",a[0]!=="list"),f&1&&_f(e,"list-icon",a[0]==="list")},i:Lh,o:Lh,d(a){a&&rv(e)}}}function Mx(r,e,n){let{displayIn:s}=e;return r.$$set=a=>{"displayIn"in a&&n(0,s=a.displayIn)},[s]}class Ax extends Tx{constructor(e){super(),Ex(this,e,Mx,Lx,fx,{displayIn:0})}}const Px=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],Rx={decimalLatitude:40.123,decimalLongitude:-74.123},Dx=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],Nx=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function zx(){const r=[];return Px.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...Rx})}),[...r,...Dx,...Nx]}const Ox=zx();Ox.map(r=>r.verbatimCoordinates);var Us=63710088e-1,ov={centimeters:Us*100,centimetres:Us*100,degrees:360/(2*Math.PI),feet:Us*3.28084,inches:Us*39.37,kilometers:Us/1e3,kilometres:Us/1e3,meters:Us,metres:Us,miles:Us/1609.344,millimeters:Us*1e3,millimetres:Us*1e3,nauticalmiles:Us/1852,radians:1,yards:Us*1.0936};function zh(r,e,n={}){const s={type:"Feature"};return(n.id===0||n.id)&&(s.id=n.id),n.bbox&&(s.bbox=n.bbox),s.properties=e||{},s.geometry=r,s}function Fx(r,e,n={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Xg(r[0])||!Xg(r[1]))throw new Error("coordinates must contain numbers");return zh({type:"Point",coordinates:r},e,n)}function qp(r,e,n={}){for(const s of r){if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(s[s.length-1].length!==s[0].length)throw new Error("First and last Position are not equivalent.");for(let a=0;a<s[s.length-1].length;a++)if(s[s.length-1][a]!==s[0][a])throw new Error("First and last Position are not equivalent.")}return zh({type:"Polygon",coordinates:r},e,n)}function ru(r,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=r,n}function av(r,e,n={}){return zh({type:"MultiPolygon",coordinates:r},e,n)}function Bx(r,e="kilometers"){const n=ov[e];if(!n)throw new Error(e+" units is invalid");return r*n}function Ux(r,e="kilometers"){const n=ov[e];if(!n)throw new Error(e+" units is invalid");return r/n}function Xg(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function jx(r,e){var n={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},s,a,f,m;return m={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function l(S){return function(C){return x([S,C])}}function x(S){if(s)throw new TypeError("Generator is already executing.");for(;n;)try{if(s=1,a&&(f=S[0]&2?a.return:S[0]?a.throw||((f=a.return)&&f.call(a),0):a.next)&&!(f=f.call(a,S[1])).done)return f;switch(a=0,f&&(S=[S[0]&2,f.value]),S[0]){case 0:case 1:f=S;break;case 4:return n.label++,{value:S[1],done:!1};case 5:n.label++,a=S[1],S=[0];continue;case 7:S=n.ops.pop(),n.trys.pop();continue;default:if(f=n.trys,!(f=f.length>0&&f[f.length-1])&&(S[0]===6||S[0]===2)){n=0;continue}if(S[0]===3&&(!f||S[1]>f[0]&&S[1]<f[3])){n.label=S[1];break}if(S[0]===6&&n.label<f[1]){n.label=f[1],f=S;break}if(f&&n.label<f[2]){n.label=f[2],n.ops.push(S);break}f[2]&&n.ops.pop(),n.trys.pop();continue}S=e.call(r,n)}catch(C){S=[6,C],a=0}finally{s=f=0}if(S[0]&5)throw S[1];return{value:S[0]?S[1]:void 0,done:!0}}}var xl=function(){function r(e,n){this.next=null,this.key=e,this.data=n,this.left=null,this.right=null}return r}();function Vx(r,e){return r>e?1:r<e?-1:0}function gl(r,e,n){for(var s=new xl(null,null),a=s,f=s;;){var m=n(r,e.key);if(m<0){if(e.left===null)break;if(n(r,e.left.key)<0){var l=e.left;if(e.left=l.right,l.right=e,e=l,e.left===null)break}f.left=e,f=e,e=e.left}else if(m>0){if(e.right===null)break;if(n(r,e.right.key)>0){var l=e.right;if(e.right=l.left,l.left=e,e=l,e.right===null)break}a.right=e,a=e,e=e.right}else break}return a.right=e.left,f.left=e.right,e.left=s.right,e.right=s.left,e}function sp(r,e,n,s){var a=new xl(r,e);if(n===null)return a.left=a.right=null,a;n=gl(r,n,s);var f=s(r,n.key);return f<0?(a.left=n.left,a.right=n,n.left=null):f>=0&&(a.right=n.right,a.left=n,n.right=null),a}function $g(r,e,n){var s=null,a=null;if(e){e=gl(r,e,n);var f=n(e.key,r);f===0?(s=e.left,a=e.right):f<0?(a=e.right,e.right=null,s=e):(s=e.left,e.left=null,a=e)}return{left:s,right:a}}function qx(r,e,n){return e===null?r:(r===null||(e=gl(r.key,e,n),e.left=r),e)}function vp(r,e,n,s,a){if(r){s(""+e+(n?"└── ":"├── ")+a(r)+`
`);var f=e+(n?"    ":"│   ");r.left&&vp(r.left,f,!1,s,a),r.right&&vp(r.right,f,!0,s,a)}}var Gp=function(){function r(e){e===void 0&&(e=Vx),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,n){return this._size++,this._root=sp(e,n,this._root,this._comparator)},r.prototype.add=function(e,n){var s=new xl(e,n);this._root===null&&(s.left=s.right=null,this._size++,this._root=s);var a=this._comparator,f=gl(e,this._root,a),m=a(e,f.key);return m===0?this._root=f:(m<0?(s.left=f.left,s.right=f,f.left=null):m>0&&(s.right=f.right,s.left=f,f.right=null),this._size++,this._root=s),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,n,s){var a;if(n===null)return null;n=gl(e,n,s);var f=s(e,n.key);return f===0?(n.left===null?a=n.right:(a=gl(e,n.left,s),a.right=n.right),this._size--,a):n},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=gl(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var n=this._root,s=this._comparator;n;){var a=s(e,n.key);if(a===0)return n;a<0?n=n.left:n=n.right}return null},r.prototype.find=function(e){return this._root&&(this._root=gl(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var n=this._root,s=this._comparator;n;){var a=s(e,n.key);if(a===0)return!0;a<0?n=n.left:n=n.right}return!1},r.prototype.forEach=function(e,n){for(var s=this._root,a=[],f=!1;!f;)s!==null?(a.push(s),s=s.left):a.length!==0?(s=a.pop(),e.call(n,s),s=s.right):f=!0;return this},r.prototype.range=function(e,n,s,a){for(var f=[],m=this._comparator,l=this._root,x;f.length!==0||l;)if(l)f.push(l),l=l.left;else{if(l=f.pop(),x=m(l.key,n),x>0)break;if(m(l.key,e)>=0&&s.call(a,l))return this;l=l.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(n){var s=n.key;return e.push(s)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(n){var s=n.data;return e.push(s)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var n=this._root,s=!1,a=0,f=[];!s;)if(n)f.push(n),n=n.left;else if(f.length>0){if(n=f.pop(),a===e)return n;a++,n=n.right}else s=!0;return null},r.prototype.next=function(e){var n=this._root,s=null;if(e.right){for(s=e.right;s.left;)s=s.left;return s}for(var a=this._comparator;n;){var f=a(e.key,n.key);if(f===0)break;f<0?(s=n,n=n.left):n=n.right}return s},r.prototype.prev=function(e){var n=this._root,s=null;if(e.left!==null){for(s=e.left;s.right;)s=s.right;return s}for(var a=this._comparator;n;){var f=a(e.key,n.key);if(f===0)break;f<0?n=n.left:(s=n,n=n.right)}return s},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return Zx(this._root)},r.prototype.load=function(e,n,s){n===void 0&&(n=[]),s===void 0&&(s=!1);var a=e.length,f=this._comparator;if(s&&wp(e,n,0,a-1,f),this._root===null)this._root=bp(e,n,0,a),this._size=a;else{var m=Hx(this.toList(),Gx(e,n),f);a=this._size+a,this._root=xp({head:m},0,a)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(s){return String(s.key)});var n=[];return vp(this._root,"",!0,function(s){return n.push(s)},e),n.join("")},r.prototype.update=function(e,n,s){var a=this._comparator,f=$g(e,this._root,a),m=f.left,l=f.right;a(e,n)<0?l=sp(n,s,l,a):m=sp(n,s,m,a),this._root=qx(m,l,a)},r.prototype.split=function(e){return $g(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,n,s;return jx(this,function(a){switch(a.label){case 0:e=this._root,n=[],s=!1,a.label=1;case 1:return s?[3,6]:e===null?[3,2]:(n.push(e),e=e.left,[3,5]);case 2:return n.length===0?[3,4]:(e=n.pop(),[4,e]);case 3:return a.sent(),e=e.right,[3,5];case 4:s=!0,a.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function bp(r,e,n,s){var a=s-n;if(a>0){var f=n+Math.floor(a/2),m=r[f],l=e[f],x=new xl(m,l);return x.left=bp(r,e,n,f),x.right=bp(r,e,f+1,s),x}return null}function Gx(r,e){for(var n=new xl(null,null),s=n,a=0;a<r.length;a++)s=s.next=new xl(r[a],e[a]);return s.next=null,n.next}function Zx(r){for(var e=r,n=[],s=!1,a=new xl(null,null),f=a;!s;)e?(n.push(e),e=e.left):n.length>0?(e=f=f.next=n.pop(),e=e.right):s=!0;return f.next=null,a.next}function xp(r,e,n){var s=n-e;if(s>0){var a=e+Math.floor(s/2),f=xp(r,e,a),m=r.head;return m.left=f,r.head=r.head.next,m.right=xp(r,a+1,n),m}return null}function Hx(r,e,n){for(var s=new xl(null,null),a=s,f=r,m=e;f!==null&&m!==null;)n(f.key,m.key)<0?(a.next=f,f=f.next):(a.next=m,m=m.next),a=a.next;return f!==null?a.next=f:m!==null&&(a.next=m),s.next}function wp(r,e,n,s,a){if(!(n>=s)){for(var f=r[n+s>>1],m=n-1,l=s+1;;){do m++;while(a(r[m],f)<0);do l--;while(a(r[l],f)>0);if(m>=l)break;var x=r[m];r[m]=r[l],r[l]=x,x=e[m],e[m]=e[l],e[l]=x}wp(r,e,n,l,a),wp(r,e,l+1,s,a)}}const Na=11102230246251565e-32,hs=134217729,Wx=(3+8*Na)*Na;function op(r,e,n,s,a){let f,m,l,x,S=e[0],C=s[0],L=0,N=0;C>S==C>-S?(f=S,S=e[++L]):(f=C,C=s[++N]);let B=0;if(L<r&&N<n)for(C>S==C>-S?(m=S+f,l=f-(m-S),S=e[++L]):(m=C+f,l=f-(m-C),C=s[++N]),f=m,l!==0&&(a[B++]=l);L<r&&N<n;)C>S==C>-S?(m=f+S,x=m-f,l=f-(m-x)+(S-x),S=e[++L]):(m=f+C,x=m-f,l=f-(m-x)+(C-x),C=s[++N]),f=m,l!==0&&(a[B++]=l);for(;L<r;)m=f+S,x=m-f,l=f-(m-x)+(S-x),S=e[++L],f=m,l!==0&&(a[B++]=l);for(;N<n;)m=f+C,x=m-f,l=f-(m-x)+(C-x),C=s[++N],f=m,l!==0&&(a[B++]=l);return(f!==0||B===0)&&(a[B++]=f),B}function Xx(r,e){let n=e[0];for(let s=1;s<r;s++)n+=e[s];return n}function Oh(r){return new Float64Array(r)}const $x=(3+16*Na)*Na,Yx=(2+12*Na)*Na,Jx=(9+64*Na)*Na*Na,qu=Oh(4),Yg=Oh(8),Jg=Oh(12),Kg=Oh(16),Cs=Oh(4);function Kx(r,e,n,s,a,f,m){let l,x,S,C,L,N,B,U,ee,ie,re,Q,$,pe,ve,De,he,xe;const be=r-a,Le=n-a,we=e-f,ye=s-f;pe=be*ye,N=hs*be,B=N-(N-be),U=be-B,N=hs*ye,ee=N-(N-ye),ie=ye-ee,ve=U*ie-(pe-B*ee-U*ee-B*ie),De=we*Le,N=hs*we,B=N-(N-we),U=we-B,N=hs*Le,ee=N-(N-Le),ie=Le-ee,he=U*ie-(De-B*ee-U*ee-B*ie),re=ve-he,L=ve-re,qu[0]=ve-(re+L)+(L-he),Q=pe+re,L=Q-pe,$=pe-(Q-L)+(re-L),re=$-De,L=$-re,qu[1]=$-(re+L)+(L-De),xe=Q+re,L=xe-Q,qu[2]=Q-(xe-L)+(re-L),qu[3]=xe;let Ue=Xx(4,qu),Ve=Yx*m;if(Ue>=Ve||-Ue>=Ve||(L=r-be,l=r-(be+L)+(L-a),L=n-Le,S=n-(Le+L)+(L-a),L=e-we,x=e-(we+L)+(L-f),L=s-ye,C=s-(ye+L)+(L-f),l===0&&x===0&&S===0&&C===0)||(Ve=Jx*m+Wx*Math.abs(Ue),Ue+=be*C+ye*l-(we*S+Le*x),Ue>=Ve||-Ue>=Ve))return Ue;pe=l*ye,N=hs*l,B=N-(N-l),U=l-B,N=hs*ye,ee=N-(N-ye),ie=ye-ee,ve=U*ie-(pe-B*ee-U*ee-B*ie),De=x*Le,N=hs*x,B=N-(N-x),U=x-B,N=hs*Le,ee=N-(N-Le),ie=Le-ee,he=U*ie-(De-B*ee-U*ee-B*ie),re=ve-he,L=ve-re,Cs[0]=ve-(re+L)+(L-he),Q=pe+re,L=Q-pe,$=pe-(Q-L)+(re-L),re=$-De,L=$-re,Cs[1]=$-(re+L)+(L-De),xe=Q+re,L=xe-Q,Cs[2]=Q-(xe-L)+(re-L),Cs[3]=xe;const pt=op(4,qu,4,Cs,Yg);pe=be*C,N=hs*be,B=N-(N-be),U=be-B,N=hs*C,ee=N-(N-C),ie=C-ee,ve=U*ie-(pe-B*ee-U*ee-B*ie),De=we*S,N=hs*we,B=N-(N-we),U=we-B,N=hs*S,ee=N-(N-S),ie=S-ee,he=U*ie-(De-B*ee-U*ee-B*ie),re=ve-he,L=ve-re,Cs[0]=ve-(re+L)+(L-he),Q=pe+re,L=Q-pe,$=pe-(Q-L)+(re-L),re=$-De,L=$-re,Cs[1]=$-(re+L)+(L-De),xe=Q+re,L=xe-Q,Cs[2]=Q-(xe-L)+(re-L),Cs[3]=xe;const St=op(pt,Yg,4,Cs,Jg);pe=l*C,N=hs*l,B=N-(N-l),U=l-B,N=hs*C,ee=N-(N-C),ie=C-ee,ve=U*ie-(pe-B*ee-U*ee-B*ie),De=x*S,N=hs*x,B=N-(N-x),U=x-B,N=hs*S,ee=N-(N-S),ie=S-ee,he=U*ie-(De-B*ee-U*ee-B*ie),re=ve-he,L=ve-re,Cs[0]=ve-(re+L)+(L-he),Q=pe+re,L=Q-pe,$=pe-(Q-L)+(re-L),re=$-De,L=$-re,Cs[1]=$-(re+L)+(L-De),xe=Q+re,L=xe-Q,Cs[2]=Q-(xe-L)+(re-L),Cs[3]=xe;const dt=op(St,Jg,4,Cs,Kg);return Kg[dt-1]}function Qx(r,e,n,s,a,f){const m=(e-f)*(n-a),l=(r-a)*(s-f),x=m-l,S=Math.abs(m+l);return Math.abs(x)>=$x*S?x:-Kx(r,e,n,s,a,f,S)}const uh=(r,e)=>r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y,kp=(r,e)=>{if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;const n=r.ll.x<e.ll.x?e.ll.x:r.ll.x,s=r.ur.x<e.ur.x?r.ur.x:e.ur.x,a=r.ll.y<e.ll.y?e.ll.y:r.ll.y,f=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:n,y:a},ur:{x:s,y:f}}};let yl=Number.EPSILON;yl===void 0&&(yl=Math.pow(2,-52));const ew=yl*yl,Qg=(r,e)=>{if(-yl<r&&r<yl&&-yl<e&&e<yl)return 0;const n=r-e;return n*n<ew*r*e?0:r<e?-1:1};class tw{constructor(){this.reset()}reset(){this.xRounder=new e_,this.yRounder=new e_}round(e,n){return{x:this.xRounder.round(e),y:this.yRounder.round(n)}}}class e_{constructor(){this.tree=new Gp,this.round(0)}round(e){const n=this.tree.add(e),s=this.tree.prev(n);if(s!==null&&Qg(n.key,s.key)===0)return this.tree.remove(e),s.key;const a=this.tree.next(n);return a!==null&&Qg(n.key,a.key)===0?(this.tree.remove(e),a.key):e}}const Mh=new tw,Cf=(r,e)=>r.x*e.y-r.y*e.x,lv=(r,e)=>r.x*e.x+r.y*e.y,t_=(r,e,n)=>{const s=Qx(r.x,r.y,e.x,e.y,n.x,n.y);return s>0?-1:s<0?1:0},zf=r=>Math.sqrt(lv(r,r)),nw=(r,e,n)=>{const s={x:e.x-r.x,y:e.y-r.y},a={x:n.x-r.x,y:n.y-r.y};return Cf(a,s)/zf(a)/zf(s)},iw=(r,e,n)=>{const s={x:e.x-r.x,y:e.y-r.y},a={x:n.x-r.x,y:n.y-r.y};return lv(a,s)/zf(a)/zf(s)},n_=(r,e,n)=>e.y===0?null:{x:r.x+e.x/e.y*(n-r.y),y:n},i_=(r,e,n)=>e.x===0?null:{x:n,y:r.y+e.y/e.x*(n-r.x)},rw=(r,e,n,s)=>{if(e.x===0)return i_(n,s,r.x);if(s.x===0)return i_(r,e,n.x);if(e.y===0)return n_(n,s,r.y);if(s.y===0)return n_(r,e,n.y);const a=Cf(e,s);if(a==0)return null;const f={x:n.x-r.x,y:n.y-r.y},m=Cf(f,e)/a,l=Cf(f,s)/a,x=r.x+l*e.x,S=n.x+m*s.x,C=r.y+l*e.y,L=n.y+m*s.y,N=(x+S)/2,B=(C+L)/2;return{x:N,y:B}};class yo{static compare(e,n){const s=yo.comparePoints(e.point,n.point);return s!==0?s:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:bl.compare(e.segment,n.segment))}static comparePoints(e,n){return e.x<n.x?-1:e.x>n.x?1:e.y<n.y?-1:e.y>n.y?1:0}constructor(e,n){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const n=e.point.events;for(let s=0,a=n.length;s<a;s++){const f=n[s];this.point.events.push(f),f.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let n=0;n<e;n++){const s=this.point.events[n];if(s.segment.consumedBy===void 0)for(let a=n+1;a<e;a++){const f=this.point.events[a];f.consumedBy===void 0&&s.otherSE.point.events===f.otherSE.point.events&&s.segment.consume(f.segment)}}}getAvailableLinkedEvents(){const e=[];for(let n=0,s=this.point.events.length;n<s;n++){const a=this.point.events[n];a!==this&&!a.segment.ringOut&&a.segment.isInResult()&&e.push(a)}return e}getLeftmostComparator(e){const n=new Map,s=a=>{const f=a.otherSE;n.set(a,{sine:nw(this.point,e.point,f.point),cosine:iw(this.point,e.point,f.point)})};return(a,f)=>{n.has(a)||s(a),n.has(f)||s(f);const{sine:m,cosine:l}=n.get(a),{sine:x,cosine:S}=n.get(f);return m>=0&&x>=0?l<S?1:l>S?-1:0:m<0&&x<0?l<S?-1:l>S?1:0:x<m?-1:x>m?1:0}}}let sw=0;class bl{static compare(e,n){const s=e.leftSE.point.x,a=n.leftSE.point.x,f=e.rightSE.point.x,m=n.rightSE.point.x;if(m<s)return 1;if(f<a)return-1;const l=e.leftSE.point.y,x=n.leftSE.point.y,S=e.rightSE.point.y,C=n.rightSE.point.y;if(s<a){if(x<l&&x<S)return 1;if(x>l&&x>S)return-1;const L=e.comparePoint(n.leftSE.point);if(L<0)return 1;if(L>0)return-1;const N=n.comparePoint(e.rightSE.point);return N!==0?N:-1}if(s>a){if(l<x&&l<C)return-1;if(l>x&&l>C)return 1;const L=n.comparePoint(e.leftSE.point);if(L!==0)return L;const N=e.comparePoint(n.rightSE.point);return N<0?1:N>0?-1:1}if(l<x)return-1;if(l>x)return 1;if(f<m){const L=n.comparePoint(e.rightSE.point);if(L!==0)return L}if(f>m){const L=e.comparePoint(n.rightSE.point);if(L<0)return 1;if(L>0)return-1}if(f!==m){const L=S-l,N=f-s,B=C-x,U=m-a;if(L>N&&B<U)return 1;if(L<N&&B>U)return-1}return f>m?1:f<m||S<C?-1:S>C?1:e.id<n.id?-1:e.id>n.id?1:0}constructor(e,n,s,a){this.id=++sw,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=s,this.windings=a}static fromRing(e,n,s){let a,f,m;const l=yo.comparePoints(e,n);if(l<0)a=e,f=n,m=1;else if(l>0)a=n,f=e,m=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const x=new yo(a,!0),S=new yo(f,!1);return new bl(x,S,[s],[m])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<n?e:n},ur:{x:this.rightSE.point.x,y:e>n?e:n}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const n=this.leftSE.point,s=this.rightSE.point,a=this.vector();if(n.x===s.x)return e.x===n.x?0:e.x<n.x?1:-1;const f=(e.y-n.y)/a.y,m=n.x+f*a.x;if(e.x===m)return 0;const l=(e.x-n.x)/a.x,x=n.y+l*a.y;return e.y===x?0:e.y<x?-1:1}getIntersection(e){const n=this.bbox(),s=e.bbox(),a=kp(n,s);if(a===null)return null;const f=this.leftSE.point,m=this.rightSE.point,l=e.leftSE.point,x=e.rightSE.point,S=uh(n,l)&&this.comparePoint(l)===0,C=uh(s,f)&&e.comparePoint(f)===0,L=uh(n,x)&&this.comparePoint(x)===0,N=uh(s,m)&&e.comparePoint(m)===0;if(C&&S)return N&&!L?m:!N&&L?x:null;if(C)return L&&f.x===x.x&&f.y===x.y?null:f;if(S)return N&&m.x===l.x&&m.y===l.y?null:l;if(N&&L)return null;if(N)return m;if(L)return x;const B=rw(f,this.vector(),l,e.vector());return B===null||!uh(a,B)?null:Mh.round(B.x,B.y)}split(e){const n=[],s=e.events!==void 0,a=new yo(e,!0),f=new yo(e,!1),m=this.rightSE;this.replaceRightSE(f),n.push(f),n.push(a);const l=new bl(a,m,this.rings.slice(),this.windings.slice());return yo.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),yo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),s&&(a.checkForConsuming(),f.checkForConsuming()),n}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let n=0,s=this.windings.length;n<s;n++)this.windings[n]*=-1}consume(e){let n=this,s=e;for(;n.consumedBy;)n=n.consumedBy;for(;s.consumedBy;)s=s.consumedBy;const a=bl.compare(n,s);if(a!==0){if(a>0){const f=n;n=s,s=f}if(n.prev===s){const f=n;n=s,s=f}for(let f=0,m=s.rings.length;f<m;f++){const l=s.rings[f],x=s.windings[f],S=n.rings.indexOf(l);S===-1?(n.rings.push(l),n.windings.push(x)):n.windings[S]+=x}s.rings=null,s.windings=null,s.consumedBy=n,s.leftSE.consumedBy=n.leftSE,s.rightSE.consumedBy=n.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const n=this._afterState.rings,s=this._afterState.windings,a=this._afterState.multiPolys;for(let l=0,x=this.rings.length;l<x;l++){const S=this.rings[l],C=this.windings[l],L=n.indexOf(S);L===-1?(n.push(S),s.push(C)):s[L]+=C}const f=[],m=[];for(let l=0,x=n.length;l<x;l++){if(s[l]===0)continue;const S=n[l],C=S.poly;if(m.indexOf(C)===-1)if(S.isExterior)f.push(C);else{m.indexOf(C)===-1&&m.push(C);const L=f.indexOf(S.poly);L!==-1&&f.splice(L,1)}}for(let l=0,x=f.length;l<x;l++){const S=f[l].multiPoly;a.indexOf(S)===-1&&a.push(S)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Ro.type){case"union":{const s=e.length===0,a=n.length===0;this._isInResult=s!==a;break}case"intersection":{let s,a;e.length<n.length?(s=e.length,a=n.length):(s=n.length,a=e.length),this._isInResult=a===Ro.numMultiPolys&&s<a;break}case"xor":{const s=Math.abs(e.length-n.length);this._isInResult=s%2===1;break}case"difference":{const s=a=>a.length===1&&a[0].isSubject;this._isInResult=s(e)!==s(n);break}default:throw new Error(`Unrecognized operation type found ${Ro.type}`)}return this._isInResult}}class r_{constructor(e,n,s){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=s,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const a=Mh.round(e[0][0],e[0][1]);this.bbox={ll:{x:a.x,y:a.y},ur:{x:a.x,y:a.y}};let f=a;for(let m=1,l=e.length;m<l;m++){if(typeof e[m][0]!="number"||typeof e[m][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let x=Mh.round(e[m][0],e[m][1]);x.x===f.x&&x.y===f.y||(this.segments.push(bl.fromRing(f,x,this)),x.x<this.bbox.ll.x&&(this.bbox.ll.x=x.x),x.y<this.bbox.ll.y&&(this.bbox.ll.y=x.y),x.x>this.bbox.ur.x&&(this.bbox.ur.x=x.x),x.y>this.bbox.ur.y&&(this.bbox.ur.y=x.y),f=x)}(a.x!==f.x||a.y!==f.y)&&this.segments.push(bl.fromRing(f,a,this))}getSweepEvents(){const e=[];for(let n=0,s=this.segments.length;n<s;n++){const a=this.segments[n];e.push(a.leftSE),e.push(a.rightSE)}return e}}class ow{constructor(e,n){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new r_(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let s=1,a=e.length;s<a;s++){const f=new r_(e[s],this,!1);f.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=f.bbox.ll.x),f.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=f.bbox.ll.y),f.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=f.bbox.ur.x),f.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=f.bbox.ur.y),this.interiorRings.push(f)}this.multiPoly=n}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let n=0,s=this.interiorRings.length;n<s;n++){const a=this.interiorRings[n].getSweepEvents();for(let f=0,m=a.length;f<m;f++)e.push(a[f])}return e}}class s_{constructor(e,n){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let s=0,a=e.length;s<a;s++){const f=new ow(e[s],this);f.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=f.bbox.ll.x),f.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=f.bbox.ll.y),f.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=f.bbox.ur.x),f.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=f.bbox.ur.y),this.polys.push(f)}this.isSubject=n}getSweepEvents(){const e=[];for(let n=0,s=this.polys.length;n<s;n++){const a=this.polys[n].getSweepEvents();for(let f=0,m=a.length;f<m;f++)e.push(a[f])}return e}}class Of{static factory(e){const n=[];for(let s=0,a=e.length;s<a;s++){const f=e[s];if(!f.isInResult()||f.ringOut)continue;let m=null,l=f.leftSE,x=f.rightSE;const S=[l],C=l.point,L=[];for(;m=l,l=x,S.push(l),l.point!==C;)for(;;){const N=l.getAvailableLinkedEvents();if(N.length===0){const ee=S[0].point,ie=S[S.length-1].point;throw new Error(`Unable to complete output ring starting at [${ee.x}, ${ee.y}]. Last matching segment found ends at [${ie.x}, ${ie.y}].`)}if(N.length===1){x=N[0].otherSE;break}let B=null;for(let ee=0,ie=L.length;ee<ie;ee++)if(L[ee].point===l.point){B=ee;break}if(B!==null){const ee=L.splice(B)[0],ie=S.splice(ee.index);ie.unshift(ie[0].otherSE),n.push(new Of(ie.reverse()));continue}L.push({index:S.length,point:l.point});const U=l.getLeftmostComparator(m);x=N.sort(U)[0].otherSE;break}n.push(new Of(S))}return n}constructor(e){this.events=e;for(let n=0,s=e.length;n<s;n++)e[n].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const n=[e];for(let S=1,C=this.events.length-1;S<C;S++){const L=this.events[S].point,N=this.events[S+1].point;t_(L,e,N)!==0&&(n.push(L),e=L)}if(n.length===1)return null;const s=n[0],a=n[1];t_(s,e,a)===0&&n.shift(),n.push(n[0]);const f=this.isExteriorRing()?1:-1,m=this.isExteriorRing()?0:n.length-1,l=this.isExteriorRing()?n.length:-1,x=[];for(let S=m;S!=l;S+=f)x.push([n[S].x,n[S].y]);return x}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let a=1,f=this.events.length;a<f;a++){const m=this.events[a];yo.compare(e,m)>0&&(e=m)}let n=e.segment.prevInResult(),s=n?n.prevInResult():null;for(;;){if(!n)return null;if(!s)return n.ringOut;if(s.ringOut!==n.ringOut)return s.ringOut.enclosingRing()!==n.ringOut?n.ringOut:n.ringOut.enclosingRing();n=s.prevInResult(),s=n?n.prevInResult():null}}}class o_{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let n=0,s=this.interiorRings.length;n<s;n++){const a=this.interiorRings[n].getGeom();a!==null&&e.push(a)}return e}}let aw=class{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let n=0,s=this.polys.length;n<s;n++){const a=this.polys[n].getGeom();a!==null&&e.push(a)}return e}_composePolys(e){const n=[];for(let s=0,a=e.length;s<a;s++){const f=e[s];if(!f.poly)if(f.isExteriorRing())n.push(new o_(f));else{const m=f.enclosingRing();m.poly||n.push(new o_(m)),m.poly.addInterior(f)}}return n}};class lw{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:bl.compare;this.queue=e,this.tree=new Gp(n),this.segments=[]}process(e){const n=e.segment,s=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(n),s;const a=e.isLeft?this.tree.add(n):this.tree.find(n);if(!a)throw new Error(`Unable to find segment #${n.id} [${n.leftSE.point.x}, ${n.leftSE.point.y}] -> [${n.rightSE.point.x}, ${n.rightSE.point.y}] in SweepLine tree.`);let f=a,m=a,l,x;for(;l===void 0;)f=this.tree.prev(f),f===null?l=null:f.key.consumedBy===void 0&&(l=f.key);for(;x===void 0;)m=this.tree.next(m),m===null?x=null:m.key.consumedBy===void 0&&(x=m.key);if(e.isLeft){let S=null;if(l){const L=l.getIntersection(n);if(L!==null&&(n.isAnEndpoint(L)||(S=L),!l.isAnEndpoint(L))){const N=this._splitSafely(l,L);for(let B=0,U=N.length;B<U;B++)s.push(N[B])}}let C=null;if(x){const L=x.getIntersection(n);if(L!==null&&(n.isAnEndpoint(L)||(C=L),!x.isAnEndpoint(L))){const N=this._splitSafely(x,L);for(let B=0,U=N.length;B<U;B++)s.push(N[B])}}if(S!==null||C!==null){let L=null;S===null?L=C:C===null?L=S:L=yo.comparePoints(S,C)<=0?S:C,this.queue.remove(n.rightSE),s.push(n.rightSE);const N=n.split(L);for(let B=0,U=N.length;B<U;B++)s.push(N[B])}s.length>0?(this.tree.remove(n),s.push(e)):(this.segments.push(n),n.prev=l)}else{if(l&&x){const S=l.getIntersection(x);if(S!==null){if(!l.isAnEndpoint(S)){const C=this._splitSafely(l,S);for(let L=0,N=C.length;L<N;L++)s.push(C[L])}if(!x.isAnEndpoint(S)){const C=this._splitSafely(x,S);for(let L=0,N=C.length;L<N;L++)s.push(C[L])}}}this.tree.remove(n)}return s}_splitSafely(e,n){this.tree.remove(e);const s=e.rightSE;this.queue.remove(s);const a=e.split(n);return a.push(s),e.consumedBy===void 0&&this.tree.add(e),a}}const a_=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,uw=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class cw{run(e,n,s){Ro.type=e,Mh.reset();const a=[new s_(n,!0)];for(let C=0,L=s.length;C<L;C++)a.push(new s_(s[C],!1));if(Ro.numMultiPolys=a.length,Ro.type==="difference"){const C=a[0];let L=1;for(;L<a.length;)kp(a[L].bbox,C.bbox)!==null?L++:a.splice(L,1)}if(Ro.type==="intersection")for(let C=0,L=a.length;C<L;C++){const N=a[C];for(let B=C+1,U=a.length;B<U;B++)if(kp(N.bbox,a[B].bbox)===null)return[]}const f=new Gp(yo.compare);for(let C=0,L=a.length;C<L;C++){const N=a[C].getSweepEvents();for(let B=0,U=N.length;B<U;B++)if(f.insert(N[B]),f.size>a_)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const m=new lw(f);let l=f.size,x=f.pop();for(;x;){const C=x.key;if(f.size===l){const N=C.segment;throw new Error(`Unable to pop() ${C.isLeft?"left":"right"} SweepEvent [${C.point.x}, ${C.point.y}] from segment #${N.id} [${N.leftSE.point.x}, ${N.leftSE.point.y}] -> [${N.rightSE.point.x}, ${N.rightSE.point.y}] from queue.`)}if(f.size>a_)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(m.segments.length>uw)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const L=m.process(C);for(let N=0,B=L.length;N<B;N++){const U=L[N];U.consumedBy===void 0&&f.insert(U)}l=f.size,x=f.pop()}Mh.reset();const S=Of.factory(m.segments);return new aw(S).getGeom()}}const Ro=new cw,hw=function(r){for(var e=arguments.length,n=new Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];return Ro.run("union",r,n)},fw=function(r){for(var e=arguments.length,n=new Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];return Ro.run("intersection",r,n)},dw=function(r){for(var e=arguments.length,n=new Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];return Ro.run("xor",r,n)},pw=function(r){for(var e=arguments.length,n=new Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];return Ro.run("difference",r,n)};var uv={union:hw,intersection:fw,xor:dw,difference:pw};function cv(r,e,n){if(r!==null)for(var s,a,f,m,l,x,S,C=0,L=0,N,B=r.type,U=B==="FeatureCollection",ee=B==="Feature",ie=U?r.features.length:1,re=0;re<ie;re++){S=U?r.features[re].geometry:ee?r.geometry:r,N=S?S.type==="GeometryCollection":!1,l=N?S.geometries.length:1;for(var Q=0;Q<l;Q++){var $=0,pe=0;if(m=N?S.geometries[Q]:S,m!==null){x=m.coordinates;var ve=m.type;switch(C=0,ve){case null:break;case"Point":if(e(x,L,re,$,pe)===!1)return!1;L++,$++;break;case"LineString":case"MultiPoint":for(s=0;s<x.length;s++){if(e(x[s],L,re,$,pe)===!1)return!1;L++,ve==="MultiPoint"&&$++}ve==="LineString"&&$++;break;case"Polygon":case"MultiLineString":for(s=0;s<x.length;s++){for(a=0;a<x[s].length-C;a++){if(e(x[s][a],L,re,$,pe)===!1)return!1;L++}ve==="MultiLineString"&&$++,ve==="Polygon"&&pe++}ve==="Polygon"&&$++;break;case"MultiPolygon":for(s=0;s<x.length;s++){for(pe=0,a=0;a<x[s].length;a++){for(f=0;f<x[s][a].length-C;f++){if(e(x[s][a][f],L,re,$,pe)===!1)return!1;L++}pe++}$++}break;case"GeometryCollection":for(s=0;s<m.geometries.length;s++)if(cv(m.geometries[s],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function l_(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var n=0;n<r.features.length&&e(r.features[n],n)!==!1;n++);}function id(r,e){var n,s,a,f,m,l,x,S,C,L,N=0,B=r.type==="FeatureCollection",U=r.type==="Feature",ee=B?r.features.length:1;for(n=0;n<ee;n++){for(l=B?r.features[n].geometry:U?r.geometry:r,S=B?r.features[n].properties:U?r.properties:{},C=B?r.features[n].bbox:U?r.bbox:void 0,L=B?r.features[n].id:U?r.id:void 0,x=l?l.type==="GeometryCollection":!1,m=x?l.geometries.length:1,a=0;a<m;a++){if(f=x?l.geometries[a]:l,f===null){if(e(null,N,S,C,L)===!1)return!1;continue}switch(f.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(f,N,S,C,L)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<f.geometries.length;s++)if(e(f.geometries[s],N,S,C,L)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}N++}}function mw(r,e={}){const n=[];if(id(r,a=>{n.push(a.coordinates)}),n.length<2)throw new Error("Must have at least 2 geometries");const s=uv.union(n[0],...n.slice(1));return s.length===0?null:s.length===1?qp(s[0],e.properties):av(s,e.properties)}var gw=mw;function _w(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const n=[1/0,1/0,-1/0,-1/0];return cv(r,s=>{n[0]>s[0]&&(n[0]=s[0]),n[1]>s[1]&&(n[1]=s[1]),n[2]<s[0]&&(n[2]=s[0]),n[3]<s[1]&&(n[3]=s[1])}),n}function yw(r,e={}){const n=_w(r),s=(n[0]+n[2])/2,a=(n[1]+n[3])/2;return Fx([s,a],e.properties,e)}var vw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bw(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var hv={exports:{}};(function(r,e){(function(n,s){r.exports=s()})(vw,function(){function n(I,c){if(!(I instanceof c))throw new TypeError("Cannot call a class as a function")}function s(I,c){for(var d=0;d<c.length;d++){var p=c[d];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(I,p.key,p)}}function a(I,c,d){return c&&s(I.prototype,c),d&&s(I,d),I}function f(I,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");I.prototype=Object.create(c&&c.prototype,{constructor:{value:I,writable:!0,configurable:!0}}),c&&l(I,c)}function m(I){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(c){return c.__proto__||Object.getPrototypeOf(c)},m(I)}function l(I,c){return l=Object.setPrototypeOf||function(d,p){return d.__proto__=p,d},l(I,c)}function x(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function S(I,c,d){return S=x()?Reflect.construct:function(p,b,M){var F=[null];F.push.apply(F,b);var q=new(Function.bind.apply(p,F));return M&&l(q,M.prototype),q},S.apply(null,arguments)}function C(I){var c=typeof Map=="function"?new Map:void 0;return C=function(d){if(d===null||(p=d,Function.toString.call(p).indexOf("[native code]")===-1))return d;var p;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(c!==void 0){if(c.has(d))return c.get(d);c.set(d,b)}function b(){return S(d,arguments,m(this).constructor)}return b.prototype=Object.create(d.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),l(b,d)},C(I)}function L(I){if(I===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return I}function N(I,c){if(c&&(typeof c=="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return L(I)}function B(I){var c=x();return function(){var d,p=m(I);if(c){var b=m(this).constructor;d=Reflect.construct(p,arguments,b)}else d=p.apply(this,arguments);return N(this,d)}}function U(I,c,d){return U=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(p,b,M){var F=function(Y,me){for(;!Object.prototype.hasOwnProperty.call(Y,me)&&(Y=m(Y))!==null;);return Y}(p,b);if(F){var q=Object.getOwnPropertyDescriptor(F,b);return q.get?q.get.call(M):q.value}},U(I,c,d||I)}function ee(I){return function(c){if(Array.isArray(c))return re(c)}(I)||function(c){if(typeof Symbol<"u"&&c[Symbol.iterator]!=null||c["@@iterator"]!=null)return Array.from(c)}(I)||ie(I)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function ie(I,c){if(I){if(typeof I=="string")return re(I,c);var d=Object.prototype.toString.call(I).slice(8,-1);return d==="Object"&&I.constructor&&(d=I.constructor.name),d==="Map"||d==="Set"?Array.from(I):d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d)?re(I,c):void 0}}function re(I,c){(c==null||c>I.length)&&(c=I.length);for(var d=0,p=new Array(c);d<c;d++)p[d]=I[d];return p}function Q(I,c){var d=typeof Symbol<"u"&&I[Symbol.iterator]||I["@@iterator"];if(!d){if(Array.isArray(I)||(d=ie(I))||c){d&&(I=d);var p=0,b=function(){};return{s:b,n:function(){return p>=I.length?{done:!0}:{done:!1,value:I[p++]}},e:function(Y){throw Y},f:b}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var M,F=!0,q=!1;return{s:function(){d=d.call(I)},n:function(){var Y=d.next();return F=Y.done,Y},e:function(Y){q=!0,M=Y},f:function(){try{F||d.return==null||d.return()}finally{if(q)throw M}}}}var $=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(c){this._quadrantSegments=c,this._quadrantSegments===0&&(this._joinStyle=I.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=I.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),c<=0&&(this._quadrantSegments=1),this._joinStyle!==I.JOIN_ROUND&&(this._quadrantSegments=I.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(c){this._joinStyle=c}},{key:"setSimplifyFactor",value:function(c){this._simplifyFactor=c<0?0:c}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(c){this._endCapStyle=c}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(c){this._mitreLimit=c}},{key:"setSingleSided",value:function(c){this._isSingleSided=c}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=I.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=I.CAP_ROUND,this._joinStyle=I.JOIN_ROUND,this._mitreLimit=I.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=I.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var c=arguments[0];this.setQuadrantSegments(c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.setQuadrantSegments(d),this.setEndCapStyle(p)}else if(arguments.length===4){var b=arguments[0],M=arguments[1],F=arguments[2],q=arguments[3];this.setQuadrantSegments(b),this.setEndCapStyle(M),this.setJoinStyle(F),this.setMitreLimit(q)}}}},{key:"bufferDistanceError",value:function(c){var d=Math.PI/2/c;return 1-Math.cos(d/2)}}]),I}();$.CAP_ROUND=1,$.CAP_FLAT=2,$.CAP_SQUARE=3,$.JOIN_ROUND=1,$.JOIN_MITRE=2,$.JOIN_BEVEL=3,$.DEFAULT_QUADRANT_SEGMENTS=8,$.DEFAULT_MITRE_LIMIT=5,$.DEFAULT_SIMPLIFY_FACTOR=.01;var pe=function(I){f(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({Exception:d})[0],b}return a(d,[{key:"toString",value:function(){return this.message}}]),d}(C(Error)),ve=function(I){f(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({IllegalArgumentException:d})[0],b}return d}(pe),De=function(){function I(){n(this,I)}return a(I,[{key:"filter",value:function(c){}}]),I}();function he(){}function xe(){}function be(){}var Le,we,ye,Ue,Ve,pt,St,dt,ut=function(){function I(){n(this,I)}return a(I,null,[{key:"equalsWithTolerance",value:function(c,d,p){return Math.abs(c-d)<=p}}]),I}(),Bt=function(){function I(c,d){n(this,I),this.low=d||0,this.high=c||0}return a(I,null,[{key:"toBinaryString",value:function(c){var d,p="";for(d=2147483648;d>0;d>>>=1)p+=(c.high&d)===d?"1":"0";for(d=2147483648;d>0;d>>>=1)p+=(c.low&d)===d?"1":"0";return p}}]),I}();function vt(){}function wt(){}vt.NaN=NaN,vt.isNaN=function(I){return Number.isNaN(I)},vt.isInfinite=function(I){return!Number.isFinite(I)},vt.MAX_VALUE=Number.MAX_VALUE,vt.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,vt.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(pt=2146435072,St=new Float64Array(1),dt=new Int32Array(St.buffer),vt.doubleToLongBits=function(I){St[0]=I;var c=0|dt[0],d=0|dt[1];return(d&pt)===pt&&1048575&d&&c!==0&&(c=0,d=2146959360),new Bt(d,c)},vt.longBitsToDouble=function(I){return dt[0]=I.low,dt[1]=I.high,St[0]}):(Le=1023,we=Math.log2,ye=Math.floor,Ue=Math.pow,Ve=function(){for(var I=53;I>0;I--){var c=Ue(2,I)-1;if(ye(we(c))+1===I)return c}return 0}(),vt.doubleToLongBits=function(I){var c,d,p,b,M,F,q,Y,me;if(I<0||1/I===Number.NEGATIVE_INFINITY?(F=1<<31,I=-I):F=0,I===0)return new Bt(Y=F,me=0);if(I===1/0)return new Bt(Y=2146435072|F,me=0);if(I!=I)return new Bt(Y=2146959360,me=0);if(b=0,me=0,(c=ye(I))>1)if(c<=Ve)(b=ye(we(c)))<=20?(me=0,Y=c<<20-b&1048575):(me=c%(d=Ue(2,p=b-20))<<32-p,Y=c/d&1048575);else for(p=c,me=0;(p=ye(d=p/2))!==0;)b++,me>>>=1,me|=(1&Y)<<31,Y>>>=1,d!==p&&(Y|=524288);if(q=b+Le,M=c===0,c=I-c,b<52&&c!==0)for(p=0;;){if((d=2*c)>=1?(c=d-1,M?(q--,M=!1):(p<<=1,p|=1,b++)):(c=d,M?--q==0&&(b++,M=!1):(p<<=1,b++)),b===20)Y|=p,p=0;else if(b===52){me|=p;break}if(d===1){b<20?Y|=p<<20-b:b<52&&(me|=p<<52-b);break}}return Y|=q<<20,new Bt(Y|=F,me)},vt.longBitsToDouble=function(I){var c,d,p,b,M=I.high,F=I.low,q=M&1<<31?-1:1;for(p=((2146435072&M)>>20)-Le,b=0,d=1<<19,c=1;c<=20;c++)M&d&&(b+=Ue(2,-c)),d>>>=1;for(d=1<<31,c=21;c<=52;c++)F&d&&(b+=Ue(2,-c)),d>>>=1;if(p===-1023){if(b===0)return 0*q;p=-1022}else{if(p===1024)return b===0?q/0:NaN;b+=1}return q*b*Ue(2,p)});var ft=function(I){f(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({RuntimeException:d})[0],b}return d}(pe),xt=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,null,[{key:"constructor_",value:function(){if(arguments.length===0)ft.constructor_.call(this);else if(arguments.length===1){var p=arguments[0];ft.constructor_.call(this,p)}}}]),d}(ft),It=function(){function I(){n(this,I)}return a(I,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)I.shouldNeverReachHere(null);else if(arguments.length===1){var c=arguments[0];throw new xt("Should never reach here"+(c!==null?": "+c:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var c=arguments[0];I.isTrue(c,null)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];if(!d)throw p===null?new xt:new xt(p)}}},{key:"equals",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];I.equals(c,d,null)}else if(arguments.length===3){var p=arguments[0],b=arguments[1],M=arguments[2];if(!b.equals(p))throw new xt("Expected "+p+" but encountered "+b+(M!==null?": "+M:""))}}}]),I}(),Jt=new ArrayBuffer(8),pn=new Float64Array(Jt),Rn=new Int32Array(Jt),Xe=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getM",value:function(){return vt.NaN}},{key:"setOrdinate",value:function(c,d){switch(c){case I.X:this.x=d;break;case I.Y:this.y=d;break;case I.Z:this.setZ(d);break;default:throw new ve("Invalid ordinate index: "+c)}}},{key:"equals2D",value:function(){if(arguments.length===1){var c=arguments[0];return this.x===c.x&&this.y===c.y}if(arguments.length===2){var d=arguments[0],p=arguments[1];return!!ut.equalsWithTolerance(this.x,d.x,p)&&!!ut.equalsWithTolerance(this.y,d.y,p)}}},{key:"setM",value:function(c){throw new ve("Invalid ordinate index: "+I.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(c){switch(c){case I.X:return this.x;case I.Y:return this.y;case I.Z:return this.getZ()}throw new ve("Invalid ordinate index: "+c)}},{key:"equals3D",value:function(c){return this.x===c.x&&this.y===c.y&&(this.getZ()===c.getZ()||vt.isNaN(this.getZ())&&vt.isNaN(c.getZ()))}},{key:"equals",value:function(c){return c instanceof I&&this.equals2D(c)}},{key:"equalInZ",value:function(c,d){return ut.equalsWithTolerance(this.getZ(),c.getZ(),d)}},{key:"setX",value:function(c){this.x=c}},{key:"compareTo",value:function(c){var d=c;return this.x<d.x?-1:this.x>d.x?1:this.y<d.y?-1:this.y>d.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(c){this.z=c}},{key:"clone",value:function(){try{return null}catch(c){if(c instanceof CloneNotSupportedException)return It.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw c}}},{key:"copy",value:function(){return new I(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(c){var d=this.x-c.x,p=this.y-c.y,b=this.getZ()-c.getZ();return Math.sqrt(d*d+p*p+b*b)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(c){this.y=c}},{key:"distance",value:function(c){var d=this.x-c.x,p=this.y-c.y;return Math.sqrt(d*d+p*p)}},{key:"hashCode",value:function(){var c=17;return c=37*(c=37*c+I.hashCode(this.x))+I.hashCode(this.y)}},{key:"setCoordinate",value:function(c){this.x=c.x,this.y=c.y,this.z=c.getZ()}},{key:"interfaces_",get:function(){return[he,xe,be]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)I.constructor_.call(this,0,0);else if(arguments.length===1){var c=arguments[0];I.constructor_.call(this,c.x,c.y,c.getZ())}else if(arguments.length===2){var d=arguments[0],p=arguments[1];I.constructor_.call(this,d,p,I.NULL_ORDINATE)}else if(arguments.length===3){var b=arguments[0],M=arguments[1],F=arguments[2];this.x=b,this.y=M,this.z=F}}},{key:"hashCode",value:function(c){return pn[0]=c,Rn[0]^Rn[1]}}]),I}(),Wn=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compare",value:function(c,d){var p=I.compare(c.x,d.x);if(p!==0)return p;var b=I.compare(c.y,d.y);return b!==0?b:this._dimensionsToTest<=2?0:I.compare(c.getZ(),d.getZ())}},{key:"interfaces_",get:function(){return[wt]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)I.constructor_.call(this,2);else if(arguments.length===1){var c=arguments[0];if(c!==2&&c!==3)throw new ve("only 2 or 3 dimensions may be specified");this._dimensionsToTest=c}}},{key:"compare",value:function(c,d){return c<d?-1:c>d?1:vt.isNaN(c)?vt.isNaN(d)?0:-1:vt.isNaN(d)?1:0}}]),I}();Xe.DimensionalComparator=Wn,Xe.NULL_ORDINATE=vt.NaN,Xe.X=0,Xe.Y=1,Xe.Z=2,Xe.M=3;var dn=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(c){if(!(c instanceof I))return!1;var d=c;return this.isNull()?d.isNull():this._maxx===d.getMaxX()&&this._maxy===d.getMaxY()&&this._minx===d.getMinX()&&this._miny===d.getMinY()}},{key:"intersection",value:function(c){if(this.isNull()||c.isNull()||!this.intersects(c))return new I;var d=this._minx>c._minx?this._minx:c._minx,p=this._miny>c._miny?this._miny:c._miny;return new I(d,this._maxx<c._maxx?this._maxx:c._maxx,p,this._maxy<c._maxy?this._maxy:c._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof Xe){var c=arguments[0];return this.covers(c.x,c.y)}if(arguments[0]instanceof I){var d=arguments[0];return!this.isNull()&&!d.isNull()&&d.getMinX()>=this._minx&&d.getMaxX()<=this._maxx&&d.getMinY()>=this._miny&&d.getMaxY()<=this._maxy}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];return!this.isNull()&&p>=this._minx&&p<=this._maxx&&b>=this._miny&&b<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return!this.isNull()&&!c.isNull()&&!(c._minx>this._maxx||c._maxx<this._minx||c._miny>this._maxy||c._maxy<this._miny)}if(arguments[0]instanceof Xe){var d=arguments[0];return this.intersects(d.x,d.y)}}else if(arguments.length===2){if(arguments[0]instanceof Xe&&arguments[1]instanceof Xe){var p=arguments[0],b=arguments[1];if(this.isNull())return!1;var M=p.x<b.x?p.x:b.x;if(M>this._maxx)return!1;var F=p.x>b.x?p.x:b.x;if(F<this._minx)return!1;var q=p.y<b.y?p.y:b.y;if(q>this._maxy)return!1;var Y=p.y>b.y?p.y:b.y;return!(Y<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var me=arguments[0],Fe=arguments[1];return!this.isNull()&&!(me>this._maxx||me<this._minx||Fe>this._maxy||Fe<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var c=this.getWidth(),d=this.getHeight();return Math.sqrt(c*c+d*d)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof Xe){var c=arguments[0];this.expandToInclude(c.x,c.y)}else if(arguments[0]instanceof I){var d=arguments[0];if(d.isNull())return null;this.isNull()?(this._minx=d.getMinX(),this._maxx=d.getMaxX(),this._miny=d.getMinY(),this._maxy=d.getMaxY()):(d._minx<this._minx&&(this._minx=d._minx),d._maxx>this._maxx&&(this._maxx=d._maxx),d._miny<this._miny&&(this._miny=d._miny),d._maxy>this._maxy&&(this._maxy=d._maxy))}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.isNull()?(this._minx=p,this._maxx=p,this._miny=b,this._maxy=b):(p<this._minx&&(this._minx=p),p>this._maxx&&(this._maxx=p),b<this._miny&&(this._miny=b),b>this._maxy&&(this._maxy=b))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var c=this.getWidth(),d=this.getHeight();return c<d?c:d}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(c){var d=c;return this.isNull()?d.isNull()?0:-1:d.isNull()?1:this._minx<d._minx?-1:this._minx>d._minx?1:this._miny<d._miny?-1:this._miny>d._miny?1:this._maxx<d._maxx?-1:this._maxx>d._maxx?1:this._maxy<d._maxy?-1:this._maxy>d._maxy?1:0}},{key:"translate",value:function(c,d){if(this.isNull())return null;this.init(this.getMinX()+c,this.getMaxX()+c,this.getMinY()+d,this.getMaxY()+d)}},{key:"copy",value:function(){return new I(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(c){return!(!this.isNull()&&!c.isNull())||c._minx>this._maxx||c._maxx<this._minx||c._miny>this._maxy||c._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var c=this.getWidth(),d=this.getHeight();return c>d?c:d}},{key:"expandBy",value:function(){if(arguments.length===1){var c=arguments[0];this.expandBy(c,c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];if(this.isNull())return null;this._minx-=d,this._maxx+=d,this._miny-=p,this._maxy+=p,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.covers(c)}if(arguments[0]instanceof Xe){var d=arguments[0];return this.covers(d)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];return this.covers(p,b)}}},{key:"centre",value:function(){return this.isNull()?null:new Xe((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Xe){var c=arguments[0];this.init(c.x,c.x,c.y,c.y)}else if(arguments[0]instanceof I){var d=arguments[0];this._minx=d._minx,this._maxx=d._maxx,this._miny=d._miny,this._maxy=d._maxy}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.init(p.x,b.x,p.y,b.y)}else if(arguments.length===4){var M=arguments[0],F=arguments[1],q=arguments[2],Y=arguments[3];M<F?(this._minx=M,this._maxx=F):(this._minx=F,this._maxx=M),q<Y?(this._miny=q,this._maxy=Y):(this._miny=Y,this._maxy=q)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(c){if(this.intersects(c))return 0;var d=0;this._maxx<c._minx?d=c._minx-this._maxx:this._minx>c._maxx&&(d=this._minx-c._maxx);var p=0;return this._maxy<c._miny?p=c._miny-this._maxy:this._miny>c._maxy&&(p=this._miny-c._maxy),d===0?p:p===0?d:Math.sqrt(d*d+p*p)}},{key:"hashCode",value:function(){var c=17;return c=37*(c=37*(c=37*(c=37*c+Xe.hashCode(this._minx))+Xe.hashCode(this._maxx))+Xe.hashCode(this._miny))+Xe.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[he,be]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Xe){var c=arguments[0];this.init(c.x,c.x,c.y,c.y)}else if(arguments[0]instanceof I){var d=arguments[0];this.init(d)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.init(p.x,b.x,p.y,b.y)}else if(arguments.length===4){var M=arguments[0],F=arguments[1],q=arguments[2],Y=arguments[3];this.init(M,F,q,Y)}}},{key:"intersects",value:function(){if(arguments.length===3){var c=arguments[0],d=arguments[1],p=arguments[2];return p.x>=(c.x<d.x?c.x:d.x)&&p.x<=(c.x>d.x?c.x:d.x)&&p.y>=(c.y<d.y?c.y:d.y)&&p.y<=(c.y>d.y?c.y:d.y)}if(arguments.length===4){var b=arguments[0],M=arguments[1],F=arguments[2],q=arguments[3],Y=Math.min(F.x,q.x),me=Math.max(F.x,q.x),Fe=Math.min(b.x,M.x),$e=Math.max(b.x,M.x);return!(Fe>me)&&!($e<Y)&&(Y=Math.min(F.y,q.y),me=Math.max(F.y,q.y),Fe=Math.min(b.y,M.y),$e=Math.max(b.y,M.y),!(Fe>me)&&!($e<Y))}}}]),I}(),Ft=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===I.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(c){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(c){return this===c||this.equalsExact(c,0)}},{key:"geometryChanged",value:function(){this.apply(I.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(c){return c!==null&&this.norm().equalsExact(c.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var c;if(arguments.length===1){var d=arguments[0];return c=d,this.getTypeCode()!==c.getTypeCode()?this.getTypeCode()-c.getTypeCode():this.isEmpty()&&c.isEmpty()?0:this.isEmpty()?-1:c.isEmpty()?1:this.compareToSameClass(d)}if(arguments.length===2){var p=arguments[0],b=arguments[1];return c=p,this.getTypeCode()!==c.getTypeCode()?this.getTypeCode()-c.getTypeCode():this.isEmpty()&&c.isEmpty()?0:this.isEmpty()?-1:c.isEmpty()?1:this.compareToSameClass(p,b)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(c){if(c.getTypeCode()===I.TYPECODE_GEOMETRYCOLLECTION)throw new ve("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(c,d,p){return p===0?c.equals(d):c.distance(d)<=p}},{key:"norm",value:function(){var c=this.copy();return c.normalize(),c}},{key:"reverse",value:function(){var c=this.reverseInternal();return this.envelope!=null&&(c.envelope=this.envelope.copy()),c.setSRID(this.getSRID()),c}},{key:"copy",value:function(){var c=this.copyInternal();return c.envelope=this._envelope==null?null:this._envelope.copy(),c._SRID=this._SRID,c._userData=this._userData,c}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new dn(this._envelope)}},{key:"setSRID",value:function(c){this._SRID=c}},{key:"setUserData",value:function(c){this._userData=c}},{key:"compare",value:function(c,d){for(var p=c.iterator(),b=d.iterator();p.hasNext()&&b.hasNext();){var M=p.next(),F=b.next(),q=M.compareTo(F);if(q!==0)return q}return p.hasNext()?1:b.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(c){return this.getClass()===c.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===I.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===I.TYPECODE_MULTIPOINT||this.getTypeCode()===I.TYPECODE_MULTILINESTRING||this.getTypeCode()===I.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[xe,he,be]}},{key:"getClass",value:function(){return I}}],[{key:"hasNonEmptyElements",value:function(c){for(var d=0;d<c.length;d++)if(!c[d].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(c){for(var d=0;d<c.length;d++)if(c[d]===null)return!0;return!1}}]),I}();Ft.constructor_=function(I){I&&(this._envelope=null,this._userData=null,this._factory=I,this._SRID=I.getSRID())},Ft.TYPECODE_POINT=0,Ft.TYPECODE_MULTIPOINT=1,Ft.TYPECODE_LINESTRING=2,Ft.TYPECODE_LINEARRING=3,Ft.TYPECODE_MULTILINESTRING=4,Ft.TYPECODE_POLYGON=5,Ft.TYPECODE_MULTIPOLYGON=6,Ft.TYPECODE_GEOMETRYCOLLECTION=7,Ft.TYPENAME_POINT="Point",Ft.TYPENAME_MULTIPOINT="MultiPoint",Ft.TYPENAME_LINESTRING="LineString",Ft.TYPENAME_LINEARRING="LinearRing",Ft.TYPENAME_MULTILINESTRING="MultiLineString",Ft.TYPENAME_POLYGON="Polygon",Ft.TYPENAME_MULTIPOLYGON="MultiPolygon",Ft.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",Ft.geometryChangedFilter={get interfaces_(){return[De]},filter:function(I){I.geometryChangedAction()}};var Se=function(){function I(){n(this,I)}return a(I,null,[{key:"toLocationSymbol",value:function(c){switch(c){case I.EXTERIOR:return"e";case I.BOUNDARY:return"b";case I.INTERIOR:return"i";case I.NONE:return"-"}throw new ve("Unknown location value: "+c)}}]),I}();Se.INTERIOR=0,Se.BOUNDARY=1,Se.EXTERIOR=2,Se.NONE=-1;var lt=function(){function I(){n(this,I)}return a(I,[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}]),I}(),Je=function(I){f(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({NoSuchElementException:d})[0],b}return d}(pe),Lt=function(I){f(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({UnsupportedOperationException:d})[0],b}return d}(pe),Ye=function(I){f(d,I);var c=B(d);function d(){return n(this,d),c.apply(this,arguments)}return a(d,[{key:"contains",value:function(){}}]),d}(lt),kt=function(I,c){f(p,I);var d=B(p);function p(b){var M;return n(this,p),(M=d.call(this)).map=new Map,b instanceof lt&&M.addAll(b),M}return a(p,[{key:"contains",value:function(b){var M=b.hashCode?b.hashCode():b;return!!this.map.has(M)}},{key:"add",value:function(b){var M=b.hashCode?b.hashCode():b;return!this.map.has(M)&&!!this.map.set(M,b)}},{key:"addAll",value:function(b){var M,F=Q(b);try{for(F.s();!(M=F.n()).done;){var q=M.value;this.add(q)}}catch(Y){F.e(Y)}finally{F.f()}return!0}},{key:"remove",value:function(){throw new Lt}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new Vt(this.map)}},{key:c,value:function(){return this.map}}]),p}(Ye,Symbol.iterator),Vt=function(){function I(c){n(this,I),this.iterator=c.values();var d=this.iterator.next(),p=d.done,b=d.value;this.done=p,this.value=b}return a(I,[{key:"next",value:function(){if(this.done)throw new Je;var c=this.value,d=this.iterator.next(),p=d.done,b=d.value;return this.done=p,this.value=b,c}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new Lt}}]),I}(),Ee=function(){function I(){n(this,I)}return a(I,null,[{key:"opposite",value:function(c){return c===I.LEFT?I.RIGHT:c===I.RIGHT?I.LEFT:c}}]),I}();Ee.ON=0,Ee.LEFT=1,Ee.RIGHT=2;var Gt=function(I){f(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({EmptyStackException:d})[0],b}return d}(pe),_n=function(I){f(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this,p)).name=Object.keys({IndexOutOfBoundsException:d})[0],b}return d}(pe),Kn=function(I){f(d,I);var c=B(d);function d(){return n(this,d),c.apply(this,arguments)}return a(d,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}]),d}(lt),Yi=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),(p=c.call(this)).array=[],p}return a(d,[{key:"add",value:function(p){return this.array.push(p),!0}},{key:"get",value:function(p){if(p<0||p>=this.size())throw new _n;return this.array[p]}},{key:"push",value:function(p){return this.array.push(p),p}},{key:"pop",value:function(){if(this.array.length===0)throw new Gt;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new Gt;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(p){return this.array.indexOf(p)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}]),d}(Kn);function xn(I,c){return I.interfaces_&&I.interfaces_.indexOf(c)>-1}var qi=function(){function I(c){n(this,I),this.str=c}return a(I,[{key:"append",value:function(c){this.str+=c}},{key:"setCharAt",value:function(c,d){this.str=this.str.substr(0,c)+d+this.str.substr(c+1)}},{key:"toString",value:function(){return this.str}}]),I}(),Ji=function(){function I(c){n(this,I),this.value=c}return a(I,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(c){return this.value<c?-1:this.value>c?1:0}}],[{key:"compare",value:function(c,d){return c<d?-1:c>d?1:0}},{key:"isNan",value:function(c){return Number.isNaN(c)}},{key:"valueOf",value:function(c){return new I(c)}}]),I}(),Jr=function(){function I(){n(this,I)}return a(I,null,[{key:"isWhitespace",value:function(c){return c<=32&&c>=0||c===127}},{key:"toUpperCase",value:function(c){return c.toUpperCase()}}]),I}(),ct=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"le",value:function(c){return this._hi<c._hi||this._hi===c._hi&&this._lo<=c._lo}},{key:"extractSignificantDigits",value:function(c,d){var p=this.abs(),b=I.magnitude(p._hi),M=I.TEN.pow(b);(p=p.divide(M)).gt(I.TEN)?(p=p.divide(I.TEN),b+=1):p.lt(I.ONE)&&(p=p.multiply(I.TEN),b-=1);for(var F=b+1,q=new qi,Y=I.MAX_PRINT_DIGITS-1,me=0;me<=Y;me++){c&&me===F&&q.append(".");var Fe=Math.trunc(p._hi);if(Fe<0)break;var $e=!1,mt=0;Fe>9?($e=!0,mt="9"):mt="0"+Fe,q.append(mt),p=p.subtract(I.valueOf(Fe)).multiply(I.TEN),$e&&p.selfAdd(I.TEN);var zt=!0,Nt=I.magnitude(p._hi);if(Nt<0&&Math.abs(Nt)>=Y-me&&(zt=!1),!zt)break}return d[0]=b,q.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return this.add(c.negate())}if(typeof arguments[0]=="number"){var d=arguments[0];return this.add(-d)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof I){var c=arguments[0];return this._hi===c._hi&&this._lo===c._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return this.isNaN()?this:this.selfAdd(-c._hi,-c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.isNaN()?this:this.selfAdd(-d,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(c){return this.le(c)?this:c}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.selfDivide(c._hi,c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.selfDivide(d,0)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1],M=null,F=null,q=null,Y=null,me=null,Fe=null,$e=null,mt=null;return me=this._hi/p,mt=(M=(Fe=I.SPLIT*me)-(M=Fe-me))*(q=(mt=I.SPLIT*p)-(q=mt-p))-($e=me*p)+M*(Y=p-q)+(F=me-M)*q+F*Y,mt=me+(Fe=(this._hi-$e-mt+this._lo-me*b)/p),this._hi=mt,this._lo=me-mt+Fe,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof I){var c=arguments[0],d=null,p=null,b=null,M=null,F=null,q=null,Y=null,me=null;p=(F=this._hi/c._hi)-(d=(q=I.SPLIT*F)-(d=q-F)),me=d*(b=(me=I.SPLIT*c._hi)-(b=me-c._hi))-(Y=F*c._hi)+d*(M=c._hi-b)+p*b+p*M;var Fe=me=F+(q=(this._hi-Y-me+this._lo-F*c._lo)/c._hi),$e=F-me+q;return new I(Fe,$e)}if(typeof arguments[0]=="number"){var mt=arguments[0];return vt.isNaN(mt)?I.createNaN():I.copy(this).selfDivide(mt,0)}}},{key:"ge",value:function(c){return this._hi>c._hi||this._hi===c._hi&&this._lo>=c._lo}},{key:"pow",value:function(c){if(c===0)return I.valueOf(1);var d=new I(this),p=I.valueOf(1),b=Math.abs(c);if(b>1)for(;b>0;)b%2==1&&p.selfMultiply(d),(b/=2)>0&&(d=d.sqr());else p=d;return c<0?p.reciprocal():p}},{key:"ceil",value:function(){if(this.isNaN())return I.NaN;var c=Math.ceil(this._hi),d=0;return c===this._hi&&(d=Math.ceil(this._lo)),new I(c,d)}},{key:"compareTo",value:function(c){var d=c;return this._hi<d._hi?-1:this._hi>d._hi?1:this._lo<d._lo?-1:this._lo>d._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return this.init(c),this}if(typeof arguments[0]=="number"){var d=arguments[0];return this.init(d),this}}},{key:"max",value:function(c){return this.ge(c)?this:c}},{key:"sqrt",value:function(){if(this.isZero())return I.valueOf(0);if(this.isNegative())return I.NaN;var c=1/Math.sqrt(this._hi),d=this._hi*c,p=I.valueOf(d),b=this.subtract(p.sqr())._hi*(.5*c);return p.add(b)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.selfAdd(c._hi,c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0],p=null,b=null,M=null,F=null,q=null,Y=null;return F=(M=this._hi+d)-(q=M-this._hi),b=(Y=(F=d-q+(this._hi-F))+this._lo)+(M-(p=M+Y)),this._hi=p+b,this._lo=b+(p-this._hi),this}}else if(arguments.length===2){var me=arguments[0],Fe=arguments[1],$e=null,mt=null,zt=null,Nt=null,gn=null,bn=null,Pn=null;Nt=this._hi+me,mt=this._lo+Fe,gn=Nt-(bn=Nt-this._hi),zt=mt-(Pn=mt-this._lo);var ti=($e=Nt+(bn=(gn=me-bn+(this._hi-gn))+mt))+(bn=(zt=Fe-Pn+(this._lo-zt))+(bn+(Nt-$e))),mi=bn+($e-ti);return this._hi=ti,this._lo=mi,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof I){var c=arguments[0];return this.selfMultiply(c._hi,c._lo)}if(typeof arguments[0]=="number"){var d=arguments[0];return this.selfMultiply(d,0)}}else if(arguments.length===2){var p=arguments[0],b=arguments[1],M=null,F=null,q=null,Y=null,me=null,Fe=null;M=(me=I.SPLIT*this._hi)-this._hi,Fe=I.SPLIT*p,M=me-M,F=this._hi-M,q=Fe-p;var $e=(me=this._hi*p)+(Fe=M*(q=Fe-q)-me+M*(Y=p-q)+F*q+F*Y+(this._hi*b+this._lo*p)),mt=Fe+(M=me-$e);return this._hi=$e,this._lo=mt,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return I.NaN;var c=Math.floor(this._hi),d=0;return c===this._hi&&(d=Math.floor(this._lo)),new I(c,d)}},{key:"negate",value:function(){return this.isNaN()?this:new I(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(c){if(c instanceof CloneNotSupportedException)return null;throw c}}},{key:"multiply",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return c.isNaN()?I.createNaN():I.copy(this).selfMultiply(c)}if(typeof arguments[0]=="number"){var d=arguments[0];return vt.isNaN(d)?I.createNaN():I.copy(this).selfMultiply(d,0)}}},{key:"isNaN",value:function(){return vt.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var c=I.magnitude(this._hi);return c>=-3&&c<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var c=this.getSpecialNumberString();if(c!==null)return c;var d=new Array(1).fill(null),p=this.extractSignificantDigits(!0,d),b=d[0]+1,M=p;if(p.charAt(0)===".")M="0"+p;else if(b<0)M="0."+I.stringOfChar("0",-b)+p;else if(p.indexOf(".")===-1){var F=b-p.length;M=p+I.stringOfChar("0",F)+".0"}return this.isNegative()?"-"+M:M}},{key:"reciprocal",value:function(){var c,d,p,b,M=null,F=null,q=null,Y=null;c=(p=1/this._hi)-(M=(q=I.SPLIT*p)-(M=q-p)),F=(Y=I.SPLIT*this._hi)-this._hi;var me=p+(q=(1-(b=p*this._hi)-(Y=M*(F=Y-F)-b+M*(d=this._hi-F)+c*F+c*d)-p*this._lo)/this._hi);return new I(me,p-me+q)}},{key:"toSciNotation",value:function(){if(this.isZero())return I.SCI_NOT_ZERO;var c=this.getSpecialNumberString();if(c!==null)return c;var d=new Array(1).fill(null),p=this.extractSignificantDigits(!1,d),b=I.SCI_NOT_EXPONENT_CHAR+d[0];if(p.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+p);var M="";p.length>1&&(M=p.substring(1));var F=p.charAt(0)+"."+M;return this.isNegative()?"-"+F+b:F+b}},{key:"abs",value:function(){return this.isNaN()?I.NaN:this.isNegative()?this.negate():new I(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(c){return this._hi<c._hi||this._hi===c._hi&&this._lo<c._lo}},{key:"add",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return I.copy(this).selfAdd(c)}if(typeof arguments[0]=="number"){var d=arguments[0];return I.copy(this).selfAdd(d)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var c=arguments[0];this._hi=c,this._lo=0}else if(arguments[0]instanceof I){var d=arguments[0];this._hi=d._hi,this._lo=d._lo}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this._hi=p,this._lo=b}}},{key:"gt",value:function(c){return this._hi>c._hi||this._hi===c._hi&&this._lo>c._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?I.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[be,he,xe]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var c=arguments[0];this.init(c)}else if(arguments[0]instanceof I){var d=arguments[0];this.init(d)}else if(typeof arguments[0]=="string"){var p=arguments[0];I.constructor_.call(this,I.parse(p))}}else if(arguments.length===2){var b=arguments[0],M=arguments[1];this.init(b,M)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];return I.determinant(I.valueOf(c),I.valueOf(d),I.valueOf(p),I.valueOf(b))}if(arguments[3]instanceof I&&arguments[2]instanceof I&&arguments[0]instanceof I&&arguments[1]instanceof I){var M=arguments[0],F=arguments[1],q=arguments[2],Y=arguments[3],me=M.multiply(Y).selfSubtract(F.multiply(q));return me}}},{key:"sqr",value:function(c){return I.valueOf(c).selfMultiply(c)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var c=arguments[0];return I.parse(c)}if(typeof arguments[0]=="number"){var d=arguments[0];return new I(d)}}},{key:"sqrt",value:function(c){return I.valueOf(c).sqrt()}},{key:"parse",value:function(c){for(var d=0,p=c.length;Jr.isWhitespace(c.charAt(d));)d++;var b=!1;if(d<p){var M=c.charAt(d);M!=="-"&&M!=="+"||(d++,M==="-"&&(b=!0))}for(var F=new I,q=0,Y=0,me=0,Fe=!1;!(d>=p);){var $e=c.charAt(d);if(d++,Jr.isDigit($e)){var mt=$e-"0";F.selfMultiply(I.TEN),F.selfAdd(mt),q++}else{if($e!=="."){if($e==="e"||$e==="E"){var zt=c.substring(d);try{me=Ji.parseInt(zt)}catch(ti){throw ti instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+zt+" in string "+c):ti}break}throw new NumberFormatException("Unexpected character '"+$e+"' at position "+d+" in string "+c)}Y=q,Fe=!0}}var Nt=F;Fe||(Y=q);var gn=q-Y-me;if(gn===0)Nt=F;else if(gn>0){var bn=I.TEN.pow(gn);Nt=F.divide(bn)}else if(gn<0){var Pn=I.TEN.pow(-gn);Nt=F.multiply(Pn)}return b?Nt.negate():Nt}},{key:"createNaN",value:function(){return new I(vt.NaN,vt.NaN)}},{key:"copy",value:function(c){return new I(c)}},{key:"magnitude",value:function(c){var d=Math.abs(c),p=Math.log(d)/Math.log(10),b=Math.trunc(Math.floor(p));return 10*Math.pow(10,b)<=d&&(b+=1),b}},{key:"stringOfChar",value:function(c,d){for(var p=new qi,b=0;b<d;b++)p.append(c);return p.toString()}}]),I}();ct.PI=new ct(3.141592653589793,12246467991473532e-32),ct.TWO_PI=new ct(6.283185307179586,24492935982947064e-32),ct.PI_2=new ct(1.5707963267948966,6123233995736766e-32),ct.E=new ct(2.718281828459045,14456468917292502e-32),ct.NaN=new ct(vt.NaN,vt.NaN),ct.EPS=123259516440783e-46,ct.SPLIT=134217729,ct.MAX_PRINT_DIGITS=32,ct.TEN=ct.valueOf(10),ct.ONE=ct.valueOf(1),ct.SCI_NOT_EXPONENT_CHAR="E",ct.SCI_NOT_ZERO="0.0E0";var gr=function(){function I(){n(this,I)}return a(I,null,[{key:"orientationIndex",value:function(c,d,p){var b=I.orientationIndexFilter(c,d,p);if(b<=1)return b;var M=ct.valueOf(d.x).selfAdd(-c.x),F=ct.valueOf(d.y).selfAdd(-c.y),q=ct.valueOf(p.x).selfAdd(-d.x),Y=ct.valueOf(p.y).selfAdd(-d.y);return M.selfMultiply(Y).selfSubtract(F.selfMultiply(q)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof ct&&arguments[2]instanceof ct&&arguments[0]instanceof ct&&arguments[1]instanceof ct){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3],M=c.multiply(b).selfSubtract(d.multiply(p));return M.signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var F=arguments[0],q=arguments[1],Y=arguments[2],me=arguments[3],Fe=ct.valueOf(F),$e=ct.valueOf(q),mt=ct.valueOf(Y),zt=ct.valueOf(me),Nt=Fe.multiply(zt).selfSubtract($e.multiply(mt));return Nt.signum()}}},{key:"intersection",value:function(c,d,p,b){var M=new ct(c.y).selfSubtract(d.y),F=new ct(d.x).selfSubtract(c.x),q=new ct(c.x).selfMultiply(d.y).selfSubtract(new ct(d.x).selfMultiply(c.y)),Y=new ct(p.y).selfSubtract(b.y),me=new ct(b.x).selfSubtract(p.x),Fe=new ct(p.x).selfMultiply(b.y).selfSubtract(new ct(b.x).selfMultiply(p.y)),$e=F.multiply(Fe).selfSubtract(me.multiply(q)),mt=Y.multiply(q).selfSubtract(M.multiply(Fe)),zt=M.multiply(me).selfSubtract(Y.multiply(F)),Nt=$e.selfDivide(zt).doubleValue(),gn=mt.selfDivide(zt).doubleValue();return vt.isNaN(Nt)||vt.isInfinite(Nt)||vt.isNaN(gn)||vt.isInfinite(gn)?null:new Xe(Nt,gn)}},{key:"orientationIndexFilter",value:function(c,d,p){var b=null,M=(c.x-p.x)*(d.y-p.y),F=(c.y-p.y)*(d.x-p.x),q=M-F;if(M>0){if(F<=0)return I.signum(q);b=M+F}else{if(!(M<0)||F>=0)return I.signum(q);b=-M-F}var Y=I.DP_SAFE_EPSILON*b;return q>=Y||-q>=Y?I.signum(q):2}},{key:"signum",value:function(c){return c>0?1:c<0?-1:0}}]),I}();gr.DP_SAFE_EPSILON=1e-15;var kn=function(){function I(){n(this,I)}return a(I,[{key:"getM",value:function(c){if(this.hasM()){var d=this.getDimension()-this.getMeasures();return this.getOrdinate(c,d)}return vt.NaN}},{key:"setOrdinate",value:function(c,d,p){}},{key:"getZ",value:function(c){return this.hasZ()?this.getOrdinate(c,2):vt.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(c,d){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(c){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(c){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(c){}},{key:"copy",value:function(){}},{key:"getY",value:function(c){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[xe]}}]),I}();kn.X=0,kn.Y=1,kn.Z=2,kn.M=3;var mn=function(){function I(){n(this,I)}return a(I,null,[{key:"index",value:function(c,d,p){return gr.orientationIndex(c,d,p)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var c=arguments[0],d=c.length-1;if(d<3)throw new ve("Ring has fewer than 4 points, so orientation cannot be determined");for(var p=c[0],b=0,M=1;M<=d;M++){var F=c[M];F.y>p.y&&(p=F,b=M)}var q=b;do(q-=1)<0&&(q=d);while(c[q].equals2D(p)&&q!==b);var Y=b;do Y=(Y+1)%d;while(c[Y].equals2D(p)&&Y!==b);var me=c[q],Fe=c[Y];if(me.equals2D(p)||Fe.equals2D(p)||me.equals2D(Fe))return!1;var $e=I.index(me,p,Fe),mt=null;return mt=$e===0?me.x>Fe.x:$e>0,mt}if(xn(arguments[0],kn)){var zt=arguments[0],Nt=zt.size()-1;if(Nt<3)throw new ve("Ring has fewer than 4 points, so orientation cannot be determined");for(var gn=zt.getCoordinate(0),bn=0,Pn=1;Pn<=Nt;Pn++){var ti=zt.getCoordinate(Pn);ti.y>gn.y&&(gn=ti,bn=Pn)}var mi=null,li=bn;do(li-=1)<0&&(li=Nt),mi=zt.getCoordinate(li);while(mi.equals2D(gn)&&li!==bn);var er=null,rs=bn;do rs=(rs+1)%Nt,er=zt.getCoordinate(rs);while(er.equals2D(gn)&&rs!==bn);if(mi.equals2D(gn)||er.equals2D(gn)||mi.equals2D(er))return!1;var Ps=I.index(mi,gn,er);return Ps===0?mi.x>er.x:Ps>0}}}]),I}();mn.CLOCKWISE=-1,mn.RIGHT=mn.CLOCKWISE,mn.COUNTERCLOCKWISE=1,mn.LEFT=mn.COUNTERCLOCKWISE,mn.COLLINEAR=0,mn.STRAIGHT=mn.COLLINEAR;var As=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(c,d){var p=this.getRightmostSideOfSegment(c,d);return p<0&&(p=this.getRightmostSideOfSegment(c,d-1)),p<0&&(this._minCoord=null,this.checkForRightmostCoordinate(c)),p}},{key:"findRightmostEdgeAtVertex",value:function(){var c=this._minDe.getEdge().getCoordinates();It.isTrue(this._minIndex>0&&this._minIndex<c.length,"rightmost point expected to be interior vertex of edge");var d=c[this._minIndex-1],p=c[this._minIndex+1],b=mn.index(this._minCoord,p,d),M=!1;(d.y<this._minCoord.y&&p.y<this._minCoord.y&&b===mn.COUNTERCLOCKWISE||d.y>this._minCoord.y&&p.y>this._minCoord.y&&b===mn.CLOCKWISE)&&(M=!0),M&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(c,d){var p=c.getEdge().getCoordinates();if(d<0||d+1>=p.length||p[d].y===p[d+1].y)return-1;var b=Ee.LEFT;return p[d].y<p[d+1].y&&(b=Ee.RIGHT),b}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(c){for(var d=c.getEdge().getCoordinates(),p=0;p<d.length-1;p++)(this._minCoord===null||d[p].x>this._minCoord.x)&&(this._minDe=c,this._minIndex=p,this._minCoord=d[p])}},{key:"findRightmostEdgeAtNode",value:function(){var c=this._minDe.getNode().getEdges();this._minDe=c.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(c){for(var d=c.iterator();d.hasNext();){var p=d.next();p.isForward()&&this.checkForRightmostCoordinate(p)}It.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Ee.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}]),I}(),At=function(I){f(d,I);var c=B(d);function d(p,b){var M;return n(this,d),(M=c.call(this,b?p+" [ "+b+" ]":p)).pt=b?new Xe(b):void 0,M.name=Object.keys({TopologyException:d})[0],M}return a(d,[{key:"getCoordinate",value:function(){return this.pt}}]),d}(ft),Ln=function(){function I(){n(this,I),this.array=[]}return a(I,[{key:"addLast",value:function(c){this.array.push(c)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}]),I}(),Tt=function(I,c){f(p,I);var d=B(p);function p(b){var M;return n(this,p),(M=d.call(this)).array=[],b instanceof lt&&M.addAll(b),M}return a(p,[{key:"interfaces_",get:function(){return[Kn,lt]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(b){return arguments.length===1?this.array.push(b):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(b){var M,F=Q(b);try{for(F.s();!(M=F.n()).done;){var q=M.value;this.array.push(q)}}catch(Y){F.e(Y)}finally{F.f()}}},{key:"set",value:function(b,M){var F=this.array[b];return this.array[b]=M,F}},{key:"iterator",value:function(){return new _r(this)}},{key:"get",value:function(b){if(b<0||b>=this.size())throw new _n;return this.array[b]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(b){b?this.array.sort(function(M,F){return b.compare(M,F)}):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(b){for(var M=0,F=this.array.length;M<F;M++)if(this.array[M]===b)return!!this.array.splice(M,1);return!1}},{key:c,value:function(){return this.array.values()}}]),p}(Kn,Symbol.iterator),_r=function(){function I(c){n(this,I),this.arrayList=c,this.position=0}return a(I,[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new Je;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(c){return this.arrayList.set(this.position-1,c)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}]),I}(),Gr=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"clearVisitedEdges",value:function(){for(var c=this._dirEdgeList.iterator();c.hasNext();)c.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(c){for(var d=null,p=c.getEdges().iterator();p.hasNext();){var b=p.next();if(b.isVisited()||b.getSym().isVisited()){d=b;break}}if(d===null)throw new At("unable to find edge to compute depths at "+c.getCoordinate());c.getEdges().computeDepths(d);for(var M=c.getEdges().iterator();M.hasNext();){var F=M.next();F.setVisited(!0),this.copySymDepths(F)}}},{key:"computeDepth",value:function(c){this.clearVisitedEdges();var d=this._finder.getEdge();d.getNode(),d.getLabel(),d.setEdgeDepths(Ee.RIGHT,c),this.copySymDepths(d),this.computeDepths(d)}},{key:"create",value:function(c){this.addReachable(c),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var c=this._dirEdgeList.iterator();c.hasNext();){var d=c.next();d.getDepth(Ee.RIGHT)>=1&&d.getDepth(Ee.LEFT)<=0&&!d.isInteriorAreaEdge()&&d.setInResult(!0)}}},{key:"computeDepths",value:function(c){var d=new kt,p=new Ln,b=c.getNode();for(p.addLast(b),d.add(b),c.setVisited(!0);!p.isEmpty();){var M=p.removeFirst();d.add(M),this.computeNodeDepth(M);for(var F=M.getEdges().iterator();F.hasNext();){var q=F.next().getSym();if(!q.isVisited()){var Y=q.getNode();d.contains(Y)||(p.addLast(Y),d.add(Y))}}}}},{key:"compareTo",value:function(c){var d=c;return this._rightMostCoord.x<d._rightMostCoord.x?-1:this._rightMostCoord.x>d._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var c=new dn,d=this._dirEdgeList.iterator();d.hasNext();)for(var p=d.next().getEdge().getCoordinates(),b=0;b<p.length-1;b++)c.expandToInclude(p[b]);this._env=c}return this._env}},{key:"addReachable",value:function(c){var d=new Yi;for(d.add(c);!d.empty();){var p=d.pop();this.add(p,d)}}},{key:"copySymDepths",value:function(c){var d=c.getSym();d.setDepth(Ee.LEFT,c.getDepth(Ee.RIGHT)),d.setDepth(Ee.RIGHT,c.getDepth(Ee.LEFT))}},{key:"add",value:function(c,d){c.setVisited(!0),this._nodes.add(c);for(var p=c.getEdges().iterator();p.hasNext();){var b=p.next();this._dirEdgeList.add(b);var M=b.getSym().getNode();M.isVisited()||d.push(M)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[he]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new Tt,this._nodes=new Tt,this._rightMostCoord=null,this._env=null,this._finder=new As}}]),I}(),wn=function(){function I(){n(this,I)}return a(I,null,[{key:"intersection",value:function(c,d,p,b){var M=c.x<d.x?c.x:d.x,F=c.y<d.y?c.y:d.y,q=c.x>d.x?c.x:d.x,Y=c.y>d.y?c.y:d.y,me=p.x<b.x?p.x:b.x,Fe=p.y<b.y?p.y:b.y,$e=p.x>b.x?p.x:b.x,mt=p.y>b.y?p.y:b.y,zt=((M>me?M:me)+(q<$e?q:$e))/2,Nt=((F>Fe?F:Fe)+(Y<mt?Y:mt))/2,gn=c.x-zt,bn=c.y-Nt,Pn=d.x-zt,ti=d.y-Nt,mi=p.x-zt,li=p.y-Nt,er=b.x-zt,rs=b.y-Nt,Ps=bn-ti,fi=Pn-gn,Ar=gn*ti-Pn*bn,dr=li-rs,Rs=er-mi,Xa=mi*rs-er*li,xa=Ps*Rs-dr*fi,lo=(fi*Xa-Rs*Ar)/xa,ks=(dr*Ar-Ps*Xa)/xa;return vt.isNaN(lo)||vt.isInfinite(lo)||vt.isNaN(ks)||vt.isInfinite(ks)?null:new Xe(lo+zt,ks+Nt)}}]),I}(),Mi=function(){function I(){n(this,I)}return a(I,null,[{key:"arraycopy",value:function(c,d,p,b,M){for(var F=0,q=d;q<d+M;q++)p[b+F]=c[q],F++}},{key:"getProperty",value:function(c){return{"line.separator":`
`}[c]}}]),I}(),Er=function(){function I(){n(this,I)}return a(I,null,[{key:"log10",value:function(c){var d=Math.log(c);return vt.isInfinite(d)||vt.isNaN(d)?d:d/I.LOG_10}},{key:"min",value:function(c,d,p,b){var M=c;return d<M&&(M=d),p<M&&(M=p),b<M&&(M=b),M}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1],p=arguments[2];return c<d?d:c>p?p:c}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var b=arguments[0],M=arguments[1],F=arguments[2];return b<M?M:b>F?F:b}}},{key:"wrap",value:function(c,d){return c<0?d- -c%d:c%d}},{key:"max",value:function(){if(arguments.length===3){var c=arguments[0],d=arguments[1],p=arguments[2],b=c;return d>b&&(b=d),p>b&&(b=p),b}if(arguments.length===4){var M=arguments[0],F=arguments[1],q=arguments[2],Y=arguments[3],me=M;return F>me&&(me=F),q>me&&(me=q),Y>me&&(me=Y),me}}},{key:"average",value:function(c,d){return(c+d)/2}}]),I}();Er.LOG_10=Math.log(10);var Ki=function(){function I(){n(this,I)}return a(I,null,[{key:"segmentToSegment",value:function(c,d,p,b){if(c.equals(d))return I.pointToSegment(c,p,b);if(p.equals(b))return I.pointToSegment(b,c,d);var M=!1;if(dn.intersects(c,d,p,b)){var F=(d.x-c.x)*(b.y-p.y)-(d.y-c.y)*(b.x-p.x);if(F===0)M=!0;else{var q=(c.y-p.y)*(b.x-p.x)-(c.x-p.x)*(b.y-p.y),Y=((c.y-p.y)*(d.x-c.x)-(c.x-p.x)*(d.y-c.y))/F,me=q/F;(me<0||me>1||Y<0||Y>1)&&(M=!0)}}else M=!0;return M?Er.min(I.pointToSegment(c,p,b),I.pointToSegment(d,p,b),I.pointToSegment(p,c,d),I.pointToSegment(b,c,d)):0}},{key:"pointToSegment",value:function(c,d,p){if(d.x===p.x&&d.y===p.y)return c.distance(d);var b=(p.x-d.x)*(p.x-d.x)+(p.y-d.y)*(p.y-d.y),M=((c.x-d.x)*(p.x-d.x)+(c.y-d.y)*(p.y-d.y))/b;if(M<=0)return c.distance(d);if(M>=1)return c.distance(p);var F=((d.y-c.y)*(p.x-d.x)-(d.x-c.x)*(p.y-d.y))/b;return Math.abs(F)*Math.sqrt(b)}},{key:"pointToLinePerpendicular",value:function(c,d,p){var b=(p.x-d.x)*(p.x-d.x)+(p.y-d.y)*(p.y-d.y),M=((d.y-c.y)*(p.x-d.x)-(d.x-c.x)*(p.y-d.y))/b;return Math.abs(M)*Math.sqrt(b)}},{key:"pointToSegmentString",value:function(c,d){if(d.length===0)throw new ve("Line array must contain at least one vertex");for(var p=c.distance(d[0]),b=0;b<d.length-1;b++){var M=I.pointToSegment(c,d[b],d[b+1]);M<p&&(p=M)}return p}}]),I}(),Zr=function(){function I(){n(this,I)}return a(I,[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||xn(arguments[0],kn);else if(arguments.length!==2&&arguments.length===3){var c=arguments[0],d=arguments[1];return this.create(c,d)}}}]),I}(),Ae=function(){function I(){n(this,I)}return a(I,[{key:"filter",value:function(c){}}]),I}(),K=function(){function I(){n(this,I)}return a(I,null,[{key:"ofLine",value:function(c){var d=c.size();if(d<=1)return 0;var p=0,b=new Xe;c.getCoordinate(0,b);for(var M=b.x,F=b.y,q=1;q<d;q++){c.getCoordinate(q,b);var Y=b.x,me=b.y,Fe=Y-M,$e=me-F;p+=Math.sqrt(Fe*Fe+$e*$e),M=Y,F=me}return p}}]),I}(),J=function I(){n(this,I)},ce=function(){function I(){n(this,I)}return a(I,null,[{key:"copyCoord",value:function(c,d,p,b){for(var M=Math.min(c.getDimension(),p.getDimension()),F=0;F<M;F++)p.setOrdinate(b,F,c.getOrdinate(d,F))}},{key:"isRing",value:function(c){var d=c.size();return d===0||!(d<=3)&&c.getOrdinate(0,kn.X)===c.getOrdinate(d-1,kn.X)&&c.getOrdinate(0,kn.Y)===c.getOrdinate(d-1,kn.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(xn(arguments[0],kn)&&Number.isInteger(arguments[1])){var c=arguments[0],d=arguments[1];I.scroll(c,d,I.isRing(c))}else if(xn(arguments[0],kn)&&arguments[1]instanceof Xe){var p=arguments[0],b=arguments[1],M=I.indexOf(b,p);if(M<=0)return null;I.scroll(p,M)}}else if(arguments.length===3){var F=arguments[0],q=arguments[1],Y=arguments[2],me=q;if(me<=0)return null;for(var Fe=F.copy(),$e=Y?F.size()-1:F.size(),mt=0;mt<$e;mt++)for(var zt=0;zt<F.getDimension();zt++)F.setOrdinate(mt,zt,Fe.getOrdinate((q+mt)%$e,zt));if(Y)for(var Nt=0;Nt<F.getDimension();Nt++)F.setOrdinate($e,Nt,F.getOrdinate(0,Nt))}}},{key:"isEqual",value:function(c,d){var p=c.size();if(p!==d.size())return!1;for(var b=Math.min(c.getDimension(),d.getDimension()),M=0;M<p;M++)for(var F=0;F<b;F++){var q=c.getOrdinate(M,F),Y=d.getOrdinate(M,F);if(c.getOrdinate(M,F)!==d.getOrdinate(M,F)&&(!vt.isNaN(q)||!vt.isNaN(Y)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var c=arguments[0];return I.minCoordinateIndex(c,0,c.size()-1)}if(arguments.length===3){for(var d=arguments[0],p=arguments[1],b=arguments[2],M=-1,F=null,q=p;q<=b;q++){var Y=d.getCoordinate(q);(F===null||F.compareTo(Y)>0)&&(F=Y,M=q)}return M}}},{key:"extend",value:function(c,d,p){var b=c.create(p,d.getDimension()),M=d.size();if(I.copy(d,0,b,0,M),M>0)for(var F=M;F<p;F++)I.copy(d,M-1,b,F,1);return b}},{key:"reverse",value:function(c){for(var d=c.size()-1,p=Math.trunc(d/2),b=0;b<=p;b++)I.swap(c,b,d-b)}},{key:"swap",value:function(c,d,p){if(d===p)return null;for(var b=0;b<c.getDimension();b++){var M=c.getOrdinate(d,b);c.setOrdinate(d,b,c.getOrdinate(p,b)),c.setOrdinate(p,b,M)}}},{key:"copy",value:function(c,d,p,b,M){for(var F=0;F<M;F++)I.copyCoord(c,d+F,p,b+F)}},{key:"ensureValidRing",value:function(c,d){var p=d.size();return p===0?d:p<=3?I.createClosedRing(c,d,4):d.getOrdinate(0,kn.X)===d.getOrdinate(p-1,kn.X)&&d.getOrdinate(0,kn.Y)===d.getOrdinate(p-1,kn.Y)?d:I.createClosedRing(c,d,p+1)}},{key:"indexOf",value:function(c,d){for(var p=0;p<d.size();p++)if(c.x===d.getOrdinate(p,kn.X)&&c.y===d.getOrdinate(p,kn.Y))return p;return-1}},{key:"createClosedRing",value:function(c,d,p){var b=c.create(p,d.getDimension()),M=d.size();I.copy(d,0,b,0,M);for(var F=M;F<p;F++)I.copy(d,0,b,F,1);return b}},{key:"minCoordinate",value:function(c){for(var d=null,p=0;p<c.size();p++){var b=c.getCoordinate(p);(d===null||d.compareTo(b)>0)&&(d=b)}return d}}]),I}(),le=function(){function I(){n(this,I)}return a(I,null,[{key:"toDimensionSymbol",value:function(c){switch(c){case I.FALSE:return I.SYM_FALSE;case I.TRUE:return I.SYM_TRUE;case I.DONTCARE:return I.SYM_DONTCARE;case I.P:return I.SYM_P;case I.L:return I.SYM_L;case I.A:return I.SYM_A}throw new ve("Unknown dimension value: "+c)}},{key:"toDimensionValue",value:function(c){switch(Jr.toUpperCase(c)){case I.SYM_FALSE:return I.FALSE;case I.SYM_TRUE:return I.TRUE;case I.SYM_DONTCARE:return I.DONTCARE;case I.SYM_P:return I.P;case I.SYM_L:return I.L;case I.SYM_A:return I.A}throw new ve("Unknown dimension symbol: "+c)}}]),I}();le.P=0,le.L=1,le.A=2,le.FALSE=-1,le.TRUE=-2,le.DONTCARE=-3,le.SYM_FALSE="F",le.SYM_TRUE="T",le.SYM_DONTCARE="*",le.SYM_P="0",le.SYM_L="1",le.SYM_A="2";var fe=function(){function I(){n(this,I)}return a(I,[{key:"filter",value:function(c){}}]),I}(),je=function(){function I(){n(this,I)}return a(I,[{key:"filter",value:function(c,d){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}]),I}(),We=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new dn:this._points.expandEnvelope(new dn)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new d(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ft){var p=arguments[0],b=arguments[1];if(!this.isEquivalentClass(p))return!1;var M=p;if(this._points.size()!==M._points.size())return!1;for(var F=0;F<this._points.size();F++)if(!this.equal(this._points.getCoordinate(F),M._points.getCoordinate(F),b))return!1;return!0}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){for(var p=0;p<Math.trunc(this._points.size()/2);p++){var b=this._points.size()-1-p;if(!this._points.getCoordinate(p).equals(this._points.getCoordinate(b))){if(this._points.getCoordinate(p).compareTo(this._points.getCoordinate(b))>0){var M=this._points.copy();ce.reverse(M),this._points=M}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?le.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var p=this._points.copy();return ce.reverse(p),this.getFactory().createLineString(p)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return Ft.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return K.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var p=arguments[0],b=p,M=0,F=0;M<this._points.size()&&F<b._points.size();){var q=this._points.getCoordinate(M).compareTo(b._points.getCoordinate(F));if(q!==0)return q;M++,F++}return M<this._points.size()?1:F<b._points.size()?-1:0}if(arguments.length===2){var Y=arguments[0],me=arguments[1],Fe=Y;return me.compare(this._points,Fe._points)}}},{key:"apply",value:function(){if(xn(arguments[0],Ae))for(var p=arguments[0],b=0;b<this._points.size();b++)p.filter(this._points.getCoordinate(b));else if(xn(arguments[0],je)){var M=arguments[0];if(this._points.size()===0)return null;for(var F=0;F<this._points.size()&&(M.filter(this._points,F),!M.isDone());F++);M.isGeometryChanged()&&this.geometryChanged()}else if(xn(arguments[0],fe)){var q=arguments[0];q.filter(this)}else if(xn(arguments[0],De)){var Y=arguments[0];Y.filter(this)}}},{key:"getBoundary",value:function(){throw new Lt}},{key:"isEquivalentClass",value:function(p){return p instanceof d}},{key:"getCoordinateN",value:function(p){return this._points.getCoordinate(p)}},{key:"getGeometryType",value:function(){return Ft.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(p){if(p===null&&(p=this.getFactory().getCoordinateSequenceFactory().create([])),p.size()===1)throw new ve("Invalid number of points in LineString (found "+p.size()+" - must be 0 or >= 2)");this._points=p}},{key:"isCoordinate",value:function(p){for(var b=0;b<this._points.size();b++)if(this._points.getCoordinate(b).equals(p))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(p){return this.getFactory().createPoint(this._points.getCoordinate(p))}},{key:"interfaces_",get:function(){return[J]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0&&arguments.length===2){var p=arguments[0],b=arguments[1];Ft.constructor_.call(this,b),this.init(p)}}}]),d}(Ft),Pe=function I(){n(this,I)},et=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new dn;var p=new dn;return p.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),p}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new d(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ft){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&(!(!this.isEmpty()||!p.isEmpty())||this.isEmpty()===p.isEmpty()&&this.equal(p.getCoordinate(),this.getCoordinate(),b))}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return le.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return Ft.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var p=arguments[0],b=p;return this.getCoordinate().compareTo(b.getCoordinate())}if(arguments.length===2){var M=arguments[0],F=arguments[1],q=M;return F.compare(this._coordinates,q._coordinates)}}},{key:"apply",value:function(){if(xn(arguments[0],Ae)){var p=arguments[0];if(this.isEmpty())return null;p.filter(this.getCoordinate())}else if(xn(arguments[0],je)){var b=arguments[0];if(this.isEmpty())return null;b.filter(this._coordinates,0),b.isGeometryChanged()&&this.geometryChanged()}else if(xn(arguments[0],fe)){var M=arguments[0];M.filter(this)}else if(xn(arguments[0],De)){var F=arguments[0];F.filter(this)}}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Ft.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(p){p===null&&(p=this.getFactory().getCoordinateSequenceFactory().create([])),It.isTrue(p.size()<=1),this._coordinates=p}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[Pe]}}],[{key:"constructor_",value:function(){this._coordinates=null;var p=arguments[0],b=arguments[1];Ft.constructor_.call(this,b),this.init(p)}}]),d}(Ft),gt=function(){function I(){n(this,I)}return a(I,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var c=arguments[0];return Math.abs(I.ofRingSigned(c))}if(xn(arguments[0],kn)){var d=arguments[0];return Math.abs(I.ofRingSigned(d))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var c=arguments[0];if(c.length<3)return 0;for(var d=0,p=c[0].x,b=1;b<c.length-1;b++){var M=c[b].x-p,F=c[b+1].y,q=c[b-1].y;d+=M*(q-F)}return d/2}if(xn(arguments[0],kn)){var Y=arguments[0],me=Y.size();if(me<3)return 0;var Fe=new Xe,$e=new Xe,mt=new Xe;Y.getCoordinate(0,$e),Y.getCoordinate(1,mt);var zt=$e.x;mt.x-=zt;for(var Nt=0,gn=1;gn<me-1;gn++)Fe.y=$e.y,$e.x=mt.x,$e.y=mt.y,Y.getCoordinate(gn+1,mt),mt.x-=zt,Nt+=$e.x*(Fe.y-mt.y);return Nt/2}}}]),I}(),at=function(){function I(){n(this,I)}return a(I,null,[{key:"sort",value:function(){var c=arguments,d=arguments[0];if(arguments.length===1)d.sort(function(zt,Nt){return zt.compareTo(Nt)});else if(arguments.length===2)d.sort(function(zt,Nt){return c[1].compare(zt,Nt)});else if(arguments.length===3){var p=d.slice(arguments[1],arguments[2]);p.sort();var b=d.slice(0,arguments[1]).concat(p,d.slice(arguments[2],d.length));d.splice(0,d.length);var M,F=Q(b);try{for(F.s();!(M=F.n()).done;){var q=M.value;d.push(q)}}catch(zt){F.e(zt)}finally{F.f()}}else if(arguments.length===4){var Y=d.slice(arguments[1],arguments[2]);Y.sort(function(zt,Nt){return c[3].compare(zt,Nt)});var me=d.slice(0,arguments[1]).concat(Y,d.slice(arguments[2],d.length));d.splice(0,d.length);var Fe,$e=Q(me);try{for($e.s();!(Fe=$e.n()).done;){var mt=Fe.value;d.push(mt)}}catch(zt){$e.e(zt)}finally{$e.f()}}}},{key:"asList",value:function(c){var d,p=new Tt,b=Q(c);try{for(b.s();!(d=b.n()).done;){var M=d.value;p.add(M)}}catch(F){b.e(F)}finally{b.f()}return p}},{key:"copyOf",value:function(c,d){return c.slice(0,d)}}]),I}(),Dt=function I(){n(this,I)},en=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var p=new Array(this.getNumPoints()).fill(null),b=-1,M=this._shell.getCoordinates(),F=0;F<M.length;F++)p[++b]=M[F];for(var q=0;q<this._holes.length;q++)for(var Y=this._holes[q].getCoordinates(),me=0;me<Y.length;me++)p[++b]=Y[me];return p}},{key:"getArea",value:function(){var p=0;p+=gt.ofRing(this._shell.getCoordinateSequence());for(var b=0;b<this._holes.length;b++)p-=gt.ofRing(this._holes[b].getCoordinateSequence());return p}},{key:"copyInternal",value:function(){for(var p=this._shell.copy(),b=new Array(this._holes.length).fill(null),M=0;M<this._holes.length;M++)b[M]=this._holes[M].copy();return new d(p,b,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var p=this._shell.getCoordinateSequence(),b=this.getEnvelopeInternal(),M=0;M<5;M++){var F=p.getX(M);if(F!==b.getMinX()&&F!==b.getMaxX())return!1;var q=p.getY(M);if(q!==b.getMinY()&&q!==b.getMaxY())return!1}for(var Y=p.getX(0),me=p.getY(0),Fe=1;Fe<=4;Fe++){var $e=p.getX(Fe),mt=p.getY(Fe);if($e!==Y==(mt!==me))return!1;Y=$e,me=mt}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ft){var p=arguments[0],b=arguments[1];if(!this.isEquivalentClass(p))return!1;var M=p,F=this._shell,q=M._shell;if(!F.equalsExact(q,b)||this._holes.length!==M._holes.length)return!1;for(var Y=0;Y<this._holes.length;Y++)if(!this._holes[Y].equalsExact(M._holes[Y],b))return!1;return!0}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var p=0;p<this._holes.length;p++)this._holes[p]=this.normalized(this._holes[p],!1);at.sort(this._holes)}else if(arguments.length===2){var b=arguments[0],M=arguments[1];if(b.isEmpty())return null;var F=b.getCoordinateSequence(),q=ce.minCoordinateIndex(F,0,F.size()-2);ce.scroll(F,q,!0),mn.isCCW(F)===M&&ce.reverse(F)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var p=this.getExteriorRing().reverse(),b=new Array(this.getNumInteriorRing()).fill(null),M=0;M<b.length;M++)b[M]=this.getInteriorRingN(M).reverse();return this.getFactory().createPolygon(p,b)}},{key:"getTypeCode",value:function(){return Ft.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var p=0;p+=this._shell.getLength();for(var b=0;b<this._holes.length;b++)p+=this._holes[b].getLength();return p}},{key:"getNumPoints",value:function(){for(var p=this._shell.getNumPoints(),b=0;b<this._holes.length;b++)p+=this._holes[b].getNumPoints();return p}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(p,b){var M=p.copy();return this.normalize(M,b),M}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var p=arguments[0],b=this._shell,M=p._shell;return b.compareToSameClass(M)}if(arguments.length===2){var F=arguments[0],q=arguments[1],Y=F,me=this._shell,Fe=Y._shell,$e=me.compareToSameClass(Fe,q);if($e!==0)return $e;for(var mt=this.getNumInteriorRing(),zt=Y.getNumInteriorRing(),Nt=0;Nt<mt&&Nt<zt;){var gn=this.getInteriorRingN(Nt),bn=Y.getInteriorRingN(Nt),Pn=gn.compareToSameClass(bn,q);if(Pn!==0)return Pn;Nt++}return Nt<mt?1:Nt<zt?-1:0}}},{key:"apply",value:function(){if(xn(arguments[0],Ae)){var p=arguments[0];this._shell.apply(p);for(var b=0;b<this._holes.length;b++)this._holes[b].apply(p)}else if(xn(arguments[0],je)){var M=arguments[0];if(this._shell.apply(M),!M.isDone())for(var F=0;F<this._holes.length&&(this._holes[F].apply(M),!M.isDone());F++);M.isGeometryChanged()&&this.geometryChanged()}else if(xn(arguments[0],fe)){var q=arguments[0];q.filter(this)}else if(xn(arguments[0],De)){var Y=arguments[0];Y.filter(this),this._shell.apply(Y);for(var me=0;me<this._holes.length;me++)this._holes[me].apply(Y)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var p=new Array(this._holes.length+1).fill(null);p[0]=this._shell;for(var b=0;b<this._holes.length;b++)p[b+1]=this._holes[b];return p.length<=1?this.getFactory().createLinearRing(p[0].getCoordinateSequence()):this.getFactory().createMultiLineString(p)}},{key:"getGeometryType",value:function(){return Ft.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(p){return this._holes[p]}},{key:"interfaces_",get:function(){return[Dt]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var p=arguments[0],b=arguments[1],M=arguments[2];if(Ft.constructor_.call(this,M),p===null&&(p=this.getFactory().createLinearRing()),b===null&&(b=[]),Ft.hasNullElements(b))throw new ve("holes must not contain null elements");if(p.isEmpty()&&Ft.hasNonEmptyElements(b))throw new ve("shell is empty but holes are not");this._shell=p,this._holes=b}}]),d}(Ft),an=function(I){f(d,I);var c=B(d);function d(){return n(this,d),c.apply(this,arguments)}return d}(Ye),Vn=function(I){f(d,I);var c=B(d);function d(p){var b;return n(this,d),(b=c.call(this)).array=[],p instanceof lt&&b.addAll(p),b}return a(d,[{key:"contains",value:function(p){var b,M=Q(this.array);try{for(M.s();!(b=M.n()).done;)if(b.value.compareTo(p)===0)return!0}catch(F){M.e(F)}finally{M.f()}return!1}},{key:"add",value:function(p){if(this.contains(p))return!1;for(var b=0,M=this.array.length;b<M;b++)if(this.array[b].compareTo(p)===1)return!!this.array.splice(b,0,p);return this.array.push(p),!0}},{key:"addAll",value:function(p){var b,M=Q(p);try{for(M.s();!(b=M.n()).done;){var F=b.value;this.add(F)}}catch(q){M.e(q)}finally{M.f()}return!0}},{key:"remove",value:function(){throw new Lt}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new Mn(this.array)}}]),d}(an),Mn=function(){function I(c){n(this,I),this.array=c,this.position=0}return a(I,[{key:"next",value:function(){if(this.position===this.array.length)throw new Je;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new Lt}}]),I}(),An=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"computeEnvelopeInternal",value:function(){for(var p=new dn,b=0;b<this._geometries.length;b++)p.expandToInclude(this._geometries[b].getEnvelopeInternal());return p}},{key:"getGeometryN",value:function(p){return this._geometries[p]}},{key:"getCoordinates",value:function(){for(var p=new Array(this.getNumPoints()).fill(null),b=-1,M=0;M<this._geometries.length;M++)for(var F=this._geometries[M].getCoordinates(),q=0;q<F.length;q++)p[++b]=F[q];return p}},{key:"getArea",value:function(){for(var p=0,b=0;b<this._geometries.length;b++)p+=this._geometries[b].getArea();return p}},{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ft){var p=arguments[0],b=arguments[1];if(!this.isEquivalentClass(p))return!1;var M=p;if(this._geometries.length!==M._geometries.length)return!1;for(var F=0;F<this._geometries.length;F++)if(!this._geometries[F].equalsExact(M._geometries[F],b))return!1;return!0}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"normalize",value:function(){for(var p=0;p<this._geometries.length;p++)this._geometries[p].normalize();at.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var p=le.FALSE,b=0;b<this._geometries.length;b++)p=Math.max(p,this._geometries[b].getBoundaryDimension());return p}},{key:"reverseInternal",value:function(){for(var p=this._geometries.length,b=new Tt(p),M=0;M<p;M++)b.add(this._geometries[M].reverse());return this.getFactory().buildGeometry(b)}},{key:"getTypeCode",value:function(){return Ft.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var p=le.FALSE,b=0;b<this._geometries.length;b++)p=Math.max(p,this._geometries[b].getDimension());return p}},{key:"getLength",value:function(){for(var p=0,b=0;b<this._geometries.length;b++)p+=this._geometries[b].getLength();return p}},{key:"getNumPoints",value:function(){for(var p=0,b=0;b<this._geometries.length;b++)p+=this._geometries[b].getNumPoints();return p}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var p=arguments[0],b=new Vn(at.asList(this._geometries)),M=new Vn(at.asList(p._geometries));return this.compare(b,M)}if(arguments.length===2){for(var F=arguments[0],q=arguments[1],Y=F,me=this.getNumGeometries(),Fe=Y.getNumGeometries(),$e=0;$e<me&&$e<Fe;){var mt=this.getGeometryN($e),zt=Y.getGeometryN($e),Nt=mt.compareToSameClass(zt,q);if(Nt!==0)return Nt;$e++}return $e<me?1:$e<Fe?-1:0}}},{key:"apply",value:function(){if(xn(arguments[0],Ae))for(var p=arguments[0],b=0;b<this._geometries.length;b++)this._geometries[b].apply(p);else if(xn(arguments[0],je)){var M=arguments[0];if(this._geometries.length===0)return null;for(var F=0;F<this._geometries.length&&(this._geometries[F].apply(M),!M.isDone());F++);M.isGeometryChanged()&&this.geometryChanged()}else if(xn(arguments[0],fe)){var q=arguments[0];q.filter(this);for(var Y=0;Y<this._geometries.length;Y++)this._geometries[Y].apply(q)}else if(xn(arguments[0],De)){var me=arguments[0];me.filter(this);for(var Fe=0;Fe<this._geometries.length;Fe++)this._geometries[Fe].apply(me)}}},{key:"getBoundary",value:function(){return Ft.checkNotGeometryCollection(this),It.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return Ft.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var p=0;p<this._geometries.length;p++)if(!this._geometries[p].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0&&arguments.length===2){var p=arguments[0],b=arguments[1];if(Ft.constructor_.call(this,b),p===null&&(p=[]),Ft.hasNullElements(p))throw new ve("geometries must not contain null elements");this._geometries=p}}}]),d}(Ft),Fn=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ft){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&U(m(d.prototype),"equalsExact",this).call(this,p,b)}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var p=arguments[0];return this._geometries[p].getCoordinate()}return U(m(d.prototype),"getCoordinate",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return le.FALSE}},{key:"getTypeCode",value:function(){return Ft.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return Ft.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[Pe]}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];An.constructor_.call(this,p,b)}}]),d}(An),wi=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){return new d(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return le.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||U(m(d.prototype),"isClosed",this).call(this)}},{key:"reverseInternal",value:function(){var p=this._points.copy();return ce.reverse(p),this.getFactory().createLinearRing(p)}},{key:"getTypeCode",value:function(){return Ft.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!U(m(d.prototype),"isClosed",this).call(this))throw new ve("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<d.MINIMUM_VALID_SIZE)throw new ve("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return Ft.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];We.constructor_.call(this,p,b),this.validateConstruction()}}]),d}(We);wi.MINIMUM_VALID_SIZE=4;var ui=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"setOrdinate",value:function(p,b){switch(p){case d.X:this.x=b;break;case d.Y:this.y=b;break;default:throw new ve("Invalid ordinate index: "+p)}}},{key:"getZ",value:function(){return Xe.NULL_ORDINATE}},{key:"getOrdinate",value:function(p){switch(p){case d.X:return this.x;case d.Y:return this.y}throw new ve("Invalid ordinate index: "+p)}},{key:"setZ",value:function(p){throw new ve("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new d(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(p){this.x=p.x,this.y=p.y,this.z=p.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)Xe.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof d){var p=arguments[0];Xe.constructor_.call(this,p.x,p.y)}else if(arguments[0]instanceof Xe){var b=arguments[0];Xe.constructor_.call(this,b.x,b.y)}}else if(arguments.length===2){var M=arguments[0],F=arguments[1];Xe.constructor_.call(this,M,F,Xe.NULL_ORDINATE)}}}]),d}(Xe);ui.X=0,ui.Y=1,ui.Z=-1,ui.M=-1;var Cn=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(p,b){switch(p){case d.X:this.x=b;break;case d.Y:this.y=b;break;case d.M:this._m=b;break;default:throw new ve("Invalid ordinate index: "+p)}}},{key:"setM",value:function(p){this._m=p}},{key:"getZ",value:function(){return Xe.NULL_ORDINATE}},{key:"getOrdinate",value:function(p){switch(p){case d.X:return this.x;case d.Y:return this.y;case d.M:return this._m}throw new ve("Invalid ordinate index: "+p)}},{key:"setZ",value:function(p){throw new ve("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new d(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(p){this.x=p.x,this.y=p.y,this.z=p.getZ(),this._m=p.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Xe.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof d){var p=arguments[0];Xe.constructor_.call(this,p.x,p.y),this._m=p._m}else if(arguments[0]instanceof Xe){var b=arguments[0];Xe.constructor_.call(this,b.x,b.y),this._m=this.getM()}}else if(arguments.length===3){var M=arguments[0],F=arguments[1],q=arguments[2];Xe.constructor_.call(this,M,F,Xe.NULL_ORDINATE),this._m=q}}}]),d}(Xe);Cn.X=0,Cn.Y=1,Cn.Z=-1,Cn.M=2;var ii=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(p,b){switch(p){case Xe.X:this.x=b;break;case Xe.Y:this.y=b;break;case Xe.Z:this.z=b;break;case Xe.M:this._m=b;break;default:throw new ve("Invalid ordinate index: "+p)}}},{key:"setM",value:function(p){this._m=p}},{key:"getOrdinate",value:function(p){switch(p){case Xe.X:return this.x;case Xe.Y:return this.y;case Xe.Z:return this.getZ();case Xe.M:return this.getM()}throw new ve("Invalid ordinate index: "+p)}},{key:"copy",value:function(){return new d(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(p){this.x=p.x,this.y=p.y,this.z=p.getZ(),this._m=p.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Xe.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof d){var p=arguments[0];Xe.constructor_.call(this,p),this._m=p._m}else if(arguments[0]instanceof Xe){var b=arguments[0];Xe.constructor_.call(this,b),this._m=this.getM()}}else if(arguments.length===4){var M=arguments[0],F=arguments[1],q=arguments[2],Y=arguments[3];Xe.constructor_.call(this,M,F,q),this._m=Y}}}]),d}(Xe),hi=function(){function I(){n(this,I)}return a(I,null,[{key:"measures",value:function(c){return c instanceof ui?0:c instanceof Cn||c instanceof ii?1:0}},{key:"dimension",value:function(c){return c instanceof ui?2:c instanceof Cn?3:c instanceof ii?4:3}},{key:"create",value:function(){if(arguments.length===1){var c=arguments[0];return I.create(c,0)}if(arguments.length===2){var d=arguments[0],p=arguments[1];return d===2?new ui:d===3&&p===0?new Xe:d===3&&p===1?new Cn:d===4&&p===1?new ii:new Xe}}}]),I}(),Ai=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"getCoordinate",value:function(p){return this.get(p)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&xn(arguments[0],lt)){for(var p=arguments[0],b=arguments[1],M=!1,F=p.iterator();F.hasNext();)this.add(F.next(),b),M=!0;return M}return U(m(d.prototype),"addAll",this).apply(this,arguments)}},{key:"clone",value:function(){for(var p=U(m(d.prototype),"clone",this).call(this),b=0;b<this.size();b++)p.add(b,this.get(b).clone());return p}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(d.coordArrayType);if(arguments.length===1){var p=arguments[0];if(p)return this.toArray(d.coordArrayType);for(var b=this.size(),M=new Array(b).fill(null),F=0;F<b;F++)M[F]=this.get(b-F-1);return M}}},{key:"add",value:function(){if(arguments.length===1){var p=arguments[0];return U(m(d.prototype),"add",this).call(this,p)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var b=arguments[0],M=arguments[1];return this.add(b,M,!0),!0}if(arguments[0]instanceof Xe&&typeof arguments[1]=="boolean"){var F=arguments[0],q=arguments[1];if(!q&&this.size()>=1){var Y=this.get(this.size()-1);if(Y.equals2D(F))return null}U(m(d.prototype),"add",this).call(this,F)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var me=arguments[0],Fe=arguments[1];return this.add(me,Fe),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var $e=arguments[0],mt=arguments[1],zt=arguments[2];if(zt)for(var Nt=0;Nt<$e.length;Nt++)this.add($e[Nt],mt);else for(var gn=$e.length-1;gn>=0;gn--)this.add($e[gn],mt);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Xe){var bn=arguments[0],Pn=arguments[1],ti=arguments[2];if(!ti){var mi=this.size();if(mi>0){if(bn>0){var li=this.get(bn-1);if(li.equals2D(Pn))return null}if(bn<mi){var er=this.get(bn);if(er.equals2D(Pn))return null}}}U(m(d.prototype),"add",this).call(this,bn,Pn)}}else if(arguments.length===4){var rs=arguments[0],Ps=arguments[1],fi=arguments[2],Ar=arguments[3],dr=1;fi>Ar&&(dr=-1);for(var Rs=fi;Rs!==Ar;Rs+=dr)this.add(rs[Rs],Ps);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var p=this.get(0).copy();this.add(p,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var p=arguments[0];this.ensureCapacity(p.length),this.add(p,!0)}else if(arguments.length===2){var b=arguments[0],M=arguments[1];this.ensureCapacity(b.length),this.add(b,M)}}}}]),d}(Tt);Ai.coordArrayType=new Array(0).fill(null);var Xn=function(){function I(){n(this,I)}return a(I,null,[{key:"isRing",value:function(c){return!(c.length<4)&&!!c[0].equals2D(c[c.length-1])}},{key:"ptNotInList",value:function(c,d){for(var p=0;p<c.length;p++){var b=c[p];if(I.indexOf(b,d)<0)return b}return null}},{key:"scroll",value:function(c,d){var p=I.indexOf(d,c);if(p<0)return null;var b=new Array(c.length).fill(null);Mi.arraycopy(c,p,b,0,c.length-p),Mi.arraycopy(c,0,b,c.length-p,p),Mi.arraycopy(b,0,c,0,c.length)}},{key:"equals",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];if(c===d)return!0;if(c===null||d===null||c.length!==d.length)return!1;for(var p=0;p<c.length;p++)if(!c[p].equals(d[p]))return!1;return!0}if(arguments.length===3){var b=arguments[0],M=arguments[1],F=arguments[2];if(b===M)return!0;if(b===null||M===null||b.length!==M.length)return!1;for(var q=0;q<b.length;q++)if(F.compare(b[q],M[q])!==0)return!1;return!0}}},{key:"intersection",value:function(c,d){for(var p=new Ai,b=0;b<c.length;b++)d.intersects(c[b])&&p.add(c[b],!0);return p.toCoordinateArray()}},{key:"measures",value:function(c){if(c===null||c.length===0)return 0;var d,p=0,b=Q(c);try{for(b.s();!(d=b.n()).done;){var M=d.value;p=Math.max(p,hi.measures(M))}}catch(F){b.e(F)}finally{b.f()}return p}},{key:"hasRepeatedPoints",value:function(c){for(var d=1;d<c.length;d++)if(c[d-1].equals(c[d]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(c){return I.hasRepeatedPoints(c)?new Ai(c,!1).toCoordinateArray():c}},{key:"reverse",value:function(c){for(var d=c.length-1,p=Math.trunc(d/2),b=0;b<=p;b++){var M=c[b];c[b]=c[d-b],c[d-b]=M}}},{key:"removeNull",value:function(c){for(var d=0,p=0;p<c.length;p++)c[p]!==null&&d++;var b=new Array(d).fill(null);if(d===0)return b;for(var M=0,F=0;F<c.length;F++)c[F]!==null&&(b[M++]=c[F]);return b}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var c=arguments[0],d=new Array(c.length).fill(null),p=0;p<c.length;p++)d[p]=c[p].copy();return d}if(arguments.length===5)for(var b=arguments[0],M=arguments[1],F=arguments[2],q=arguments[3],Y=arguments[4],me=0;me<Y;me++)F[q+me]=b[M+me].copy()}},{key:"isEqualReversed",value:function(c,d){for(var p=0;p<c.length;p++){var b=c[p],M=d[c.length-p-1];if(b.compareTo(M)!==0)return!1}return!0}},{key:"envelope",value:function(c){for(var d=new dn,p=0;p<c.length;p++)d.expandToInclude(c[p]);return d}},{key:"toCoordinateArray",value:function(c){return c.toArray(I.coordArrayType)}},{key:"dimension",value:function(c){if(c===null||c.length===0)return 3;var d,p=0,b=Q(c);try{for(b.s();!(d=b.n()).done;){var M=d.value;p=Math.max(p,hi.dimension(M))}}catch(F){b.e(F)}finally{b.f()}return p}},{key:"atLeastNCoordinatesOrNothing",value:function(c,d){return d.length>=c?d:[]}},{key:"indexOf",value:function(c,d){for(var p=0;p<d.length;p++)if(c.equals(d[p]))return p;return-1}},{key:"increasingDirection",value:function(c){for(var d=0;d<Math.trunc(c.length/2);d++){var p=c.length-1-d,b=c[d].compareTo(c[p]);if(b!==0)return b}return 1}},{key:"compare",value:function(c,d){for(var p=0;p<c.length&&p<d.length;){var b=c[p].compareTo(d[p]);if(b!==0)return b;p++}return p<d.length?-1:p<c.length?1:0}},{key:"minCoordinate",value:function(c){for(var d=null,p=0;p<c.length;p++)(d===null||d.compareTo(c[p])>0)&&(d=c[p]);return d}},{key:"extract",value:function(c,d,p){d=Er.clamp(d,0,c.length);var b=(p=Er.clamp(p,-1,c.length))-d+1;p<0&&(b=0),d>=c.length&&(b=0),p<d&&(b=0);var M=new Array(b).fill(null);if(b===0)return M;for(var F=0,q=d;q<=p;q++)M[F++]=c[q];return M}}]),I}(),Tr=function(){function I(){n(this,I)}return a(I,[{key:"compare",value:function(c,d){var p=c,b=d;return Xn.compare(p,b)}},{key:"interfaces_",get:function(){return[wt]}}]),I}(),No=function(){function I(){n(this,I)}return a(I,[{key:"compare",value:function(c,d){var p=c,b=d;if(p.length<b.length)return-1;if(p.length>b.length)return 1;if(p.length===0)return 0;var M=Xn.compare(p,b);return Xn.isEqualReversed(p,b)?0:M}},{key:"OLDcompare",value:function(c,d){var p=c,b=d;if(p.length<b.length)return-1;if(p.length>b.length)return 1;if(p.length===0)return 0;for(var M=Xn.increasingDirection(p),F=Xn.increasingDirection(b),q=M>0?0:p.length-1,Y=F>0?0:p.length-1,me=0;me<p.length;me++){var Fe=p[q].compareTo(b[Y]);if(Fe!==0)return Fe;q+=M,Y+=F}return 0}},{key:"interfaces_",get:function(){return[wt]}}]),I}();Xn.ForwardComparator=Tr,Xn.BidirectionalComparator=No,Xn.coordArrayType=new Array(0).fill(null);var Qn=function(){function I(c){n(this,I),this.str=c}return a(I,[{key:"append",value:function(c){this.str+=c}},{key:"setCharAt",value:function(c,d){this.str=this.str.substr(0,c)+d+this.str.substr(c+1)}},{key:"toString",value:function(){return this.str}}]),I}(),bo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getM",value:function(c){return this.hasM()?this._coordinates[c].getM():vt.NaN}},{key:"setOrdinate",value:function(c,d,p){switch(d){case kn.X:this._coordinates[c].x=p;break;case kn.Y:this._coordinates[c].y=p;break;default:this._coordinates[c].setOrdinate(d,p)}}},{key:"getZ",value:function(c){return this.hasZ()?this._coordinates[c].getZ():vt.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(c,d){switch(d){case kn.X:return this._coordinates[c].x;case kn.Y:return this._coordinates[c].y;default:return this._coordinates[c].getOrdinate(d)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var c=arguments[0];return this._coordinates[c]}if(arguments.length===2){var d=arguments[0],p=arguments[1];p.setCoordinate(this._coordinates[d])}}},{key:"getCoordinateCopy",value:function(c){var d=this.createCoordinate();return d.setCoordinate(this._coordinates[c]),d}},{key:"createCoordinate",value:function(){return hi.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(c){return this._coordinates[c].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(c){for(var d=0;d<this._coordinates.length;d++)c.expandToInclude(this._coordinates[d]);return c}},{key:"copy",value:function(){for(var c=new Array(this.size()).fill(null),d=0;d<this._coordinates.length;d++){var p=this.createCoordinate();p.setCoordinate(this._coordinates[d]),c[d]=p}return new I(c,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var c=new Qn(17*this._coordinates.length);c.append("("),c.append(this._coordinates[0]);for(var d=1;d<this._coordinates.length;d++)c.append(", "),c.append(this._coordinates[d]);return c.append(")"),c.toString()}return"()"}},{key:"getY",value:function(c){return this._coordinates[c].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[kn,be]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];I.constructor_.call(this,c,Xn.dimension(c),Xn.measures(c))}else if(Number.isInteger(arguments[0])){var d=arguments[0];this._coordinates=new Array(d).fill(null);for(var p=0;p<d;p++)this._coordinates[p]=new Xe}else if(xn(arguments[0],kn)){var b=arguments[0];if(b===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=b.getDimension(),this._measures=b.getMeasures(),this._coordinates=new Array(b.size()).fill(null);for(var M=0;M<this._coordinates.length;M++)this._coordinates[M]=b.getCoordinateCopy(M)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var F=arguments[0],q=arguments[1];I.constructor_.call(this,F,q,Xn.measures(F))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var Y=arguments[0],me=arguments[1];this._coordinates=new Array(Y).fill(null),this._dimension=me;for(var Fe=0;Fe<Y;Fe++)this._coordinates[Fe]=hi.create(me)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var $e=arguments[0],mt=arguments[1],zt=arguments[2];this._dimension=mt,this._measures=zt,this._coordinates=$e===null?new Array(0).fill(null):$e}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var Nt=arguments[0],gn=arguments[1],bn=arguments[2];this._coordinates=new Array(Nt).fill(null),this._dimension=gn,this._measures=bn;for(var Pn=0;Pn<Nt;Pn++)this._coordinates[Pn]=this.createCoordinate()}}}}]),I}(),aa=function(){function I(){n(this,I)}return a(I,[{key:"readResolve",value:function(){return I.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return new bo(c)}if(xn(arguments[0],kn)){var d=arguments[0];return new bo(d)}}else{if(arguments.length===2){var p=arguments[0],b=arguments[1];return b>3&&(b=3),b<2&&(b=2),new bo(p,b)}if(arguments.length===3){var M=arguments[0],F=arguments[1],q=arguments[2],Y=F-q;return q>1&&(q=1),Y>3&&(Y=3),Y<2&&(Y=2),new bo(M,Y+q,q)}}}},{key:"interfaces_",get:function(){return[Zr,be]}}],[{key:"instance",value:function(){return I.instanceObject}}]),I}();aa.instanceObject=new aa;var Cr=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ft){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&U(m(d.prototype),"equalsExact",this).call(this,p,b)}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return Ft.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var p=new Tt,b=0;b<this._geometries.length;b++)for(var M=this._geometries[b].getBoundary(),F=0;F<M.getNumGeometries();F++)p.add(M.getGeometryN(F));var q=new Array(p.size()).fill(null);return this.getFactory().createMultiLineString(p.toArray(q))}},{key:"getGeometryType",value:function(){return Ft.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Dt]}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];An.constructor_.call(this,p,b)}}]),d}(An),Dr=function(){function I(){n(this,I)}return a(I,[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}]),I}(),yc=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),(p=c.call(this)).map=new Map,p}return a(d,[{key:"get",value:function(p){return this.map.get(p)||null}},{key:"put",value:function(p,b){return this.map.set(p,b),b}},{key:"values",value:function(){for(var p=new Tt,b=this.map.values(),M=b.next();!M.done;)p.add(M.value),M=b.next();return p}},{key:"entrySet",value:function(){var p=new kt;return this.map.entries().forEach(function(b){return p.add(b)}),p}},{key:"size",value:function(){return this.map.size()}}]),d}(Dr),Pi=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"equals",value:function(c){if(!(c instanceof I))return!1;var d=c;return this._modelType===d._modelType&&this._scale===d._scale}},{key:"compareTo",value:function(c){var d=c,p=this.getMaximumSignificantDigits(),b=d.getMaximumSignificantDigits();return Ji.compare(p,b)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===I.FLOATING||this._modelType===I.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var c="UNKNOWN";return this._modelType===I.FLOATING?c="Floating":this._modelType===I.FLOATING_SINGLE?c="Floating-Single":this._modelType===I.FIXED&&(c="Fixed (Scale="+this.getScale()+")"),c}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var c=arguments[0];return vt.isNaN(c)||this._modelType===I.FLOATING_SINGLE?c:this._modelType===I.FIXED?Math.round(c*this._scale)/this._scale:c}if(arguments[0]instanceof Xe){var d=arguments[0];if(this._modelType===I.FLOATING)return null;d.x=this.makePrecise(d.x),d.y=this.makePrecise(d.y)}}},{key:"getMaximumSignificantDigits",value:function(){var c=16;return this._modelType===I.FLOATING?c=16:this._modelType===I.FLOATING_SINGLE?c=6:this._modelType===I.FIXED&&(c=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),c}},{key:"setScale",value:function(c){this._scale=Math.abs(c)}},{key:"interfaces_",get:function(){return[be,he]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=I.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof or){var c=arguments[0];this._modelType=c,c===I.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var d=arguments[0];this._modelType=I.FIXED,this.setScale(d)}else if(arguments[0]instanceof I){var p=arguments[0];this._modelType=p._modelType,this._scale=p._scale}}}},{key:"mostPrecise",value:function(c,d){return c.compareTo(d)>=0?c:d}}]),I}(),or=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"readResolve",value:function(){return I.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[be]}}],[{key:"constructor_",value:function(){this._name=null;var c=arguments[0];this._name=c,I.nameToTypeMap.put(c,this)}}]),I}();or.nameToTypeMap=new yc,Pi.Type=or,Pi.FIXED=new or("FIXED"),Pi.FLOATING=new or("FLOATING"),Pi.FLOATING_SINGLE=new or("FLOATING SINGLE"),Pi.maximumPreciseValue=9007199254740992;var no=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"copyInternal",value:function(){for(var p=new Array(this._geometries.length).fill(null),b=0;b<p.length;b++)p[b]=this._geometries[b].copy();return new d(p,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof Ft){var p=arguments[0],b=arguments[1];return!!this.isEquivalentClass(p)&&U(m(d.prototype),"equalsExact",this).call(this,p,b)}return U(m(d.prototype),"equalsExact",this).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?le.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var p=0;p<this._geometries.length;p++)if(!this._geometries[p].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return Ft.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new Lt}},{key:"getGeometryType",value:function(){return Ft.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[J]}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];An.constructor_.call(this,p,b)}}]),d}(An),Kr=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"createEmpty",value:function(c){switch(c){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new ve("Invalid dimension: "+c)}}},{key:"toGeometry",value:function(c){return c.isNull()?this.createPoint():c.getMinX()===c.getMaxX()&&c.getMinY()===c.getMaxY()?this.createPoint(new Xe(c.getMinX(),c.getMinY())):c.getMinX()===c.getMaxX()||c.getMinY()===c.getMaxY()?this.createLineString([new Xe(c.getMinX(),c.getMinY()),new Xe(c.getMaxX(),c.getMaxY())]):this.createPolygon(this.createLinearRing([new Xe(c.getMinX(),c.getMinY()),new Xe(c.getMinX(),c.getMaxY()),new Xe(c.getMaxX(),c.getMaxY()),new Xe(c.getMaxX(),c.getMinY()),new Xe(c.getMinX(),c.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return this.createLineString(c!==null?this.getCoordinateSequenceFactory().create(c):null)}if(xn(arguments[0],kn)){var d=arguments[0];return new We(d,this)}}}},{key:"createMultiLineString",value:function(){if(arguments.length===0)return new no(null,this);if(arguments.length===1){var c=arguments[0];return new no(c,this)}}},{key:"buildGeometry",value:function(c){for(var d=null,p=!1,b=!1,M=c.iterator();M.hasNext();){var F=M.next(),q=F.getTypeCode();d===null&&(d=q),q!==d&&(p=!0),F instanceof An&&(b=!0)}if(d===null)return this.createGeometryCollection();if(p||b)return this.createGeometryCollection(I.toGeometryArray(c));var Y=c.iterator().next();if(c.size()>1){if(Y instanceof en)return this.createMultiPolygon(I.toPolygonArray(c));if(Y instanceof We)return this.createMultiLineString(I.toLineStringArray(c));if(Y instanceof et)return this.createMultiPoint(I.toPointArray(c));It.shouldNeverReachHere("Unhandled geometry type: "+Y.getGeometryType())}return Y}},{key:"createMultiPointFromCoords",value:function(c){return this.createMultiPoint(c!==null?this.getCoordinateSequenceFactory().create(c):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Xe){var c=arguments[0];return this.createPoint(c!==null?this.getCoordinateSequenceFactory().create([c]):null)}if(xn(arguments[0],kn)){var d=arguments[0];return new et(d,this)}}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(xn(arguments[0],kn)){var c=arguments[0];return this.createPolygon(this.createLinearRing(c))}if(arguments[0]instanceof Array){var d=arguments[0];return this.createPolygon(this.createLinearRing(d))}if(arguments[0]instanceof wi){var p=arguments[0];return this.createPolygon(p,null)}}else if(arguments.length===2){var b=arguments[0],M=arguments[1];return new en(b,M,this)}}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){if(arguments.length===0)return new An(null,this);if(arguments.length===1){var c=arguments[0];return new An(c,this)}}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return this.createLinearRing(c!==null?this.getCoordinateSequenceFactory().create(c):null)}if(xn(arguments[0],kn)){var d=arguments[0];return new wi(d,this)}}}},{key:"createMultiPolygon",value:function(){if(arguments.length===0)return new Cr(null,this);if(arguments.length===1){var c=arguments[0];return new Cr(c,this)}}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new Fn(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];return new Fn(c,this)}if(xn(arguments[0],kn)){var d=arguments[0];if(d===null)return this.createMultiPoint(new Array(0).fill(null));for(var p=new Array(d.size()).fill(null),b=0;b<d.size();b++){var M=this.getCoordinateSequenceFactory().create(1,d.getDimension(),d.getMeasures());ce.copy(d,b,M,0,1),p[b]=this.createPoint(M)}return this.createMultiPoint(p)}}}},{key:"interfaces_",get:function(){return[be]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)I.constructor_.call(this,new Pi,0);else if(arguments.length===1){if(xn(arguments[0],Zr)){var c=arguments[0];I.constructor_.call(this,new Pi,0,c)}else if(arguments[0]instanceof Pi){var d=arguments[0];I.constructor_.call(this,d,0,I.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];I.constructor_.call(this,p,b,I.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var M=arguments[0],F=arguments[1],q=arguments[2];this._precisionModel=M,this._coordinateSequenceFactory=q,this._SRID=F}}},{key:"toMultiPolygonArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toGeometryArray",value:function(c){if(c===null)return null;var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return aa.instance()}},{key:"toMultiLineStringArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toLineStringArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toMultiPointArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toLinearRingArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toPointArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"toPolygonArray",value:function(c){var d=new Array(c.size()).fill(null);return c.toArray(d)}},{key:"createPointFromInternalCoord",value:function(c,d){return d.getPrecisionModel().makePrecise(c),d.getFactory().createPoint(c)}}]),I}(),Ri="XY",la="XYZ",_s="XYM",Fi="XYZM",ua={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},Qr="EMPTY",zo=1,Qi=2,io=3,ca=4,es=5,ro=6;for(var ei in ua)ua[ei].toUpperCase();var Sl=function(){function I(c){n(this,I),this.wkt=c,this.index_=-1}return a(I,[{key:"isAlpha_",value:function(c){return c>="a"&&c<="z"||c>="A"&&c<="Z"}},{key:"isNumeric_",value:function(c,d){return c>="0"&&c<="9"||c=="."&&!(d!==void 0&&d)}},{key:"isWhiteSpace_",value:function(c){return c==" "||c=="	"||c=="\r"||c==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var c,d=this.nextChar_(),p=this.index_,b=d;if(d=="(")c=Qi;else if(d==",")c=es;else if(d==")")c=io;else if(this.isNumeric_(d)||d=="-")c=ca,b=this.readNumber_();else if(this.isAlpha_(d))c=zo,b=this.readText_();else{if(this.isWhiteSpace_(d))return this.nextToken();if(d!=="")throw new Error("Unexpected character: "+d);c=ro}return{position:p,value:b,type:c}}},{key:"readNumber_",value:function(){var c,d=this.index_,p=!1,b=!1;do c=="."?p=!0:c!="e"&&c!="E"||(b=!0),c=this.nextChar_();while(this.isNumeric_(c,p)||!b&&(c=="e"||c=="E")||b&&(c=="-"||c=="+"));return parseFloat(this.wkt.substring(d,this.index_--))}},{key:"readText_",value:function(){var c,d=this.index_;do c=this.nextChar_();while(this.isAlpha_(c));return this.wkt.substring(d,this.index_--).toUpperCase()}}]),I}(),El=function(){function I(c,d){n(this,I),this.lexer_=c,this.token_,this.layout_=Ri,this.factory=d}return a(I,[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(c){return this.token_.type==c}},{key:"match",value:function(c){var d=this.isTokenType(c);return d&&this.consume_(),d}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var c=Ri,d=this.token_;if(this.isTokenType(zo)){var p=d.value;p==="Z"?c=la:p==="M"?c=_s:p==="ZM"&&(c=Fi),c!==Ri&&this.consume_()}return c}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(Qi)){var c=[];do c.push(this.parseGeometry_());while(this.match(es));if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(Qi)){var c=this.parsePoint_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(Qi)){var c=this.parsePointList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(Qi)){var c=this.parseLineStringTextList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var c;if(this.match(Qi)){if(c=this.token_.type==Qi?this.parsePointTextList_():this.parsePointList_(),this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(Qi)){var c=this.parseLineStringTextList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(Qi)){var c=this.parsePolygonTextList_();if(this.match(io))return c}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var c=[],d=this.layout_.length,p=0;p<d;++p){var b=this.token_;if(!this.match(ca))break;c.push(b.value)}if(c.length==d)return c;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var c=[this.parsePoint_()];this.match(es);)c.push(this.parsePoint_());return c}},{key:"parsePointTextList_",value:function(){for(var c=[this.parsePointText_()];this.match(es);)c.push(this.parsePointText_());return c}},{key:"parseLineStringTextList_",value:function(){for(var c=[this.parseLineStringText_()];this.match(es);)c.push(this.parseLineStringText_());return c}},{key:"parsePolygonTextList_",value:function(){for(var c=[this.parsePolygonText_()];this.match(es);)c.push(this.parsePolygonText_());return c}},{key:"isEmptyGeometry_",value:function(){var c=this.isTokenType(zo)&&this.token_.value==Qr;return c&&this.consume_(),c}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var c=this.factory,d=function(bn){return S(Xe,ee(bn))},p=function(bn){var Pn=bn.map(function(ti){return c.createLinearRing(ti.map(d))});return Pn.length>1?c.createPolygon(Pn[0],Pn.slice(1)):c.createPolygon(Pn[0])},b=this.token_;if(this.match(zo)){var M=b.value;if(this.layout_=this.parseGeometryLayout_(),M=="GEOMETRYCOLLECTION"){var F=this.parseGeometryCollectionText_();return c.createGeometryCollection(F)}switch(M){case"POINT":var q=this.parsePointText_();return q?c.createPoint(S(Xe,ee(q))):c.createPoint();case"LINESTRING":var Y=this.parseLineStringText_().map(d);return c.createLineString(Y);case"LINEARRING":var me=this.parseLineStringText_().map(d);return c.createLinearRing(me);case"POLYGON":var Fe=this.parsePolygonText_();return Fe&&Fe.length!==0?p(Fe):c.createPolygon();case"MULTIPOINT":var $e=this.parseMultiPointText_();if(!$e||$e.length===0)return c.createMultiPoint();var mt=$e.map(d).map(function(bn){return c.createPoint(bn)});return c.createMultiPoint(mt);case"MULTILINESTRING":var zt=this.parseMultiLineStringText_().map(function(bn){return c.createLineString(bn.map(d))});return c.createMultiLineString(zt);case"MULTIPOLYGON":var Nt=this.parseMultiPolygonText_();if(!Nt||Nt.length===0)return c.createMultiPolygon();var gn=Nt.map(p);return c.createMultiPolygon(gn);default:throw new Error("Invalid geometry type: "+M)}}throw new Error(this.formatErrorMessage_())}}]),I}();function xo(I){if(I.isEmpty())return"";var c=I.getCoordinate(),d=[c.x,c.y];return c.z===void 0||Number.isNaN(c.z)||d.push(c.z),c.m===void 0||Number.isNaN(c.m)||d.push(c.m),d.join(" ")}function wo(I){for(var c=I.getCoordinates().map(function(M){var F=[M.x,M.y];return M.z===void 0||Number.isNaN(M.z)||F.push(M.z),M.m===void 0||Number.isNaN(M.m)||F.push(M.m),F}),d=[],p=0,b=c.length;p<b;++p)d.push(c[p].join(" "));return d.join(", ")}function ha(I){var c=[];c.push("("+wo(I.getExteriorRing())+")");for(var d=0,p=I.getNumInteriorRing();d<p;++d)c.push("("+wo(I.getInteriorRingN(d))+")");return c.join(", ")}var fa={Point:xo,LineString:wo,LinearRing:wo,Polygon:ha,MultiPoint:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push("("+xo(I.getGeometryN(d))+")");return c.join(", ")},MultiLineString:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push("("+wo(I.getGeometryN(d))+")");return c.join(", ")},MultiPolygon:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push("("+ha(I.getGeometryN(d))+")");return c.join(", ")},GeometryCollection:function(I){for(var c=[],d=0,p=I.getNumGeometries();d<p;++d)c.push(da(I.getGeometryN(d)));return c.join(", ")}};function da(I){var c=I.getGeometryType(),d=fa[c];c=c.toUpperCase();var p=function(b){var M="";if(b.isEmpty())return M;var F=b.getCoordinate();return F.z===void 0||Number.isNaN(F.z)||(M+="Z"),F.m===void 0||Number.isNaN(F.m)||(M+="M"),M}(I);return p.length>0&&(c+=" "+p),I.isEmpty()?c+" "+Qr:c+" ("+d(I)+")"}var Oo=function(){function I(c){n(this,I),this.geometryFactory=c||new Kr,this.precisionModel=this.geometryFactory.getPrecisionModel()}return a(I,[{key:"read",value:function(c){var d=new Sl(c);return new El(d,this.geometryFactory).parse()}},{key:"write",value:function(c){return da(c)}}]),I}(),za=function(){function I(c){n(this,I),this.parser=new Oo(c)}return a(I,[{key:"write",value:function(c){return this.parser.write(c)}}],[{key:"toLineString",value:function(c,d){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+c.x+" "+c.y+", "+d.x+" "+d.y+" )"}}]),I}(),ki=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getIndexAlongSegment",value:function(c,d){return this.computeIntLineIndex(),this._intLineIndex[c][d]}},{key:"getTopologySummary",value:function(){var c=new Qn;return this.isEndPoint()&&c.append(" endpoint"),this._isProper&&c.append(" proper"),this.isCollinear()&&c.append(" collinear"),c.toString()}},{key:"computeIntersection",value:function(c,d,p,b){this._inputLines[0][0]=c,this._inputLines[0][1]=d,this._inputLines[1][0]=p,this._inputLines[1][1]=b,this._result=this.computeIntersect(c,d,p,b)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var c=arguments[0],d=this.getEdgeDistance(c,0),p=this.getEdgeDistance(c,1);d>p?(this._intLineIndex[c][0]=0,this._intLineIndex[c][1]=1):(this._intLineIndex[c][0]=1,this._intLineIndex[c][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(c){this._precisionModel=c}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var c=arguments[0],d=0;d<this._result;d++)if(!this._intPt[d].equals2D(this._inputLines[c][0])&&!this._intPt[d].equals2D(this._inputLines[c][1]))return!0;return!1}}},{key:"getIntersection",value:function(c){return this._intPt[c]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==I.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(c,d){return I.computeEdgeDistance(this._intPt[d],this._inputLines[c][0],this._inputLines[c][1])}},{key:"isCollinear",value:function(){return this._result===I.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return za.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+za.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(c,d){return this._inputLines[c][d]}},{key:"isIntersection",value:function(c){for(var d=0;d<this._result;d++)if(this._intPt[d].equals2D(c))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(c,d){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[c][d]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Xe,this._intPt[1]=new Xe,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(c,d,p){var b=Math.abs(p.x-d.x),M=Math.abs(p.y-d.y),F=-1;if(c.equals(d))F=0;else if(c.equals(p))F=b>M?b:M;else{var q=Math.abs(c.x-d.x),Y=Math.abs(c.y-d.y);(F=b>M?q:Y)!==0||c.equals(d)||(F=Math.max(q,Y))}return It.isTrue(!(F===0&&!c.equals(d)),"Bad distance calculation"),F}},{key:"nonRobustComputeEdgeDistance",value:function(c,d,p){var b=c.x-d.x,M=c.y-d.y,F=Math.sqrt(b*b+M*M);return It.isTrue(!(F===0&&!c.equals(d)),"Invalid distance calculation"),F}}]),I}();ki.DONT_INTERSECT=0,ki.DO_INTERSECT=1,ki.COLLINEAR=2,ki.NO_INTERSECTION=0,ki.POINT_INTERSECTION=1,ki.COLLINEAR_INTERSECTION=2;var so=function(I){f(d,I);var c=B(d);function d(){return n(this,d),c.call(this)}return a(d,[{key:"isInSegmentEnvelopes",value:function(p){var b=new dn(this._inputLines[0][0],this._inputLines[0][1]),M=new dn(this._inputLines[1][0],this._inputLines[1][1]);return b.contains(p)&&M.contains(p)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return U(m(d.prototype),"computeIntersection",this).apply(this,arguments);var p=arguments[0],b=arguments[1],M=arguments[2];if(this._isProper=!1,dn.intersects(b,M,p)&&mn.index(b,M,p)===0&&mn.index(M,b,p)===0)return this._isProper=!0,(p.equals(b)||p.equals(M))&&(this._isProper=!1),this._result=ki.POINT_INTERSECTION,null;this._result=ki.NO_INTERSECTION}},{key:"intersection",value:function(p,b,M,F){var q=this.intersectionSafe(p,b,M,F);return this.isInSegmentEnvelopes(q)||(q=new Xe(d.nearestEndpoint(p,b,M,F))),this._precisionModel!==null&&this._precisionModel.makePrecise(q),q}},{key:"checkDD",value:function(p,b,M,F,q){var Y=gr.intersection(p,b,M,F),me=this.isInSegmentEnvelopes(Y);Mi.out.println("DD in env = "+me+"  --------------------- "+Y),q.distance(Y)>1e-4&&Mi.out.println("Distance = "+q.distance(Y))}},{key:"intersectionSafe",value:function(p,b,M,F){var q=wn.intersection(p,b,M,F);return q===null&&(q=d.nearestEndpoint(p,b,M,F)),q}},{key:"computeCollinearIntersection",value:function(p,b,M,F){var q=dn.intersects(p,b,M),Y=dn.intersects(p,b,F),me=dn.intersects(M,F,p),Fe=dn.intersects(M,F,b);return q&&Y?(this._intPt[0]=M,this._intPt[1]=F,ki.COLLINEAR_INTERSECTION):me&&Fe?(this._intPt[0]=p,this._intPt[1]=b,ki.COLLINEAR_INTERSECTION):q&&me?(this._intPt[0]=M,this._intPt[1]=p,!M.equals(p)||Y||Fe?ki.COLLINEAR_INTERSECTION:ki.POINT_INTERSECTION):q&&Fe?(this._intPt[0]=M,this._intPt[1]=b,!M.equals(b)||Y||me?ki.COLLINEAR_INTERSECTION:ki.POINT_INTERSECTION):Y&&me?(this._intPt[0]=F,this._intPt[1]=p,!F.equals(p)||q||Fe?ki.COLLINEAR_INTERSECTION:ki.POINT_INTERSECTION):Y&&Fe?(this._intPt[0]=F,this._intPt[1]=b,!F.equals(b)||q||me?ki.COLLINEAR_INTERSECTION:ki.POINT_INTERSECTION):ki.NO_INTERSECTION}},{key:"computeIntersect",value:function(p,b,M,F){if(this._isProper=!1,!dn.intersects(p,b,M,F))return ki.NO_INTERSECTION;var q=mn.index(p,b,M),Y=mn.index(p,b,F);if(q>0&&Y>0||q<0&&Y<0)return ki.NO_INTERSECTION;var me=mn.index(M,F,p),Fe=mn.index(M,F,b);return me>0&&Fe>0||me<0&&Fe<0?ki.NO_INTERSECTION:q===0&&Y===0&&me===0&&Fe===0?this.computeCollinearIntersection(p,b,M,F):(q===0||Y===0||me===0||Fe===0?(this._isProper=!1,p.equals2D(M)||p.equals2D(F)?this._intPt[0]=p:b.equals2D(M)||b.equals2D(F)?this._intPt[0]=b:q===0?this._intPt[0]=new Xe(M):Y===0?this._intPt[0]=new Xe(F):me===0?this._intPt[0]=new Xe(p):Fe===0&&(this._intPt[0]=new Xe(b))):(this._isProper=!0,this._intPt[0]=this.intersection(p,b,M,F)),ki.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(p,b,M,F){var q=p,Y=Ki.pointToSegment(p,M,F),me=Ki.pointToSegment(b,M,F);return me<Y&&(Y=me,q=b),(me=Ki.pointToSegment(M,p,b))<Y&&(Y=me,q=M),(me=Ki.pointToSegment(F,p,b))<Y&&(Y=me,q=F),q}}]),d}(ki),vc=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"countSegment",value:function(c,d){if(c.x<this._p.x&&d.x<this._p.x)return null;if(this._p.x===d.x&&this._p.y===d.y)return this._isPointOnSegment=!0,null;if(c.y===this._p.y&&d.y===this._p.y){var p=c.x,b=d.x;return p>b&&(p=d.x,b=c.x),this._p.x>=p&&this._p.x<=b&&(this._isPointOnSegment=!0),null}if(c.y>this._p.y&&d.y<=this._p.y||d.y>this._p.y&&c.y<=this._p.y){var M=mn.index(c,d,this._p);if(M===mn.COLLINEAR)return this._isPointOnSegment=!0,null;d.y<c.y&&(M=-M),M===mn.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==Se.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?Se.BOUNDARY:this._crossingCount%2==1?Se.INTERIOR:Se.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var c=arguments[0];this._p=c}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof Xe&&xn(arguments[1],kn)){for(var c=arguments[0],d=arguments[1],p=new I(c),b=new Xe,M=new Xe,F=1;F<d.size();F++)if(d.getCoordinate(F,b),d.getCoordinate(F-1,M),p.countSegment(b,M),p.isOnSegment())return p.getLocation();return p.getLocation()}if(arguments[0]instanceof Xe&&arguments[1]instanceof Array){for(var q=arguments[0],Y=arguments[1],me=new I(q),Fe=1;Fe<Y.length;Fe++){var $e=Y[Fe],mt=Y[Fe-1];if(me.countSegment($e,mt),me.isOnSegment())return me.getLocation()}return me.getLocation()}}}]),I}(),Vs=function(){function I(){n(this,I)}return a(I,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof Xe&&xn(arguments[1],kn)){for(var c=arguments[0],d=arguments[1],p=new so,b=new Xe,M=new Xe,F=d.size(),q=1;q<F;q++)if(d.getCoordinate(q-1,b),d.getCoordinate(q,M),p.computeIntersection(c,b,M),p.hasIntersection())return!0;return!1}if(arguments[0]instanceof Xe&&arguments[1]instanceof Array){for(var Y=arguments[0],me=arguments[1],Fe=new so,$e=1;$e<me.length;$e++){var mt=me[$e-1],zt=me[$e];if(Fe.computeIntersection(Y,mt,zt),Fe.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(c,d){return vc.locatePointInRing(c,d)}},{key:"isInRing",value:function(c,d){return I.locateInRing(c,d)!==Se.EXTERIOR}}]),I}(),yr=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setAllLocations",value:function(c){for(var d=0;d<this.location.length;d++)this.location[d]=c}},{key:"isNull",value:function(){for(var c=0;c<this.location.length;c++)if(this.location[c]!==Se.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(c){for(var d=0;d<this.location.length;d++)this.location[d]===Se.NONE&&(this.location[d]=c)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(c){if(c.location.length>this.location.length){var d=new Array(3).fill(null);d[Ee.ON]=this.location[Ee.ON],d[Ee.LEFT]=Se.NONE,d[Ee.RIGHT]=Se.NONE,this.location=d}for(var p=0;p<this.location.length;p++)this.location[p]===Se.NONE&&p<c.location.length&&(this.location[p]=c.location[p])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var c=this.location[Ee.LEFT];this.location[Ee.LEFT]=this.location[Ee.RIGHT],this.location[Ee.RIGHT]=c}},{key:"toString",value:function(){var c=new qi;return this.location.length>1&&c.append(Se.toLocationSymbol(this.location[Ee.LEFT])),c.append(Se.toLocationSymbol(this.location[Ee.ON])),this.location.length>1&&c.append(Se.toLocationSymbol(this.location[Ee.RIGHT])),c.toString()}},{key:"setLocations",value:function(c,d,p){this.location[Ee.ON]=c,this.location[Ee.LEFT]=d,this.location[Ee.RIGHT]=p}},{key:"get",value:function(c){return c<this.location.length?this.location[c]:Se.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var c=0;c<this.location.length;c++)if(this.location[c]===Se.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var c=arguments[0];this.setLocation(Ee.ON,c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.location[d]=p}}},{key:"init",value:function(c){this.location=new Array(c).fill(null),this.setAllLocations(Se.NONE)}},{key:"isEqualOnSide",value:function(c,d){return this.location[d]===c.location[d]}},{key:"allPositionsEqual",value:function(c){for(var d=0;d<this.location.length;d++)if(this.location[d]!==c)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var c=arguments[0];this.init(c.length)}else if(Number.isInteger(arguments[0])){var d=arguments[0];this.init(1),this.location[Ee.ON]=d}else if(arguments[0]instanceof I){var p=arguments[0];if(this.init(p.location.length),p!==null)for(var b=0;b<this.location.length;b++)this.location[b]=p.location[b]}}else if(arguments.length===3){var M=arguments[0],F=arguments[1],q=arguments[2];this.init(3),this.location[Ee.ON]=M,this.location[Ee.LEFT]=F,this.location[Ee.RIGHT]=q}}}]),I}(),bi=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getGeometryCount",value:function(){var c=0;return this.elt[0].isNull()||c++,this.elt[1].isNull()||c++,c}},{key:"setAllLocations",value:function(c,d){this.elt[c].setAllLocations(d)}},{key:"isNull",value:function(c){return this.elt[c].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var c=arguments[0];this.setAllLocationsIfNull(0,c),this.setAllLocationsIfNull(1,c)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.elt[d].setAllLocationsIfNull(p)}}},{key:"isLine",value:function(c){return this.elt[c].isLine()}},{key:"merge",value:function(c){for(var d=0;d<2;d++)this.elt[d]===null&&c.elt[d]!==null?this.elt[d]=new yr(c.elt[d]):this.elt[d].merge(c.elt[d])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var c=arguments[0];return this.elt[c].get(Ee.ON)}if(arguments.length===2){var d=arguments[0],p=arguments[1];return this.elt[d].get(p)}}},{key:"toString",value:function(){var c=new qi;return this.elt[0]!==null&&(c.append("A:"),c.append(this.elt[0].toString())),this.elt[1]!==null&&(c.append(" B:"),c.append(this.elt[1].toString())),c.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var c=arguments[0];return this.elt[c].isArea()}}},{key:"isAnyNull",value:function(c){return this.elt[c].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];this.elt[c].setLocation(Ee.ON,d)}else if(arguments.length===3){var p=arguments[0],b=arguments[1],M=arguments[2];this.elt[p].setLocation(b,M)}}},{key:"isEqualOnSide",value:function(c,d){return this.elt[0].isEqualOnSide(c.elt[0],d)&&this.elt[1].isEqualOnSide(c.elt[1],d)}},{key:"allPositionsEqual",value:function(c,d){return this.elt[c].allPositionsEqual(d)}},{key:"toLine",value:function(c){this.elt[c].isArea()&&(this.elt[c]=new yr(this.elt[c].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var c=arguments[0];this.elt[0]=new yr(c),this.elt[1]=new yr(c)}else if(arguments[0]instanceof I){var d=arguments[0];this.elt[0]=new yr(d.elt[0]),this.elt[1]=new yr(d.elt[1])}}else if(arguments.length===2){var p=arguments[0],b=arguments[1];this.elt[0]=new yr(Se.NONE),this.elt[1]=new yr(Se.NONE),this.elt[p].setLocation(b)}else if(arguments.length===3){var M=arguments[0],F=arguments[1],q=arguments[2];this.elt[0]=new yr(M,F,q),this.elt[1]=new yr(M,F,q)}else if(arguments.length===4){var Y=arguments[0],me=arguments[1],Fe=arguments[2],$e=arguments[3];this.elt[0]=new yr(Se.NONE,Se.NONE,Se.NONE),this.elt[1]=new yr(Se.NONE,Se.NONE,Se.NONE),this.elt[Y].setLocations(me,Fe,$e)}}},{key:"toLineLabel",value:function(c){for(var d=new I(Se.NONE),p=0;p<2;p++)d.setLocation(p,c.getLocation(p));return d}}]),I}(),cr=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var c=new Array(this._pts.size()).fill(null),d=0;d<this._pts.size();d++)c[d]=this._pts.get(d);this._ring=this._geometryFactory.createLinearRing(c),this._isHole=mn.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(c){this._startDe=c;var d=c,p=!0;do{if(d===null)throw new At("Found null DirectedEdge");if(d.getEdgeRing()===this)throw new At("Directed Edge visited twice during ring-building at "+d.getCoordinate());this._edges.add(d);var b=d.getLabel();It.isTrue(b.isArea()),this.mergeLabel(b),this.addPoints(d.getEdge(),d.isForward(),p),p=!1,this.setEdgeRing(d,this),d=this.getNext(d)}while(d!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(c){return this._pts.get(c)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var c=this._startDe;do{var d=c.getNode().getEdges().getOutgoingDegree(this);d>this._maxNodeDegree&&(this._maxNodeDegree=d),c=this.getNext(c)}while(c!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(c,d,p){var b=c.getCoordinates();if(d){var M=1;p&&(M=0);for(var F=M;F<b.length;F++)this._pts.add(b[F])}else{var q=b.length-2;p&&(q=b.length-1);for(var Y=q;Y>=0;Y--)this._pts.add(b[Y])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var c=this._startDe;do c.getEdge().setInResult(!0),c=c.getNext();while(c!==this._startDe)}},{key:"containsPoint",value:function(c){var d=this.getLinearRing();if(!d.getEnvelopeInternal().contains(c)||!Vs.isInRing(c,d.getCoordinates()))return!1;for(var p=this._holes.iterator();p.hasNext();)if(p.next().containsPoint(c))return!1;return!0}},{key:"addHole",value:function(c){this._holes.add(c)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var c=arguments[0];this.mergeLabel(c,0),this.mergeLabel(c,1)}else if(arguments.length===2){var d=arguments[0],p=arguments[1],b=d.getLocation(p,Ee.RIGHT);if(b===Se.NONE)return null;if(this._label.getLocation(p)===Se.NONE)return this._label.setLocation(p,b),null}}},{key:"setShell",value:function(c){this._shell=c,c!==null&&c.addHole(this)}},{key:"toPolygon",value:function(c){for(var d=new Array(this._holes.size()).fill(null),p=0;p<this._holes.size();p++)d[p]=this._holes.get(p).getLinearRing();return c.createPolygon(this.getLinearRing(),d)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new Tt,this._pts=new Tt,this._label=new bi(Se.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Tt,this._geometryFactory=null,arguments.length!==0&&arguments.length===2){var c=arguments[0],d=arguments[1];this._geometryFactory=d,this.computePoints(c),this.computeRing()}}}]),I}(),Oa=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"setEdgeRing",value:function(p,b){p.setMinEdgeRing(b)}},{key:"getNext",value:function(p){return p.getNextMin()}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];cr.constructor_.call(this,p,b)}}]),d}(cr),Fa=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"buildMinimalRings",value:function(){var p=new Tt,b=this._startDe;do{if(b.getMinEdgeRing()===null){var M=new Oa(b,this._geometryFactory);p.add(M)}b=b.getNext()}while(b!==this._startDe);return p}},{key:"setEdgeRing",value:function(p,b){p.setEdgeRing(b)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var p=this._startDe;do p.getNode().getEdges().linkMinimalDirectedEdges(this),p=p.getNext();while(p!==this._startDe)}},{key:"getNext",value:function(p){return p.getNext()}}],[{key:"constructor_",value:function(){var p=arguments[0],b=arguments[1];cr.constructor_.call(this,p,b)}}]),d}(cr),pa=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setVisited",value:function(c){this._isVisited=c}},{key:"setInResult",value:function(c){this._isInResult=c}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(c){this._label=c}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(c){this._isCovered=c,this._isCoveredSet=!0}},{key:"updateIM",value:function(c){It.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(c)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var c=arguments[0];this._label=c}}}]),I}(),ma=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"isIncidentEdgeInResult",value:function(){for(var p=this.getEdges().getEdges().iterator();p.hasNext();)if(p.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(p){p.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(p){}},{key:"computeMergedLocation",value:function(p,b){var M=Se.NONE;if(M=this._label.getLocation(b),!p.isNull(b)){var F=p.getLocation(b);M!==Se.BOUNDARY&&(M=F)}return M}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return U(m(d.prototype),"setLabel",this).apply(this,arguments);var p=arguments[0],b=arguments[1];this._label===null?this._label=new bi(p,b):this._label.setLocation(p,b)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof d){var p=arguments[0];this.mergeLabel(p._label)}else if(arguments[0]instanceof bi)for(var b=arguments[0],M=0;M<2;M++){var F=this.computeMergedLocation(b,M),q=this._label.getLocation(M);q===Se.NONE&&this._label.setLocation(M,F)}}},{key:"add",value:function(p){this._edges.insert(p),p.setNode(this)}},{key:"setLabelBoundary",value:function(p){if(this._label===null)return null;var b=Se.NONE;this._label!==null&&(b=this._label.getLocation(p));var M=null;switch(b){case Se.BOUNDARY:M=Se.INTERIOR;break;case Se.INTERIOR:default:M=Se.BOUNDARY}this._label.setLocation(p,M)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var p=arguments[0],b=arguments[1];this._coord=p,this._edges=b,this._label=new bi(0,Se.NONE)}}]),d}(pa),Fo=function(I){f(d,I);var c=B(d);function d(){return n(this,d),c.apply(this,arguments)}return d}(Dr);function ou(I){return I==null?0:I.color}function ri(I){return I==null?null:I.parent}function ys(I,c){I!==null&&(I.color=c)}function Tl(I){return I==null?null:I.left}function au(I){return I==null?null:I.right}var Bo=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),(p=c.call(this)).root_=null,p.size_=0,p}return a(d,[{key:"get",value:function(p){for(var b=this.root_;b!==null;){var M=p.compareTo(b.key);if(M<0)b=b.left;else{if(!(M>0))return b.value;b=b.right}}return null}},{key:"put",value:function(p,b){if(this.root_===null)return this.root_={key:p,value:b,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var M,F,q=this.root_;do if(M=q,(F=p.compareTo(q.key))<0)q=q.left;else{if(!(F>0)){var Y=q.value;return q.value=b,Y}q=q.right}while(q!==null);var me={key:p,left:null,right:null,value:b,parent:M,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return F<0?M.left=me:M.right=me,this.fixAfterInsertion(me),this.size_++,null}},{key:"fixAfterInsertion",value:function(p){var b;for(p.color=1;p!=null&&p!==this.root_&&p.parent.color===1;)ri(p)===Tl(ri(ri(p)))?ou(b=au(ri(ri(p))))===1?(ys(ri(p),0),ys(b,0),ys(ri(ri(p)),1),p=ri(ri(p))):(p===au(ri(p))&&(p=ri(p),this.rotateLeft(p)),ys(ri(p),0),ys(ri(ri(p)),1),this.rotateRight(ri(ri(p)))):ou(b=Tl(ri(ri(p))))===1?(ys(ri(p),0),ys(b,0),ys(ri(ri(p)),1),p=ri(ri(p))):(p===Tl(ri(p))&&(p=ri(p),this.rotateRight(p)),ys(ri(p),0),ys(ri(ri(p)),1),this.rotateLeft(ri(ri(p))));this.root_.color=0}},{key:"values",value:function(){var p=new Tt,b=this.getFirstEntry();if(b!==null)for(p.add(b.value);(b=d.successor(b))!==null;)p.add(b.value);return p}},{key:"entrySet",value:function(){var p=new kt,b=this.getFirstEntry();if(b!==null)for(p.add(b);(b=d.successor(b))!==null;)p.add(b);return p}},{key:"rotateLeft",value:function(p){if(p!=null){var b=p.right;p.right=b.left,b.left!=null&&(b.left.parent=p),b.parent=p.parent,p.parent==null?this.root_=b:p.parent.left===p?p.parent.left=b:p.parent.right=b,b.left=p,p.parent=b}}},{key:"rotateRight",value:function(p){if(p!=null){var b=p.left;p.left=b.right,b.right!=null&&(b.right.parent=p),b.parent=p.parent,p.parent==null?this.root_=b:p.parent.right===p?p.parent.right=b:p.parent.left=b,b.right=p,p.parent=b}}},{key:"getFirstEntry",value:function(){var p=this.root_;if(p!=null)for(;p.left!=null;)p=p.left;return p}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(p){for(var b=this.root_;b!==null;){var M=p.compareTo(b.key);if(M<0)b=b.left;else{if(!(M>0))return!0;b=b.right}}return!1}}],[{key:"successor",value:function(p){var b;if(p===null)return null;if(p.right!==null){for(b=p.right;b.left!==null;)b=b.left;return b}b=p.parent;for(var M=p;b!==null&&M===b.right;)M=b,b=b.parent;return b}}]),d}(Fo),Uo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"find",value:function(c){return this.nodeMap.get(c)}},{key:"addNode",value:function(){if(arguments[0]instanceof Xe){var c=arguments[0],d=this.nodeMap.get(c);return d===null&&(d=this.nodeFact.createNode(c),this.nodeMap.put(c,d)),d}if(arguments[0]instanceof ma){var p=arguments[0],b=this.nodeMap.get(p.getCoordinate());return b===null?(this.nodeMap.put(p.getCoordinate(),p),p):(b.mergeLabel(p),b)}}},{key:"print",value:function(c){for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(c){for(var d=new Tt,p=this.iterator();p.hasNext();){var b=p.next();b.getLabel().getLocation(c)===Se.BOUNDARY&&d.add(b)}return d}},{key:"add",value:function(c){var d=c.getCoordinate();this.addNode(d).add(c)}}],[{key:"constructor_",value:function(){this.nodeMap=new Bo,this.nodeFact=null;var c=arguments[0];this.nodeFact=c}}]),I}(),hr=function(){function I(){n(this,I)}return a(I,null,[{key:"isNorthern",value:function(c){return c===I.NE||c===I.NW}},{key:"isOpposite",value:function(c,d){return c!==d&&(c-d+4)%4===2}},{key:"commonHalfPlane",value:function(c,d){if(c===d)return c;if((c-d+4)%4===2)return-1;var p=c<d?c:d;return p===0&&(c>d?c:d)===3?3:p}},{key:"isInHalfPlane",value:function(c,d){return d===I.SE?c===I.SE||c===I.SW:c===d||c===d+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1];if(c===0&&d===0)throw new ve("Cannot compute the quadrant for point ( "+c+", "+d+" )");return c>=0?d>=0?I.NE:I.SE:d>=0?I.NW:I.SW}if(arguments[0]instanceof Xe&&arguments[1]instanceof Xe){var p=arguments[0],b=arguments[1];if(b.x===p.x&&b.y===p.y)throw new ve("Cannot compute the quadrant for two identical points "+p);return b.x>=p.x?b.y>=p.y?I.NE:I.SE:b.y>=p.y?I.NW:I.SW}}}]),I}();hr.NE=0,hr.NW=1,hr.SW=2,hr.SE=3;var ga=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compareDirection",value:function(c){return this._dx===c._dx&&this._dy===c._dy?0:this._quadrant>c._quadrant?1:this._quadrant<c._quadrant?-1:mn.index(c._p0,c._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(c){this._node=c}},{key:"print",value:function(c){var d=Math.atan2(this._dy,this._dx),p=this.getClass().getName(),b=p.lastIndexOf("."),M=p.substring(b+1);c.print("  "+M+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+d+"   "+this._label)}},{key:"compareTo",value:function(c){var d=c;return this.compareDirection(d)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var c=Math.atan2(this._dy,this._dx),d=this.getClass().getName(),p=d.lastIndexOf(".");return"  "+d.substring(p+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+c+"   "+this._label}},{key:"computeLabel",value:function(c){}},{key:"init",value:function(c,d){this._p0=c,this._p1=d,this._dx=d.x-c.x,this._dy=d.y-c.y,this._quadrant=hr.quadrant(this._dx,this._dy),It.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[he]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var c=arguments[0];this._edge=c}else if(arguments.length===3){var d=arguments[0],p=arguments[1],b=arguments[2];I.constructor_.call(this,d,p,b,null)}else if(arguments.length===4){var M=arguments[0],F=arguments[1],q=arguments[2],Y=arguments[3];I.constructor_.call(this,M),this.init(F,q),this._label=Y}}}]),I}(),_a=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(p){return this._depth[p]}},{key:"setVisited",value:function(p){this._isVisited=p}},{key:"computeDirectedLabel",value:function(){this._label=new bi(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(p,b){if(this._depth[p]!==-999&&this._depth[p]!==b)throw new At("assigned depths do not match",this.getCoordinate());this._depth[p]=b}},{key:"isInteriorAreaEdge",value:function(){for(var p=!0,b=0;b<2;b++)this._label.isArea(b)&&this._label.getLocation(b,Ee.LEFT)===Se.INTERIOR&&this._label.getLocation(b,Ee.RIGHT)===Se.INTERIOR||(p=!1);return p}},{key:"setNextMin",value:function(p){this._nextMin=p}},{key:"print",value:function(p){U(m(d.prototype),"print",this).call(this,p),p.print(" "+this._depth[Ee.LEFT]+"/"+this._depth[Ee.RIGHT]),p.print(" ("+this.getDepthDelta()+")"),this._isInResult&&p.print(" inResult")}},{key:"setMinEdgeRing",value:function(p){this._minEdgeRing=p}},{key:"isLineEdge",value:function(){var p=this._label.isLine(0)||this._label.isLine(1),b=!this._label.isArea(0)||this._label.allPositionsEqual(0,Se.EXTERIOR),M=!this._label.isArea(1)||this._label.allPositionsEqual(1,Se.EXTERIOR);return p&&b&&M}},{key:"setEdgeRing",value:function(p){this._edgeRing=p}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var p=this._edge.getDepthDelta();return this._isForward||(p=-p),p}},{key:"setInResult",value:function(p){this._isInResult=p}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(p){this.print(p),p.print(" "),this._isForward?this._edge.print(p):this._edge.printReverse(p)}},{key:"setSym",value:function(p){this._sym=p}},{key:"setVisitedEdge",value:function(p){this.setVisited(p),this._sym.setVisited(p)}},{key:"setEdgeDepths",value:function(p,b){var M=this.getEdge().getDepthDelta();this._isForward||(M=-M);var F=1;p===Ee.LEFT&&(F=-1);var q=Ee.opposite(p),Y=b+M*F;this.setDepth(p,b),this.setDepth(q,Y)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(p){this._next=p}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var p=arguments[0],b=arguments[1];if(ga.constructor_.call(this,p),this._isForward=b,b)this.init(p.getCoordinate(0),p.getCoordinate(1));else{var M=p.getNumPoints()-1;this.init(p.getCoordinate(M),p.getCoordinate(M-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(p,b){return p===Se.EXTERIOR&&b===Se.INTERIOR?1:p===Se.INTERIOR&&b===Se.EXTERIOR?-1:0}}]),d}(ga),Ba=function(){function I(){n(this,I)}return a(I,[{key:"createNode",value:function(c){return new ma(c,null)}}]),I}(),vs=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"printEdges",value:function(c){c.println("Edges:");for(var d=0;d<this._edges.size();d++){c.println("edge "+d+":");var p=this._edges.get(d);p.print(c),p.eiList.print(c)}}},{key:"find",value:function(c){return this._nodes.find(c)}},{key:"addNode",value:function(){if(arguments[0]instanceof ma){var c=arguments[0];return this._nodes.addNode(c)}if(arguments[0]instanceof Xe){var d=arguments[0];return this._nodes.addNode(d)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var c=this._nodes.iterator();c.hasNext();)c.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(c){Mi.out.println(c)}},{key:"isBoundaryNode",value:function(c,d){var p=this._nodes.find(d);if(p===null)return!1;var b=p.getLabel();return b!==null&&b.getLocation(c)===Se.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var c=this._nodes.iterator();c.hasNext();)c.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(c,d,p,b){return!!c.equals(p)&&mn.index(c,d,b)===mn.COLLINEAR&&hr.quadrant(c,d)===hr.quadrant(p,b)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(c){Mi.out.print(c)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(c,d){for(var p=0;p<this._edges.size();p++){var b=this._edges.get(p),M=b.getCoordinates();if(this.matchInSameDirection(c,d,M[0],M[1])||this.matchInSameDirection(c,d,M[M.length-1],M[M.length-2]))return b}return null}},{key:"insertEdge",value:function(c){this._edges.add(c)}},{key:"findEdgeEnd",value:function(c){for(var d=this.getEdgeEnds().iterator();d.hasNext();){var p=d.next();if(p.getEdge()===c)return p}return null}},{key:"addEdges",value:function(c){for(var d=c.iterator();d.hasNext();){var p=d.next();this._edges.add(p);var b=new _a(p,!0),M=new _a(p,!1);b.setSym(M),M.setSym(b),this.add(b),this.add(M)}}},{key:"add",value:function(c){this._nodes.add(c),this._edgeEndList.add(c)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(c,d){for(var p=0;p<this._edges.size();p++){var b=this._edges.get(p),M=b.getCoordinates();if(c.equals(M[0])&&d.equals(M[1]))return b}return null}}],[{key:"constructor_",value:function(){if(this._edges=new Tt,this._nodes=null,this._edgeEndList=new Tt,arguments.length===0)this._nodes=new Uo(new Ba);else if(arguments.length===1){var c=arguments[0];this._nodes=new Uo(c)}}},{key:"linkResultDirectedEdges",value:function(c){for(var d=c.iterator();d.hasNext();)d.next().getEdges().linkResultDirectedEdges()}}]),I}(),bc=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"sortShellsAndHoles",value:function(c,d,p){for(var b=c.iterator();b.hasNext();){var M=b.next();M.isHole()?p.add(M):d.add(M)}}},{key:"computePolygons",value:function(c){for(var d=new Tt,p=c.iterator();p.hasNext();){var b=p.next().toPolygon(this._geometryFactory);d.add(b)}return d}},{key:"placeFreeHoles",value:function(c,d){for(var p=d.iterator();p.hasNext();){var b=p.next();if(b.getShell()===null){var M=I.findEdgeRingContaining(b,c);if(M===null)throw new At("unable to assign hole to a shell",b.getCoordinate(0));b.setShell(M)}}}},{key:"buildMinimalEdgeRings",value:function(c,d,p){for(var b=new Tt,M=c.iterator();M.hasNext();){var F=M.next();if(F.getMaxNodeDegree()>2){F.linkDirectedEdgesForMinimalEdgeRings();var q=F.buildMinimalRings(),Y=this.findShell(q);Y!==null?(this.placePolygonHoles(Y,q),d.add(Y)):p.addAll(q)}else b.add(F)}return b}},{key:"buildMaximalEdgeRings",value:function(c){for(var d=new Tt,p=c.iterator();p.hasNext();){var b=p.next();if(b.isInResult()&&b.getLabel().isArea()&&b.getEdgeRing()===null){var M=new Fa(b,this._geometryFactory);d.add(M),M.setInResult()}}return d}},{key:"placePolygonHoles",value:function(c,d){for(var p=d.iterator();p.hasNext();){var b=p.next();b.isHole()&&b.setShell(c)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(c){for(var d=0,p=null,b=c.iterator();b.hasNext();){var M=b.next();M.isHole()||(p=M,d++)}return It.isTrue(d<=1,"found two shells in MinimalEdgeRing list"),p}},{key:"add",value:function(){if(arguments.length===1){var c=arguments[0];this.add(c.getEdgeEnds(),c.getNodes())}else if(arguments.length===2){var d=arguments[0],p=arguments[1];vs.linkResultDirectedEdges(p);var b=this.buildMaximalEdgeRings(d),M=new Tt,F=this.buildMinimalEdgeRings(b,this._shellList,M);this.sortShellsAndHoles(F,this._shellList,M),this.placeFreeHoles(this._shellList,M)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new Tt;var c=arguments[0];this._geometryFactory=c}},{key:"findEdgeRingContaining",value:function(c,d){for(var p=c.getLinearRing(),b=p.getEnvelopeInternal(),M=p.getCoordinateN(0),F=null,q=null,Y=d.iterator();Y.hasNext();){var me=Y.next(),Fe=me.getLinearRing(),$e=Fe.getEnvelopeInternal();if(!$e.equals(b)&&$e.contains(b)){M=Xn.ptNotInList(p.getCoordinates(),Fe.getCoordinates());var mt=!1;Vs.isInRing(M,Fe.getCoordinates())&&(mt=!0),mt&&(F===null||q.contains($e))&&(q=(F=me).getLinearRing().getEnvelopeInternal())}}return F}}]),I}(),Ua=function(){function I(){n(this,I)}return a(I,[{key:"getBounds",value:function(){}}]),I}(),Lr=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[Ua,be]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var c=arguments[0],d=arguments[1];this._bounds=c,this._item=d}}]),I}(),bs=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"poll",value:function(){if(this.isEmpty())return null;var c=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),c}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(c){for(var d=null,p=this._items.get(c);2*c<=this._size&&((d=2*c)!==this._size&&this._items.get(d+1).compareTo(this._items.get(d))<0&&d++,this._items.get(d).compareTo(p)<0);c=d)this._items.set(c,this._items.get(d));this._items.set(c,p)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(c){this._items.add(null),this._size+=1;var d=this._size;for(this._items.set(0,c);c.compareTo(this._items.get(Math.trunc(d/2)))<0;d/=2)this._items.set(d,this._items.get(Math.trunc(d/2)));this._items.set(d,c)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new Tt,this._items.add(null)}}]),I}(),si=function(){function I(){n(this,I)}return a(I,[{key:"insert",value:function(c,d){}},{key:"remove",value:function(c,d){}},{key:"query",value:function(){}}]),I}(),Mr=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(c){It.isTrue(this._bounds===null),this._childBoundables.add(c)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[Ua,be]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new Tt,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var c=arguments[0];this._level=c}}}]),I}(),jo={reverseOrder:function(){return{compare:function(I,c){return c.compareTo(I)}}},min:function(I){return jo.sort(I),I.get(0)},sort:function(I,c){var d=I.toArray();c?at.sort(d,c):at.sort(d);for(var p=I.iterator(),b=0,M=d.length;b<M;b++)p.next(),p.set(d[b])},singletonList:function(I){var c=new Tt;return c.add(I),c}},Vo=function(){function I(){n(this,I)}return a(I,null,[{key:"maxDistance",value:function(c,d,p,b,M,F,q,Y){var me=I.distance(c,d,M,F);return me=Math.max(me,I.distance(c,d,q,Y)),me=Math.max(me,I.distance(p,b,M,F)),me=Math.max(me,I.distance(p,b,q,Y))}},{key:"distance",value:function(c,d,p,b){var M=p-c,F=b-d;return Math.sqrt(M*M+F*F)}},{key:"maximumDistance",value:function(c,d){var p=Math.min(c.getMinX(),d.getMinX()),b=Math.min(c.getMinY(),d.getMinY()),M=Math.max(c.getMaxX(),d.getMaxX()),F=Math.max(c.getMaxY(),d.getMaxY());return I.distance(p,b,M,F)}},{key:"minMaxDistance",value:function(c,d){var p=c.getMinX(),b=c.getMinY(),M=c.getMaxX(),F=c.getMaxY(),q=d.getMinX(),Y=d.getMinY(),me=d.getMaxX(),Fe=d.getMaxY(),$e=I.maxDistance(p,b,p,F,q,Y,q,Fe);return $e=Math.min($e,I.maxDistance(p,b,p,F,q,Y,me,Y)),$e=Math.min($e,I.maxDistance(p,b,p,F,me,Fe,q,Fe)),$e=Math.min($e,I.maxDistance(p,b,p,F,me,Fe,me,Y)),$e=Math.min($e,I.maxDistance(p,b,M,b,q,Y,q,Fe)),$e=Math.min($e,I.maxDistance(p,b,M,b,q,Y,me,Y)),$e=Math.min($e,I.maxDistance(p,b,M,b,me,Fe,q,Fe)),$e=Math.min($e,I.maxDistance(p,b,M,b,me,Fe,me,Y)),$e=Math.min($e,I.maxDistance(M,F,p,F,q,Y,q,Fe)),$e=Math.min($e,I.maxDistance(M,F,p,F,q,Y,me,Y)),$e=Math.min($e,I.maxDistance(M,F,p,F,me,Fe,q,Fe)),$e=Math.min($e,I.maxDistance(M,F,p,F,me,Fe,me,Y)),$e=Math.min($e,I.maxDistance(M,F,M,b,q,Y,q,Fe)),$e=Math.min($e,I.maxDistance(M,F,M,b,q,Y,me,Y)),$e=Math.min($e,I.maxDistance(M,F,M,b,me,Fe,q,Fe)),$e=Math.min($e,I.maxDistance(M,F,M,b,me,Fe,me,Y))}}]),I}(),qo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"maximumDistance",value:function(){return Vo.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(c,d){var p=I.isComposite(this._boundable1),b=I.isComposite(this._boundable2);if(p&&b)return I.area(this._boundable1)>I.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,c,d),null):(this.expand(this._boundable2,this._boundable1,!0,c,d),null);if(p)return this.expand(this._boundable1,this._boundable2,!1,c,d),null;if(b)return this.expand(this._boundable2,this._boundable1,!0,c,d),null;throw new ve("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(I.isComposite(this._boundable1)||I.isComposite(this._boundable2))}},{key:"compareTo",value:function(c){var d=c;return this._distance<d._distance?-1:this._distance>d._distance?1:0}},{key:"expand",value:function(c,d,p,b,M){for(var F=c.getChildBoundables().iterator();F.hasNext();){var q=F.next(),Y=null;(Y=p?new I(d,q,this._itemDistance):new I(q,d,this._itemDistance)).getDistance()<M&&b.add(Y)}}},{key:"getBoundable",value:function(c){return c===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[he]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var c=arguments[0],d=arguments[1],p=arguments[2];this._boundable1=c,this._boundable2=d,this._itemDistance=p,this._distance=this.distance()}},{key:"area",value:function(c){return c.getBounds().getArea()}},{key:"isComposite",value:function(c){return c instanceof Mr}}]),I}(),Cl=function(){function I(){n(this,I)}return a(I,[{key:"visitItem",value:function(c){}}]),I}(),Go=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"queryInternal",value:function(){if(xn(arguments[2],Cl)&&arguments[0]instanceof Object&&arguments[1]instanceof Mr)for(var c=arguments[0],d=arguments[1],p=arguments[2],b=d.getChildBoundables(),M=0;M<b.size();M++){var F=b.get(M);this.getIntersectsOp().intersects(F.getBounds(),c)&&(F instanceof Mr?this.queryInternal(c,F,p):F instanceof Lr?p.visitItem(F.getItem()):It.shouldNeverReachHere())}else if(xn(arguments[2],Kn)&&arguments[0]instanceof Object&&arguments[1]instanceof Mr)for(var q=arguments[0],Y=arguments[1],me=arguments[2],Fe=Y.getChildBoundables(),$e=0;$e<Fe.size();$e++){var mt=Fe.get($e);this.getIntersectsOp().intersects(mt.getBounds(),q)&&(mt instanceof Mr?this.queryInternal(q,mt,me):mt instanceof Lr?me.add(mt.getItem()):It.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(c){return c.get(c.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var c=arguments[0],d=0,p=c.getChildBoundables().iterator();p.hasNext();){var b=p.next();b instanceof Mr?d+=this.size(b):b instanceof Lr&&(d+=1)}return d}}},{key:"removeItem",value:function(c,d){for(var p=null,b=c.getChildBoundables().iterator();b.hasNext();){var M=b.next();M instanceof Lr&&M.getItem()===d&&(p=M)}return p!==null&&(c.getChildBoundables().remove(p),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var c=this.itemsTree(this._root);return c===null?new Tt:c}if(arguments.length===1){for(var d=arguments[0],p=new Tt,b=d.getChildBoundables().iterator();b.hasNext();){var M=b.next();if(M instanceof Mr){var F=this.itemsTree(M);F!==null&&p.add(F)}else M instanceof Lr?p.add(M.getItem()):It.shouldNeverReachHere()}return p.size()<=0?null:p}}},{key:"insert",value:function(c,d){It.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Lr(c,d))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var c=arguments[0],d=new Tt;return this.boundablesAtLevel(c,this._root,d),d}if(arguments.length===3){var p=arguments[0],b=arguments[1],M=arguments[2];if(It.isTrue(p>-2),b.getLevel()===p)return M.add(b),null;for(var F=b.getChildBoundables().iterator();F.hasNext();){var q=F.next();q instanceof Mr?this.boundablesAtLevel(p,q,M):(It.isTrue(q instanceof Lr),p===-1&&M.add(q))}return null}}},{key:"query",value:function(){if(arguments.length===1){var c=arguments[0];this.build();var d=new Tt;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),c)&&this.queryInternal(c,this._root,d),d}if(arguments.length===2){var p=arguments[0],b=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),p)&&this.queryInternal(p,this._root,b)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),c)&&this.remove(c,this._root,d)}if(arguments.length===3){var p=arguments[0],b=arguments[1],M=arguments[2],F=this.removeItem(b,M);if(F)return!0;for(var q=null,Y=b.getChildBoundables().iterator();Y.hasNext();){var me=Y.next();if(this.getIntersectsOp().intersects(me.getBounds(),p)&&me instanceof Mr&&(F=this.remove(p,me,M))){q=me;break}}return q!==null&&q.getChildBoundables().isEmpty()&&b.getChildBoundables().remove(q),F}}},{key:"createHigherLevels",value:function(c,d){It.isTrue(!c.isEmpty());var p=this.createParentBoundables(c,d+1);return p.size()===1?p.get(0):this.createHigherLevels(p,d+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var c=arguments[0],d=0,p=c.getChildBoundables().iterator();p.hasNext();){var b=p.next();if(b instanceof Mr){var M=this.depth(b);M>d&&(d=M)}}return d+1}}},{key:"createParentBoundables",value:function(c,d){It.isTrue(!c.isEmpty());var p=new Tt;p.add(this.createNode(d));var b=new Tt(c);jo.sort(b,this.getComparator());for(var M=b.iterator();M.hasNext();){var F=M.next();this.lastNode(p).getChildBoundables().size()===this.getNodeCapacity()&&p.add(this.createNode(d)),this.lastNode(p).addChildBoundable(F)}return p}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[be]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new Tt,this._nodeCapacity=null,arguments.length===0)I.constructor_.call(this,I.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var c=arguments[0];It.isTrue(c>1,"Node capacity must be greater than 1"),this._nodeCapacity=c}}},{key:"compareDoubles",value:function(c,d){return c>d?1:c<d?-1:0}}]),I}();Go.IntersectsOp=function(){},Go.DEFAULT_NODE_CAPACITY=10;var lu=function(){function I(){n(this,I)}return a(I,[{key:"distance",value:function(c,d){}}]),I}(),ts=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"createParentBoundablesFromVerticalSlices",value:function(p,b){It.isTrue(p.length>0);for(var M=new Tt,F=0;F<p.length;F++)M.addAll(this.createParentBoundablesFromVerticalSlice(p[F],b));return M}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var p=arguments[0],b=arguments[1];return this.nearestNeighbourK(p,vt.POSITIVE_INFINITY,b)}if(arguments.length===3){var M=arguments[0],F=arguments[1],q=arguments[2],Y=F,me=new bs;me.add(M);for(var Fe=new bs;!me.isEmpty()&&Y>=0;){var $e=me.poll(),mt=$e.getDistance();if(mt>=Y)break;if($e.isLeaves())if(Fe.size()<q)Fe.add($e);else{var zt=Fe.peek();zt.getDistance()>mt&&(Fe.poll(),Fe.add($e));var Nt=Fe.peek();Y=Nt.getDistance()}else $e.expandToQueue(me,Y)}return d.getItems(Fe)}}},{key:"createNode",value:function(p){return new Ll(p)}},{key:"size",value:function(){return arguments.length===0?U(m(d.prototype),"size",this).call(this):U(m(d.prototype),"size",this).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof dn))return U(m(d.prototype),"insert",this).apply(this,arguments);var p=arguments[0],b=arguments[1];if(p.isNull())return null;U(m(d.prototype),"insert",this).call(this,p,b)}},{key:"getIntersectsOp",value:function(){return d.intersectsOp}},{key:"verticalSlices",value:function(p,b){for(var M=Math.trunc(Math.ceil(p.size()/b)),F=new Array(b).fill(null),q=p.iterator(),Y=0;Y<b;Y++){F[Y]=new Tt;for(var me=0;q.hasNext()&&me<M;){var Fe=q.next();F[Y].add(Fe),me++}}return F}},{key:"query",value:function(){if(arguments.length===1){var p=arguments[0];return U(m(d.prototype),"query",this).call(this,p)}if(arguments.length===2){var b=arguments[0],M=arguments[1];U(m(d.prototype),"query",this).call(this,b,M)}}},{key:"getComparator",value:function(){return d.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(p,b){return U(m(d.prototype),"createParentBoundables",this).call(this,p,b)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof dn){var p=arguments[0],b=arguments[1];return U(m(d.prototype),"remove",this).call(this,p,b)}return U(m(d.prototype),"remove",this).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?U(m(d.prototype),"depth",this).call(this):U(m(d.prototype),"depth",this).apply(this,arguments)}},{key:"createParentBoundables",value:function(p,b){It.isTrue(!p.isEmpty());var M=Math.trunc(Math.ceil(p.size()/this.getNodeCapacity())),F=new Tt(p);jo.sort(F,d.xComparator);var q=this.verticalSlices(F,Math.trunc(Math.ceil(Math.sqrt(M))));return this.createParentBoundablesFromVerticalSlices(q,b)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(xn(arguments[0],lu)){var p=arguments[0];if(this.isEmpty())return null;var b=new qo(this.getRoot(),this.getRoot(),p);return this.nearestNeighbour(b)}if(arguments[0]instanceof qo){var M=arguments[0],F=vt.POSITIVE_INFINITY,q=null,Y=new bs;for(Y.add(M);!Y.isEmpty()&&F>0;){var me=Y.poll(),Fe=me.getDistance();if(Fe>=F)break;me.isLeaves()?(F=Fe,q=me):me.expandToQueue(Y,F)}return q===null?null:[q.getBoundable(0).getItem(),q.getBoundable(1).getItem()]}}else{if(arguments.length===2){var $e=arguments[0],mt=arguments[1];if(this.isEmpty()||$e.isEmpty())return null;var zt=new qo(this.getRoot(),$e.getRoot(),mt);return this.nearestNeighbour(zt)}if(arguments.length===3){var Nt=arguments[0],gn=arguments[1],bn=arguments[2],Pn=new Lr(Nt,gn),ti=new qo(this.getRoot(),Pn,bn);return this.nearestNeighbour(ti)[0]}if(arguments.length===4){var mi=arguments[0],li=arguments[1],er=arguments[2],rs=arguments[3],Ps=new Lr(mi,li),fi=new qo(this.getRoot(),Ps,er);return this.nearestNeighbourK(fi,rs)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var p=arguments[0],b=arguments[1],M=vt.POSITIVE_INFINITY,F=new bs;for(F.add(p);!F.isEmpty();){var q=F.poll(),Y=q.getDistance();if(Y>b)return!1;if(q.maximumDistance()<=b)return!0;if(q.isLeaves()){if((M=Y)<=b)return!0}else q.expandToQueue(F,M)}return!1}if(arguments.length===3){var me=arguments[0],Fe=arguments[1],$e=arguments[2],mt=new qo(this.getRoot(),me.getRoot(),Fe);return this.isWithinDistance(mt,$e)}}},{key:"interfaces_",get:function(){return[si,be]}}],[{key:"constructor_",value:function(){if(arguments.length===0)d.constructor_.call(this,d.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var p=arguments[0];Go.constructor_.call(this,p)}}},{key:"centreX",value:function(p){return d.avg(p.getMinX(),p.getMaxX())}},{key:"avg",value:function(p,b){return(p+b)/2}},{key:"getItems",value:function(p){for(var b=new Array(p.size()).fill(null),M=0;!p.isEmpty();){var F=p.poll();b[M]=F.getBoundable(0).getItem(),M++}return b}},{key:"centreY",value:function(p){return d.avg(p.getMinY(),p.getMaxY())}}]),d}(Go),Ll=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"computeBounds",value:function(){for(var p=null,b=this.getChildBoundables().iterator();b.hasNext();){var M=b.next();p===null?p=new dn(M.getBounds()):p.expandToInclude(M.getBounds())}return p}}],[{key:"constructor_",value:function(){var p=arguments[0];Mr.constructor_.call(this,p)}}]),d}(Mr);ts.STRtreeNode=Ll,ts.xComparator=new(function(){function I(){n(this,I)}return a(I,[{key:"interfaces_",get:function(){return[wt]}},{key:"compare",value:function(c,d){return Go.compareDoubles(ts.centreX(c.getBounds()),ts.centreX(d.getBounds()))}}]),I}()),ts.yComparator=new(function(){function I(){n(this,I)}return a(I,[{key:"interfaces_",get:function(){return[wt]}},{key:"compare",value:function(c,d){return Go.compareDoubles(ts.centreY(c.getBounds()),ts.centreY(d.getBounds()))}}]),I}()),ts.intersectsOp=new(function(){function I(){n(this,I)}return a(I,[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(c,d){return c.intersects(d)}}]),I}()),ts.DEFAULT_NODE_CAPACITY=10;var uu=function(){function I(){n(this,I)}return a(I,null,[{key:"relativeSign",value:function(c,d){return c<d?-1:c>d?1:0}},{key:"compare",value:function(c,d,p){if(d.equals2D(p))return 0;var b=I.relativeSign(d.x,p.x),M=I.relativeSign(d.y,p.y);switch(c){case 0:return I.compareValue(b,M);case 1:return I.compareValue(M,b);case 2:return I.compareValue(M,-b);case 3:return I.compareValue(-b,M);case 4:return I.compareValue(-b,-M);case 5:return I.compareValue(-M,-b);case 6:return I.compareValue(-M,b);case 7:return I.compareValue(b,-M)}return It.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(c,d){return c<0?-1:c>0?1:d<0?-1:d>0?1:0}}]),I}(),cu=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(c){c.print(this.coord),c.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(c){var d=c;return this.segmentIndex<d.segmentIndex?-1:this.segmentIndex>d.segmentIndex?1:this.coord.equals2D(d.coord)?0:this._isInterior?d._isInterior?uu.compare(this._segmentOctant,this.coord,d.coord):1:-1}},{key:"isEndPoint",value:function(c){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===c}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[he]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];this._segString=c,this.coord=new Xe(d),this.segmentIndex=p,this._segmentOctant=b,this._isInterior=!d.equals2D(c.getCoordinate(p))}}]),I}(),hu=function(){function I(){n(this,I)}return a(I,[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}]),I}(),ko=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getSplitCoordinates",value:function(){var c=new Ai;this.addEndpoints();for(var d=this.iterator(),p=d.next();d.hasNext();){var b=d.next();this.addEdgeCoordinates(p,b,c),p=b}return c.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var c=new Tt;this.findCollapsesFromInsertedNodes(c),this.findCollapsesFromExistingVertices(c);for(var d=c.iterator();d.hasNext();){var p=d.next().intValue();this.add(this._edge.getCoordinate(p),p)}}},{key:"createSplitEdgePts",value:function(c,d){var p=d.segmentIndex-c.segmentIndex+2;if(p===2)return[new Xe(c.coord),new Xe(d.coord)];var b=this._edge.getCoordinate(d.segmentIndex),M=d.isInterior()||!d.coord.equals2D(b);M||p--;var F=new Array(p).fill(null),q=0;F[q++]=new Xe(c.coord);for(var Y=c.segmentIndex+1;Y<=d.segmentIndex;Y++)F[q++]=this._edge.getCoordinate(Y);return M&&(F[q]=new Xe(d.coord)),F}},{key:"print",value:function(c){c.println("Intersections:");for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"findCollapsesFromExistingVertices",value:function(c){for(var d=0;d<this._edge.size()-2;d++){var p=this._edge.getCoordinate(d);this._edge.getCoordinate(d+1);var b=this._edge.getCoordinate(d+2);p.equals2D(b)&&c.add(Ji.valueOf(d+1))}}},{key:"addEdgeCoordinates",value:function(c,d,p){var b=this.createSplitEdgePts(c,d);p.add(b,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(c){this.addEndpoints(),this.addCollapsedNodes();for(var d=this.iterator(),p=d.next();d.hasNext();){var b=d.next(),M=this.createSplitEdge(p,b);c.add(M),p=b}}},{key:"findCollapseIndex",value:function(c,d,p){if(!c.coord.equals2D(d.coord))return!1;var b=d.segmentIndex-c.segmentIndex;return d.isInterior()||b--,b===1&&(p[0]=c.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(c){for(var d=new Array(1).fill(null),p=this.iterator(),b=p.next();p.hasNext();){var M=p.next();this.findCollapseIndex(b,M,d)&&c.add(Ji.valueOf(d[0])),b=M}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var c=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(c),c)}},{key:"createSplitEdge",value:function(c,d){var p=this.createSplitEdgePts(c,d);return new xs(p,this._edge.getData())}},{key:"add",value:function(c,d){var p=new cu(this._edge,c,d,this._edge.getSegmentOctant(d)),b=this._nodeMap.get(p);return b!==null?(It.isTrue(b.coord.equals2D(c),"Found equal nodes with different coordinates"),b):(this._nodeMap.put(p,p),p)}},{key:"checkSplitEdgesCorrectness",value:function(c){var d=this._edge.getCoordinates(),p=c.get(0).getCoordinate(0);if(!p.equals2D(d[0]))throw new ft("bad split edge start point at "+p);var b=c.get(c.size()-1).getCoordinates(),M=b[b.length-1];if(!M.equals2D(d[d.length-1]))throw new ft("bad split edge end point at "+M)}}],[{key:"constructor_",value:function(){this._nodeMap=new Bo,this._edge=null;var c=arguments[0];this._edge=c}}]),I}(),fu=function(){function I(){n(this,I)}return a(I,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var c=arguments[0],d=arguments[1];if(c===0&&d===0)throw new ve("Cannot compute the octant for point ( "+c+", "+d+" )");var p=Math.abs(c),b=Math.abs(d);return c>=0?d>=0?p>=b?0:1:p>=b?7:6:d>=0?p>=b?3:2:p>=b?4:5}if(arguments[0]instanceof Xe&&arguments[1]instanceof Xe){var M=arguments[0],F=arguments[1],q=F.x-M.x,Y=F.y-M.y;if(q===0&&Y===0)throw new ve("Cannot compute the octant for two identical points "+M);return I.octant(q,Y)}}}]),I}(),xc=function(){function I(){n(this,I)}return a(I,[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(c){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(c){}},{key:"getData",value:function(){}}]),I}(),du=function(){function I(){n(this,I)}return a(I,[{key:"addIntersection",value:function(c,d){}},{key:"interfaces_",get:function(){return[xc]}}]),I}(),xs=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(c){return this._pts[c]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(c){return c===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(c),this.getCoordinate(c+1))}},{key:"setData",value:function(c){this._data=c}},{key:"safeOctant",value:function(c,d){return c.equals2D(d)?0:fu.octant(c,d)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];this.addIntersectionNode(c,d)}else if(arguments.length===4){var p=arguments[0],b=arguments[1],M=arguments[3],F=new Xe(p.getIntersection(M));this.addIntersection(F,b)}}},{key:"toString",value:function(){return za.toLineString(new bo(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(c,d){var p=d,b=p+1;if(b<this._pts.length){var M=this._pts[b];c.equals2D(M)&&(p=b)}return this._nodeList.add(c,p)}},{key:"addIntersections",value:function(c,d,p){for(var b=0;b<c.getIntersectionNum();b++)this.addIntersection(c,d,p,b)}},{key:"interfaces_",get:function(){return[du]}}],[{key:"constructor_",value:function(){this._nodeList=new ko(this),this._pts=null,this._data=null;var c=arguments[0],d=arguments[1];this._pts=c,this._data=d}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var c=arguments[0],d=new Tt;return I.getNodedSubstrings(c,d),d}if(arguments.length===2)for(var p=arguments[0],b=arguments[1],M=p.iterator();M.hasNext();){var F=M.next();F.getNodeList().addSplitEdges(b)}}}]),I}(),Hr=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof I){var c=arguments[0],d=mn.index(this.p0,this.p1,c.p0),p=mn.index(this.p0,this.p1,c.p1);return d>=0&&p>=0||d<=0&&p<=0?Math.max(d,p):0}if(arguments[0]instanceof Xe){var b=arguments[0];return mn.index(this.p0,this.p1,b)}}},{key:"toGeometry",value:function(c){return c.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(c){if(!(c instanceof I))return!1;var d=c;return this.p0.equals(d.p0)&&this.p1.equals(d.p1)}},{key:"intersection",value:function(c){var d=new so;return d.computeIntersection(this.p0,this.p1,c.p0,c.p1),d.hasIntersection()?d.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof Xe){var c=arguments[0];if(c.equals(this.p0)||c.equals(this.p1))return new Xe(c);var d=this.projectionFactor(c),p=new Xe;return p.x=this.p0.x+d*(this.p1.x-this.p0.x),p.y=this.p0.y+d*(this.p1.y-this.p0.y),p}if(arguments[0]instanceof I){var b=arguments[0],M=this.projectionFactor(b.p0),F=this.projectionFactor(b.p1);if(M>=1&&F>=1||M<=0&&F<=0)return null;var q=this.project(b.p0);M<0&&(q=this.p0),M>1&&(q=this.p1);var Y=this.project(b.p1);return F<0&&(Y=this.p0),F>1&&(Y=this.p1),new I(q,Y)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(c){return c===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(c){return Ki.pointToLinePerpendicular(c,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return I.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(c){if(c.equals(this.p0))return 0;if(c.equals(this.p1))return 1;var d=this.p1.x-this.p0.x,p=this.p1.y-this.p0.y,b=d*d+p*p;return b<=0?vt.NaN:((c.x-this.p0.x)*d+(c.y-this.p0.y)*p)/b}},{key:"closestPoints",value:function(c){var d=this.intersection(c);if(d!==null)return[d,d];var p=new Array(2).fill(null),b=vt.MAX_VALUE,M=null,F=this.closestPoint(c.p0);b=F.distance(c.p0),p[0]=F,p[1]=c.p0;var q=this.closestPoint(c.p1);(M=q.distance(c.p1))<b&&(b=M,p[0]=q,p[1]=c.p1);var Y=c.closestPoint(this.p0);(M=Y.distance(this.p0))<b&&(b=M,p[0]=this.p0,p[1]=Y);var me=c.closestPoint(this.p1);return(M=me.distance(this.p1))<b&&(b=M,p[0]=this.p1,p[1]=me),p}},{key:"closestPoint",value:function(c){var d=this.projectionFactor(c);return d>0&&d<1?this.project(c):this.p0.distance(c)<this.p1.distance(c)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(c){var d=c,p=this.p0.compareTo(d.p0);return p!==0?p:this.p1.compareTo(d.p1)}},{key:"reverse",value:function(){var c=this.p0;this.p0=this.p1,this.p1=c}},{key:"equalsTopo",value:function(c){return this.p0.equals(c.p0)&&this.p1.equals(c.p1)||this.p0.equals(c.p1)&&this.p1.equals(c.p0)}},{key:"lineIntersection",value:function(c){return wn.intersection(this.p0,this.p1,c.p0,c.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(c,d){var p=this.p0.x+c*(this.p1.x-this.p0.x),b=this.p0.y+c*(this.p1.y-this.p0.y),M=this.p1.x-this.p0.x,F=this.p1.y-this.p0.y,q=Math.sqrt(M*M+F*F),Y=0,me=0;if(d!==0){if(q<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");Y=d*M/q,me=d*F/q}return new Xe(p-me,b+Y)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var c=arguments[0];this.setCoordinates(c.p0,c.p1)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.p0.x=d.x,this.p0.y=d.y,this.p1.x=p.x,this.p1.y=p.y}}},{key:"segmentFraction",value:function(c){var d=this.projectionFactor(c);return d<0?d=0:(d>1||vt.isNaN(d))&&(d=1),d}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(c){var d=this.p1.getY()-this.p0.getY(),p=this.p0.getX()-this.p1.getX(),b=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),M=d*d+p*p,F=d*d-p*p,q=c.getX(),Y=c.getY();return new Xe((-F*q-2*d*p*Y-2*d*b)/M,(F*Y-2*d*p*q-2*p*b)/M)}},{key:"distance",value:function(){if(arguments[0]instanceof I){var c=arguments[0];return Ki.segmentToSegment(this.p0,this.p1,c.p0,c.p1)}if(arguments[0]instanceof Xe){var d=arguments[0];return Ki.pointToSegment(d,this.p0,this.p1)}}},{key:"pointAlong",value:function(c){var d=new Xe;return d.x=this.p0.x+c*(this.p1.x-this.p0.x),d.y=this.p0.y+c*(this.p1.y-this.p0.y),d}},{key:"hashCode",value:function(){var c=vt.doubleToLongBits(this.p0.x);c^=31*vt.doubleToLongBits(this.p0.y);var d=Math.trunc(c)^Math.trunc(c>>32),p=vt.doubleToLongBits(this.p1.x);return p^=31*vt.doubleToLongBits(this.p1.y),d^(Math.trunc(p)^Math.trunc(p>>32))}},{key:"interfaces_",get:function(){return[he,be]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)I.constructor_.call(this,new Xe,new Xe);else if(arguments.length===1){var c=arguments[0];I.constructor_.call(this,c.p0,c.p1)}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this.p0=d,this.p1=p}else if(arguments.length===4){var b=arguments[0],M=arguments[1],F=arguments[2],q=arguments[3];I.constructor_.call(this,new Xe(b,M),new Xe(F,q))}}},{key:"midPoint",value:function(c,d){return new Xe((c.x+d.x)/2,(c.y+d.y)/2)}}]),I}(),ja=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"overlap",value:function(){if(arguments.length!==2&&arguments.length===4){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];c.getLineSegment(d,this._overlapSeg1),p.getLineSegment(b,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new Hr,this._overlapSeg2=new Hr}}]),I}(),pu=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getLineSegment",value:function(c,d){d.p0=this._pts[c],d.p1=this._pts[c+1]}},{key:"computeSelect",value:function(c,d,p,b){var M=this._pts[d],F=this._pts[p];if(p-d==1)return b.select(this,d),null;if(!c.intersects(M,F))return null;var q=Math.trunc((d+p)/2);d<q&&this.computeSelect(c,d,q,b),q<p&&this.computeSelect(c,q,p,b)}},{key:"getCoordinates",value:function(){for(var c=new Array(this._end-this._start+1).fill(null),d=0,p=this._start;p<=this._end;p++)c[d++]=this._pts[p];return c}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1];this.computeOverlaps(this._start,this._end,c,c._start,c._end,d)}else if(arguments.length===6){var p=arguments[0],b=arguments[1],M=arguments[2],F=arguments[3],q=arguments[4],Y=arguments[5];if(b-p==1&&q-F==1)return Y.overlap(this,p,M,F),null;if(!this.overlaps(p,b,M,F,q))return null;var me=Math.trunc((p+b)/2),Fe=Math.trunc((F+q)/2);p<me&&(F<Fe&&this.computeOverlaps(p,me,M,F,Fe,Y),Fe<q&&this.computeOverlaps(p,me,M,Fe,q,Y)),me<b&&(F<Fe&&this.computeOverlaps(me,b,M,F,Fe,Y),Fe<q&&this.computeOverlaps(me,b,M,Fe,q,Y))}}},{key:"setId",value:function(c){this._id=c}},{key:"select",value:function(c,d){this.computeSelect(c,this._start,this._end,d)}},{key:"getEnvelope",value:function(){if(this._env===null){var c=this._pts[this._start],d=this._pts[this._end];this._env=new dn(c,d)}return this._env}},{key:"overlaps",value:function(c,d,p,b,M){return dn.intersects(this._pts[c],this._pts[d],p._pts[b],p._pts[M])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];this._pts=c,this._start=d,this._end=p,this._context=b}}]),I}(),wc=function(){function I(){n(this,I)}return a(I,null,[{key:"findChainEnd",value:function(c,d){for(var p=d;p<c.length-1&&c[p].equals2D(c[p+1]);)p++;if(p>=c.length-1)return c.length-1;for(var b=hr.quadrant(c[p],c[p+1]),M=d+1;M<c.length&&!(!c[M-1].equals2D(c[M])&&hr.quadrant(c[M-1],c[M])!==b);)M++;return M-1}},{key:"getChains",value:function(){if(arguments.length===1){var c=arguments[0];return I.getChains(c,null)}if(arguments.length===2){var d=arguments[0],p=arguments[1],b=new Tt,M=0;do{var F=I.findChainEnd(d,M),q=new pu(d,M,F,p);b.add(q),M=F}while(M<d.length-1);return b}}}]),I}(),Va=function(){function I(){n(this,I)}return a(I,[{key:"computeNodes",value:function(c){}},{key:"getNodedSubstrings",value:function(){}}]),I}(),Ml=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setSegmentIntersector",value:function(c){this._segInt=c}},{key:"interfaces_",get:function(){return[Va]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var c=arguments[0];this.setSegmentIntersector(c)}}}]),I}(),qa=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return xs.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(p){for(var b=wc.getChains(p.getCoordinates(),p).iterator();b.hasNext();){var M=b.next();M.setId(this._idCounter++),this._index.insert(M.getEnvelope(),M),this._monoChains.add(M)}}},{key:"computeNodes",value:function(p){this._nodedSegStrings=p;for(var b=p.iterator();b.hasNext();)this.add(b.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var p=new Ga(this._segInt),b=this._monoChains.iterator();b.hasNext();)for(var M=b.next(),F=this._index.query(M.getEnvelope()).iterator();F.hasNext();){var q=F.next();if(q.getId()>M.getId()&&(M.computeOverlaps(q,p),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new Tt,this._index=new ts,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0&&arguments.length===1){var p=arguments[0];Ml.constructor_.call(this,p)}}}]),d}(Ml),Ga=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"overlap",value:function(){if(arguments.length!==4)return U(m(d.prototype),"overlap",this).apply(this,arguments);var p=arguments[0],b=arguments[1],M=arguments[2],F=arguments[3],q=p.getContext(),Y=M.getContext();this._si.processIntersections(q,b,Y,F)}}],[{key:"constructor_",value:function(){this._si=null;var p=arguments[0];this._si=p}}]),d}(ja);qa.SegmentOverlapAction=Ga;var ns=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isDeletable",value:function(c,d,p,b){var M=this._inputLine[c],F=this._inputLine[d],q=this._inputLine[p];return!!this.isConcave(M,F,q)&&!!this.isShallow(M,F,q,b)&&this.isShallowSampled(M,F,c,p,b)}},{key:"deleteShallowConcavities",value:function(){for(var c=1,d=this.findNextNonDeletedIndex(c),p=this.findNextNonDeletedIndex(d),b=!1;p<this._inputLine.length;){var M=!1;this.isDeletable(c,d,p,this._distanceTol)&&(this._isDeleted[d]=I.DELETE,M=!0,b=!0),c=M?p:d,d=this.findNextNonDeletedIndex(c),p=this.findNextNonDeletedIndex(d)}return b}},{key:"isShallowConcavity",value:function(c,d,p,b){return mn.index(c,d,p)===this._angleOrientation&&Ki.pointToSegment(d,c,p)<b}},{key:"isShallowSampled",value:function(c,d,p,b,M){var F=Math.trunc((b-p)/I.NUM_PTS_TO_CHECK);F<=0&&(F=1);for(var q=p;q<b;q+=F)if(!this.isShallow(c,d,this._inputLine[q],M))return!1;return!0}},{key:"isConcave",value:function(c,d,p){var b=mn.index(c,d,p)===this._angleOrientation;return b}},{key:"simplify",value:function(c){this._distanceTol=Math.abs(c),c<0&&(this._angleOrientation=mn.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var d=!1;do d=this.deleteShallowConcavities();while(d);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(c){for(var d=c+1;d<this._inputLine.length&&this._isDeleted[d]===I.DELETE;)d++;return d}},{key:"isShallow",value:function(c,d,p,b){return Ki.pointToSegment(d,c,p)<b}},{key:"collapseLine",value:function(){for(var c=new Ai,d=0;d<this._inputLine.length;d++)this._isDeleted[d]!==I.DELETE&&c.add(this._inputLine[d]);return c.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=mn.COUNTERCLOCKWISE;var c=arguments[0];this._inputLine=c}},{key:"simplify",value:function(c,d){return new I(c).simplify(d)}}]),I}();ns.INIT=0,ns.DELETE=1,ns.KEEP=1,ns.NUM_PTS_TO_CHECK=10;var ya=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinates",value:function(){return this._ptList.toArray(I.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(c){this._precisionModel=c}},{key:"addPt",value:function(c){var d=new Xe(c);if(this._precisionModel.makePrecise(d),this.isRedundant(d))return null;this._ptList.add(d)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(c,d){if(d)for(var p=0;p<c.length;p++)this.addPt(c[p]);else for(var b=c.length-1;b>=0;b--)this.addPt(c[b])}},{key:"isRedundant",value:function(c){if(this._ptList.size()<1)return!1;var d=this._ptList.get(this._ptList.size()-1);return c.distance(d)<this._minimimVertexDistance}},{key:"toString",value:function(){return new Kr().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var c=new Xe(this._ptList.get(0)),d=this._ptList.get(this._ptList.size()-1);if(c.equals(d))return null;this._ptList.add(c)}},{key:"setMinimumVertexDistance",value:function(c){this._minimimVertexDistance=c}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Tt}}]),I}();ya.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var Bi=function(){function I(){n(this,I)}return a(I,null,[{key:"toDegrees",value:function(c){return 180*c/Math.PI}},{key:"normalize",value:function(c){for(;c>Math.PI;)c-=I.PI_TIMES_2;for(;c<=-Math.PI;)c+=I.PI_TIMES_2;return c}},{key:"angle",value:function(){if(arguments.length===1){var c=arguments[0];return Math.atan2(c.y,c.x)}if(arguments.length===2){var d=arguments[0],p=arguments[1],b=p.x-d.x,M=p.y-d.y;return Math.atan2(M,b)}}},{key:"isAcute",value:function(c,d,p){var b=c.x-d.x,M=c.y-d.y;return b*(p.x-d.x)+M*(p.y-d.y)>0}},{key:"isObtuse",value:function(c,d,p){var b=c.x-d.x,M=c.y-d.y;return b*(p.x-d.x)+M*(p.y-d.y)<0}},{key:"interiorAngle",value:function(c,d,p){var b=I.angle(d,c),M=I.angle(d,p);return Math.abs(M-b)}},{key:"normalizePositive",value:function(c){if(c<0){for(;c<0;)c+=I.PI_TIMES_2;c>=I.PI_TIMES_2&&(c=0)}else{for(;c>=I.PI_TIMES_2;)c-=I.PI_TIMES_2;c<0&&(c=0)}return c}},{key:"angleBetween",value:function(c,d,p){var b=I.angle(d,c),M=I.angle(d,p);return I.diff(b,M)}},{key:"diff",value:function(c,d){var p=null;return(p=c<d?d-c:c-d)>Math.PI&&(p=2*Math.PI-p),p}},{key:"toRadians",value:function(c){return c*Math.PI/180}},{key:"getTurn",value:function(c,d){var p=Math.sin(d-c);return p>0?I.COUNTERCLOCKWISE:p<0?I.CLOCKWISE:I.NONE}},{key:"angleBetweenOriented",value:function(c,d,p){var b=I.angle(d,c),M=I.angle(d,p)-b;return M<=-Math.PI?M+I.PI_TIMES_2:M>Math.PI?M-I.PI_TIMES_2:M}}]),I}();Bi.PI_TIMES_2=2*Math.PI,Bi.PI_OVER_2=Math.PI/2,Bi.PI_OVER_4=Math.PI/4,Bi.COUNTERCLOCKWISE=mn.COUNTERCLOCKWISE,Bi.CLOCKWISE=mn.CLOCKWISE,Bi.NONE=mn.COLLINEAR;var Io=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"addNextSegment",value:function(c,d){if(this._s0=this._s1,this._s1=this._s2,this._s2=c,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var p=mn.index(this._s0,this._s1,this._s2),b=p===mn.CLOCKWISE&&this._side===Ee.LEFT||p===mn.COUNTERCLOCKWISE&&this._side===Ee.RIGHT;p===0?this.addCollinear(d):b?this.addOutsideTurn(p,d):this.addInsideTurn(p,d)}},{key:"addLineEndCap",value:function(c,d){var p=new Hr(c,d),b=new Hr;this.computeOffsetSegment(p,Ee.LEFT,this._distance,b);var M=new Hr;this.computeOffsetSegment(p,Ee.RIGHT,this._distance,M);var F=d.x-c.x,q=d.y-c.y,Y=Math.atan2(q,F);switch(this._bufParams.getEndCapStyle()){case $.CAP_ROUND:this._segList.addPt(b.p1),this.addDirectedFillet(d,Y+Math.PI/2,Y-Math.PI/2,mn.CLOCKWISE,this._distance),this._segList.addPt(M.p1);break;case $.CAP_FLAT:this._segList.addPt(b.p1),this._segList.addPt(M.p1);break;case $.CAP_SQUARE:var me=new Xe;me.x=Math.abs(this._distance)*Math.cos(Y),me.y=Math.abs(this._distance)*Math.sin(Y);var Fe=new Xe(b.p1.x+me.x,b.p1.y+me.y),$e=new Xe(M.p1.x+me.x,M.p1.y+me.y);this._segList.addPt(Fe),this._segList.addPt($e)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(c,d,p,b){var M=wn.intersection(d.p0,d.p1,p.p0,p.p1);if(M!==null&&(b<=0?1:M.distance(c)/Math.abs(b))<=this._bufParams.getMitreLimit())return this._segList.addPt(M),null;this.addLimitedMitreJoin(d,p,b,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(c,d){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*I.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===$.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===$.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(d&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,c,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(c){this._segList.addPt(new Xe(c.x+this._distance,c.y+this._distance)),this._segList.addPt(new Xe(c.x+this._distance,c.y-this._distance)),this._segList.addPt(new Xe(c.x-this._distance,c.y-this._distance)),this._segList.addPt(new Xe(c.x-this._distance,c.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(c,d){this._segList.addPts(c,d)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(c,d,p,b,M){var F=d.x-c.x,q=d.y-c.y,Y=Math.atan2(q,F),me=p.x-c.x,Fe=p.y-c.y,$e=Math.atan2(Fe,me);b===mn.CLOCKWISE?Y<=$e&&(Y+=2*Math.PI):Y>=$e&&(Y-=2*Math.PI),this._segList.addPt(d),this.addDirectedFillet(c,Y,$e,b,M),this._segList.addPt(p)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(c,d,p){this._s1=c,this._s2=d,this._side=p,this._seg1.setCoordinates(c,d),this.computeOffsetSegment(this._seg1,p,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(c,d,p,b){var M=this._seg0.p1,F=Bi.angle(M,this._seg0.p0),q=Bi.angleBetweenOriented(this._seg0.p0,M,this._seg1.p1)/2,Y=Bi.normalize(F+q),me=Bi.normalize(Y+Math.PI),Fe=b*p,$e=p-Fe*Math.abs(Math.sin(q)),mt=M.x+Fe*Math.cos(me),zt=M.y+Fe*Math.sin(me),Nt=new Xe(mt,zt),gn=new Hr(M,Nt),bn=gn.pointAlongOffset(1,$e),Pn=gn.pointAlongOffset(1,-$e);this._side===Ee.LEFT?(this._segList.addPt(bn),this._segList.addPt(Pn)):(this._segList.addPt(Pn),this._segList.addPt(bn))}},{key:"addDirectedFillet",value:function(c,d,p,b,M){var F=b===mn.CLOCKWISE?-1:1,q=Math.abs(d-p),Y=Math.trunc(q/this._filletAngleQuantum+.5);if(Y<1)return null;for(var me=q/Y,Fe=new Xe,$e=0;$e<Y;$e++){var mt=d+F*$e*me;Fe.x=c.x+M*Math.cos(mt),Fe.y=c.y+M*Math.sin(mt),this._segList.addPt(Fe)}}},{key:"computeOffsetSegment",value:function(c,d,p,b){var M=d===Ee.LEFT?1:-1,F=c.p1.x-c.p0.x,q=c.p1.y-c.p0.y,Y=Math.sqrt(F*F+q*q),me=M*p*F/Y,Fe=M*p*q/Y;b.p0.x=c.p0.x-Fe,b.p0.y=c.p0.y+me,b.p1.x=c.p1.x-Fe,b.p1.y=c.p1.y+me}},{key:"addInsideTurn",value:function(c,d){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*I.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var p=new Xe((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(p);var b=new Xe((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(b)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(c){var d=new Xe(c.x+this._distance,c.y);this._segList.addPt(d),this.addDirectedFillet(c,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(c,d){this._segList.addPt(c.p1),this._segList.addPt(d.p0)}},{key:"init",value:function(c){this._distance=c,this._maxCurveSegmentError=c*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new ya,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(c*I.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(c){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===$.JOIN_BEVEL||this._bufParams.getJoinStyle()===$.JOIN_MITRE?(c&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,mn.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Hr,this._seg1=new Hr,this._offset0=new Hr,this._offset1=new Hr,this._side=0,this._hasNarrowConcaveAngle=!1;var c=arguments[0],d=arguments[1],p=arguments[2];this._precisionModel=c,this._bufParams=d,this._li=new so,this._filletAngleQuantum=Math.PI/2/d.getQuadrantSegments(),d.getQuadrantSegments()>=8&&d.getJoinStyle()===$.JOIN_ROUND&&(this._closingSegLengthFactor=I.MAX_CLOSING_SEG_LEN_FACTOR),this.init(p)}}]),I}();Io.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,Io.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,Io.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,Io.MAX_CLOSING_SEG_LEN_FACTOR=80;var Al=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getOffsetCurve",value:function(c,d){if(this._distance=d,d===0)return null;var p=d<0,b=Math.abs(d),M=this.getSegGen(b);c.length<=1?this.computePointCurve(c[0],M):this.computeOffsetCurve(c,p,M);var F=M.getCoordinates();return p&&Xn.reverse(F),F}},{key:"computeSingleSidedBufferCurve",value:function(c,d,p){var b=this.simplifyTolerance(this._distance);if(d){p.addSegments(c,!0);var M=ns.simplify(c,-b),F=M.length-1;p.initSideSegments(M[F],M[F-1],Ee.LEFT),p.addFirstSegment();for(var q=F-2;q>=0;q--)p.addNextSegment(M[q],!0)}else{p.addSegments(c,!1);var Y=ns.simplify(c,b),me=Y.length-1;p.initSideSegments(Y[0],Y[1],Ee.LEFT),p.addFirstSegment();for(var Fe=2;Fe<=me;Fe++)p.addNextSegment(Y[Fe],!0)}p.addLastSegment(),p.closeRing()}},{key:"computeRingBufferCurve",value:function(c,d,p){var b=this.simplifyTolerance(this._distance);d===Ee.RIGHT&&(b=-b);var M=ns.simplify(c,b),F=M.length-1;p.initSideSegments(M[F-1],M[0],d);for(var q=1;q<=F;q++){var Y=q!==1;p.addNextSegment(M[q],Y)}p.closeRing()}},{key:"computeLineBufferCurve",value:function(c,d){var p=this.simplifyTolerance(this._distance),b=ns.simplify(c,p),M=b.length-1;d.initSideSegments(b[0],b[1],Ee.LEFT);for(var F=2;F<=M;F++)d.addNextSegment(b[F],!0);d.addLastSegment(),d.addLineEndCap(b[M-1],b[M]);var q=ns.simplify(c,-p),Y=q.length-1;d.initSideSegments(q[Y],q[Y-1],Ee.LEFT);for(var me=Y-2;me>=0;me--)d.addNextSegment(q[me],!0);d.addLastSegment(),d.addLineEndCap(q[1],q[0]),d.closeRing()}},{key:"computePointCurve",value:function(c,d){switch(this._bufParams.getEndCapStyle()){case $.CAP_ROUND:d.createCircle(c);break;case $.CAP_SQUARE:d.createSquare(c)}}},{key:"getLineCurve",value:function(c,d){if(this._distance=d,this.isLineOffsetEmpty(d))return null;var p=Math.abs(d),b=this.getSegGen(p);if(c.length<=1)this.computePointCurve(c[0],b);else if(this._bufParams.isSingleSided()){var M=d<0;this.computeSingleSidedBufferCurve(c,M,b)}else this.computeLineBufferCurve(c,b);return b.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(c){return c*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(c,d,p){if(this._distance=p,c.length<=2)return this.getLineCurve(c,p);if(p===0)return I.copyCoordinates(c);var b=this.getSegGen(p);return this.computeRingBufferCurve(c,d,b),b.getCoordinates()}},{key:"computeOffsetCurve",value:function(c,d,p){var b=this.simplifyTolerance(this._distance);if(d){var M=ns.simplify(c,-b),F=M.length-1;p.initSideSegments(M[F],M[F-1],Ee.LEFT),p.addFirstSegment();for(var q=F-2;q>=0;q--)p.addNextSegment(M[q],!0)}else{var Y=ns.simplify(c,b),me=Y.length-1;p.initSideSegments(Y[0],Y[1],Ee.LEFT),p.addFirstSegment();for(var Fe=2;Fe<=me;Fe++)p.addNextSegment(Y[Fe],!0)}p.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(c){return c===0||c<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(c){return new Io(this._precisionModel,this._bufParams,c)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var c=arguments[0],d=arguments[1];this._precisionModel=c,this._bufParams=d}},{key:"copyCoordinates",value:function(c){for(var d=new Array(c.length).fill(null),p=0;p<d.length;p++)d[p]=new Xe(c[p]);return d}}]),I}(),Za=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var c=arguments[0],d=new Tt,p=this._subgraphs.iterator();p.hasNext();){var b=p.next(),M=b.getEnvelope();c.y<M.getMinY()||c.y>M.getMaxY()||this.findStabbedSegments(c,b.getDirectedEdges(),d)}return d}if(arguments.length===3){if(xn(arguments[2],Kn)&&arguments[0]instanceof Xe&&arguments[1]instanceof _a)for(var F=arguments[0],q=arguments[1],Y=arguments[2],me=q.getEdge().getCoordinates(),Fe=0;Fe<me.length-1;Fe++){this._seg.p0=me[Fe],this._seg.p1=me[Fe+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse();var $e=Math.max(this._seg.p0.x,this._seg.p1.x);if(!($e<F.x)&&!(this._seg.isHorizontal()||F.y<this._seg.p0.y||F.y>this._seg.p1.y||mn.index(this._seg.p0,this._seg.p1,F)===mn.RIGHT)){var mt=q.getDepth(Ee.LEFT);this._seg.p0.equals(me[Fe])||(mt=q.getDepth(Ee.RIGHT));var zt=new va(this._seg,mt);Y.add(zt)}}else if(xn(arguments[2],Kn)&&arguments[0]instanceof Xe&&xn(arguments[1],Kn))for(var Nt=arguments[0],gn=arguments[1],bn=arguments[2],Pn=gn.iterator();Pn.hasNext();){var ti=Pn.next();ti.isForward()&&this.findStabbedSegments(Nt,ti,bn)}}}},{key:"getDepth",value:function(c){var d=this.findStabbedSegments(c);return d.size()===0?0:jo.min(d)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new Hr;var c=arguments[0];this._subgraphs=c}}]),I}(),va=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compareTo",value:function(c){var d=c;if(this._upwardSeg.minX()>=d._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=d._upwardSeg.minX())return-1;var p=this._upwardSeg.orientationIndex(d._upwardSeg);return p!==0||(p=-1*d._upwardSeg.orientationIndex(this._upwardSeg))!==0?p:this._upwardSeg.compareTo(d._upwardSeg)}},{key:"compareX",value:function(c,d){var p=c.p0.compareTo(d.p0);return p!==0?p:c.p1.compareTo(d.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[he]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var c=arguments[0],d=arguments[1];this._upwardSeg=new Hr(c),this._leftDepth=d}}]),I}();Za.DepthSegment=va;var Ha=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,null,[{key:"constructor_",value:function(){pe.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}]),d}(pe),qs=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getY",value:function(){var c=this.y/this.w;if(vt.isNaN(c)||vt.isInfinite(c))throw new Ha;return c}},{key:"getX",value:function(){var c=this.x/this.w;if(vt.isNaN(c)||vt.isInfinite(c))throw new Ha;return c}},{key:"getCoordinate",value:function(){var c=new Xe;return c.x=this.getX(),c.y=this.getY(),c}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var c=arguments[0];this.x=c.x,this.y=c.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var d=arguments[0],p=arguments[1];this.x=d,this.y=p,this.w=1}else if(arguments[0]instanceof I&&arguments[1]instanceof I){var b=arguments[0],M=arguments[1];this.x=b.y*M.w-M.y*b.w,this.y=M.x*b.w-b.x*M.w,this.w=b.x*M.y-M.x*b.y}else if(arguments[0]instanceof Xe&&arguments[1]instanceof Xe){var F=arguments[0],q=arguments[1];this.x=F.y-q.y,this.y=q.x-F.x,this.w=F.x*q.y-q.x*F.y}}else if(arguments.length===3){var Y=arguments[0],me=arguments[1],Fe=arguments[2];this.x=Y,this.y=me,this.w=Fe}else if(arguments.length===4){var $e=arguments[0],mt=arguments[1],zt=arguments[2],Nt=arguments[3],gn=$e.y-mt.y,bn=mt.x-$e.x,Pn=$e.x*mt.y-mt.x*$e.y,ti=zt.y-Nt.y,mi=Nt.x-zt.x,li=zt.x*Nt.y-Nt.x*zt.y;this.x=bn*li-mi*Pn,this.y=ti*Pn-gn*li,this.w=gn*mi-ti*bn}}}]),I}(),Pl=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"area",value:function(){return I.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return I.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(c){if(c===null)throw new ve("Supplied point is null.");return I.interpolateZ(c,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return I.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return I.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return I.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return I.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return I.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return I.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var c=arguments[0],d=arguments[1],p=arguments[2];this.p0=c,this.p1=d,this.p2=p}},{key:"area",value:function(c,d,p){return Math.abs(((p.x-c.x)*(d.y-c.y)-(d.x-c.x)*(p.y-c.y))/2)}},{key:"signedArea",value:function(c,d,p){return((p.x-c.x)*(d.y-c.y)-(d.x-c.x)*(p.y-c.y))/2}},{key:"det",value:function(c,d,p,b){return c*b-d*p}},{key:"interpolateZ",value:function(c,d,p,b){var M=d.x,F=d.y,q=p.x-M,Y=b.x-M,me=p.y-F,Fe=b.y-F,$e=q*Fe-Y*me,mt=c.x-M,zt=c.y-F,Nt=(Fe*mt-Y*zt)/$e,gn=(-me*mt+q*zt)/$e;return d.getZ()+Nt*(p.getZ()-d.getZ())+gn*(b.getZ()-d.getZ())}},{key:"longestSideLength",value:function(c,d,p){var b=c.distance(d),M=d.distance(p),F=p.distance(c),q=b;return M>q&&(q=M),F>q&&(q=F),q}},{key:"circumcentreDD",value:function(c,d,p){var b=ct.valueOf(c.x).subtract(p.x),M=ct.valueOf(c.y).subtract(p.y),F=ct.valueOf(d.x).subtract(p.x),q=ct.valueOf(d.y).subtract(p.y),Y=ct.determinant(b,M,F,q).multiply(2),me=b.sqr().add(M.sqr()),Fe=F.sqr().add(q.sqr()),$e=ct.determinant(M,me,q,Fe),mt=ct.determinant(b,me,F,Fe),zt=ct.valueOf(p.x).subtract($e.divide(Y)).doubleValue(),Nt=ct.valueOf(p.y).add(mt.divide(Y)).doubleValue();return new Xe(zt,Nt)}},{key:"isAcute",value:function(c,d,p){return!!Bi.isAcute(c,d,p)&&!!Bi.isAcute(d,p,c)&&!!Bi.isAcute(p,c,d)}},{key:"circumcentre",value:function(c,d,p){var b=p.x,M=p.y,F=c.x-b,q=c.y-M,Y=d.x-b,me=d.y-M,Fe=2*I.det(F,q,Y,me),$e=I.det(q,F*F+q*q,me,Y*Y+me*me),mt=I.det(F,F*F+q*q,Y,Y*Y+me*me);return new Xe(b-$e/Fe,M+mt/Fe)}},{key:"perpendicularBisector",value:function(c,d){var p=d.x-c.x,b=d.y-c.y,M=new qs(c.x+p/2,c.y+b/2,1),F=new qs(c.x-b+p/2,c.y+p+b/2,1);return new qs(M,F)}},{key:"angleBisector",value:function(c,d,p){var b=d.distance(c),M=b/(b+d.distance(p)),F=p.x-c.x,q=p.y-c.y;return new Xe(c.x+M*F,c.y+M*q)}},{key:"area3D",value:function(c,d,p){var b=d.x-c.x,M=d.y-c.y,F=d.getZ()-c.getZ(),q=p.x-c.x,Y=p.y-c.y,me=p.getZ()-c.getZ(),Fe=M*me-F*Y,$e=F*q-b*me,mt=b*Y-M*q,zt=Fe*Fe+$e*$e+mt*mt,Nt=Math.sqrt(zt)/2;return Nt}},{key:"centroid",value:function(c,d,p){var b=(c.x+d.x+p.x)/3,M=(c.y+d.y+p.y)/3;return new Xe(b,M)}},{key:"inCentre",value:function(c,d,p){var b=d.distance(p),M=c.distance(p),F=c.distance(d),q=b+M+F,Y=(b*c.x+M*d.x+F*p.x)/q,me=(b*c.y+M*d.y+F*p.y)/q;return new Xe(Y,me)}}]),I}(),kc=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"addRingSide",value:function(c,d,p,b,M){if(d===0&&c.length<wi.MINIMUM_VALID_SIZE)return null;var F=b,q=M;c.length>=wi.MINIMUM_VALID_SIZE&&mn.isCCW(c)&&(F=M,q=b,p=Ee.opposite(p));var Y=this._curveBuilder.getRingCurve(c,p,d);this.addCurve(Y,F,q)}},{key:"addRingBothSides",value:function(c,d){this.addRingSide(c,d,Ee.LEFT,Se.EXTERIOR,Se.INTERIOR),this.addRingSide(c,d,Ee.RIGHT,Se.INTERIOR,Se.EXTERIOR)}},{key:"addPoint",value:function(c){if(this._distance<=0)return null;var d=c.getCoordinates(),p=this._curveBuilder.getLineCurve(d,this._distance);this.addCurve(p,Se.EXTERIOR,Se.INTERIOR)}},{key:"addPolygon",value:function(c){var d=this._distance,p=Ee.LEFT;this._distance<0&&(d=-this._distance,p=Ee.RIGHT);var b=c.getExteriorRing(),M=Xn.removeRepeatedPoints(b.getCoordinates());if(this._distance<0&&this.isErodedCompletely(b,this._distance)||this._distance<=0&&M.length<3)return null;this.addRingSide(M,d,p,Se.EXTERIOR,Se.INTERIOR);for(var F=0;F<c.getNumInteriorRing();F++){var q=c.getInteriorRingN(F),Y=Xn.removeRepeatedPoints(q.getCoordinates());this._distance>0&&this.isErodedCompletely(q,-this._distance)||this.addRingSide(Y,d,Ee.opposite(p),Se.INTERIOR,Se.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(c,d){var p=new Pl(c[0],c[1],c[2]),b=p.inCentre();return Ki.pointToSegment(b,p.p0,p.p1)<Math.abs(d)}},{key:"addLineString",value:function(c){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var d=Xn.removeRepeatedPoints(c.getCoordinates());if(Xn.isRing(d)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(d,this._distance);else{var p=this._curveBuilder.getLineCurve(d,this._distance);this.addCurve(p,Se.EXTERIOR,Se.INTERIOR)}}},{key:"addCurve",value:function(c,d,p){if(c===null||c.length<2)return null;var b=new xs(c,new bi(0,Se.BOUNDARY,d,p));this._curveList.add(b)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(c){if(c.isEmpty())return null;if(c instanceof en)this.addPolygon(c);else if(c instanceof We)this.addLineString(c);else if(c instanceof et)this.addPoint(c);else if(c instanceof Fn)this.addCollection(c);else if(c instanceof no)this.addCollection(c);else if(c instanceof Cr)this.addCollection(c);else{if(!(c instanceof An))throw new Lt(c.getGeometryType());this.addCollection(c)}}},{key:"isErodedCompletely",value:function(c,d){var p=c.getCoordinates();if(p.length<4)return d<0;if(p.length===4)return this.isTriangleErodedCompletely(p,d);var b=c.getEnvelopeInternal(),M=Math.min(b.getHeight(),b.getWidth());return d<0&&2*Math.abs(d)>M}},{key:"addCollection",value:function(c){for(var d=0;d<c.getNumGeometries();d++){var p=c.getGeometryN(d);this.add(p)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Tt;var c=arguments[0],d=arguments[1],p=arguments[2];this._inputGeom=c,this._distance=d,this._curveBuilder=p}}]),I}(),Di=function(){function I(){n(this,I)}return a(I,[{key:"locate",value:function(c){}}]),I}(),Ic=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,I.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Je;var c=this._parent.getGeometryN(this._index++);return c instanceof An?(this._subcollectionIterator=new I(c),this._subcollectionIterator.next()):c}},{key:"remove",value:function(){throw new Lt(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[hu]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var c=arguments[0];this._parent=c,this._atStart=!0,this._index=0,this._max=c.getNumGeometries()}},{key:"isAtomic",value:function(c){return!(c instanceof An)}}]),I}(),Bn=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"locate",value:function(c){return I.locate(c,this._geom)}},{key:"interfaces_",get:function(){return[Di]}}],[{key:"constructor_",value:function(){this._geom=null;var c=arguments[0];this._geom=c}},{key:"locatePointInPolygon",value:function(c,d){if(d.isEmpty())return Se.EXTERIOR;var p=d.getExteriorRing(),b=I.locatePointInRing(c,p);if(b!==Se.INTERIOR)return b;for(var M=0;M<d.getNumInteriorRing();M++){var F=d.getInteriorRingN(M),q=I.locatePointInRing(c,F);if(q===Se.BOUNDARY)return Se.BOUNDARY;if(q===Se.INTERIOR)return Se.EXTERIOR}return Se.INTERIOR}},{key:"locatePointInRing",value:function(c,d){return d.getEnvelopeInternal().intersects(c)?Vs.locateInRing(c,d.getCoordinates()):Se.EXTERIOR}},{key:"containsPointInPolygon",value:function(c,d){return Se.EXTERIOR!==I.locatePointInPolygon(c,d)}},{key:"locateInGeometry",value:function(c,d){if(d instanceof en)return I.locatePointInPolygon(c,d);if(d instanceof An)for(var p=new Ic(d);p.hasNext();){var b=p.next();if(b!==d){var M=I.locateInGeometry(c,b);if(M!==Se.EXTERIOR)return M}}return Se.EXTERIOR}},{key:"isContained",value:function(c,d){return Se.EXTERIOR!==I.locate(c,d)}},{key:"locate",value:function(c,d){return d.isEmpty()?Se.EXTERIOR:d.getEnvelopeInternal().intersects(c)?I.locateInGeometry(c,d):Se.EXTERIOR}}]),I}(),Wa=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getNextCW",value:function(c){this.getEdges();var d=this._edgeList.indexOf(c),p=d-1;return d===0&&(p=this._edgeList.size()-1),this._edgeList.get(p)}},{key:"propagateSideLabels",value:function(c){for(var d=Se.NONE,p=this.iterator();p.hasNext();){var b=p.next().getLabel();b.isArea(c)&&b.getLocation(c,Ee.LEFT)!==Se.NONE&&(d=b.getLocation(c,Ee.LEFT))}if(d===Se.NONE)return null;for(var M=d,F=this.iterator();F.hasNext();){var q=F.next(),Y=q.getLabel();if(Y.getLocation(c,Ee.ON)===Se.NONE&&Y.setLocation(c,Ee.ON,M),Y.isArea(c)){var me=Y.getLocation(c,Ee.LEFT),Fe=Y.getLocation(c,Ee.RIGHT);if(Fe!==Se.NONE){if(Fe!==M)throw new At("side location conflict",q.getCoordinate());me===Se.NONE&&It.shouldNeverReachHere("found single null side (at "+q.getCoordinate()+")"),M=me}else It.isTrue(Y.getLocation(c,Ee.LEFT)===Se.NONE,"found single null side"),Y.setLocation(c,Ee.RIGHT,M),Y.setLocation(c,Ee.LEFT,M)}}}},{key:"getCoordinate",value:function(){var c=this.iterator();return c.hasNext()?c.next().getCoordinate():null}},{key:"print",value:function(c){Mi.out.println("EdgeEndStar:   "+this.getCoordinate());for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"isAreaLabelsConsistent",value:function(c){return this.computeEdgeEndLabels(c.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(c){var d=this.getEdges();if(d.size()<=0)return!0;var p=d.size()-1,b=d.get(p).getLabel().getLocation(c,Ee.LEFT);It.isTrue(b!==Se.NONE,"Found unlabelled area edge");for(var M=b,F=this.iterator();F.hasNext();){var q=F.next().getLabel();It.isTrue(q.isArea(c),"Found non-area edge");var Y=q.getLocation(c,Ee.LEFT),me=q.getLocation(c,Ee.RIGHT);if(Y===me||me!==M)return!1;M=Y}return!0}},{key:"findIndex",value:function(c){this.iterator();for(var d=0;d<this._edgeList.size();d++)if(this._edgeList.get(d)===c)return d;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new Tt(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(c,d,p){return this._ptInAreaLocation[c]===Se.NONE&&(this._ptInAreaLocation[c]=Bn.locate(d,p[c].getGeometry())),this._ptInAreaLocation[c]}},{key:"toString",value:function(){var c=new qi;c.append("EdgeEndStar:   "+this.getCoordinate()),c.append(`
`);for(var d=this.iterator();d.hasNext();){var p=d.next();c.append(p),c.append(`
`)}return c.toString()}},{key:"computeEdgeEndLabels",value:function(c){for(var d=this.iterator();d.hasNext();)d.next().computeLabel(c)}},{key:"computeLabelling",value:function(c){this.computeEdgeEndLabels(c[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var d=[!1,!1],p=this.iterator();p.hasNext();)for(var b=p.next().getLabel(),M=0;M<2;M++)b.isLine(M)&&b.getLocation(M)===Se.BOUNDARY&&(d[M]=!0);for(var F=this.iterator();F.hasNext();)for(var q=F.next(),Y=q.getLabel(),me=0;me<2;me++)if(Y.isAnyNull(me)){var Fe=Se.NONE;if(d[me])Fe=Se.EXTERIOR;else{var $e=q.getCoordinate();Fe=this.getLocation(me,$e,c)}Y.setAllLocationsIfNull(me,Fe)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(c,d){this._edgeMap.put(c,d),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new Bo,this._edgeList=null,this._ptInAreaLocation=[Se.NONE,Se.NONE]}}]),I}(),pi=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var p=null,b=null,M=this._SCANNING_FOR_INCOMING,F=0;F<this._resultAreaEdgeList.size();F++){var q=this._resultAreaEdgeList.get(F),Y=q.getSym();if(q.getLabel().isArea())switch(p===null&&q.isInResult()&&(p=q),M){case this._SCANNING_FOR_INCOMING:if(!Y.isInResult())continue;b=Y,M=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!q.isInResult())continue;b.setNext(q),M=this._SCANNING_FOR_INCOMING}}if(M===this._LINKING_TO_OUTGOING){if(p===null)throw new At("no outgoing dirEdge found",this.getCoordinate());It.isTrue(p.isInResult(),"unable to link last incoming dirEdge"),b.setNext(p)}}},{key:"insert",value:function(p){var b=p;this.insertEdgeEnd(b,b)}},{key:"getRightmostEdge",value:function(){var p=this.getEdges(),b=p.size();if(b<1)return null;var M=p.get(0);if(b===1)return M;var F=p.get(b-1),q=M.getQuadrant(),Y=F.getQuadrant();return hr.isNorthern(q)&&hr.isNorthern(Y)?M:hr.isNorthern(q)||hr.isNorthern(Y)?M.getDy()!==0?M:F.getDy()!==0?F:(It.shouldNeverReachHere("found two horizontal edges incident on node"),null):F}},{key:"print",value:function(p){Mi.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var b=this.iterator();b.hasNext();){var M=b.next();p.print("out "),M.print(p),p.println(),p.print("in "),M.getSym().print(p),p.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Tt;for(var p=this.iterator();p.hasNext();){var b=p.next();(b.isInResult()||b.getSym().isInResult())&&this._resultAreaEdgeList.add(b)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(p){for(var b=this.iterator();b.hasNext();){var M=b.next().getLabel();M.setAllLocationsIfNull(0,p.getLocation(0)),M.setAllLocationsIfNull(1,p.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var p=null,b=null,M=this._edgeList.size()-1;M>=0;M--){var F=this._edgeList.get(M),q=F.getSym();b===null&&(b=q),p!==null&&q.setNext(p),p=F}b.setNext(p)}},{key:"computeDepths",value:function(){if(arguments.length===1){var p=arguments[0],b=this.findIndex(p),M=p.getDepth(Ee.LEFT),F=p.getDepth(Ee.RIGHT),q=this.computeDepths(b+1,this._edgeList.size(),M),Y=this.computeDepths(0,b,q);if(Y!==F)throw new At("depth mismatch at "+p.getCoordinate())}else if(arguments.length===3){for(var me=arguments[0],Fe=arguments[1],$e=arguments[2],mt=$e,zt=me;zt<Fe;zt++){var Nt=this._edgeList.get(zt);Nt.setEdgeDepths(Ee.RIGHT,mt),mt=Nt.getDepth(Ee.LEFT)}return mt}}},{key:"mergeSymLabels",value:function(){for(var p=this.iterator();p.hasNext();){var b=p.next();b.getLabel().merge(b.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(p){for(var b=null,M=null,F=this._SCANNING_FOR_INCOMING,q=this._resultAreaEdgeList.size()-1;q>=0;q--){var Y=this._resultAreaEdgeList.get(q),me=Y.getSym();switch(b===null&&Y.getEdgeRing()===p&&(b=Y),F){case this._SCANNING_FOR_INCOMING:if(me.getEdgeRing()!==p)continue;M=me,F=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(Y.getEdgeRing()!==p)continue;M.setNextMin(Y),F=this._SCANNING_FOR_INCOMING}}F===this._LINKING_TO_OUTGOING&&(It.isTrue(b!==null,"found null for first outgoing dirEdge"),It.isTrue(b.getEdgeRing()===p,"unable to link last incoming dirEdge"),M.setNextMin(b))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var p=0,b=this.iterator();b.hasNext();){var M=b.next();M.isInResult()&&p++}return p}if(arguments.length===1){for(var F=arguments[0],q=0,Y=this.iterator();Y.hasNext();){var me=Y.next();me.getEdgeRing()===F&&q++}return q}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var p=Se.NONE,b=this.iterator();b.hasNext();){var M=b.next(),F=M.getSym();if(!M.isLineEdge()){if(M.isInResult()){p=Se.INTERIOR;break}if(F.isInResult()){p=Se.EXTERIOR;break}}}if(p===Se.NONE)return null;for(var q=p,Y=this.iterator();Y.hasNext();){var me=Y.next(),Fe=me.getSym();me.isLineEdge()?me.getEdge().setCovered(q===Se.INTERIOR):(me.isInResult()&&(q=Se.EXTERIOR),Fe.isInResult()&&(q=Se.INTERIOR))}}},{key:"computeLabelling",value:function(p){U(m(d.prototype),"computeLabelling",this).call(this,p),this._label=new bi(Se.NONE);for(var b=this.iterator();b.hasNext();)for(var M=b.next().getEdge().getLabel(),F=0;F<2;F++){var q=M.getLocation(F);q!==Se.INTERIOR&&q!==Se.BOUNDARY||this._label.setLocation(F,Se.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}]),d}(Wa),ci=function(I){f(d,I);var c=B(d);function d(){return n(this,d),c.call(this)}return a(d,[{key:"createNode",value:function(p){return new ma(p,new pi)}}]),d}(Ba),oo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"compareTo",value:function(c){var d=c;return I.compareOriented(this._pts,this._orientation,d._pts,d._orientation)}},{key:"interfaces_",get:function(){return[he]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var c=arguments[0];this._pts=c,this._orientation=I.orientation(c)}},{key:"orientation",value:function(c){return Xn.increasingDirection(c)===1}},{key:"compareOriented",value:function(c,d,p,b){for(var M=d?1:-1,F=b?1:-1,q=d?c.length:-1,Y=b?p.length:-1,me=d?0:c.length-1,Fe=b?0:p.length-1;;){var $e=c[me].compareTo(p[Fe]);if($e!==0)return $e;var mt=(me+=M)===q,zt=(Fe+=F)===Y;if(mt&&!zt)return-1;if(!mt&&zt)return 1;if(mt&&zt)return 0}}}]),I}(),ba=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"print",value:function(c){c.print("MULTILINESTRING ( ");for(var d=0;d<this._edges.size();d++){var p=this._edges.get(d);d>0&&c.print(","),c.print("(");for(var b=p.getCoordinates(),M=0;M<b.length;M++)M>0&&c.print(","),c.print(b[M].x+" "+b[M].y);c.println(")")}c.print(")  ")}},{key:"addAll",value:function(c){for(var d=c.iterator();d.hasNext();)this.add(d.next())}},{key:"findEdgeIndex",value:function(c){for(var d=0;d<this._edges.size();d++)if(this._edges.get(d).equals(c))return d;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(c){return this._edges.get(c)}},{key:"findEqualEdge",value:function(c){var d=new oo(c.getCoordinates());return this._ocaMap.get(d)}},{key:"add",value:function(c){this._edges.add(c);var d=new oo(c.getCoordinates());this._ocaMap.put(d,c)}}],[{key:"constructor_",value:function(){this._edges=new Tt,this._ocaMap=new Bo}}]),I}(),Zo=function(){function I(){n(this,I)}return a(I,[{key:"processIntersections",value:function(c,d,p,b){}},{key:"isDone",value:function(){}}]),I}(),Rl=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isTrivialIntersection",value:function(c,d,p,b){if(c===p&&this._li.getIntersectionNum()===1){if(I.isAdjacentSegments(d,b))return!0;if(c.isClosed()){var M=c.size()-1;if(d===0&&b===M||b===0&&d===M)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(c,d,p,b){if(c===p&&d===b)return null;this.numTests++;var M=c.getCoordinates()[d],F=c.getCoordinates()[d+1],q=p.getCoordinates()[b],Y=p.getCoordinates()[b+1];this._li.computeIntersection(M,F,q,Y),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(c,d,p,b)||(this._hasIntersection=!0,c.addIntersections(this._li,d,0),p.addIntersections(this._li,b,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[Zo]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var c=arguments[0];this._li=c}},{key:"isAdjacentSegments",value:function(c,d){return Math.abs(c-d)===1}}]),I}(),So=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(c){c.print(this.coord),c.print(" seg # = "+this.segmentIndex),c.println(" dist = "+this.dist)}},{key:"compareTo",value:function(c){var d=c;return this.compare(d.segmentIndex,d.dist)}},{key:"isEndPoint",value:function(c){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===c}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(c,d){return this.segmentIndex<c?-1:this.segmentIndex>c?1:this.dist<d?-1:this.dist>d?1:0}},{key:"interfaces_",get:function(){return[he]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var c=arguments[0],d=arguments[1],p=arguments[2];this.coord=new Xe(c),this.segmentIndex=d,this.dist=p}}]),I}(),Ho=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"print",value:function(c){c.println("Intersections:");for(var d=this.iterator();d.hasNext();)d.next().print(c)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(c){this.addEndpoints();for(var d=this.iterator(),p=d.next();d.hasNext();){var b=d.next(),M=this.createSplitEdge(p,b);c.add(M),p=b}}},{key:"addEndpoints",value:function(){var c=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[c],c,0)}},{key:"createSplitEdge",value:function(c,d){var p=d.segmentIndex-c.segmentIndex+2,b=this.edge.pts[d.segmentIndex],M=d.dist>0||!d.coord.equals2D(b);M||p--;var F=new Array(p).fill(null),q=0;F[q++]=new Xe(c.coord);for(var Y=c.segmentIndex+1;Y<=d.segmentIndex;Y++)F[q++]=this.edge.pts[Y];return M&&(F[q]=d.coord),new Wo(F,new bi(this.edge._label))}},{key:"add",value:function(c,d,p){var b=new So(c,d,p),M=this._nodeMap.get(b);return M!==null?M:(this._nodeMap.put(b,b),b)}},{key:"isIntersection",value:function(c){for(var d=this.iterator();d.hasNext();)if(d.next().coord.equals(c))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new Bo,this.edge=null;var c=arguments[0];this.edge=c}}]),I}(),is=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])||I.isTrue(this._matrix[Se.INTERIOR][Se.BOUNDARY])||I.isTrue(this._matrix[Se.BOUNDARY][Se.INTERIOR])||I.isTrue(this._matrix[Se.BOUNDARY][Se.BOUNDARY]))&&this._matrix[Se.EXTERIOR][Se.INTERIOR]===le.FALSE&&this._matrix[Se.EXTERIOR][Se.BOUNDARY]===le.FALSE}},{key:"isCoveredBy",value:function(){return(I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])||I.isTrue(this._matrix[Se.INTERIOR][Se.BOUNDARY])||I.isTrue(this._matrix[Se.BOUNDARY][Se.INTERIOR])||I.isTrue(this._matrix[Se.BOUNDARY][Se.BOUNDARY]))&&this._matrix[Se.INTERIOR][Se.EXTERIOR]===le.FALSE&&this._matrix[Se.BOUNDARY][Se.EXTERIOR]===le.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var c=arguments[0],d=0;d<c.length;d++){var p=Math.trunc(d/3),b=d%3;this._matrix[p][b]=le.toDimensionValue(c.charAt(d))}else if(arguments.length===3){var M=arguments[0],F=arguments[1],q=arguments[2];this._matrix[M][F]=q}}},{key:"isContains",value:function(){return I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&this._matrix[Se.EXTERIOR][Se.INTERIOR]===le.FALSE&&this._matrix[Se.EXTERIOR][Se.BOUNDARY]===le.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var c=arguments[0],d=0;d<c.length;d++){var p=Math.trunc(d/3),b=d%3;this.setAtLeast(p,b,le.toDimensionValue(c.charAt(d)))}else if(arguments.length===3){var M=arguments[0],F=arguments[1],q=arguments[2];this._matrix[M][F]<q&&(this._matrix[M][F]=q)}}},{key:"setAtLeastIfValid",value:function(c,d,p){c>=0&&d>=0&&this.setAtLeast(c,d,p)}},{key:"isWithin",value:function(){return I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&this._matrix[Se.INTERIOR][Se.EXTERIOR]===le.FALSE&&this._matrix[Se.BOUNDARY][Se.EXTERIOR]===le.FALSE}},{key:"isTouches",value:function(c,d){return c>d?this.isTouches(d,c):(c===le.A&&d===le.A||c===le.L&&d===le.L||c===le.L&&d===le.A||c===le.P&&d===le.A||c===le.P&&d===le.L)&&this._matrix[Se.INTERIOR][Se.INTERIOR]===le.FALSE&&(I.isTrue(this._matrix[Se.INTERIOR][Se.BOUNDARY])||I.isTrue(this._matrix[Se.BOUNDARY][Se.INTERIOR])||I.isTrue(this._matrix[Se.BOUNDARY][Se.BOUNDARY]))}},{key:"isOverlaps",value:function(c,d){return c===le.P&&d===le.P||c===le.A&&d===le.A?I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&I.isTrue(this._matrix[Se.INTERIOR][Se.EXTERIOR])&&I.isTrue(this._matrix[Se.EXTERIOR][Se.INTERIOR]):c===le.L&&d===le.L&&this._matrix[Se.INTERIOR][Se.INTERIOR]===1&&I.isTrue(this._matrix[Se.INTERIOR][Se.EXTERIOR])&&I.isTrue(this._matrix[Se.EXTERIOR][Se.INTERIOR])}},{key:"isEquals",value:function(c,d){return c===d&&I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&this._matrix[Se.INTERIOR][Se.EXTERIOR]===le.FALSE&&this._matrix[Se.BOUNDARY][Se.EXTERIOR]===le.FALSE&&this._matrix[Se.EXTERIOR][Se.INTERIOR]===le.FALSE&&this._matrix[Se.EXTERIOR][Se.BOUNDARY]===le.FALSE}},{key:"toString",value:function(){for(var c=new Qn("123456789"),d=0;d<3;d++)for(var p=0;p<3;p++)c.setCharAt(3*d+p,le.toDimensionSymbol(this._matrix[d][p]));return c.toString()}},{key:"setAll",value:function(c){for(var d=0;d<3;d++)for(var p=0;p<3;p++)this._matrix[d][p]=c}},{key:"get",value:function(c,d){return this._matrix[c][d]}},{key:"transpose",value:function(){var c=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=c,c=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=c,c=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=c,this}},{key:"matches",value:function(c){if(c.length!==9)throw new ve("Should be length 9: "+c);for(var d=0;d<3;d++)for(var p=0;p<3;p++)if(!I.matches(this._matrix[d][p],c.charAt(3*d+p)))return!1;return!0}},{key:"add",value:function(c){for(var d=0;d<3;d++)for(var p=0;p<3;p++)this.setAtLeast(d,p,c.get(d,p))}},{key:"isDisjoint",value:function(){return this._matrix[Se.INTERIOR][Se.INTERIOR]===le.FALSE&&this._matrix[Se.INTERIOR][Se.BOUNDARY]===le.FALSE&&this._matrix[Se.BOUNDARY][Se.INTERIOR]===le.FALSE&&this._matrix[Se.BOUNDARY][Se.BOUNDARY]===le.FALSE}},{key:"isCrosses",value:function(c,d){return c===le.P&&d===le.L||c===le.P&&d===le.A||c===le.L&&d===le.A?I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&I.isTrue(this._matrix[Se.INTERIOR][Se.EXTERIOR]):c===le.L&&d===le.P||c===le.A&&d===le.P||c===le.A&&d===le.L?I.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&I.isTrue(this._matrix[Se.EXTERIOR][Se.INTERIOR]):c===le.L&&d===le.L&&this._matrix[Se.INTERIOR][Se.INTERIOR]===0}},{key:"interfaces_",get:function(){return[xe]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(le.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var c=arguments[0];I.constructor_.call(this),this.set(c)}else if(arguments[0]instanceof I){var d=arguments[0];I.constructor_.call(this),this._matrix[Se.INTERIOR][Se.INTERIOR]=d._matrix[Se.INTERIOR][Se.INTERIOR],this._matrix[Se.INTERIOR][Se.BOUNDARY]=d._matrix[Se.INTERIOR][Se.BOUNDARY],this._matrix[Se.INTERIOR][Se.EXTERIOR]=d._matrix[Se.INTERIOR][Se.EXTERIOR],this._matrix[Se.BOUNDARY][Se.INTERIOR]=d._matrix[Se.BOUNDARY][Se.INTERIOR],this._matrix[Se.BOUNDARY][Se.BOUNDARY]=d._matrix[Se.BOUNDARY][Se.BOUNDARY],this._matrix[Se.BOUNDARY][Se.EXTERIOR]=d._matrix[Se.BOUNDARY][Se.EXTERIOR],this._matrix[Se.EXTERIOR][Se.INTERIOR]=d._matrix[Se.EXTERIOR][Se.INTERIOR],this._matrix[Se.EXTERIOR][Se.BOUNDARY]=d._matrix[Se.EXTERIOR][Se.BOUNDARY],this._matrix[Se.EXTERIOR][Se.EXTERIOR]=d._matrix[Se.EXTERIOR][Se.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var c=arguments[0],d=arguments[1];return d===le.SYM_DONTCARE||d===le.SYM_TRUE&&(c>=0||c===le.TRUE)||d===le.SYM_FALSE&&c===le.FALSE||d===le.SYM_P&&c===le.P||d===le.SYM_L&&c===le.L||d===le.SYM_A&&c===le.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var p=arguments[0],b=arguments[1],M=new I(p);return M.matches(b)}}},{key:"isTrue",value:function(c){return c>=0||c===le.TRUE}}]),I}(),Dl=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(c){return c===null||c.length===0?null:(this.ensureCapacity(this._size+c.length),Mi.arraycopy(c,0,this._data,this._size,c.length),void(this._size+=c.length))}},{key:"ensureCapacity",value:function(c){if(c<=this._data.length)return null;var d=Math.max(c,2*this._data.length);this._data=at.copyOf(this._data,d)}},{key:"toArray",value:function(){var c=new Array(this._size).fill(null);return Mi.arraycopy(this._data,0,c,0,this._size),c}},{key:"add",value:function(c){this.ensureCapacity(this._size+1),this._data[this._size]=c,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)I.constructor_.call(this,10);else if(arguments.length===1){var c=arguments[0];this._data=new Array(c).fill(null)}}}]),I}(),Nl=function(){function I(){n(this,I)}return a(I,[{key:"getChainStartIndices",value:function(c){var d=0,p=new Dl(Math.trunc(c.length/2));p.add(d);do{var b=this.findChainEnd(c,d);p.add(b),d=b}while(d<c.length-1);return p.toArray()}},{key:"findChainEnd",value:function(c,d){for(var p=hr.quadrant(c[d],c[d+1]),b=d+1;b<c.length&&hr.quadrant(c[b-1],c[b])===p;)b++;return b-1}},{key:"OLDgetChainStartIndices",value:function(c){var d=0,p=new Tt;p.add(d);do{var b=this.findChainEnd(c,d);p.add(b),d=b}while(d<c.length-1);return I.toIntArray(p)}}],[{key:"toIntArray",value:function(c){for(var d=new Array(c.size()).fill(null),p=0;p<d.length;p++)d[p]=c.get(p).intValue();return d}}]),I}(),zl=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(c){var d=this.pts[this.startIndex[c]].x,p=this.pts[this.startIndex[c+1]].x;return d>p?d:p}},{key:"getMinX",value:function(c){var d=this.pts[this.startIndex[c]].x,p=this.pts[this.startIndex[c+1]].x;return d<p?d:p}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var c=arguments[0],d=arguments[1],p=arguments[2],b=arguments[3];this.computeIntersectsForChain(this.startIndex[c],this.startIndex[c+1],d,d.startIndex[p],d.startIndex[p+1],b)}else if(arguments.length===6){var M=arguments[0],F=arguments[1],q=arguments[2],Y=arguments[3],me=arguments[4],Fe=arguments[5];if(F-M==1&&me-Y==1)return Fe.addIntersections(this.e,M,q.e,Y),null;if(!this.overlaps(M,F,q,Y,me))return null;var $e=Math.trunc((M+F)/2),mt=Math.trunc((Y+me)/2);M<$e&&(Y<mt&&this.computeIntersectsForChain(M,$e,q,Y,mt,Fe),mt<me&&this.computeIntersectsForChain(M,$e,q,mt,me,Fe)),$e<F&&(Y<mt&&this.computeIntersectsForChain($e,F,q,Y,mt,Fe),mt<me&&this.computeIntersectsForChain($e,F,q,mt,me,Fe))}}},{key:"overlaps",value:function(c,d,p,b,M){return dn.intersects(this.pts[c],this.pts[d],p.pts[b],p.pts[M])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(c,d){for(var p=0;p<this.startIndex.length-1;p++)for(var b=0;b<c.startIndex.length-1;b++)this.computeIntersectsForChain(p,c,b,d)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var c=arguments[0];this.e=c,this.pts=c.getCoordinates();var d=new Nl;this.startIndex=d.getChainStartIndices(this.pts)}}]),I}(),ao=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"getDepth",value:function(c,d){return this._depth[c][d]}},{key:"setDepth",value:function(c,d,p){this._depth[c][d]=p}},{key:"isNull",value:function(){if(arguments.length===0){for(var c=0;c<2;c++)for(var d=0;d<3;d++)if(this._depth[c][d]!==I.NULL_VALUE)return!1;return!0}if(arguments.length===1){var p=arguments[0];return this._depth[p][1]===I.NULL_VALUE}if(arguments.length===2){var b=arguments[0],M=arguments[1];return this._depth[b][M]===I.NULL_VALUE}}},{key:"normalize",value:function(){for(var c=0;c<2;c++)if(!this.isNull(c)){var d=this._depth[c][1];this._depth[c][2]<d&&(d=this._depth[c][2]),d<0&&(d=0);for(var p=1;p<3;p++){var b=0;this._depth[c][p]>d&&(b=1),this._depth[c][p]=b}}}},{key:"getDelta",value:function(c){return this._depth[c][Ee.RIGHT]-this._depth[c][Ee.LEFT]}},{key:"getLocation",value:function(c,d){return this._depth[c][d]<=0?Se.EXTERIOR:Se.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var c=arguments[0],d=0;d<2;d++)for(var p=1;p<3;p++){var b=c.getLocation(d,p);b!==Se.EXTERIOR&&b!==Se.INTERIOR||(this.isNull(d,p)?this._depth[d][p]=I.depthAtLocation(b):this._depth[d][p]+=I.depthAtLocation(b))}else if(arguments.length===3){var M=arguments[0],F=arguments[1],q=arguments[2];q===Se.INTERIOR&&this._depth[M][F]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var c=0;c<2;c++)for(var d=0;d<3;d++)this._depth[c][d]=I.NULL_VALUE}},{key:"depthAtLocation",value:function(c){return c===Se.EXTERIOR?0:c===Se.INTERIOR?1:I.NULL_VALUE}}]),I}();ao.NULL_VALUE=-1;var Wo=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var p=new Array(2).fill(null);return p[0]=this.pts[0],p[1]=this.pts[1],new d(p,bi.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(p){this._isIsolated=p}},{key:"setName",value:function(p){this._name=p}},{key:"equals",value:function(p){if(!(p instanceof d))return!1;var b=p;if(this.pts.length!==b.pts.length)return!1;for(var M=!0,F=!0,q=this.pts.length,Y=0;Y<this.pts.length;Y++)if(this.pts[Y].equals2D(b.pts[Y])||(M=!1),this.pts[Y].equals2D(b.pts[--q])||(F=!1),!M&&!F)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var p=arguments[0];return this.pts[p]}}},{key:"print",value:function(p){p.print("edge "+this._name+": "),p.print("LINESTRING (");for(var b=0;b<this.pts.length;b++)b>0&&p.print(","),p.print(this.pts[b].x+" "+this.pts[b].y);p.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(p){d.updateIM(this._label,p)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(p){p.print("edge "+this._name+": ");for(var b=this.pts.length-1;b>=0;b--)p.print(this.pts[b]+" ");p.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new zl(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new dn;for(var p=0;p<this.pts.length;p++)this._env.expandToInclude(this.pts[p])}return this._env}},{key:"addIntersection",value:function(p,b,M,F){var q=new Xe(p.getIntersection(F)),Y=b,me=p.getEdgeDistance(M,F),Fe=Y+1;if(Fe<this.pts.length){var $e=this.pts[Fe];q.equals2D($e)&&(Y=Fe,me=0)}this.eiList.add(q,Y,me)}},{key:"toString",value:function(){var p=new Qn;p.append("edge "+this._name+": "),p.append("LINESTRING (");for(var b=0;b<this.pts.length;b++)b>0&&p.append(","),p.append(this.pts[b].x+" "+this.pts[b].y);return p.append(")  "+this._label+" "+this._depthDelta),p.toString()}},{key:"isPointwiseEqual",value:function(p){if(this.pts.length!==p.pts.length)return!1;for(var b=0;b<this.pts.length;b++)if(!this.pts[b].equals2D(p.pts[b]))return!1;return!0}},{key:"setDepthDelta",value:function(p){this._depthDelta=p}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(p,b,M){for(var F=0;F<p.getIntersectionNum();F++)this.addIntersection(p,b,M,F)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new Ho(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new ao,this._depthDelta=0,arguments.length===1){var p=arguments[0];d.constructor_.call(this,p,null)}else if(arguments.length===2){var b=arguments[0],M=arguments[1];this.pts=b,this._label=M}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof is&&arguments[0]instanceof bi))return U(m(d),"updateIM",this).apply(this,arguments);var p=arguments[0],b=arguments[1];b.setAtLeastIfValid(p.getLocation(0,Ee.ON),p.getLocation(1,Ee.ON),1),p.isArea()&&(b.setAtLeastIfValid(p.getLocation(0,Ee.LEFT),p.getLocation(1,Ee.LEFT),2),b.setAtLeastIfValid(p.getLocation(0,Ee.RIGHT),p.getLocation(1,Ee.RIGHT),2))}}]),d}(pa),Xo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"setWorkingPrecisionModel",value:function(c){this._workingPrecisionModel=c}},{key:"insertUniqueEdge",value:function(c){var d=this._edgeList.findEqualEdge(c);if(d!==null){var p=d.getLabel(),b=c.getLabel();d.isPointwiseEqual(c)||(b=new bi(c.getLabel())).flip(),p.merge(b);var M=I.depthDelta(b),F=d.getDepthDelta()+M;d.setDepthDelta(F)}else this._edgeList.add(c),c.setDepthDelta(I.depthDelta(c.getLabel()))}},{key:"buildSubgraphs",value:function(c,d){for(var p=new Tt,b=c.iterator();b.hasNext();){var M=b.next(),F=M.getRightmostCoordinate(),q=new Za(p).getDepth(F);M.computeDepth(q),M.findResultEdges(),p.add(M),d.add(M.getDirectedEdges(),M.getNodes())}}},{key:"createSubgraphs",value:function(c){for(var d=new Tt,p=c.getNodes().iterator();p.hasNext();){var b=p.next();if(!b.isVisited()){var M=new Gr;M.create(b),d.add(M)}}return jo.sort(d,jo.reverseOrder()),d}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(c){if(this._workingNoder!==null)return this._workingNoder;var d=new qa,p=new so;return p.setPrecisionModel(c),d.setSegmentIntersector(new Rl(p)),d}},{key:"buffer",value:function(c,d){var p=this._workingPrecisionModel;p===null&&(p=c.getPrecisionModel()),this._geomFact=c.getFactory();var b=new Al(p,this._bufParams),M=new kc(c,d,b).getCurves();if(M.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(M,p),this._graph=new vs(new ci),this._graph.addEdges(this._edgeList.getEdges());var F=this.createSubgraphs(this._graph),q=new bc(this._geomFact);this.buildSubgraphs(F,q);var Y=q.getPolygons();return Y.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(Y)}},{key:"computeNodedEdges",value:function(c,d){var p=this.getNoder(d);p.computeNodes(c);for(var b=p.getNodedSubstrings().iterator();b.hasNext();){var M=b.next(),F=M.getCoordinates();if(F.length!==2||!F[0].equals2D(F[1])){var q=M.getData(),Y=new Wo(M.getCoordinates(),new bi(q));this.insertUniqueEdge(Y)}}}},{key:"setNoder",value:function(c){this._workingNoder=c}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new ba;var c=arguments[0];this._bufParams=c}},{key:"depthDelta",value:function(c){var d=c.getLocation(0,Ee.LEFT),p=c.getLocation(0,Ee.RIGHT);return d===Se.INTERIOR&&p===Se.EXTERIOR?1:d===Se.EXTERIOR&&p===Se.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(c){for(var d=new Kr,p=new Tt;c.hasNext();){var b=c.next(),M=d.createLineString(b.getCoordinates());p.add(M)}return d.buildGeometry(p)}}]),I}(),$o=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"rescale",value:function(){if(xn(arguments[0],lt))for(var c=arguments[0],d=c.iterator();d.hasNext();){var p=d.next();this.rescale(p.getCoordinates())}else if(arguments[0]instanceof Array){for(var b=arguments[0],M=0;M<b.length;M++)b[M].x=b[M].x/this._scaleFactor+this._offsetX,b[M].y=b[M].y/this._scaleFactor+this._offsetY;b.length===2&&b[0].equals2D(b[1])&&Mi.out.println(b)}}},{key:"scale",value:function(){if(xn(arguments[0],lt)){for(var c=arguments[0],d=new Tt(c.size()),p=c.iterator();p.hasNext();){var b=p.next();d.add(new xs(this.scale(b.getCoordinates()),b.getData()))}return d}if(arguments[0]instanceof Array){for(var M=arguments[0],F=new Array(M.length).fill(null),q=0;q<M.length;q++)F[q]=new Xe(Math.round((M[q].x-this._offsetX)*this._scaleFactor),Math.round((M[q].y-this._offsetY)*this._scaleFactor),M[q].getZ());var Y=Xn.removeRepeatedPoints(F);return Y}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var c=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(c),c}},{key:"computeNodes",value:function(c){var d=c;this._isScaled&&(d=this.scale(c)),this._noder.computeNodes(d)}},{key:"interfaces_",get:function(){return[Va]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var c=arguments[0],d=arguments[1];I.constructor_.call(this,c,d,0,0)}else if(arguments.length===4){var p=arguments[0],b=arguments[1];this._noder=p,this._scaleFactor=b,this._isScaled=!this.isIntegerPrecision()}}}]),I}(),Yo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();){var d=c.next(),p=d.getCoordinates();this.checkEndPtVertexIntersections(p[0],this._segStrings),this.checkEndPtVertexIntersections(p[p.length-1],this._segStrings)}else if(arguments.length===2){for(var b=arguments[0],M=arguments[1],F=M.iterator();F.hasNext();)for(var q=F.next(),Y=q.getCoordinates(),me=1;me<Y.length-1;me++)if(Y[me].equals(b))throw new ft("found endpt/interior pt intersection at index "+me+" :pt "+b)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();)for(var d=c.next(),p=this._segStrings.iterator();p.hasNext();){var b=p.next();this.checkInteriorIntersections(d,b)}else if(arguments.length===2)for(var M=arguments[0],F=arguments[1],q=M.getCoordinates(),Y=F.getCoordinates(),me=0;me<q.length-1;me++)for(var Fe=0;Fe<Y.length-1;Fe++)this.checkInteriorIntersections(M,me,F,Fe);else if(arguments.length===4){var $e=arguments[0],mt=arguments[1],zt=arguments[2],Nt=arguments[3];if($e===zt&&mt===Nt)return null;var gn=$e.getCoordinates()[mt],bn=$e.getCoordinates()[mt+1],Pn=zt.getCoordinates()[Nt],ti=zt.getCoordinates()[Nt+1];if(this._li.computeIntersection(gn,bn,Pn,ti),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,gn,bn)||this.hasInteriorIntersection(this._li,Pn,ti)))throw new ft("found non-noded intersection at "+gn+"-"+bn+" and "+Pn+"-"+ti)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var c=this._segStrings.iterator();c.hasNext();){var d=c.next();this.checkCollapses(d)}else if(arguments.length===1)for(var p=arguments[0],b=p.getCoordinates(),M=0;M<b.length-2;M++)this.checkCollapse(b[M],b[M+1],b[M+2])}},{key:"hasInteriorIntersection",value:function(c,d,p){for(var b=0;b<c.getIntersectionNum();b++){var M=c.getIntersection(b);if(!M.equals(d)&&!M.equals(p))return!0}return!1}},{key:"checkCollapse",value:function(c,d,p){if(c.equals(p))throw new ft("found non-noded collapse at "+I.fact.createLineString([c,d,p]))}}],[{key:"constructor_",value:function(){this._li=new so,this._segStrings=null;var c=arguments[0];this._segStrings=c}}]),I}();Yo.fact=new Kr;var Jo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"intersectsScaled",value:function(c,d){var p=Math.min(c.x,d.x),b=Math.max(c.x,d.x),M=Math.min(c.y,d.y),F=Math.max(c.y,d.y),q=this._maxx<p||this._minx>b||this._maxy<M||this._miny>F;if(q)return!1;var Y=this.intersectsToleranceSquare(c,d);return It.isTrue(!(q&&Y),"Found bad envelope test"),Y}},{key:"initCorners",value:function(c){var d=.5;this._minx=c.x-d,this._maxx=c.x+d,this._miny=c.y-d,this._maxy=c.y+d,this._corner[0]=new Xe(this._maxx,this._maxy),this._corner[1]=new Xe(this._minx,this._maxy),this._corner[2]=new Xe(this._minx,this._miny),this._corner[3]=new Xe(this._maxx,this._miny)}},{key:"intersects",value:function(c,d){return this._scaleFactor===1?this.intersectsScaled(c,d):(this.copyScaled(c,this._p0Scaled),this.copyScaled(d,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(c){return Math.round(c*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(c,d){d.x=this.scale(c.x),d.y=this.scale(c.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var c=I.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new dn(this._originalPt.x-c,this._originalPt.x+c,this._originalPt.y-c,this._originalPt.y+c)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(c,d){return this._li.computeIntersection(c,d,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,d,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,d,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(c,d,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(c,d){var p=!1,b=!1;return this._li.computeIntersection(c,d,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(c,d,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(p=!0),this._li.computeIntersection(c,d,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(b=!0),this._li.computeIntersection(c,d,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!p||!b)||!!c.equals(this._pt)||!!d.equals(this._pt))))}},{key:"addSnappedNode",value:function(c,d){var p=c.getCoordinate(d),b=c.getCoordinate(d+1);return!!this.intersects(p,b)&&(c.addIntersection(this.getCoordinate(),d),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var c=arguments[0],d=arguments[1],p=arguments[2];if(this._originalPt=c,this._pt=c,this._scaleFactor=d,this._li=p,d<=0)throw new ve("Scale factor must be non-zero");d!==1&&(this._pt=new Xe(this.scale(c.x),this.scale(c.y)),this._p0Scaled=new Xe,this._p1Scaled=new Xe),this.initCorners(this._pt)}}]),I}();Jo.SAFE_ENV_EXPANSION_FACTOR=.75;var Ko=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"select",value:function(){if(arguments.length!==1&&arguments.length===2){var c=arguments[0],d=arguments[1];c.getLineSegment(d,this.selectedSegment),this.select(this.selectedSegment)}}}],[{key:"constructor_",value:function(){this.selectedSegment=new Hr}}]),I}(),Eo=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"snap",value:function(){if(arguments.length===1){var c=arguments[0];return this.snap(c,null,-1)}if(arguments.length===3){var d=arguments[0],p=arguments[1],b=arguments[2],M=d.getSafeEnvelope(),F=new Ol(d,p,b);return this._index.query(M,new(function(){function q(){n(this,q)}return a(q,[{key:"interfaces_",get:function(){return[Cl]}},{key:"visitItem",value:function(Y){Y.select(M,F)}}]),q}())),F.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var c=arguments[0];this._index=c}}]),I}(),Ol=function(I){f(d,I);var c=B(d);function d(){var p;return n(this,d),p=c.call(this),d.constructor_.apply(L(p),arguments),p}return a(d,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof pu))return U(m(d.prototype),"select",this).apply(this,arguments);var p=arguments[0],b=arguments[1],M=p.getContext();if(this._parentEdge===M&&(b===this._hotPixelVertexIndex||b+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(M,b)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var p=arguments[0],b=arguments[1],M=arguments[2];this._hotPixel=p,this._parentEdge=b,this._hotPixelVertexIndex=M}}]),d}(Ko);Eo.HotPixelSnapAction=Ol;var Fl=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"processIntersections",value:function(c,d,p,b){if(c===p&&d===b)return null;var M=c.getCoordinates()[d],F=c.getCoordinates()[d+1],q=p.getCoordinates()[b],Y=p.getCoordinates()[b+1];if(this._li.computeIntersection(M,F,q,Y),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var me=0;me<this._li.getIntersectionNum();me++)this._interiorIntersections.add(this._li.getIntersection(me));c.addIntersections(this._li,d,0),p.addIntersections(this._li,b,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[Zo]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var c=arguments[0];this._li=c,this._interiorIntersections=new Tt}}]),I}(),$n=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"checkCorrectness",value:function(c){var d=xs.getNodedSubstrings(c),p=new Yo(d);try{p.checkValid()}catch(b){if(!(b instanceof pe))throw b;b.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return xs.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(c,d){var p=this.findInteriorIntersections(c,d);this.computeIntersectionSnaps(p),this.computeVertexSnaps(c)}},{key:"findInteriorIntersections",value:function(c,d){var p=new Fl(d);return this._noder.setSegmentIntersector(p),this._noder.computeNodes(c),p.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(xn(arguments[0],lt))for(var c=arguments[0],d=c.iterator();d.hasNext();){var p=d.next();this.computeVertexSnaps(p)}else if(arguments[0]instanceof xs)for(var b=arguments[0],M=b.getCoordinates(),F=0;F<M.length;F++){var q=new Jo(M[F],this._scaleFactor,this._li),Y=this._pointSnapper.snap(q,b,F);Y&&b.addIntersection(M[F],F)}}},{key:"computeNodes",value:function(c){this._nodedSegStrings=c,this._noder=new qa,this._pointSnapper=new Eo(this._noder.getIndex()),this.snapRound(c,this._li)}},{key:"computeIntersectionSnaps",value:function(c){for(var d=c.iterator();d.hasNext();){var p=d.next(),b=new Jo(p,this._scaleFactor,this._li);this._pointSnapper.snap(b)}}},{key:"interfaces_",get:function(){return[Va]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var c=arguments[0];this._pm=c,this._li=new so,this._li.setPrecisionModel(c),this._scaleFactor=c.getScale()}}]),I}(),Gs=function(){function I(){n(this,I),I.constructor_.apply(this,arguments)}return a(I,[{key:"bufferFixedPrecision",value:function(c){var d=new $o(new $n(new Pi(1)),c.getScale()),p=new Xo(this._bufParams);p.setWorkingPrecisionModel(c),p.setNoder(d),this._resultGeometry=p.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var c=I.MAX_PRECISION_DIGITS;c>=0;c--){try{this.bufferReducedPrecision(c)}catch(M){if(!(M instanceof At))throw M;this._saveException=M}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var d=arguments[0],p=I.precisionScaleFactor(this._argGeom,this._distance,d),b=new Pi(p);this.bufferFixedPrecision(b)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var c=this._argGeom.getFactory().getPrecisionModel();c.getType()===Pi.FIXED?this.bufferFixedPrecision(c):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(c){this._bufParams.setQuadrantSegments(c)}},{key:"bufferOriginalPrecision",value:function(){try{var c=new Xo(this._bufParams);this._resultGeometry=c.buffer(this._argGeom,this._distance)}catch(d){if(!(d instanceof ft))throw d;this._saveException=d}}},{key:"getResultGeometry",value:function(c){return this._distance=c,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(c){this._bufParams.setEndCapStyle(c)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new $,this._resultGeometry=null,this._saveException=null,arguments.length===1){var c=arguments[0];this._argGeom=c}else if(arguments.length===2){var d=arguments[0],p=arguments[1];this._argGeom=d,this._bufParams=p}}},{key:"bufferOp",value:function(){if(arguments.length===2){var c=arguments[0],d=arguments[1],p=new I(c),b=p.getResultGeometry(d);return b}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Ft&&typeof arguments[1]=="number"){var M=arguments[0],F=arguments[1],q=arguments[2],Y=new I(M);Y.setQuadrantSegments(q);var me=Y.getResultGeometry(F);return me}if(arguments[2]instanceof $&&arguments[0]instanceof Ft&&typeof arguments[1]=="number"){var Fe=arguments[0],$e=arguments[1],mt=arguments[2],zt=new I(Fe,mt),Nt=zt.getResultGeometry($e);return Nt}}else if(arguments.length===4){var gn=arguments[0],bn=arguments[1],Pn=arguments[2],ti=arguments[3],mi=new I(gn);mi.setQuadrantSegments(Pn),mi.setEndCapStyle(ti);var li=mi.getResultGeometry(bn);return li}}},{key:"precisionScaleFactor",value:function(c,d,p){var b=c.getEnvelopeInternal(),M=Er.max(Math.abs(b.getMaxX()),Math.abs(b.getMaxY()),Math.abs(b.getMinX()),Math.abs(b.getMinY()))+2*(d>0?d:0),F=p-Math.trunc(Math.log(M)/Math.log(10)+1);return Math.pow(10,F)}}]),I}();Gs.CAP_ROUND=$.CAP_ROUND,Gs.CAP_BUTT=$.CAP_FLAT,Gs.CAP_FLAT=$.CAP_FLAT,Gs.CAP_SQUARE=$.CAP_SQUARE,Gs.MAX_PRECISION_DIGITS=12;var Sc=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],Bl=function(){function I(c){n(this,I),this.geometryFactory=c||new Kr}return a(I,[{key:"read",value:function(c){var d,p=(d=typeof c=="string"?JSON.parse(c):c).type;if(!fr[p])throw new Error("Unknown GeoJSON type: "+d.type);return Sc.indexOf(p)!==-1?fr[p].call(this,d.coordinates):p==="GeometryCollection"?fr[p].call(this,d.geometries):fr[p].call(this,d)}},{key:"write",value:function(c){var d=c.getGeometryType();if(!ws[d])throw new Error("Geometry is not supported");return ws[d].call(this,c)}}]),I}(),fr={Feature:function(I){var c={};for(var d in I)c[d]=I[d];if(I.geometry){var p=I.geometry.type;if(!fr[p])throw new Error("Unknown GeoJSON type: "+I.type);c.geometry=this.read(I.geometry)}return I.bbox&&(c.bbox=fr.bbox.call(this,I.bbox)),c},FeatureCollection:function(I){var c={};if(I.features){c.features=[];for(var d=0;d<I.features.length;++d)c.features.push(this.read(I.features[d]))}return I.bbox&&(c.bbox=this.parse.bbox.call(this,I.bbox)),c},coordinates:function(I){for(var c=[],d=0;d<I.length;++d){var p=I[d];c.push(S(Xe,ee(p)))}return c},bbox:function(I){return this.geometryFactory.createLinearRing([new Xe(I[0],I[1]),new Xe(I[2],I[1]),new Xe(I[2],I[3]),new Xe(I[0],I[3]),new Xe(I[0],I[1])])},Point:function(I){var c=S(Xe,ee(I));return this.geometryFactory.createPoint(c)},MultiPoint:function(I){for(var c=[],d=0;d<I.length;++d)c.push(fr.Point.call(this,I[d]));return this.geometryFactory.createMultiPoint(c)},LineString:function(I){var c=fr.coordinates.call(this,I);return this.geometryFactory.createLineString(c)},MultiLineString:function(I){for(var c=[],d=0;d<I.length;++d)c.push(fr.LineString.call(this,I[d]));return this.geometryFactory.createMultiLineString(c)},Polygon:function(I){for(var c=fr.coordinates.call(this,I[0]),d=this.geometryFactory.createLinearRing(c),p=[],b=1;b<I.length;++b){var M=I[b],F=fr.coordinates.call(this,M),q=this.geometryFactory.createLinearRing(F);p.push(q)}return this.geometryFactory.createPolygon(d,p)},MultiPolygon:function(I){for(var c=[],d=0;d<I.length;++d){var p=I[d];c.push(fr.Polygon.call(this,p))}return this.geometryFactory.createMultiPolygon(c)},GeometryCollection:function(I){for(var c=[],d=0;d<I.length;++d){var p=I[d];c.push(this.read(p))}return this.geometryFactory.createGeometryCollection(c)}},ws={coordinate:function(I){var c=[I.x,I.y];return I.z&&c.push(I.z),I.m&&c.push(I.m),c},Point:function(I){return{type:"Point",coordinates:ws.coordinate.call(this,I.getCoordinate())}},MultiPoint:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=ws.Point.call(this,p);c.push(b.coordinates)}return{type:"MultiPoint",coordinates:c}},LineString:function(I){for(var c=[],d=I.getCoordinates(),p=0;p<d.length;++p){var b=d[p];c.push(ws.coordinate.call(this,b))}return{type:"LineString",coordinates:c}},MultiLineString:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=ws.LineString.call(this,p);c.push(b.coordinates)}return{type:"MultiLineString",coordinates:c}},Polygon:function(I){var c=[],d=ws.LineString.call(this,I._shell);c.push(d.coordinates);for(var p=0;p<I._holes.length;++p){var b=I._holes[p],M=ws.LineString.call(this,b);c.push(M.coordinates)}return{type:"Polygon",coordinates:c}},MultiPolygon:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=ws.Polygon.call(this,p);c.push(b.coordinates)}return{type:"MultiPolygon",coordinates:c}},GeometryCollection:function(I){for(var c=[],d=0;d<I._geometries.length;++d){var p=I._geometries[d],b=p.getGeometryType();c.push(ws[b].call(this,p))}return{type:"GeometryCollection",geometries:c}}};return{BufferOp:Gs,GeoJSONReader:function(){function I(c){n(this,I),this.parser=new Bl(c||new Kr)}return a(I,[{key:"read",value:function(c){return this.parser.read(c)}}]),I}(),GeoJSONWriter:function(){function I(){n(this,I),this.parser=new Bl(this.geometryFactory)}return a(I,[{key:"write",value:function(c){return this.parser.write(c)}}]),I}()}})})(hv);var xw=hv.exports;const ww=bw(xw);function Il(){return new Ff}function Ff(){this.reset()}Ff.prototype={constructor:Ff,reset:function(){this.s=this.t=0},add:function(r){u_(yf,r,this.t),u_(this,yf.s,this.s),this.s?this.t+=yf.t:this.s=yf.t},valueOf:function(){return this.s}};var yf=new Ff;function u_(r,e,n){var s=r.s=e+n,a=s-e,f=s-a;r.t=e-f+(n-a)}var Oi=1e-6,di=Math.PI,sa=di/2,c_=di/4,oa=di*2,pl=180/di,mo=di/180,qr=Math.abs,kw=Math.atan,ic=Math.atan2,nr=Math.cos,ir=Math.sin,fc=Math.sqrt;function fv(r){return r>1?0:r<-1?di:Math.acos(r)}function su(r){return r>1?sa:r<-1?-sa:Math.asin(r)}function mh(){}function Bf(r,e){r&&f_.hasOwnProperty(r.type)&&f_[r.type](r,e)}var h_={Feature:function(r,e){Bf(r.geometry,e)},FeatureCollection:function(r,e){for(var n=r.features,s=-1,a=n.length;++s<a;)Bf(n[s].geometry,e)}},f_={Sphere:function(r,e){e.sphere()},Point:function(r,e){r=r.coordinates,e.point(r[0],r[1],r[2])},MultiPoint:function(r,e){for(var n=r.coordinates,s=-1,a=n.length;++s<a;)r=n[s],e.point(r[0],r[1],r[2])},LineString:function(r,e){Ip(r.coordinates,e,0)},MultiLineString:function(r,e){for(var n=r.coordinates,s=-1,a=n.length;++s<a;)Ip(n[s],e,0)},Polygon:function(r,e){d_(r.coordinates,e)},MultiPolygon:function(r,e){for(var n=r.coordinates,s=-1,a=n.length;++s<a;)d_(n[s],e)},GeometryCollection:function(r,e){for(var n=r.geometries,s=-1,a=n.length;++s<a;)Bf(n[s],e)}};function Ip(r,e,n){var s=-1,a=r.length-n,f;for(e.lineStart();++s<a;)f=r[s],e.point(f[0],f[1],f[2]);e.lineEnd()}function d_(r,e){var n=-1,s=r.length;for(e.polygonStart();++n<s;)Ip(r[n],e,1);e.polygonEnd()}function Iw(r,e){r&&h_.hasOwnProperty(r.type)?h_[r.type](r,e):Bf(r,e)}Il();Il();function Sp(r){return[ic(r[1],r[0]),su(r[2])]}function rc(r){var e=r[0],n=r[1],s=nr(n);return[s*nr(e),s*ir(e),ir(n)]}function vf(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Uf(r,e){return[r[1]*e[2]-r[2]*e[1],r[2]*e[0]-r[0]*e[2],r[0]*e[1]-r[1]*e[0]]}function ap(r,e){r[0]+=e[0],r[1]+=e[1],r[2]+=e[2]}function bf(r,e){return[r[0]*e,r[1]*e,r[2]*e]}function Ep(r){var e=fc(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]/=e,r[1]/=e,r[2]/=e}Il();function dv(r,e){function n(s,a){return s=r(s,a),e(s[0],s[1])}return r.invert&&e.invert&&(n.invert=function(s,a){return s=e.invert(s,a),s&&r.invert(s[0],s[1])}),n}function Tp(r,e){return[r>di?r-oa:r<-di?r+oa:r,e]}Tp.invert=Tp;function Sw(r,e,n){return(r%=oa)?e||n?dv(m_(r),g_(e,n)):m_(r):e||n?g_(e,n):Tp}function p_(r){return function(e,n){return e+=r,[e>di?e-oa:e<-di?e+oa:e,n]}}function m_(r){var e=p_(r);return e.invert=p_(-r),e}function g_(r,e){var n=nr(r),s=ir(r),a=nr(e),f=ir(e);function m(l,x){var S=nr(x),C=nr(l)*S,L=ir(l)*S,N=ir(x),B=N*n+C*s;return[ic(L*a-B*f,C*n-N*s),su(B*a+L*f)]}return m.invert=function(l,x){var S=nr(x),C=nr(l)*S,L=ir(l)*S,N=ir(x),B=N*a-L*f;return[ic(L*a+N*f,C*n+B*s),su(B*n-C*s)]},m}function Ew(r,e,n,s,a,f){if(n){var m=nr(e),l=ir(e),x=s*n;a==null?(a=e+s*oa,f=e-x/2):(a=__(m,a),f=__(m,f),(s>0?a<f:a>f)&&(a+=s*oa));for(var S,C=a;s>0?C>f:C<f;C-=x)S=Sp([m,-l*nr(C),-l*ir(C)]),r.point(S[0],S[1])}}function __(r,e){e=rc(e),e[0]-=r,Ep(e);var n=fv(-e[1]);return((-e[2]<0?-n:n)+oa-Oi)%oa}function pv(){var r=[],e;return{point:function(n,s){e.push([n,s])},lineStart:function(){r.push(e=[])},lineEnd:mh,rejoin:function(){r.length>1&&r.push(r.pop().concat(r.shift()))},result:function(){var n=r;return r=[],e=null,n}}}function Tw(r,e,n,s,a,f){var m=r[0],l=r[1],x=e[0],S=e[1],C=0,L=1,N=x-m,B=S-l,U;if(U=n-m,!(!N&&U>0)){if(U/=N,N<0){if(U<C)return;U<L&&(L=U)}else if(N>0){if(U>L)return;U>C&&(C=U)}if(U=a-m,!(!N&&U<0)){if(U/=N,N<0){if(U>L)return;U>C&&(C=U)}else if(N>0){if(U<C)return;U<L&&(L=U)}if(U=s-l,!(!B&&U>0)){if(U/=B,B<0){if(U<C)return;U<L&&(L=U)}else if(B>0){if(U>L)return;U>C&&(C=U)}if(U=f-l,!(!B&&U<0)){if(U/=B,B<0){if(U>L)return;U>C&&(C=U)}else if(B>0){if(U<C)return;U<L&&(L=U)}return C>0&&(r[0]=m+C*N,r[1]=l+C*B),L<1&&(e[0]=m+L*N,e[1]=l+L*B),!0}}}}}function Lf(r,e){return qr(r[0]-e[0])<Oi&&qr(r[1]-e[1])<Oi}function xf(r,e,n,s){this.x=r,this.z=e,this.o=n,this.e=s,this.v=!1,this.n=this.p=null}function mv(r,e,n,s,a){var f=[],m=[],l,x;if(r.forEach(function(U){if(!((ee=U.length-1)<=0)){var ee,ie=U[0],re=U[ee],Q;if(Lf(ie,re)){for(a.lineStart(),l=0;l<ee;++l)a.point((ie=U[l])[0],ie[1]);a.lineEnd();return}f.push(Q=new xf(ie,U,null,!0)),m.push(Q.o=new xf(ie,null,Q,!1)),f.push(Q=new xf(re,U,null,!1)),m.push(Q.o=new xf(re,null,Q,!0))}}),!!f.length){for(m.sort(e),y_(f),y_(m),l=0,x=m.length;l<x;++l)m[l].e=n=!n;for(var S=f[0],C,L;;){for(var N=S,B=!0;N.v;)if((N=N.n)===S)return;C=N.z,a.lineStart();do{if(N.v=N.o.v=!0,N.e){if(B)for(l=0,x=C.length;l<x;++l)a.point((L=C[l])[0],L[1]);else s(N.x,N.n.x,1,a);N=N.n}else{if(B)for(C=N.p.z,l=C.length-1;l>=0;--l)a.point((L=C[l])[0],L[1]);else s(N.x,N.p.x,-1,a);N=N.p}N=N.o,C=N.z,B=!B}while(!N.v);a.lineEnd()}}}function y_(r){if(e=r.length){for(var e,n=0,s=r[0],a;++n<e;)s.n=a=r[n],a.p=s,s=a;s.n=a=r[0],a.p=s}}function gv(r,e){return r<e?-1:r>e?1:r>=e?0:NaN}function Cw(r){return r.length===1&&(r=Lw(r)),{left:function(e,n,s,a){for(s==null&&(s=0),a==null&&(a=e.length);s<a;){var f=s+a>>>1;r(e[f],n)<0?s=f+1:a=f}return s},right:function(e,n,s,a){for(s==null&&(s=0),a==null&&(a=e.length);s<a;){var f=s+a>>>1;r(e[f],n)>0?a=f:s=f+1}return s}}}function Lw(r){return function(e,n){return gv(r(e),n)}}Cw(gv);function _v(r){for(var e=r.length,n,s=-1,a=0,f,m;++s<e;)a+=r[s].length;for(f=new Array(a);--e>=0;)for(m=r[e],n=m.length;--n>=0;)f[--a]=m[n];return f}var gh=1e9,wf=-gh;function Mw(r,e,n,s){function a(S,C){return r<=S&&S<=n&&e<=C&&C<=s}function f(S,C,L,N){var B=0,U=0;if(S==null||(B=m(S,L))!==(U=m(C,L))||x(S,C)<0^L>0)do N.point(B===0||B===3?r:n,B>1?s:e);while((B=(B+L+4)%4)!==U);else N.point(C[0],C[1])}function m(S,C){return qr(S[0]-r)<Oi?C>0?0:3:qr(S[0]-n)<Oi?C>0?2:1:qr(S[1]-e)<Oi?C>0?1:0:C>0?3:2}function l(S,C){return x(S.x,C.x)}function x(S,C){var L=m(S,1),N=m(C,1);return L!==N?L-N:L===0?C[1]-S[1]:L===1?S[0]-C[0]:L===2?S[1]-C[1]:C[0]-S[0]}return function(S){var C=S,L=pv(),N,B,U,ee,ie,re,Q,$,pe,ve,De,he={point:xe,lineStart:ye,lineEnd:Ue,polygonStart:Le,polygonEnd:we};function xe(pt,St){a(pt,St)&&C.point(pt,St)}function be(){for(var pt=0,St=0,dt=B.length;St<dt;++St)for(var ut=B[St],Bt=1,vt=ut.length,wt=ut[0],ft,xt,It=wt[0],Jt=wt[1];Bt<vt;++Bt)ft=It,xt=Jt,wt=ut[Bt],It=wt[0],Jt=wt[1],xt<=s?Jt>s&&(It-ft)*(s-xt)>(Jt-xt)*(r-ft)&&++pt:Jt<=s&&(It-ft)*(s-xt)<(Jt-xt)*(r-ft)&&--pt;return pt}function Le(){C=L,N=[],B=[],De=!0}function we(){var pt=be(),St=De&&pt,dt=(N=_v(N)).length;(St||dt)&&(S.polygonStart(),St&&(S.lineStart(),f(null,null,1,S),S.lineEnd()),dt&&mv(N,l,pt,f,S),S.polygonEnd()),C=S,N=B=U=null}function ye(){he.point=Ve,B&&B.push(U=[]),ve=!0,pe=!1,Q=$=NaN}function Ue(){N&&(Ve(ee,ie),re&&pe&&L.rejoin(),N.push(L.result())),he.point=xe,pe&&C.lineEnd()}function Ve(pt,St){var dt=a(pt,St);if(B&&U.push([pt,St]),ve)ee=pt,ie=St,re=dt,ve=!1,dt&&(C.lineStart(),C.point(pt,St));else if(dt&&pe)C.point(pt,St);else{var ut=[Q=Math.max(wf,Math.min(gh,Q)),$=Math.max(wf,Math.min(gh,$))],Bt=[pt=Math.max(wf,Math.min(gh,pt)),St=Math.max(wf,Math.min(gh,St))];Tw(ut,Bt,r,e,n,s)?(pe||(C.lineStart(),C.point(ut[0],ut[1])),C.point(Bt[0],Bt[1]),dt||C.lineEnd(),De=!1):dt&&(C.lineStart(),C.point(pt,St),De=!1)}Q=pt,$=St,pe=dt}return he}}var lp=Il();function Aw(r,e){var n=e[0],s=e[1],a=[ir(n),-nr(n),0],f=0,m=0;lp.reset();for(var l=0,x=r.length;l<x;++l)if(C=(S=r[l]).length)for(var S,C,L=S[C-1],N=L[0],B=L[1]/2+c_,U=ir(B),ee=nr(B),ie=0;ie<C;++ie,N=Q,U=pe,ee=ve,L=re){var re=S[ie],Q=re[0],$=re[1]/2+c_,pe=ir($),ve=nr($),De=Q-N,he=De>=0?1:-1,xe=he*De,be=xe>di,Le=U*pe;if(lp.add(ic(Le*he*ir(xe),ee*ve+Le*nr(xe))),f+=be?De+he*oa:De,be^N>=n^Q>=n){var we=Uf(rc(L),rc(re));Ep(we);var ye=Uf(a,we);Ep(ye);var Ue=(be^De>=0?-1:1)*su(ye[2]);(s>Ue||s===Ue&&(we[0]||we[1]))&&(m+=be^De>=0?1:-1)}}return(f<-Oi||f<Oi&&lp<-Oi)^m&1}Il();function v_(r){return r}Il();Il();var sc=1/0,jf=sc,Ah=-sc,Vf=Ah,b_={point:Pw,lineStart:mh,lineEnd:mh,polygonStart:mh,polygonEnd:mh,result:function(){var r=[[sc,jf],[Ah,Vf]];return Ah=Vf=-(jf=sc=1/0),r}};function Pw(r,e){r<sc&&(sc=r),r>Ah&&(Ah=r),e<jf&&(jf=e),e>Vf&&(Vf=e)}Il();function yv(r,e,n,s){return function(a,f){var m=e(f),l=a.invert(s[0],s[1]),x=pv(),S=e(x),C=!1,L,N,B,U={point:ee,lineStart:re,lineEnd:Q,polygonStart:function(){U.point=$,U.lineStart=pe,U.lineEnd=ve,N=[],L=[]},polygonEnd:function(){U.point=ee,U.lineStart=re,U.lineEnd=Q,N=_v(N);var De=Aw(L,l);N.length?(C||(f.polygonStart(),C=!0),mv(N,Dw,De,n,f)):De&&(C||(f.polygonStart(),C=!0),f.lineStart(),n(null,null,1,f),f.lineEnd()),C&&(f.polygonEnd(),C=!1),N=L=null},sphere:function(){f.polygonStart(),f.lineStart(),n(null,null,1,f),f.lineEnd(),f.polygonEnd()}};function ee(De,he){var xe=a(De,he);r(De=xe[0],he=xe[1])&&f.point(De,he)}function ie(De,he){var xe=a(De,he);m.point(xe[0],xe[1])}function re(){U.point=ie,m.lineStart()}function Q(){U.point=ee,m.lineEnd()}function $(De,he){B.push([De,he]);var xe=a(De,he);S.point(xe[0],xe[1])}function pe(){S.lineStart(),B=[]}function ve(){$(B[0][0],B[0][1]),S.lineEnd();var De=S.clean(),he=x.result(),xe,be=he.length,Le,we,ye;if(B.pop(),L.push(B),B=null,!!be){if(De&1){if(we=he[0],(Le=we.length-1)>0){for(C||(f.polygonStart(),C=!0),f.lineStart(),xe=0;xe<Le;++xe)f.point((ye=we[xe])[0],ye[1]);f.lineEnd()}return}be>1&&De&2&&he.push(he.pop().concat(he.shift())),N.push(he.filter(Rw))}}return U}}function Rw(r){return r.length>1}function Dw(r,e){return((r=r.x)[0]<0?r[1]-sa-Oi:sa-r[1])-((e=e.x)[0]<0?e[1]-sa-Oi:sa-e[1])}const x_=yv(function(){return!0},Nw,Ow,[-di,-sa]);function Nw(r){var e=NaN,n=NaN,s=NaN,a;return{lineStart:function(){r.lineStart(),a=1},point:function(f,m){var l=f>0?di:-di,x=qr(f-e);qr(x-di)<Oi?(r.point(e,n=(n+m)/2>0?sa:-sa),r.point(s,n),r.lineEnd(),r.lineStart(),r.point(l,n),r.point(f,n),a=0):s!==l&&x>=di&&(qr(e-s)<Oi&&(e-=s*Oi),qr(f-l)<Oi&&(f-=l*Oi),n=zw(e,n,f,m),r.point(s,n),r.lineEnd(),r.lineStart(),r.point(l,n),a=0),r.point(e=f,n=m),s=l},lineEnd:function(){r.lineEnd(),e=n=NaN},clean:function(){return 2-a}}}function zw(r,e,n,s){var a,f,m=ir(r-n);return qr(m)>Oi?kw((ir(e)*(f=nr(s))*ir(n)-ir(s)*(a=nr(e))*ir(r))/(a*f*m)):(e+s)/2}function Ow(r,e,n,s){var a;if(r==null)a=n*sa,s.point(-di,a),s.point(0,a),s.point(di,a),s.point(di,0),s.point(di,-a),s.point(0,-a),s.point(-di,-a),s.point(-di,0),s.point(-di,a);else if(qr(r[0]-e[0])>Oi){var f=r[0]<e[0]?di:-di;a=n*f/2,s.point(-f,a),s.point(0,a),s.point(f,a)}else s.point(e[0],e[1])}function Fw(r,e){var n=nr(r),s=n>0,a=qr(n)>Oi;function f(C,L,N,B){Ew(B,r,e,N,C,L)}function m(C,L){return nr(C)*nr(L)>n}function l(C){var L,N,B,U,ee;return{lineStart:function(){U=B=!1,ee=1},point:function(ie,re){var Q=[ie,re],$,pe=m(ie,re),ve=s?pe?0:S(ie,re):pe?S(ie+(ie<0?di:-di),re):0;if(!L&&(U=B=pe)&&C.lineStart(),pe!==B&&($=x(L,Q),(!$||Lf(L,$)||Lf(Q,$))&&(Q[0]+=Oi,Q[1]+=Oi,pe=m(Q[0],Q[1]))),pe!==B)ee=0,pe?(C.lineStart(),$=x(Q,L),C.point($[0],$[1])):($=x(L,Q),C.point($[0],$[1]),C.lineEnd()),L=$;else if(a&&L&&s^pe){var De;!(ve&N)&&(De=x(Q,L,!0))&&(ee=0,s?(C.lineStart(),C.point(De[0][0],De[0][1]),C.point(De[1][0],De[1][1]),C.lineEnd()):(C.point(De[1][0],De[1][1]),C.lineEnd(),C.lineStart(),C.point(De[0][0],De[0][1])))}pe&&(!L||!Lf(L,Q))&&C.point(Q[0],Q[1]),L=Q,B=pe,N=ve},lineEnd:function(){B&&C.lineEnd(),L=null},clean:function(){return ee|(U&&B)<<1}}}function x(C,L,N){var B=rc(C),U=rc(L),ee=[1,0,0],ie=Uf(B,U),re=vf(ie,ie),Q=ie[0],$=re-Q*Q;if(!$)return!N&&C;var pe=n*re/$,ve=-n*Q/$,De=Uf(ee,ie),he=bf(ee,pe),xe=bf(ie,ve);ap(he,xe);var be=De,Le=vf(he,be),we=vf(be,be),ye=Le*Le-we*(vf(he,he)-1);if(!(ye<0)){var Ue=fc(ye),Ve=bf(be,(-Le-Ue)/we);if(ap(Ve,he),Ve=Sp(Ve),!N)return Ve;var pt=C[0],St=L[0],dt=C[1],ut=L[1],Bt;St<pt&&(Bt=pt,pt=St,St=Bt);var vt=St-pt,wt=qr(vt-di)<Oi,ft=wt||vt<Oi;if(!wt&&ut<dt&&(Bt=dt,dt=ut,ut=Bt),ft?wt?dt+ut>0^Ve[1]<(qr(Ve[0]-pt)<Oi?dt:ut):dt<=Ve[1]&&Ve[1]<=ut:vt>di^(pt<=Ve[0]&&Ve[0]<=St)){var xt=bf(be,(-Le+Ue)/we);return ap(xt,he),[Ve,Sp(xt)]}}}function S(C,L){var N=s?r:di-r,B=0;return C<-N?B|=1:C>N&&(B|=2),L<-N?B|=4:L>N&&(B|=8),B}return yv(m,l,f,s?[0,-r]:[-di,r-di])}function vv(r){return function(e){var n=new Cp;for(var s in r)n[s]=r[s];return n.stream=e,n}}function Cp(){}Cp.prototype={constructor:Cp,point:function(r,e){this.stream.point(r,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function bv(r,e,n){var s=e[1][0]-e[0][0],a=e[1][1]-e[0][1],f=r.clipExtent&&r.clipExtent();r.scale(150).translate([0,0]),f!=null&&r.clipExtent(null),Iw(n,r.stream(b_));var m=b_.result(),l=Math.min(s/(m[1][0]-m[0][0]),a/(m[1][1]-m[0][1])),x=+e[0][0]+(s-l*(m[1][0]+m[0][0]))/2,S=+e[0][1]+(a-l*(m[1][1]+m[0][1]))/2;return f!=null&&r.clipExtent(f),r.scale(l*150).translate([x,S])}function Bw(r,e,n){return bv(r,[[0,0],e],n)}var w_=16,Uw=nr(30*mo);function k_(r,e){return+e?Vw(r,e):jw(r)}function jw(r){return vv({point:function(e,n){e=r(e,n),this.stream.point(e[0],e[1])}})}function Vw(r,e){function n(s,a,f,m,l,x,S,C,L,N,B,U,ee,ie){var re=S-s,Q=C-a,$=re*re+Q*Q;if($>4*e&&ee--){var pe=m+N,ve=l+B,De=x+U,he=fc(pe*pe+ve*ve+De*De),xe=su(De/=he),be=qr(qr(De)-1)<Oi||qr(f-L)<Oi?(f+L)/2:ic(ve,pe),Le=r(be,xe),we=Le[0],ye=Le[1],Ue=we-s,Ve=ye-a,pt=Q*Ue-re*Ve;(pt*pt/$>e||qr((re*Ue+Q*Ve)/$-.5)>.3||m*N+l*B+x*U<Uw)&&(n(s,a,f,m,l,x,we,ye,be,pe/=he,ve/=he,De,ee,ie),ie.point(we,ye),n(we,ye,be,pe,ve,De,S,C,L,N,B,U,ee,ie))}}return function(s){var a,f,m,l,x,S,C,L,N,B,U,ee,ie={point:re,lineStart:Q,lineEnd:pe,polygonStart:function(){s.polygonStart(),ie.lineStart=ve},polygonEnd:function(){s.polygonEnd(),ie.lineStart=Q}};function re(xe,be){xe=r(xe,be),s.point(xe[0],xe[1])}function Q(){L=NaN,ie.point=$,s.lineStart()}function $(xe,be){var Le=rc([xe,be]),we=r(xe,be);n(L,N,C,B,U,ee,L=we[0],N=we[1],C=xe,B=Le[0],U=Le[1],ee=Le[2],w_,s),s.point(L,N)}function pe(){ie.point=re,s.lineEnd()}function ve(){Q(),ie.point=De,ie.lineEnd=he}function De(xe,be){$(a=xe,be),f=L,m=N,l=B,x=U,S=ee,ie.point=$}function he(){n(L,N,C,B,U,ee,f,m,a,l,x,S,w_,s),ie.lineEnd=pe,pe()}return ie}}var qw=vv({point:function(r,e){this.stream.point(r*mo,e*mo)}});function Gw(r){return Zw(function(){return r})()}function Zw(r){var e,n=150,s=480,a=250,f,m,l=0,x=0,S=0,C=0,L=0,N,B,U=null,ee=x_,ie=null,re,Q,$,pe=v_,ve=.5,De=k_(we,ve),he,xe;function be(Ve){return Ve=B(Ve[0]*mo,Ve[1]*mo),[Ve[0]*n+f,m-Ve[1]*n]}function Le(Ve){return Ve=B.invert((Ve[0]-f)/n,(m-Ve[1])/n),Ve&&[Ve[0]*pl,Ve[1]*pl]}function we(Ve,pt){return Ve=e(Ve,pt),[Ve[0]*n+f,m-Ve[1]*n]}be.stream=function(Ve){return he&&xe===Ve?he:he=qw(ee(N,De(pe(xe=Ve))))},be.clipAngle=function(Ve){return arguments.length?(ee=+Ve?Fw(U=Ve*mo,6*mo):(U=null,x_),Ue()):U*pl},be.clipExtent=function(Ve){return arguments.length?(pe=Ve==null?(ie=re=Q=$=null,v_):Mw(ie=+Ve[0][0],re=+Ve[0][1],Q=+Ve[1][0],$=+Ve[1][1]),Ue()):ie==null?null:[[ie,re],[Q,$]]},be.scale=function(Ve){return arguments.length?(n=+Ve,ye()):n},be.translate=function(Ve){return arguments.length?(s=+Ve[0],a=+Ve[1],ye()):[s,a]},be.center=function(Ve){return arguments.length?(l=Ve[0]%360*mo,x=Ve[1]%360*mo,ye()):[l*pl,x*pl]},be.rotate=function(Ve){return arguments.length?(S=Ve[0]%360*mo,C=Ve[1]%360*mo,L=Ve.length>2?Ve[2]%360*mo:0,ye()):[S*pl,C*pl,L*pl]},be.precision=function(Ve){return arguments.length?(De=k_(we,ve=Ve*Ve),Ue()):fc(ve)},be.fitExtent=function(Ve,pt){return bv(be,Ve,pt)},be.fitSize=function(Ve,pt){return Bw(be,Ve,pt)};function ye(){B=dv(N=Sw(S,C,L),e);var Ve=e(l,x);return f=s-Ve[0]*n,m=a+Ve[1]*n,Ue()}function Ue(){return he=xe=null,be}return function(){return e=r.apply(this,arguments),be.invert=e.invert&&Le,ye()}}function xv(r){return function(e,n){var s=nr(e),a=nr(n),f=r(s*a);return[f*a*ir(e),f*ir(n)]}}function wv(r){return function(e,n){var s=fc(e*e+n*n),a=r(s),f=ir(a),m=nr(a);return[ic(e*f,s*m),su(s&&n*f/s)]}}var Hw=xv(function(r){return fc(2/(1+r))});Hw.invert=wv(function(r){return 2*su(r/2)});var kv=xv(function(r){return(r=fv(r))&&r/ir(r)});kv.invert=wv(function(r){return r});function Ww(){return Gw(kv).scale(79.4188).clipAngle(180-.001)}function I_(r,e){return[r,e]}I_.invert=I_;var{BufferOp:Xw,GeoJSONReader:$w,GeoJSONWriter:Yw}=ww;function Jw(r,e,n){n=n||{};var s=n.units||"kilometers",a=n.steps||8;if(!r)throw new Error("geojson is required");if(typeof n!="object")throw new Error("options must be an object");if(typeof a!="number")throw new Error("steps must be an number");if(e===void 0)throw new Error("radius is required");if(a<=0)throw new Error("steps must be greater than 0");var f=[];switch(r.type){case"GeometryCollection":return id(r,function(m){var l=Mf(m,e,s,a);l&&f.push(l)}),ru(f);case"FeatureCollection":return l_(r,function(m){var l=Mf(m,e,s,a);l&&l_(l,function(x){x&&f.push(x)})}),ru(f)}return Mf(r,e,s,a)}function Mf(r,e,n,s){var a=r.properties||{},f=r.type==="Feature"?r.geometry:r;if(f.type==="GeometryCollection"){var m=[];return id(r,function(ee){var ie=Mf(ee,e,n,s);ie&&m.push(ie)}),ru(m)}var l=Kw(f),x={type:f.type,coordinates:Sv(f.coordinates,l)},S=new $w,C=S.read(x),L=Bx(Ux(e,n),"meters"),N=Xw.bufferOp(C,L,s),B=new Yw;if(N=B.write(N),!Iv(N.coordinates)){var U={type:N.type,coordinates:Ev(N.coordinates,l)};return zh(U,a)}}function Iv(r){return Array.isArray(r[0])?Iv(r[0]):isNaN(r[0])}function Sv(r,e){return typeof r[0]!="object"?e(r):r.map(function(n){return Sv(n,e)})}function Ev(r,e){return typeof r[0]!="object"?e.invert(r):r.map(function(n){return Ev(n,e)})}function Kw(r){var e=yw(r).geometry.coordinates,n=[-e[0],-e[1]];return Ww().rotate(n).scale(Us)}var Qw=Jw;function e2(r){const e=[];if(id(r,a=>{e.push(a.coordinates)}),e.length<2)throw new Error("Must have at least two features");const n=r.features[0].properties||{},s=uv.difference(e[0],...e.slice(1));return s.length===0?null:s.length===1?qp(s[0],n):av(s,n)}var t2=e2;function S_(r){let e;for(const n of r)e&&n[0]-e[0]>=180?n[0]-=360:e&&n[0]-e[0]<-180&&(n[0]+=360),e=n}function E_(r,e){const n=t2(ru([qp([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!n)return;n.properties={isMask:"y"};const s=Qw(r,0);if(s){if(s.geometry.type==="Polygon")for(const a of s.geometry.coordinates)S_(a);else for(const a of s.geometry.coordinates)for(const f of a)S_(f);e(ru([s,n]))}}const T_=ru([]);function n2(r,e,n=!0,s=!0,a={},f={},m={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}}){let l;const x=[];let S,C,L;function N(){!r.getSource("full-geom")&&(m!=null&&m.fill||m!=null&&m.line)&&r.addSource("full-geom",{type:"geojson",data:T_}),!r.getLayer("full-geom-fill")&&m!=null&&m.fill&&r.addLayer({...m==null?void 0:m.fill,id:"full-geom-fill",type:"fill",source:"full-geom"}),!r.getLayer("full-geom-line")&&m!=null&&m.line&&r.addLayer({...m==null?void 0:m.line,id:"full-geom-line",type:"line",source:"full-geom"}),L&&ee(L)}r.loaded()?N():r.once("load",()=>{N()}),r.on("styledata",()=>{N()});const B=ie=>{l==null||l({type:"mapClick",coordinates:[ie.lngLat.lng,ie.lngLat.lat]})};function U(ie=!1){if(!e)throw new Error;const re=document.createElement("div");return ie&&re.classList.add("marker-interactive"),new Ax({props:{displayIn:"maplibre"},target:re}),new e.Marker({element:re,offset:[1,-13]})}function ee(ie){var re;L=ie,(re=r.getSource("full-geom"))==null||re.setData(ie)}return{setEventHandler(ie){ie?(l=ie,r.on("click",B)):(l=void 0,r.off("click",B))},flyTo(ie,re){r.flyTo({center:ie,zoom:re,...a})},fitBounds(ie,re,Q){r.fitBounds([[ie[0],ie[1]],[ie[2],ie[3]]],{padding:re,maxZoom:Q,...f})},indicateReverse(ie){r.getCanvasContainer().style.cursor=ie?"crosshair":""},setReverseMarker(ie){!e||!n||(C?ie?C.setLngLat(ie):(C.remove(),C=void 0):ie&&(C=(typeof n=="object"?new e.Marker(n):U()).setLngLat(ie).addTo(r),C.getElement().classList.add("marker-reverse")))},setMarkers(ie,re){if(n){for(const Q of x)Q.remove();if(x.length=0,ee(T_),!!e){if(re){let Q=!1;if(re.geometry.type==="GeometryCollection"){const $=re.geometry.geometries.filter(pe=>pe.type==="Polygon"||pe.type==="MultiPolygon");e:if($.length>0){const pe=gw(ru($.map(ve=>zh(ve))));if(!pe)break e;E_({...re,geometry:pe.geometry},ee),Q=!0}else{const pe=re.geometry.geometries.filter(ve=>ve.type==="LineString"||ve.type==="MultiLineString");pe.length>0&&(ee({...re,geometry:{type:"GeometryCollection",geometries:pe}}),Q=!0)}}if(!Q){if(re.geometry.type==="Polygon"||re.geometry.type==="MultiPolygon")E_(re,ee);else if(re.geometry.type==="LineString"||re.geometry.type==="MultiLineString"){ee(re);return}}n&&x.push((typeof n=="object"?new e.Marker(n):U()).setLngLat(re.center).addTo(r))}if(s)for(const Q of ie??[]){if(Q===re)continue;const $=(typeof s=="object"?new e.Marker(s):U(!0)).setLngLat(Q.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(Q.place_type[0]==="reverse"?Q.place_name:Q.place_name.replace(/,.*/,""))).addTo(r),pe=$.getElement();pe.addEventListener("click",ve=>{ve.stopPropagation(),l==null||l({type:"markerClick",id:Q.id})}),pe.addEventListener("mouseenter",()=>{l==null||l({type:"markerMouseEnter",id:Q.id}),$.togglePopup()}),pe.addEventListener("mouseleave",()=>{l==null||l({type:"markerMouseLeave",id:Q.id}),$.togglePopup()}),x.push($)}}}},setSelectedMarker(ie){S&&S.getElement().classList.toggle("marker-selected",!1),S=ie>-1?x[ie]:void 0,S==null||S.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const ie=r.getCenter();return[r.getZoom(),ie.lng,ie.lat]}}}function i2(r){let e,n;return{c(){e=Da("svg"),n=Da("path"),He(n,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),He(e,"viewBox","0 0 14 14"),He(e,"width","13"),He(e,"height","13"),He(e,"class","svelte-en2qvf")},m(s,a){ae(s,e,a),Z(e,n)},p:tt,i:tt,o:tt,d(s){s&&oe(e)}}}class Tv extends fn{constructor(e){super(),hn(this,e,null,i2,un,{})}}function r2(r){let e,n;return{c(){e=Da("svg"),n=Da("path"),He(n,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),He(e,"viewBox","0 0 30 30"),He(e,"fill","none"),He(e,"xmlns","http://www.w3.org/2000/svg"),He(e,"class","svelte-d2loi5")},m(s,a){ae(s,e,a),Z(e,n)},p:tt,i:tt,o:tt,d(s){s&&oe(e)}}}class Cv extends fn{constructor(e){super(),hn(this,e,null,r2,un,{})}}function s2(r){let e,n;return{c(){e=ue("img"),ms(e.src,n=r[3]+"area.svg")||He(e,"src",n),He(e,"alt",r[6]),He(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!ms(e.src,n=s[3]+"area.svg")&&He(e,"src",n),a&64&&He(e,"alt",s[6])},d(s){s&&oe(e)}}}function o2(r){let e,n;return{c(){e=ue("img"),ms(e.src,n=r[3]+"reverse.svg")||He(e,"src",n),He(e,"alt",r[6]),He(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!ms(e.src,n=s[3]+"reverse.svg")&&He(e,"src",n),a&64&&He(e,"alt",s[6])},d(s){s&&oe(e)}}}function a2(r){let e,n;return{c(){e=ue("img"),ms(e.src,n=r[3]+"poi.svg")||He(e,"src",n),He(e,"alt",r[6]),He(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!ms(e.src,n=s[3]+"poi.svg")&&He(e,"src",n),a&64&&He(e,"alt",s[6])},d(s){s&&oe(e)}}}function l2(r){let e,n;return{c(){e=ue("img"),ms(e.src,n=r[3]+"postal_code.svg")||He(e,"src",n),He(e,"alt",r[6]),He(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!ms(e.src,n=s[3]+"postal_code.svg")&&He(e,"src",n),a&64&&He(e,"alt",s[6])},d(s){s&&oe(e)}}}function u2(r){let e,n;return{c(){e=ue("img"),ms(e.src,n=r[3]+"street.svg")||He(e,"src",n),He(e,"alt",r[6]),He(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!ms(e.src,n=s[3]+"street.svg")&&He(e,"src",n),a&64&&He(e,"alt",s[6])},d(s){s&&oe(e)}}}function c2(r){let e,n;return{c(){e=ue("img"),ms(e.src,n=r[3]+"road.svg")||He(e,"src",n),He(e,"alt",r[6]),He(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!ms(e.src,n=s[3]+"road.svg")&&He(e,"src",n),a&64&&He(e,"alt",s[6])},d(s){s&&oe(e)}}}function h2(r){let e,n;return{c(){e=ue("img"),ms(e.src,n=r[3]+"housenumber.svg")||He(e,"src",n),He(e,"alt",r[6]),He(e,"class","svelte-ltkwvy")},m(s,a){ae(s,e,a)},p(s,a){a&8&&!ms(e.src,n=s[3]+"housenumber.svg")&&He(e,"src",n),a&64&&He(e,"alt",s[6])},d(s){s&&oe(e)}}}function f2(r){let e,n,s,a;return{c(){e=ue("img"),ms(e.src,n=r[5])||He(e,"src",n),He(e,"alt",r[4]),He(e,"class","svelte-ltkwvy")},m(f,m){ae(f,e,m),s||(a=Pt(e,"error",r[14]),s=!0)},p(f,m){m&32&&!ms(e.src,n=f[5])&&He(e,"src",n),m&16&&He(e,"alt",f[4])},d(f){f&&oe(e),s=!1,a()}}}function C_(r){let e,n;return{c(){e=ue("span"),n=Oe(r[6]),He(e,"class","secondary svelte-ltkwvy")},m(s,a){ae(s,e,a),Z(e,n)},p(s,a){a&64&&Mt(n,s[6])},d(s){s&&oe(e)}}}function d2(r){var he,xe;let e,n,s,a,f,m,l,x,S=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",C,L,N=r[2]==="always"||r[2]&&!r[0].address&&((he=r[0].properties)==null?void 0:he.kind)!=="road"&&((xe=r[0].properties)==null?void 0:xe.kind)!=="road_relation"&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],B,U,ee=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",ie,re,Q;function $(be,Le){var we,ye;return Le&1&&(n=null),Le&1&&(s=null),Le&1&&(a=null),be[5]?f2:be[0].address?h2:((we=be[0].properties)==null?void 0:we.kind)==="road"||((ye=be[0].properties)==null?void 0:ye.kind)==="road_relation"?c2:(n==null&&(n=!!be[0].id.startsWith("address.")),n?u2:(s==null&&(s=!!be[0].id.startsWith("postal_code.")),s?l2:(a==null&&(a=!!be[0].id.startsWith("poi.")),a?a2:be[7]?o2:s2)))}let pe=$(r,-1),ve=pe(r),De=N&&C_(r);return{c(){e=ue("li"),ve.c(),f=Be(),m=ue("span"),l=ue("span"),x=ue("span"),C=Oe(S),L=Be(),De&&De.c(),B=Be(),U=ue("span"),ie=Oe(ee),He(x,"class","primary svelte-ltkwvy"),He(l,"class","svelte-ltkwvy"),He(U,"class","line2 svelte-ltkwvy"),He(m,"class","texts svelte-ltkwvy"),He(e,"tabindex","0"),He(e,"data-selected",r[1]),He(e,"class","svelte-ltkwvy"),Vr(e,"selected",r[1])},m(be,Le){ae(be,e,Le),ve.m(e,null),Z(e,f),Z(e,m),Z(m,l),Z(l,x),Z(x,C),Z(l,L),De&&De.m(l,null),Z(m,B),Z(m,U),Z(U,ie),re||(Q=[Pt(e,"mouseenter",r[12]),Pt(e,"focus",r[13])],re=!0)},p(be,[Le]){var we,ye;pe===(pe=$(be,Le))&&ve?ve.p(be,Le):(ve.d(1),ve=pe(be),ve&&(ve.c(),ve.m(e,f))),Le&1&&S!==(S=(be[7]?be[0].place_name:be[0].place_name.replace(/,.*/,""))+"")&&Mt(C,S),Le&37&&(N=be[2]==="always"||be[2]&&!be[0].address&&((we=be[0].properties)==null?void 0:we.kind)!=="road"&&((ye=be[0].properties)==null?void 0:ye.kind)!=="road_relation"&&!be[0].id.startsWith("address.")&&!be[0].id.startsWith("postal_code.")&&(!be[0].id.startsWith("poi.")||!be[5])&&!be[7]),N?De?De.p(be,Le):(De=C_(be),De.c(),De.m(l,null)):De&&(De.d(1),De=null),Le&1&&ee!==(ee=(be[7]?"":be[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Mt(ie,ee),Le&2&&He(e,"data-selected",be[1]),Le&2&&Vr(e,"selected",be[1])},i:tt,o:tt,d(be){be&&oe(e),ve.d(),De&&De.d(),re=!1,$i(Q)}}}function p2(r,e,n){var $;let s,a,{feature:f}=e,{selected:m=!1}=e,{showPlaceType:l}=e,{missingIconsCache:x}=e,{iconsBaseUrl:S}=e;const C=($=f.properties)==null?void 0:$.categories;let L,N,B=0,U=f.place_type[0]==="reverse";function ee(){N&&x.add(N),n(10,B++,B)}function ie(pe){ur.call(this,r,pe)}function re(pe){ur.call(this,r,pe)}const Q=()=>ee();return r.$$set=pe=>{"feature"in pe&&n(0,f=pe.feature),"selected"in pe&&n(1,m=pe.selected),"showPlaceType"in pe&&n(2,l=pe.showPlaceType),"missingIconsCache"in pe&&n(9,x=pe.missingIconsCache),"iconsBaseUrl"in pe&&n(3,S=pe.iconsBaseUrl)},r.$$.update=()=>{var pe,ve,De,he;if(r.$$.dirty&3640)do n(11,s--,s),n(4,L=C==null?void 0:C[s]),n(5,N=L?S+L.replace(/ /g,"_")+".svg":void 0);while(s>-1&&(!N||x.has(N)));r.$$.dirty&1&&n(6,a=f.id.startsWith("poi.")?(ve=(pe=f.properties)==null?void 0:pe.categories)==null?void 0:ve.join(", "):((he=(De=f.properties)==null?void 0:De.place_type_name)==null?void 0:he[0])??f.place_type[0])},n(11,s=(C==null?void 0:C.length)??0),[f,m,l,S,L,N,a,U,ee,x,B,s,ie,re,Q]}class m2 extends fn{constructor(e){super(),hn(this,e,p2,d2,un,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function g2(r){let e;return{c(){e=ue("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',He(e,"class","svelte-7cmwmc")},m(n,s){ae(n,e,s)},p:tt,i:tt,o:tt,d(n){n&&oe(e)}}}class _2 extends fn{constructor(e){super(),hn(this,e,null,g2,un,{})}}function y2(r){let e,n;return{c(){e=Da("svg"),n=Da("path"),He(n,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),He(e,"viewBox","0 0 60.006 21.412"),He(e,"width","14"),He(e,"height","20"),He(e,"class","svelte-en2qvf")},m(s,a){ae(s,e,a),Z(e,n)},p:tt,i:tt,o:tt,d(s){s&&oe(e)}}}class v2 extends fn{constructor(e){super(),hn(this,e,null,y2,un,{})}}function b2(r){let e,n,s;return{c(){e=Da("svg"),n=Da("circle"),s=Da("path"),He(n,"cx","4.789"),He(n,"cy","4.787"),He(n,"r","3.85"),He(n,"class","svelte-1aq105l"),He(s,"d","M12.063 12.063 7.635 7.635"),He(s,"class","svelte-1aq105l"),He(e,"xmlns","http://www.w3.org/2000/svg"),He(e,"width","13"),He(e,"height","13"),He(e,"viewBox","0 0 13 13"),He(e,"class","svelte-1aq105l")},m(a,f){ae(a,e,f),Z(e,n),Z(e,s)},p:tt,i:tt,o:tt,d(a){a&&oe(e)}}}class x2 extends fn{constructor(e){super(),hn(this,e,null,b2,un,{})}}function w2(r,e,n){const s=e[1],a=e[0],f=s-a;return r===s&&n?r:((r-a)%f+f)%f+a}function L_(r){const e=[...r];return e[2]<e[0]&&(e[2]+=360),e}let ch;async function k2(r,e,n){const s=r==null?void 0:r.getCenterAndZoom();for(const a of e??[])if(!(s&&(a.minZoom!=null&&a.minZoom>s[0]||a.maxZoom!=null&&a.maxZoom<s[0]))){if(a.type==="fixed")return a.coordinates.join(",");e:if(a.type==="client-geolocation"){if(ch&&a.cachedLocationExpiry&&ch.time+a.cachedLocationExpiry>Date.now()){if(!ch.coords)break e;return ch.coords}let f;try{return f=await new Promise((m,l)=>{n.signal.addEventListener("abort",()=>{l(Error("aborted"))}),navigator.geolocation.getCurrentPosition(x=>{m([x.coords.longitude,x.coords.latitude].map(S=>S.toFixed(6)).join(","))},x=>{l(x)},a)}),f}catch{}finally{a.cachedLocationExpiry&&(ch={time:Date.now(),coords:f})}if(n.signal.aborted)return}if(a.type==="server-geolocation")return"ip";if(s&&a.type==="map-center")return s[1].toFixed(6)+","+s[2].toFixed(6)}}const I2=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,M_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,A_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,P_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,R_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,D_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function S2(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(B=>Number(B.trim())),n=Number(e[0]),s=Number(e[1]),a=Math.abs(n),f=Math.abs(s),m=n>0?"N":"S",l=s>0?"E":"W";let x;r=="DD"&&(x=`${a}° ${m}, ${f}° ${l}`);const S=Math.floor(a),C=Math.floor(f),L=(a-S)*60,N=(f-C)*60;if(r=="DM"){let B=N_(L,3).toFixed(3).padStart(6,"0"),U=N_(N,3).toFixed(3).padStart(6,"0");B.endsWith(".000")&&U.endsWith(".000")&&(B=B.replace(/\.000$/,""),U=U.replace(/\.000$/,"")),x=`${S}° ${B}' ${m}, ${C}° ${U}' ${l}`}if(r=="DMS"){const B=Math.floor(L),U=Math.floor(N);let ee=((L-B)*60).toFixed(1).padStart(4,"0"),ie=((N-U)*60).toFixed(1).padStart(4,"0");const re=B.toString().padStart(2,"0"),Q=U.toString().padStart(2,"0");ee.endsWith(".0")&&ie.endsWith(".0")&&(ee=ee.replace(/\.0$/,""),ie=ie.replace(/\.0$/,"")),x=`${S}° ${re}' ${ee}" ${m}, ${C}° ${Q}' ${ie}" ${l}`}return x}else throw new Error("no decimal coordinates to convert")}function N_(r,e){const n=Math.pow(10,e);return Math.round((r+Number.EPSILON)*n)/n}function Zp(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let n=null,s=null,a="",f="",m=null,l=[],x=!1;if(I2.test(r))throw new Error("invalid coordinate value");if(M_.test(r))if(l=M_.exec(r),x=hh(l),x)n=Math.abs(l[1])+l[2]/60,Number(l[1])<0&&(n*=-1),s=Math.abs(l[3])+l[4]/60,Number(l[3])<0&&(s*=-1),m="DM";else throw new Error("invalid coordinate format");else if(A_.test(r))if(l=A_.exec(r),x=hh(l),x){if(n=l[2],s=l[6],n.includes(",")&&(n=n.replace(",",".")),s.includes(",")&&(s=s.replace(",",".")),m="DD",Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");if(Number(Math.round(s))==Number(s))throw new Error("integer only coordinate provided");l[1]?(a=l[1],f=l[5]):l[4]&&(a=l[4],f=l[8])}else throw new Error("invalid decimal coordinate format");else if(P_.test(r))if(l=P_.exec(r),x=hh(l),x)n=Math.abs(parseInt(l[2])),l[4]&&(n+=l[4]/60,m="DM"),l[6]&&(n+=l[6].replace(",",".")/3600,m="DMS"),parseInt(l[2])<0&&(n=-1*n),s=Math.abs(parseInt(l[9])),l[11]&&(s+=l[11]/60),l[13]&&(s+=l[13].replace(",",".")/3600),parseInt(l[9])<0&&(s=-1*s),l[1]?(a=l[1],f=l[8]):l[7]&&(a=l[7],f=l[14]);else throw new Error("invalid DMS coordinates format");else if(R_.test(r))if(l=R_.exec(r),x=hh(l),x)n=Math.abs(parseInt(l[2])),l[4]&&(n+=l[4]/60,m="DM"),l[6]&&(n+=l[6]/3600,m="DMS"),parseInt(l[2])<0&&(n=-1*n),s=Math.abs(parseInt(l[10])),l[12]&&(s+=l[12]/60),l[14]&&(s+=l[14]/3600),parseInt(l[10])<0&&(s=-1*s),l[1]?(a=l[1],f=l[9]):l[8]&&(a=l[8],f=l[16]);else throw new Error("invalid DMS coordinates format");else if(D_.test(r)){if(l=D_.exec(r),x=hh(l),l.filter(S=>S).length<=5)throw new Error("invalid coordinates format");if(x)n=Math.abs(parseInt(l[2])),l[4]&&(n+=l[4].replace(",",".")/60,m="DM"),l[6]&&(n+=l[6].replace(",",".")/3600,m="DMS"),parseInt(l[2])<0&&(n=-1*n),s=Math.abs(parseInt(l[10])),l[12]&&(s+=l[12].replace(",",".")/60),l[14]&&(s+=l[14].replace(",",".")/3600),parseInt(l[10])<0&&(s=-1*s),l[1]?(a=l[1],f=l[9]):l[8]&&(a=l[8],f=l[16]);else throw new Error("invalid coordinates format")}if(x){if(Math.abs(s)>=180)throw new Error("invalid longitude value");if(Math.abs(n)>=90)throw new Error("invalid latitude value");if(a&&!f||!a&&f)throw new Error("invalid coordinates value");if(a&&a==f)throw new Error("invalid coordinates format");n.toString().includes(",")&&(n=n.replace(",",".")),s.toString().includes(",")&&(s=s.replace(",","."));let S=/S|SOUTH/i;S.test(a)&&n>0&&(n=-1*n),S=/W|WEST/i,S.test(f)&&s>0&&(s=-1*s);const C=l[0].trim();let L,N;const B=/[,/;\u0020]/g,U=C.match(B);if(U==null){const re=Math.floor(r.length/2);L=C.substring(0,re).trim(),N=C.substring(re).trim()}else{let re;U.length%2==1?re=Math.floor(U.length/2):re=U.length/2-1;let Q=0;if(re==0)Q=C.indexOf(U[0]),L=C.substring(0,Q).trim(),N=C.substring(Q+1).trim();else{let $=0,pe=0;for(;$<=re;)Q=C.indexOf(U[$],pe),pe=Q+1,$++;L=C.substring(0,Q).trim(),N=C.substring(Q+1).trim()}}const ee=L.split(".");if(ee.length==2&&ee[1]==0&&ee[1].length!=2)throw new Error("invalid coordinates format");const ie=N.split(".");if(ie.length==2&&ie[1]==0&&ie[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(L)||/^\d+$/.test(N))throw new Error("degree only coordinate/s provided");return n=Number(Number(n).toFixed(e)),s=Number(Number(s).toFixed(e)),Object.freeze({verbatimCoordinates:C,verbatimLatitude:L,verbatimLongitude:N,decimalLatitude:n,decimalLongitude:s,decimalCoordinates:`${n},${s}`,originalFormat:m,closeEnough:E2,toCoordinateFormat:S2})}else throw new Error("coordinates pattern match failed")}function hh(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const n=/^[-+]?\d+([\.,]\d+)?$/,s=/[eastsouthnorthwest]+/i,a=e.length/2;for(let f=0;f<a;f++){const m=e[f],l=e[f+a],x=n.test(m)&&n.test(l),S=s.test(m)&&s.test(l),C=m==l;if(!(m==null&&l==null)){if(m==null||l==null)return!1;if(x||S||C)continue;return!1}}return!0}function z_(r,e){const n=Math.abs(r-e);return Number(n.toFixed(6))<=1e-5}function E2(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return z_(this.decimalLatitude,Number(e[0]))&&z_(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const T2=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Zp.to=T2;const C2=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],L2={decimalLatitude:40.123,decimalLongitude:-74.123},M2=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],A2=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function P2(){const r=[];return C2.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...L2})}),[...r,...M2,...A2]}const R2=P2();Zp.formats=R2.map(r=>r.verbatimCoordinates);const D2=Zp;function O_(r,e,n){const s=r.slice();return s[81]=e[n],s[83]=n,s}function F_(r){let e,n;return e=new _2({}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function B_(r){let e,n,s,a,f;return n=new v2({}),{c(){e=ue("button"),ot(n.$$.fragment),He(e,"type","button"),He(e,"title",r[9]),He(e,"class","svelte-zh3kmv"),Vr(e,"active",r[0])},m(m,l){ae(m,e,l),rt(n,e,null),s=!0,a||(f=Pt(e,"click",r[67]),a=!0)},p(m,l){(!s||l[0]&512)&&He(e,"title",m[9]),(!s||l[0]&1)&&Vr(e,"active",m[0])},i(m){s||(_e(n.$$.fragment,m),s=!0)},o(m){Ie(n.$$.fragment,m),s=!1},d(m){m&&oe(e),st(n),a=!1,f()}}}function N2(r){let e,n=[],s=new Map,a,f,m,l=Hn(r[14]);const x=S=>S[81].id+(S[81].address?","+S[81].address:"");for(let S=0;S<l.length;S+=1){let C=O_(r,l,S),L=x(C);s.set(L,n[S]=U_(L,C))}return{c(){e=ue("ul");for(let S=0;S<n.length;S+=1)n[S].c();He(e,"class","svelte-zh3kmv")},m(S,C){ae(S,e,C);for(let L=0;L<n.length;L+=1)n[L]&&n[L].m(e,null);a=!0,f||(m=[Pt(e,"mouseleave",r[71]),Pt(e,"blur",r[72])],f=!0)},p(S,C){C[0]&17880064&&(l=Hn(S[14]),Nn(),n=rx(n,C,x,1,S,l,s,e,ix,U_,null,O_),zn())},i(S){if(!a){for(let C=0;C<l.length;C+=1)_e(n[C]);a=!0}},o(S){for(let C=0;C<n.length;C+=1)Ie(n[C]);a=!1},d(S){S&&oe(e);for(let C=0;C<n.length;C+=1)n[C].d();f=!1,$i(m)}}}function z2(r){let e,n,s,a,f,m;return n=new Cv({}),{c(){e=ue("div"),ot(n.$$.fragment),s=Be(),a=ue("div"),f=Oe(r[7]),He(a,"class","svelte-zh3kmv"),He(e,"class","no-results svelte-zh3kmv")},m(l,x){ae(l,e,x),rt(n,e,null),Z(e,s),Z(e,a),Z(a,f),m=!0},p(l,x){(!m||x[0]&128)&&Mt(f,l[7])},i(l){m||(_e(n.$$.fragment,l),m=!0)},o(l){Ie(n.$$.fragment,l),m=!1},d(l){l&&oe(e),st(n)}}}function O2(r){let e="",n;return{c(){n=Oe(e)},m(s,a){ae(s,n,a)},p:tt,i:tt,o:tt,d(s){s&&oe(n)}}}function F2(r){let e,n,s,a,f,m,l,x,S,C,L;return n=new Cv({}),x=new Tv({}),{c(){e=ue("div"),ot(n.$$.fragment),s=Be(),a=ue("div"),f=Oe(r[6]),m=Be(),l=ue("button"),ot(x.$$.fragment),He(a,"class","svelte-zh3kmv"),He(l,"class","svelte-zh3kmv"),He(e,"class","error svelte-zh3kmv")},m(N,B){ae(N,e,B),rt(n,e,null),Z(e,s),Z(e,a),Z(a,f),Z(e,m),Z(e,l),rt(x,l,null),S=!0,C||(L=Pt(l,"click",r[68]),C=!0)},p(N,B){(!S||B[0]&64)&&Mt(f,N[6])},i(N){S||(_e(n.$$.fragment,N),_e(x.$$.fragment,N),S=!0)},o(N){Ie(n.$$.fragment,N),Ie(x.$$.fragment,N),S=!1},d(N){N&&oe(e),st(n),st(x),C=!1,L()}}}function U_(r,e){let n,s,a;function f(){return e[69](e[83])}function m(){return e[70](e[81])}return s=new m2({props:{feature:e[81],showPlaceType:e[10],selected:e[15]===e[83],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),s.$on("mouseenter",f),s.$on("focus",m),{key:r,first:null,c(){n=ni(),ot(s.$$.fragment),this.first=n},m(l,x){ae(l,n,x),rt(s,l,x),a=!0},p(l,x){e=l;const S={};x[0]&16384&&(S.feature=e[81]),x[0]&1024&&(S.showPlaceType=e[10]),x[0]&49152&&(S.selected=e[15]===e[83]),x[0]&4096&&(S.iconsBaseUrl=e[12]),s.$set(S)},i(l){a||(_e(s.$$.fragment,l),a=!0)},o(l){Ie(s.$$.fragment,l),a=!1},d(l){l&&oe(n),st(s,l)}}}function B2(r){let e,n,s,a,f,m,l,x,S,C,L,N,B,U,ee,ie,re,Q,$,pe,ve,De=!1;f=new x2({}),L=new Tv({});let he=r[19]&&F_(),xe=r[5]===!0&&B_(r);const be=r[59].default,Le=Zi(be,r,r[58],null),we=[F2,O2,z2,N2],ye=[];function Ue(Ve,pt){var St,dt;return Ve[18]?0:Ve[16]?((St=Ve[14])==null?void 0:St.length)===0?2:Ve[16]&&((dt=Ve[14])!=null&&dt.length)?3:-1:1}return~(ie=Ue(r))&&(re=ye[ie]=we[ie](r)),{c(){e=Be(),n=ue("form"),s=ue("div"),a=ue("button"),ot(f.$$.fragment),m=Be(),l=ue("input"),x=Be(),S=ue("div"),C=ue("button"),ot(L.$$.fragment),N=Be(),he&&he.c(),B=Be(),xe&&xe.c(),U=Be(),Le&&Le.c(),ee=Be(),re&&re.c(),He(a,"class","search-button svelte-zh3kmv"),He(a,"type","button"),He(l,"placeholder",r[8]),He(l,"aria-label",r[8]),He(l,"class","svelte-zh3kmv"),He(C,"type","button"),He(C,"title",r[3]),He(C,"class","svelte-zh3kmv"),He(S,"class","clear-button-container svelte-zh3kmv"),Vr(S,"displayable",r[1]!==""),He(s,"class","input-group svelte-zh3kmv"),He(n,"tabindex","0"),He(n,"class",Q=Nf(r[2])+" svelte-zh3kmv"),Vr(n,"can-collapse",r[4]&&r[1]==="")},m(Ve,pt){ae(Ve,e,pt),ae(Ve,n,pt),Z(n,s),Z(s,a),rt(f,a,null),Z(s,m),Z(s,l),r[61](l),zi(l,r[1]),Z(s,x),Z(s,S),Z(S,C),rt(L,C,null),Z(S,N),he&&he.m(S,null),Z(s,B),xe&&xe.m(s,null),Z(s,U),Le&&Le.m(s,null),Z(n,ee),~ie&&ye[ie].m(n,null),$=!0,pe||(ve=[Pt(a,"click",r[60]),Pt(l,"input",r[62]),Pt(l,"focus",r[63]),Pt(l,"blur",r[64]),Pt(l,"keydown",r[22]),Pt(l,"input",r[65]),Pt(C,"click",r[66]),Pt(n,"submit",Nh(r[21]))],pe=!0)},p(Ve,pt){(!$||pt[0]&256)&&He(l,"placeholder",Ve[8]),(!$||pt[0]&256)&&He(l,"aria-label",Ve[8]),pt[0]&2&&l.value!==Ve[1]&&zi(l,Ve[1]),(!$||pt[0]&8)&&He(C,"title",Ve[3]),Ve[19]?he?pt[0]&524288&&_e(he,1):(he=F_(),he.c(),_e(he,1),he.m(S,null)):he&&(Nn(),Ie(he,1,1,()=>{he=null}),zn()),(!$||pt[0]&2)&&Vr(S,"displayable",Ve[1]!==""),Ve[5]===!0?xe?(xe.p(Ve,pt),pt[0]&32&&_e(xe,1)):(xe=B_(Ve),xe.c(),_e(xe,1),xe.m(s,U)):xe&&(Nn(),Ie(xe,1,1,()=>{xe=null}),zn()),Le&&Le.p&&(!$||pt[1]&134217728)&&Wi(Le,be,Ve,Ve[58],$?Hi(be,Ve[58],pt,null):Xi(Ve[58]),null);let St=ie;ie=Ue(Ve),ie===St?~ie&&ye[ie].p(Ve,pt):(re&&(Nn(),Ie(ye[St],1,1,()=>{ye[St]=null}),zn()),~ie?(re=ye[ie],re?re.p(Ve,pt):(re=ye[ie]=we[ie](Ve),re.c()),_e(re,1),re.m(n,null)):re=null),(!$||pt[0]&4&&Q!==(Q=Nf(Ve[2])+" svelte-zh3kmv"))&&He(n,"class",Q),(!$||pt[0]&22)&&Vr(n,"can-collapse",Ve[4]&&Ve[1]==="")},i(Ve){$||(_e(De),_e(f.$$.fragment,Ve),_e(L.$$.fragment,Ve),_e(he),_e(xe),_e(Le,Ve),_e(re),$=!0)},o(Ve){Ie(De),Ie(f.$$.fragment,Ve),Ie(L.$$.fragment,Ve),Ie(he),Ie(xe),Ie(Le,Ve),Ie(re),$=!1},d(Ve){Ve&&(oe(e),oe(n)),st(f),r[61](null),st(L),he&&he.d(),xe&&xe.d(),Le&&Le.d(Ve),~ie&&ye[ie].d(),pe=!1,$i(ve)}}}function U2(r,e,n){let s,{$$slots:a={},$$scope:f}=e,{class:m=void 0}=e,{apiKey:l}=e,{bbox:x=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:C=!1}=e,{collapsed:L=!1}=e,{country:N=void 0}=e,{debounceSearch:B=200}=e,{enableReverse:U=!1}=e,{errorMessage:ee="Something went wrong…"}=e,{filter:ie=()=>!0}=e,{flyTo:re=!0}=e,{fuzzyMatch:Q=!0}=e,{language:$=void 0}=e,{limit:pe=void 0}=e,{mapController:ve=void 0}=e,{minLength:De=2}=e,{noResultsMessage:he="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:xe="Search"}=e,{proximity:be=[{type:"server-geolocation"}]}=e,{reverseActive:Le=U==="always"}=e,{reverseButtonTitle:we="toggle reverse geocoding"}=e,{searchValue:ye=""}=e,{showFullGeometry:Ue=!0}=e,{showPlaceType:Ve="ifNeeded"}=e,{showResultsWhileTyping:pt=!0}=e,{selectFirst:St=!0}=e,{flyToSelected:dt=!1}=e,{markerOnSelected:ut=!0}=e,{types:Bt=void 0}=e,{excludeTypes:vt=!1}=e,{zoom:wt=16}=e,{maxZoom:ft=18}=e,{apiUrl:xt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:It={}}=e,{iconsBaseUrl:Jt="https://cdn.maptiler.com/maptiler-geocoding-control/v1.3.3/icons/"}=e,{adjustUrlQuery:pn=()=>{}}=e;function Rn(){kt.focus()}function Xe(){kt.blur()}function Wn(fe,je=!0,We=!1){n(1,ye=fe),je?(n(15,Vt=-1),Jr()):(At(!We,We),setTimeout(()=>{kt.focus(),kt.select()}))}function dn(){n(14,lt=void 0),n(55,Lt=void 0),n(15,Vt=-1)}function Ft(){n(54,Je=[]),n(55,Lt=void 0)}let Se=!1,lt,Je,Lt,Ye="",kt,Vt=-1,Ee,Gt=[],_n,Kn,Yi,xn;const qi=new Set,Ji=hc();vo(()=>{ve&&(ve.setEventHandler(void 0),ve.indicateReverse(!1),ve.setSelectedMarker(-1),ve.setMarkers(void 0,void 0))});function Jr(fe){if(Kn&&(clearTimeout(Kn),Kn=void 0),Vt>-1&&lt)n(55,Lt=lt[Vt]),n(1,ye=Lt.place_type[0]==="reverse"?Lt.place_name:Lt.place_name.replace(/,.*/,"")),n(18,Ee=void 0),n(54,Je=void 0),n(15,Vt=-1);else if(ye){const je=fe||!ct(ye);gr(ye,{exact:!0}).then(()=>{n(54,Je=lt),n(55,Lt=void 0),je&&kn()}).catch(We=>n(18,Ee=We))}}function ct(fe){try{return D2(fe,6)}catch{return!1}}async function gr(fe,{byId:je=!1,exact:We=!1}={}){n(18,Ee=void 0),_n==null||_n.abort();const Pe=new AbortController;n(19,_n=Pe);try{const et=ct(fe),gt=new URLSearchParams;if($!==void 0&&gt.set("language",Array.isArray($)?$.join(","):$??""),Bt&&gt.set("types",Bt.join(",")),vt&&gt.set("excludeTypes",String(vt)),x&&gt.set("bbox",x.map(an=>an.toFixed(6)).join(",")),N&&gt.set("country",Array.isArray(N)?N.join(","):N),!je&&!et){const an=await k2(ve,be,Pe);an&&gt.set("proximity",an),(We||!pt)&&gt.set("autocomplete","false"),gt.set("fuzzyMatch",String(Q))}pe!==void 0&&(!et||(Bt==null?void 0:Bt.length)===1)&&gt.set("limit",String(pe)),gt.set("key",l),pn(gt);const at=xt+"/"+encodeURIComponent(et?et.decimalLongitude+","+et.decimalLatitude:fe)+".json?"+gt.toString();if(at===Ye){je?(n(14,lt=void 0),n(55,Lt=Gt[0])):n(14,lt=Gt);return}Ye=at;const Dt=await fetch(at,{signal:Pe.signal,...It});if(!Dt.ok)throw new Error(await Dt.text());const en=await Dt.json();Ji("response",{url:at,featureCollection:en}),je?(n(14,lt=void 0),n(55,Lt=en.features[0]),Gt=[Lt]):(n(14,lt=en.features.filter(ie)),et&&lt.unshift({type:"Feature",properties:{},id:"reverse_"+et.decimalLongitude+"_"+et.decimalLatitude,text:et.decimalLatitude+", "+et.decimalLongitude,place_name:et.decimalLatitude+", "+et.decimalLongitude,place_type:["reverse"],center:[et.decimalLongitude,et.decimalLatitude],bbox:[et.decimalLongitude,et.decimalLatitude,et.decimalLongitude,et.decimalLatitude],geometry:{type:"Point",coordinates:[et.decimalLongitude,et.decimalLatitude]}}),Gt=lt,et&&kt.focus())}catch(et){if(et&&typeof et=="object"&&"name"in et&&et.name==="AbortError")return;throw et}finally{Pe===_n&&n(19,_n=void 0)}}function kn(){var We;if(!(Je!=null&&Je.length)||!re)return;const fe=[180,90,-180,-90],je=!Je.some(Pe=>!Pe.matching_text);for(const Pe of Je)if(je||!Pe.matching_text)for(const et of[0,1,2,3])fe[et]=Math[et<2?"min":"max"](fe[et],((We=Pe.bbox)==null?void 0:We[et])??Pe.center[et%2]);ve&&Je.length>0&&(Lt&&fe[0]===fe[2]&&fe[1]===fe[3]?ve.flyTo(Lt.center,wt):ve.fitBounds(L_(fe),50,ft))}function mn(fe){n(0,Le=U==="always"),n(14,lt=void 0),n(55,Lt=void 0),n(15,Vt=-1),Wn(fe[1].toFixed(6)+", "+w2(fe[0],[-180,180],!0).toFixed(6),!1,!0)}function As(fe){if(!lt)return;let je=fe.key==="ArrowDown"?1:fe.key==="ArrowUp"?-1:0;je&&(Vt===(St?0:-1)&&je===-1&&n(15,Vt=lt.length),n(15,Vt+=je),Vt>=lt.length&&n(15,Vt=-1),Vt<0&&St&&n(15,Vt=0),fe.preventDefault())}function At(fe=!0,je=!1){if(n(18,Ee=void 0),pt||je){if(Kn&&clearTimeout(Kn),ye.length<De)return;const We=ye;Kn=window.setTimeout(()=>{gr(We).catch(Pe=>n(18,Ee=Pe))},fe?B:0)}else n(14,lt=void 0),n(18,Ee=void 0)}function Ln(fe){n(55,Lt=fe),n(1,ye=fe.place_name),n(15,Vt=-1)}const Tt=()=>kt.focus();function _r(fe){Jn[fe?"unshift":"push"](()=>{kt=fe,n(17,kt)})}function Gr(){ye=this.value,n(1,ye),n(13,Se),n(27,C)}const wn=()=>n(13,Se=!0),Mi=()=>n(13,Se=!1),Er=()=>At(),Ki=()=>{n(1,ye=""),kt.focus()},Zr=()=>n(0,Le=!Le),Ae=()=>n(18,Ee=void 0),K=fe=>n(15,Vt=fe),J=fe=>Ln(fe),ce=()=>{St||n(15,Vt=-1)},le=()=>{};return r.$$set=fe=>{"class"in fe&&n(2,m=fe.class),"apiKey"in fe&&n(25,l=fe.apiKey),"bbox"in fe&&n(26,x=fe.bbox),"clearButtonTitle"in fe&&n(3,S=fe.clearButtonTitle),"clearOnBlur"in fe&&n(27,C=fe.clearOnBlur),"collapsed"in fe&&n(4,L=fe.collapsed),"country"in fe&&n(28,N=fe.country),"debounceSearch"in fe&&n(29,B=fe.debounceSearch),"enableReverse"in fe&&n(5,U=fe.enableReverse),"errorMessage"in fe&&n(6,ee=fe.errorMessage),"filter"in fe&&n(30,ie=fe.filter),"flyTo"in fe&&n(31,re=fe.flyTo),"fuzzyMatch"in fe&&n(32,Q=fe.fuzzyMatch),"language"in fe&&n(33,$=fe.language),"limit"in fe&&n(34,pe=fe.limit),"mapController"in fe&&n(35,ve=fe.mapController),"minLength"in fe&&n(36,De=fe.minLength),"noResultsMessage"in fe&&n(7,he=fe.noResultsMessage),"placeholder"in fe&&n(8,xe=fe.placeholder),"proximity"in fe&&n(37,be=fe.proximity),"reverseActive"in fe&&n(0,Le=fe.reverseActive),"reverseButtonTitle"in fe&&n(9,we=fe.reverseButtonTitle),"searchValue"in fe&&n(1,ye=fe.searchValue),"showFullGeometry"in fe&&n(38,Ue=fe.showFullGeometry),"showPlaceType"in fe&&n(10,Ve=fe.showPlaceType),"showResultsWhileTyping"in fe&&n(39,pt=fe.showResultsWhileTyping),"selectFirst"in fe&&n(11,St=fe.selectFirst),"flyToSelected"in fe&&n(40,dt=fe.flyToSelected),"markerOnSelected"in fe&&n(41,ut=fe.markerOnSelected),"types"in fe&&n(42,Bt=fe.types),"excludeTypes"in fe&&n(43,vt=fe.excludeTypes),"zoom"in fe&&n(44,wt=fe.zoom),"maxZoom"in fe&&n(45,ft=fe.maxZoom),"apiUrl"in fe&&n(46,xt=fe.apiUrl),"fetchParameters"in fe&&n(47,It=fe.fetchParameters),"iconsBaseUrl"in fe&&n(12,Jt=fe.iconsBaseUrl),"adjustUrlQuery"in fe&&n(48,pn=fe.adjustUrlQuery),"$$scope"in fe&&n(58,f=fe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&n(0,Le=U==="always"),r.$$.dirty[0]&134225920&&setTimeout(()=>{n(16,Yi=Se),C&&!Se&&n(1,ye="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&32&&ye.length<De&&(n(55,Lt=void 0),n(14,lt=void 0),n(18,Ee=void 0),n(54,Je=lt)),r.$$.dirty[1]&16777344&&Ue&&Lt&&!Lt.address&&Lt.geometry.type==="Point"&&Lt.place_type[0]!=="reverse"&&gr(Lt.id,{byId:!0}).catch(fe=>n(18,Ee=fe)),r.$$.dirty[1]&50356241&&(ve&&Lt&&Lt.id!==xn&&re&&(!Lt.bbox||Lt.bbox[0]===Lt.bbox[2]&&Lt.bbox[1]===Lt.bbox[3]?ve.flyTo(Lt.center,Lt.id.startsWith("poi.")||Lt.id.startsWith("address.")?ft:wt):ve.fitBounds(L_(Lt.bbox),50,ft),n(14,lt=void 0),n(54,Je=void 0),n(15,Vt=-1)),n(56,xn=Lt==null?void 0:Lt.id)),r.$$.dirty[0]&18432&&St&&lt!=null&&lt.length&&n(15,Vt=0),r.$$.dirty[0]&2050&&(St||n(15,Vt=-1)),r.$$.dirty[0]&16384|r.$$.dirty[1]&8388608&&Je!==lt&&n(54,Je=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&8388624&&ve&&ve.setEventHandler(fe=>{switch(fe.type){case"mapClick":Le&&mn(fe.coordinates);break;case"markerClick":{const je=lt==null?void 0:lt.find(We=>We.id===fe.id);je&&Ln(je)}break;case"markerMouseEnter":Je&&n(15,Vt=Yi?(lt==null?void 0:lt.findIndex(je=>je.id===fe.id))??-1:-1);break;case"markerMouseLeave":Je&&n(15,Vt=-1);break}}),r.$$.dirty[0]&49152&&n(57,s=lt==null?void 0:lt[Vt]),r.$$.dirty[1]&67133969&&ve&&s&&re&&dt&&ve.flyTo(s.center,s.id.startsWith("poi.")||s.id.startsWith("address.")?ft:wt),r.$$.dirty[1]&1040&&(ut||ve==null||ve.setMarkers(void 0,void 0)),r.$$.dirty[1]&75498512&&ve&&ut&&!Je&&(ve.setMarkers(s?[s]:void 0,void 0),ve.setSelectedMarker(s?0:-1)),r.$$.dirty[1]&25165840&&ve&&ve.setMarkers(Je,Lt),r.$$.dirty[0]&32768|r.$$.dirty[1]&8388624&&Je&&ve&&ve.setSelectedMarker(Vt),r.$$.dirty[0]&2|r.$$.dirty[1]&16&&ve){const fe=ct(ye);ve.setReverseMarker(fe?[fe.decimalLongitude,fe.decimalLatitude]:void 0)}r.$$.dirty[1]&67108864&&Ji("select",s),r.$$.dirty[1]&16777216&&Ji("pick",Lt),r.$$.dirty[0]&81920&&Ji("optionsVisibilityChange",Yi&&!!lt),r.$$.dirty[0]&16384&&Ji("featuresListed",lt),r.$$.dirty[1]&8388608&&Ji("featuresMarked",Je),r.$$.dirty[0]&1&&Ji("reverseToggle",Le),r.$$.dirty[0]&2&&Ji("queryChange",ye),r.$$.dirty[0]&1|r.$$.dirty[1]&16&&ve&&ve.indicateReverse(Le)},[Le,ye,m,S,L,U,ee,he,xe,we,Ve,St,Jt,Se,lt,Vt,Yi,kt,Ee,_n,qi,Jr,As,At,Ln,l,x,C,N,B,ie,re,Q,$,pe,ve,De,be,Ue,pt,dt,ut,Bt,vt,wt,ft,xt,It,pn,Rn,Xe,Wn,dn,Ft,Je,Lt,xn,s,f,a,Tt,_r,Gr,wn,Mi,Er,Ki,Zr,Ae,K,J,ce,le]}class j2 extends fn{constructor(e){super(),hn(this,e,U2,B2,un,{class:2,apiKey:25,bbox:26,clearButtonTitle:3,clearOnBlur:27,collapsed:4,country:28,debounceSearch:29,enableReverse:5,errorMessage:6,filter:30,flyTo:31,fuzzyMatch:32,language:33,limit:34,mapController:35,minLength:36,noResultsMessage:7,placeholder:8,proximity:37,reverseActive:0,reverseButtonTitle:9,searchValue:1,showFullGeometry:38,showPlaceType:10,showResultsWhileTyping:39,selectFirst:11,flyToSelected:40,markerOnSelected:41,types:42,excludeTypes:43,zoom:44,maxZoom:45,apiUrl:46,fetchParameters:47,iconsBaseUrl:12,adjustUrlQuery:48,focus:49,blur:50,setQuery:51,clearList:52,clearMap:53},null,[-1,-1,-1])}get focus(){return this.$$.ctx[49]}get blur(){return this.$$.ctx[50]}get setQuery(){return this.$$.ctx[51]}get clearList(){return this.$$.ctx[52]}get clearMap(){return this.$$.ctx[53]}}function j_(r){let e,n,s;return n=new j2({props:{mapController:r[1],apiKey:r[0]}}),{c(){e=ue("div"),ot(n.$$.fragment),He(e,"class","svelte-ixhnie")},m(a,f){ae(a,e,f),rt(n,e,null),s=!0},p(a,f){const m={};f&2&&(m.mapController=a[1]),f&1&&(m.apiKey=a[0]),n.$set(m)},i(a){s||(_e(n.$$.fragment,a),s=!0)},o(a){Ie(n.$$.fragment,a),s=!1},d(a){a&&oe(e),st(n)}}}function V2(r){let e,n,s=r[1]&&j_(r);return{c(){s&&s.c(),e=ni()},m(a,f){s&&s.m(a,f),ae(a,e,f),n=!0},p(a,[f]){a[1]?s?(s.p(a,f),f&2&&_e(s,1)):(s=j_(a),s.c(),_e(s,1),s.m(e.parentNode,e)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn())},i(a){n||(_e(s),n=!0)},o(a){Ie(s),n=!1},d(a){a&&oe(e),s&&s.d(a)}}}function q2(r,e,n){let s,{apiKey:a}=e,{map:f}=e;return r.$$set=m=>{"apiKey"in m&&n(0,a=m.apiKey),"map"in m&&n(2,f=m.map)},r.$$.update=()=>{r.$$.dirty&4&&n(1,s=f?n2(f,Ls):null)},[a,s,f]}class G2 extends fn{constructor(e){super(),hn(this,e,q2,V2,un,{apiKey:0,map:2})}}const Gu=[];function up(r,e){return{subscribe:Yn(r,e).subscribe}}function Yn(r,e=tt){let n;const s=new Set;function a(l){if(un(r,l)&&(r=l,n)){const x=!Gu.length;for(const S of s)S[1](),Gu.push(S,r);if(x){for(let S=0;S<Gu.length;S+=2)Gu[S][0](Gu[S+1]);Gu.length=0}}}function f(l){a(l(r))}function m(l,x=tt){const S=[l,x];return s.add(S),s.size===1&&(n=e(a,f)||tt),l(r),()=>{s.delete(S),s.size===0&&n&&(n(),n=null)}}return{set:a,update:f,subscribe:m}}const Z2=Symbol.for("svelte-maplibre");function H2(){return J0(Z2)}function W2(r){return"layerType"in r&&r.layerType==="deckgl"}var Ph=X2;function X2(r){var e,n,s;if(r){if(Array.isArray(r)){for(e=[],n=r.length,s=0;s<n;s++){var a=r[s];a!=null&&e.push(a)}return e}if(typeof r=="object"){e={};var f=Object.keys(r);for(n=f.length,s=0;s<n;s++){var m=f[s],l=r[m];l!=null&&(e[m]=l)}return e}}}var Zu=Hp;function Hp(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?V_(r,e):{}.toString.call(r)=="[object Set]"?V_(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?Y2(r,e):$2(r,e)}function $2(r,e){return r.toString()===e.toString()}function V_(r,e){var n=r.length;if(n!=e.length)return!1;for(var s=0;s<n;s++)if(!Hp(r[s],e[s]))return!1;return!0}function Y2(r,e){var n=Object.keys(r),s=n.length;if(s!=Object.keys(e).length)return!1;for(var a=0;a<s;a++){var f=n[a];if(!(e.hasOwnProperty(f)&&Hp(r[f],e[f])))return!1}return!0}const J2=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),q_=r=>{var e;return{features:r[4],data:(e=r[4])==null?void 0:e[0],map:r[2],close:r[31]}};function G_(r){let e,n,s=(r[4]||r[3]instanceof Ls.Marker)&&Z_(r);return{c(){e=ue("div"),s&&s.c()},m(a,f){ae(a,e,f),s&&s.m(e,null),r[32](e),n=!0},p(a,f){a[4]||a[3]instanceof Ls.Marker?s?(s.p(a,f),f[0]&24&&_e(s,1)):(s=Z_(a),s.c(),_e(s,1),s.m(e,null)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn())},i(a){n||(_e(s),n=!0)},o(a){Ie(s),n=!1},d(a){a&&oe(e),s&&s.d(),r[32](null)}}}function Z_(r){let e;const n=r[30].default,s=Zi(n,r,r[29],q_);return{c(){s&&s.c()},m(a,f){s&&s.m(a,f),e=!0},p(a,f){s&&s.p&&(!e||f[0]&536870933)&&Wi(s,n,a,a[29],e?Hi(n,a[29],f,J2):Xi(a[29]),q_)},i(a){e||(_e(s,a),e=!0)},o(a){Ie(s,a),e=!1},d(a){s&&s.d(a)}}}function K2(r){let e,n,s=r[9].default&&G_(r);return{c(){s&&s.c(),e=ni()},m(a,f){s&&s.m(a,f),ae(a,e,f),n=!0},p(a,f){a[9].default?s?(s.p(a,f),f[0]&512&&_e(s,1)):(s=G_(a),s.c(),_e(s,1),s.m(e.parentNode,e)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn())},i(a){n||(_e(s),n=!0)},o(a){Ie(s),n=!1},d(a){a&&oe(e),s&&s.d(a)}}}function Q2(r,e,n){let s,a,f,m,l,x,{$$slots:S={},$$scope:C}=e;const L=Jb(S);let{closeButton:N=void 0}=e,{closeOnClickOutside:B=!0}=e,{closeOnClickInside:U=!1}=e,{closeOnMove:ee=!1}=e,{openOn:ie="click"}=e,{openIfTopMost:re=!0}=e,{focusAfterOpen:Q=!0}=e,{anchor:$=void 0}=e,{offset:pe=void 0}=e,{popupClass:ve=void 0}=e,{maxWidth:De=void 0}=e,{lngLat:he=void 0}=e,{html:xe=void 0}=e,{open:be=!1}=e;const Le=hc(),{map:we,popupTarget:ye,layerEvent:Ue,layer:Ve,eventTopMost:pt}=H2();Ot(r,we,Je=>n(2,f=Je)),Ot(r,ye,Je=>n(3,l=Je)),Ot(r,Ue,Je=>n(28,m=Je)),Ot(r,Ve,Je=>n(35,x=Je));const St=["click","dblclick","contextmenu"];let dt,ut=!1,Bt;function vt(){if(!dt)return;let Je=dt.getElement();!Je||Je===Bt||(Bt=Je,ie==="hover"&&(Bt.style.pointerEvents="none"),Bt.addEventListener("mouseenter",()=>{n(24,ut=!0)},{passive:!0}),Bt.addEventListener("mouseleave",()=>{n(24,ut=!1)},{passive:!0}),Bt.addEventListener("click",()=>{U&&n(0,be=!1)},{passive:!0}))}cc(()=>{if(f)return f.on("click",dn),f.on("contextmenu",dn),typeof l=="string"&&(f.on("click",l,It),f.on("dblclick",l,It),f.on("contextmenu",l,It),f.on("mousemove",l,Wn),f.on("mouseleave",l,Xe),f.on("touchstart",l,pn),f.on("touchend",l,Rn)),()=>{f!=null&&f.loaded()&&(dt==null||dt.remove(),f.off("click",dn),f.off("contextmenu",dn),l instanceof Ls.Marker?l.getPopup()===dt&&l.setPopup(void 0):typeof l=="string"&&(f.off("click",l,It),f.off("dblclick",l,It),f.off("contextmenu",l,It),f.off("mousemove",l,Wn),f.off("mouseleave",l,Xe),f.off("touchstart",l,pn),f.off("touchend",l,Rn)))}});function wt(Je){return re?!("marker"in Je)&&!W2(Je)&&pt(Je)!==x:!1}let ft=null,xt="normal";function It(Je){Je.type===ie&&(wt(Je)||("layerType"in Je?Je.layerType==="deckgl"?(n(10,he=Je.coordinate),n(4,ft=Je.object?[Je.object]:null)):(n(10,he=Je.lngLat),n(4,ft=Je.features??[])):(n(10,he=Je.lngLat),n(4,ft=Je.features??[])),setTimeout(()=>n(0,be=!0))))}let Jt=null;function pn(Je){Jt=Je.point}function Rn(Je){if(!Jt||ie!=="hover")return;let Lt=Jt.dist(Je.point);Jt=null,Lt<3&&(n(10,he=Je.lngLat),n(4,ft=Je.features??[]),dt.isOpen()?n(25,xt="justOpened"):(n(25,xt="opening"),n(0,be=!0)))}function Xe(Je){ie!=="hover"||Jt||xt!=="normal"||(n(0,be=!1),n(4,ft=null))}function Wn(Je){if(!(ie!=="hover"||Jt||xt!=="normal")){if(wt(Je)){n(0,be=!1),n(4,ft=null);return}n(0,be=!0),n(4,ft=Je.features??[]),n(10,he=Je.lngLat)}}function dn(Je){if(xt==="justOpened"){n(25,xt="normal");return}if(!B)return;let Lt=[Bt,l instanceof Ls.Marker?l==null?void 0:l.getElement():null];be&&dt.isOpen()&&!Lt.some(Ye=>Ye==null?void 0:Ye.contains(Je.originalEvent.target))&&(Je.type==="contextmenu"&&ie==="contextmenu"||Je.type!=="contextmenu")&&n(0,be=!1)}vo(()=>{f&&(dt!=null&&dt.isOpen())&&dt.remove()});let Ft;const Se=()=>n(0,be=!1);function lt(Je){Jn[Je?"unshift":"push"](()=>{Ft=Je,n(1,Ft)})}return r.$$set=Je=>{"closeButton"in Je&&n(11,N=Je.closeButton),"closeOnClickOutside"in Je&&n(12,B=Je.closeOnClickOutside),"closeOnClickInside"in Je&&n(13,U=Je.closeOnClickInside),"closeOnMove"in Je&&n(14,ee=Je.closeOnMove),"openOn"in Je&&n(15,ie=Je.openOn),"openIfTopMost"in Je&&n(16,re=Je.openIfTopMost),"focusAfterOpen"in Je&&n(17,Q=Je.focusAfterOpen),"anchor"in Je&&n(18,$=Je.anchor),"offset"in Je&&n(19,pe=Je.offset),"popupClass"in Je&&n(20,ve=Je.popupClass),"maxWidth"in Je&&n(21,De=Je.maxWidth),"lngLat"in Je&&n(10,he=Je.lngLat),"html"in Je&&n(22,xe=Je.html),"open"in Je&&n(0,be=Je.open),"$$scope"in Je&&n(29,C=Je.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&n(27,s=N??(!B&&!U)),r.$$.dirty[0]&146685952&&(dt||(n(23,dt=new Ls.Popup({closeButton:s,closeOnClick:!1,closeOnMove:ee,focusAfterOpen:Q,maxWidth:De,className:ve,anchor:$,offset:pe})),Bt=dt.getElement(),dt.on("open",()=>{n(0,be=!0),vt(),Le("open",dt)}),dt.on("close",()=>{n(0,be=!1),Le("close",dt)}),dt.on("hover",()=>{Le("hover",dt)}))),r.$$.dirty[0]&8421384&&dt&&l instanceof Ls.Marker&&(ie==="click"?l.setPopup(dt):l.getPopup()===dt&&l.setPopup(void 0)),r.$$.dirty[0]&268468224&&St.includes(ie)&&(m==null?void 0:m.type)===ie&&(It(m),Dn(Ue,m=null,m)),r.$$.dirty[0]&268468224&&n(26,a=ie==="hover"&&((m==null?void 0:m.type)==="mousemove"||(m==null?void 0:m.type)==="mouseenter")),r.$$.dirty[0]&352354304&&ie==="hover"&&Ue&&(a&&m&&(m.layerType==="deckgl"?(n(10,he=m.coordinate),n(4,ft=m.object?[m.object]:null)):(n(10,he=m.lngLat),n(4,ft=m.features??[]))),n(0,be=(a||ut)??!1)),r.$$.dirty[0]&12582914&&(Ft?dt.setDOMContent(Ft):xe&&dt.setHTML(xe)),r.$$.dirty[0]&8389632&&he&&dt.setLngLat(he),r.$$.dirty[0]&41943045&&f){let Je=dt.isOpen();be&&!Je?(dt.addTo(f),xt==="opening"&&n(25,xt="justOpened")):!be&&Je&&dt.remove()}},[be,Ft,f,l,ft,we,ye,Ue,Ve,L,he,N,B,U,ee,ie,re,Q,$,pe,ve,De,xe,dt,ut,xt,a,s,m,C,S,Se,lt]}class ek extends fn{constructor(e){super(),hn(this,e,Q2,K2,un,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var tc=Math.pow,ps=(r,e,n)=>new Promise((s,a)=>{var f=x=>{try{l(n.next(x))}catch(S){a(S)}},m=x=>{try{l(n.throw(x))}catch(S){a(S)}},l=x=>x.done?s(x.value):Promise.resolve(x.value).then(f,m);l((n=n.apply(r,e)).next())}),eo=Uint8Array,Yu=Uint16Array,tk=Int32Array,Lv=new eo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Mv=new eo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),nk=new eo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Av=function(r,e){for(var n=new Yu(31),s=0;s<31;++s)n[s]=e+=1<<r[s-1];for(var a=new tk(n[30]),s=1;s<30;++s)for(var f=n[s];f<n[s+1];++f)a[f]=f-n[s]<<5|s;return{b:n,r:a}},Pv=Av(Lv,2),Rv=Pv.b,ik=Pv.r;Rv[28]=258,ik[258]=28;var rk=Av(Mv,0),sk=rk.b,Lp=new Yu(32768);for(yi=0;yi<32768;++yi)La=(yi&43690)>>1|(yi&21845)<<1,La=(La&52428)>>2|(La&13107)<<2,La=(La&61680)>>4|(La&3855)<<4,Lp[yi]=((La&65280)>>8|(La&255)<<8)>>1;var La,yi,kh=function(r,e,n){for(var s=r.length,a=0,f=new Yu(e);a<s;++a)r[a]&&++f[r[a]-1];var m=new Yu(e);for(a=1;a<e;++a)m[a]=m[a-1]+f[a-1]<<1;var l;if(n){l=new Yu(1<<e);var x=15-e;for(a=0;a<s;++a)if(r[a])for(var S=a<<4|r[a],C=e-r[a],L=m[r[a]-1]++<<C,N=L|(1<<C)-1;L<=N;++L)l[Lp[L]>>x]=S}else for(l=new Yu(s),a=0;a<s;++a)r[a]&&(l[a]=Lp[m[r[a]-1]++]>>15-r[a]);return l},Fh=new eo(288);for(yi=0;yi<144;++yi)Fh[yi]=8;var yi;for(yi=144;yi<256;++yi)Fh[yi]=9;var yi;for(yi=256;yi<280;++yi)Fh[yi]=7;var yi;for(yi=280;yi<288;++yi)Fh[yi]=8;var yi,Dv=new eo(32);for(yi=0;yi<32;++yi)Dv[yi]=5;var yi,ok=kh(Fh,9,1),ak=kh(Dv,5,1),cp=function(r){for(var e=r[0],n=1;n<r.length;++n)r[n]>e&&(e=r[n]);return e},Mo=function(r,e,n){var s=e/8|0;return(r[s]|r[s+1]<<8)>>(e&7)&n},hp=function(r,e){var n=e/8|0;return(r[n]|r[n+1]<<8|r[n+2]<<16)>>(e&7)},lk=function(r){return(r+7)/8|0},uk=function(r,e,n){(e==null||e<0)&&(e=0),(n==null||n>r.length)&&(n=r.length);var s=new eo(n-e);return s.set(r.subarray(e,n)),s},ck=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Qs=function(r,e,n){var s=new Error(e||ck[r]);if(s.code=r,Error.captureStackTrace&&Error.captureStackTrace(s,Qs),!n)throw s;return s},Wp=function(r,e,n,s){var a=r.length,f=s?s.length:0;if(!a||e.f&&!e.l)return n||new eo(0);var m=!n||e.i!=2,l=e.i;n||(n=new eo(a*3));var x=function(dn){var Ft=n.length;if(dn>Ft){var Se=new eo(Math.max(Ft*2,dn));Se.set(n),n=Se}},S=e.f||0,C=e.p||0,L=e.b||0,N=e.l,B=e.d,U=e.m,ee=e.n,ie=a*8;do{if(!N){S=Mo(r,C,1);var re=Mo(r,C+1,3);if(C+=3,re)if(re==1)N=ok,B=ak,U=9,ee=5;else if(re==2){var ve=Mo(r,C,31)+257,De=Mo(r,C+10,15)+4,he=ve+Mo(r,C+5,31)+1;C+=14;for(var xe=new eo(he),be=new eo(19),Le=0;Le<De;++Le)be[nk[Le]]=Mo(r,C+Le*3,7);C+=De*3;for(var we=cp(be),ye=(1<<we)-1,Ue=kh(be,we,1),Le=0;Le<he;){var Ve=Ue[Mo(r,C,ye)];C+=Ve&15;var Q=Ve>>4;if(Q<16)xe[Le++]=Q;else{var pt=0,St=0;for(Q==16?(St=3+Mo(r,C,3),C+=2,pt=xe[Le-1]):Q==17?(St=3+Mo(r,C,7),C+=3):Q==18&&(St=11+Mo(r,C,127),C+=7);St--;)xe[Le++]=pt}}var dt=xe.subarray(0,ve),ut=xe.subarray(ve);U=cp(dt),ee=cp(ut),N=kh(dt,U,1),B=kh(ut,ee,1)}else Qs(1);else{var Q=lk(C)+4,$=r[Q-4]|r[Q-3]<<8,pe=Q+$;if(pe>a){l&&Qs(0);break}m&&x(L+$),n.set(r.subarray(Q,pe),L),e.b=L+=$,e.p=C=pe*8,e.f=S;continue}if(C>ie){l&&Qs(0);break}}m&&x(L+131072);for(var Bt=(1<<U)-1,vt=(1<<ee)-1,wt=C;;wt=C){var pt=N[hp(r,C)&Bt],ft=pt>>4;if(C+=pt&15,C>ie){l&&Qs(0);break}if(pt||Qs(2),ft<256)n[L++]=ft;else if(ft==256){wt=C,N=null;break}else{var xt=ft-254;if(ft>264){var Le=ft-257,It=Lv[Le];xt=Mo(r,C,(1<<It)-1)+Rv[Le],C+=It}var Jt=B[hp(r,C)&vt],pn=Jt>>4;Jt||Qs(3),C+=Jt&15;var ut=sk[pn];if(pn>3){var It=Mv[pn];ut+=hp(r,C)&(1<<It)-1,C+=It}if(C>ie){l&&Qs(0);break}m&&x(L+131072);var Rn=L+xt;if(L<ut){var Xe=f-ut,Wn=Math.min(ut,Rn);for(Xe+L<0&&Qs(3);L<Wn;++L)n[L]=s[Xe+L]}for(;L<Rn;L+=4)n[L]=n[L-ut],n[L+1]=n[L+1-ut],n[L+2]=n[L+2-ut],n[L+3]=n[L+3-ut];L=Rn}}e.l=N,e.p=wt,e.b=L,e.f=S,N&&(S=1,e.m=U,e.d=B,e.n=ee)}while(!S);return L==n.length?n:uk(n,0,L)},hk=new eo(0),fk=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Qs(6,"invalid gzip data");var e=r[3],n=10;e&4&&(n+=(r[10]|r[11]<<8)+2);for(var s=(e>>3&1)+(e>>4&1);s>0;s-=!r[n++]);return n+(e&2)},dk=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},pk=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Qs(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&Qs(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function mk(r,e){return Wp(r,{i:2},e&&e.out,e&&e.dictionary)}function gk(r,e){var n=fk(r);return n+8>r.length&&Qs(6,"invalid gzip data"),Wp(r.subarray(n,-8),{i:2},e&&e.out||new eo(dk(r)),e&&e.dictionary)}function _k(r,e){return Wp(r.subarray(pk(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Mp(r,e){return r[0]==31&&r[1]==139&&r[2]==8?gk(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?mk(r,e):_k(r,e)}var yk=typeof TextDecoder<"u"&&new TextDecoder,vk=0;try{yk.decode(hk,{stream:!0}),vk=1}catch{}var Nv=(r,e)=>r*tc(2,e),fh=(r,e)=>Math.floor(r/tc(2,e)),qf=(r,e)=>Nv(r.getUint16(e+1,!0),8)+r.getUint8(e),zv=(r,e)=>Nv(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),bk=(r,e,n,s,a)=>{if(r!==s.getUint8(a))return r-s.getUint8(a);const f=qf(s,a+1);if(e!==f)return e-f;const m=qf(s,a+4);return n!==m?n-m:0},xk=(r,e,n,s)=>{const a=Ov(r,e|128,n,s);return a?{z:e,x:n,y:s,offset:a[0],length:a[1],isDir:!0}:null},H_=(r,e,n,s)=>{const a=Ov(r,e,n,s);return a?{z:e,x:n,y:s,offset:a[0],length:a[1],isDir:!1}:null},Ov=(r,e,n,s)=>{let a=0,f=r.byteLength/17-1;for(;a<=f;){const m=f+a>>1,l=bk(e,n,s,r,m*17);if(l>0)a=m+1;else if(l<0)f=m-1;else return[zv(r,m*17+7),r.getUint32(m*17+13,!0)]}return null},wk=(r,e)=>r.isDir&&!e.isDir?1:!r.isDir&&e.isDir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,Fv=(r,e)=>{const n=r.getUint8(e*17);return{z:n&127,x:qf(r,e*17+1),y:qf(r,e*17+4),offset:zv(r,e*17+7),length:r.getUint32(e*17+13,!0),isDir:n>>7===1}},W_=r=>{const e=[],n=new DataView(r);for(let s=0;s<n.byteLength/17;s++)e.push(Fv(n,s));return kk(e)},kk=r=>{r.sort(wk);const e=new ArrayBuffer(17*r.length),n=new Uint8Array(e);for(let s=0;s<r.length;s++){const a=r[s];let f=a.z;a.isDir&&(f=f|128),n[s*17]=f,n[s*17+1]=a.x&255,n[s*17+2]=a.x>>8&255,n[s*17+3]=a.x>>16&255,n[s*17+4]=a.y&255,n[s*17+5]=a.y>>8&255,n[s*17+6]=a.y>>16&255,n[s*17+7]=a.offset&255,n[s*17+8]=fh(a.offset,8)&255,n[s*17+9]=fh(a.offset,16)&255,n[s*17+10]=fh(a.offset,24)&255,n[s*17+11]=fh(a.offset,32)&255,n[s*17+12]=fh(a.offset,48)&255,n[s*17+13]=a.length&255,n[s*17+14]=a.length>>8&255,n[s*17+15]=a.length>>16&255,n[s*17+16]=a.length>>24&255}return e},Ik=(r,e)=>{if(r.byteLength<17)return null;const n=r.byteLength/17,s=Fv(r,n-1);if(s.isDir){const a=s.z,f=e.z-a,m=Math.trunc(e.x/(1<<f)),l=Math.trunc(e.y/(1<<f));return{z:a,x:m,y:l}}return null};function Sk(r){return ps(this,null,function*(){const e=yield r.getBytes(0,512e3),n=new DataView(e.data),s=n.getUint32(4,!0),a=n.getUint16(8,!0),f=new TextDecoder("utf-8"),m=JSON.parse(f.decode(new DataView(e.data,10,s)));let l=0;m.compression==="gzip"&&(l=2);let x=0;"minzoom"in m&&(x=+m.minzoom);let S=0;"maxzoom"in m&&(S=+m.maxzoom);let C=0,L=0,N=0,B=-180,U=-85,ee=180,ie=85;if(m.bounds){const Q=m.bounds.split(",");B=+Q[0],U=+Q[1],ee=+Q[2],ie=+Q[3]}if(m.center){const Q=m.center.split(",");C=+Q[0],L=+Q[1],N=+Q[2]}return{specVersion:n.getUint16(2,!0),rootDirectoryOffset:10+s,rootDirectoryLength:a*17,jsonMetadataOffset:10,jsonMetadataLength:s,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:l,tileType:1,minZoom:x,maxZoom:S,minLon:B,minLat:U,maxLon:ee,maxLat:ie,centerZoom:N,centerLon:C,centerLat:L,etag:e.etag}})}function Ek(r,e,n,s,a,f,m){return ps(this,null,function*(){let l=yield n.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(l=W_(l));const x=H_(new DataView(l),s,a,f);if(x){let L=(yield e.getBytes(x.offset,x.length,m)).data;const N=new DataView(L);return N.getUint8(0)===31&&N.getUint8(1)===139&&(L=Mp(new Uint8Array(L))),{data:L}}const S=Ik(new DataView(l),{z:s,x:a,y:f});if(S){const C=xk(new DataView(l),S.z,S.x,S.y);if(C){let L=yield n.getArrayBuffer(e,C.offset,C.length,r);r.specVersion===1&&(L=W_(L));const N=H_(new DataView(L),s,a,f);if(N){let U=(yield e.getBytes(N.offset,N.length,m)).data;const ee=new DataView(U);return ee.getUint8(0)===31&&ee.getUint8(1)===139&&(U=Mp(new Uint8Array(U))),{data:U}}}}})}var Bv={getHeader:Sk,getZxy:Ek},Tk=r=>(e,n)=>{if(n instanceof AbortController)return r(e,n);const s=new AbortController;return r(e,s).then(a=>n(void 0,a.data,a.cacheControl||"",a.expires||""),a=>n(a)).catch(a=>n(a)),{cancel:()=>s.abort()}},Ck=class{constructor(){this.tilev4=(r,e)=>ps(this,null,function*(){if(r.type==="json"){const L=r.url.substr(10);let N=this.tiles.get(L);N||(N=new X_(L),this.tiles.set(L,N));const B=yield N.getHeader();return{data:{tiles:[`${r.url}/{z}/{x}/{y}`],minzoom:B.minZoom,maxzoom:B.maxZoom,bounds:[B.minLon,B.minLat,B.maxLon,B.maxLat]}}}const n=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=r.url.match(n);if(!s)throw new Error("Invalid PMTiles protocol URL");const a=s[1];let f=this.tiles.get(a);f||(f=new X_(a),this.tiles.set(a,f));const m=s[2],l=s[3],x=s[4],S=yield f.getHeader(),C=yield f==null?void 0:f.getZxy(+m,+l,+x,e.signal);return C?{data:new Uint8Array(C.data),cacheControl:C.cacheControl,expires:C.expires}:S.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=Tk(this.tilev4),this.tiles=new Map}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function Hu(r,e){return(e>>>0)*4294967296+(r>>>0)}function Lk(r,e){const n=e.buf;let s=n[e.pos++],a=(s&112)>>4;if(s<128||(s=n[e.pos++],a|=(s&127)<<3,s<128)||(s=n[e.pos++],a|=(s&127)<<10,s<128)||(s=n[e.pos++],a|=(s&127)<<17,s<128)||(s=n[e.pos++],a|=(s&127)<<24,s<128)||(s=n[e.pos++],a|=(s&1)<<31,s<128))return Hu(r,a);throw new Error("Expected varint not more than 10 bytes")}function dh(r){const e=r.buf;let n=e[r.pos++],s=n&127;return n<128||(n=e[r.pos++],s|=(n&127)<<7,n<128)||(n=e[r.pos++],s|=(n&127)<<14,n<128)||(n=e[r.pos++],s|=(n&127)<<21,n<128)?s:(n=e[r.pos],s|=(n&15)<<28,Lk(s,r))}function Mk(r,e,n,s){if(s===0){n===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const a=e[0];e[0]=e[1],e[1]=a}}var Ak=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Pk(r,e,n){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>tc(2,r)-1||n>tc(2,r)-1)throw Error("tile x/y outside zoom level bounds");const s=Ak[r],a=tc(2,r);let f=0,m=0,l=0;const x=[e,n];let S=a/2;for(;S>0;)f=(x[0]&S)>0?1:0,m=(x[1]&S)>0?1:0,l+=S*S*(3*f^m),Mk(S,x,f,m),S=S/2;return s+l}function Uv(r,e){return ps(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Mp(new Uint8Array(r));const n=new Response(r).body;if(!n)throw Error("Failed to read response stream");const s=n.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(s).arrayBuffer()}throw Error("Compression method not supported")})}var Rk=127;function Dk(r,e){let n=0,s=r.length-1;for(;n<=s;){const a=s+n>>1,f=e-r[a].tileId;if(f>0)n=a+1;else if(f<0)s=a-1;else return r[a]}return s>=0&&(r[s].runLength===0||e-r[s].tileId<r[s].runLength)?r[s]:null}var Nk=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,n,s){return ps(this,null,function*(){let a,f;n?f=n:(a=new AbortController,f=a.signal);const m=new Headers(this.customHeaders);m.set("range",`bytes=${r}-${r+e-1}`);let l;this.mustReload&&(l="reload");let x=yield fetch(this.url,{signal:f,cache:l,headers:m});if(r===0&&x.status===416){const N=x.headers.get("Content-Range");if(!N||!N.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const B=+N.substr(8);x=yield fetch(this.url,{signal:f,cache:"reload",headers:{range:`bytes=0-${B-1}`}})}let S=x.headers.get("Etag");if(S!=null&&S.startsWith("W/")&&(S=null),x.status===416||s&&S&&S!==s)throw this.mustReload=!0,new Ap(`Server returned non-matching ETag ${s} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(x.status>=300)throw Error(`Bad response code: ${x.status}`);const C=x.headers.get("Content-Length");if(x.status===200&&(!C||+C>e))throw a&&a.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield x.arrayBuffer(),etag:S||void 0,cacheControl:x.headers.get("Cache-Control")||void 0,expires:x.headers.get("Expires")||void 0}})}};function Ao(r,e){const n=r.getUint32(e+4,!0),s=r.getUint32(e+0,!0);return n*tc(2,32)+s}function zk(r,e){const n=new DataView(r),s=n.getUint8(7);if(s>3)throw Error(`Archive is spec version ${s} but this library supports up to spec version 3`);return{specVersion:s,rootDirectoryOffset:Ao(n,8),rootDirectoryLength:Ao(n,16),jsonMetadataOffset:Ao(n,24),jsonMetadataLength:Ao(n,32),leafDirectoryOffset:Ao(n,40),leafDirectoryLength:Ao(n,48),tileDataOffset:Ao(n,56),tileDataLength:Ao(n,64),numAddressedTiles:Ao(n,72),numTileEntries:Ao(n,80),numTileContents:Ao(n,88),clustered:n.getUint8(96)===1,internalCompression:n.getUint8(97),tileCompression:n.getUint8(98),tileType:n.getUint8(99),minZoom:n.getUint8(100),maxZoom:n.getUint8(101),minLon:n.getInt32(102,!0)/1e7,minLat:n.getInt32(106,!0)/1e7,maxLon:n.getInt32(110,!0)/1e7,maxLat:n.getInt32(114,!0)/1e7,centerZoom:n.getUint8(118),centerLon:n.getInt32(119,!0)/1e7,centerLat:n.getInt32(123,!0)/1e7,etag:e}}function jv(r){const e={buf:new Uint8Array(r),pos:0},n=dh(e),s=[];let a=0;for(let f=0;f<n;f++){const m=dh(e);s.push({tileId:a+m,offset:0,length:0,runLength:1}),a+=m}for(let f=0;f<n;f++)s[f].runLength=dh(e);for(let f=0;f<n;f++)s[f].length=dh(e);for(let f=0;f<n;f++){const m=dh(e);m===0&&f>0?s[f].offset=s[f-1].offset+s[f-1].length:s[f].offset=m-1}return s}function Ok(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Ap=class extends Error{};function Fk(r,e){return ps(this,null,function*(){const n=yield r.getBytes(0,16384);if(new DataView(n.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Ok(n.data)<3)return[yield Bv.getHeader(r)];const a=n.data.slice(0,Rk),f=zk(a,n.etag),m=n.data.slice(f.rootDirectoryOffset,f.rootDirectoryOffset+f.rootDirectoryLength),l=`${r.getKey()}|${f.etag||""}|${f.rootDirectoryOffset}|${f.rootDirectoryLength}`,x=jv(yield e(m,f.internalCompression));return[f,[l,x.length,x]]})}function Bk(r,e,n,s,a){return ps(this,null,function*(){const f=yield r.getBytes(n,s,void 0,a.etag),m=yield e(f.data,a.internalCompression),l=jv(m);if(l.length===0)throw new Error("Empty directory is invalid");return l})}var Uk=class{constructor(r=100,e=!0,n=Uv){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=r,this.counter=1,this.decompress=n}getHeader(r){return ps(this,null,function*(){const e=r.getKey(),n=this.cache.get(e);if(n)return n.lastUsed=this.counter++,yield n.data;const s=new Promise((a,f)=>{Fk(r,this.decompress).then(m=>{m[1]&&this.cache.set(m[1][0],{lastUsed:this.counter++,data:Promise.resolve(m[1][2])}),a(m[0]),this.prune()}).catch(m=>{f(m)})});return this.cache.set(e,{lastUsed:this.counter++,data:s}),s})}getDirectory(r,e,n,s){return ps(this,null,function*(){const a=`${r.getKey()}|${s.etag||""}|${e}|${n}`,f=this.cache.get(a);if(f)return f.lastUsed=this.counter++,yield f.data;const m=new Promise((l,x)=>{Bk(r,this.decompress,e,n,s).then(S=>{l(S),this.prune()}).catch(S=>{x(S)})});return this.cache.set(a,{lastUsed:this.counter++,data:m}),m})}getArrayBuffer(r,e,n,s){return ps(this,null,function*(){const a=`${r.getKey()}|${s.etag||""}|${e}|${n}`,f=this.cache.get(a);if(f)return f.lastUsed=this.counter++,yield f.data;const m=new Promise((l,x)=>{r.getBytes(e,n,void 0,s.etag).then(S=>{l(S.data),this.cache.has(a),this.prune()}).catch(S=>{x(S)})});return this.cache.set(a,{lastUsed:this.counter++,data:m}),m})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((n,s)=>{n.lastUsed<r&&(r=n.lastUsed,e=s)}),e&&this.cache.delete(e)}}invalidate(r){return ps(this,null,function*(){const e=r.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(r.getKey());const n=new Promise((s,a)=>{this.getHeader(r).then(f=>{s(),this.invalidations.delete(e)}).catch(f=>{a(f)})});this.invalidations.set(e,n)})}},X_=class{constructor(r,e,n){typeof r=="string"?this.source=new Nk(r):this.source=r,n?this.decompress=n:this.decompress=Uv,e?this.cache=e:this.cache=new Uk}getHeader(){return ps(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,n,s){return ps(this,null,function*(){const a=Pk(r,e,n),f=yield this.cache.getHeader(this.source);if(f.specVersion<3)return Bv.getZxy(f,this.source,this.cache,r,e,n,s);if(r<f.minZoom||r>f.maxZoom)return;let m=f.rootDirectoryOffset,l=f.rootDirectoryLength;for(let x=0;x<=3;x++){const S=yield this.cache.getDirectory(this.source,m,l,f),C=Dk(S,a);if(C){if(C.runLength>0){const L=yield this.source.getBytes(f.tileDataOffset+C.offset,C.length,s,f.etag);return{data:yield this.decompress(L.data,f.tileCompression),cacheControl:L.cacheControl,expires:L.expires}}m=f.leafDirectoryOffset+C.offset,l=C.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,n,s){return ps(this,null,function*(){try{return yield this.getZxyAttempt(r,e,n,s)}catch(a){if(a instanceof Ap)return this.cache.invalidate(this.source),yield this.getZxyAttempt(r,e,n,s);throw a}})}getMetadataAttempt(){return ps(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength,void 0,r.etag),n=yield this.decompress(e.data,r.internalCompression),s=new TextDecoder("utf-8");return JSON.parse(s.decode(n))})}getMetadata(){return ps(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof Ap)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw r}})}};const jk=r=>({props:r&8}),$_=r=>({props:Gk(r[3])});function Vk(r){let e;const n=r[1].default,s=Zi(n,r,r[2],$_);return{c(){s&&s.c()},m(a,f){s&&s.m(a,f),e=!0},p(a,f){s&&s.p&&(!e||f&12)&&Wi(s,n,a,a[2],e?Hi(n,a[2],f,jk):Xi(a[2]),$_)},i(a){e||(_e(s,a),e=!0)},o(a){Ie(s,a),e=!1},d(a){s&&s.d(a)}}}function qk(r){let e,n;return e=new ek({props:{openOn:r[0],$$slots:{default:[Vk,({features:s})=>({3:s}),({features:s})=>s?8:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,[a]){const f={};a&1&&(f.openOn=s[0]),a&12&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function Gk(r){return r?r[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function Zk(r,e,n){let{$$slots:s={},$$scope:a}=e,{openOn:f="hover"}=e;return r.$$set=m=>{"openOn"in m&&n(0,f=m.openOn),"$$scope"in m&&n(2,a=m.$$scope)},[f,s,a]}class js extends fn{constructor(e){super(),hn(this,e,Zk,qk,un,{openOn:0})}}function Xp(r,e,n){let s=["match",r];for(let[a,f]of Object.entries(e))s.push(a),s.push(f);return s.push(n),s}function Gf(r,e,n){let s=["step",r];for(let a=1;a<e.length;a++)s.push(n[a-1]),s.push(e[a]);return s.push(n[n.length-1]),s}function Af(){return{type:"FeatureCollection",features:[]}}let Hk=Date.now();function dc(r){return`${r}-${Hk++}`}const $p=Symbol.for("svelte-maplibre");function pc(){return J0($p)}function Wk(r){let e=new WeakMap;return n=>{var m;let s=e.get(n.originalEvent);if(s!==void 0)return s;let f=(m=n.target.queryRenderedFeatures(n.point).find(l=>{var x;return(x=r.get(l.layer.id))==null?void 0:x.interactive}))==null?void 0:m.layer.id;return e.set(n.originalEvent,f),f}}function Xk(){let r=new Map;return Y0($p,{map:Yn(null),source:up(null),layer:up(null),popupTarget:up(null),cluster:Yn(),loadedImages:Yn(new Set),minzoom:Yn(0),maxzoom:Yn(24),layerEvent:Yn(null),layerInfo:r,eventTopMost:Wk(r),markerClickManager:new Jk})}function Y_(r){return{subscribe:r.subscribe}}function Yp({key:r,setPopupTarget:e=!1,setCluster:n=!1,setMouseEvent:s=!1}){let a=pc(),f=Yn(null),m=Y_(f),l={...a,[r]:Y_(f)};if(e&&(l.popupTarget=m),s){let x=Yn(null);l.layerEvent=x,a.layerEvent=x}return n&&(l.cluster=Yn()),Y0($p,l),{...a,self:f}}function Vv(){return Yp({key:"source",setCluster:!0})}function $k(r=!0){return Yp({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Yk(){return Yp({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}class Jk{constructor(){lh(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const n of this._handlers)n(e)}}function J_(r){let e;return n=>{if(n)for(let s in n){let a=e==null?void 0:e[s],f=n[s];a!==f&&r(s,f,a)}else if(e)for(let s in e)r(s,void 0,e[s]);e=n}}function Kk(r,...e){let n=[r];for(let s of e)if(s)Array.isArray(s)&&s[0]===r?n.push(...s.slice(1)):n.push(s);else continue;if(n.length!==1)return n.length===2?n[1]:n}function Qk(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Ms(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}function K_(r){let e=r[0],n,s,a=Q_(r);return{c(){a.c(),n=ni()},m(f,m){a.m(f,m),ae(f,n,m),s=!0},p(f,m){m[0]&1&&un(e,e=f[0])?(Nn(),Ie(a,1,1,tt),zn(),a=Q_(f),a.c(),_e(a,1),a.m(n.parentNode,n)):a.p(f,m)},i(f){s||(_e(a),s=!0)},o(f){Ie(a),s=!1},d(f){f&&oe(n),a.d(f)}}}function Q_(r){let e;const n=r[36].default,s=Zi(n,r,r[35],null);return{c(){s&&s.c()},m(a,f){s&&s.m(a,f),e=!0},p(a,f){s&&s.p&&(!e||f[1]&16)&&Wi(s,n,a,a[35],e?Hi(n,a[35],f,null):Xi(a[35]),null)},i(a){e||(_e(s,a),e=!0)},o(a){Ie(s,a),e=!1},d(a){s&&s.d(a)}}}function eI(r){let e,n,s=r[0]&&K_(r);return{c(){s&&s.c(),e=ni()},m(a,f){s&&s.m(a,f),ae(a,e,f),n=!0},p(a,f){a[0]?s?(s.p(a,f),f[0]&1&&_e(s,1)):(s=K_(a),s.c(),_e(s,1),s.m(e.parentNode,e)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn())},i(a){n||(_e(s),n=!0)},o(a){Ie(s),n=!1},d(a){a&&oe(e),s&&s.d(a)}}}function tI(r,e,n){let s,a,f,m,l,x,S,C,L,N,B,U,{$$slots:ee={},$$scope:ie}=e,{id:re=dc("layer")}=e,{source:Q=void 0}=e,{sourceLayer:$=void 0}=e,{beforeId:pe=void 0}=e,{beforeLayerType:ve=void 0}=e,{type:De}=e,{paint:he=void 0}=e,{layout:xe=void 0}=e,{filter:be=void 0}=e,{applyToClusters:Le=void 0}=e,{minzoom:we=void 0}=e,{maxzoom:ye=void 0}=e,{manageHoverState:Ue=!1}=e,{hovered:Ve=null}=e,{interactive:pt=!0}=e,{hoverCursor:St=void 0}=e,{eventsIfTopMost:dt=!1}=e;const ut=hc(),{map:Bt,source:vt,self:wt,minzoom:ft,maxzoom:xt,eventTopMost:It,layerInfo:Jt}=$k();Ot(r,Bt,lt=>n(31,L=lt)),Ot(r,vt,lt=>n(32,N=lt)),Ot(r,wt,lt=>n(0,C=lt)),Ot(r,ft,lt=>n(34,U=lt)),Ot(r,xt,lt=>n(33,B=lt)),vo(()=>{C&&L&&(Jt.delete(C),L==null||L.removeLayer(C))});let pn;function Rn(lt){var kt,Vt;if(!pt||!C||!L||dt&&It(lt)!==C)return;let Je=lt.features??[],Lt=(Vt=(kt=Je[0])==null?void 0:kt.properties)==null?void 0:Vt.cluster_id,Ye={event:lt,map:L,clusterId:Lt,layer:C,source:l,features:Je};ut(lt.type,Ye)}function Xe(lt){var kt,Vt;if(!pt||!C||!L||dt&&It(lt)!==C)return;St&&(L.getCanvas().style.cursor=St);let Je=lt.features??[];n(6,Ve=Je[0]??null);let Lt=(Vt=(kt=Je[0])==null?void 0:kt.properties)==null?void 0:Vt.cluster_id;ut("mouseenter",{event:lt,map:L,clusterId:Lt,layer:C,source:l,features:Je})}function Wn(lt){var kt,Vt,Ee;if(!pt||!L)return;if(dt&&It(lt)!==C){n(6,Ve=null),Ue&&pn!==void 0&&(L==null||L.setFeatureState({source:l,sourceLayer:$,id:pn},{hover:!1}),pn=void 0);return}L.getCanvas().style.cursor=St;let Je=lt.features??[],Lt=(Vt=(kt=Je[0])==null?void 0:kt.properties)==null?void 0:Vt.cluster_id,Ye=(Ee=Je[0])==null?void 0:Ee.id;Ye!==pn&&(Ue&&(pn!==void 0&&(L==null||L.setFeatureState({source:l,id:pn,sourceLayer:$},{hover:!1})),L==null||L.setFeatureState({source:l,id:Ye,sourceLayer:$},{hover:!0})),pn=Ye,n(6,Ve=Je[0]??null)),ut("mousemove",{event:lt,map:L,clusterId:Lt,layer:C,source:l,features:Je})}function dn(lt){if(!(!pt||!C||!L)){if(St&&(L.getCanvas().style.cursor=""),n(6,Ve=null),Ue&&pn!==void 0){const Je={source:l,id:pn,sourceLayer:$};L==null||L.setFeatureState(Je,{hover:!1}),pn=void 0}ut("mouseleave",{map:L,layer:C,source:l})}}let Ft=!0;function Se(lt){L&&(L.off("click",lt,Rn),L.off("dblclick",lt,Rn),L.off("contextmenu",lt,Rn),L.off("mouseenter",lt,Xe),L.off("mousemove",lt,Wn),L.off("mouseleave",lt,dn))}return vo(()=>{L&&C&&Se(C)}),r.$$set=lt=>{"id"in lt&&n(7,re=lt.id),"source"in lt&&n(8,Q=lt.source),"sourceLayer"in lt&&n(9,$=lt.sourceLayer),"beforeId"in lt&&n(10,pe=lt.beforeId),"beforeLayerType"in lt&&n(11,ve=lt.beforeLayerType),"type"in lt&&n(12,De=lt.type),"paint"in lt&&n(13,he=lt.paint),"layout"in lt&&n(14,xe=lt.layout),"filter"in lt&&n(15,be=lt.filter),"applyToClusters"in lt&&n(16,Le=lt.applyToClusters),"minzoom"in lt&&n(17,we=lt.minzoom),"maxzoom"in lt&&n(18,ye=lt.maxzoom),"manageHoverState"in lt&&n(19,Ue=lt.manageHoverState),"hovered"in lt&&n(6,Ve=lt.hovered),"interactive"in lt&&n(20,pt=lt.interactive),"hoverCursor"in lt&&n(21,St=lt.hoverCursor),"eventsIfTopMost"in lt&&n(22,dt=lt.eventsIfTopMost),"$$scope"in lt&&n(35,ie=lt.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&n(30,s=Qk(Le)),r.$$.dirty[0]&1073774592&&n(24,a=Kk("all",s,be)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&n(26,f=we??U),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&n(25,m=ye??B),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&n(29,l=Q||N),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&L&&C!==re&&l){C&&(Se(C),Jt.delete(C));let lt=pe;if(!pe&&ve){let Je=L.getStyle().layers,Lt=typeof ve=="function"?ve:kt=>kt.type===ve,Ye=Je==null?void 0:Je.find(Lt);Ye&&(lt=Ye.id)}Dn(wt,C=re,C),L.addLayer(Ph({id:C,type:De,source:l,"source-layer":$,filter:a,paint:he,layout:xe,minzoom:f,maxzoom:m}),lt),n(23,Ft=!0),L.on("click",C,Rn),L.on("dblclick",C,Rn),L.on("contextmenu",C,Rn),L.on("mouseenter",C,Xe),L.on("mousemove",C,Wn),L.on("mouseleave",C,dn)}r.$$.dirty[0]&1048577&&C&&Jt.set(C,{interactive:pt}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(28,x=C?J_((lt,Je)=>L==null?void 0:L.setPaintProperty(C,lt,Je)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(27,S=C?J_((lt,Je)=>L==null?void 0:L.setLayoutProperty(C,lt,Je)):void 0),r.$$.dirty[0]&268443648&&(x==null||x(he)),r.$$.dirty[0]&134234112&&(S==null||S(xe)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&C&&(L==null||L.setLayerZoomRange(C,f,m)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&C&&(Ft?n(23,Ft=!1):L==null||L.setFilter(C,a))},[C,Bt,vt,wt,ft,xt,Ve,re,Q,$,pe,ve,De,he,xe,be,Le,we,ye,Ue,pt,St,dt,Ft,a,m,f,S,x,l,s,L,N,B,U,ie,ee]}class Jp extends fn{constructor(e){super(),hn(this,e,tI,eI,un,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function nI(r){let e;const n=r[16].default,s=Zi(n,r,r[24],null);return{c(){s&&s.c()},m(a,f){s&&s.m(a,f),e=!0},p(a,f){s&&s.p&&(!e||f&16777216)&&Wi(s,n,a,a[24],e?Hi(n,a[24],f,null):Xi(a[24]),null)},i(a){e||(_e(s,a),e=!0)},o(a){Ie(s,a),e=!1},d(a){s&&s.d(a)}}}function iI(r){let e,n,s;function a(m){r[17](m)}let f={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[nI]},$$scope:{ctx:r}};return r[0]!==void 0&&(f.hovered=r[0]),e=new Jp({props:f}),Jn.push(()=>Ir(e,"hovered",a)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ot(e.$$.fragment)},m(m,l){rt(e,m,l),s=!0},p(m,[l]){const x={};l&2&&(x.id=m[1]),l&4&&(x.source=m[2]),l&8&&(x.sourceLayer=m[3]),l&16&&(x.beforeId=m[4]),l&32&&(x.beforeLayerType=m[5]),l&64&&(x.paint=m[6]),l&128&&(x.layout=m[7]),l&256&&(x.filter=m[8]),l&512&&(x.applyToClusters=m[9]),l&1024&&(x.minzoom=m[10]),l&2048&&(x.maxzoom=m[11]),l&4096&&(x.hoverCursor=m[12]),l&8192&&(x.manageHoverState=m[13]),l&16384&&(x.eventsIfTopMost=m[14]),l&32768&&(x.interactive=m[15]),l&16777216&&(x.$$scope={dirty:l,ctx:m}),!n&&l&1&&(n=!0,x.hovered=m[0],kr(()=>n=!1)),e.$set(x)},i(m){s||(_e(e.$$.fragment,m),s=!0)},o(m){Ie(e.$$.fragment,m),s=!1},d(m){st(e,m)}}}function rI(r,e,n){let{$$slots:s={},$$scope:a}=e,{id:f=dc("circle")}=e,{source:m=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:x=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:C}=e,{layout:L=void 0}=e,{filter:N=void 0}=e,{applyToClusters:B=void 0}=e,{minzoom:U=void 0}=e,{maxzoom:ee=void 0}=e,{hoverCursor:ie=void 0}=e,{manageHoverState:re=!1}=e,{hovered:Q=null}=e,{eventsIfTopMost:$=!1}=e,{interactive:pe=!0}=e;function ve(ye){Q=ye,n(0,Q)}function De(ye){ur.call(this,r,ye)}function he(ye){ur.call(this,r,ye)}function xe(ye){ur.call(this,r,ye)}function be(ye){ur.call(this,r,ye)}function Le(ye){ur.call(this,r,ye)}function we(ye){ur.call(this,r,ye)}return r.$$set=ye=>{"id"in ye&&n(1,f=ye.id),"source"in ye&&n(2,m=ye.source),"sourceLayer"in ye&&n(3,l=ye.sourceLayer),"beforeId"in ye&&n(4,x=ye.beforeId),"beforeLayerType"in ye&&n(5,S=ye.beforeLayerType),"paint"in ye&&n(6,C=ye.paint),"layout"in ye&&n(7,L=ye.layout),"filter"in ye&&n(8,N=ye.filter),"applyToClusters"in ye&&n(9,B=ye.applyToClusters),"minzoom"in ye&&n(10,U=ye.minzoom),"maxzoom"in ye&&n(11,ee=ye.maxzoom),"hoverCursor"in ye&&n(12,ie=ye.hoverCursor),"manageHoverState"in ye&&n(13,re=ye.manageHoverState),"hovered"in ye&&n(0,Q=ye.hovered),"eventsIfTopMost"in ye&&n(14,$=ye.eventsIfTopMost),"interactive"in ye&&n(15,pe=ye.interactive),"$$scope"in ye&&n(24,a=ye.$$scope)},[Q,f,m,l,x,S,C,L,N,B,U,ee,ie,re,$,pe,s,ve,De,he,xe,be,Le,we,a]}class Kp extends fn{constructor(e){super(),hn(this,e,rI,iI,un,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function sI(r){let e;const n=r[15].default,s=Zi(n,r,r[23],null);return{c(){s&&s.c()},m(a,f){s&&s.m(a,f),e=!0},p(a,f){s&&s.p&&(!e||f&8388608)&&Wi(s,n,a,a[23],e?Hi(n,a[23],f,null):Xi(a[23]),null)},i(a){e||(_e(s,a),e=!0)},o(a){Ie(s,a),e=!1},d(a){s&&s.d(a)}}}function oI(r){let e,n,s;function a(m){r[16](m)}let f={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[sI]},$$scope:{ctx:r}};return r[0]!==void 0&&(f.hovered=r[0]),e=new Jp({props:f}),Jn.push(()=>Ir(e,"hovered",a)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ot(e.$$.fragment)},m(m,l){rt(e,m,l),s=!0},p(m,[l]){const x={};l&2&&(x.id=m[1]),l&4&&(x.source=m[2]),l&8&&(x.sourceLayer=m[3]),l&16&&(x.beforeId=m[4]),l&32&&(x.beforeLayerType=m[5]),l&64&&(x.paint=m[6]),l&128&&(x.layout=m[7]),l&256&&(x.filter=m[8]),l&512&&(x.minzoom=m[9]),l&1024&&(x.maxzoom=m[10]),l&2048&&(x.hoverCursor=m[11]),l&4096&&(x.manageHoverState=m[12]),l&8192&&(x.eventsIfTopMost=m[13]),l&16384&&(x.interactive=m[14]),l&8388608&&(x.$$scope={dirty:l,ctx:m}),!n&&l&1&&(n=!0,x.hovered=m[0],kr(()=>n=!1)),e.$set(x)},i(m){s||(_e(e.$$.fragment,m),s=!0)},o(m){Ie(e.$$.fragment,m),s=!1},d(m){st(e,m)}}}function aI(r,e,n){let{$$slots:s={},$$scope:a}=e,{id:f=dc("fill")}=e,{source:m=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:x=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:C}=e,{layout:L=void 0}=e,{filter:N=void 0}=e,{minzoom:B=void 0}=e,{maxzoom:U=void 0}=e,{hoverCursor:ee=void 0}=e,{manageHoverState:ie=!1}=e,{hovered:re=null}=e,{eventsIfTopMost:Q=!1}=e,{interactive:$=!0}=e;function pe(we){re=we,n(0,re)}function ve(we){ur.call(this,r,we)}function De(we){ur.call(this,r,we)}function he(we){ur.call(this,r,we)}function xe(we){ur.call(this,r,we)}function be(we){ur.call(this,r,we)}function Le(we){ur.call(this,r,we)}return r.$$set=we=>{"id"in we&&n(1,f=we.id),"source"in we&&n(2,m=we.source),"sourceLayer"in we&&n(3,l=we.sourceLayer),"beforeId"in we&&n(4,x=we.beforeId),"beforeLayerType"in we&&n(5,S=we.beforeLayerType),"paint"in we&&n(6,C=we.paint),"layout"in we&&n(7,L=we.layout),"filter"in we&&n(8,N=we.filter),"minzoom"in we&&n(9,B=we.minzoom),"maxzoom"in we&&n(10,U=we.maxzoom),"hoverCursor"in we&&n(11,ee=we.hoverCursor),"manageHoverState"in we&&n(12,ie=we.manageHoverState),"hovered"in we&&n(0,re=we.hovered),"eventsIfTopMost"in we&&n(13,Q=we.eventsIfTopMost),"interactive"in we&&n(14,$=we.interactive),"$$scope"in we&&n(23,a=we.$$scope)},[re,f,m,l,x,S,C,L,N,B,U,ee,ie,Q,$,s,pe,ve,De,he,xe,be,Le,a]}class mc extends fn{constructor(e){super(),hn(this,e,aI,oI,un,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function lI(r,e,n){let s;const{map:a}=pc();Ot(r,a,x=>n(4,s=x));let{position:f="top-left"}=e,{container:m=void 0}=e,l=null;return vo(()=>{s!=null&&s.loaded()&&l&&s.removeControl(l)}),r.$$set=x=>{"position"in x&&n(1,f=x.position),"container"in x&&n(2,m=x.container)},r.$$.update=()=>{if(r.$$.dirty&30&&s&&!l){let x;typeof m=="string"?x=document.querySelector(m)??void 0:x=m,n(3,l=new Ls.FullscreenControl({container:x})),s.addControl(l,f)}},[a,f,m,l,s]}class uI extends fn{constructor(e){super(),hn(this,e,lI,null,un,{position:1,container:2})}}function qv(r,e,n,s,a){let f=!1;r.getSource(e)&&(f=!0,r.removeSource(e));const m=()=>{s(e)&&(r.addSource(e,n),a())};if(f){const l=()=>{e&&(r.getSource(e)?setTimeout(l,1):m())};l()}else m()}function Gv(r,e,n){ex().then(()=>{let s=Df(r);if(!s)return;s.getSource(e)===n&&s.removeSource(e)})}function ey(r){let e=r[0],n,s,a=ty(r);return{c(){a.c(),n=ni()},m(f,m){a.m(f,m),ae(f,n,m),s=!0},p(f,m){m&1&&un(e,e=f[0])?(Nn(),Ie(a,1,1,tt),zn(),a=ty(f),a.c(),_e(a,1),a.m(n.parentNode,n)):a.p(f,m)},i(f){s||(_e(a),s=!0)},o(f){Ie(a),s=!1},d(f){f&&oe(n),a.d(f)}}}function ty(r){let e;const n=r[19].default,s=Zi(n,r,r[18],null);return{c(){s&&s.c()},m(a,f){s&&s.m(a,f),e=!0},p(a,f){s&&s.p&&(!e||f&262144)&&Wi(s,n,a,a[18],e?Hi(n,a[18],f,null):Xi(a[18]),null)},i(a){e||(_e(s,a),e=!0)},o(a){Ie(s,a),e=!1},d(a){s&&s.d(a)}}}function cI(r){let e,n,s=r[0]&&ey(r);return{c(){s&&s.c(),e=ni()},m(a,f){s&&s.m(a,f),ae(a,e,f),n=!0},p(a,[f]){a[0]?s?(s.p(a,f),f&1&&_e(s,1)):(s=ey(a),s.c(),_e(s,1),s.m(e.parentNode,e)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn())},i(a){n||(_e(s),n=!0)},o(a){Ie(s),n=!1},d(a){a&&oe(e),s&&s.d(a)}}}function hI(r,e,n){let s,a,f,{$$slots:m={},$$scope:l}=e,{id:x=dc("geojson")}=e,{data:S}=e,{generateId:C=!1}=e,{promoteId:L=void 0}=e,{filter:N=void 0}=e,{lineMetrics:B=void 0}=e,{cluster:U=void 0}=e,{maxzoom:ee=void 0}=e,{attribution:ie=void 0}=e,{buffer:re=void 0}=e,{tolerance:Q=void 0}=e;const{map:$,cluster:pe,self:ve}=Vv();Ot(r,$,xe=>n(17,a=xe)),Ot(r,pe,xe=>n(20,f=xe)),Ot(r,ve,xe=>n(0,s=xe));let De,he=!0;return vo(()=>{s&&De&&a&&(Gv($,s,De),Dn(ve,s=null,s),n(15,De=void 0))}),r.$$set=xe=>{"id"in xe&&n(4,x=xe.id),"data"in xe&&n(5,S=xe.data),"generateId"in xe&&n(6,C=xe.generateId),"promoteId"in xe&&n(7,L=xe.promoteId),"filter"in xe&&n(8,N=xe.filter),"lineMetrics"in xe&&n(9,B=xe.lineMetrics),"cluster"in xe&&n(10,U=xe.cluster),"maxzoom"in xe&&n(11,ee=xe.maxzoom),"attribution"in xe&&n(12,ie=xe.attribution),"buffer"in xe&&n(13,re=xe.buffer),"tolerance"in xe&&n(14,Q=xe.tolerance),"$$scope"in xe&&n(18,l=xe.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&Dn(pe,f=U,f),r.$$.dirty&196593&&a&&s!==x&&(Dn(ve,s=x,s),qv(a,s,Ph({type:"geojson",data:S,filter:N,lineMetrics:B,generateId:C,promoteId:L,cluster:!!U,clusterMinPoints:U==null?void 0:U.minPoints,clusterMaxZoom:U==null?void 0:U.maxZoom,clusterRadius:U==null?void 0:U.radius,clusterProperties:U==null?void 0:U.properties,maxzoom:ee,attribution:ie,buffer:re,tolerance:Q}),xe=>a&&xe===s,()=>{s&&(n(15,De=a==null?void 0:a.getSource(s)),n(16,he=!0))})),r.$$.dirty&131088&&(a==null||a.on("style.load",()=>{n(15,De=a==null?void 0:a.getSource(x))})),r.$$.dirty&98336&&De&&(he?n(16,he=!1):De.setData(S)),r.$$.dirty&33792&&(De==null||De.setClusterOptions(Ph({cluster:!!U,clusterMaxZoom:U==null?void 0:U.maxZoom,clusterRadius:U==null?void 0:U.radius})))},[s,$,pe,ve,x,S,C,L,N,B,U,ee,ie,re,Q,De,he,a,l,m]}class rr extends fn{constructor(e){super(),hn(this,e,hI,cI,un,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}}function fI(r,e,n){let s;const{map:a}=pc();Ot(r,a,N=>n(8,s=N));let{position:f="top-left"}=e,{positionOptions:m=void 0}=e,{fitBoundsOptions:l=void 0}=e,{trackUserLocation:x=!1}=e,{showAccuracyCircle:S=!0}=e,{showUserLocation:C=!0}=e,{control:L=null}=e;return vo(()=>{s!=null&&s.loaded()&&L&&s.removeControl(L)}),r.$$set=N=>{"position"in N&&n(2,f=N.position),"positionOptions"in N&&n(3,m=N.positionOptions),"fitBoundsOptions"in N&&n(4,l=N.fitBoundsOptions),"trackUserLocation"in N&&n(5,x=N.trackUserLocation),"showAccuracyCircle"in N&&n(6,S=N.showAccuracyCircle),"showUserLocation"in N&&n(7,C=N.showUserLocation),"control"in N&&n(1,L=N.control)},r.$$.update=()=>{r.$$.dirty&510&&s&&!L&&(n(1,L=new Ls.GeolocateControl({positionOptions:m,fitBoundsOptions:l,trackUserLocation:x,showAccuracyCircle:S,showUserLocation:C})),s.addControl(L,f))},[a,L,f,m,l,x,S,C,s]}class dI extends fn{constructor(e){super(),hn(this,e,fI,null,un,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function pI(r){let e;const n=r[15].default,s=Zi(n,r,r[23],null);return{c(){s&&s.c()},m(a,f){s&&s.m(a,f),e=!0},p(a,f){s&&s.p&&(!e||f&8388608)&&Wi(s,n,a,a[23],e?Hi(n,a[23],f,null):Xi(a[23]),null)},i(a){e||(_e(s,a),e=!0)},o(a){Ie(s,a),e=!1},d(a){s&&s.d(a)}}}function mI(r){let e,n,s;function a(m){r[16](m)}let f={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[pI]},$$scope:{ctx:r}};return r[0]!==void 0&&(f.hovered=r[0]),e=new Jp({props:f}),Jn.push(()=>Ir(e,"hovered",a)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ot(e.$$.fragment)},m(m,l){rt(e,m,l),s=!0},p(m,[l]){const x={};l&2&&(x.id=m[1]),l&4&&(x.source=m[2]),l&8&&(x.sourceLayer=m[3]),l&16&&(x.beforeId=m[4]),l&32&&(x.beforeLayerType=m[5]),l&64&&(x.paint=m[6]),l&128&&(x.layout=m[7]),l&256&&(x.filter=m[8]),l&512&&(x.minzoom=m[9]),l&1024&&(x.maxzoom=m[10]),l&2048&&(x.hoverCursor=m[11]),l&4096&&(x.manageHoverState=m[12]),l&8192&&(x.eventsIfTopMost=m[13]),l&16384&&(x.interactive=m[14]),l&8388608&&(x.$$scope={dirty:l,ctx:m}),!n&&l&1&&(n=!0,x.hovered=m[0],kr(()=>n=!1)),e.$set(x)},i(m){s||(_e(e.$$.fragment,m),s=!0)},o(m){Ie(e.$$.fragment,m),s=!1},d(m){st(e,m)}}}function gI(r,e,n){let{$$slots:s={},$$scope:a}=e,{id:f=dc("line")}=e,{source:m=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:x=void 0}=e,{beforeLayerType:S=void 0}=e,{paint:C}=e,{layout:L=void 0}=e,{filter:N=void 0}=e,{minzoom:B=void 0}=e,{maxzoom:U=void 0}=e,{hoverCursor:ee=void 0}=e,{manageHoverState:ie=!1}=e,{hovered:re=null}=e,{eventsIfTopMost:Q=!1}=e,{interactive:$=!0}=e;function pe(we){re=we,n(0,re)}function ve(we){ur.call(this,r,we)}function De(we){ur.call(this,r,we)}function he(we){ur.call(this,r,we)}function xe(we){ur.call(this,r,we)}function be(we){ur.call(this,r,we)}function Le(we){ur.call(this,r,we)}return r.$$set=we=>{"id"in we&&n(1,f=we.id),"source"in we&&n(2,m=we.source),"sourceLayer"in we&&n(3,l=we.sourceLayer),"beforeId"in we&&n(4,x=we.beforeId),"beforeLayerType"in we&&n(5,S=we.beforeLayerType),"paint"in we&&n(6,C=we.paint),"layout"in we&&n(7,L=we.layout),"filter"in we&&n(8,N=we.filter),"minzoom"in we&&n(9,B=we.minzoom),"maxzoom"in we&&n(10,U=we.maxzoom),"hoverCursor"in we&&n(11,ee=we.hoverCursor),"manageHoverState"in we&&n(12,ie=we.manageHoverState),"hovered"in we&&n(0,re=we.hovered),"eventsIfTopMost"in we&&n(13,Q=we.eventsIfTopMost),"interactive"in we&&n(14,$=we.interactive),"$$scope"in we&&n(23,a=we.$$scope)},[re,f,m,l,x,S,C,L,N,B,U,ee,ie,Q,$,s,pe,ve,De,he,xe,be,Le,a]}class mr extends fn{constructor(e){super(),hn(this,e,gI,mI,un,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function _I(r,e,n){let s;const a=hc();let{layer:f=void 0}=e;const{map:m}=pc();Ot(r,m,C=>n(2,s=C));function l(C){a(C.type,{...C,map:m})}const x=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],S=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return vo(()=>{if(s)if(f)for(const C of x)s.off(C,f,l);else for(const C of S)s.off(C,l)}),r.$$set=C=>{"layer"in C&&n(1,f=C.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&s)if(f)for(const C of x)s.on(C,f,l);else for(const C of S)s.on(C,l)},[m,f,s]}class Zv extends fn{constructor(e){super(),hn(this,e,_I,null,un,{layer:1})}}function yI(r){let e=r.getCenter(),n=Math.round(r.getZoom()*100)/100,s=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,s),f=Math.round(e.lat*a)/a,m=Math.round(e.lng*a)/a,l=`${n}/${f}/${m}`,x=r.getBearing(),S=r.getPitch();return(x||S)&&(l+=`/${Math.round(x*10)/10}`),S&&(l+=`/${Math.round(S)}`),`#${l}`}function vI(r){return r.replace("#","").split("/").map(parseFloat)}function bI(r,e,n){let s;const{map:a}=pc();Ot(r,a,C=>n(6,s=C));let{position:f="top-left"}=e,{showCompass:m=!0}=e,{showZoom:l=!0}=e,{visualizePitch:x=!1}=e,S=null;return vo(()=>{s!=null&&s.loaded()&&S&&s.removeControl(S)}),r.$$set=C=>{"position"in C&&n(1,f=C.position),"showCompass"in C&&n(2,m=C.showCompass),"showZoom"in C&&n(3,l=C.showZoom),"visualizePitch"in C&&n(4,x=C.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&s&&!S&&(n(5,S=new Ls.NavigationControl({showCompass:m,showZoom:l,visualizePitch:x})),s.addControl(S,f))},[a,f,m,l,x,S,s]}class xI extends fn{constructor(e){super(),hn(this,e,bI,null,un,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function wI(r,e,n){let s;const{map:a}=pc();Ot(r,a,S=>n(5,s=S));let{position:f="bottom-left"}=e,{maxWidth:m=void 0}=e,{unit:l="metric"}=e,x=null;return vo(()=>{s!=null&&s.loaded()&&x&&s.removeControl(x)}),r.$$set=S=>{"position"in S&&n(1,f=S.position),"maxWidth"in S&&n(2,m=S.maxWidth),"unit"in S&&n(3,l=S.unit)},r.$$.update=()=>{r.$$.dirty&62&&s&&!x&&(n(4,x=new Ls.ScaleControl({maxWidth:m,unit:l})),s.addControl(x,f))},[a,f,m,l,x,s]}class kI extends fn{constructor(e){super(),hn(this,e,wI,null,un,{position:1,maxWidth:2,unit:3})}}const{window:II}=$0,SI=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),ny=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function iy(r){let e,n,s=r[3]&&ry(r);const a=r[46].default,f=Zi(a,r,r[45],ny);return{c(){s&&s.c(),e=Be(),f&&f.c()},m(m,l){s&&s.m(m,l),ae(m,e,l),f&&f.m(m,l),n=!0},p(m,l){m[3]?s?(s.p(m,l),l[0]&8&&_e(s,1)):(s=ry(m),s.c(),_e(s,1),s.m(e.parentNode,e)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn()),f&&f.p&&(!n||l[0]&112|l[1]&16384)&&Wi(f,a,m,m[45],n?Hi(a,m[45],l,SI):Xi(m[45]),ny)},i(m){n||(_e(s),_e(f,m),n=!0)},o(m){Ie(s),Ie(f,m),n=!1},d(m){m&&oe(e),s&&s.d(m),f&&f.d(m)}}}function ry(r){let e,n,s,a,f,m,l,x;return e=new xI({props:{position:r[7]}}),s=new dI({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),f=new uI({props:{position:r[7]}}),l=new kI({props:{position:r[7]}}),{c(){ot(e.$$.fragment),n=Be(),ot(s.$$.fragment),a=Be(),ot(f.$$.fragment),m=Be(),ot(l.$$.fragment)},m(S,C){rt(e,S,C),ae(S,n,C),rt(s,S,C),ae(S,a,C),rt(f,S,C),ae(S,m,C),rt(l,S,C),x=!0},p(S,C){const L={};C[0]&128&&(L.position=S[7]),e.$set(L);const N={};C[0]&128&&(N.position=S[7]),s.$set(N);const B={};C[0]&128&&(B.position=S[7]),f.$set(B);const U={};C[0]&128&&(U.position=S[7]),l.$set(U)},i(S){x||(_e(e.$$.fragment,S),_e(s.$$.fragment,S),_e(f.$$.fragment,S),_e(l.$$.fragment,S),x=!0)},o(S){Ie(e.$$.fragment,S),Ie(s.$$.fragment,S),Ie(f.$$.fragment,S),Ie(l.$$.fragment,S),x=!1},d(S){S&&(oe(n),oe(a),oe(m)),st(e,S),st(s,S),st(f,S),st(l,S)}}}function EI(r){let e,n,s,a,f,m=r[4]&&r[0]&&iy(r);return{c(){e=ue("div"),m&&m.c(),He(e,"class",n=Nf(r[2])+" svelte-p00lfq"),He(e,"data-testid","map-container"),Vr(e,"expand-map",!r[2])},m(l,x){ae(l,e,x),m&&m.m(e,null),r[47](e),s=!0,a||(f=[Pt(II,"hashchange",r[11]),pp(r[10].call(null,e))],a=!0)},p(l,x){l[4]&&l[0]?m?(m.p(l,x),x[0]&17&&_e(m,1)):(m=iy(l),m.c(),_e(m,1),m.m(e,null)):m&&(Nn(),Ie(m,1,1,()=>{m=null}),zn()),(!s||x[0]&4&&n!==(n=Nf(l[2])+" svelte-p00lfq"))&&He(e,"class",n),(!s||x[0]&4)&&Vr(e,"expand-map",!l[2])},i(l){s||(_e(m),s=!0)},o(l){Ie(m),s=!1},d(l){l&&oe(e),m&&m.d(),r[47](null),a=!1,$i(f)}}}function TI(r,e,n){let s,a,f,m,{$$slots:l={},$$scope:x}=e,{map:S=null}=e,{mapContainer:C=void 0}=e,{class:L=void 0}=e,{style:N}=e,{diffStyleUpdates:B=!1}=e,{center:U=void 0}=e,{zoom:ee=void 0}=e,{pitch:ie=0}=e,{bearing:re=0}=e,{bounds:Q=void 0}=e,{hash:$=!1}=e,{updateHash:pe=Ee=>{window.history.replaceState(window.history.state,"",Ee)}}=e,{loaded:ve=!1}=e,{minZoom:De=0}=e,{maxZoom:he=22}=e,{minPitch:xe=0}=e,{maxPitch:be=60}=e,{renderWorldCopies:Le=void 0}=e,{dragPan:we=void 0}=e,{dragRotate:ye=void 0}=e,{pitchWithRotate:Ue=void 0}=e,{antialias:Ve=void 0}=e,{zoomOnDoubleClick:pt=!0}=e,{locale:St=void 0}=e,{interactive:dt=!0}=e,{attributionControl:ut=!0}=e,{cooperativeGestures:Bt=!1}=e,{preserveDrawingBuffer:vt=!1}=e,{maxBounds:wt=void 0}=e,{images:ft=[]}=e,{standardControls:xt=!1}=e,{filterLayers:It=void 0}=e,{transformRequest:Jt=void 0}=e;const pn=hc(),{map:Rn,loadedImages:Xe}=Xk();Ot(r,Rn,Ee=>n(4,f=Ee)),Ot(r,Xe,Ee=>n(5,m=Ee));let Wn=new Set;async function dn(Ee,Gt=!1){if(f&&!(!f.loaded()&&!Gt))if("url"in Ee){Wn.add(Ee.id);try{let _n=await f.loadImage(Ee.url);f==null||f.addImage(Ee.id,_n.data,Ee.options),m.add(Ee.id),Xe.set(m)}catch(_n){pn("error",_n)}finally{Wn.delete(Ee.id)}}else f.addImage(Ee.id,Ee.data,Ee.options),m.add(Ee.id),Xe.set(m)}let Ft,Se,lt,Je;function Lt(Ee){return kt(),Dn(Rn,f=new Ls.Map(Ph({container:Ee,style:N,locale:St,center:U,zoom:ee,pitch:ie,bearing:re,minZoom:De,maxZoom:he,minPitch:xe,maxPitch:be,renderWorldCopies:Le,dragPan:we,dragRotate:ye,pitchWithRotate:Ue,antialias:Ve,interactive:dt,preserveDrawingBuffer:vt,maxBounds:wt,bounds:Q,attributionControl:ut,transformRequest:Jt,cooperativeGestures:Bt})),f),f.on("load",Gt=>{Gt.target.getContainer().setAttribute("data-testid","map"),Gt.target.getCanvas().setAttribute("data-testid","map-canvas"),n(0,ve=!0),pn("load",f)}),f.on("error",Gt=>pn("error",{...Gt,map:f})),f.on("movestart",Gt=>pn("movestart",{...Gt,map:f})),f.on("moveend",Gt=>{if(n(12,U=Gt.target.getCenter()),n(13,ee=Gt.target.getZoom()),n(14,ie=Gt.target.getPitch()),n(15,re=Gt.target.getBearing()),n(16,Q=Gt.target.getBounds()),pn("moveend",{...Gt,map:f}),$){let _n=new URL(window.location.href.replace(/(#.+)?$/,yI(f)));pe(_n)}}),f.on("click",Gt=>pn("click",{...Gt,map:f})),f.on("dblclick",Gt=>pn("dblclick",{...Gt,map:f})),f.on("contextmenu",Gt=>pn("contextmenu",{...Gt,map:f})),f.on("zoomstart",Gt=>pn("zoomstart",{...Gt,map:f})),f.on("zoom",Gt=>{pn("zoom",{...Gt,map:f})}),f.on("zoomend",Gt=>{pn("zoomend",{...Gt,map:f})}),f.on("style.load",()=>{if(f){const Gt=f.getStyle();if(n(42,Ft=Gt.layers.map(_n=>_n.id)),n(43,Se=Object.keys(Gt.sources)),Je)for(const[_n,Kn]of Object.entries(Je))f.addSource(_n,Kn);if(lt)for(const _n of lt)f.addLayer(_n);for(const _n of ft)dn(_n,!0)}}),f.on("styledata",Gt=>{if(f&&It){const _n=f.getStyle().layers;if(_n)for(let Kn of _n)It(Kn)||f.setLayoutProperty(Kn.id,"visibility","none")}pn("styledata",{...Gt,map:f})}),{destroy(){n(0,ve=!1),f==null||f.remove(),Dn(Rn,f=null,f)}}}let Ye=N;function kt(){if($){let Ee=vI(window.location.hash);Ee.length>=3&&(n(13,ee=Ee[0]),n(12,U=[Ee[2],Ee[1]])),Ee.length==5&&(n(15,re=Ee[3]),n(14,ie=Ee[4]))}}function Vt(Ee){Jn[Ee?"unshift":"push"](()=>{C=Ee,n(1,C)})}return r.$$set=Ee=>{"map"in Ee&&n(17,S=Ee.map),"mapContainer"in Ee&&n(1,C=Ee.mapContainer),"class"in Ee&&n(2,L=Ee.class),"style"in Ee&&n(18,N=Ee.style),"diffStyleUpdates"in Ee&&n(19,B=Ee.diffStyleUpdates),"center"in Ee&&n(12,U=Ee.center),"zoom"in Ee&&n(13,ee=Ee.zoom),"pitch"in Ee&&n(14,ie=Ee.pitch),"bearing"in Ee&&n(15,re=Ee.bearing),"bounds"in Ee&&n(16,Q=Ee.bounds),"hash"in Ee&&n(20,$=Ee.hash),"updateHash"in Ee&&n(21,pe=Ee.updateHash),"loaded"in Ee&&n(0,ve=Ee.loaded),"minZoom"in Ee&&n(22,De=Ee.minZoom),"maxZoom"in Ee&&n(23,he=Ee.maxZoom),"minPitch"in Ee&&n(24,xe=Ee.minPitch),"maxPitch"in Ee&&n(25,be=Ee.maxPitch),"renderWorldCopies"in Ee&&n(26,Le=Ee.renderWorldCopies),"dragPan"in Ee&&n(27,we=Ee.dragPan),"dragRotate"in Ee&&n(28,ye=Ee.dragRotate),"pitchWithRotate"in Ee&&n(29,Ue=Ee.pitchWithRotate),"antialias"in Ee&&n(30,Ve=Ee.antialias),"zoomOnDoubleClick"in Ee&&n(31,pt=Ee.zoomOnDoubleClick),"locale"in Ee&&n(32,St=Ee.locale),"interactive"in Ee&&n(33,dt=Ee.interactive),"attributionControl"in Ee&&n(34,ut=Ee.attributionControl),"cooperativeGestures"in Ee&&n(35,Bt=Ee.cooperativeGestures),"preserveDrawingBuffer"in Ee&&n(36,vt=Ee.preserveDrawingBuffer),"maxBounds"in Ee&&n(37,wt=Ee.maxBounds),"images"in Ee&&n(38,ft=Ee.images),"standardControls"in Ee&&n(3,xt=Ee.standardControls),"filterLayers"in Ee&&n(39,It=Ee.filterLayers),"transformRequest"in Ee&&n(40,Jt=Ee.transformRequest),"$$scope"in Ee&&n(45,x=Ee.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&n(7,s=typeof xt=="boolean"?void 0:xt),r.$$.dirty[0]&16&&n(17,S=f),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&f&&!Zu(N,Ye)){const Ee=f.getStyle();if(Ft&&(lt=Ee.layers.filter(Gt=>!Ft.includes(Gt.id))),Se){const Gt=Object.keys(Ee.sources).filter(_n=>!Se.includes(_n));Je={};for(const _n of Gt)Je[_n]=Ee.sources[_n]}n(44,Ye=N),f.setStyle(N,{diff:B}),Dn(Xe,m=new Set,m),n(41,Wn=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&ve&&f!=null&&f.loaded())for(let Ee of ft)!m.has(Ee.id)&&!Wn.has(Ee.id)&&!f.hasImage(Ee.id)&&dn(Ee);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&n(6,a=ft.every(Ee=>m.has(Ee.id))),r.$$.dirty[0]&61456&&f){let Ee={};U!=null&&!Zu(U,f==null?void 0:f.getCenter())&&(Ee.center=U),ee!=null&&!Zu(ee,f==null?void 0:f.getZoom())&&(Ee.zoom=ee),re!=null&&!Zu(re,f==null?void 0:f.getBearing())&&(Ee.bearing=re),ie!=null&&!Zu(ie,f==null?void 0:f.getPitch())&&(Ee.pitch=ie),Object.keys(Ee).length&&f.easeTo(Ee)}r.$$.dirty[0]&65552&&Q&&!Zu(Q,f==null?void 0:f.getBounds())&&(f==null||f.fitBounds(Q)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(pt?f==null||f.doubleClickZoom.enable():f==null||f.doubleClickZoom.disable())},[ve,C,L,xt,f,m,a,s,Rn,Xe,Lt,kt,U,ee,ie,re,Q,S,N,B,$,pe,De,he,xe,be,Le,we,ye,Ue,Ve,pt,St,dt,ut,Bt,vt,wt,ft,It,Jt,Wn,Ft,Se,Ye,x,l,Vt]}class CI extends fn{constructor(e){super(),hn(this,e,TI,EI,un,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const LI=r=>({marker:r&8}),sy=r=>({marker:r[3]});function MI(r){let e,n,s,a,f,m,l;const x=r[19].default,S=Zi(x,r,r[18],sy);return{c(){e=ue("div"),S&&S.c(),He(e,"tabindex",n=r[1]?0:void 0),He(e,"role",s=r[1]?"button":void 0),Un(e,"z-index",r[2])},m(C,L){ae(C,e,L),S&&S.m(e,null),f=!0,m||(l=[pp(r[7].call(null,e)),pp(a=AI.call(null,e,r[0])),Pt(e,"click",np(r[20])),Pt(e,"dblclick",np(r[21])),Pt(e,"contextmenu",np(Nh(r[22]))),Pt(e,"mouseenter",r[23]),Pt(e,"mouseleave",r[24]),Pt(e,"mousemove",r[25]),Pt(e,"keydown",r[8])],m=!0)},p(C,[L]){S&&S.p&&(!f||L&262152)&&Wi(S,x,C,C[18],f?Hi(x,C[18],L,LI):Xi(C[18]),sy),(!f||L&2&&n!==(n=C[1]?0:void 0))&&He(e,"tabindex",n),(!f||L&2&&s!==(s=C[1]?"button":void 0))&&He(e,"role",s),a&&iu(a.update)&&L&1&&a.update.call(null,C[0]),L&4&&Un(e,"z-index",C[2])},i(C){f||(_e(S,C),f=!0)},o(C){Ie(S,C),f=!1},d(C){C&&oe(e),S&&S.d(C),m=!1,$i(l)}}}function AI(r,e){const n=r.className;function s(a){a?r.className=`${n} ${a}`:r.className=n}return s(e),{update:s}}function PI(r,e,n){let s,a,f,{$$slots:m={},$$scope:l}=e,{marker:x=void 0}=e,{lngLat:S}=e,{class:C=void 0}=e,{interactive:L=!0}=e,{asButton:N=!1}=e,{draggable:B=!1}=e,{feature:U=null}=e,{offset:ee=void 0}=e,{zIndex:ie=void 0}=e,{rotation:re=0}=e,{opacity:Q=1}=e;const $=hc(),{map:pe,layerEvent:ve,self:De,markerClickManager:he}=Yk();Ot(r,pe,ut=>n(27,f=ut)),Ot(r,ve,ut=>n(26,s=ut)),Ot(r,De,ut=>n(3,a=ut));function xe(ut){Dn(De,a=new Ls.Marker({element:ut,rotation:re,draggable:B,offset:ee,opacity:Q.toString()}).setLngLat(S).addTo(f),a),n(11,x=a);const Bt=()=>we("dragstart"),vt=()=>{be(),we("drag")},wt=()=>{be(),we("dragend")};return B&&(a.on("dragstart",Bt),a.on("drag",vt),a.on("dragend",wt)),{destroy(){B&&(a==null||a.off("dragstart",Bt),a==null||a.off("drag",vt),a==null||a.off("dragend",wt)),n(11,x=void 0),a==null||a.remove()}}}function be(){let ut=a==null?void 0:a.getLngLat();ut&&(Array.isArray(S)?n(10,S=[ut.lng,ut.lat]):S&&"lon"in S?n(10,S={lon:ut.lng,lat:ut.lat}):n(10,S=ut))}function Le(ut){ut.key===" "&&(ut.preventDefault(),ut.stopPropagation(),we("click"))}function we(ut){if(!L)return;let Bt=a==null?void 0:a.getLngLat();if(!Bt)return;const vt=[Bt.lng,Bt.lat];let wt={map:f,marker:a,lngLat:vt,features:[{type:"Feature",properties:(U==null?void 0:U.properties)??{},geometry:{type:"Point",coordinates:vt}}]};(ut==="click"||ut==="contextmenu")&&he.handleClick(wt),Dn(ve,s={...wt,layerType:"marker",type:ut},s),$(ut,wt)}const ye=()=>we("click"),Ue=()=>we("dblclick"),Ve=()=>{we("contextmenu")},pt=()=>{we("mouseenter")},St=()=>{we("mouseleave")},dt=()=>we("mousemove");return r.$$set=ut=>{"marker"in ut&&n(11,x=ut.marker),"lngLat"in ut&&n(10,S=ut.lngLat),"class"in ut&&n(0,C=ut.class),"interactive"in ut&&n(12,L=ut.interactive),"asButton"in ut&&n(1,N=ut.asButton),"draggable"in ut&&n(13,B=ut.draggable),"feature"in ut&&n(14,U=ut.feature),"offset"in ut&&n(15,ee=ut.offset),"zIndex"in ut&&n(2,ie=ut.zIndex),"rotation"in ut&&n(16,re=ut.rotation),"opacity"in ut&&n(17,Q=ut.opacity),"$$scope"in ut&&n(18,l=ut.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(a==null||a.setLngLat(S)),r.$$.dirty&32776&&(a==null||a.setOffset(ee??[0,0])),r.$$.dirty&65544&&(a==null||a.setRotation(re)),r.$$.dirty&131080&&(a==null||a.setOpacity(Q.toString()))},[C,N,ie,a,pe,ve,De,xe,Le,we,S,x,L,B,U,ee,re,Q,l,m,ye,Ue,Ve,pt,St,dt]}class Zf extends fn{constructor(e){super(),hn(this,e,PI,MI,un,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}function oy(r){let e=r[0],n,s,a=ay(r);return{c(){a.c(),n=ni()},m(f,m){a.m(f,m),ae(f,n,m),s=!0},p(f,m){m&1&&un(e,e=f[0])?(Nn(),Ie(a,1,1,tt),zn(),a=ay(f),a.c(),_e(a,1),a.m(n.parentNode,n)):a.p(f,m)},i(f){s||(_e(a),s=!0)},o(f){Ie(a),s=!1},d(f){f&&oe(n),a.d(f)}}}function ay(r){let e;const n=r[15].default,s=Zi(n,r,r[14],null);return{c(){s&&s.c()},m(a,f){s&&s.m(a,f),e=!0},p(a,f){s&&s.p&&(!e||f&16384)&&Wi(s,n,a,a[14],e?Hi(n,a[14],f,null):Xi(a[14]),null)},i(a){e||(_e(s,a),e=!0)},o(a){Ie(s,a),e=!1},d(a){s&&s.d(a)}}}function RI(r){let e,n,s=r[0]&&oy(r);return{c(){s&&s.c(),e=ni()},m(a,f){s&&s.m(a,f),ae(a,e,f),n=!0},p(a,[f]){a[0]?s?(s.p(a,f),f&1&&_e(s,1)):(s=oy(a),s.c(),_e(s,1),s.m(e.parentNode,e)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn())},i(a){n||(_e(s),n=!0)},o(a){Ie(s),n=!1},d(a){a&&oe(e),s&&s.d(a)}}}function DI(r,e,n){let s,a,{$$slots:f={},$$scope:m}=e,{id:l=dc("vector")}=e,{url:x=null}=e,{tiles:S=null}=e,{promoteId:C=null}=e,{bounds:L=null}=e,{scheme:N=null}=e,{attribution:B=null}=e,{minzoom:U=null}=e,{maxzoom:ee=null}=e,{volatile:ie=null}=e;if(x&&x.includes("pmtiles://")&&!Ls.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let pe=new Ck;Ls.addProtocol("pmtiles",pe.tile)}const{map:re,self:Q}=Vv();Ot(r,re,pe=>n(13,a=pe)),Ot(r,Q,pe=>n(0,s=pe));let $;return vo(()=>{s&&a&&(Gv(re,s,$),Dn(Q,s=null,s),$=void 0)}),r.$$set=pe=>{"id"in pe&&n(3,l=pe.id),"url"in pe&&n(4,x=pe.url),"tiles"in pe&&n(5,S=pe.tiles),"promoteId"in pe&&n(6,C=pe.promoteId),"bounds"in pe&&n(7,L=pe.bounds),"scheme"in pe&&n(8,N=pe.scheme),"attribution"in pe&&n(9,B=pe.attribution),"minzoom"in pe&&n(10,U=pe.minzoom),"maxzoom"in pe&&n(11,ee=pe.maxzoom),"volatile"in pe&&n(12,ie=pe.volatile),"$$scope"in pe&&n(14,m=pe.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&a&&s!==l&&(Dn(Q,s=l,s),qv(a,s,Ph({type:"vector",url:x,tiles:S,promoteId:C,bounds:L,scheme:N,attribution:B,minzoom:U,maxzoom:ee,volatile:ie}),pe=>a&&pe===s,()=>{s&&($=a==null?void 0:a.getSource(s))})),r.$$.dirty&8200&&(a==null||a.on("style.load",()=>{$=a==null?void 0:a.getSource(l)}))},[s,re,Q,l,x,S,C,L,N,B,U,ee,ie,a,m,f]}class Qp extends fn{constructor(e){super(),hn(this,e,DI,RI,un,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const NI=r=>({}),ly=r=>({}),zI=r=>({}),uy=r=>({}),OI=r=>({}),cy=r=>({}),FI=r=>({}),hy=r=>({});function BI(r){let e,n,s,a,f,m,l,x,S;const C=r[1].top,L=Zi(C,r,r[0],hy),N=r[1].left,B=Zi(N,r,r[0],cy),U=r[1].main,ee=Zi(U,r,r[0],uy),ie=r[1].right,re=Zi(ie,r,r[0],ly);return{c(){e=ue("div"),L&&L.c(),n=Be(),s=ue("div"),a=ue("div"),B&&B.c(),f=Be(),m=ue("div"),ee&&ee.c(),l=Be(),x=ue("div"),re&&re.c(),He(e,"class","top svelte-11kzs8g"),He(a,"class","left svelte-11kzs8g"),He(m,"class","main svelte-11kzs8g"),He(x,"class","right svelte-11kzs8g"),He(s,"class","main-row svelte-11kzs8g")},m(Q,$){ae(Q,e,$),L&&L.m(e,null),ae(Q,n,$),ae(Q,s,$),Z(s,a),B&&B.m(a,null),Z(s,f),Z(s,m),ee&&ee.m(m,null),Z(s,l),Z(s,x),re&&re.m(x,null),S=!0},p(Q,[$]){L&&L.p&&(!S||$&1)&&Wi(L,C,Q,Q[0],S?Hi(C,Q[0],$,FI):Xi(Q[0]),hy),B&&B.p&&(!S||$&1)&&Wi(B,N,Q,Q[0],S?Hi(N,Q[0],$,OI):Xi(Q[0]),cy),ee&&ee.p&&(!S||$&1)&&Wi(ee,U,Q,Q[0],S?Hi(U,Q[0],$,zI):Xi(Q[0]),uy),re&&re.p&&(!S||$&1)&&Wi(re,ie,Q,Q[0],S?Hi(ie,Q[0],$,NI):Xi(Q[0]),ly)},i(Q){S||(_e(L,Q),_e(B,Q),_e(ee,Q),_e(re,Q),S=!0)},o(Q){Ie(L,Q),Ie(B,Q),Ie(ee,Q),Ie(re,Q),S=!1},d(Q){Q&&(oe(e),oe(n),oe(s)),L&&L.d(Q),B&&B.d(Q),ee&&ee.d(Q),re&&re.d(Q)}}}function UI(r,e,n){let{$$slots:s={},$$scope:a}=e;return r.$$set=f=>{"$$scope"in f&&n(0,a=f.$$scope)},[a,s]}class jI extends fn{constructor(e){super(),hn(this,e,UI,BI,un,{})}}const VI=r=>({}),fy=r=>({}),qI=r=>({}),dy=r=>({}),GI=r=>({}),py=r=>({});function ZI(r){let e,n,s,a,f,m;const l=r[4].left,x=Zi(l,r,r[3],py),S=r[4].map,C=Zi(S,r,r[3],dy),L=r[4].right,N=Zi(L,r,r[3],fy);return{c(){e=ue("div"),x&&x.c(),n=Be(),s=ue("div"),C&&C.c(),a=Be(),f=ue("div"),N&&N.c()},m(B,U){ae(B,e,U),x&&x.m(e,null),r[5](e),ae(B,n,U),ae(B,s,U),C&&C.m(s,null),r[6](s),ae(B,a,U),ae(B,f,U),N&&N.m(f,null),r[7](f),m=!0},p(B,[U]){x&&x.p&&(!m||U&8)&&Wi(x,l,B,B[3],m?Hi(l,B[3],U,GI):Xi(B[3]),py),C&&C.p&&(!m||U&8)&&Wi(C,S,B,B[3],m?Hi(S,B[3],U,qI):Xi(B[3]),dy),N&&N.p&&(!m||U&8)&&Wi(N,L,B,B[3],m?Hi(L,B[3],U,VI):Xi(B[3]),fy)},i(B){m||(_e(x,B),_e(C,B),_e(N,B),m=!0)},o(B){Ie(x,B),Ie(C,B),Ie(N,B),m=!1},d(B){B&&(oe(e),oe(n),oe(s),oe(a),oe(f)),x&&x.d(B),r[5](null),C&&C.d(B),r[6](null),N&&N.d(B),r[7](null)}}}function HI(r,e,n){let s,a,f;Ot(r,Pp,L=>n(0,s=L)),Ot(r,Dp,L=>n(1,a=L)),Ot(r,Rp,L=>n(2,f=L));let{$$slots:m={},$$scope:l}=e;function x(L){Jn[L?"unshift":"push"](()=>{s=L,Pp.set(s)})}function S(L){Jn[L?"unshift":"push"](()=>{a=L,Dp.set(a)})}function C(L){Jn[L?"unshift":"push"](()=>{f=L,Rp.set(f)})}return r.$$set=L=>{"$$scope"in L&&n(3,l=L.$$scope)},[s,a,f,l,m,x,S,C]}class gc extends fn{constructor(e){super(),hn(this,e,HI,ZI,un,{})}}let Pp=Yn(null),Rp=Yn(null),Dp=Yn(null);function my(r){let e,n;return{c(){e=ue("div"),n=Oe(r[0]),He(e,"class","svelte-1uuov7f")},m(s,a){ae(s,e,a),Z(e,n)},p(s,a){a&1&&Mt(n,s[0])},d(s){s&&oe(e)}}}function WI(r){let e,n=r[0]&&my(r);return{c(){n&&n.c(),e=ni()},m(s,a){n&&n.m(s,a),ae(s,e,a)},p(s,[a]){s[0]?n?n.p(s,a):(n=my(s),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:tt,o:tt,d(s){s&&oe(e),n&&n.d(s)}}}function XI(r,e,n){let{loading:s}=e;return r.$$set=a=>{"loading"in a&&n(0,s=a.loading)},[s]}class $I extends fn{constructor(e){super(),hn(this,e,XI,WI,un,{loading:0})}}const YI=r=>({dialog:r&1}),gy=r=>({dialog:r[0]});function JI(r){let e,n,s,a,f;const m=r[4].default,l=Zi(m,r,r[3],gy);return{c(){e=ue("dialog"),n=ue("article"),l&&l.c(),e.open=!0},m(x,S){ae(x,e,S),Z(e,n),l&&l.m(n,null),r[6](e),s=!0,a||(f=[Pt(window,"click",r[1]),Pt(window,"keydown",r[2]),Pt(e,"close",r[5])],a=!0)},p(x,[S]){l&&l.p&&(!s||S&9)&&Wi(l,m,x,x[3],s?Hi(m,x[3],S,YI):Xi(x[3]),gy)},i(x){s||(_e(l,x),s=!0)},o(x){Ie(l,x),s=!1},d(x){x&&oe(e),l&&l.d(x),r[6](null),a=!1,$i(f)}}}function KI(r,e,n){let{$$slots:s={},$$scope:a}=e,f;function m(C){f.open&&C.target==f&&f.close()}function l(C){(C.key=="Escape"||C.key=="Enter")&&(C.stopPropagation(),f.close())}function x(C){ur.call(this,r,C)}function S(C){Jn[C?"unshift":"push"](()=>{f=C,n(0,f)})}return r.$$set=C=>{"$$scope"in C&&n(3,a=C.$$scope)},[f,m,l,a,s,x,S]}class Hv extends fn{constructor(e){super(),hn(this,e,KI,JI,un,{})}}function _y(r,e,n){const s=r.slice();return s[1]=e[n][0],s[2]=e[n][1],s}function yy(r){let e,n,s=r[1]+"",a,f,m,l=r[2]+"",x,S;return{c(){e=ue("tr"),n=ue("td"),a=Oe(s),f=Be(),m=ue("td"),x=Oe(l),S=Be()},m(C,L){ae(C,e,L),Z(e,n),Z(n,a),Z(e,f),Z(e,m),Z(m,x),Z(e,S)},p(C,L){L&1&&s!==(s=C[1]+"")&&Mt(a,s),L&1&&l!==(l=C[2]+"")&&Mt(x,l)},d(C){C&&oe(e)}}}function QI(r){let e,n,s=Hn(Object.entries(r[0])),a=[];for(let f=0;f<s.length;f+=1)a[f]=yy(_y(r,s,f));return{c(){e=ue("table"),n=ue("tbody");for(let f=0;f<a.length;f+=1)a[f].c();He(e,"class","svelte-lh2o9l")},m(f,m){ae(f,e,m),Z(e,n);for(let l=0;l<a.length;l+=1)a[l]&&a[l].m(n,null)},p(f,[m]){if(m&1){s=Hn(Object.entries(f[0]));let l;for(l=0;l<s.length;l+=1){const x=_y(f,s,l);a[l]?a[l].p(x,m):(a[l]=yy(x),a[l].c(),a[l].m(n,null))}for(;l<a.length;l+=1)a[l].d(1);a.length=s.length}},i:tt,o:tt,d(f){f&&oe(e),Sr(a,f)}}}function eS(r,e,n){let{properties:s}=e;return r.$$set=a=>{"properties"in a&&n(0,s=a.properties)},[s]}class tS extends fn{constructor(e){super(),hn(this,e,eS,QI,un,{properties:0})}}function vy(r,e,n){const s=r.slice();return s[3]=e[n],s}function by(r,e,n){const s=r.slice();return s[6]=e[n],s}function xy(r){let e,n;return{c(){e=ue("span"),n=Oe(` 
    `),Un(e,"background",r[6]),Un(e,"width","100%"),Un(e,"border","1px solid black")},m(s,a){ae(s,e,a),Z(e,n)},p(s,a){a&1&&Un(e,"background",s[6])},d(s){s&&oe(e)}}}function nS(r){let e,n=r[3]+"",s;return{c(){e=ue("span"),s=Oe(n)},m(a,f){ae(a,e,f),Z(e,s)},p(a,f){f&2&&n!==(n=a[3]+"")&&Mt(s,n)},d(a){a&&oe(e)}}}function iS(r){let e,n=r[3].toFixed(r[2])+"",s;return{c(){e=ue("span"),s=Oe(n)},m(a,f){ae(a,e,f),Z(e,s)},p(a,f){f&6&&n!==(n=a[3].toFixed(a[2])+"")&&Mt(s,n)},d(a){a&&oe(e)}}}function wy(r){let e;function n(f,m){return f[2]>0?iS:nS}let s=n(r),a=s(r);return{c(){a.c(),e=ni()},m(f,m){a.m(f,m),ae(f,e,m)},p(f,m){s===(s=n(f))&&a?a.p(f,m):(a.d(1),a=s(f),a&&(a.c(),a.m(e.parentNode,e)))},d(f){f&&oe(e),a.d(f)}}}function rS(r){let e,n,s,a=Hn(r[0]),f=[];for(let x=0;x<a.length;x+=1)f[x]=xy(by(r,a,x));let m=Hn(r[1]),l=[];for(let x=0;x<m.length;x+=1)l[x]=wy(vy(r,m,x));return{c(){e=ue("div");for(let x=0;x<f.length;x+=1)f[x].c();n=Be(),s=ue("div");for(let x=0;x<l.length;x+=1)l[x].c();Un(e,"display","flex"),Un(s,"display","flex"),Un(s,"justify-content","space-between")},m(x,S){ae(x,e,S);for(let C=0;C<f.length;C+=1)f[C]&&f[C].m(e,null);ae(x,n,S),ae(x,s,S);for(let C=0;C<l.length;C+=1)l[C]&&l[C].m(s,null)},p(x,[S]){if(S&1){a=Hn(x[0]);let C;for(C=0;C<a.length;C+=1){const L=by(x,a,C);f[C]?f[C].p(L,S):(f[C]=xy(L),f[C].c(),f[C].m(e,null))}for(;C<f.length;C+=1)f[C].d(1);f.length=a.length}if(S&6){m=Hn(x[1]);let C;for(C=0;C<m.length;C+=1){const L=vy(x,m,C);l[C]?l[C].p(L,S):(l[C]=wy(L),l[C].c(),l[C].m(s,null))}for(;C<l.length;C+=1)l[C].d(1);l.length=m.length}},i:tt,o:tt,d(x){x&&(oe(e),oe(n),oe(s)),Sr(f,x),Sr(l,x)}}}function sS(r,e,n){let{colorScale:s}=e,{limits:a}=e,{decimalPlaces:f=0}=e;return r.$$set=m=>{"colorScale"in m&&n(0,s=m.colorScale),"limits"in m&&n(1,a=m.limits),"decimalPlaces"in m&&n(2,f=m.decimalPlaces)},[s,a,f]}class em extends fn{constructor(e){super(),hn(this,e,sS,rS,un,{colorScale:0,limits:1,decimalPlaces:2})}}function wl(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}let _t;const Ma=new Array(128).fill(void 0);Ma.push(void 0,null,!0,!1);function En(r){return Ma[r]}let Ih=Ma.length;function oS(r){r<132||(Ma[r]=Ih,Ih=r)}function ji(r){const e=En(r);return oS(r),e}const Wv=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Wv.decode();let _h=null;function nc(){return(_h===null||_h.byteLength===0)&&(_h=new Uint8Array(_t.memory.buffer)),_h}function Vi(r,e){return r=r>>>0,Wv.decode(nc().subarray(r,r+e))}function Li(r){Ih===Ma.length&&Ma.push(Ma.length+1);const e=Ih;return Ih=Ma[e],Ma[e]=r,e}let Do=0;const Pf=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},aS=typeof Pf.encodeInto=="function"?function(r,e){return Pf.encodeInto(r,e)}:function(r,e){const n=Pf.encode(r);return e.set(n),{read:r.length,written:n.length}};function nu(r,e,n){if(n===void 0){const l=Pf.encode(r),x=e(l.length,1)>>>0;return nc().subarray(x,x+l.length).set(l),Do=l.length,x}let s=r.length,a=e(s,1)>>>0;const f=nc();let m=0;for(;m<s;m++){const l=r.charCodeAt(m);if(l>127)break;f[a+m]=l}if(m!==s){m!==0&&(r=r.slice(m)),a=n(a,s,s=m+r.length*3,1)>>>0;const l=nc().subarray(a+m,a+s),x=aS(r,l);m+=x.written,a=n(a,s,m,1)>>>0}return Do=m,a}function Ql(r){return r==null}let Kl=null;function Ct(){return(Kl===null||Kl.buffer.detached===!0||Kl.buffer.detached===void 0&&Kl.buffer!==_t.memory.buffer)&&(Kl=new DataView(_t.memory.buffer)),Kl}function Np(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const a=r.description;return a==null?"Symbol":`Symbol(${a})`}if(e=="function"){const a=r.name;return typeof a=="string"&&a.length>0?`Function(${a})`:"Function"}if(Array.isArray(r)){const a=r.length;let f="[";a>0&&(f+=Np(r[0]));for(let m=1;m<a;m++)f+=", "+Np(r[m]);return f+="]",f}const n=/\[object ([^\]]+)\]/.exec(toString.call(r));let s;if(n.length>1)s=n[1];else return toString.call(r);if(s=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:s}function lS(r,e){const n=e(r.length*1,1)>>>0;return nc().set(r,n/1),Do=r.length,n}let yh=null;function uS(){return(yh===null||yh.byteLength===0)&&(yh=new Float64Array(_t.memory.buffer)),yh}function cS(r,e){return r=r>>>0,uS().subarray(r/8,r/8+e)}function hS(r,e){return r=r>>>0,nc().subarray(r/1,r/1+e)}function ml(r,e){try{return r.apply(this,e)}catch(n){_t.__wbindgen_exn_store(Li(n))}}const ky=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>_t.__wbg_mapmodel_free(r>>>0,1));class fS{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ky.unregister(this),e}free(){const e=this.__destroy_into_raw();_t.__wbg_mapmodel_free(e,0)}constructor(e){try{const f=_t.__wbindgen_add_to_stack_pointer(-16),m=lS(e,_t.__wbindgen_malloc),l=Do;_t.mapmodel_new(f,m,l);var n=Ct().getInt32(f+4*0,!0),s=Ct().getInt32(f+4*1,!0),a=Ct().getInt32(f+4*2,!0);if(a)throw ji(s);return this.__wbg_ptr=n>>>0,ky.register(this,this.__wbg_ptr,this),this}finally{_t.__wbindgen_add_to_stack_pointer(16)}}renderDebug(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderDebug(S,this.__wbg_ptr);var s=Ct().getInt32(S+4*0,!0),a=Ct().getInt32(S+4*1,!0),f=Ct().getInt32(S+4*2,!0),m=Ct().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,ji(f);return e=l,n=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}getInvertedBoundary(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getInvertedBoundary(S,this.__wbg_ptr);var s=Ct().getInt32(S+4*0,!0),a=Ct().getInt32(S+4*1,!0),f=Ct().getInt32(S+4*2,!0),m=Ct().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,ji(f);return e=l,n=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}getBounds(){try{const a=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getBounds(a,this.__wbg_ptr);var e=Ct().getInt32(a+4*0,!0),n=Ct().getInt32(a+4*1,!0),s=cS(e,n).slice();return _t.__wbindgen_free(e,n*8,8),s}finally{_t.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const a=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_toRouteSnapper(a,this.__wbg_ptr);var e=Ct().getInt32(a+4*0,!0),n=Ct().getInt32(a+4*1,!0),s=hS(e,n).slice();return _t.__wbindgen_free(e,n*1,1),s}finally{_t.__wbindgen_add_to_stack_pointer(16)}}setRoute(e,n){try{const m=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_setRoute(m,this.__wbg_ptr,!Ql(e),Ql(e)?0:e,Li(n));var s=Ct().getInt32(m+4*0,!0),a=Ct().getInt32(m+4*1,!0),f=Ct().getInt32(m+4*2,!0);if(f)throw ji(a);return s>>>0}finally{_t.__wbindgen_add_to_stack_pointer(16)}}deleteRoute(e){try{const a=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_deleteRoute(a,this.__wbg_ptr,e);var n=Ct().getInt32(a+4*0,!0),s=Ct().getInt32(a+4*1,!0);if(s)throw ji(n)}finally{_t.__wbindgen_add_to_stack_pointer(16)}}clearAllRoutes(){_t.mapmodel_clearAllRoutes(this.__wbg_ptr)}renderRoutes(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderRoutes(S,this.__wbg_ptr);var s=Ct().getInt32(S+4*0,!0),a=Ct().getInt32(S+4*1,!0),f=Ct().getInt32(S+4*2,!0),m=Ct().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,ji(f);return e=l,n=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}evaluateRoute(e){let n,s;try{const C=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_evaluateRoute(C,this.__wbg_ptr,Li(e));var a=Ct().getInt32(C+4*0,!0),f=Ct().getInt32(C+4*1,!0),m=Ct().getInt32(C+4*2,!0),l=Ct().getInt32(C+4*3,!0),x=a,S=f;if(l)throw x=0,S=0,ji(m);return n=x,s=S,Vi(x,S)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(n,s,1)}}debugReachablePath(e,n){let s,a;try{const L=_t.__wbindgen_add_to_stack_pointer(-16),N=nu(e,_t.__wbindgen_malloc,_t.__wbindgen_realloc),B=Do;_t.mapmodel_debugReachablePath(L,this.__wbg_ptr,N,B,n);var f=Ct().getInt32(L+4*0,!0),m=Ct().getInt32(L+4*1,!0),l=Ct().getInt32(L+4*2,!0),x=Ct().getInt32(L+4*3,!0),S=f,C=m;if(x)throw S=0,C=0,ji(l);return s=S,a=C,Vi(S,C)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(s,a,1)}}debugUnreachablePath(e,n){let s,a;try{const L=_t.__wbindgen_add_to_stack_pointer(-16),N=nu(e,_t.__wbindgen_malloc,_t.__wbindgen_realloc),B=Do;_t.mapmodel_debugUnreachablePath(L,this.__wbg_ptr,N,B,n);var f=Ct().getInt32(L+4*0,!0),m=Ct().getInt32(L+4*1,!0),l=Ct().getInt32(L+4*2,!0),x=Ct().getInt32(L+4*3,!0),S=f,C=m;if(x)throw S=0,C=0,ji(l);return s=S,a=C,Vi(S,C)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(s,a,1)}}evaluateOD(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_evaluateOD(S,this.__wbg_ptr);var s=Ct().getInt32(S+4*0,!0),a=Ct().getInt32(S+4*1,!0),f=Ct().getInt32(S+4*2,!0),m=Ct().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,ji(f);return e=l,n=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}recalculateStats(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_recalculateStats(S,this.__wbg_ptr);var s=Ct().getInt32(S+4*0,!0),a=Ct().getInt32(S+4*1,!0),f=Ct().getInt32(S+4*2,!0),m=Ct().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,ji(f);return e=l,n=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}toSavefile(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_toSavefile(S,this.__wbg_ptr);var s=Ct().getInt32(S+4*0,!0),a=Ct().getInt32(S+4*1,!0),f=Ct().getInt32(S+4*2,!0),m=Ct().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,ji(f);return e=l,n=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}loadSavefile(e){try{const a=_t.__wbindgen_add_to_stack_pointer(-16),f=nu(e,_t.__wbindgen_malloc,_t.__wbindgen_realloc),m=Do;_t.mapmodel_loadSavefile(a,this.__wbg_ptr,f,m);var n=Ct().getInt32(a+4*0,!0),s=Ct().getInt32(a+4*1,!0);if(s)throw ji(n)}finally{_t.__wbindgen_add_to_stack_pointer(16)}}meshDensity(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_meshDensity(S,this.__wbg_ptr);var s=Ct().getInt32(S+4*0,!0),a=Ct().getInt32(S+4*1,!0),f=Ct().getInt32(S+4*2,!0),m=Ct().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,ji(f);return e=l,n=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}classifyExistingNetwork(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_classifyExistingNetwork(S,this.__wbg_ptr);var s=Ct().getInt32(S+4*0,!0),a=Ct().getInt32(S+4*1,!0),f=Ct().getInt32(S+4*2,!0),m=Ct().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,ji(f);return e=l,n=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}importExistingRoutes(){return _t.mapmodel_importExistingRoutes(this.__wbg_ptr)>>>0}importCoreNetwork(){return _t.mapmodel_importCoreNetwork(this.__wbg_ptr)>>>0}getSchools(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getSchools(S,this.__wbg_ptr);var s=Ct().getInt32(S+4*0,!0),a=Ct().getInt32(S+4*1,!0),f=Ct().getInt32(S+4*2,!0),m=Ct().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,ji(f);return e=l,n=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}getGPHospitals(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getGPHospitals(S,this.__wbg_ptr);var s=Ct().getInt32(S+4*0,!0),a=Ct().getInt32(S+4*1,!0),f=Ct().getInt32(S+4*2,!0),m=Ct().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,ji(f);return e=l,n=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}getTownCentres(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getTownCentres(S,this.__wbg_ptr);var s=Ct().getInt32(S+4*0,!0),a=Ct().getInt32(S+4*1,!0),f=Ct().getInt32(S+4*2,!0),m=Ct().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,ji(f);return e=l,n=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}getDataZones(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getDataZones(S,this.__wbg_ptr);var s=Ct().getInt32(S+4*0,!0),a=Ct().getInt32(S+4*1,!0),f=Ct().getInt32(S+4*2,!0),m=Ct().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,ji(f);return e=l,n=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}renderReachableNetwork(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderReachableNetwork(S,this.__wbg_ptr);var s=Ct().getInt32(S+4*0,!0),a=Ct().getInt32(S+4*1,!0),f=Ct().getInt32(S+4*2,!0),m=Ct().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,ji(f);return e=l,n=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}renderLevelOfService(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderLevelOfService(S,this.__wbg_ptr);var s=Ct().getInt32(S+4*0,!0),a=Ct().getInt32(S+4*1,!0),f=Ct().getInt32(S+4*2,!0),m=Ct().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,ji(f);return e=l,n=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}renderCoreNetwork(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderCoreNetwork(S,this.__wbg_ptr);var s=Ct().getInt32(S+4*0,!0),a=Ct().getInt32(S+4*1,!0),f=Ct().getInt32(S+4*2,!0),m=Ct().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,ji(f);return e=l,n=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}renderPrecalculatedFlows(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_renderPrecalculatedFlows(S,this.__wbg_ptr);var s=Ct().getInt32(S+4*0,!0),a=Ct().getInt32(S+4*1,!0),f=Ct().getInt32(S+4*2,!0),m=Ct().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,ji(f);return e=l,n=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}getMajorJunctions(){let e,n;try{const S=_t.__wbindgen_add_to_stack_pointer(-16);_t.mapmodel_getMajorJunctions(S,this.__wbg_ptr);var s=Ct().getInt32(S+4*0,!0),a=Ct().getInt32(S+4*1,!0),f=Ct().getInt32(S+4*2,!0),m=Ct().getInt32(S+4*3,!0),l=s,x=a;if(m)throw l=0,x=0,ji(f);return e=l,n=x,Vi(l,x)}finally{_t.__wbindgen_add_to_stack_pointer(16),_t.__wbindgen_free(e,n,1)}}}async function dS(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(s){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",s);else throw s}const n=await r.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(r,e);return n instanceof WebAssembly.Instance?{instance:n,module:r}:n}}function pS(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){ji(e)},r.wbg.__wbindgen_string_new=function(e,n){const s=Vi(e,n);return Li(s)},r.wbg.__wbindgen_string_get=function(e,n){const s=En(n),a=typeof s=="string"?s:void 0;var f=Ql(a)?0:nu(a,_t.__wbindgen_malloc,_t.__wbindgen_realloc),m=Do;Ct().setInt32(e+4*1,m,!0),Ct().setInt32(e+4*0,f,!0)},r.wbg.__wbindgen_number_get=function(e,n){const s=En(n),a=typeof s=="number"?s:void 0;Ct().setFloat64(e+8*1,Ql(a)?0:a,!0),Ct().setInt32(e+4*0,!Ql(a),!0)},r.wbg.__wbindgen_error_new=function(e,n){const s=new Error(Vi(e,n));return Li(s)},r.wbg.__wbindgen_boolean_get=function(e){const n=En(e);return typeof n=="boolean"?n?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof En(e)=="bigint"},r.wbg.__wbindgen_is_object=function(e){const n=En(e);return typeof n=="object"&&n!==null},r.wbg.__wbindgen_in=function(e,n){return En(e)in En(n)},r.wbg.__wbindgen_bigint_from_i64=function(e){return Li(e)},r.wbg.__wbindgen_jsval_eq=function(e,n){return En(e)===En(n)},r.wbg.__wbindgen_bigint_from_u64=function(e){const n=BigInt.asUintN(64,e);return Li(n)},r.wbg.__wbindgen_is_string=function(e){return typeof En(e)=="string"},r.wbg.__wbindgen_is_undefined=function(e){return En(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,n){return En(e)==En(n)},r.wbg.__wbindgen_as_number=function(e){return+En(e)},r.wbg.__wbg_String_b9412f8799faab3e=function(e,n){const s=String(En(n)),a=nu(s,_t.__wbindgen_malloc,_t.__wbindgen_realloc),f=Do;Ct().setInt32(e+4*1,f,!0),Ct().setInt32(e+4*0,a,!0)},r.wbg.__wbindgen_object_clone_ref=function(e){const n=En(e);return Li(n)},r.wbg.__wbg_getwithrefkey_edc2c8960f0f1191=function(e,n){const s=En(e)[En(n)];return Li(s)},r.wbg.__wbg_debug_5a33c41aeac15ee6=function(e){console.debug(En(e))},r.wbg.__wbg_error_09480e4aadca50ad=function(e){console.error(En(e))},r.wbg.__wbg_info_c261acb2deacd903=function(e){console.info(En(e))},r.wbg.__wbg_log_b103404cc5920657=function(e){console.log(En(e))},r.wbg.__wbg_warn_2b3adb99ce26c314=function(e){console.warn(En(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Li(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const s=En(n).stack,a=nu(s,_t.__wbindgen_malloc,_t.__wbindgen_realloc),f=Do;Ct().setInt32(e+4*1,f,!0),Ct().setInt32(e+4*0,a,!0)},r.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let s,a;try{s=e,a=n,console.error(Vi(e,n))}finally{_t.__wbindgen_free(s,a,1)}},r.wbg.__wbg_performance_a1b8bde2ee512264=function(e){const n=En(e).performance;return Li(n)},r.wbg.__wbg_now_abd80e969af37148=function(e){return En(e).now()},r.wbg.__wbg_get_3baa728f9d58d3f6=function(e,n){const s=En(e)[n>>>0];return Li(s)},r.wbg.__wbg_length_ae22078168b726f5=function(e){return En(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof En(e)=="function"},r.wbg.__wbg_newnoargs_76313bd6ff35d0f2=function(e,n){const s=new Function(Vi(e,n));return Li(s)},r.wbg.__wbg_next_de3e9db4440638b2=function(e){const n=En(e).next;return Li(n)},r.wbg.__wbg_next_f9cb570345655b9a=function(){return ml(function(e){const n=En(e).next();return Li(n)},arguments)},r.wbg.__wbg_done_bfda7aa8f252b39f=function(e){return En(e).done},r.wbg.__wbg_value_6d39332ab4788d86=function(e){const n=En(e).value;return Li(n)},r.wbg.__wbg_iterator_888179a48810a9fe=function(){return Li(Symbol.iterator)},r.wbg.__wbg_get_224d16597dbbfd96=function(){return ml(function(e,n){const s=Reflect.get(En(e),En(n));return Li(s)},arguments)},r.wbg.__wbg_call_1084a111329e68ce=function(){return ml(function(e,n){const s=En(e).call(En(n));return Li(s)},arguments)},r.wbg.__wbg_self_3093d5d1f7bcb682=function(){return ml(function(){const e=self.self;return Li(e)},arguments)},r.wbg.__wbg_window_3bcfc4d31bc012f8=function(){return ml(function(){const e=window.window;return Li(e)},arguments)},r.wbg.__wbg_globalThis_86b222e13bdf32ed=function(){return ml(function(){const e=globalThis.globalThis;return Li(e)},arguments)},r.wbg.__wbg_global_e5a3fe56f8be9485=function(){return ml(function(){const e=global.global;return Li(e)},arguments)},r.wbg.__wbg_isArray_8364a5371e9737d8=function(e){return Array.isArray(En(e))},r.wbg.__wbg_instanceof_ArrayBuffer_61dfc3198373c902=function(e){let n;try{n=En(e)instanceof ArrayBuffer}catch{n=!1}return n},r.wbg.__wbg_call_89af060b4e1523f2=function(){return ml(function(e,n,s){const a=En(e).call(En(n),En(s));return Li(a)},arguments)},r.wbg.__wbg_instanceof_Map_763ce0e95960d55e=function(e){let n;try{n=En(e)instanceof Map}catch{n=!1}return n},r.wbg.__wbg_isSafeInteger_7f1ed56200d90674=function(e){return Number.isSafeInteger(En(e))},r.wbg.__wbg_entries_7a0e06255456ebcd=function(e){const n=Object.entries(En(e));return Li(n)},r.wbg.__wbg_buffer_b7b08af79b0b0974=function(e){const n=En(e).buffer;return Li(n)},r.wbg.__wbg_new_ea1883e1e5e86686=function(e){const n=new Uint8Array(En(e));return Li(n)},r.wbg.__wbg_set_d1e79e2388520f18=function(e,n,s){En(e).set(En(n),s>>>0)},r.wbg.__wbg_length_8339fcf5d8ecd12e=function(e){return En(e).length},r.wbg.__wbg_instanceof_Uint8Array_247a91427532499e=function(e){let n;try{n=En(e)instanceof Uint8Array}catch{n=!1}return n},r.wbg.__wbindgen_bigint_get_as_i64=function(e,n){const s=En(n),a=typeof s=="bigint"?s:void 0;Ct().setBigInt64(e+8*1,Ql(a)?BigInt(0):a,!0),Ct().setInt32(e+4*0,!Ql(a),!0)},r.wbg.__wbindgen_debug_string=function(e,n){const s=Np(En(n)),a=nu(s,_t.__wbindgen_malloc,_t.__wbindgen_realloc),f=Do;Ct().setInt32(e+4*1,f,!0),Ct().setInt32(e+4*0,a,!0)},r.wbg.__wbindgen_throw=function(e,n){throw new Error(Vi(e,n))},r.wbg.__wbindgen_memory=function(){const e=_t.memory;return Li(e)},r}function mS(r,e){return _t=r.exports,Xv.__wbindgen_wasm_module=e,Kl=null,yh=null,_h=null,_t}async function Xv(r){if(_t!==void 0)return _t;typeof r<"u"&&Object.getPrototypeOf(r)===Object.prototype?{module_or_path:r}=r:console.warn("using deprecated parameters for the initialization function; pass a single object instead"),typeof r>"u"&&(r=new URL("backend_bg.wasm",self.location));const e=pS();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:n,module:s}=await dS(await r,e);return mS(n,s)}class gS{constructor(){lh(this,"inner");this.inner=null}async loadFile(e){await Xv(),this.inner=new fS(e)}getBounds(){return this.checkReady(),Array.from(this.inner.getBounds())}getInvertedBoundary(){return this.checkReady(),JSON.parse(this.inner.getInvertedBoundary())}renderDebug(){return this.checkReady(),JSON.parse(this.inner.renderDebug())}renderLevelOfService(){return this.checkReady(),JSON.parse(this.inner.renderLevelOfService())}renderCoreNetwork(){return this.checkReady(),JSON.parse(this.inner.renderCoreNetwork())}renderPrecalculatedFlows(){return this.checkReady(),JSON.parse(this.inner.renderPrecalculatedFlows())}toRouteSnapper(){return this.checkReady(),this.inner.toRouteSnapper()}renderRoutes(){return this.checkReady(),JSON.parse(this.inner.renderRoutes())}setRoute(e,n){return this.checkReady(),this.inner.setRoute(e??void 0,n)}deleteRoute(e){this.checkReady(),this.inner.deleteRoute(e)}clearAllRoutes(){this.checkReady(),this.inner.clearAllRoutes()}evaluateRoute(e){return this.checkReady(),JSON.parse(this.inner.evaluateRoute({x1:e.start.lng,y1:e.start.lat,x2:e.end[0],y2:e.end[1],breakdown:e.breakdown}))}evaluateOD(){return this.checkReady(),JSON.parse(this.inner.evaluateOD())}recalculateStats(){return this.checkReady(),JSON.parse(this.inner.recalculateStats())}meshDensity(){return this.checkReady(),JSON.parse(this.inner.meshDensity())}classifyExistingNetwork(){return this.checkReady(),JSON.parse(this.inner.classifyExistingNetwork())}importExistingRoutes(){return this.checkReady(),this.inner.importExistingRoutes()}importCoreNetwork(){return this.checkReady(),this.inner.importCoreNetwork()}toSavefile(){return this.checkReady(),this.inner.toSavefile()}loadSavefile(e){this.checkReady(),this.inner.loadSavefile(e)}getSchools(){return this.checkReady(),JSON.parse(this.inner.getSchools())}getGpHospitals(){return this.checkReady(),JSON.parse(this.inner.getGPHospitals())}getTownCentres(){return this.checkReady(),JSON.parse(this.inner.getTownCentres())}getDataZones(){return this.checkReady(),JSON.parse(this.inner.getDataZones())}renderReachableNetwork(){return this.checkReady(),JSON.parse(this.inner.renderReachableNetwork())}debugReachablePath(e,n){return this.checkReady(),JSON.parse(this.inner.debugReachablePath(e,n))}debugUnreachablePath(e,n){return this.checkReady(),JSON.parse(this.inner.debugUnreachablePath(e,n))}getMajorJunctions(){return this.checkReady(),JSON.parse(this.inner.getMajorJunctions())}checkReady(){if(!this.inner)throw new Error("Backend used without a file loaded")}}let $v="MZEJTanw3WpxRvt7qDfo",Hf=Yn(""),Ni=Yn({kind:"main"}),eu=Yn("primary"),_S=Yn(null),Rh=Yn(0),sr=Yn(null),Ju=Yn(null),Sh=Yn(null),rd=[["SegregatedWide","Segregated Track (wide)","#054d05"],["OffRoad","Off Road Cycleway","#3a9120"],["SegregatedNarrow","Segregated Track (narrow)","#87d668"],["SharedFootway","Shared Footway","#ffbf00"],["CycleLane","Painted Cycle Lane","#FF0000"],["MixedTraffic","Mixed traffic","#EFD1C5"],["Unknown","Unknown","blue"]],oc=Object.fromEntries(rd.map(([r,e,n])=>[r,[e,n]]));async function Dh(){let r=Df(sr),e=Df(Hf);if(!r||!e)return;let n=await r.toSavefile();window.localStorage.setItem(`tmp-npt-editor/${e}`,n)}let zp=Yn(!0);function sd(r){return Df(zp)?`https://assets.od2net.org/tmp_npt_editor/${r}`:r}let Iy=Yn(null);function yS(r){let e,n,s,a,f,m,l,x;return{c(){e=ue("div"),n=ue("h2"),n.textContent="Debug network mode",s=Be(),a=ue("button"),a.textContent="Back",f=Be(),m=ue("p"),m.textContent="Hover to see a segment's properties, and click to open OSM",He(e,"slot","left")},m(S,C){ae(S,e,C),Z(e,n),Z(e,s),Z(e,a),Z(e,f),Z(e,m),l||(x=Pt(a,"click",r[3]),l=!0)},p:tt,d(S){S&&oe(e),l=!1,x()}}}function vS(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function bS(r){let e,n;return e=new rr({props:{data:r[4],generateId:!0,$$slots:{default:[kS]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&1&&(f.data=s[4]),a&64&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function xS(r){let e,n;return e=new tS({props:{properties:r[5]}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&32&&(f.properties=s[5]),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function wS(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[xS,({props:s})=>({5:s}),({props:s})=>s?32:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&96&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function kS(r){let e,n;return e=new mr({props:{id:"network",paint:{"line-width":Ms(5,7),"line-color":"black"},manageHoverState:!0,hoverCursor:"pointer",eventsIfTopMost:!0,$$slots:{default:[wS]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&64&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function IS(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function SS(r){let e,n,s,a={ctx:r,current:null,token:null,hasCatch:!1,pending:IS,then:bS,catch:vS,value:4,blocks:[,,,]};return gs(n=wl(r[0]).renderDebug(),a),{c(){e=ue("div"),a.block.c(),He(e,"slot","map")},m(f,m){ae(f,e,m),a.block.m(e,a.anchor=null),a.mount=()=>e,a.anchor=null,s=!0},p(f,m){r=f,a.ctx=r,m&1&&n!==(n=wl(r[0]).renderDebug())&&gs(n,a)||kl(a,r,m)},i(f){s||(_e(a.block),s=!0)},o(f){for(let m=0;m<3;m+=1){const l=a.blocks[m];Ie(l)}s=!1},d(f){f&&oe(e),a.block.d(),a.token=null,a=null}}}function ES(r){let e,n;return e=new gc({props:{$$slots:{map:[SS],left:[yS]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,[a]){const f={};a&67&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function TS(r,e,n){let s,a;return Ot(r,sr,l=>n(0,s=l)),Ot(r,Ni,l=>n(1,a=l)),[s,a,l=>window.open(wl(l.detail.features[0].properties).way,"_blank"),()=>Dn(Ni,a={kind:"main"},a)]}class CS extends fn{constructor(e){super(),hn(this,e,TS,ES,un,{})}}function LS(r){let e,n,s,a,f,m;return{c(){e=ue("div"),n=ue("h2"),n.textContent="Debug mesh density mode",s=Be(),a=ue("button"),a.textContent="Back",He(e,"slot","left")},m(l,x){ae(l,e,x),Z(e,n),Z(e,s),Z(e,a),f||(m=Pt(a,"click",r[2]),f=!0)},p:tt,d(l){l&&oe(e),f=!1,m()}}}function MS(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function AS(r){let e,n;return e=new rr({props:{data:r[3],generateId:!0,$$slots:{default:[PS]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&1&&(f.data=s[3]),a&16&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function PS(r){let e,n,s,a;return e=new mr({props:{paint:{"line-color":"black"}}}),s=new mc({props:{paint:{"fill-color":"grey","fill-opacity":Ms(.5,1)},manageHoverState:!0}}),{c(){ot(e.$$.fragment),n=Be(),ot(s.$$.fragment)},m(f,m){rt(e,f,m),ae(f,n,m),rt(s,f,m),a=!0},p:tt,i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(n),st(e,f),st(s,f)}}}function RS(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function DS(r){let e,n,s,a={ctx:r,current:null,token:null,hasCatch:!1,pending:RS,then:AS,catch:MS,value:3,blocks:[,,,]};return gs(n=wl(r[0]).meshDensity(),a),{c(){e=ue("div"),a.block.c(),He(e,"slot","map")},m(f,m){ae(f,e,m),a.block.m(e,a.anchor=null),a.mount=()=>e,a.anchor=null,s=!0},p(f,m){r=f,a.ctx=r,m&1&&n!==(n=wl(r[0]).meshDensity())&&gs(n,a)||kl(a,r,m)},i(f){s||(_e(a.block),s=!0)},o(f){for(let m=0;m<3;m+=1){const l=a.blocks[m];Ie(l)}s=!1},d(f){f&&oe(e),a.block.d(),a.token=null,a=null}}}function NS(r){let e,n;return e=new gc({props:{$$slots:{map:[DS],left:[LS]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,[a]){const f={};a&19&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function zS(r,e,n){let s,a;return Ot(r,sr,m=>n(0,s=m)),Ot(r,Ni,m=>n(1,a=m)),[s,a,()=>Dn(Ni,a={kind:"main"},a)]}class OS extends fn{constructor(e){super(),hn(this,e,zS,NS,un,{})}}let Yv=Yn(new Map),Op=Yn(!0),Wf=Yn(!1),Xf=Yn(!1),$f=Yn(!1),Yf=Yn(!1),Jf=Yn(!1),Ku=Yn(!1),Fp=Yn(!0),Sy=Yn(!1);function FS(r){let e,n,s,a;const f=r[1].default,m=Zi(f,r,r[0],null);return{c(){e=ue("a"),m&&m.c(),He(e,"href","#")},m(l,x){ae(l,e,x),m&&m.m(e,null),n=!0,s||(a=Pt(e,"click",Nh(r[2])),s=!0)},p(l,[x]){m&&m.p&&(!n||x&1)&&Wi(m,f,l,l[0],n?Hi(f,l[0],x,null):Xi(l[0]),null)},i(l){n||(_e(m,l),n=!0)},o(l){Ie(m,l),n=!1},d(l){l&&oe(e),m&&m.d(l),s=!1,a()}}}function BS(r,e,n){let{$$slots:s={},$$scope:a}=e;function f(m){ur.call(this,r,m)}return r.$$set=m=>{"$$scope"in m&&n(0,a=m.$$scope)},[a,s,f]}class US extends fn{constructor(e){super(),hn(this,e,BS,FS,un,{})}}let ds={primaryRoutes:"#c00000",secondaryRoutes:"#e97132",localAccessRoutes:"#ffc000",longDistanceRoutes:"#4ea72e"},tm={High:"mediumseagreen",Medium:"orange",Low:"red",ShouldNotBeUsed:"brown"},ac=Xp(["get","infra_type"],Object.fromEntries(rd.map(r=>[r[0],r[2]])),"red"),Bp=Xp(["get","los"],tm,"black");function Ey(r){let e,n,s,a,f=`2px solid ${ds.primaryRoutes}`;return{c(){e=ue("details"),n=ue("summary"),n.textContent="Primary Route Reference Layers",s=Be(),a=ue("div"),e.open=!0,Un(e,"border",f)},m(m,l){ae(m,e,l),Z(e,n),Z(e,s),Z(e,a),r[8](a)},p:tt,d(m){m&&oe(e),r[8](null)}}}function Ty(r){let e,n,s,a,f=`2px solid ${ds.secondaryRoutes}`;return{c(){e=ue("details"),n=ue("summary"),n.textContent="Secondary Route Reference Layers",s=Be(),a=ue("div"),e.open=!0,Un(e,"border",f)},m(m,l){ae(m,e,l),Z(e,n),Z(e,s),Z(e,a),r[9](a)},p:tt,d(m){m&&oe(e),r[9](null)}}}function Cy(r){let e,n,s,a,f=`2px solid ${ds.localAccessRoutes}`;return{c(){e=ue("details"),n=ue("summary"),n.textContent="Local Access Route Reference Layers",s=Be(),a=ue("div"),e.open=!0,Un(e,"border",f)},m(m,l){ae(m,e,l),Z(e,n),Z(e,s),Z(e,a),r[10](a)},p:tt,d(m){m&&oe(e),r[10](null)}}}function Ly(r){let e,n,s,a,f=`2px solid ${ds.longDistanceRoutes}`;return{c(){e=ue("details"),n=ue("summary"),n.textContent="Long Disance Route Reference Layers",s=Be(),a=ue("div"),e.open=!0,Un(e,"border",f)},m(m,l){ae(m,e,l),Z(e,n),Z(e,s),Z(e,a),r[11](a)},p:tt,d(m){m&&oe(e),r[11](null)}}}function jS(r){let e,n,s,a,f,m,l,x,S,C=r[5]=="primary"&&Ey(r),L=r[5]=="secondary"&&Ty(r),N=r[5]=="local access"&&Cy(r),B=r[5]=="long distance"&&Ly(r);return{c(){e=ue("details"),n=ue("summary"),n.textContent="Basic Reference Layers",s=Be(),a=ue("div"),f=Be(),C&&C.c(),m=Be(),L&&L.c(),l=Be(),N&&N.c(),x=Be(),B&&B.c(),S=ni(),e.open=!0,Un(e,"border","2px solid black")},m(U,ee){ae(U,e,ee),Z(e,n),Z(e,s),Z(e,a),r[7](a),ae(U,f,ee),C&&C.m(U,ee),ae(U,m,ee),L&&L.m(U,ee),ae(U,l,ee),N&&N.m(U,ee),ae(U,x,ee),B&&B.m(U,ee),ae(U,S,ee)},p(U,[ee]){U[5]=="primary"?C?C.p(U,ee):(C=Ey(U),C.c(),C.m(m.parentNode,m)):C&&(C.d(1),C=null),U[5]=="secondary"?L?L.p(U,ee):(L=Ty(U),L.c(),L.m(l.parentNode,l)):L&&(L.d(1),L=null),U[5]=="local access"?N?N.p(U,ee):(N=Cy(U),N.c(),N.m(x.parentNode,x)):N&&(N.d(1),N=null),U[5]=="long distance"?B?B.p(U,ee):(B=Ly(U),B.c(),B.m(S.parentNode,S)):B&&(B.d(1),B=null)},i:tt,o:tt,d(U){U&&(oe(e),oe(f),oe(m),oe(l),oe(x),oe(S)),r[7](null),C&&C.d(U),L&&L.d(U),N&&N.d(U),B&&B.d(U)}}}function ph(r,e,n){if(r){r.innerHTML="";for(let s of n){let a=e.get(s);a&&r.appendChild(a)}}}function VS(r,e,n){let s,a;Ot(r,Yv,ee=>n(6,s=ee)),Ot(r,eu,ee=>n(5,a=ee));let f=null,m=null,l=null,x=null,S=null;function C(ee){Jn[ee?"unshift":"push"](()=>{f=ee,n(0,f)})}function L(ee){Jn[ee?"unshift":"push"](()=>{m=ee,n(1,m)})}function N(ee){Jn[ee?"unshift":"push"](()=>{l=ee,n(2,l)})}function B(ee){Jn[ee?"unshift":"push"](()=>{x=ee,n(3,x)})}function U(ee){Jn[ee?"unshift":"push"](()=>{S=ee,n(4,S)})}return r.$$.update=()=>{r.$$.dirty&65&&ph(f,s,["route network","simd","population density","core network","existing network","level of service","traffic volume","reachable network"]),r.$$.dirty&66&&ph(m,s,["high npt route coverage"]),r.$$.dirty&68&&ph(l,s,["town centres"]),r.$$.dirty&72&&ph(x,s,["schools","gp hospitals"]),r.$$.dirty&80&&ph(S,s,["urban areas"])},[f,m,l,x,S,a,s,C,L,N,B,U]}class qS extends fn{constructor(e){super(),hn(this,e,VS,jS,un,{})}}function GS(r){let e,n,s,a,f,m=Math.round(r[2]*100)+"",l,x,S,C,L,N,B;return{c(){e=ue("p"),n=ue("a"),s=Oe(r[1]),a=Oe(`
  :
  `),f=ue("b"),l=Oe(m),x=Oe("%"),S=Be(),C=ue("progress"),He(n,"href","#"),C.value=L=r[2]*100,He(C,"max","100")},m(U,ee){ae(U,e,ee),Z(e,n),Z(n,s),Z(e,a),Z(e,f),Z(f,l),Z(f,x),Z(e,S),Z(e,C),N||(B=Pt(n,"click",Nh(r[3])),N=!0)},p(U,[ee]){ee&2&&Mt(s,U[1]),ee&4&&m!==(m=Math.round(U[2]*100)+"")&&Mt(l,m),ee&4&&L!==(L=U[2]*100)&&(C.value=L)},i:tt,o:tt,d(U){U&&oe(e),N=!1,B()}}}function ZS(r,e,n){let{label:s}=e,{showLayer:a}=e,{pct:f}=e;const m=()=>n(0,a=!0);return r.$$set=l=>{"label"in l&&n(1,s=l.label),"showLayer"in l&&n(0,a=l.showLayer),"pct"in l&&n(2,f=l.pct)},[a,s,f,m]}class Aa extends fn{constructor(e){super(),hn(this,e,ZS,GS,un,{label:1,showLayer:0,pct:2})}}function My(r,e,n){const s=r.slice();return s[22]=e[n][0],s[23]=e[n][1],s}function Ay(r,e,n){const s=r.slice();return s[22]=e[n][0],s[23]=e[n][1],s}function Py(r){let e,n,s,a=`2px solid ${ds.primaryRoutes}`,f,m,l,x,S,C,L,N,B=r[0].average_weighted_directness.toFixed(1)+"",U,ee,ie,re,Q,$,pe,ve,De,he,xe,be,Le,we,ye;function Ue(ft){r[11](ft)}let Ve={label:"High cycling flow coverage",pct:lc(r[0].covered_flow_quintile_sums[0],r[0].total_flow_quintile_sums[0])};r[1]!==void 0&&(Ve.showLayer=r[1]),n=new Aa({props:Ve}),Jn.push(()=>Ir(n,"showLayer",Ue));let pt=(r[2]=="secondary"||r[2]=="local access"||r[2]=="long distance")&&Ry(r),St=(r[2]=="local access"||r[2]=="long distance")&&Dy(r),dt=r[2]=="long distance"&&Ny(r),ut=Hn(Object.entries(r[0].od_percents_infra_type).toSorted(Fy)),Bt=[];for(let ft=0;ft<ut.length;ft+=1)Bt[ft]=zy(Ay(r,ut,ft));let vt=Hn(Object.entries(r[0].od_percents_los).toSorted(By)),wt=[];for(let ft=0;ft<vt.length;ft+=1)wt[ft]=Oy(My(r,vt,ft));return{c(){e=ue("div"),ot(n.$$.fragment),f=Be(),pt&&pt.c(),m=Be(),St&&St.c(),l=Be(),dt&&dt.c(),x=Be(),S=ue("div"),C=ue("p"),L=ue("a"),L.textContent="Average weighted directness",N=Oe(`
      : `),U=Oe(B),ee=Oe("x"),ie=Be(),re=ue("details"),Q=ue("summary"),Q.textContent="Percent of demand by infrastructure type",$=Be(),pe=ue("ul");for(let ft=0;ft<Bt.length;ft+=1)Bt[ft].c();ve=Be(),De=ue("details"),he=ue("summary"),he.textContent="Percent of demand by level of service:",xe=Be(),be=ue("ul");for(let ft=0;ft<wt.length;ft+=1)wt[ft].c();Un(e,"border",a),He(L,"href","#"),Un(S,"margin-top","4px"),Un(S,"border","2px solid black")},m(ft,xt){ae(ft,e,xt),rt(n,e,null),ae(ft,f,xt),pt&&pt.m(ft,xt),ae(ft,m,xt),St&&St.m(ft,xt),ae(ft,l,xt),dt&&dt.m(ft,xt),ae(ft,x,xt),ae(ft,S,xt),Z(S,C),Z(C,L),Z(C,N),Z(C,U),Z(C,ee),Z(S,ie),Z(S,re),Z(re,Q),Z(re,$),Z(re,pe);for(let It=0;It<Bt.length;It+=1)Bt[It]&&Bt[It].m(pe,null);Z(S,ve),Z(S,De),Z(De,he),Z(De,xe),Z(De,be);for(let It=0;It<wt.length;It+=1)wt[It]&&wt[It].m(be,null);Le=!0,we||(ye=Pt(L,"click",Nh(r[20])),we=!0)},p(ft,xt){const It={};if(xt&1&&(It.pct=lc(ft[0].covered_flow_quintile_sums[0],ft[0].total_flow_quintile_sums[0])),!s&&xt&2&&(s=!0,It.showLayer=ft[1],kr(()=>s=!1)),n.$set(It),ft[2]=="secondary"||ft[2]=="local access"||ft[2]=="long distance"?pt?(pt.p(ft,xt),xt&4&&_e(pt,1)):(pt=Ry(ft),pt.c(),_e(pt,1),pt.m(m.parentNode,m)):pt&&(Nn(),Ie(pt,1,1,()=>{pt=null}),zn()),ft[2]=="local access"||ft[2]=="long distance"?St?(St.p(ft,xt),xt&4&&_e(St,1)):(St=Dy(ft),St.c(),_e(St,1),St.m(l.parentNode,l)):St&&(Nn(),Ie(St,1,1,()=>{St=null}),zn()),ft[2]=="long distance"?dt?(dt.p(ft,xt),xt&4&&_e(dt,1)):(dt=Ny(ft),dt.c(),_e(dt,1),dt.m(x.parentNode,x)):dt&&(Nn(),Ie(dt,1,1,()=>{dt=null}),zn()),(!Le||xt&1)&&B!==(B=ft[0].average_weighted_directness.toFixed(1)+"")&&Mt(U,B),xt&1){ut=Hn(Object.entries(ft[0].od_percents_infra_type).toSorted(Fy));let Jt;for(Jt=0;Jt<ut.length;Jt+=1){const pn=Ay(ft,ut,Jt);Bt[Jt]?Bt[Jt].p(pn,xt):(Bt[Jt]=zy(pn),Bt[Jt].c(),Bt[Jt].m(pe,null))}for(;Jt<Bt.length;Jt+=1)Bt[Jt].d(1);Bt.length=ut.length}if(xt&1){vt=Hn(Object.entries(ft[0].od_percents_los).toSorted(By));let Jt;for(Jt=0;Jt<vt.length;Jt+=1){const pn=My(ft,vt,Jt);wt[Jt]?wt[Jt].p(pn,xt):(wt[Jt]=Oy(pn),wt[Jt].c(),wt[Jt].m(be,null))}for(;Jt<wt.length;Jt+=1)wt[Jt].d(1);wt.length=vt.length}},i(ft){Le||(_e(n.$$.fragment,ft),_e(pt),_e(St),_e(dt),Le=!0)},o(ft){Ie(n.$$.fragment,ft),Ie(pt),Ie(St),Ie(dt),Le=!1},d(ft){ft&&(oe(e),oe(f),oe(m),oe(l),oe(x),oe(S)),st(n),pt&&pt.d(ft),St&&St.d(ft),dt&&dt.d(ft),Sr(Bt,ft),Sr(wt,ft),we=!1,ye()}}}function Ry(r){let e,n,s,a,f,m,l=`2px solid ${ds.secondaryRoutes}`,x;function S(B){r[12](B)}let C={label:"Medium cycling flow coverage",pct:lc(r[0].covered_flow_quintile_sums[1],r[0].total_flow_quintile_sums[1])};r[1]!==void 0&&(C.showLayer=r[1]),n=new Aa({props:C}),Jn.push(()=>Ir(n,"showLayer",S));function L(B){r[13](B)}let N={label:"Town centres",pct:r[0].percent_reachable_town_centres};return r[3]!==void 0&&(N.showLayer=r[3]),f=new Aa({props:N}),Jn.push(()=>Ir(f,"showLayer",L)),{c(){e=ue("div"),ot(n.$$.fragment),a=Be(),ot(f.$$.fragment),Un(e,"margin-top","4px"),Un(e,"border",l)},m(B,U){ae(B,e,U),rt(n,e,null),Z(e,a),rt(f,e,null),x=!0},p(B,U){const ee={};U&1&&(ee.pct=lc(B[0].covered_flow_quintile_sums[1],B[0].total_flow_quintile_sums[1])),!s&&U&2&&(s=!0,ee.showLayer=B[1],kr(()=>s=!1)),n.$set(ee);const ie={};U&1&&(ie.pct=B[0].percent_reachable_town_centres),!m&&U&8&&(m=!0,ie.showLayer=B[3],kr(()=>m=!1)),f.$set(ie)},i(B){x||(_e(n.$$.fragment,B),_e(f.$$.fragment,B),x=!0)},o(B){Ie(n.$$.fragment,B),Ie(f.$$.fragment,B),x=!1},d(B){B&&oe(e),st(n),st(f)}}}function Dy(r){let e,n,s,a,f,m,l,x,S,C,L,N,B,U,ee,ie=`2px solid ${ds.localAccessRoutes}`,re;function Q(ye){r[14](ye)}let $={label:"Low cycling flow coverage",pct:lc(r[0].covered_flow_quintile_sums[2],r[0].total_flow_quintile_sums[2])};r[1]!==void 0&&($.showLayer=r[1]),n=new Aa({props:$}),Jn.push(()=>Ir(n,"showLayer",Q));function pe(ye){r[15](ye)}let ve={label:"Schools",pct:r[0].percent_reachable_schools};r[4]!==void 0&&(ve.showLayer=r[4]),f=new Aa({props:ve}),Jn.push(()=>Ir(f,"showLayer",pe));function De(ye){r[16](ye)}let he={label:"GPs and hospitals",pct:r[0].percent_reachable_gp_hospitals};r[5]!==void 0&&(he.showLayer=r[5]),x=new Aa({props:he}),Jn.push(()=>Ir(x,"showLayer",De));function xe(ye){r[17](ye)}let be={label:"Deprived population coverage",pct:r[0].percent_reachable_imd_population};r[6]!==void 0&&(be.showLayer=r[6]),L=new Aa({props:be}),Jn.push(()=>Ir(L,"showLayer",xe));function Le(ye){r[18](ye)}let we={label:"Population coverage",pct:r[0].percent_reachable_population};return r[7]!==void 0&&(we.showLayer=r[7]),U=new Aa({props:we}),Jn.push(()=>Ir(U,"showLayer",Le)),{c(){e=ue("div"),ot(n.$$.fragment),a=Be(),ot(f.$$.fragment),l=Be(),ot(x.$$.fragment),C=Be(),ot(L.$$.fragment),B=Be(),ot(U.$$.fragment),Un(e,"margin-top","4px"),Un(e,"border",ie)},m(ye,Ue){ae(ye,e,Ue),rt(n,e,null),Z(e,a),rt(f,e,null),Z(e,l),rt(x,e,null),Z(e,C),rt(L,e,null),Z(e,B),rt(U,e,null),re=!0},p(ye,Ue){const Ve={};Ue&1&&(Ve.pct=lc(ye[0].covered_flow_quintile_sums[2],ye[0].total_flow_quintile_sums[2])),!s&&Ue&2&&(s=!0,Ve.showLayer=ye[1],kr(()=>s=!1)),n.$set(Ve);const pt={};Ue&1&&(pt.pct=ye[0].percent_reachable_schools),!m&&Ue&16&&(m=!0,pt.showLayer=ye[4],kr(()=>m=!1)),f.$set(pt);const St={};Ue&1&&(St.pct=ye[0].percent_reachable_gp_hospitals),!S&&Ue&32&&(S=!0,St.showLayer=ye[5],kr(()=>S=!1)),x.$set(St);const dt={};Ue&1&&(dt.pct=ye[0].percent_reachable_imd_population),!N&&Ue&64&&(N=!0,dt.showLayer=ye[6],kr(()=>N=!1)),L.$set(dt);const ut={};Ue&1&&(ut.pct=ye[0].percent_reachable_population),!ee&&Ue&128&&(ee=!0,ut.showLayer=ye[7],kr(()=>ee=!1)),U.$set(ut)},i(ye){re||(_e(n.$$.fragment,ye),_e(f.$$.fragment,ye),_e(x.$$.fragment,ye),_e(L.$$.fragment,ye),_e(U.$$.fragment,ye),re=!0)},o(ye){Ie(n.$$.fragment,ye),Ie(f.$$.fragment,ye),Ie(x.$$.fragment,ye),Ie(L.$$.fragment,ye),Ie(U.$$.fragment,ye),re=!1},d(ye){ye&&oe(e),st(n),st(f),st(x),st(L),st(U)}}}function Ny(r){let e,n,s,a=`2px solid ${ds.longDistanceRoutes}`,f;function m(x){r[19](x)}let l={label:"Reachable settlements (TODO)",pct:0};return r[8]!==void 0&&(l.showLayer=r[8]),n=new Aa({props:l}),Jn.push(()=>Ir(n,"showLayer",m)),{c(){e=ue("div"),ot(n.$$.fragment),Un(e,"margin-top","4px"),Un(e,"border",a)},m(x,S){ae(x,e,S),rt(n,e,null),f=!0},p(x,S){const C={};!s&&S&256&&(s=!0,C.showLayer=x[8],kr(()=>s=!1)),n.$set(C)},i(x){f||(_e(n.$$.fragment,x),f=!0)},o(x){Ie(n.$$.fragment,x),f=!1},d(x){x&&oe(e),st(n)}}}function zy(r){let e,n=r[22]+"",s,a,f=Math.round(r[23]*100)+"",m,l;return{c(){e=ue("li"),s=Oe(n),a=Oe(": "),m=Oe(f),l=Oe("%")},m(x,S){ae(x,e,S),Z(e,s),Z(e,a),Z(e,m),Z(e,l)},p(x,S){S&1&&n!==(n=x[22]+"")&&Mt(s,n),S&1&&f!==(f=Math.round(x[23]*100)+"")&&Mt(m,f)},d(x){x&&oe(e)}}}function Oy(r){let e,n=r[22]+"",s,a,f=Math.round(r[23]*100)+"",m,l;return{c(){e=ue("li"),s=Oe(n),a=Oe(": "),m=Oe(f),l=Oe("%")},m(x,S){ae(x,e,S),Z(e,s),Z(e,a),Z(e,m),Z(e,l)},p(x,S){S&1&&n!==(n=x[22]+"")&&Mt(s,n),S&1&&f!==(f=Math.round(x[23]*100)+"")&&Mt(m,f)},d(x){x&&oe(e)}}}function HS(r){let e,n,s,a,f,m,l=r[0]&&Py(r);return{c(){e=ue("button"),e.textContent="Recalculate",n=Be(),l&&l.c(),s=ni()},m(x,S){ae(x,e,S),ae(x,n,S),l&&l.m(x,S),ae(x,s,S),a=!0,f||(m=Pt(e,"click",r[10]),f=!0)},p(x,[S]){x[0]?l?(l.p(x,S),S&1&&_e(l,1)):(l=Py(x),l.c(),_e(l,1),l.m(s.parentNode,s)):l&&(Nn(),Ie(l,1,1,()=>{l=null}),zn())},i(x){a||(_e(l),a=!0)},o(x){Ie(l),a=!1},d(x){x&&(oe(e),oe(n),oe(s)),l&&l.d(x),f=!1,m()}}}function lc(r,e){return e==0?0:r/e}const Fy=(r,e)=>e[1]-r[1],By=(r,e)=>e[1]-r[1];function WS(r,e,n){let s,a,f,m,l,x,S,C,L,N,B;Ot(r,Iy,be=>n(0,s=be)),Ot(r,sr,be=>n(21,a=be)),Ot(r,Ku,be=>n(1,f=be)),Ot(r,eu,be=>n(2,m=be)),Ot(r,$f,be=>n(3,l=be)),Ot(r,Wf,be=>n(4,x=be)),Ot(r,Xf,be=>n(5,S=be)),Ot(r,Yf,be=>n(6,C=be)),Ot(r,Jf,be=>n(7,L=be)),Ot(r,Sy,be=>n(8,N=be)),Ot(r,Ni,be=>n(9,B=be));async function U(){Dn(Iy,s=await a.recalculateStats(),s)}cc(async()=>{s==null&&await U()});function ee(be){f=be,Ku.set(f)}function ie(be){f=be,Ku.set(f)}function re(be){l=be,$f.set(l)}function Q(be){f=be,Ku.set(f)}function $(be){x=be,Wf.set(x)}function pe(be){S=be,Xf.set(S)}function ve(be){C=be,Yf.set(C)}function De(be){L=be,Jf.set(L)}function he(be){N=be,Sy.set(N)}return[s,f,m,l,x,S,C,L,N,B,U,ee,ie,re,Q,$,pe,ve,De,he,()=>Dn(Ni,B={kind:"evaluate-route",browse:wl(s).worst_directness_routes},B)]}class XS extends fn{constructor(e){super(),hn(this,e,WS,HS,un,{})}}function Uy(r,e,n){const s=r.slice();return s[4]=e[n],s}function jy(r){let e,n=r[4]+"",s;return{c(){e=ue("option"),s=Oe(n),e.__value=r[4],zi(e,e.__value)},m(a,f){ae(a,e,f),Z(e,s)},p:tt,d(a){a&&oe(e)}}}function $S(r){let e,n,s,a,f,m=Hn(r[1]),l=[];for(let x=0;x<m.length;x+=1)l[x]=jy(Uy(r,m,x));return{c(){e=ue("label"),n=Oe(`Area:
  `),s=ue("select");for(let x=0;x<l.length;x+=1)l[x].c();r[0]===void 0&&Po(()=>r[3].call(s))},m(x,S){ae(x,e,S),Z(e,n),Z(e,s);for(let C=0;C<l.length;C+=1)l[C]&&l[C].m(s,null);fs(s,r[0],!0),a||(f=[Pt(s,"change",r[3]),Pt(s,"change",r[2])],a=!0)},p(x,[S]){if(S&2){m=Hn(x[1]);let C;for(C=0;C<m.length;C+=1){const L=Uy(x,m,C);l[C]?l[C].p(L,S):(l[C]=jy(L),l[C].c(),l[C].m(s,null))}for(;C<l.length;C+=1)l[C].d(1);l.length=m.length}S&3&&fs(s,x[0])},i:tt,o:tt,d(x){x&&oe(e),Sr(l,x),a=!1,$i(f)}}}function YS(r,e,n){let{area:s}=e,a=["REGION_Aberdeen and North East","REGION_Edinburgh and Lothians","REGION_Glasgow and Strathclyde","REGION_Highlands and Islands","REGION_Scotland South","REGION_Tayside, Central and Fife","LAD_Clackmannanshire","LAD_Dumfries and Galloway","LAD_East Ayrshire","LAD_East Lothian","LAD_East Renfrewshire","LAD_Na h-Eileanan Siar","LAD_Falkirk","LAD_Highland","LAD_Inverclyde","LAD_Midlothian","LAD_Moray","LAD_North Ayrshire","LAD_Orkney Islands","LAD_Scottish Borders","LAD_Shetland Islands","LAD_South Ayrshire","LAD_South Lanarkshire","LAD_Stirling","LAD_Aberdeen City","LAD_Aberdeenshire","LAD_Argyll and Bute","LAD_City of Edinburgh","LAD_Renfrewshire","LAD_West Dunbartonshire","LAD_West Lothian","LAD_Angus","LAD_Dundee City","LAD_East Dunbartonshire","LAD_Fife","LAD_Perth and Kinross","LAD_Glasgow City","LAD_North Lanarkshire"];a.sort();function f(){window.location.href=`index.html?boundary=${s}`}function m(){s=_l(this),n(0,s),n(1,a)}return r.$$set=l=>{"area"in l&&n(0,s=l.area)},[s,a,f,m]}class JS extends fn{constructor(e){super(),hn(this,e,YS,$S,un,{area:0})}}const{window:KS}=$0;function Vy(r,e,n){const s=r.slice();return s[19]=e[n],s}function qy(r){let e,n,s=Hn(r[0].features),a=[];for(let m=0;m<s.length;m+=1)a[m]=Gy(Vy(r,s,m));const f=m=>Ie(a[m],1,1,()=>{a[m]=null});return{c(){e=ue("ol");for(let m=0;m<a.length;m+=1)a[m].c()},m(m,l){ae(m,e,l);for(let x=0;x<a.length;x+=1)a[x]&&a[x].m(e,null);n=!0},p(m,l){if(l&65){s=Hn(m[0].features);let x;for(x=0;x<s.length;x+=1){const S=Vy(m,s,x);a[x]?(a[x].p(S,l),_e(a[x],1)):(a[x]=Gy(S),a[x].c(),_e(a[x],1),a[x].m(e,null))}for(Nn(),x=s.length;x<a.length;x+=1)f(x);zn()}},i(m){if(!n){for(let l=0;l<s.length;l+=1)_e(a[l]);n=!0}},o(m){a=a.filter(Boolean);for(let l=0;l<a.length;l+=1)Ie(a[l]);n=!1},d(m){m&&oe(e),Sr(a,m)}}}function QS(r){var l,x;let e=(((l=r[19].properties)==null?void 0:l.name)||`Untitled route ${r[19].id}`)+"",n,s,a=((x=r[19].properties)==null?void 0:x.infra_type)+"",f,m;return{c(){n=Oe(e),s=Oe(" ("),f=Oe(a),m=Oe(")")},m(S,C){ae(S,n,C),ae(S,s,C),ae(S,f,C),ae(S,m,C)},p(S,C){var L,N;C&1&&e!==(e=(((L=S[19].properties)==null?void 0:L.name)||`Untitled route ${S[19].id}`)+"")&&Mt(n,e),C&1&&a!==(a=((N=S[19].properties)==null?void 0:N.infra_type)+"")&&Mt(f,a)},d(S){S&&(oe(n),oe(s),oe(f),oe(m))}}}function Gy(r){let e,n,s,a;function f(){return r[15](r[19])}return n=new US({props:{$$slots:{default:[QS]},$$scope:{ctx:r}}}),n.$on("click",f),{c(){e=ue("li"),ot(n.$$.fragment),s=Be()},m(m,l){ae(m,e,l),rt(n,e,null),Z(e,s),a=!0},p(m,l){r=m;const x={};l&4194305&&(x.$$scope={dirty:l,ctx:r}),n.$set(x)},i(m){a||(_e(n.$$.fragment,m),a=!0)},o(m){Ie(n.$$.fragment,m),a=!1},d(m){m&&oe(e),st(n)}}}function eE(r){let e,n,s,a,f,m,l,x,S,C,L,N,B,U,ee,ie,re,Q,$,pe,ve,De;n=new JS({props:{area:r[3]}});let he=r[0]&&qy(r);return $=new qS({}),{c(){e=ue("div"),ot(n.$$.fragment),s=Be(),a=ue("div"),f=ue("button"),f.innerHTML=`Draw new <u>r</u>
        oute line`,m=Be(),l=ue("button"),l.textContent="Clear all",x=Be(),S=ue("label"),C=ue("input"),L=Oe(`
      Show current network`),N=Be(),B=ue("details"),U=ue("summary"),U.textContent="Current network routes",ee=Be(),he&&he.c(),ie=Be(),re=ue("hr"),Q=Be(),ot($.$$.fragment),He(l,"class","secondary"),He(C,"type","checkbox"),He(e,"slot","left")},m(xe,be){ae(xe,e,be),rt(n,e,null),Z(e,s),Z(e,a),Z(a,f),Z(a,m),Z(a,l),Z(e,x),Z(e,S),Z(S,C),C.checked=r[2],Z(S,L),Z(e,N),Z(e,B),Z(B,U),Z(B,ee),he&&he.m(B,null),Z(e,ie),Z(e,re),Z(e,Q),rt($,e,null),pe=!0,ve||(De=[Pt(f,"click",r[13]),Pt(l,"click",r[7]),Pt(C,"change",r[14])],ve=!0)},p(xe,be){const Le={};be&8&&(Le.area=xe[3]),n.$set(Le),be&4&&(C.checked=xe[2]),xe[0]?he?(he.p(xe,be),be&1&&_e(he,1)):(he=qy(xe),he.c(),_e(he,1),he.m(B,null)):he&&(Nn(),Ie(he,1,1,()=>{he=null}),zn())},i(xe){pe||(_e(n.$$.fragment,xe),_e(he),_e($.$$.fragment,xe),pe=!0)},o(xe){Ie(n.$$.fragment,xe),Ie(he),Ie($.$$.fragment,xe),pe=!1},d(xe){xe&&oe(e),st(n),he&&he.d(),st($),ve=!1,$i(De)}}}function Zy(r){let e,n;return e=new rr({props:{data:r[0],$$slots:{default:[iE]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&1&&(f.data=s[0]),a&4194308&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function tE(r){let e=(r[18].name||"Untitled")+"",n,s,a=oc[r[18].infra_type][0]+"",f,m;return{c(){n=Oe(e),s=Oe(" ("),f=Oe(a),m=Oe(")")},m(l,x){ae(l,n,x),ae(l,s,x),ae(l,f,x),ae(l,m,x)},p(l,x){x&262144&&e!==(e=(l[18].name||"Untitled")+"")&&Mt(n,e),x&262144&&a!==(a=oc[l[18].infra_type][0]+"")&&Mt(f,a)},d(l){l&&(oe(n),oe(s),oe(f),oe(m))}}}function nE(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[tE,({props:s})=>({18:s}),({props:s})=>s?262144:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&4456448&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function iE(r){let e,n;return e=new mr({props:{id:"routes",paint:{"line-width":Ms(5,7),"line-color":ac},layout:{visibility:r[2]?"visible":"none"},manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[nE]},$$scope:{ctx:r}}}),e.$on("click",r[5]),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&4&&(f.layout={visibility:s[2]?"visible":"none"}),a&4194304&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function rE(r){let e,n,s=r[0]&&Zy(r);return{c(){e=ue("div"),s&&s.c(),He(e,"slot","map")},m(a,f){ae(a,e,f),s&&s.m(e,null),n=!0},p(a,f){a[0]?s?(s.p(a,f),f&1&&_e(s,1)):(s=Zy(a),s.c(),_e(s,1),s.m(e,null)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn())},i(a){n||(_e(s),n=!0)},o(a){Ie(s),n=!1},d(a){a&&oe(e),s&&s.d()}}}function sE(r){let e,n,s,a,f,m,l,x,S,C,L,N,B,U,ee,ie,re;return n=new XS({}),{c(){e=ue("div"),ot(n.$$.fragment),s=Be(),a=ue("div"),f=ue("button"),f.textContent="Evaluate a route",m=Be(),l=ue("div"),x=ue("button"),x.textContent="Evaluate OD",S=Be(),C=ue("div"),L=ue("button"),L.textContent="Debug network",N=Be(),B=ue("div"),U=ue("button"),U.textContent="Debug mesh density",He(f,"class","secondary"),He(x,"class","secondary"),He(L,"class","secondary"),He(U,"class","secondary"),He(e,"slot","right")},m(Q,$){ae(Q,e,$),rt(n,e,null),Z(e,s),Z(e,a),Z(a,f),Z(e,m),Z(e,l),Z(l,x),Z(e,S),Z(e,C),Z(C,L),Z(e,N),Z(e,B),Z(B,U),ee=!0,ie||(re=[Pt(f,"click",r[9]),Pt(x,"click",r[10]),Pt(L,"click",r[11]),Pt(U,"click",r[12])],ie=!0)},p:tt,i(Q){ee||(_e(n.$$.fragment,Q),ee=!0)},o(Q){Ie(n.$$.fragment,Q),ee=!1},d(Q){Q&&oe(e),st(n),ie=!1,$i(re)}}}function oE(r){let e,n,s,a;return e=new gc({props:{$$slots:{right:[sE],map:[rE],left:[eE]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(f,m){rt(e,f,m),n=!0,s||(a=Pt(KS,"keydown",r[4]),s=!0)},p(f,[m]){const l={};m&4194319&&(l.$$scope={dirty:m,ctx:f}),e.$set(l)},i(f){n||(_e(e.$$.fragment,f),n=!0)},o(f){Ie(e.$$.fragment,f),n=!1},d(f){st(e,f),s=!1,a()}}}function aE(r,e,n){let s,a,f,m,l;Ot(r,sr,ve=>n(16,s=ve)),Ot(r,Ni,ve=>n(1,a=ve)),Ot(r,Rh,ve=>n(8,f=ve)),Ot(r,Op,ve=>n(2,m=ve)),Ot(r,Hf,ve=>n(3,l=ve));let x=null;cc(S);async function S(){n(0,x=await s.renderRoutes())}function C(ve){ve.key=="r"&&(ve.preventDefault(),Dn(Ni,a={kind:"edit-route",id:null},a))}function L(ve){Dn(Ni,a={kind:"edit-route",id:ve.detail.features[0].id},a)}function N(ve){Dn(Ni,a={kind:"edit-route",id:ve},a)}async function B(){window.confirm("Clear everything? You can't undo this")&&(await(s==null?void 0:s.clearAllRoutes()),await Dh(),await S())}const U=()=>Dn(Ni,a={kind:"evaluate-route",browse:[]},a),ee=()=>Dn(Ni,a={kind:"evaluate-od"},a),ie=()=>Dn(Ni,a={kind:"debug-network"},a),re=()=>Dn(Ni,a={kind:"debug-mesh-density"},a),Q=()=>Dn(Ni,a={kind:"edit-route",id:null},a);function $(){m=this.checked,Op.set(m)}const pe=ve=>N(ve.id);return r.$$.update=()=>{r.$$.dirty&256&&f>0&&S()},[x,a,m,l,C,L,N,B,f,U,ee,ie,re,Q,$,pe]}class lE extends fn{constructor(e){super(),hn(this,e,aE,oE,un,{})}}function uE(r,e,n){const s=r.slice();return s[0]=e[n][0],s[1]=e[n][1],s[2]=e[n][2],s}function cE(r){let e,n,s;return{c(){e=ue("span"),e.textContent=`${r[1]}`,n=Be(),s=ue("br"),Un(e,"color",r[2])},m(a,f){ae(a,e,f),ae(a,n,f),ae(a,s,f)},p:tt,d(a){a&&(oe(e),oe(n),oe(s))}}}function hE(r){let e,n,s,a,f=Hn(rd),m=[];for(let l=0;l<f.length;l+=1)m[l]=cE(uE(r,f,l));return{c(){e=ue("div"),n=ue("details"),s=ue("summary"),s.textContent="Legend",a=Be();for(let l=0;l<m.length;l+=1)m[l].c();n.open=!0,He(e,"class","svelte-1oq1sox")},m(l,x){ae(l,e,x),Z(e,n),Z(n,s),Z(n,a);for(let S=0;S<m.length;S+=1)m[S]&&m[S].m(n,null)},p:tt,i:tt,o:tt,d(l){l&&oe(e),Sr(m,l)}}}class fE extends fn{constructor(e){super(),hn(this,e,null,hE,un,{})}}const dE="/npw/assets/help-d011708a.svg";function Hy(r){let e,n;return e=new Hv({props:{$$slots:{default:[pE]},$$scope:{ctx:r}}}),e.$on("close",r[3]),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&16&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function pE(r){let e,n,s;const a=r[1].default,f=Zi(a,r,r[4],null);return{c(){e=ue("h2"),e.textContent="Help",n=Be(),f&&f.c()},m(m,l){ae(m,e,l),ae(m,n,l),f&&f.m(m,l),s=!0},p(m,l){f&&f.p&&(!s||l&16)&&Wi(f,a,m,m[4],s?Hi(a,m[4],l,null):Xi(m[4]),null)},i(m){s||(_e(f,m),s=!0)},o(m){Ie(f,m),s=!1},d(m){m&&(oe(e),oe(n)),f&&f.d(m)}}}function mE(r){let e,n,s,a,f,m,l=r[0]&&Hy(r);return{c(){e=ue("button"),e.innerHTML=`<img src="${dE}" title="Help" alt="Help"/>`,n=Be(),l&&l.c(),s=ni(),He(e,"class","svelte-gb6dzm")},m(x,S){ae(x,e,S),ae(x,n,S),l&&l.m(x,S),ae(x,s,S),a=!0,f||(m=Pt(e,"click",r[2]),f=!0)},p(x,[S]){x[0]?l?(l.p(x,S),S&1&&_e(l,1)):(l=Hy(x),l.c(),_e(l,1),l.m(s.parentNode,s)):l&&(Nn(),Ie(l,1,1,()=>{l=null}),zn())},i(x){a||(_e(l),a=!0)},o(x){Ie(l),a=!1},d(x){x&&(oe(e),oe(n),oe(s)),l&&l.d(x),f=!1,m()}}}function gE(r,e,n){let{$$slots:s={},$$scope:a}=e,f=!1;const m=()=>n(0,f=!0),l=()=>n(0,f=!1);return r.$$set=x=>{"$$scope"in x&&n(4,a=x.$$scope)},[f,s,m,l,a]}class Jv extends fn{constructor(e){super(),hn(this,e,gE,mE,un,{})}}function Wy(r,e,n){const s=r.slice();return s[1]=e[n][0],s[2]=e[n][1],s}function Xy(r){let e,n,s,a=r[1]+"",f,m;return{c(){e=ue("li"),n=ue("span"),s=Be(),f=Oe(a),m=Be(),He(n,"class","svelte-kzgqtg"),Un(n,"background",r[2])},m(l,x){ae(l,e,x),Z(e,n),Z(e,s),Z(e,f),Z(e,m)},p(l,x){x&1&&Un(n,"background",l[2]),x&1&&a!==(a=l[1]+"")&&Mt(f,a)},d(l){l&&oe(e)}}}function _E(r){let e,n=Hn(Object.entries(r[0])),s=[];for(let a=0;a<n.length;a+=1)s[a]=Xy(Wy(r,n,a));return{c(){e=ue("ul");for(let a=0;a<s.length;a+=1)s[a].c()},m(a,f){ae(a,e,f);for(let m=0;m<s.length;m+=1)s[m]&&s[m].m(e,null)},p(a,[f]){if(f&1){n=Hn(Object.entries(a[0]));let m;for(m=0;m<n.length;m+=1){const l=Wy(a,n,m);s[m]?s[m].p(l,f):(s[m]=Xy(l),s[m].c(),s[m].m(e,null))}for(;m<s.length;m+=1)s[m].d(1);s.length=n.length}},i:tt,o:tt,d(a){a&&oe(e),Sr(s,a)}}}function yE(r,e,n){let{colors:s}=e;return r.$$set=a=>{"colors"in a&&n(0,s=a.colors)},[s]}class _c extends fn{constructor(e){super(),hn(this,e,yE,_E,un,{colors:0})}}let ln;const Kv=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Kv.decode();let vh=null;function Eh(){return(vh===null||vh.byteLength===0)&&(vh=new Uint8Array(ln.memory.buffer)),vh}function _o(r,e){return r=r>>>0,Kv.decode(Eh().subarray(r,r+e))}const Pa=new Array(128).fill(void 0);Pa.push(void 0,null,!0,!1);let Th=Pa.length;function lr(r){Th===Pa.length&&Pa.push(Pa.length+1);const e=Th;return Th=Pa[e],Pa[e]=r,e}function Zn(r){return Pa[r]}function vE(r){r<132||(Pa[r]=Th,Th=r)}function $u(r){const e=Zn(r);return vE(r),e}function fp(r){return r==null}let bh=null;function bE(){return(bh===null||bh.byteLength===0)&&(bh=new Float64Array(ln.memory.buffer)),bh}let xh=null;function ai(){return(xh===null||xh.byteLength===0)&&(xh=new Int32Array(ln.memory.buffer)),xh}let vl=0;const Rf=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},xE=typeof Rf.encodeInto=="function"?function(r,e){return Rf.encodeInto(r,e)}:function(r,e){const n=Rf.encode(r);return e.set(n),{read:r.length,written:n.length}};function kf(r,e,n){if(n===void 0){const l=Rf.encode(r),x=e(l.length,1)>>>0;return Eh().subarray(x,x+l.length).set(l),vl=l.length,x}let s=r.length,a=e(s,1)>>>0;const f=Eh();let m=0;for(;m<s;m++){const l=r.charCodeAt(m);if(l>127)break;f[a+m]=l}if(m!==s){m!==0&&(r=r.slice(m)),a=n(a,s,s=m+r.length*3,1)>>>0;const l=Eh().subarray(a+m,a+s),x=xE(r,l);m+=x.written}return vl=m,a}function Up(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const a=r.description;return a==null?"Symbol":`Symbol(${a})`}if(e=="function"){const a=r.name;return typeof a=="string"&&a.length>0?`Function(${a})`:"Function"}if(Array.isArray(r)){const a=r.length;let f="[";a>0&&(f+=Up(r[0]));for(let m=1;m<a;m++)f+=", "+Up(r[m]);return f+="]",f}const n=/\[object ([^\]]+)\]/.exec(toString.call(r));let s;if(n.length>1)s=n[1];else return toString.call(r);if(s=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:s}function wE(r,e){const n=e(r.length*1,1)>>>0;return Eh().set(r,n/1),vl=r.length,n}function dp(r,e){try{return r.apply(this,e)}catch(n){ln.__wbindgen_exn_store(lr(n))}}class Kf{static __wrap(e){e=e>>>0;const n=Object.create(Kf.prototype);return n.__wbg_ptr=e,n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();ln.__wbg_jsroutesnapper_free(e)}constructor(e){try{const f=ln.__wbindgen_add_to_stack_pointer(-16),m=wE(e,ln.__wbindgen_malloc),l=vl;ln.jsroutesnapper_new(f,m,l);var n=ai()[f/4+0],s=ai()[f/4+1],a=ai()[f/4+2];if(a)throw $u(s);return Kf.__wrap(n)}finally{ln.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){ln.jsroutesnapper_setRouteConfig(this.__wbg_ptr,lr(e))}setAreaMode(){ln.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,n;try{const f=ln.__wbindgen_add_to_stack_pointer(-16);ln.jsroutesnapper_getConfig(f,this.__wbg_ptr);var s=ai()[f/4+0],a=ai()[f/4+1];return e=s,n=a,_o(s,a)}finally{ln.__wbindgen_add_to_stack_pointer(16),ln.__wbindgen_free(e,n,1)}}toFinalFeature(){try{const s=ln.__wbindgen_add_to_stack_pointer(-16);ln.jsroutesnapper_toFinalFeature(s,this.__wbg_ptr);var e=ai()[s/4+0],n=ai()[s/4+1];let a;return e!==0&&(a=_o(e,n).slice(),ln.__wbindgen_free(e,n*1)),a}finally{ln.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,n;try{const f=ln.__wbindgen_add_to_stack_pointer(-16);ln.jsroutesnapper_renderGeojson(f,this.__wbg_ptr);var s=ai()[f/4+0],a=ai()[f/4+1];return e=s,n=a,_o(s,a)}finally{ln.__wbindgen_add_to_stack_pointer(16),ln.__wbindgen_free(e,n,1)}}toggleSnapMode(){ln.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,n,s){return ln.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,n,s)!==0}onClick(){ln.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return ln.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return ln.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){ln.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const a=ln.__wbindgen_add_to_stack_pointer(-16);ln.jsroutesnapper_editExisting(a,this.__wbg_ptr,lr(e));var n=ai()[a/4+0],s=ai()[a/4+1];if(s)throw $u(n)}finally{ln.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,n;try{const f=ln.__wbindgen_add_to_stack_pointer(-16);ln.jsroutesnapper_debugRenderGraph(f,this.__wbg_ptr);var s=ai()[f/4+0],a=ai()[f/4+1];return e=s,n=a,_o(s,a)}finally{ln.__wbindgen_add_to_stack_pointer(16),ln.__wbindgen_free(e,n,1)}}debugSnappableNodes(){let e,n;try{const f=ln.__wbindgen_add_to_stack_pointer(-16);ln.jsroutesnapper_debugSnappableNodes(f,this.__wbg_ptr);var s=ai()[f/4+0],a=ai()[f/4+1];return e=s,n=a,_o(s,a)}finally{ln.__wbindgen_add_to_stack_pointer(16),ln.__wbindgen_free(e,n,1)}}routeNameForWaypoints(e){let n,s;try{const C=ln.__wbindgen_add_to_stack_pointer(-16);ln.jsroutesnapper_routeNameForWaypoints(C,this.__wbg_ptr,lr(e));var a=ai()[C/4+0],f=ai()[C/4+1],m=ai()[C/4+2],l=ai()[C/4+3],x=a,S=f;if(l)throw x=0,S=0,$u(m);return n=x,s=S,_o(x,S)}finally{ln.__wbindgen_add_to_stack_pointer(16),ln.__wbindgen_free(n,s,1)}}addSnappedWaypoint(e,n){ln.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,n)}undo(){ln.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let n,s;try{const C=ln.__wbindgen_add_to_stack_pointer(-16);ln.jsroutesnapper_calculateRoute(C,this.__wbg_ptr,lr(e));var a=ai()[C/4+0],f=ai()[C/4+1],m=ai()[C/4+2],l=ai()[C/4+3],x=a,S=f;if(l)throw x=0,S=0,$u(m);return n=x,s=S,_o(x,S)}finally{ln.__wbindgen_add_to_stack_pointer(16),ln.__wbindgen_free(n,s,1)}}getExtraNodes(e,n){let s,a;try{const L=ln.__wbindgen_add_to_stack_pointer(-16);ln.jsroutesnapper_getExtraNodes(L,this.__wbg_ptr,lr(e),lr(n));var f=ai()[L/4+0],m=ai()[L/4+1],l=ai()[L/4+2],x=ai()[L/4+3],S=f,C=m;if(x)throw S=0,C=0,$u(l);return s=S,a=C,_o(S,C)}finally{ln.__wbindgen_add_to_stack_pointer(16),ln.__wbindgen_free(s,a,1)}}}async function kE(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(s){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",s);else throw s}const n=await r.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(r,e);return n instanceof WebAssembly.Instance?{instance:n,module:r}:n}}function IE(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,n){const s=_o(e,n);return lr(s)},r.wbg.__wbindgen_object_drop_ref=function(e){$u(e)},r.wbg.__wbindgen_error_new=function(e,n){const s=new Error(_o(e,n));return lr(s)},r.wbg.__wbindgen_number_get=function(e,n){const s=Zn(n),a=typeof s=="number"?s:void 0;bE()[e/8+1]=fp(a)?0:a,ai()[e/4+0]=!fp(a)},r.wbg.__wbindgen_is_object=function(e){const n=Zn(e);return typeof n=="object"&&n!==null},r.wbg.__wbindgen_is_undefined=function(e){return Zn(e)===void 0},r.wbg.__wbindgen_in=function(e,n){return Zn(e)in Zn(n)},r.wbg.__wbindgen_boolean_get=function(e){const n=Zn(e);return typeof n=="boolean"?n?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,n){return Zn(e)==Zn(n)},r.wbg.__wbindgen_string_get=function(e,n){const s=Zn(n),a=typeof s=="string"?s:void 0;var f=fp(a)?0:kf(a,ln.__wbindgen_malloc,ln.__wbindgen_realloc),m=vl;ai()[e/4+1]=m,ai()[e/4+0]=f},r.wbg.__wbg_String_4370c5505c674d30=function(e,n){const s=String(Zn(n)),a=kf(s,ln.__wbindgen_malloc,ln.__wbindgen_realloc),f=vl;ai()[e/4+1]=f,ai()[e/4+0]=a},r.wbg.__wbindgen_object_clone_ref=function(e){const n=Zn(e);return lr(n)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,n){const s=Zn(e)[Zn(n)];return lr(s)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return lr(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const s=Zn(n).stack,a=kf(s,ln.__wbindgen_malloc,ln.__wbindgen_realloc),f=vl;ai()[e/4+1]=f,ai()[e/4+0]=a},r.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let s,a;try{s=e,a=n,console.error(_o(e,n))}finally{ln.__wbindgen_free(s,a,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Zn(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Zn(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Zn(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Zn(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Zn(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,n){const s=Zn(e)[n>>>0];return lr(s)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Zn(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Zn(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const n=Zn(e).next;return lr(n)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return dp(function(e){const n=Zn(e).next();return lr(n)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Zn(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const n=Zn(e).value;return lr(n)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return lr(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return dp(function(e,n){const s=Reflect.get(Zn(e),Zn(n));return lr(s)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return dp(function(e,n){const s=Zn(e).call(Zn(n));return lr(s)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Zn(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let n;try{n=Zn(e)instanceof ArrayBuffer}catch{n=!1}return n},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const n=Zn(e).buffer;return lr(n)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const n=new Uint8Array(Zn(e));return lr(n)},r.wbg.__wbg_set_5cf90238115182c3=function(e,n,s){Zn(e).set(Zn(n),s>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Zn(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let n;try{n=Zn(e)instanceof Uint8Array}catch{n=!1}return n},r.wbg.__wbindgen_debug_string=function(e,n){const s=Up(Zn(n)),a=kf(s,ln.__wbindgen_malloc,ln.__wbindgen_realloc),f=vl;ai()[e/4+1]=f,ai()[e/4+0]=a},r.wbg.__wbindgen_throw=function(e,n){throw new Error(_o(e,n))},r.wbg.__wbindgen_memory=function(){const e=ln.memory;return lr(e)},r}function SE(r,e){return ln=r.exports,Qv.__wbindgen_wasm_module=e,bh=null,xh=null,vh=null,ln}async function Qv(r){if(ln!==void 0)return ln;typeof r>"u"&&(r="/npw/assets/route_snapper_bg.wasm");const e=IE();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:n,module:s}=await kE(await r,e);return SE(n,s)}const EE=30;class TE{constructor(e,n,s,a,f){this.onMouseMove=m=>{if(!this.active)return;const l=[m.point.x-EE,m.point.y],x=this.map.unproject(m.point).distanceTo(this.map.unproject(l));this.inner.onMouseMove(m.lngLat.lng,m.lngLat.lat,x)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=m=>{this.active&&(m.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=m=>{if(!this.active)return;let l=m.target.tagName;l=="INPUT"||l=="TEXTAREA"||m.key=="Escape"&&(m.stopPropagation(),this.cancel())},this.onKeyPress=m=>{if(!this.active)return;let l=m.target.tagName;l=="INPUT"||l=="TEXTAREA"||(m.key=="Enter"?(m.stopPropagation(),this.finish()):m.key=="s"||m.key=="S"?(m.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):m.key=="z"&&m.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Kf(n),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=s,this.snapMode=a,this.undoLength=f,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let n of this.eventListenersSuccess)n(JSON.parse(e));else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let n of this.eventListenersUpdated)n(JSON.parse(e))}}let Qf=Yn(null);const go=Yn([]);const CE=r=>({}),$y=r=>({});function Yy(r,e,n){const s=r.slice();return s[50]=e[n],s[51]=e,s[52]=n,s}function Jy(r,e,n){const s=r.slice();return s[53]=e[n],s[54]=e,s[55]=n,s}const LE=r=>({}),Ky=r=>({});function ME(r){let e,n=r[10].length+"",s,a;return{c(){e=Oe("Undo ("),s=Oe(n),a=Oe(")")},m(f,m){ae(f,e,m),ae(f,s,m),ae(f,a,m)},p(f,m){m[0]&1024&&n!==(n=f[10].length+"")&&Mt(s,n)},d(f){f&&(oe(e),oe(s),oe(a))}}}function AE(r){let e;return{c(){e=Oe("Undo")},m(n,s){ae(n,e,s)},p:tt,d(n){n&&oe(e)}}}function PE(r){let e,n,s,a,f;return{c(){e=ue("ul"),e.innerHTML=`<li><b>Click</b>
          the map to add new points, while extending from the start or end</li> <li><b>Click and drag</b>
          any point to move it</li> <li><b>Click</b>
          a waypoint to toggle snapping</li> <li><b>Right click</b>
          a waypoint to delete it</li>`,n=Be(),s=ue("p"),s.textContent="Keyboard shortcuts:",a=Be(),f=ue("ul"),f.innerHTML=`<li><b>1</b>
          to extend from start</li> <li><b>2</b>
          to extend from end</li> <li><b>3</b>
          to drag middle points</li> <li><b>s</b>
          to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
          to undo your last change</li> <li><b>Enter</b>
          to finish</li> <li><b>Escape</b>
          to cancel</li>`},m(m,l){ae(m,e,l),ae(m,n,l),ae(m,s,l),ae(m,a,l),ae(m,f,l)},p:tt,d(m){m&&(oe(e),oe(n),oe(s),oe(a),oe(f))}}}function RE(r){let e,n,s,a,f,m,l,x,S,C,L,N,B,U,ee,ie,re,Q,$,pe,ve,De,he,xe,be,Le,we,ye,Ue,Ve,pt,St,dt,ut,Bt,vt,wt,ft,xt,It,Jt,pn,Rn,Xe,Wn,dn,Ft,Se,lt,Je,Lt,Ye;function kt(Gt,_n){return Gt[10].length==0?AE:ME}let Vt=kt(r),Ee=Vt(r);return ee=new Jv({props:{$$slots:{default:[PE]},$$scope:{ctx:r}}}),lt=Vg(r[39][0]),Je=Vg(r[39][1]),{c(){e=ue("div"),n=ue("h2"),n.textContent="Editing a route",s=Be(),a=ue("button"),f=Oe("Finish"),l=Be(),x=ue("button"),Ee.c(),C=Be(),L=ue("button"),L.textContent="Delete",N=Be(),B=ue("button"),B.textContent="Cancel",U=Be(),ot(ee.$$.fragment),ie=Be(),re=ue("fieldset"),Q=ue("label"),$=ue("input"),pe=Oe(`
        Snap to roads`),ve=Be(),De=ue("label"),he=ue("input"),xe=Oe(`
        Draw anywhere`),be=Be(),Le=ue("fieldset"),we=ue("label"),ye=ue("input"),Ue=Oe(`
        Extend from start (
        `),Ve=ue("b"),Ve.textContent="1",pt=Oe(`
        )`),St=Be(),dt=ue("label"),ut=ue("input"),Bt=Oe(`
        Extend from end (
        `),vt=ue("b"),vt.textContent="2",wt=Oe(`
        )`),ft=Be(),xt=ue("label"),It=ue("input"),Jt=Oe(`
        Adjust middle points (
        `),pn=ue("b"),pn.textContent="3",Rn=Oe(`
        )`),Xe=Be(),Wn=ue("label"),dn=ue("input"),Ft=Oe(`
      Show major junctions`),a.disabled=m=r[7].length<2,He(x,"class","secondary"),x.disabled=S=r[10].length==0,He(L,"class","secondary"),He(B,"class","secondary"),He($,"type","radio"),$.__value="snap",zi($,$.__value),He(he,"type","radio"),he.__value="free",zi(he,he.__value),He(ye,"type","radio"),ye.__value="append-start",zi(ye,ye.__value),He(ut,"type","radio"),ut.__value="append-end",zi(ut,ut.__value),He(It,"type","radio"),It.__value="adjust",zi(It,It.__value),He(dn,"type","checkbox"),He(e,"slot","left"),lt.p(ye,ut,It),Je.p($,he)},m(Gt,_n){ae(Gt,e,_n),Z(e,n),Z(e,s),Z(e,a),Z(a,f),Z(e,l),Z(e,x),Ee.m(x,null),Z(e,C),Z(e,L),Z(e,N),Z(e,B),Z(e,U),rt(ee,e,null),Z(e,ie),Z(e,re),Z(re,Q),Z(Q,$),$.checked=$.__value===r[9],Z(Q,pe),Z(re,ve),Z(re,De),Z(De,he),he.checked=he.__value===r[9],Z(De,xe),Z(e,be),Z(e,Le),Z(Le,we),Z(we,ye),ye.checked=ye.__value===r[3],Z(we,Ue),Z(we,Ve),Z(we,pt),Z(Le,St),Z(Le,dt),Z(dt,ut),ut.checked=ut.__value===r[3],Z(dt,Bt),Z(dt,vt),Z(dt,wt),Z(Le,ft),Z(Le,xt),Z(xt,It),It.checked=It.__value===r[3],Z(xt,Jt),Z(xt,pn),Z(xt,Rn),Z(e,Xe),Z(e,Wn),Z(Wn,dn),dn.checked=r[13],Z(Wn,Ft),Se=!0,Lt||(Ye=[Pt(a,"click",function(){iu(r[0])&&r[0].apply(this,arguments)}),Pt(x,"click",r[14]),Pt(L,"click",function(){iu(r[2])&&r[2].apply(this,arguments)}),Pt(B,"click",function(){iu(r[1])&&r[1].apply(this,arguments)}),Pt($,"change",r[38]),Pt($,"change",r[15]),Pt(he,"change",r[40]),Pt(he,"change",r[15]),Pt(ye,"change",r[41]),Pt(ut,"change",r[42]),Pt(It,"change",r[43]),Pt(dn,"change",r[44])],Lt=!0)},p(Gt,_n){r=Gt,(!Se||_n[0]&128&&m!==(m=r[7].length<2))&&(a.disabled=m),Vt===(Vt=kt(r))&&Ee?Ee.p(r,_n):(Ee.d(1),Ee=Vt(r),Ee&&(Ee.c(),Ee.m(x,null))),(!Se||_n[0]&1024&&S!==(S=r[10].length==0))&&(x.disabled=S);const Kn={};_n[1]&16384&&(Kn.$$scope={dirty:_n,ctx:r}),ee.$set(Kn),_n[0]&512&&($.checked=$.__value===r[9]),_n[0]&512&&(he.checked=he.__value===r[9]),_n[0]&8&&(ye.checked=ye.__value===r[3]),_n[0]&8&&(ut.checked=ut.__value===r[3]),_n[0]&8&&(It.checked=It.__value===r[3]),_n[0]&8192&&(dn.checked=r[13])},i(Gt){Se||(_e(ee.$$.fragment,Gt),Se=!0)},o(Gt){Ie(ee.$$.fragment,Gt),Se=!1},d(Gt){Gt&&oe(e),Ee.d(),st(ee),lt.r(),Je.r(),Lt=!1,$i(Ye)}}}function DE(r){let e;return{c(){e=ue("span"),He(e,"class","dot svelte-1cj4rwq"),Vr(e,"snapped-node",r[53].snapped),Vr(e,"free-node",!r[53].snapped),Vr(e,"hide",r[6])},m(n,s){ae(n,e,s)},p(n,s){s[0]&2048&&Vr(e,"snapped-node",n[53].snapped),s[0]&2048&&Vr(e,"free-node",!n[53].snapped),s[0]&64&&Vr(e,"hide",n[6])},d(n){n&&oe(e)}}}function Qy(r){let e,n,s;function a(x){r[29](x,r[53])}function f(){return r[30](r[53])}function m(){return r[31](r[53])}let l={draggable:!0,zIndex:0,$$slots:{default:[DE]},$$scope:{ctx:r}};return r[53].point!==void 0&&(l.lngLat=r[53].point),e=new Zf({props:l}),Jn.push(()=>Ir(e,"lngLat",a)),e.$on("dragstart",f),e.$on("drag",m),e.$on("dragend",r[23]),{c(){ot(e.$$.fragment)},m(x,S){rt(e,x,S),s=!0},p(x,S){r=x;const C={};S[0]&2112|S[1]&16384&&(C.$$scope={dirty:S,ctx:r}),!n&&S[0]&2048&&(n=!0,C.lngLat=r[53].point,kr(()=>n=!1)),e.$set(C)},i(x){s||(_e(e.$$.fragment,x),s=!0)},o(x){Ie(e.$$.fragment,x),s=!1},d(x){st(e,x)}}}function NE(r){let e;return{c(){e=ue("span"),e.textContent=`${r[52]+1}`,He(e,"class","dot svelte-1cj4rwq"),Vr(e,"snapped",r[50].snapped)},m(n,s){ae(n,e,s)},p(n,s){s[0]&128&&Vr(e,"snapped",n[50].snapped)},d(n){n&&oe(e)}}}function e0(r){let e,n,s;function a(x){r[32](x,r[50])}function f(){return r[33](r[52])}function m(){return r[34](r[52])}let l={draggable:!0,zIndex:1,$$slots:{default:[NE]},$$scope:{ctx:r}};return r[50].point!==void 0&&(l.lngLat=r[50].point),e=new Zf({props:l}),Jn.push(()=>Ir(e,"lngLat",a)),e.$on("click",f),e.$on("contextmenu",m),e.$on("mouseenter",r[35]),e.$on("mouseleave",r[36]),e.$on("dragstart",r[25]),e.$on("dragend",r[37]),{c(){ot(e.$$.fragment)},m(x,S){rt(e,x,S),s=!0},p(x,S){r=x;const C={};S[0]&128|S[1]&16384&&(C.$$scope={dirty:S,ctx:r}),!n&&S[0]&128&&(n=!0,C.lngLat=r[50].point,kr(()=>n=!1)),e.$set(C)},i(x){s||(_e(e.$$.fragment,x),s=!0)},o(x){Ie(e.$$.fragment,x),s=!1},d(x){st(e,x)}}}function zE(r){let e,n;return e=new mr({props:{paint:{"line-color":"black","line-width":10}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p:tt,i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function OE(r){let e,n;return e=new mr({props:{paint:{"line-color":"black","line-width":3}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p:tt,i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function FE(r){let e,n,s,a,f,m,l,x,S,C;n=new Zv({}),n.$on("click",r[16]),n.$on("mousemove",r[17]);let L=Hn(r[11]),N=[];for(let $=0;$<L.length;$+=1)N[$]=Qy(Jy(r,L,$));const B=$=>Ie(N[$],1,1,()=>{N[$]=null});let U=Hn(r[7]),ee=[];for(let $=0;$<U.length;$+=1)ee[$]=e0(Yy(r,U,$));const ie=$=>Ie(ee[$],1,1,()=>{ee[$]=null});m=new rr({props:{data:r[20](r[8],r[7]),generateId:!0,$$slots:{default:[zE]},$$scope:{ctx:r}}}),x=new rr({props:{data:r[12],$$slots:{default:[OE]},$$scope:{ctx:r}}});const re=r[28]["extra-map"],Q=Zi(re,r,r[45],$y);return{c(){e=ue("div"),ot(n.$$.fragment),s=Be();for(let $=0;$<N.length;$+=1)N[$].c();a=Be();for(let $=0;$<ee.length;$+=1)ee[$].c();f=Be(),ot(m.$$.fragment),l=Be(),ot(x.$$.fragment),S=Be(),Q&&Q.c(),He(e,"slot","map")},m($,pe){ae($,e,pe),rt(n,e,null),Z(e,s);for(let ve=0;ve<N.length;ve+=1)N[ve]&&N[ve].m(e,null);Z(e,a);for(let ve=0;ve<ee.length;ve+=1)ee[ve]&&ee[ve].m(e,null);Z(e,f),rt(m,e,null),Z(e,l),rt(x,e,null),Z(e,S),Q&&Q.m(e,null),C=!0},p($,pe){if(pe[0]&14682176){L=Hn($[11]);let he;for(he=0;he<L.length;he+=1){const xe=Jy($,L,he);N[he]?(N[he].p(xe,pe),_e(N[he],1)):(N[he]=Qy(xe),N[he].c(),_e(N[he],1),N[he].m(e,a))}for(Nn(),he=L.length;he<N.length;he+=1)B(he);zn()}if(pe[0]&34341040){U=Hn($[7]);let he;for(he=0;he<U.length;he+=1){const xe=Yy($,U,he);ee[he]?(ee[he].p(xe,pe),_e(ee[he],1)):(ee[he]=e0(xe),ee[he].c(),_e(ee[he],1),ee[he].m(e,f))}for(Nn(),he=U.length;he<ee.length;he+=1)ie(he);zn()}const ve={};pe[0]&384&&(ve.data=$[20]($[8],$[7])),pe[1]&16384&&(ve.$$scope={dirty:pe,ctx:$}),m.$set(ve);const De={};pe[0]&4096&&(De.data=$[12]),pe[1]&16384&&(De.$$scope={dirty:pe,ctx:$}),x.$set(De),Q&&Q.p&&(!C||pe[1]&16384)&&Wi(Q,re,$,$[45],C?Hi(re,$[45],pe,CE):Xi($[45]),$y)},i($){if(!C){_e(n.$$.fragment,$);for(let pe=0;pe<L.length;pe+=1)_e(N[pe]);for(let pe=0;pe<U.length;pe+=1)_e(ee[pe]);_e(m.$$.fragment,$),_e(x.$$.fragment,$),_e(Q,$),C=!0}},o($){Ie(n.$$.fragment,$),N=N.filter(Boolean);for(let pe=0;pe<N.length;pe+=1)Ie(N[pe]);ee=ee.filter(Boolean);for(let pe=0;pe<ee.length;pe+=1)Ie(ee[pe]);Ie(m.$$.fragment,$),Ie(x.$$.fragment,$),Ie(Q,$),C=!1},d($){$&&oe(e),st(n),Sr(N,$),Sr(ee,$),st(m),st(x),Q&&Q.d($)}}}function BE(r){let e,n;const s=r[28]["extra-right"],a=Zi(s,r,r[45],Ky);return{c(){e=ue("div"),a&&a.c(),He(e,"slot","right")},m(f,m){ae(f,e,m),a&&a.m(e,null),n=!0},p(f,m){a&&a.p&&(!n||m[1]&16384)&&Wi(a,s,f,f[45],n?Hi(s,f[45],m,LE):Xi(f[45]),Ky)},i(f){n||(_e(a,f),n=!0)},o(f){Ie(a,f),n=!1},d(f){f&&oe(e),a&&a.d(f)}}}function UE(r){let e,n,s,a;return e=new gc({props:{$$slots:{right:[BE],map:[FE],left:[RE]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(f,m){rt(e,f,m),n=!0,s||(a=Pt(window,"keydown",r[24]),s=!0)},p(f,m){const l={};m[0]&16383|m[1]&16384&&(l.$$scope={dirty:m,ctx:f}),e.$set(l)},i(f){n||(_e(e.$$.fragment,f),n=!0)},o(f){Ie(e.$$.fragment,f),n=!1},d(f){st(e,f),s=!1,a()}}}function jE(r,e,n){let s,a,f,m;Ot(r,go,kt=>n(7,a=kt)),Ot(r,Qf,kt=>n(8,f=kt)),Ot(r,Fp,kt=>n(13,m=kt));let{$$slots:l={},$$scope:x}=e,{map:S}=e,{finish:C}=e,{cancel:L}=e,{deleteRoute:N}=e;vo(()=>{Dn(go,a=[],a),f==null||f.stop(),S.getCanvas().style.cursor="inherit"});let B="append-end",U="snap",ee=[],ie=[],re=null,Q=!1,$=!1,pe=!1;function ve(kt){let Vt=kt.length==0?"crosshair":"inherit";S.getCanvas().style.cursor=Vt}function De(){let kt=ee.pop();n(10,ee),kt&&Dn(go,a=kt,a)}function he(){ee.length==100&&ee.shift(),n(10,ee=[...ee,JSON.parse(JSON.stringify(a))])}function xe(){n(9,U=U=="snap"?"free":"snap"),re&&n(27,re.snapped=U=="snap",re)}function be(kt){he(),go.update(Vt=>(B=="append-start"?Vt.splice(0,0,{point:kt.detail.lngLat.toArray(),snapped:U=="snap"}):B=="append-end"&&Vt.push({point:kt.detail.lngLat.toArray(),snapped:U=="snap"}),Vt))}function Le(kt){n(27,re={point:kt.detail.lngLat.toArray(),snapped:U=="snap"})}function we(kt){he(),go.update(Vt=>(Vt[kt].snapped=!Vt[kt].snapped,Vt))}function ye(kt){he(),go.update(Vt=>(Vt.splice(kt,1),Vt)),n(4,Q=!1)}function Ue(kt,Vt){try{if(kt)return JSON.parse(kt.inner.calculateRoute(Vt))}catch{}return Af()}function Ve(kt,Vt,Ee,Gt,_n){if(_n)return Af();try{if(kt&&Vt.length>0&&Gt){if(Ee=="append-start")return JSON.parse(kt.inner.calculateRoute([Gt,Vt[0]]));if(Ee=="append-end")return JSON.parse(kt.inner.calculateRoute([Vt[Vt.length-1],Gt]))}}catch{}return Af()}function pt(kt,Vt,Ee,Gt){if(Gt)return;if(!kt||Ee!="adjust"){n(11,ie=[]);return}let _n=[],Kn=1;for(let Yi=0;Yi<Vt.length-1;Yi++){let xn=JSON.parse(kt.inner.getExtraNodes(Vt[Yi],Vt[Yi+1]));for(let[qi,Ji,Jr]of xn)_n.push({point:[qi,Ji],snapped:Jr,insertIdx:Kn});Kn++}n(11,ie=_n)}function St(kt){he(),go.update(Vt=>(Vt.splice(kt.insertIdx,0,{point:kt.point,snapped:kt.snapped}),Vt)),n(6,pe=!0)}function dt(kt){go.update(Vt=>(Vt[kt.insertIdx].point=kt.point,Vt))}function ut(){n(6,pe=!1)}function Bt(kt){let Vt=kt.target.tagName,Ee=Vt=="INPUT"||Vt=="TEXTAREA";kt.key==="Enter"&&!Ee?(kt.stopPropagation(),a.length>=2&&C()):kt.key==="Escape"?(kt.stopPropagation(),L()):kt.key=="s"&&!Ee?xe():kt.key=="1"&&!Ee?n(3,B="append-start"):kt.key=="2"&&!Ee?n(3,B="append-end"):kt.key=="3"&&!Ee?n(3,B="adjust"):kt.key=="z"&&kt.ctrlKey&&(kt.stopPropagation(),De())}function vt(){he(),n(5,$=!0)}const wt=[[],[]];function ft(kt,Vt){r.$$.not_equal(Vt.point,kt)&&(Vt.point=kt,n(11,ie))}const xt=kt=>St(kt),It=kt=>dt(kt);function Jt(kt,Vt){r.$$.not_equal(Vt.point,kt)&&(Vt.point=kt,go.set(a))}const pn=kt=>we(kt),Rn=kt=>ye(kt),Xe=()=>n(4,Q=!0),Wn=()=>n(4,Q=!1),dn=()=>n(5,$=!1);function Ft(){U=this.__value,n(9,U)}function Se(){U=this.__value,n(9,U)}function lt(){B=this.__value,n(3,B)}function Je(){B=this.__value,n(3,B)}function Lt(){B=this.__value,n(3,B)}function Ye(){m=this.checked,Fp.set(m)}return r.$$set=kt=>{"map"in kt&&n(26,S=kt.map),"finish"in kt&&n(0,C=kt.finish),"cancel"in kt&&n(1,L=kt.cancel),"deleteRoute"in kt&&n(2,N=kt.deleteRoute),"$$scope"in kt&&n(45,x=kt.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&456&&pt(f,a,B,pe),r.$$.dirty[0]&134218168&&n(12,s=Ve(f,a,B,re,Q||$)),r.$$.dirty[0]&128&&ve(a)},[C,L,N,B,Q,$,pe,a,f,U,ee,ie,s,m,De,xe,be,Le,we,ye,Ue,St,dt,ut,Bt,vt,S,re,l,ft,xt,It,Jt,pn,Rn,Xe,Wn,dn,Ft,wt,Se,lt,Je,Lt,Ye,x]}class VE extends fn{constructor(e){super(),hn(this,e,jE,UE,un,{map:26,finish:0,cancel:1,deleteRoute:2},null,[-1,-1])}}function qE(r,e,n){const s=r.slice();return s[16]=e[n][0],s[17]=e[n][1],s[18]=e[n][2],s}function t0(r){let e,n;return e=new rr({props:{data:r[5],$$slots:{default:[GE]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&32&&(f.data=s[5]),a&2097154&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function GE(r){let e,n;return e=new mr({props:{id:"routes",filter:r[1]==null?void 0:["!=",["id"],r[1]],paint:{"line-width":5,"line-color":ac,"line-opacity":.5}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&2&&(f.filter=s[1]==null?void 0:["!=",["id"],s[1]]),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function ZE(r){let e,n,s=r[5]&&t0(r);return{c(){e=ue("span"),s&&s.c(),He(e,"slot","extra-map")},m(a,f){ae(a,e,f),s&&s.m(e,null),n=!0},p(a,f){a[5]?s?(s.p(a,f),f&32&&_e(s,1)):(s=t0(a),s.c(),_e(s,1),s.m(e,null)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn())},i(a){n||(_e(s),n=!0)},o(a){Ie(s),n=!1},d(a){a&&oe(e),s&&s.d()}}}function HE(r){let e;return{c(){e=ue("option"),e.textContent=`${r[17]}`,e.__value=r[16],zi(e,e.__value)},m(n,s){ae(n,e,s)},p:tt,d(n){n&&oe(e)}}}function WE(r){let e,n,s,a,f,m,l,x,S,C,L,N,B,U,ee=Hn(rd),ie=[];for(let re=0;re<ee.length;re+=1)ie[re]=HE(qE(r,ee,re));return{c(){e=ue("div"),n=ue("label"),s=Oe(`Name:
      `),a=ue("input"),f=Be(),m=ue("label"),l=Oe(`Infrastructure type:
      `),x=ue("select");for(let re=0;re<ie.length;re+=1)ie[re].c();S=Be(),C=ue("label"),L=Oe(`Notes:
      `),N=ue("textarea"),He(a,"type","text"),r[4]===void 0&&Po(()=>r[10].call(x)),He(N,"rows","5"),He(e,"slot","extra-right")},m(re,Q){ae(re,e,Q),Z(e,n),Z(n,s),Z(n,a),zi(a,r[2]),Z(e,f),Z(e,m),Z(m,l),Z(m,x);for(let $=0;$<ie.length;$+=1)ie[$]&&ie[$].m(x,null);fs(x,r[4],!0),Z(e,S),Z(e,C),Z(C,L),Z(C,N),zi(N,r[3]),B||(U=[Pt(a,"input",r[9]),Pt(x,"change",r[10]),Pt(N,"input",r[11])],B=!0)},p(re,Q){Q&4&&a.value!==re[2]&&zi(a,re[2]),Q&16&&fs(x,re[4]),Q&8&&zi(N,re[3])},d(re){re&&oe(e),Sr(ie,re),B=!1,$i(U)}}}function XE(r){let e,n;return e=new VE({props:{map:r[0],finish:r[7],cancel:r[8],deleteRoute:r[6],$$slots:{"extra-right":[WE],"extra-map":[ZE]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,[a]){const f={};a&1&&(f.map=s[0]),a&2097214&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function $E(r,e,n){let s,a,f,m;Ot(r,Ni,$=>n(12,s=$)),Ot(r,sr,$=>n(13,a=$)),Ot(r,go,$=>n(14,f=$)),Ot(r,Qf,$=>n(15,m=$));let{map:l}=e,{id:x}=e,S="",C="",L="Unknown",N=null;cc(async()=>{if(n(5,N=await a.renderRoutes()),Dn(go,f=[],f),x!=null){let $=N.features.find(pe=>pe.id==x);n(2,S=$.properties.name),n(3,C=$.properties.notes),n(4,L=$.properties.infra_type),Dn(go,f=$.properties.waypoints.map(pe=>({point:[pe.lon,pe.lat],snapped:pe.snapped})),f)}});async function B(){x&&(await a.deleteRoute(x),await Dh()),Dn(Ni,s={kind:"main"},s)}async function U(){try{let $=JSON.parse(m.inner.calculateRoute(f));if(!$){window.alert("No route drawn");return}await a.setRoute(x,{feature:$,name:S,notes:C,nodes:$.properties.full_path,infra_type:L}),await Dh(),Dn(Ni,s={kind:"main"},s)}catch($){window.alert($)}}function ee(){Dn(Ni,s={kind:"main"},s)}function ie(){S=this.value,n(2,S)}function re(){L=_l(this),n(4,L)}function Q(){C=this.value,n(3,C)}return r.$$set=$=>{"map"in $&&n(0,l=$.map),"id"in $&&n(1,x=$.id)},[l,x,S,C,L,N,B,U,ee,ie,re,Q]}class YE extends fn{constructor(e){super(),hn(this,e,$E,XE,un,{map:0,id:1})}}function n0(r,e,n){const s=r.slice();return s[3]=e[n],s}function i0(r){let e,n,s,a=r[3].infra_type+"",f,m,l=r[3].name+"",x,S,C;return{c(){e=ue("li"),n=ue("a"),s=Oe("["),f=Oe(a),m=Oe("] "),x=Oe(l),C=Be(),He(n,"href",S=r[3].way),He(n,"target","_blank")},m(L,N){ae(L,e,N),Z(e,n),Z(n,s),Z(n,f),Z(n,m),Z(n,x),Z(e,C)},p(L,N){N&1&&a!==(a=L[3].infra_type+"")&&Mt(f,a),N&1&&l!==(l=L[3].name+"")&&Mt(x,l),N&1&&S!==(S=L[3].way)&&He(n,"href",S)},d(L){L&&oe(e)}}}function JE(r){let e,n,s,a=(r[0].route_length/r[0].direct_length).toFixed(1)+"",f,m,l,x,S,C,L=(r[0].route_length/r[0].car_length).toFixed(1)+"",N,B,U,ee,ie,re,Q,$,pe,ve=If(r[0],r[1])+"",De,he,xe,be,Le,we=Sf(r[0],r[1])+"",ye,Ue,Ve,pt,St,dt=If(r[0],r[2])+"",ut,Bt,vt,wt,ft,xt=Sf(r[0],r[2])+"",It,Jt,pn,Rn,Xe,Wn,dn,Ft,Se=Hn(r[0].directions),lt=[];for(let Je=0;Je<Se.length;Je+=1)lt[Je]=i0(n0(r,Se,Je));return{c(){e=ue("p"),n=Oe("Detour factor: "),s=ue("b"),f=Oe(a),m=Oe("x"),l=Oe(`
  longer than straight line`),x=Be(),S=ue("p"),C=ue("b"),N=Oe(L),B=Oe("x"),U=Oe(`
  longer than the driving route (in
  `),ee=ue("span"),ee.textContent="red",ie=Oe(`
  )`),re=Be(),Q=ue("hr"),$=Be(),pe=ue("p"),De=Oe(ve),he=Oe(" changes in infrastructure type"),xe=Be(),be=ue("p"),Le=Oe("By length: "),ye=Oe(we),Ue=Be(),Ve=ue("hr"),pt=Be(),St=ue("p"),ut=Oe(dt),Bt=Oe(" changes in level of service"),vt=Be(),wt=ue("p"),ft=Oe("By length: "),It=Oe(xt),Jt=Be(),pn=ue("hr"),Rn=Be(),Xe=ue("details"),Wn=ue("summary"),Wn.textContent="Route directions",dn=Be(),Ft=ue("ol");for(let Je=0;Je<lt.length;Je+=1)lt[Je].c();Un(ee,"color","red")},m(Je,Lt){ae(Je,e,Lt),Z(e,n),Z(e,s),Z(s,f),Z(s,m),Z(e,l),ae(Je,x,Lt),ae(Je,S,Lt),Z(S,C),Z(C,N),Z(C,B),Z(S,U),Z(S,ee),Z(S,ie),ae(Je,re,Lt),ae(Je,Q,Lt),ae(Je,$,Lt),ae(Je,pe,Lt),Z(pe,De),Z(pe,he),ae(Je,xe,Lt),ae(Je,be,Lt),Z(be,Le),Z(be,ye),ae(Je,Ue,Lt),ae(Je,Ve,Lt),ae(Je,pt,Lt),ae(Je,St,Lt),Z(St,ut),Z(St,Bt),ae(Je,vt,Lt),ae(Je,wt,Lt),Z(wt,ft),Z(wt,It),ae(Je,Jt,Lt),ae(Je,pn,Lt),ae(Je,Rn,Lt),ae(Je,Xe,Lt),Z(Xe,Wn),Z(Xe,dn),Z(Xe,Ft);for(let Ye=0;Ye<lt.length;Ye+=1)lt[Ye]&&lt[Ye].m(Ft,null)},p(Je,[Lt]){if(Lt&1&&a!==(a=(Je[0].route_length/Je[0].direct_length).toFixed(1)+"")&&Mt(f,a),Lt&1&&L!==(L=(Je[0].route_length/Je[0].car_length).toFixed(1)+"")&&Mt(N,L),Lt&1&&ve!==(ve=If(Je[0],Je[1])+"")&&Mt(De,ve),Lt&1&&we!==(we=Sf(Je[0],Je[1])+"")&&Mt(ye,we),Lt&1&&dt!==(dt=If(Je[0],Je[2])+"")&&Mt(ut,dt),Lt&1&&xt!==(xt=Sf(Je[0],Je[2])+"")&&Mt(It,xt),Lt&1){Se=Hn(Je[0].directions);let Ye;for(Ye=0;Ye<Se.length;Ye+=1){const kt=n0(Je,Se,Ye);lt[Ye]?lt[Ye].p(kt,Lt):(lt[Ye]=i0(kt),lt[Ye].c(),lt[Ye].m(Ft,null))}for(;Ye<lt.length;Ye+=1)lt[Ye].d(1);lt.length=Se.length}},i:tt,o:tt,d(Je){Je&&(oe(e),oe(x),oe(S),oe(re),oe(Q),oe($),oe(pe),oe(xe),oe(be),oe(Ue),oe(Ve),oe(pt),oe(St),oe(vt),oe(wt),oe(Jt),oe(pn),oe(Rn),oe(Xe)),Sr(lt,Je)}}}function If(r,e){let n=0;for(let s=0;s<r.directions.length-1;s++){let a=e(r.directions[s]),f=e(r.directions[s+1]);a!=f&&n++}return n}function Sf(r,e){let n={};for(let f of r.directions){let m=e(f);Object.hasOwn(n,m)||(n[m]=0),n[m]+=f.length}let s=0;for(let f of Object.values(n))s+=f;let a=[];for(let[f,m]of Object.entries(n).toSorted((l,x)=>x[1]-l[1])){let l=Math.round(m/s*100);a.push(`${l}% ${f}`)}return a.join(", ")}function KE(r,e,n){let{gj:s}=e,a=m=>m.infra_type,f=m=>m.los;return r.$$set=m=>{"gj"in m&&n(0,s=m.gj)},[s,a,f]}class QE extends fn{constructor(e){super(),hn(this,e,KE,JE,un,{gj:0})}}function r0(r){let e,n;return{c(){e=ue("p"),n=Oe(r[6])},m(s,a){ae(s,e,a),Z(e,n)},p(s,a){a&64&&Mt(n,s[6])},d(s){s&&oe(e)}}}function s0(r){let e,n;return e=new _c({props:{colors:tm}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function o0(r){let e,n;return e=new QE({props:{gj:r[5]}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&32&&(f.gj=s[5]),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function eT(r){let e,n,s,a,f,m,l,x,S,C,L,N,B,U,ee,ie,re,Q,$,pe=r[6]&&r0(r),ve=r[2]=="los"&&s0(),De=r[5]&&o0(r);return{c(){e=ue("div"),n=ue("h2"),n.textContent="Evaluate a route mode",s=Be(),a=ue("button"),a.textContent="Back",f=Be(),m=ue("p"),m.innerHTML=`Move the <b>A</b>
      and
      <b>B</b>
      pins to find a route. (Hint: right-click to set the first pin somewhere.)`,l=Be(),pe&&pe.c(),x=Be(),S=ue("label"),C=Oe(`Show details along route
      `),L=ue("select"),N=ue("option"),N.textContent="Just show route",B=ue("option"),B.textContent="Level of service",U=ue("option"),U.textContent="Infrastructure type",ee=Be(),ve&&ve.c(),ie=Be(),De&&De.c(),N.__value="",zi(N,N.__value),B.__value="los",zi(B,B.__value),U.__value="infra_type",zi(U,U.__value),r[2]===void 0&&Po(()=>r[17].call(L)),He(e,"slot","left")},m(he,xe){ae(he,e,xe),Z(e,n),Z(e,s),Z(e,a),Z(e,f),Z(e,m),Z(e,l),pe&&pe.m(e,null),Z(e,x),Z(e,S),Z(S,C),Z(S,L),Z(L,N),Z(L,B),Z(L,U),fs(L,r[2],!0),Z(e,ee),ve&&ve.m(e,null),Z(e,ie),De&&De.m(e,null),re=!0,Q||($=[Pt(a,"click",r[16]),Pt(L,"change",r[17])],Q=!0)},p(he,xe){he[6]?pe?pe.p(he,xe):(pe=r0(he),pe.c(),pe.m(e,x)):pe&&(pe.d(1),pe=null),xe&4&&fs(L,he[2]),he[2]=="los"?ve?xe&4&&_e(ve,1):(ve=s0(),ve.c(),_e(ve,1),ve.m(e,ie)):ve&&(Nn(),Ie(ve,1,1,()=>{ve=null}),zn()),he[5]?De?(De.p(he,xe),xe&32&&_e(De,1)):(De=o0(he),De.c(),_e(De,1),De.m(e,null)):De&&(Nn(),Ie(De,1,1,()=>{De=null}),zn())},i(he){re||(_e(ve),_e(De),re=!0)},o(he){Ie(ve),Ie(De),re=!1},d(he){he&&oe(e),pe&&pe.d(),ve&&ve.d(),De&&De.d(),Q=!1,$i($)}}}function tT(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function nT(r){let e,n;return e=new rr({props:{data:r[20],$$slots:{default:[iT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&256&&(f.data=s[20]),a&2097664&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function iT(r){let e,n;return e=new mr({props:{id:"routes",paint:{"line-width":5,"line-color":ac},layout:{visibility:r[9]?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&512&&(f.layout={visibility:s[9]?"visible":"none"}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function rT(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function a0(r){let e,n,s,a,f,m;function l(L){r[14](L)}let x={draggable:!0,$$slots:{default:[sT]},$$scope:{ctx:r}};r[4]!==void 0&&(x.lngLat=r[4]),e=new Zf({props:x}),Jn.push(()=>Ir(e,"lngLat",l));function S(L){r[15](L)}let C={draggable:!0,$$slots:{default:[oT]},$$scope:{ctx:r}};return r[3]!==void 0&&(C.lngLat=r[3]),a=new Zf({props:C}),Jn.push(()=>Ir(a,"lngLat",S)),{c(){ot(e.$$.fragment),s=Be(),ot(a.$$.fragment)},m(L,N){rt(e,L,N),ae(L,s,N),rt(a,L,N),m=!0},p(L,N){const B={};N&2097152&&(B.$$scope={dirty:N,ctx:L}),!n&&N&16&&(n=!0,B.lngLat=L[4],kr(()=>n=!1)),e.$set(B);const U={};N&2097152&&(U.$$scope={dirty:N,ctx:L}),!f&&N&8&&(f=!0,U.lngLat=L[3],kr(()=>f=!1)),a.$set(U)},i(L){m||(_e(e.$$.fragment,L),_e(a.$$.fragment,L),m=!0)},o(L){Ie(e.$$.fragment,L),Ie(a.$$.fragment,L),m=!1},d(L){L&&oe(s),st(e,L),st(a,L)}}}function sT(r){let e;return{c(){e=ue("span"),e.textContent="A",He(e,"class","dot svelte-1ej0v4r")},m(n,s){ae(n,e,s)},p:tt,d(n){n&&oe(e)}}}function oT(r){let e;return{c(){e=ue("span"),e.textContent="B",He(e,"class","dot svelte-1ej0v4r")},m(n,s){ae(n,e,s)},p:tt,d(n){n&&oe(e)}}}function l0(r){let e,n;return e=new rr({props:{data:r[5],generateId:!0,$$slots:{default:[aT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&32&&(f.data=s[5]),a&2097156&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function aT(r){let e,n,s,a;return e=new mr({props:{filter:["!",["has","car_route"]],paint:{"line-width":20,"line-color":r[2]==""?"cyan":r[2]=="los"?Bp:ac,"line-opacity":Ms(.5,1)},manageHoverState:!0}}),s=new mr({props:{filter:["has","car_route"],paint:{"line-width":10,"line-color":"red","line-opacity":Ms(.5,1)},manageHoverState:!0}}),{c(){ot(e.$$.fragment),n=Be(),ot(s.$$.fragment)},m(f,m){rt(e,f,m),ae(f,n,m),rt(s,f,m),a=!0},p(f,m){const l={};m&4&&(l.paint={"line-width":20,"line-color":f[2]==""?"cyan":f[2]=="los"?Bp:ac,"line-opacity":Ms(.5,1)}),e.$set(l)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(n),st(e,f),st(s,f)}}}function lT(r){let e,n,s,a,f,m,l;n=new Zv({}),n.$on("contextmenu",r[10]);let x={ctx:r,current:null,token:null,hasCatch:!1,pending:rT,then:nT,catch:tT,value:20,blocks:[,,,]};gs(a=wl(r[8]).renderRoutes(),x);let S=r[4]&&r[3]&&a0(r),C=r[5]&&l0(r);return{c(){e=ue("div"),ot(n.$$.fragment),s=Be(),x.block.c(),f=Be(),S&&S.c(),m=Be(),C&&C.c(),He(e,"slot","map")},m(L,N){ae(L,e,N),rt(n,e,null),Z(e,s),x.block.m(e,x.anchor=null),x.mount=()=>e,x.anchor=f,Z(e,f),S&&S.m(e,null),Z(e,m),C&&C.m(e,null),l=!0},p(L,N){r=L,x.ctx=r,N&256&&a!==(a=wl(r[8]).renderRoutes())&&gs(a,x)||kl(x,r,N),r[4]&&r[3]?S?(S.p(r,N),N&24&&_e(S,1)):(S=a0(r),S.c(),_e(S,1),S.m(e,m)):S&&(Nn(),Ie(S,1,1,()=>{S=null}),zn()),r[5]?C?(C.p(r,N),N&32&&_e(C,1)):(C=l0(r),C.c(),_e(C,1),C.m(e,null)):C&&(Nn(),Ie(C,1,1,()=>{C=null}),zn())},i(L){l||(_e(n.$$.fragment,L),_e(x.block),_e(S),_e(C),l=!0)},o(L){Ie(n.$$.fragment,L);for(let N=0;N<3;N+=1){const B=x.blocks[N];Ie(B)}Ie(S),Ie(C),l=!1},d(L){L&&oe(e),st(n),x.block.d(),x.token=null,x=null,S&&S.d(),C&&C.d()}}}function u0(r){let e,n,s,a,f,m,l,x=r[1]+1+"",S,C,L=r[0].length+"",N,B,U,ee,ie,re,Q;return{c(){e=ue("p"),e.textContent="These routes, from a sample of the OD data, have the worst directness.",n=Be(),s=ue("div"),a=ue("button"),f=Oe("Previous"),l=Be(),S=Oe(x),C=Oe(" / "),N=Oe(L),B=Be(),U=ue("button"),ee=Oe("Next"),He(a,"class","secondary"),a.disabled=m=r[1]==0,He(U,"class","secondary"),U.disabled=ie=r[1]==r[0].length-1},m($,pe){ae($,e,pe),ae($,n,pe),ae($,s,pe),Z(s,a),Z(a,f),Z(s,l),Z(s,S),Z(s,C),Z(s,N),Z(s,B),Z(s,U),Z(U,ee),re||(Q=[Pt(a,"click",r[12]),Pt(U,"click",r[13])],re=!0)},p($,pe){pe&2&&m!==(m=$[1]==0)&&(a.disabled=m),pe&2&&x!==(x=$[1]+1+"")&&Mt(S,x),pe&1&&L!==(L=$[0].length+"")&&Mt(N,L),pe&3&&ie!==(ie=$[1]==$[0].length-1)&&(U.disabled=ie)},d($){$&&(oe(e),oe(n),oe(s)),re=!1,$i(Q)}}}function uT(r){let e,n=r[0].length>0&&u0(r);return{c(){e=ue("div"),n&&n.c(),He(e,"slot","right")},m(s,a){ae(s,e,a),n&&n.m(e,null)},p(s,a){s[0].length>0?n?n.p(s,a):(n=u0(s),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},d(s){s&&oe(e),n&&n.d()}}}function cT(r){let e,n,s,a;return e=new gc({props:{$$slots:{right:[uT],map:[lT],left:[eT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(f,m){rt(e,f,m),n=!0,s||(a=Pt(window,"keydown",r[11]),s=!0)},p(f,[m]){const l={};m&2098175&&(l.$$scope={dirty:m,ctx:f}),e.$set(l)},i(f){n||(_e(e.$$.fragment,f),n=!0)},o(f){Ie(e.$$.fragment,f),n=!1},d(f){st(e,f),s=!1,a()}}}function hT(r,e,n){let s,a,f,m,l;Ot(r,Ni,he=>n(7,s=he)),Ot(r,Sh,he=>n(3,a=he)),Ot(r,Ju,he=>n(4,f=he)),Ot(r,sr,he=>n(8,m=he)),Ot(r,Op,he=>n(9,l=he));let{browse:x}=e,S=0,C=null,L="",N="los";async function B(he,xe,be=""){try{n(5,C=await m.evaluateRoute({start:he,end:[xe.lng,xe.lat],breakdown:be})),n(6,L="")}catch(Le){n(5,C=null),n(6,L=Le.toString())}}function U(he){Dn(Ju,f=he.detail.lngLat,f)}async function ee(he){if(x.length==0)return;let xe=x[he];Dn(Ju,f={lng:xe[0].x,lat:xe[0].y},f),Dn(Sh,a={lng:xe[1].x,lat:xe[1].y},a),B(f,a,N)}function ie(he){he.key==="Escape"&&(he.stopPropagation(),Dn(Ni,s={kind:"main"},s))}const re=()=>n(1,S--,S),Q=()=>n(1,S++,S);function $(he){f=he,Ju.set(f)}function pe(he){a=he,Sh.set(a)}const ve=()=>Dn(Ni,s={kind:"main"},s);function De(){N=_l(this),n(2,N)}return r.$$set=he=>{"browse"in he&&n(0,x=he.browse)},r.$$.update=()=>{r.$$.dirty&28&&B(f,a,N),r.$$.dirty&2&&ee(S)},[x,S,N,a,f,C,L,s,m,l,U,ie,re,Q,$,pe,ve,De]}class fT extends fn{constructor(e){super(),hn(this,e,hT,cT,un,{browse:0})}}function wr(r,e){return e==0?"0%":`${Math.round(r/e*100)}%`}function ed(r){return r.reduce((e,n)=>e+n,0)}function td(r){return["interpolate",["linear"],["zoom"],12,["*",2.1,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]],14,["*",5.25,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]],15,["*",7.5,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]],16,["*",18,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]],18,["*",52.5,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",r],.0021]]]]]]]]}function nm(r){return["step",["get",r],"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function c0(r,e,n){const s=r.slice();return s[5]=e[n][0],s[6]=e[n][1],s}function h0(r){let e,n=r[0].succeeded.toLocaleString()+"",s,a,f=r[0].failed.toLocaleString()+"",m,l,x,S,C,L=r[0].max_count.toLocaleString()+"",N,B,U,ee,ie,re,Q,$=(100*r[0].percent_off_network).toFixed(1)+"",pe,ve,De,he=Hn(Object.entries(r[0].percent_on_network)),xe=[];for(let be=0;be<he.length;be+=1)xe[be]=f0(c0(r,he,be));return{c(){e=ue("p"),s=Oe(n),a=Oe(" routes succeeded, "),m=Oe(f),l=Oe(`
        failed`),x=Be(),S=ue("p"),C=Oe("Highest count on any one road is "),N=Oe(L),B=Be(),U=ue("p"),U.textContent="Percent of demand by infrastructure type:",ee=Be(),ie=ue("ul"),re=ue("li"),Q=Oe("Off the network: "),pe=Oe($),ve=Oe("%"),De=Be();for(let be=0;be<xe.length;be+=1)xe[be].c()},m(be,Le){ae(be,e,Le),Z(e,s),Z(e,a),Z(e,m),Z(e,l),ae(be,x,Le),ae(be,S,Le),Z(S,C),Z(S,N),ae(be,B,Le),ae(be,U,Le),ae(be,ee,Le),ae(be,ie,Le),Z(ie,re),Z(re,Q),Z(re,pe),Z(re,ve),Z(ie,De);for(let we=0;we<xe.length;we+=1)xe[we]&&xe[we].m(ie,null)},p(be,Le){if(Le&1&&n!==(n=be[0].succeeded.toLocaleString()+"")&&Mt(s,n),Le&1&&f!==(f=be[0].failed.toLocaleString()+"")&&Mt(m,f),Le&1&&L!==(L=be[0].max_count.toLocaleString()+"")&&Mt(N,L),Le&1&&$!==($=(100*be[0].percent_off_network).toFixed(1)+"")&&Mt(pe,$),Le&1){he=Hn(Object.entries(be[0].percent_on_network));let we;for(we=0;we<he.length;we+=1){const ye=c0(be,he,we);xe[we]?xe[we].p(ye,Le):(xe[we]=f0(ye),xe[we].c(),xe[we].m(ie,null))}for(;we<xe.length;we+=1)xe[we].d(1);xe.length=he.length}},d(be){be&&(oe(e),oe(x),oe(S),oe(B),oe(U),oe(ee),oe(ie)),Sr(xe,be)}}}function f0(r){let e,n=r[5]+"",s,a,f=(100*r[6]).toFixed(1)+"",m,l;return{c(){e=ue("li"),s=Oe(n),a=Oe(": "),m=Oe(f),l=Oe("%")},m(x,S){ae(x,e,S),Z(e,s),Z(e,a),Z(e,m),Z(e,l)},p(x,S){S&1&&n!==(n=x[5]+"")&&Mt(s,n),S&1&&f!==(f=(100*x[6]).toFixed(1)+"")&&Mt(m,f)},d(x){x&&oe(e)}}}function dT(r){let e,n,s,a,f,m,l,x=r[0]&&h0(r);return{c(){e=ue("div"),n=ue("h2"),n.textContent="Evaluate OD mode",s=Be(),a=ue("button"),a.textContent="Back",f=Be(),x&&x.c(),He(e,"slot","left")},m(S,C){ae(S,e,C),Z(e,n),Z(e,s),Z(e,a),Z(e,f),x&&x.m(e,null),m||(l=Pt(a,"click",r[2]),m=!0)},p(S,C){S[0]?x?x.p(S,C):(x=h0(S),x.c(),x.m(e,null)):x&&(x.d(1),x=null)},d(S){S&&oe(e),x&&x.d(),m=!1,l()}}}function d0(r){let e,n;return e=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[gT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&1&&(f.data=s[0]),a&512&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function pT(r){let e=r[4].count+"",n,s,a=r[4].infra_type+"",f;return{c(){n=Oe(e),s=Oe(" on "),f=Oe(a)},m(m,l){ae(m,n,l),ae(m,s,l),ae(m,f,l)},p(m,l){l&16&&e!==(e=m[4].count+"")&&Mt(n,e),l&16&&a!==(a=m[4].infra_type+"")&&Mt(f,a)},d(m){m&&(oe(n),oe(s),oe(f))}}}function mT(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[pT,({props:s})=>({4:s}),({props:s})=>s?16:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&528&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function gT(r){let e,n;return e=new mr({props:{paint:{"line-width":td("count"),"line-color":nm("count")},manageHoverState:!0,eventsIfTopMost:!0,$$slots:{default:[mT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&512&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function _T(r){let e,n,s=r[0]&&d0(r);return{c(){e=ue("div"),s&&s.c(),He(e,"slot","map")},m(a,f){ae(a,e,f),s&&s.m(e,null),n=!0},p(a,f){a[0]?s?(s.p(a,f),f&1&&_e(s,1)):(s=d0(a),s.c(),_e(s,1),s.m(e,null)):s&&(Nn(),Ie(s,1,1,()=>{s=null}),zn())},i(a){n||(_e(s),n=!0)},o(a){Ie(s),n=!1},d(a){a&&oe(e),s&&s.d()}}}function yT(r){let e,n;return e=new gc({props:{$$slots:{map:[_T],left:[dT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,[a]){const f={};a&515&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function vT(r,e,n){let s,a;Ot(r,sr,l=>n(3,s=l)),Ot(r,Ni,l=>n(1,a=l));let f=null;return cc(async()=>{n(0,f=await s.evaluateOD())}),[f,a,()=>Dn(Ni,a={kind:"main"},a)]}class bT extends fn{constructor(e){super(),hn(this,e,vT,yT,un,{})}}function xT(r){let e;return{c(){e=ue("ul"),e.innerHTML=`<li>Long distance routes connect EDJ reachable settlements out with main
          urban areas.</li> <li>Settlements should be connected by high demand routes forming a direct
          connection in most cases.</li> <li>Long distance routes should connect directly to primary routes within
          each settlement.</li> <li>Consider SIMD/transport poverty</li> <li>In limited circumstances, settlement can be connected by less
          direct/more scenic routes (NCN)</li>`},m(n,s){ae(n,e,s)},d(n){n&&oe(e)}}}function wT(r){let e;return{c(){e=ue("p"),e.textContent=`To draw the local access route, connect schools, GPs, hospitals, green
        spaces, neighbourhoods (especially deprived and densely populated ones),
        and above-minimum cycling flow routes on the base map.`},m(n,s){ae(n,e,s)},d(n){n&&oe(e)}}}function kT(r){let e;return{c(){e=ue("p"),e.textContent=`To draw the secondary route, please connect town centres and cover
        medium cycling flow routes on the base map.`},m(n,s){ae(n,e,s)},d(n){n&&oe(e)}}}function IT(r){let e;return{c(){e=ue("p"),e.textContent=`The primary route should be direct, coherent, meet high demand, and
        potentially connect settlements. Key primary routes will form Active
        Freeways. To draw the primary route, connect the high cycling flow
        routes on the base map.`},m(n,s){ae(n,e,s)},d(n){n&&oe(e)}}}function ST(r){let e;function n(f,m){if(f[0]=="primary")return IT;if(f[0]=="secondary")return kT;if(f[0]=="local access")return wT;if(f[0]=="long distance")return xT}let s=n(r),a=s&&s(r);return{c(){a&&a.c(),e=ni()},m(f,m){a&&a.m(f,m),ae(f,e,m)},p(f,m){s!==(s=n(f))&&(a&&a.d(1),a=s&&s(f),a&&(a.c(),a.m(e.parentNode,e)))},d(f){f&&oe(e),a&&a.d(f)}}}function ET(r){let e,n,s,a,f,m,l,x,S,C,L,N,B;return C=new Jv({props:{$$slots:{default:[ST]},$$scope:{ctx:r}}}),{c(){e=ue("div"),n=ue("button"),n.textContent="Primary routes",s=Be(),a=ue("button"),a.textContent="Secondary routes",f=Be(),m=ue("button"),m.textContent="Local access routes",l=Be(),x=ue("button"),x.textContent="Long distance routes",S=Be(),ot(C.$$.fragment),He(n,"class","svelte-gv50c1"),Un(n,"background",r[0]=="primary"?ds.primaryRoutes:"grey"),He(a,"class","svelte-gv50c1"),Un(a,"background",r[0]=="secondary"?ds.secondaryRoutes:"grey"),He(m,"class","svelte-gv50c1"),Un(m,"background",r[0]=="local access"?ds.localAccessRoutes:"grey"),He(x,"class","svelte-gv50c1"),Un(x,"background",r[0]=="long distance"?ds.longDistanceRoutes:"grey"),He(e,"class","svelte-gv50c1")},m(U,ee){ae(U,e,ee),Z(e,n),Z(e,s),Z(e,a),Z(e,f),Z(e,m),Z(e,l),Z(e,x),Z(e,S),rt(C,e,null),L=!0,N||(B=[Pt(n,"click",r[1]),Pt(a,"click",r[2]),Pt(m,"click",r[3]),Pt(x,"click",r[4])],N=!0)},p(U,[ee]){ee&1&&Un(n,"background",U[0]=="primary"?ds.primaryRoutes:"grey"),ee&1&&Un(a,"background",U[0]=="secondary"?ds.secondaryRoutes:"grey"),ee&1&&Un(m,"background",U[0]=="local access"?ds.localAccessRoutes:"grey"),ee&1&&Un(x,"background",U[0]=="long distance"?ds.longDistanceRoutes:"grey");const ie={};ee&33&&(ie.$$scope={dirty:ee,ctx:U}),C.$set(ie)},i(U){L||(_e(C.$$.fragment,U),L=!0)},o(U){Ie(C.$$.fragment,U),L=!1},d(U){U&&oe(e),st(C),N=!1,$i(B)}}}function TT(r,e,n){let s;return Ot(r,eu,x=>n(0,s=x)),[s,()=>Dn(eu,s="primary",s),()=>Dn(eu,s="secondary",s),()=>Dn(eu,s="local access",s),()=>Dn(eu,s="long distance",s)]}class CT extends fn{constructor(e){super(),hn(this,e,TT,ET,un,{})}}function LT(r){let e,n;const s=r[3].default,a=Zi(s,r,r[2],null);return{c(){e=ue("div"),a&&a.c()},m(f,m){ae(f,e,m),a&&a.m(e,null),r[4](e),n=!0},p(f,[m]){a&&a.p&&(!n||m&4)&&Wi(a,s,f,f[2],n?Hi(s,f[2],m,null):Xi(f[2]),null)},i(f){n||(_e(a,f),n=!0)},o(f){Ie(a,f),n=!1},d(f){f&&oe(e),a&&a.d(f),r[4](null)}}}function MT(r,e,n){let{$$slots:s={},$$scope:a}=e,{name:f}=e,m=null;function l(x){Jn[x?"unshift":"push"](()=>{m=x,n(0,m)})}return r.$$set=x=>{"name"in x&&n(1,f=x.name),"$$scope"in x&&n(2,a=x.$$scope)},r.$$.update=()=>{r.$$.dirty&3&&m&&Yv.update(x=>(x.set(f,m),x))},[m,f,a,s,l]}class to extends fn{constructor(e){super(),hn(this,e,MT,LT,un,{name:1})}}function p0(r){let e,n,s;return{c(){e=ue("button"),e.textContent="Import existing routes",He(e,"class","outline")},m(a,f){ae(a,e,f),n||(s=Pt(e,"click",r[6]),n=!0)},p:tt,d(a){a&&oe(e),n=!1,s()}}}function AT(r){let e,n,s,a,f,m,l,x=r[0]&&p0(r);return{c(){e=ue("label"),n=ue("input"),s=Oe(`
    Existing network`),a=Be(),x&&x.c(),f=ni(),He(n,"type","checkbox")},m(S,C){ae(S,e,C),Z(e,n),n.checked=r[0],Z(e,s),ae(S,a,C),x&&x.m(S,C),ae(S,f,C),m||(l=Pt(n,"change",r[5]),m=!0)},p(S,C){C&1&&(n.checked=S[0]),S[0]?x?x.p(S,C):(x=p0(S),x.c(),x.m(f.parentNode,f)):x&&(x.d(1),x=null)},d(S){S&&(oe(e),oe(a),oe(f)),x&&x.d(S),m=!1,l()}}}function m0(r){let e,n;return e=new Hv({props:{$$slots:{default:[PT]},$$scope:{ctx:r}}}),e.$on("close",r[8]),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&4100&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function PT(r){let e,n,s,a,f,m,l,x,S;return{c(){e=ue("h2"),e.textContent="Import existing routes from OpenStreetMap",n=Be(),s=ue("p"),a=Oe(`This will add existing routes to your network. Only Segregated Tracks
      (wide and narrow) and Off Road Cycleways will be imported; other
      infrastructure types are not high-quality enough in practice to be
      considered part of the network. OpenStreetMap data and this tool's
      interpretation of it are imperfect, so please check the results carefully
      and remove / adjust any errors.

      `),f=ue("button"),f.textContent="Import existing routes",m=Be(),l=ue("button"),l.textContent="Cancel",He(l,"class","secondary")},m(C,L){ae(C,e,L),ae(C,n,L),ae(C,s,L),Z(s,a),Z(s,f),Z(s,m),Z(s,l),x||(S=[Pt(f,"click",r[4]),Pt(l,"click",r[7])],x=!0)},p:tt,d(C){C&&(oe(e),oe(n),oe(s)),x=!1,$i(S)}}}function g0(r){let e,n,s,a={ctx:r,current:null,token:null,hasCatch:!1,pending:FT,then:DT,catch:RT,value:10,blocks:[,,,]};return gs(n=r[3].classifyExistingNetwork(),a),{c(){e=ni(),a.block.c()},m(f,m){ae(f,e,m),a.block.m(f,a.anchor=m),a.mount=()=>e.parentNode,a.anchor=e,s=!0},p(f,m){r=f,a.ctx=r,m&8&&n!==(n=r[3].classifyExistingNetwork())&&gs(n,a)||kl(a,r,m)},i(f){s||(_e(a.block),s=!0)},o(f){for(let m=0;m<3;m+=1){const l=a.blocks[m];Ie(l)}s=!1},d(f){f&&oe(e),a.block.d(f),a.token=null,a=null}}}function RT(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function DT(r){let e,n;return e=new rr({props:{data:r[10],generateId:!0,$$slots:{default:[OT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&8&&(f.data=s[10]),a&4097&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function NT(r){let e=oc[r[11].infra_type][0]+"",n;return{c(){n=Oe(e)},m(s,a){ae(s,n,a)},p(s,a){a&2048&&e!==(e=oc[s[11].infra_type][0]+"")&&Mt(n,e)},d(s){s&&oe(n)}}}function zT(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[NT,({props:s})=>({11:s}),({props:s})=>s?2048:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&6144&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function OT(r){let e,n;return e=new mr({props:{layout:{visibility:r[0]?"visible":"none"},paint:{"line-width":Ms(5,7),"line-color":ac,"line-opacity":.8},manageHoverState:!0,$$slots:{default:[zT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&1&&(f.layout={visibility:s[0]?"visible":"none"}),a&4096&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function FT(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function BT(r){let e,n,s,a,f;e=new to({props:{name:"existing network",$$slots:{default:[AT]},$$scope:{ctx:r}}});let m=r[2]&&m0(r),l=r[3]&&r[1]&&g0(r);return{c(){ot(e.$$.fragment),n=Be(),m&&m.c(),s=Be(),l&&l.c(),a=ni()},m(x,S){rt(e,x,S),ae(x,n,S),m&&m.m(x,S),ae(x,s,S),l&&l.m(x,S),ae(x,a,S),f=!0},p(x,[S]){const C={};S&4101&&(C.$$scope={dirty:S,ctx:x}),e.$set(C),x[2]?m?(m.p(x,S),S&4&&_e(m,1)):(m=m0(x),m.c(),_e(m,1),m.m(s.parentNode,s)):m&&(Nn(),Ie(m,1,1,()=>{m=null}),zn()),x[3]&&x[1]?l?(l.p(x,S),S&10&&_e(l,1)):(l=g0(x),l.c(),_e(l,1),l.m(a.parentNode,a)):l&&(Nn(),Ie(l,1,1,()=>{l=null}),zn())},i(x){f||(_e(e.$$.fragment,x),_e(m),_e(l),f=!0)},o(x){Ie(e.$$.fragment,x),Ie(m),Ie(l),f=!1},d(x){x&&(oe(n),oe(s),oe(a)),st(e,x),m&&m.d(x),l&&l.d(x)}}}function UT(r,e,n){let s,a;Ot(r,Rh,B=>n(9,s=B)),Ot(r,sr,B=>n(3,a=B));let f=!1,m=!1,l=!1;async function x(){if(n(2,l=!1),a){let B=a.importExistingRoutes(),U=B==1?"route segment":"route segments";await Dh(),Dn(Rh,s+=1,s),window.alert(`Imported ${B} ${U}`),n(0,f=!1)}}function S(){f=this.checked,n(0,f)}const C=()=>n(2,l=!0),L=()=>n(2,l=!1),N=()=>n(2,l=!1);return r.$$.update=()=>{r.$$.dirty&1&&f&&n(1,m=!0)},[f,m,l,a,x,S,C,L,N]}class jT extends fn{constructor(e){super(),hn(this,e,UT,BT,un,{})}}function _0(r,e,n){const s=r.slice();return s[17]=e[n][0],s[18]=e[n][1],s}function y0(r,e,n){const s=r.slice();return s[17]=e[n][0],s[18]=e[n][1],s}function v0(r,e,n){const s=r.slice();return s[17]=e[n][0],s[18]=e[n][1],s}function b0(r,e,n){const s=r.slice();return s[17]=e[n][0],s[18]=e[n][1],s}function x0(r,e,n){const s=r.slice();return s[17]=e[n][0],s[18]=e[n][1],s}function w0(r,e,n){const s=r.slice();return s[17]=e[n][0],s[18]=e[n][1],s}function k0(r){let e,n,s,a,f,m,l,x,S,C,L,N,B,U,ee,ie,re,Q=Hn(r[7]),$=[];for(let Le=0;Le<Q.length;Le+=1)$[Le]=I0(w0(r,Q,Le));let pe=Hn(r[8]),ve=[];for(let Le=0;Le<pe.length;Le+=1)ve[Le]=S0(x0(r,pe,Le));let De=Hn(r[9]),he=[];for(let Le=0;Le<De.length;Le+=1)he[Le]=E0(b0(r,De,Le));let xe=Hn(r[10]),be=[];for(let Le=0;Le<xe.length;Le+=1)be[Le]=T0(v0(r,xe,Le));return{c(){e=ue("label"),n=Oe(`Trip purpose:
      `),s=ue("select");for(let Le=0;Le<$.length;Le+=1)$[Le].c();a=Be(),f=ue("label"),m=Oe(`Scenario:
      `),l=ue("select");for(let Le=0;Le<ve.length;Le+=1)ve[Le].c();x=Be(),S=ue("label"),C=Oe(`Network type:
      `),L=ue("select");for(let Le=0;Le<he.length;Le+=1)he[Le].c();N=Be(),B=ue("label"),U=Oe(`Color by:
      `),ee=ue("select");for(let Le=0;Le<be.length;Le+=1)be[Le].c();r[0]===void 0&&Po(()=>r[12].call(s)),r[1]===void 0&&Po(()=>r[13].call(l)),r[2]===void 0&&Po(()=>r[14].call(L)),r[3]===void 0&&Po(()=>r[15].call(ee))},m(Le,we){ae(Le,e,we),Z(e,n),Z(e,s);for(let ye=0;ye<$.length;ye+=1)$[ye]&&$[ye].m(s,null);fs(s,r[0],!0),ae(Le,a,we),ae(Le,f,we),Z(f,m),Z(f,l);for(let ye=0;ye<ve.length;ye+=1)ve[ye]&&ve[ye].m(l,null);fs(l,r[1],!0),ae(Le,x,we),ae(Le,S,we),Z(S,C),Z(S,L);for(let ye=0;ye<he.length;ye+=1)he[ye]&&he[ye].m(L,null);fs(L,r[2],!0),ae(Le,N,we),ae(Le,B,we),Z(B,U),Z(B,ee);for(let ye=0;ye<be.length;ye+=1)be[ye]&&be[ye].m(ee,null);fs(ee,r[3],!0),ie||(re=[Pt(s,"change",r[12]),Pt(l,"change",r[13]),Pt(L,"change",r[14]),Pt(ee,"change",r[15])],ie=!0)},p(Le,we){if(we[0]&128){Q=Hn(Le[7]);let ye;for(ye=0;ye<Q.length;ye+=1){const Ue=w0(Le,Q,ye);$[ye]?$[ye].p(Ue,we):($[ye]=I0(Ue),$[ye].c(),$[ye].m(s,null))}for(;ye<$.length;ye+=1)$[ye].d(1);$.length=Q.length}if(we[0]&129&&fs(s,Le[0]),we[0]&256){pe=Hn(Le[8]);let ye;for(ye=0;ye<pe.length;ye+=1){const Ue=x0(Le,pe,ye);ve[ye]?ve[ye].p(Ue,we):(ve[ye]=S0(Ue),ve[ye].c(),ve[ye].m(l,null))}for(;ye<ve.length;ye+=1)ve[ye].d(1);ve.length=pe.length}if(we[0]&258&&fs(l,Le[1]),we[0]&512){De=Hn(Le[9]);let ye;for(ye=0;ye<De.length;ye+=1){const Ue=b0(Le,De,ye);he[ye]?he[ye].p(Ue,we):(he[ye]=E0(Ue),he[ye].c(),he[ye].m(L,null))}for(;ye<he.length;ye+=1)he[ye].d(1);he.length=De.length}if(we[0]&516&&fs(L,Le[2]),we[0]&1024){xe=Hn(Le[10]);let ye;for(ye=0;ye<xe.length;ye+=1){const Ue=v0(Le,xe,ye);be[ye]?be[ye].p(Ue,we):(be[ye]=T0(Ue),be[ye].c(),be[ye].m(ee,null))}for(;ye<be.length;ye+=1)be[ye].d(1);be.length=xe.length}we[0]&1032&&fs(ee,Le[3])},d(Le){Le&&(oe(e),oe(a),oe(f),oe(x),oe(S),oe(N),oe(B)),Sr($,Le),Sr(ve,Le),Sr(he,Le),Sr(be,Le),ie=!1,$i(re)}}}function I0(r){let e,n=r[18]+"",s;return{c(){e=ue("option"),s=Oe(n),e.__value=r[17],zi(e,e.__value)},m(a,f){ae(a,e,f),Z(e,s)},p:tt,d(a){a&&oe(e)}}}function S0(r){let e,n=r[18]+"",s;return{c(){e=ue("option"),s=Oe(n),e.__value=r[17],zi(e,e.__value)},m(a,f){ae(a,e,f),Z(e,s)},p:tt,d(a){a&&oe(e)}}}function E0(r){let e,n=r[18]+"",s;return{c(){e=ue("option"),s=Oe(n),e.__value=r[17],zi(e,e.__value)},m(a,f){ae(a,e,f),Z(e,s)},p:tt,d(a){a&&oe(e)}}}function T0(r){let e,n=r[18]+"",s;return{c(){e=ue("option"),s=Oe(n),e.__value=r[17],zi(e,e.__value)},m(a,f){ae(a,e,f),Z(e,s)},p:tt,d(a){a&&oe(e)}}}function VT(r){let e,n,s,a,f,m,l,x=r[5]&&k0(r);return{c(){e=ue("label"),n=ue("input"),s=Oe(`
    Route network`),a=Be(),x&&x.c(),f=ni(),He(n,"type","checkbox")},m(S,C){ae(S,e,C),Z(e,n),n.checked=r[5],Z(e,s),ae(S,a,C),x&&x.m(S,C),ae(S,f,C),m||(l=Pt(n,"change",r[11]),m=!0)},p(S,C){C[0]&32&&(n.checked=S[5]),S[5]?x?x.p(S,C):(x=k0(S),x.c(),x.m(f.parentNode,f)):x&&(x.d(1),x=null)},d(S){S&&(oe(e),oe(a),oe(f)),x&&x.d(S),m=!1,l()}}}function C0(r){let e,n,s,a,f=r[16][`${r[17]}_fastest_bicycle`].toLocaleString()+"",m,l,x,S=r[16][`${r[17]}_fastest_bicycle_go_dutch`].toLocaleString()+"",C,L,N,B=r[16][`${r[17]}_fastest_bicycle_ebike`].toLocaleString()+"",U,ee;return{c(){e=ue("tr"),n=ue("th"),n.textContent=`${r[18]}`,s=Be(),a=ue("td"),m=Oe(f),l=Be(),x=ue("td"),C=Oe(S),L=Be(),N=ue("td"),U=Oe(B),ee=Be()},m(ie,re){ae(ie,e,re),Z(e,n),Z(e,s),Z(e,a),Z(a,m),Z(e,l),Z(e,x),Z(x,C),Z(e,L),Z(e,N),Z(N,U),Z(e,ee)},p(ie,re){re[0]&65536&&f!==(f=ie[16][`${ie[17]}_fastest_bicycle`].toLocaleString()+"")&&Mt(m,f),re[0]&65536&&S!==(S=ie[16][`${ie[17]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&Mt(C,S),re[0]&65536&&B!==(B=ie[16][`${ie[17]}_fastest_bicycle_ebike`].toLocaleString()+"")&&Mt(U,B)},d(ie){ie&&oe(e)}}}function L0(r){let e,n,s,a,f=r[16][`${r[17]}_quietest_bicycle`].toLocaleString()+"",m,l,x,S=r[16][`${r[17]}_quietest_bicycle_go_dutch`].toLocaleString()+"",C,L,N,B=r[16][`${r[17]}_quietest_bicycle_ebike`].toLocaleString()+"",U,ee;return{c(){e=ue("tr"),n=ue("th"),n.textContent=`${r[18]}`,s=Be(),a=ue("td"),m=Oe(f),l=Be(),x=ue("td"),C=Oe(S),L=Be(),N=ue("td"),U=Oe(B),ee=Be()},m(ie,re){ae(ie,e,re),Z(e,n),Z(e,s),Z(e,a),Z(a,m),Z(e,l),Z(e,x),Z(x,C),Z(e,L),Z(e,N),Z(N,U),Z(e,ee)},p(ie,re){re[0]&65536&&f!==(f=ie[16][`${ie[17]}_quietest_bicycle`].toLocaleString()+"")&&Mt(m,f),re[0]&65536&&S!==(S=ie[16][`${ie[17]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&Mt(C,S),re[0]&65536&&B!==(B=ie[16][`${ie[17]}_quietest_bicycle_ebike`].toLocaleString()+"")&&Mt(U,B)},d(ie){ie&&oe(e)}}}function qT(r){let e,n,s,a=r[16][r[4]].toLocaleString()+"",f,m,l,x,S=r[16].gradient+"",C,L,N,B,U,ee=r[16].quietness+"",ie,re,Q,$,pe,ve,De,he,xe,be,Le,we,ye,Ue,Ve,pt,St,dt=Hn(r[7]),ut=[];for(let wt=0;wt<dt.length;wt+=1)ut[wt]=C0(y0(r,dt,wt));let Bt=Hn(r[7]),vt=[];for(let wt=0;wt<Bt.length;wt+=1)vt[wt]=L0(_0(r,Bt,wt));return{c(){e=ue("div"),n=ue("p"),s=Oe("Cyclists: "),f=Oe(a),m=Be(),l=ue("p"),x=Oe("Gradient: "),C=Oe(S),L=Oe("%"),N=Be(),B=ue("p"),U=Oe("Cycle-friendliness: "),ie=Oe(ee),re=Oe("%"),Q=Be(),$=ue("details"),pe=ue("summary"),pe.textContent="All network details",ve=Be(),De=ue("p"),De.textContent="Fast/Direct network",he=Be(),xe=ue("table"),be=ue("tr"),be.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Le=Be();for(let wt=0;wt<ut.length;wt+=1)ut[wt].c();we=Be(),ye=ue("p"),ye.textContent="Quiet/Indirect network",Ue=Be(),Ve=ue("table"),pt=ue("tr"),pt.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",St=Be();for(let wt=0;wt<vt.length;wt+=1)vt[wt].c();Un(e,"max-width","30vw"),Un(e,"max-height","60vh"),Un(e,"overflow","auto")},m(wt,ft){ae(wt,e,ft),Z(e,n),Z(n,s),Z(n,f),Z(e,m),Z(e,l),Z(l,x),Z(l,C),Z(l,L),Z(e,N),Z(e,B),Z(B,U),Z(B,ie),Z(B,re),Z(e,Q),Z(e,$),Z($,pe),Z($,ve),Z($,De),Z($,he),Z($,xe),Z(xe,be),Z(xe,Le);for(let xt=0;xt<ut.length;xt+=1)ut[xt]&&ut[xt].m(xe,null);Z($,we),Z($,ye),Z($,Ue),Z($,Ve),Z(Ve,pt),Z(Ve,St);for(let xt=0;xt<vt.length;xt+=1)vt[xt]&&vt[xt].m(Ve,null)},p(wt,ft){if(ft[0]&65552&&a!==(a=wt[16][wt[4]].toLocaleString()+"")&&Mt(f,a),ft[0]&65536&&S!==(S=wt[16].gradient+"")&&Mt(C,S),ft[0]&65536&&ee!==(ee=wt[16].quietness+"")&&Mt(ie,ee),ft[0]&65664){dt=Hn(wt[7]);let xt;for(xt=0;xt<dt.length;xt+=1){const It=y0(wt,dt,xt);ut[xt]?ut[xt].p(It,ft):(ut[xt]=C0(It),ut[xt].c(),ut[xt].m(xe,null))}for(;xt<ut.length;xt+=1)ut[xt].d(1);ut.length=dt.length}if(ft[0]&65664){Bt=Hn(wt[7]);let xt;for(xt=0;xt<Bt.length;xt+=1){const It=_0(wt,Bt,xt);vt[xt]?vt[xt].p(It,ft):(vt[xt]=L0(It),vt[xt].c(),vt[xt].m(Ve,null))}for(;xt<vt.length;xt+=1)vt[xt].d(1);vt.length=Bt.length}},d(wt){wt&&oe(e),Sr(ut,wt),Sr(vt,wt)}}}function GT(r){let e,n;return e=new js({props:{openOn:"click",$$slots:{default:[qT,({props:s})=>({16:s}),({props:s})=>[s?65536:0]]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a[0]&65552|a[1]&1&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function ZT(r){let e,n;return e=new mr({props:{sourceLayer:"rnet",paint:{"line-color":r[6],"line-width":td(r[4])},layout:{visibility:r[5]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[GT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a[0]&80&&(f.paint={"line-color":s[6],"line-width":td(s[4])}),a[0]&32&&(f.layout={visibility:s[5]?"visible":"none"}),a[0]&16|a[1]&1&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function HT(r){let e,n,s,a;return e=new to({props:{name:"route network",$$slots:{default:[VT]},$$scope:{ctx:r}}}),s=new Qp({props:{url:`pmtiles://${sd("route_network.pmtiles")}`,$$slots:{default:[ZT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),n=Be(),ot(s.$$.fragment)},m(f,m){rt(e,f,m),ae(f,n,m),rt(s,f,m),a=!0},p(f,m){const l={};m[0]&47|m[1]&1&&(l.$$scope={dirty:m,ctx:f}),e.$set(l);const x={};m[0]&112|m[1]&1&&(x.$$scope={dirty:m,ctx:f}),s.$set(x)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(n),st(e,f),st(s,f)}}}function WT(r,e,n){let s,a,f=!1,m="all",l="bicycle_go_dutch",x="fastest",S="flow",C=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],L=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],N=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],B=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]];function U(){f=this.checked,n(5,f)}function ee(){m=_l(this),n(0,m),n(7,C)}function ie(){l=_l(this),n(1,l),n(8,L)}function re(){x=_l(this),n(2,x),n(9,N)}function Q(){S=_l(this),n(3,S),n(10,B)}return r.$$.update=()=>{r.$$.dirty[0]&7&&n(4,s=`${m}_${x}_${l}`),r.$$.dirty[0]&24&&n(6,a={none:"#304ce7",flow:nm(s),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:["step",["get","gradient"],"#59ee19",3,"#37a009",5,"#FFC300",7,"#C70039",10,"#581845",100,"#000000"]}[S])},[m,l,x,S,s,f,a,C,L,N,B,U,ee,ie,re,Q]}class XT extends fn{constructor(e){super(),hn(this,e,WT,HT,un,{},null,[-1,-1])}}function M0(r){let e,n,s,a,f,m,l,x,S,C,L;return{c(){e=ue("button"),e.textContent="Import core network",n=Be(),s=ue("label"),a=ue("input"),f=Oe(`
      Show actual core network`),m=Be(),l=ue("label"),x=ue("input"),S=Oe(`
      Show map-matched core network`),He(e,"class","outline"),He(a,"type","checkbox"),He(x,"type","checkbox"),Un(l,"color","red")},m(N,B){ae(N,e,B),ae(N,n,B),ae(N,s,B),Z(s,a),a.checked=r[2],Z(s,f),ae(N,m,B),ae(N,l,B),Z(l,x),x.checked=r[3],Z(l,S),C||(L=[Pt(e,"click",r[5]),Pt(a,"change",r[7]),Pt(x,"change",r[8])],C=!0)},p(N,B){B&4&&(a.checked=N[2]),B&8&&(x.checked=N[3])},d(N){N&&(oe(e),oe(n),oe(s),oe(m),oe(l)),C=!1,$i(L)}}}function $T(r){let e,n,s,a,f,m,l,x=r[0]&&M0(r);return{c(){e=ue("label"),n=ue("input"),s=Oe(`
    Core network`),a=Be(),x&&x.c(),f=ni(),He(n,"type","checkbox")},m(S,C){ae(S,e,C),Z(e,n),n.checked=r[0],Z(e,s),ae(S,a,C),x&&x.m(S,C),ae(S,f,C),m||(l=Pt(n,"change",r[6]),m=!0)},p(S,C){C&1&&(n.checked=S[0]),S[0]?x?x.p(S,C):(x=M0(S),x.c(),x.m(f.parentNode,f)):x&&(x.d(1),x=null)},d(S){S&&(oe(e),oe(a),oe(f)),x&&x.d(S),m=!1,l()}}}function YT(r){let e,n=r[11].all_fastest_bicycle_go_dutch+"",s;return{c(){e=Oe("Go Dutch value "),s=Oe(n)},m(a,f){ae(a,e,f),ae(a,s,f)},p(a,f){f&2048&&n!==(n=a[11].all_fastest_bicycle_go_dutch+"")&&Mt(s,n)},d(a){a&&(oe(e),oe(s))}}}function JT(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[YT,({props:s})=>({11:s}),({props:s})=>s?2048:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&6144&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function KT(r){let e,n;return e=new mr({props:{sourceLayer:"coherent_networks",paint:{"line-color":"black","line-width":2},layout:{visibility:r[0]&&r[2]?"visible":"none"},$$slots:{default:[JT]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&5&&(f.layout={visibility:s[0]&&s[2]?"visible":"none"}),a&4096&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function A0(r){let e,n,s,a={ctx:r,current:null,token:null,hasCatch:!1,pending:nC,then:eC,catch:QT,value:10,blocks:[,,,]};return gs(n=r[4].renderCoreNetwork(),a),{c(){e=ni(),a.block.c()},m(f,m){ae(f,e,m),a.block.m(f,a.anchor=m),a.mount=()=>e.parentNode,a.anchor=e,s=!0},p(f,m){r=f,a.ctx=r,m&16&&n!==(n=r[4].renderCoreNetwork())&&gs(n,a)||kl(a,r,m)},i(f){s||(_e(a.block),s=!0)},o(f){for(let m=0;m<3;m+=1){const l=a.blocks[m];Ie(l)}s=!1},d(f){f&&oe(e),a.block.d(f),a.token=null,a=null}}}function QT(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function eC(r){let e,n;return e=new rr({props:{data:r[10],generateId:!0,$$slots:{default:[tC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&16&&(f.data=s[10]),a&4105&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function tC(r){let e,n;return e=new mr({props:{paint:{"line-color":"red","line-width":10,"line-opacity":.5},layout:{visibility:r[0]&&r[3]?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&9&&(f.layout={visibility:s[0]&&s[3]?"visible":"none"}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function nC(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function iC(r){let e,n,s,a,f,m;e=new to({props:{name:"core network",$$slots:{default:[$T]},$$scope:{ctx:r}}}),s=new Qp({props:{url:`pmtiles://${sd("core_network.pmtiles")}`,$$slots:{default:[KT]},$$scope:{ctx:r}}});let l=r[4]&&r[1]&&A0(r);return{c(){ot(e.$$.fragment),n=Be(),ot(s.$$.fragment),a=Be(),l&&l.c(),f=ni()},m(x,S){rt(e,x,S),ae(x,n,S),rt(s,x,S),ae(x,a,S),l&&l.m(x,S),ae(x,f,S),m=!0},p(x,[S]){const C={};S&4109&&(C.$$scope={dirty:S,ctx:x}),e.$set(C);const L={};S&4101&&(L.$$scope={dirty:S,ctx:x}),s.$set(L),x[4]&&x[1]?l?(l.p(x,S),S&18&&_e(l,1)):(l=A0(x),l.c(),_e(l,1),l.m(f.parentNode,f)):l&&(Nn(),Ie(l,1,1,()=>{l=null}),zn())},i(x){m||(_e(e.$$.fragment,x),_e(s.$$.fragment,x),_e(l),m=!0)},o(x){Ie(e.$$.fragment,x),Ie(s.$$.fragment,x),Ie(l),m=!1},d(x){x&&(oe(n),oe(a),oe(f)),st(e,x),st(s,x),l&&l.d(x)}}}function rC(r,e,n){let s,a;Ot(r,Rh,B=>n(9,s=B)),Ot(r,sr,B=>n(4,a=B));let f=!1,m=!1,l=!0,x=!0;async function S(){if(a){let B=a.importCoreNetwork(),U=B==1?"route segment":"route segments";await Dh(),Dn(Rh,s+=1,s),window.alert(`Imported ${B} ${U}`)}}function C(){f=this.checked,n(0,f)}function L(){l=this.checked,n(2,l)}function N(){x=this.checked,n(3,x)}return r.$$.update=()=>{r.$$.dirty&1&&f&&n(1,m=!0)},[f,m,l,x,a,S,C,L,N]}class sC extends fn{constructor(e){super(),hn(this,e,rC,iC,un,{})}}function oC(r){let e,n;return e=new mr({props:{paint:{"line-width":3,"line-color":["case",["==",["get","kind"],"severance"],"red","blue"]}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p:tt,i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function aC(r){let e,n;return e=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[oC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,[a]){const f={};a&1&&(f.data=s[0]),a&32&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function lC(r,e,n){let s;Ot(r,sr,x=>n(3,s=x));let{kind:a}=e,{hovered:f}=e,m={type:"FeatureCollection",features:[]};async function l(x){s&&x?x.properties.reachable?n(0,m=await s.debugReachablePath(a,x.properties.idx)):n(0,m=await s.debugUnreachablePath(a,x.properties.idx)):n(0,m={type:"FeatureCollection",features:[]})}return r.$$set=x=>{"kind"in x&&n(1,a=x.kind),"hovered"in x&&n(2,f=x.hovered)},r.$$.update=()=>{r.$$.dirty&4&&l(f)},[m,a,f]}class im extends fn{constructor(e){super(),hn(this,e,lC,aC,un,{kind:1,hovered:2})}}function P0(r){let e,n,s,a=r[3].toLocaleString()+"",f,m,l=r[0].features.length.toLocaleString()+"",x,S,C=wr(r[3],r[0].features.length)+"",L,N,B,U,ee,ie,re;return U=new _c({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=ue("button"),e.textContent="Recalculate",n=Be(),s=ue("p"),f=Oe(a),m=Oe(" / "),x=Oe(l),S=Oe(" ("),L=Oe(C),N=Oe(") reachable"),B=Be(),ot(U.$$.fragment),He(e,"class","outline")},m(Q,$){ae(Q,e,$),ae(Q,n,$),ae(Q,s,$),Z(s,f),Z(s,m),Z(s,x),Z(s,S),Z(s,L),Z(s,N),ae(Q,B,$),rt(U,Q,$),ee=!0,ie||(re=Pt(e,"click",r[4]),ie=!0)},p(Q,$){(!ee||$&8)&&a!==(a=Q[3].toLocaleString()+"")&&Mt(f,a),(!ee||$&1)&&l!==(l=Q[0].features.length.toLocaleString()+"")&&Mt(x,l),(!ee||$&9)&&C!==(C=wr(Q[3],Q[0].features.length)+"")&&Mt(L,C)},i(Q){ee||(_e(U.$$.fragment,Q),ee=!0)},o(Q){Ie(U.$$.fragment,Q),ee=!1},d(Q){Q&&(oe(e),oe(n),oe(s),oe(B)),st(U,Q),ie=!1,re()}}}function uC(r){let e,n,s,a,f,m,l,x,S=r[1]&&P0(r);return{c(){e=ue("label"),n=ue("input"),s=Oe(`
    Schools`),a=Be(),S&&S.c(),f=ni(),He(n,"type","checkbox")},m(C,L){ae(C,e,L),Z(e,n),n.checked=r[1],Z(e,s),ae(C,a,L),S&&S.m(C,L),ae(C,f,L),m=!0,l||(x=Pt(n,"change",r[5]),l=!0)},p(C,L){L&2&&(n.checked=C[1]),C[1]?S?(S.p(C,L),L&2&&_e(S,1)):(S=P0(C),S.c(),_e(S,1),S.m(f.parentNode,f)):S&&(Nn(),Ie(S,1,1,()=>{S=null}),zn())},i(C){m||(_e(S),m=!0)},o(C){Ie(S),m=!1},d(C){C&&(oe(e),oe(a),oe(f)),S&&S.d(C),l=!1,x()}}}function cC(r){let e=r[8].name+"",n,s,a=r[8].kind+"",f,m,l=r[8].pupils+"",x,S,C=r[8].reachable?"is":"is not",L,N;return{c(){n=Oe(e),s=Oe(" is a "),f=Oe(a),m=Oe(" school with "),x=Oe(l),S=Oe(" pupils. It "),L=Oe(C),N=Oe(" reachable.")},m(B,U){ae(B,n,U),ae(B,s,U),ae(B,f,U),ae(B,m,U),ae(B,x,U),ae(B,S,U),ae(B,L,U),ae(B,N,U)},p(B,U){U&256&&e!==(e=B[8].name+"")&&Mt(n,e),U&256&&a!==(a=B[8].kind+"")&&Mt(f,a),U&256&&l!==(l=B[8].pupils+"")&&Mt(x,l),U&256&&C!==(C=B[8].reachable?"is":"is not")&&Mt(L,C)},d(B){B&&(oe(n),oe(s),oe(f),oe(m),oe(x),oe(S),oe(L),oe(N))}}}function hC(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[cC,({props:s})=>({8:s}),({props:s})=>s?256:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&768&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function fC(r){let e,n,s;function a(m){r[6](m)}let f={manageHoverState:!0,paint:{"circle-color":["case",["get","reachable"],"purple","red"],"circle-radius":Ms(5,8)},layout:{visibility:r[1]?"visible":"none"},$$slots:{default:[hC]},$$scope:{ctx:r}};return r[2]!==void 0&&(f.hovered=r[2]),e=new Kp({props:f}),Jn.push(()=>Ir(e,"hovered",a)),{c(){ot(e.$$.fragment)},m(m,l){rt(e,m,l),s=!0},p(m,l){const x={};l&2&&(x.layout={visibility:m[1]?"visible":"none"}),l&512&&(x.$$scope={dirty:l,ctx:m}),!n&&l&4&&(n=!0,x.hovered=m[2],kr(()=>n=!1)),e.$set(x)},i(m){s||(_e(e.$$.fragment,m),s=!0)},o(m){Ie(e.$$.fragment,m),s=!1},d(m){st(e,m)}}}function dC(r){let e,n,s,a,f,m;return e=new to({props:{name:"schools",$$slots:{default:[uC]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[fC]},$$scope:{ctx:r}}}),f=new im({props:{kind:"schools",hovered:r[2]}}),{c(){ot(e.$$.fragment),n=Be(),ot(s.$$.fragment),a=Be(),ot(f.$$.fragment)},m(l,x){rt(e,l,x),ae(l,n,x),rt(s,l,x),ae(l,a,x),rt(f,l,x),m=!0},p(l,[x]){const S={};x&523&&(S.$$scope={dirty:x,ctx:l}),e.$set(S);const C={};x&1&&(C.data=l[0]),x&518&&(C.$$scope={dirty:x,ctx:l}),s.$set(C);const L={};x&4&&(L.hovered=l[2]),f.$set(L)},i(l){m||(_e(e.$$.fragment,l),_e(s.$$.fragment,l),_e(f.$$.fragment,l),m=!0)},o(l){Ie(e.$$.fragment,l),Ie(s.$$.fragment,l),Ie(f.$$.fragment,l),m=!1},d(l){l&&(oe(n),oe(a)),st(e,l),st(s,l),st(f,l)}}}function pC(r,e,n){let s,a,f;Ot(r,Wf,L=>n(1,a=L)),Ot(r,sr,L=>n(7,f=L));let m={type:"FeatureCollection",features:[]},l;async function x(){f&&n(0,m=await f.getSchools())}function S(){a=this.checked,Wf.set(a)}function C(L){l=L,n(2,l)}return r.$$.update=()=>{r.$$.dirty&3&&a&&m.features.length==0&&x(),r.$$.dirty&1&&n(3,s=m.features.filter(L=>L.properties.reachable).length)},[m,a,l,s,x,S,C]}class mC extends fn{constructor(e){super(),hn(this,e,pC,dC,un,{})}}function R0(r){let e,n,s,a=r[3].toLocaleString()+"",f,m,l=r[0].features.length.toLocaleString()+"",x,S,C=wr(r[3],r[0].features.length)+"",L,N,B,U,ee,ie,re;return U=new _c({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=ue("button"),e.textContent="Recalculate",n=Be(),s=ue("p"),f=Oe(a),m=Oe(" / "),x=Oe(l),S=Oe(" ("),L=Oe(C),N=Oe(") reachable"),B=Be(),ot(U.$$.fragment),He(e,"class","outline")},m(Q,$){ae(Q,e,$),ae(Q,n,$),ae(Q,s,$),Z(s,f),Z(s,m),Z(s,x),Z(s,S),Z(s,L),Z(s,N),ae(Q,B,$),rt(U,Q,$),ee=!0,ie||(re=Pt(e,"click",r[4]),ie=!0)},p(Q,$){(!ee||$&8)&&a!==(a=Q[3].toLocaleString()+"")&&Mt(f,a),(!ee||$&1)&&l!==(l=Q[0].features.length.toLocaleString()+"")&&Mt(x,l),(!ee||$&9)&&C!==(C=wr(Q[3],Q[0].features.length)+"")&&Mt(L,C)},i(Q){ee||(_e(U.$$.fragment,Q),ee=!0)},o(Q){Ie(U.$$.fragment,Q),ee=!1},d(Q){Q&&(oe(e),oe(n),oe(s),oe(B)),st(U,Q),ie=!1,re()}}}function gC(r){let e,n,s,a,f,m,l,x,S=r[1]&&R0(r);return{c(){e=ue("label"),n=ue("input"),s=Oe(`
    Town centres`),a=Be(),S&&S.c(),f=ni(),He(n,"type","checkbox")},m(C,L){ae(C,e,L),Z(e,n),n.checked=r[1],Z(e,s),ae(C,a,L),S&&S.m(C,L),ae(C,f,L),m=!0,l||(x=Pt(n,"change",r[5]),l=!0)},p(C,L){L&2&&(n.checked=C[1]),C[1]?S?(S.p(C,L),L&2&&_e(S,1)):(S=R0(C),S.c(),_e(S,1),S.m(f.parentNode,f)):S&&(Nn(),Ie(S,1,1,()=>{S=null}),zn())},i(C){m||(_e(S),m=!0)},o(C){Ie(S),m=!1},d(C){C&&(oe(e),oe(a),oe(f)),S&&S.d(C),l=!1,x()}}}function _C(r){let e,n=(r[8].name||"")+"",s,a,f=r[8].reachable?"is":"is not",m,l;return{c(){e=Oe("Town centre "),s=Oe(n),a=Be(),m=Oe(f),l=Oe(" reachable.")},m(x,S){ae(x,e,S),ae(x,s,S),ae(x,a,S),ae(x,m,S),ae(x,l,S)},p(x,S){S&256&&n!==(n=(x[8].name||"")+"")&&Mt(s,n),S&256&&f!==(f=x[8].reachable?"is":"is not")&&Mt(m,f)},d(x){x&&(oe(e),oe(s),oe(a),oe(m),oe(l))}}}function yC(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[_C,({props:s})=>({8:s}),({props:s})=>s?256:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&768&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function vC(r){let e,n,s;function a(m){r[6](m)}let f={manageHoverState:!0,paint:{"fill-color":["case",["get","reachable"],"purple","red"],"fill-opacity":Ms(.7,.9)},layout:{visibility:r[1]?"visible":"none"},$$slots:{default:[yC]},$$scope:{ctx:r}};return r[2]!==void 0&&(f.hovered=r[2]),e=new mc({props:f}),Jn.push(()=>Ir(e,"hovered",a)),{c(){ot(e.$$.fragment)},m(m,l){rt(e,m,l),s=!0},p(m,l){const x={};l&2&&(x.layout={visibility:m[1]?"visible":"none"}),l&512&&(x.$$scope={dirty:l,ctx:m}),!n&&l&4&&(n=!0,x.hovered=m[2],kr(()=>n=!1)),e.$set(x)},i(m){s||(_e(e.$$.fragment,m),s=!0)},o(m){Ie(e.$$.fragment,m),s=!1},d(m){st(e,m)}}}function bC(r){let e,n,s,a,f,m;return e=new to({props:{name:"town centres",$$slots:{default:[gC]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[vC]},$$scope:{ctx:r}}}),f=new im({props:{kind:"town_centres",hovered:r[2]}}),{c(){ot(e.$$.fragment),n=Be(),ot(s.$$.fragment),a=Be(),ot(f.$$.fragment)},m(l,x){rt(e,l,x),ae(l,n,x),rt(s,l,x),ae(l,a,x),rt(f,l,x),m=!0},p(l,[x]){const S={};x&523&&(S.$$scope={dirty:x,ctx:l}),e.$set(S);const C={};x&1&&(C.data=l[0]),x&518&&(C.$$scope={dirty:x,ctx:l}),s.$set(C);const L={};x&4&&(L.hovered=l[2]),f.$set(L)},i(l){m||(_e(e.$$.fragment,l),_e(s.$$.fragment,l),_e(f.$$.fragment,l),m=!0)},o(l){Ie(e.$$.fragment,l),Ie(s.$$.fragment,l),Ie(f.$$.fragment,l),m=!1},d(l){l&&(oe(n),oe(a)),st(e,l),st(s,l),st(f,l)}}}function xC(r,e,n){let s,a,f;Ot(r,$f,L=>n(1,a=L)),Ot(r,sr,L=>n(7,f=L));let m={type:"FeatureCollection",features:[]},l;async function x(){f&&n(0,m=await f.getTownCentres())}function S(){a=this.checked,$f.set(a)}function C(L){l=L,n(2,l)}return r.$$.update=()=>{r.$$.dirty&3&&a&&m.features.length==0&&x(),r.$$.dirty&1&&n(3,s=m.features.filter(L=>L.properties.reachable).length)},[m,a,l,s,x,S,C]}class wC extends fn{constructor(e){super(),hn(this,e,xC,bC,un,{})}}function D0(r){let e,n,s,a=r[3].toLocaleString()+"",f,m,l=r[0].features.length.toLocaleString()+"",x,S,C=wr(r[3],r[0].features.length)+"",L,N,B,U,ee,ie,re;return U=new _c({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=ue("button"),e.textContent="Recalculate",n=Be(),s=ue("p"),f=Oe(a),m=Oe(" / "),x=Oe(l),S=Oe(" ("),L=Oe(C),N=Oe(") reachable"),B=Be(),ot(U.$$.fragment),He(e,"class","outline")},m(Q,$){ae(Q,e,$),ae(Q,n,$),ae(Q,s,$),Z(s,f),Z(s,m),Z(s,x),Z(s,S),Z(s,L),Z(s,N),ae(Q,B,$),rt(U,Q,$),ee=!0,ie||(re=Pt(e,"click",r[4]),ie=!0)},p(Q,$){(!ee||$&8)&&a!==(a=Q[3].toLocaleString()+"")&&Mt(f,a),(!ee||$&1)&&l!==(l=Q[0].features.length.toLocaleString()+"")&&Mt(x,l),(!ee||$&9)&&C!==(C=wr(Q[3],Q[0].features.length)+"")&&Mt(L,C)},i(Q){ee||(_e(U.$$.fragment,Q),ee=!0)},o(Q){Ie(U.$$.fragment,Q),ee=!1},d(Q){Q&&(oe(e),oe(n),oe(s),oe(B)),st(U,Q),ie=!1,re()}}}function kC(r){let e,n,s,a,f,m,l,x,S=r[1]&&D0(r);return{c(){e=ue("label"),n=ue("input"),s=Oe(`
    GPs and hospitals`),a=Be(),S&&S.c(),f=ni(),He(n,"type","checkbox")},m(C,L){ae(C,e,L),Z(e,n),n.checked=r[1],Z(e,s),ae(C,a,L),S&&S.m(C,L),ae(C,f,L),m=!0,l||(x=Pt(n,"change",r[5]),l=!0)},p(C,L){L&2&&(n.checked=C[1]),C[1]?S?(S.p(C,L),L&2&&_e(S,1)):(S=D0(C),S.c(),_e(S,1),S.m(f.parentNode,f)):S&&(Nn(),Ie(S,1,1,()=>{S=null}),zn())},i(C){m||(_e(S),m=!0)},o(C){Ie(S),m=!1},d(C){C&&(oe(e),oe(a),oe(f)),S&&S.d(C),l=!1,x()}}}function IC(r){let e=r[8].name+"",n,s,a=r[8].kind+"",f,m,l=r[8].reachable?"is":"is not",x,S;return{c(){n=Oe(e),s=Oe(" is a "),f=Oe(a),m=Oe(". It "),x=Oe(l),S=Oe(" reachable.")},m(C,L){ae(C,n,L),ae(C,s,L),ae(C,f,L),ae(C,m,L),ae(C,x,L),ae(C,S,L)},p(C,L){L&256&&e!==(e=C[8].name+"")&&Mt(n,e),L&256&&a!==(a=C[8].kind+"")&&Mt(f,a),L&256&&l!==(l=C[8].reachable?"is":"is not")&&Mt(x,l)},d(C){C&&(oe(n),oe(s),oe(f),oe(m),oe(x),oe(S))}}}function SC(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[IC,({props:s})=>({8:s}),({props:s})=>s?256:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&768&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function EC(r){let e,n,s;function a(m){r[6](m)}let f={manageHoverState:!0,paint:{"circle-color":["case",["get","reachable"],"purple","red"],"circle-radius":Ms(5,8)},layout:{visibility:r[1]?"visible":"none"},$$slots:{default:[SC]},$$scope:{ctx:r}};return r[2]!==void 0&&(f.hovered=r[2]),e=new Kp({props:f}),Jn.push(()=>Ir(e,"hovered",a)),{c(){ot(e.$$.fragment)},m(m,l){rt(e,m,l),s=!0},p(m,l){const x={};l&2&&(x.layout={visibility:m[1]?"visible":"none"}),l&512&&(x.$$scope={dirty:l,ctx:m}),!n&&l&4&&(n=!0,x.hovered=m[2],kr(()=>n=!1)),e.$set(x)},i(m){s||(_e(e.$$.fragment,m),s=!0)},o(m){Ie(e.$$.fragment,m),s=!1},d(m){st(e,m)}}}function TC(r){let e,n,s,a,f,m;return e=new to({props:{name:"gp hospitals",$$slots:{default:[kC]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[EC]},$$scope:{ctx:r}}}),f=new im({props:{kind:"gp_hospitals",hovered:r[2]}}),{c(){ot(e.$$.fragment),n=Be(),ot(s.$$.fragment),a=Be(),ot(f.$$.fragment)},m(l,x){rt(e,l,x),ae(l,n,x),rt(s,l,x),ae(l,a,x),rt(f,l,x),m=!0},p(l,[x]){const S={};x&523&&(S.$$scope={dirty:x,ctx:l}),e.$set(S);const C={};x&1&&(C.data=l[0]),x&518&&(C.$$scope={dirty:x,ctx:l}),s.$set(C);const L={};x&4&&(L.hovered=l[2]),f.$set(L)},i(l){m||(_e(e.$$.fragment,l),_e(s.$$.fragment,l),_e(f.$$.fragment,l),m=!0)},o(l){Ie(e.$$.fragment,l),Ie(s.$$.fragment,l),Ie(f.$$.fragment,l),m=!1},d(l){l&&(oe(n),oe(a)),st(e,l),st(s,l),st(f,l)}}}function CC(r,e,n){let s,a,f;Ot(r,Xf,L=>n(1,a=L)),Ot(r,sr,L=>n(7,f=L));let m={type:"FeatureCollection",features:[]},l;async function x(){f&&n(0,m=await f.getGpHospitals())}function S(){a=this.checked,Xf.set(a)}function C(L){l=L,n(2,l)}return r.$$.update=()=>{r.$$.dirty&3&&a&&m.features.length==0&&x(),r.$$.dirty&1&&n(3,s=m.features.filter(L=>L.properties.reachable).length)},[m,a,l,s,x,S,C]}class LC extends fn{constructor(e){super(),hn(this,e,CC,TC,un,{})}}function MC(r){let e,n,s,a,f;return{c(){e=ue("label"),n=ue("input"),s=Oe(`
    Urban areas`),He(n,"type","checkbox")},m(m,l){ae(m,e,l),Z(e,n),n.checked=r[0],Z(e,s),a||(f=Pt(n,"change",r[1]),a=!0)},p(m,l){l&1&&(n.checked=m[0])},d(m){m&&oe(e),a=!1,f()}}}function AC(r){let e,n;return e=new mc({props:{sourceLayer:"urban_areas",manageHoverState:!0,paint:{"fill-color":"black","fill-opacity":Ms(1,.5)},layout:{visibility:r[0]?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&1&&(f.layout={visibility:s[0]?"visible":"none"}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function PC(r){let e,n,s,a;return e=new to({props:{name:"urban areas",$$slots:{default:[MC]},$$scope:{ctx:r}}}),s=new Qp({props:{url:`pmtiles://${sd("urban_areas.pmtiles")}`,$$slots:{default:[AC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),n=Be(),ot(s.$$.fragment)},m(f,m){rt(e,f,m),ae(f,n,m),rt(s,f,m),a=!0},p(f,[m]){const l={};m&5&&(l.$$scope={dirty:m,ctx:f}),e.$set(l);const x={};m&5&&(x.$$scope={dirty:m,ctx:f}),s.$set(x)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(n),st(e,f),st(s,f)}}}function RC(r,e,n){let s=!1;function a(){s=this.checked,n(0,s)}return[s,a]}class DC extends fn{constructor(e){super(),hn(this,e,RC,PC,un,{})}}function N0(r){let e,n,s,a,f,m;return s=new _c({props:{colors:r[3]}}),{c(){e=ue("button"),e.textContent="Recalculate",n=Be(),ot(s.$$.fragment),He(e,"class","outline")},m(l,x){ae(l,e,x),ae(l,n,x),rt(s,l,x),a=!0,f||(m=Pt(e,"click",r[2]),f=!0)},p:tt,i(l){a||(_e(s.$$.fragment,l),a=!0)},o(l){Ie(s.$$.fragment,l),a=!1},d(l){l&&(oe(e),oe(n)),st(s,l),f=!1,m()}}}function NC(r){let e,n,s,a,f,m,l,x,S=r[0]&&N0(r);return{c(){e=ue("label"),n=ue("input"),s=Oe(`
    Reachable network`),a=Be(),S&&S.c(),f=ni(),He(n,"type","checkbox")},m(C,L){ae(C,e,L),Z(e,n),n.checked=r[0],Z(e,s),ae(C,a,L),S&&S.m(C,L),ae(C,f,L),m=!0,l||(x=Pt(n,"change",r[4]),l=!0)},p(C,L){L&1&&(n.checked=C[0]),C[0]?S?(S.p(C,L),L&1&&_e(S,1)):(S=N0(C),S.c(),_e(S,1),S.m(f.parentNode,f)):S&&(Nn(),Ie(S,1,1,()=>{S=null}),zn())},i(C){m||(_e(S),m=!0)},o(C){Ie(S),m=!1},d(C){C&&(oe(e),oe(a),oe(f)),S&&S.d(C),l=!1,x()}}}function zC(r){let e,n;return e=new mr({props:{layout:{visibility:r[0]?"visible":"none"},paint:{"line-width":Ms(5,7),"line-color":Xp(["get","kind"],r[3],"black"),"line-opacity":.8},manageHoverState:!0}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&1&&(f.layout={visibility:s[0]?"visible":"none"}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function OC(r){let e,n,s,a;return e=new to({props:{name:"reachable network",$$slots:{default:[NC]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[1],generateId:!0,$$slots:{default:[zC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),n=Be(),ot(s.$$.fragment)},m(f,m){rt(e,f,m),ae(f,n,m),rt(s,f,m),a=!0},p(f,[m]){const l={};m&65&&(l.$$scope={dirty:m,ctx:f}),e.$set(l);const x={};m&2&&(x.data=f[1]),m&65&&(x.$$scope={dirty:m,ctx:f}),s.$set(x)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(n),st(e,f),st(s,f)}}}function FC(r,e,n){let s;Ot(r,sr,S=>n(5,s=S));let a=!1,f={type:"FeatureCollection",features:[]};async function m(){n(1,f=await s.renderReachableNetwork())}let l={network:"green",reachable:"purple",severance:"red"};function x(){a=this.checked,n(0,a)}return r.$$.update=()=>{r.$$.dirty&3&&a&&f.features.length==0&&m()},[a,f,m,l,x]}class BC extends fn{constructor(e){super(),hn(this,e,FC,OC,un,{})}}function z0(r){let e,n;return e=new _c({props:{colors:tm}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function UC(r){let e,n,s,a,f,m,l,x,S=r[0]&&z0();return{c(){e=ue("label"),n=ue("input"),s=Oe(`
    Level of Service`),a=Be(),S&&S.c(),f=ni(),He(n,"type","checkbox")},m(C,L){ae(C,e,L),Z(e,n),n.checked=r[0],Z(e,s),ae(C,a,L),S&&S.m(C,L),ae(C,f,L),m=!0,l||(x=Pt(n,"change",r[3]),l=!0)},p(C,L){L&1&&(n.checked=C[0]),C[0]?S?L&1&&_e(S,1):(S=z0(),S.c(),_e(S,1),S.m(f.parentNode,f)):S&&(Nn(),Ie(S,1,1,()=>{S=null}),zn())},i(C){m||(_e(S),m=!0)},o(C){Ie(S),m=!1},d(C){C&&(oe(e),oe(a),oe(f)),S&&S.d(C),l=!1,x()}}}function O0(r){let e,n,s,a={ctx:r,current:null,token:null,hasCatch:!1,pending:HC,then:VC,catch:jC,value:4,blocks:[,,,]};return gs(n=r[2].renderLevelOfService(),a),{c(){e=ni(),a.block.c()},m(f,m){ae(f,e,m),a.block.m(f,a.anchor=m),a.mount=()=>e.parentNode,a.anchor=e,s=!0},p(f,m){r=f,a.ctx=r,m&4&&n!==(n=r[2].renderLevelOfService())&&gs(n,a)||kl(a,r,m)},i(f){s||(_e(a.block),s=!0)},o(f){for(let m=0;m<3;m+=1){const l=a.blocks[m];Ie(l)}s=!1},d(f){f&&oe(e),a.block.d(f),a.token=null,a=null}}}function jC(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function VC(r){let e,n;return e=new rr({props:{data:r[4],generateId:!0,$$slots:{default:[ZC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&4&&(f.data=s[4]),a&65&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function qC(r){let e,n,s,a,f,m=r[5].los+"",l,x,S,C,L,N,B=oc[r[5].infra_type][0]+"",U,ee,ie,re,Q,$,pe=r[5].speed+"",ve,De,he,xe,be,Le,we=r[5].traffic.toLocaleString()+"",ye;return{c(){e=ue("table"),n=ue("tr"),s=ue("th"),s.textContent="Level of Service",a=Be(),f=ue("td"),l=Oe(m),x=Be(),S=ue("tr"),C=ue("th"),C.textContent="Infrastructure type",L=Be(),N=ue("td"),U=Oe(B),ee=Be(),ie=ue("tr"),re=ue("th"),re.textContent="Speed (mph)",Q=Be(),$=ue("td"),ve=Oe(pe),De=Be(),he=ue("tr"),xe=ue("th"),xe.textContent="Estimated daily traffic volume",be=Be(),Le=ue("td"),ye=Oe(we)},m(Ue,Ve){ae(Ue,e,Ve),Z(e,n),Z(n,s),Z(n,a),Z(n,f),Z(f,l),Z(e,x),Z(e,S),Z(S,C),Z(S,L),Z(S,N),Z(N,U),Z(e,ee),Z(e,ie),Z(ie,re),Z(ie,Q),Z(ie,$),Z($,ve),Z(e,De),Z(e,he),Z(he,xe),Z(he,be),Z(he,Le),Z(Le,ye)},p(Ue,Ve){Ve&32&&m!==(m=Ue[5].los+"")&&Mt(l,m),Ve&32&&B!==(B=oc[Ue[5].infra_type][0]+"")&&Mt(U,B),Ve&32&&pe!==(pe=Ue[5].speed+"")&&Mt(ve,pe),Ve&32&&we!==(we=Ue[5].traffic.toLocaleString()+"")&&Mt(ye,we)},d(Ue){Ue&&oe(e)}}}function GC(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[qC,({props:s})=>({5:s}),({props:s})=>s?32:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&96&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function ZC(r){let e,n;return e=new mr({props:{layout:{visibility:r[0]?"visible":"none"},paint:{"line-width":Ms(5,7),"line-color":Bp,"line-opacity":.8},manageHoverState:!0,$$slots:{default:[GC]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&1&&(f.layout={visibility:s[0]?"visible":"none"}),a&64&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function HC(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function WC(r){let e,n,s,a;e=new to({props:{name:"level of service",$$slots:{default:[UC]},$$scope:{ctx:r}}});let f=r[2]&&r[1]&&O0(r);return{c(){ot(e.$$.fragment),n=Be(),f&&f.c(),s=ni()},m(m,l){rt(e,m,l),ae(m,n,l),f&&f.m(m,l),ae(m,s,l),a=!0},p(m,[l]){const x={};l&65&&(x.$$scope={dirty:l,ctx:m}),e.$set(x),m[2]&&m[1]?f?(f.p(m,l),l&6&&_e(f,1)):(f=O0(m),f.c(),_e(f,1),f.m(s.parentNode,s)):f&&(Nn(),Ie(f,1,1,()=>{f=null}),zn())},i(m){a||(_e(e.$$.fragment,m),_e(f),a=!0)},o(m){Ie(e.$$.fragment,m),Ie(f),a=!1},d(m){m&&(oe(n),oe(s)),st(e,m),f&&f.d(m)}}}function XC(r,e,n){let s;Ot(r,sr,l=>n(2,s=l));let a=!1,f=!1;function m(){a=this.checked,n(0,a)}return r.$$.update=()=>{r.$$.dirty&1&&a&&n(1,f=!0)},[a,f,s,m]}class $C extends fn{constructor(e){super(),hn(this,e,XC,WC,un,{})}}function F0(r){let e,n;return e=new em({props:{colorScale:r[3],limits:r[4]}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p:tt,i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function YC(r){let e,n,s,a,f,m,l,x,S=r[0]&&F0(r);return{c(){e=ue("label"),n=ue("input"),s=Oe(`
    Estimated traffic volume`),a=Be(),S&&S.c(),f=ni(),He(n,"type","checkbox")},m(C,L){ae(C,e,L),Z(e,n),n.checked=r[0],Z(e,s),ae(C,a,L),S&&S.m(C,L),ae(C,f,L),m=!0,l||(x=Pt(n,"change",r[5]),l=!0)},p(C,L){L&1&&(n.checked=C[0]),C[0]?S?(S.p(C,L),L&1&&_e(S,1)):(S=F0(C),S.c(),_e(S,1),S.m(f.parentNode,f)):S&&(Nn(),Ie(S,1,1,()=>{S=null}),zn())},i(C){m||(_e(S),m=!0)},o(C){Ie(S),m=!1},d(C){C&&(oe(e),oe(a),oe(f)),S&&S.d(C),l=!1,x()}}}function B0(r){let e,n,s,a={ctx:r,current:null,token:null,hasCatch:!1,pending:nL,then:KC,catch:JC,value:6,blocks:[,,,]};return gs(n=r[2].renderLevelOfService(),a),{c(){e=ni(),a.block.c()},m(f,m){ae(f,e,m),a.block.m(f,a.anchor=m),a.mount=()=>e.parentNode,a.anchor=e,s=!0},p(f,m){r=f,a.ctx=r,m&4&&n!==(n=r[2].renderLevelOfService())&&gs(n,a)||kl(a,r,m)},i(f){s||(_e(a.block),s=!0)},o(f){for(let m=0;m<3;m+=1){const l=a.blocks[m];Ie(l)}s=!1},d(f){f&&oe(e),a.block.d(f),a.token=null,a=null}}}function JC(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function KC(r){let e,n;return e=new rr({props:{data:r[6],generateId:!0,$$slots:{default:[tL]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&4&&(f.data=s[6]),a&257&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function QC(r){let e,n=r[7].traffic.toLocaleString()+"",s;return{c(){e=ue("p"),s=Oe(n)},m(a,f){ae(a,e,f),Z(e,s)},p(a,f){f&128&&n!==(n=a[7].traffic.toLocaleString()+"")&&Mt(s,n)},d(a){a&&oe(e)}}}function eL(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[QC,({props:s})=>({7:s}),({props:s})=>s?128:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&384&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function tL(r){let e,n;return e=new mr({props:{layout:{visibility:r[0]?"visible":"none"},paint:{"line-width":Gf(["get","traffic"],r[4],[1,2,3]),"line-color":Gf(["get","traffic"],r[4],r[3]),"line-opacity":.8},manageHoverState:!0,$$slots:{default:[eL]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&1&&(f.layout={visibility:s[0]?"visible":"none"}),a&256&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function nL(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function iL(r){let e,n,s,a;e=new to({props:{name:"traffic volume",$$slots:{default:[YC]},$$scope:{ctx:r}}});let f=r[2]&&r[1]&&B0(r);return{c(){ot(e.$$.fragment),n=Be(),f&&f.c(),s=ni()},m(m,l){rt(e,m,l),ae(m,n,l),f&&f.m(m,l),ae(m,s,l),a=!0},p(m,[l]){const x={};l&257&&(x.$$scope={dirty:l,ctx:m}),e.$set(x),m[2]&&m[1]?f?(f.p(m,l),l&6&&_e(f,1)):(f=B0(m),f.c(),_e(f,1),f.m(s.parentNode,s)):f&&(Nn(),Ie(f,1,1,()=>{f=null}),zn())},i(m){a||(_e(e.$$.fragment,m),_e(f),a=!0)},o(m){Ie(e.$$.fragment,m),Ie(f),a=!1},d(m){m&&(oe(n),oe(s)),st(e,m),f&&f.d(m)}}}function rL(r,e,n){let s;Ot(r,sr,S=>n(2,s=S));let a=!1,f=!1,m=["#27918d","#ffaa33","#440154"],l=[0,2e3,4e3,1e4];function x(){a=this.checked,n(0,a)}return r.$$.update=()=>{r.$$.dirty&1&&a&&n(1,f=!0)},[a,f,s,m,l,x]}class sL extends fn{constructor(e){super(),hn(this,e,rL,iL,un,{})}}function U0(r){let e,n,s,a,f,m=r[3].toLocaleString()+"",l,x,S=r[0].features.length.toLocaleString()+"",C,L,N=r[2].toLocaleString()+"",B,U,ee=r[4].toLocaleString()+"",ie,re,Q=wr(r[2],r[4])+"",$,pe,ve,De,he,xe,be,Le,we;return De=new em({props:{colorScale:r[6],limits:r[7]}}),{c(){e=ue("button"),e.textContent="Recalculate",n=Be(),s=ue("p"),s.textContent="Only the top 20%ile most deprived zones are shown",a=Be(),f=ue("p"),l=Oe(m),x=Oe(" / "),C=Oe(S),L=Oe(` zones
      reachable. That's `),B=Oe(N),U=Oe(" / "),ie=Oe(ee),re=Oe(`
      (`),$=Oe(Q),pe=Oe(") of the population."),ve=Be(),ot(De.$$.fragment),he=Be(),xe=ue("p"),xe.textContent=`Darker colours are more deprived. Zones with a red outline are not
      reachable by the current network.`,He(e,"class","outline")},m(ye,Ue){ae(ye,e,Ue),ae(ye,n,Ue),ae(ye,s,Ue),ae(ye,a,Ue),ae(ye,f,Ue),Z(f,l),Z(f,x),Z(f,C),Z(f,L),Z(f,B),Z(f,U),Z(f,ie),Z(f,re),Z(f,$),Z(f,pe),ae(ye,ve,Ue),rt(De,ye,Ue),ae(ye,he,Ue),ae(ye,xe,Ue),be=!0,Le||(we=Pt(e,"click",r[5]),Le=!0)},p(ye,Ue){(!be||Ue&8)&&m!==(m=ye[3].toLocaleString()+"")&&Mt(l,m),(!be||Ue&1)&&S!==(S=ye[0].features.length.toLocaleString()+"")&&Mt(C,S),(!be||Ue&4)&&N!==(N=ye[2].toLocaleString()+"")&&Mt(B,N),(!be||Ue&16)&&ee!==(ee=ye[4].toLocaleString()+"")&&Mt(ie,ee),(!be||Ue&20)&&Q!==(Q=wr(ye[2],ye[4])+"")&&Mt($,Q)},i(ye){be||(_e(De.$$.fragment,ye),be=!0)},o(ye){Ie(De.$$.fragment,ye),be=!1},d(ye){ye&&(oe(e),oe(n),oe(s),oe(a),oe(f),oe(ve),oe(he),oe(xe)),st(De,ye),Le=!1,we()}}}function oL(r){let e,n,s,a,f,m,l,x,S=r[1]&&U0(r);return{c(){e=ue("label"),n=ue("input"),s=Oe(`
    SIMD`),a=Be(),S&&S.c(),f=ni(),He(n,"type","checkbox")},m(C,L){ae(C,e,L),Z(e,n),n.checked=r[1],Z(e,s),ae(C,a,L),S&&S.m(C,L),ae(C,f,L),m=!0,l||(x=Pt(n,"change",r[8]),l=!0)},p(C,L){L&2&&(n.checked=C[1]),C[1]?S?(S.p(C,L),L&2&&_e(S,1)):(S=U0(C),S.c(),_e(S,1),S.m(f.parentNode,f)):S&&(Nn(),Ie(S,1,1,()=>{S=null}),zn())},i(C){m||(_e(S),m=!0)},o(C){Ie(S),m=!1},d(C){C&&(oe(e),oe(a),oe(f)),S&&S.d(C),l=!1,x()}}}function aL(r){let e,n,s=r[10].id+"",a,f,m=r[10].reachable?"is":"is not",l,x,S=r[10].population.toLocaleString()+"",C,L,N=r[10].imd_rank+"",B,U,ee=r[10].imd_percentile+"",ie,re;return{c(){e=ue("p"),n=Oe("Data zone "),a=Oe(s),f=Be(),l=Oe(m),x=Oe(" reachable. It has "),C=Oe(S),L=Oe(`
        people, and a SIMD rank of `),B=Oe(N),U=Oe(", putting it in the "),ie=Oe(ee),re=Oe(`
        percentile.`)},m(Q,$){ae(Q,e,$),Z(e,n),Z(e,a),Z(e,f),Z(e,l),Z(e,x),Z(e,C),Z(e,L),Z(e,B),Z(e,U),Z(e,ie),Z(e,re)},p(Q,$){$&1024&&s!==(s=Q[10].id+"")&&Mt(a,s),$&1024&&m!==(m=Q[10].reachable?"is":"is not")&&Mt(l,m),$&1024&&S!==(S=Q[10].population.toLocaleString()+"")&&Mt(C,S),$&1024&&N!==(N=Q[10].imd_rank+"")&&Mt(B,N),$&1024&&ee!==(ee=Q[10].imd_percentile+"")&&Mt(ie,ee)},d(Q){Q&&oe(e)}}}function lL(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[aL,({props:s})=>({10:s}),({props:s})=>s?1024:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&3072&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function uL(r){let e,n,s,a;return e=new mc({props:{manageHoverState:!0,paint:{"fill-color":Gf(["get","imd_percentile"],r[7],r[6]),"fill-opacity":Ms(.7,.9)},layout:{visibility:r[1]?"visible":"none"},$$slots:{default:[lL]},$$scope:{ctx:r}}}),s=new mr({props:{filter:["!",["get","reachable"]],paint:{"line-color":"red","line-width":3},layout:{visibility:r[1]?"visible":"none"}}}),{c(){ot(e.$$.fragment),n=Be(),ot(s.$$.fragment)},m(f,m){rt(e,f,m),ae(f,n,m),rt(s,f,m),a=!0},p(f,m){const l={};m&2&&(l.layout={visibility:f[1]?"visible":"none"}),m&2048&&(l.$$scope={dirty:m,ctx:f}),e.$set(l);const x={};m&2&&(x.layout={visibility:f[1]?"visible":"none"}),s.$set(x)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(n),st(e,f),st(s,f)}}}function cL(r){let e,n,s,a;return e=new to({props:{name:"simd",$$slots:{default:[oL]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[uL]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),n=Be(),ot(s.$$.fragment)},m(f,m){rt(e,f,m),ae(f,n,m),rt(s,f,m),a=!0},p(f,[m]){const l={};m&2079&&(l.$$scope={dirty:m,ctx:f}),e.$set(l);const x={};m&1&&(x.data=f[0]),m&2050&&(x.$$scope={dirty:m,ctx:f}),s.$set(x)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(n),st(e,f),st(s,f)}}}function hL(r,e,n){let s,a,f,m,l;Ot(r,Yf,B=>n(1,m=B)),Ot(r,sr,B=>n(9,l=B));let x={type:"FeatureCollection",features:[]};async function S(){if(l){let B=await l.getDataZones();B.features=B.features.filter(U=>U.properties.imd_percentile<=20),n(0,x=B)}}let C=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],L=[0,4,8,12,16,20];function N(){m=this.checked,Yf.set(m)}return r.$$.update=()=>{r.$$.dirty&3&&m&&x.features.length==0&&S(),r.$$.dirty&1&&n(4,s=ed(x.features.map(B=>B.properties.population))),r.$$.dirty&1&&n(3,a=x.features.filter(B=>B.properties.reachable).length),r.$$.dirty&1&&n(2,f=ed(x.features.filter(B=>B.properties.reachable).map(B=>B.properties.population)))},[x,m,f,a,s,S,C,L,N]}class fL extends fn{constructor(e){super(),hn(this,e,hL,cL,un,{})}}function j0(r){let e,n,s,a=r[3].toLocaleString()+"",f,m,l=r[0].features.length.toLocaleString()+"",x,S,C=r[2].toLocaleString()+"",L,N,B=r[4].toLocaleString()+"",U,ee,ie=wr(r[2],r[4])+"",re,Q,$,pe,ve,De,he,xe,be;return pe=new em({props:{colorScale:r[6],limits:r[7]}}),{c(){e=ue("button"),e.textContent="Recalculate",n=Be(),s=ue("p"),f=Oe(a),m=Oe(" / "),x=Oe(l),S=Oe(` zones
      reachable. That's `),L=Oe(C),N=Oe(" / "),U=Oe(B),ee=Oe(`
      (`),re=Oe(ie),Q=Oe(") of the population."),$=Be(),ot(pe.$$.fragment),ve=Be(),De=ue("p"),De.textContent=`Darker colours are denser. Zones with a red outline are not reachable by
      the current network. Only the top 3 densest quintiles are shown.`,He(e,"class","outline")},m(Le,we){ae(Le,e,we),ae(Le,n,we),ae(Le,s,we),Z(s,f),Z(s,m),Z(s,x),Z(s,S),Z(s,L),Z(s,N),Z(s,U),Z(s,ee),Z(s,re),Z(s,Q),ae(Le,$,we),rt(pe,Le,we),ae(Le,ve,we),ae(Le,De,we),he=!0,xe||(be=Pt(e,"click",r[5]),xe=!0)},p(Le,we){(!he||we&8)&&a!==(a=Le[3].toLocaleString()+"")&&Mt(f,a),(!he||we&1)&&l!==(l=Le[0].features.length.toLocaleString()+"")&&Mt(x,l),(!he||we&4)&&C!==(C=Le[2].toLocaleString()+"")&&Mt(L,C),(!he||we&16)&&B!==(B=Le[4].toLocaleString()+"")&&Mt(U,B),(!he||we&20)&&ie!==(ie=wr(Le[2],Le[4])+"")&&Mt(re,ie)},i(Le){he||(_e(pe.$$.fragment,Le),he=!0)},o(Le){Ie(pe.$$.fragment,Le),he=!1},d(Le){Le&&(oe(e),oe(n),oe(s),oe($),oe(ve),oe(De)),st(pe,Le),xe=!1,be()}}}function dL(r){let e,n,s,a,f,m,l,x,S=r[1]&&j0(r);return{c(){e=ue("label"),n=ue("input"),s=Oe(`
    Population`),a=Be(),S&&S.c(),f=ni(),He(n,"type","checkbox")},m(C,L){ae(C,e,L),Z(e,n),n.checked=r[1],Z(e,s),ae(C,a,L),S&&S.m(C,L),ae(C,f,L),m=!0,l||(x=Pt(n,"change",r[9]),l=!0)},p(C,L){L&2&&(n.checked=C[1]),C[1]?S?(S.p(C,L),L&2&&_e(S,1)):(S=j0(C),S.c(),_e(S,1),S.m(f.parentNode,f)):S&&(Nn(),Ie(S,1,1,()=>{S=null}),zn())},i(C){m||(_e(S),m=!0)},o(C){Ie(S),m=!1},d(C){C&&(oe(e),oe(a),oe(f)),S&&S.d(C),l=!1,x()}}}function pL(r){let e,n,s=r[11].id+"",a,f,m=r[11].reachable?"is":"is not",l,x,S=r[11].population.toLocaleString()+"",C,L,N=Math.round(r[11].population/r[11].area_km2).toLocaleString()+"",B,U,ee=r[11].density_quintile+"",ie,re;return{c(){e=ue("p"),n=Oe("Data zone "),a=Oe(s),f=Be(),l=Oe(m),x=Oe(" reachable. It has "),C=Oe(S),L=Oe(`
        people, with a density of `),B=Oe(N),U=Oe(" people per square kilometer, putting it in quintile "),ie=Oe(ee),re=Oe(`
        for this study area.`),Un(e,"max-width","30vw")},m(Q,$){ae(Q,e,$),Z(e,n),Z(e,a),Z(e,f),Z(e,l),Z(e,x),Z(e,C),Z(e,L),Z(e,B),Z(e,U),Z(e,ie),Z(e,re)},p(Q,$){$&2048&&s!==(s=Q[11].id+"")&&Mt(a,s),$&2048&&m!==(m=Q[11].reachable?"is":"is not")&&Mt(l,m),$&2048&&S!==(S=Q[11].population.toLocaleString()+"")&&Mt(C,S),$&2048&&N!==(N=Math.round(Q[11].population/Q[11].area_km2).toLocaleString()+"")&&Mt(B,N),$&2048&&ee!==(ee=Q[11].density_quintile+"")&&Mt(ie,ee)},d(Q){Q&&oe(e)}}}function mL(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[pL,({props:s})=>({11:s}),({props:s})=>s?2048:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&6144&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function gL(r){let e,n,s,a;return e=new mc({props:{manageHoverState:!0,paint:{"fill-color":Gf(["get","density_quintile"],r[7],r[6]),"fill-opacity":r[8]},layout:{visibility:r[1]?"visible":"none"},$$slots:{default:[mL]},$$scope:{ctx:r}}}),s=new mr({props:{filter:["!",["get","reachable"]],paint:{"line-color":"red","line-width":3},layout:{visibility:r[1]?"visible":"none"}}}),{c(){ot(e.$$.fragment),n=Be(),ot(s.$$.fragment)},m(f,m){rt(e,f,m),ae(f,n,m),rt(s,f,m),a=!0},p(f,m){const l={};m&2&&(l.layout={visibility:f[1]?"visible":"none"}),m&4096&&(l.$$scope={dirty:m,ctx:f}),e.$set(l);const x={};m&2&&(x.layout={visibility:f[1]?"visible":"none"}),s.$set(x)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(n),st(e,f),st(s,f)}}}function _L(r){let e,n,s,a;return e=new to({props:{name:"population density",$$slots:{default:[dL]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[0],generateId:!0,$$slots:{default:[gL]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),n=Be(),ot(s.$$.fragment)},m(f,m){rt(e,f,m),ae(f,n,m),rt(s,f,m),a=!0},p(f,[m]){const l={};m&4127&&(l.$$scope={dirty:m,ctx:f}),e.$set(l);const x={};m&1&&(x.data=f[0]),m&4098&&(x.$$scope={dirty:m,ctx:f}),s.$set(x)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(n),st(e,f),st(s,f)}}}function yL(r,e,n){let s,a,f,m,l;Ot(r,Jf,U=>n(1,m=U)),Ot(r,sr,U=>n(10,l=U));let x={type:"FeatureCollection",features:[]};async function S(){l&&n(0,x=await l.getDataZones())}let C=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],L=[0,1,2,3,4,5],N=Ms(["case",["<",["get","density_quintile"],4],.5,0],.9);function B(){m=this.checked,Jf.set(m)}return r.$$.update=()=>{r.$$.dirty&3&&m&&x.features.length==0&&S(),r.$$.dirty&1&&n(4,s=ed(x.features.map(U=>U.properties.population))),r.$$.dirty&1&&n(3,a=x.features.filter(U=>U.properties.reachable).length),r.$$.dirty&1&&n(2,f=ed(x.features.filter(U=>U.properties.reachable).map(U=>U.properties.population)))},[x,m,f,a,s,S,C,L,N,B]}class vL extends fn{constructor(e){super(),hn(this,e,yL,_L,un,{})}}function V0(r){let e,n,s,a,f,m,l,x,S,C,L,N,B,U,ee,ie,re,Q,$,pe=r[0].total_quintile_sums.length>0&&q0(r);return{c(){e=ue("div"),n=ue("button"),n.textContent="Recalculate",s=Be(),a=ue("label"),f=ue("input"),m=Oe(`
        Only show routes covered by current edits`),l=Be(),x=ue("label"),S=Oe(`Only show quintile:
        `),C=ue("select"),L=ue("option"),L.textContent="Show all",N=ue("option"),N.textContent="1",B=ue("option"),B.textContent="2",U=ue("option"),U.textContent="3",ee=ue("option"),ee.textContent="4",ie=ue("option"),ie.textContent="5",re=Be(),pe&&pe.c(),He(n,"class","outline"),He(f,"type","checkbox"),L.__value="",zi(L,L.__value),N.__value="1",zi(N,N.__value),B.__value="2",zi(B,B.__value),U.__value="3",zi(U,U.__value),ee.__value="4",zi(ee,ee.__value),ie.__value="5",zi(ie,ie.__value),r[3]===void 0&&Po(()=>r[7].call(C)),Un(e,"border","1px solid black"),Un(e,"padding","4px")},m(ve,De){ae(ve,e,De),Z(e,n),Z(e,s),Z(e,a),Z(a,f),f.checked=r[2],Z(a,m),Z(e,l),Z(e,x),Z(x,S),Z(x,C),Z(C,L),Z(C,N),Z(C,B),Z(C,U),Z(C,ee),Z(C,ie),fs(C,r[3],!0),Z(e,re),pe&&pe.m(e,null),Q||($=[Pt(n,"click",r[4]),Pt(f,"change",r[6]),Pt(C,"change",r[7])],Q=!0)},p(ve,De){De&4&&(f.checked=ve[2]),De&8&&fs(C,ve[3]),ve[0].total_quintile_sums.length>0?pe?pe.p(ve,De):(pe=q0(ve),pe.c(),pe.m(e,null)):pe&&(pe.d(1),pe=null)},d(ve){ve&&oe(e),pe&&pe.d(),Q=!1,$i($)}}}function q0(r){let e,n,s,a,f,m=wr(r[0].covered_quintile_sums[0],r[0].total_quintile_sums[0])+"",l,x,S,C,L=wr(r[0].covered_quintile_sums[1],r[0].total_quintile_sums[1])+"",N,B,U,ee,ie=wr(r[0].covered_quintile_sums[2],r[0].total_quintile_sums[2])+"",re,Q,$,pe,ve=wr(r[0].covered_quintile_sums[3],r[0].total_quintile_sums[3])+"",De,he,xe,be,Le=wr(r[0].covered_quintile_sums[4],r[0].total_quintile_sums[4])+"",we;return{c(){e=ue("p"),e.textContent="Flow covered by current edits",n=Be(),s=ue("ul"),a=ue("li"),f=Oe("Quintile 1: "),l=Oe(m),x=Be(),S=ue("li"),C=Oe("Quintile 2: "),N=Oe(L),B=Be(),U=ue("li"),ee=Oe("Quintile 3: "),re=Oe(ie),Q=Be(),$=ue("li"),pe=Oe("Quintile 4: "),De=Oe(ve),he=Be(),xe=ue("li"),be=Oe("Quintile 5: "),we=Oe(Le)},m(ye,Ue){ae(ye,e,Ue),ae(ye,n,Ue),ae(ye,s,Ue),Z(s,a),Z(a,f),Z(a,l),Z(s,x),Z(s,S),Z(S,C),Z(S,N),Z(s,B),Z(s,U),Z(U,ee),Z(U,re),Z(s,Q),Z(s,$),Z($,pe),Z($,De),Z(s,he),Z(s,xe),Z(xe,be),Z(xe,we)},p(ye,Ue){Ue&1&&m!==(m=wr(ye[0].covered_quintile_sums[0],ye[0].total_quintile_sums[0])+"")&&Mt(l,m),Ue&1&&L!==(L=wr(ye[0].covered_quintile_sums[1],ye[0].total_quintile_sums[1])+"")&&Mt(N,L),Ue&1&&ie!==(ie=wr(ye[0].covered_quintile_sums[2],ye[0].total_quintile_sums[2])+"")&&Mt(re,ie),Ue&1&&ve!==(ve=wr(ye[0].covered_quintile_sums[3],ye[0].total_quintile_sums[3])+"")&&Mt(De,ve),Ue&1&&Le!==(Le=wr(ye[0].covered_quintile_sums[4],ye[0].total_quintile_sums[4])+"")&&Mt(we,Le)},d(ye){ye&&(oe(e),oe(n),oe(s))}}}function bL(r){let e,n,s,a,f,m,l,x=r[1]&&V0(r);return{c(){e=ue("label"),n=ue("input"),s=Oe(`
    High NPT route coverage`),a=Be(),x&&x.c(),f=ni(),He(n,"type","checkbox")},m(S,C){ae(S,e,C),Z(e,n),n.checked=r[1],Z(e,s),ae(S,a,C),x&&x.m(S,C),ae(S,f,C),m||(l=Pt(n,"change",r[5]),m=!0)},p(S,C){C&2&&(n.checked=S[1]),S[1]?x?x.p(S,C):(x=V0(S),x.c(),x.m(f.parentNode,f)):x&&(x.d(1),x=null)},d(S){S&&(oe(e),oe(a),oe(f)),x&&x.d(S),m=!1,l()}}}function xL(r){let e,n=r[9].flow.toLocaleString()+"",s,a,f=r[9].quintile+"",m,l,x=r[9].covered+"",S;return{c(){e=Oe("Flow "),s=Oe(n),a=Oe(" is in quintile "),m=Oe(f),l=Oe(`,
      covered `),S=Oe(x)},m(C,L){ae(C,e,L),ae(C,s,L),ae(C,a,L),ae(C,m,L),ae(C,l,L),ae(C,S,L)},p(C,L){L&512&&n!==(n=C[9].flow.toLocaleString()+"")&&Mt(s,n),L&512&&f!==(f=C[9].quintile+"")&&Mt(m,f),L&512&&x!==(x=C[9].covered+"")&&Mt(S,x)},d(C){C&&(oe(e),oe(s),oe(a),oe(m),oe(l),oe(S))}}}function wL(r){let e,n;return e=new js({props:{openOn:"hover",$$slots:{default:[xL,({props:s})=>({9:s}),({props:s})=>s?512:0]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&1536&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function kL(r){let e,n;return e=new mr({props:{layout:{visibility:r[1]?"visible":"none"},filter:G0(r[2],r[3]),paint:{"line-width":td("flow"),"line-color":nm("flow")},$$slots:{default:[wL]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&2&&(f.layout={visibility:s[1]?"visible":"none"}),a&12&&(f.filter=G0(s[2],s[3])),a&1024&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function IL(r){let e,n,s,a;return e=new to({props:{name:"high npt route coverage",$$slots:{default:[bL]},$$scope:{ctx:r}}}),s=new rr({props:{data:r[0],$$slots:{default:[kL]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),n=Be(),ot(s.$$.fragment)},m(f,m){rt(e,f,m),ae(f,n,m),rt(s,f,m),a=!0},p(f,[m]){const l={};m&1039&&(l.$$scope={dirty:m,ctx:f}),e.$set(l);const x={};m&1&&(x.data=f[0]),m&1038&&(x.$$scope={dirty:m,ctx:f}),s.$set(x)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(n),st(e,f),st(s,f)}}}function G0(r,e){let n=["all"];return r&&n.push(["get","covered"]),e.length>0&&n.push(["==",["get","quintile"],parseInt(e)]),n}function SL(r,e,n){let s,a;Ot(r,Ku,N=>n(1,s=N)),Ot(r,sr,N=>n(8,a=N));let f=!1,m="",l={type:"FeatureCollection",features:[],covered_quintile_sums:[],total_quintile_sums:[]};async function x(){a&&n(0,l=await a.renderPrecalculatedFlows())}function S(){s=this.checked,Ku.set(s)}function C(){f=this.checked,n(2,f)}function L(){m=_l(this),n(3,m)}return r.$$.update=()=>{r.$$.dirty&3&&s&&l.features.length==0&&x()},[l,s,f,m,x,S,C,L]}class EL extends fn{constructor(e){super(),hn(this,e,SL,IL,un,{})}}function TL(r){let e,n;return e=new Kp({props:{paint:{"circle-color":"purple","circle-radius":5},layout:{visibility:r[1]&&r[2].kind=="edit-route"?"visible":"none"}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&6&&(f.layout={visibility:s[1]&&s[2].kind=="edit-route"?"visible":"none"}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function CL(r){let e,n;return e=new rr({props:{data:r[0],$$slots:{default:[TL]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,[a]){const f={};a&1&&(f.data=s[0]),a&38&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function LL(r,e,n){let s,a,f;Ot(r,Fp,x=>n(1,s=x)),Ot(r,sr,x=>n(3,a=x)),Ot(r,Ni,x=>n(2,f=x));let m={type:"FeatureCollection",features:[]};async function l(){a&&n(0,m=await a.getMajorJunctions())}return r.$$.update=()=>{r.$$.dirty&3&&s&&m.features.length==0&&l()},[m,s,f]}class ML extends fn{constructor(e){super(),hn(this,e,LL,CL,un,{})}}function AL(r){let e,n,s,a,f,m,l,x,S,C,L,N,B,U,ee,ie,re,Q,$,pe,ve,De,he,xe,be,Le,we,ye;return e=new jT({}),s=new XT({}),f=new EL({}),l=new sC({}),S=new mC({}),L=new wC({}),B=new LC({}),ee=new DC({}),re=new $C({}),$=new sL({}),ve=new BC({}),he=new fL({}),be=new vL({}),we=new ML({}),{c(){ot(e.$$.fragment),n=Be(),ot(s.$$.fragment),a=Be(),ot(f.$$.fragment),m=Be(),ot(l.$$.fragment),x=Be(),ot(S.$$.fragment),C=Be(),ot(L.$$.fragment),N=Be(),ot(B.$$.fragment),U=Be(),ot(ee.$$.fragment),ie=Be(),ot(re.$$.fragment),Q=Be(),ot($.$$.fragment),pe=Be(),ot(ve.$$.fragment),De=Be(),ot(he.$$.fragment),xe=Be(),ot(be.$$.fragment),Le=Be(),ot(we.$$.fragment)},m(Ue,Ve){rt(e,Ue,Ve),ae(Ue,n,Ve),rt(s,Ue,Ve),ae(Ue,a,Ve),rt(f,Ue,Ve),ae(Ue,m,Ve),rt(l,Ue,Ve),ae(Ue,x,Ve),rt(S,Ue,Ve),ae(Ue,C,Ve),rt(L,Ue,Ve),ae(Ue,N,Ve),rt(B,Ue,Ve),ae(Ue,U,Ve),rt(ee,Ue,Ve),ae(Ue,ie,Ve),rt(re,Ue,Ve),ae(Ue,Q,Ve),rt($,Ue,Ve),ae(Ue,pe,Ve),rt(ve,Ue,Ve),ae(Ue,De,Ve),rt(he,Ue,Ve),ae(Ue,xe,Ve),rt(be,Ue,Ve),ae(Ue,Le,Ve),rt(we,Ue,Ve),ye=!0},p:tt,i(Ue){ye||(_e(e.$$.fragment,Ue),_e(s.$$.fragment,Ue),_e(f.$$.fragment,Ue),_e(l.$$.fragment,Ue),_e(S.$$.fragment,Ue),_e(L.$$.fragment,Ue),_e(B.$$.fragment,Ue),_e(ee.$$.fragment,Ue),_e(re.$$.fragment,Ue),_e($.$$.fragment,Ue),_e(ve.$$.fragment,Ue),_e(he.$$.fragment,Ue),_e(be.$$.fragment,Ue),_e(we.$$.fragment,Ue),ye=!0)},o(Ue){Ie(e.$$.fragment,Ue),Ie(s.$$.fragment,Ue),Ie(f.$$.fragment,Ue),Ie(l.$$.fragment,Ue),Ie(S.$$.fragment,Ue),Ie(L.$$.fragment,Ue),Ie(B.$$.fragment,Ue),Ie(ee.$$.fragment,Ue),Ie(re.$$.fragment,Ue),Ie($.$$.fragment,Ue),Ie(ve.$$.fragment,Ue),Ie(he.$$.fragment,Ue),Ie(be.$$.fragment,Ue),Ie(we.$$.fragment,Ue),ye=!1},d(Ue){Ue&&(oe(n),oe(a),oe(m),oe(x),oe(C),oe(N),oe(U),oe(ie),oe(Q),oe(pe),oe(De),oe(xe),oe(Le)),st(e,Ue),st(s,Ue),st(f,Ue),st(l,Ue),st(S,Ue),st(L,Ue),st(B,Ue),st(ee,Ue),st(re,Ue),st($,Ue),st(ve,Ue),st(he,Ue),st(be,Ue),st(we,Ue)}}}class PL extends fn{constructor(e){super(),hn(this,e,null,AL,un,{})}}function RL(r){let e,n,s;return n=new CT({}),{c(){e=ue("div"),ot(n.$$.fragment),He(e,"slot","top")},m(a,f){ae(a,e,f),rt(n,e,null),s=!0},p:tt,i(a){s||(_e(n.$$.fragment,a),s=!0)},o(a){Ie(n.$$.fragment,a),s=!1},d(a){a&&oe(e),st(n)}}}function DL(r){let e,n;return{c(){e=ue("div"),n=ue("div"),He(e,"slot","left")},m(s,a){ae(s,e,a),Z(e,n),r[14](n)},p:tt,d(s){s&&oe(e),r[14](null)}}}function NL(r){let e,n;return e=new G2({props:{map:r[0],apiKey:$v}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&1&&(f.map=s[0]),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function Z0(r){let e,n,s,a,f,m,l,x,S={ctx:r,current:null,token:null,hasCatch:!1,pending:BL,then:OL,catch:zL,value:21,blocks:[,,,]};gs(e=r[5].getInvertedBoundary(),S),s=new PL({});const C=[ZL,GL,qL,VL,jL,UL],L=[];function N(B,U){return B[6].kind=="main"?0:B[6].kind=="edit-route"&&B[0]?1:B[6].kind=="evaluate-route"?2:B[6].kind=="evaluate-od"?3:B[6].kind=="debug-network"?4:B[6].kind=="debug-mesh-density"?5:-1}return~(f=N(r))&&(m=L[f]=C[f](r)),{c(){S.block.c(),n=Be(),ot(s.$$.fragment),a=Be(),m&&m.c(),l=ni()},m(B,U){S.block.m(B,S.anchor=U),S.mount=()=>n.parentNode,S.anchor=n,ae(B,n,U),rt(s,B,U),ae(B,a,U),~f&&L[f].m(B,U),ae(B,l,U),x=!0},p(B,U){r=B,S.ctx=r,U&32&&e!==(e=r[5].getInvertedBoundary())&&gs(e,S)||kl(S,r,U);let ee=f;f=N(r),f===ee?~f&&L[f].p(r,U):(m&&(Nn(),Ie(L[ee],1,1,()=>{L[ee]=null}),zn()),~f?(m=L[f],m?m.p(r,U):(m=L[f]=C[f](r),m.c()),_e(m,1),m.m(l.parentNode,l)):m=null)},i(B){x||(_e(S.block),_e(s.$$.fragment,B),_e(m),x=!0)},o(B){for(let U=0;U<3;U+=1){const ee=S.blocks[U];Ie(ee)}Ie(s.$$.fragment,B),Ie(m),x=!1},d(B){B&&(oe(n),oe(a),oe(l)),S.block.d(B),S.token=null,S=null,st(s,B),~f&&L[f].d(B)}}}function zL(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function OL(r){let e,n;return e=new rr({props:{data:r[21],$$slots:{default:[FL]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&32&&(f.data=s[21]),a&4194304&&(f.$$scope={dirty:a,ctx:s}),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function FL(r){let e,n;return e=new mc({props:{paint:{"fill-color":"black","fill-opacity":.3}}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p:tt,i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function BL(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function UL(r){let e,n;return e=new OS({}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p:tt,i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function jL(r){let e,n;return e=new CS({}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p:tt,i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function VL(r){let e,n;return e=new bT({}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p:tt,i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function qL(r){let e,n;return e=new fT({props:{browse:r[6].browse}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&64&&(f.browse=s[6].browse),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function GL(r){let e,n;return e=new YE({props:{id:r[6].id,map:r[0]}}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p(s,a){const f={};a&64&&(f.id=s[6].id),a&1&&(f.map=s[0]),e.$set(f)},i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function ZL(r){let e,n;return e=new lE({}),{c(){ot(e.$$.fragment)},m(s,a){rt(e,s,a),n=!0},p:tt,i(s){n||(_e(e.$$.fragment,s),n=!0)},o(s){Ie(e.$$.fragment,s),n=!1},d(s){st(e,s)}}}function HL(r){let e,n,s,a,f,m,l,x=NL(r);n=new fE({});let S=r[5]&&Z0(r);return{c(){x&&x.c(),e=Be(),ot(n.$$.fragment),s=Be(),a=ue("div"),f=Be(),S&&S.c(),m=ni()},m(C,L){x&&x.m(C,L),ae(C,e,L),rt(n,C,L),ae(C,s,L),ae(C,a,L),r[11](a),ae(C,f,L),S&&S.m(C,L),ae(C,m,L),l=!0},p(C,L){x.p(C,L),C[5]?S?(S.p(C,L),L&32&&_e(S,1)):(S=Z0(C),S.c(),_e(S,1),S.m(m.parentNode,m)):S&&(Nn(),Ie(S,1,1,()=>{S=null}),zn())},i(C){l||(_e(x),_e(n.$$.fragment,C),_e(S),l=!0)},o(C){Ie(x),Ie(n.$$.fragment,C),Ie(S),l=!1},d(C){C&&(oe(e),oe(s),oe(a),oe(f),oe(m)),x&&x.d(C),st(n,C),r[11](null),S&&S.d(C)}}}function WL(r){let e,n,s,a;function f(l){r[12](l)}let m={style:`https://api.maptiler.com/maps/uk-openzoomstack-light/style.json?key=${$v}`,standardControls:!0,$$slots:{default:[HL]},$$scope:{ctx:r}};return r[0]!==void 0&&(m.map=r[0]),n=new CI({props:m}),Jn.push(()=>Ir(n,"map",f)),n.$on("error",r[13]),{c(){e=ue("div"),ot(n.$$.fragment),He(e,"slot","main"),Un(e,"position","relative"),Un(e,"width","100%"),Un(e,"height","100%")},m(l,x){ae(l,e,x),rt(n,e,null),a=!0},p(l,x){const S={};x&4194405&&(S.$$scope={dirty:x,ctx:l}),!s&&x&1&&(s=!0,S.map=l[0],kr(()=>s=!1)),n.$set(S)},i(l){a||(_e(n.$$.fragment,l),a=!0)},o(l){Ie(n.$$.fragment,l),a=!1},d(l){l&&oe(e),st(n)}}}function XL(r){let e,n;return{c(){e=ue("div"),n=ue("div"),He(e,"slot","right")},m(s,a){ae(s,e,a),Z(e,n),r[10](n)},p:tt,d(s){s&&oe(e),r[10](null)}}}function $L(r){let e,n,s,a;return e=new $I({props:{loading:r[4]}}),s=new jI({props:{$$slots:{right:[XL],main:[WL],left:[DL],top:[RL]},$$scope:{ctx:r}}}),{c(){ot(e.$$.fragment),n=Be(),ot(s.$$.fragment)},m(f,m){rt(e,f,m),ae(f,n,m),rt(s,f,m),a=!0},p(f,[m]){const l={};m&16&&(l.loading=f[4]),e.$set(l);const x={};m&4194415&&(x.$$scope={dirty:m,ctx:f}),s.$set(x)},i(f){a||(_e(e.$$.fragment,f),_e(s.$$.fragment,f),a=!0)},o(f){Ie(e.$$.fragment,f),Ie(s.$$.fragment,f),a=!1},d(f){f&&oe(n),st(e,f),st(s,f)}}}function Ef(r,e,n){return e+r*(n-e)}function YL(r,e,n){let s,a,f,m,l,x,S,C,L,N;Ot(r,Rp,xe=>n(7,s=xe)),Ot(r,Dp,xe=>n(8,a=xe)),Ot(r,Pp,xe=>n(9,f=xe)),Ot(r,sr,xe=>n(5,m=xe)),Ot(r,Qf,xe=>n(15,l=xe)),Ot(r,Sh,xe=>n(16,x=xe)),Ot(r,Ju,xe=>n(17,S=xe)),Ot(r,Hf,xe=>n(18,C=xe)),Ot(r,zp,xe=>n(19,L=xe)),Ot(r,Ni,xe=>n(6,N=xe));let B="",U;cc(async()=>{await Qv();let xe=new URLSearchParams(window.location.search);Dn(Hf,C=xe.get("boundary")||"LAD_City of Edinburgh",C),n(4,B=`Loading ${C}`);let be=new gS,Le=await fetch(`areas/${C}.bin`);Le.ok?(console.log("Using locally hosted files"),Dn(zp,L=!1,L)):(console.log("Using remote hosted files"),Le=await fetch(sd(`areas/${C}.bin`)));let we=await Le.arrayBuffer();try{await be.loadFile(new Uint8Array(we))}catch(Ve){window.alert(`Couldn't load: ${Ve}`)}let ye=window.localStorage.getItem(`tmp-npt-editor/${C}`);if(ye)try{await be.loadSavefile(ye)}catch(Ve){window.alert(`Couldn't restore saved state: ${Ve}`)}n(4,B="");let Ue=await be.getBounds();Dn(Ju,S={lng:Ef(.4,Ue[0],Ue[2]),lat:Ef(.4,Ue[1],Ue[3])},S),Dn(Sh,x={lng:Ef(.6,Ue[0],Ue[2]),lat:Ef(.6,Ue[1],Ue[3])},x),Dn(Qf,l=new TE(U,be.toRouteSnapper(),Yn(Af()),Yn(!0),Yn(0)),l),sr.set(be),await ee()});async function ee(){U&&m&&U.fitBounds(await m.getBounds(),{animate:!1})}let ie,re,Q;function $(xe){Jn[xe?"unshift":"push"](()=>{Q=xe,n(3,Q),n(7,s)})}function pe(xe){Jn[xe?"unshift":"push"](()=>{re=xe,n(2,re),n(8,a)})}function ve(xe){U=xe,n(0,U)}const De=xe=>{console.log(xe.detail.error)};function he(xe){Jn[xe?"unshift":"push"](()=>{ie=xe,n(1,ie),n(9,f)})}return r.$$.update=()=>{r.$$.dirty&1&&U&&_S.set(U),r.$$.dirty&514&&ie&&f&&(n(1,ie.innerHTML="",ie),ie.appendChild(f)),r.$$.dirty&260&&re&&a&&(n(2,re.innerHTML="",re),re.appendChild(a)),r.$$.dirty&136&&Q&&s&&(n(3,Q.innerHTML="",Q),Q.appendChild(s))},[U,ie,re,Q,B,m,N,s,a,f,$,pe,ve,De,he]}class JL extends fn{constructor(e){super(),hn(this,e,YL,$L,un,{})}}new JL({target:document.getElementById("app")});
