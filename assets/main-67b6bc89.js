var jv=Object.defineProperty;var Uv=(o,e,t)=>e in o?jv(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Eu=(o,e,t)=>(Uv(o,typeof e!="symbol"?e+"":e,t),t);function $v(o,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const l in n)if(l!=="default"&&!(l in o)){const u=Object.getOwnPropertyDescriptor(n,l);u&&Object.defineProperty(o,l,u.get?u:{enumerable:!0,get:()=>n[l]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function t(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function n(l){if(l.ep)return;l.ep=!0;const u=t(l);fetch(l.href,u)}})();function Ze(){}function Vv(o,e){for(const t in e)o[t]=e[t];return o}function qv(o){return!!o&&(typeof o=="object"||typeof o=="function")&&typeof o.then=="function"}function H0(o){return o()}function O_(){return Object.create(null)}function an(o){o.forEach(H0)}function Ja(o){return typeof o=="function"}function Vt(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}let ld;function Mr(o,e){return o===e?!0:(ld||(ld=document.createElement("a")),ld.href=e,o===ld.href)}function Zv(o){return Object.keys(o).length===0}function X0(o,...e){if(o==null){for(const n of e)n(void 0);return Ze}const t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function xd(o){let e;return X0(o,t=>e=t)(),e}function bt(o,e,t){o.$$.on_destroy.push(X0(e,t))}function fn(o,e,t,n){if(o){const l=K0(o,e,t,n);return o[0](l)}}function K0(o,e,t,n){return o[1]&&n?Vv(t.ctx.slice(),o[1](n(e))):t.ctx}function pn(o,e,t,n){if(o[2]&&n){const l=o[2](n(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],d=Math.max(e.dirty.length,l.length);for(let a=0;a<d;a+=1)u[a]=e.dirty[a]|l[a];return u}return e.dirty|l}return e.dirty}function mn(o,e,t,n,l,u){if(l){const d=K0(e,t,n,u);o.p(d,l)}}function _n(o){if(o.ctx.length>32){const e=[],t=o.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function Gv(o){const e={};for(const t in o)e[t]=!0;return e}function kd(o){return o??""}function oi(o,e,t){return o.set(t),e}function dp(o){return o&&Ja(o.destroy)?o.destroy:Ze}const J0=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function F(o,e){o.appendChild(e)}function J(o,e,t){o.insertBefore(e,t||null)}function X(o){o.parentNode&&o.parentNode.removeChild(o)}function Bn(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function ee(o){return document.createElement(o)}function bs(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function be(o){return document.createTextNode(o)}function we(){return be(" ")}function Ei(){return be("")}function ft(o,e,t,n){return o.addEventListener(e,t,n),()=>o.removeEventListener(e,t,n)}function ih(o){return function(e){return e.preventDefault(),o.call(this,e)}}function ip(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function Pe(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function N_(o){let e;return{p(...t){e=t,e.forEach(n=>o.push(n))},r(){e.forEach(t=>o.splice(o.indexOf(t),1))}}}function Wv(o){return Array.from(o.childNodes)}function pt(o,e){e=""+e,o.data!==e&&(o.data=e)}function Vi(o,e){o.value=e??""}function mi(o,e,t,n){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,n?"important":"")}function lr(o,e,t){for(let n=0;n<o.options.length;n+=1){const l=o.options[n];if(l.__value===e){l.selected=!0;return}}(!t||e!==void 0)&&(o.selectedIndex=-1)}function gs(o){const e=o.querySelector(":checked");return e&&e.__value}function cr(o,e,t){o.classList.toggle(e,!!t)}function Hv(o,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:n})}let Wu;function ys(o){Wu=o}function dc(){if(!Wu)throw new Error("Function called outside component initialization");return Wu}function fc(o){dc().$$.on_mount.push(o)}function Lo(o){dc().$$.on_destroy.push(o)}function pc(){const o=dc();return(e,t,{cancelable:n=!1}={})=>{const l=o.$$.callbacks[e];if(l){const u=Hv(e,t,{cancelable:n});return l.slice().forEach(d=>{d.call(o,u)}),!u.defaultPrevented}return!0}}function Y0(o,e){return dc().$$.context.set(o,e),e}function Q0(o){return dc().$$.context.get(o)}function zn(o,e){const t=o.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const ec=[],Ai=[];let oc=[];const fp=[],e1=Promise.resolve();let pp=!1;function t1(){pp||(pp=!0,e1.then(Bp))}function Xv(){return t1(),e1}function Co(o){oc.push(o)}function qn(o){fp.push(o)}const np=new Set;let Hl=0;function Bp(){if(Hl!==0)return;const o=Wu;do{try{for(;Hl<ec.length;){const e=ec[Hl];Hl++,ys(e),Kv(e.$$)}}catch(e){throw ec.length=0,Hl=0,e}for(ys(null),ec.length=0,Hl=0;Ai.length;)Ai.pop()();for(let e=0;e<oc.length;e+=1){const t=oc[e];np.has(t)||(np.add(t),t())}oc.length=0}while(ec.length);for(;fp.length;)fp.pop()();pp=!1,np.clear(),ys(o)}function Kv(o){if(o.fragment!==null){o.update(),an(o.before_update);const e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(Co)}}function Jv(o){const e=[],t=[];oc.forEach(n=>o.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),oc=e}const md=new Set;let Ha;function ui(){Ha={r:0,c:[],p:Ha}}function hi(){Ha.r||an(Ha.c),Ha=Ha.p}function ne(o,e){o&&o.i&&(md.delete(o),o.i(e))}function he(o,e,t,n){if(o&&o.o){if(md.has(o))return;md.add(o),Ha.c.push(()=>{md.delete(o),n&&(t&&o.d(1),n())}),o.o(e)}else n&&n()}function Ar(o,e){const t=e.token={};function n(l,u,d,a){if(e.token!==t)return;e.resolved=a;let g=e.ctx;d!==void 0&&(g=g.slice(),g[d]=a);const b=l&&(e.current=l)(g);let k=!1;e.block&&(e.blocks?e.blocks.forEach((S,L)=>{L!==u&&S&&(ui(),he(S,1,1,()=>{e.blocks[L]===S&&(e.blocks[L]=null)}),hi())}):e.block.d(1),b.c(),ne(b,1),b.m(e.mount(),e.anchor),k=!0),e.block=b,e.blocks&&(e.blocks[u]=b),k&&Bp()}if(qv(o)){const l=dc();if(o.then(u=>{ys(l),n(e.then,1,e.value,u),ys(null)},u=>{if(ys(l),n(e.catch,2,e.error,u),ys(null),!e.hasCatch)throw u}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,o),!0;e.resolved=o}}function pa(o,e,t){const n=e.slice(),{resolved:l}=o;o.current===o.then&&(n[o.value]=l),o.current===o.catch&&(n[o.error]=l),o.block.p(n,t)}function bi(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function Yv(o,e){he(o,1,1,()=>{e.delete(o.key)})}function Qv(o,e,t,n,l,u,d,a,g,b,k,S){let L=o.length,P=u.length,R=L;const Z={};for(;R--;)Z[o[R].key]=R;const $=[],H=new Map,G=new Map,K=[];for(R=P;R--;){const te=S(l,u,R),Y=t(te);let ue=d.get(Y);ue?n&&K.push(()=>ue.p(te,e)):(ue=b(Y,te),ue.c()),H.set(Y,$[R]=ue),Y in Z&&G.set(Y,Math.abs(R-Z[Y]))}const le=new Set,Se=new Set;function Le(te){ne(te,1),te.m(a,k),d.set(te.key,te),k=te.first,P--}for(;L&&P;){const te=$[P-1],Y=o[L-1],ue=te.key,fe=Y.key;te===Y?(k=te.first,L--,P--):H.has(fe)?!d.has(ue)||le.has(ue)?Le(te):Se.has(fe)?L--:G.get(ue)>G.get(fe)?(Se.add(ue),Le(te)):(le.add(fe),L--):(g(Y,d),L--)}for(;L--;){const te=o[L];H.has(te.key)||g(te,d)}for(;P;)Le($[P-1]);return an(K),$}function Zn(o,e,t){const n=o.$$.props[e];n!==void 0&&(o.$$.bound[n]=t,t(o.$$.ctx[n]))}function Ve(o){o&&o.c()}function je(o,e,t){const{fragment:n,after_update:l}=o.$$;n&&n.m(e,t),Co(()=>{const u=o.$$.on_mount.map(H0).filter(Ja);o.$$.on_destroy?o.$$.on_destroy.push(...u):an(u),o.$$.on_mount=[]}),l.forEach(Co)}function Ue(o,e){const t=o.$$;t.fragment!==null&&(Jv(t.after_update),an(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function ew(o,e){o.$$.dirty[0]===-1&&(ec.push(o),t1(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function Gt(o,e,t,n,l,u,d=null,a=[-1]){const g=Wu;ys(o);const b=o.$$={fragment:null,ctx:[],props:u,update:Ze,not_equal:l,bound:O_(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(g?g.$$.context:[])),callbacks:O_(),dirty:a,skip_bound:!1,root:e.target||g.$$.root};d&&d(b.root);let k=!1;if(b.ctx=t?t(o,e.props||{},(S,L,...P)=>{const R=P.length?P[0]:L;return b.ctx&&l(b.ctx[S],b.ctx[S]=R)&&(!b.skip_bound&&b.bound[S]&&b.bound[S](R),k&&ew(o,S)),L}):[],b.update(),k=!0,an(b.before_update),b.fragment=n?n(b.ctx):!1,e.target){if(e.hydrate){const S=Wv(e.target);b.fragment&&b.fragment.l(S),S.forEach(X)}else b.fragment&&b.fragment.c();e.intro&&ne(o.$$.fragment),je(o,e.target,e.anchor),Bp()}ys(g)}class Wt{constructor(){Eu(this,"$$");Eu(this,"$$set")}$destroy(){Ue(this,1),this.$destroy=Ze}$on(e,t){if(!Ja(t))return Ze;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const l=n.indexOf(t);l!==-1&&n.splice(l,1)}}$set(e){this.$$set&&!Zv(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const tw="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(tw);var iw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function nw(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var i1={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.0/LICENSE.txt
 */(function(o,e){(function(t,n){o.exports=n()})(iw,function(){var t={},n={};function l(d,a,g){if(n[d]=g,d==="index"){var b="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",k={};return n.shared(k),n.index(t,k),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([b],{type:"text/javascript"}))),t}}l("shared",["exports"],function(d){function a(s,r,c,f){return new(c||(c=Promise))(function(_,w){function x(A){try{C(f.next(A))}catch(z){w(z)}}function T(A){try{C(f.throw(A))}catch(z){w(z)}}function C(A){var z;A.done?_(A.value):(z=A.value,z instanceof c?z:new c(function(B){B(z)})).then(x,T)}C((f=f.apply(s,r||[])).next())})}function g(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}typeof SuppressedError=="function"&&SuppressedError;var b=k;function k(s,r){this.x=s,this.y=r}k.prototype={clone:function(){return new k(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,r){return this.clone()._rotateAround(s,r)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var r=s.x-this.x,c=s.y-this.y;return r*r+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,r){return Math.atan2(this.x*r-this.y*s,this.x*s+this.y*r)},_matMult:function(s){var r=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=r,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var r=Math.cos(s),c=Math.sin(s),f=c*this.x+r*this.y;return this.x=r*this.x-c*this.y,this.y=f,this},_rotateAround:function(s,r){var c=Math.cos(s),f=Math.sin(s),_=r.y+f*(this.x-r.x)+c*(this.y-r.y);return this.x=r.x+c*(this.x-r.x)-f*(this.y-r.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},k.convert=function(s){return s instanceof k?s:Array.isArray(s)?new k(s[0],s[1]):s};var S=g(b),L=P;function P(s,r,c,f){this.cx=3*s,this.bx=3*(c-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(f-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=r,this.p2x=c,this.p2y=f}P.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,r){if(r===void 0&&(r=1e-6),s<0)return 0;if(s>1)return 1;for(var c=s,f=0;f<8;f++){var _=this.sampleCurveX(c)-s;if(Math.abs(_)<r)return c;var w=this.sampleCurveDerivativeX(c);if(Math.abs(w)<1e-6)break;c-=_/w}var x=0,T=1;for(c=s,f=0;f<20&&(_=this.sampleCurveX(c),!(Math.abs(_-s)<r));f++)s>_?x=c:T=c,c=.5*(T-x)+x;return c},solve:function(s,r){return this.sampleCurveY(this.solveCurveX(s,r))}};var R=g(L);let Z,$;function H(){return Z==null&&(Z=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Z}function G(){if($==null&&($=!1,H())){const r=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(r){for(let f=0;f<5*5;f++){const _=4*f;r.fillStyle=`rgb(${_},${_+1},${_+2})`,r.fillRect(f%5,Math.floor(f/5),1,1)}const c=r.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&c[f]!==f){$=!0;break}}}return $||!1}function K(s,r,c,f){const _=new R(s,r,c,f);return w=>_.solve(w)}const le=K(.25,.1,.25,1);function Se(s,r,c){return Math.min(c,Math.max(r,s))}function Le(s,r,c){const f=c-r,_=((s-r)%f+f)%f+r;return _===r?c:_}function te(s,...r){for(const c of r)for(const f in c)s[f]=c[f];return s}let Y=1;function ue(s,r,c){const f={};for(const _ in s)f[_]=r.call(this,s[_],_,s);return f}function fe(s,r,c){const f={};for(const _ in s)r.call(this,s[_],_,s)&&(f[_]=s[_]);return f}function ce(s){return Array.isArray(s)?s.map(ce):typeof s=="object"&&s?ue(s,ce):s}const ae={};function We(s){ae[s]||(typeof console<"u"&&console.warn(s),ae[s]=!0)}function Ee(s,r,c){return(c.y-s.y)*(r.x-s.x)>(r.y-s.y)*(c.x-s.x)}function ze(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let rt=null;function it(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const Qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ft(s,r,c,f,_){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const w=new VideoFrame(s,{timestamp:0});try{const x=w==null?void 0:w.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const T=x.startsWith("BGR"),C=new Uint8ClampedArray(f*_*4);if(yield w.copyTo(C,function(A,z,B,U,W){const ie=4*Math.max(-z,0),oe=(Math.max(0,B)-B)*U*4+ie,_e=4*U,ve=Math.max(0,z),Ge=Math.max(0,B);return{rect:{x:ve,y:Ge,width:Math.min(A.width,z+U)-ve,height:Math.min(A.height,B+W)-Ge},layout:[{offset:oe,stride:_e}]}}(s,r,c,f,_)),T)for(let A=0;A<C.length;A+=4){const z=C[A];C[A]=C[A+2],C[A+2]=z}return C}finally{w.close()}})}let jt,ut;const et="AbortError";function at(){return new Error(et)}const Bt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Dt(s){return Bt.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const Ht="global-dispatcher";class ai extends Error{constructor(r,c,f,_){super(`AJAXError: ${c} (${r}): ${f}`),this.status=r,this.statusText=c,this.url=f,this.body=_}}const si=()=>ze(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Si=function(s,r){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const f=Dt(s.url);if(f)return f(s,r);if(ze(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:Ht},r)}if(!(/^file:/.test(c=s.url)||/^file:/.test(si())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,_){return a(this,void 0,void 0,function*(){const w=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:si(),signal:_.signal});f.type!=="json"||w.headers.has("Accept")||w.headers.set("Accept","application/json");const x=yield fetch(w);if(!x.ok){const A=yield x.blob();throw new ai(x.status,x.statusText,f.url,A)}let T;T=f.type==="arrayBuffer"||f.type==="image"?x.arrayBuffer():f.type==="json"?x.json():x.text();const C=yield T;if(_.signal.aborted)throw at();return{data:C,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(s,r);if(ze(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:Ht},r)}var c;return function(f,_){return new Promise((w,x)=>{var T;const C=new XMLHttpRequest;C.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(C.responseType="arraybuffer");for(const A in f.headers)C.setRequestHeader(A,f.headers[A]);f.type==="json"&&(C.responseType="text",!((T=f.headers)===null||T===void 0)&&T.Accept||C.setRequestHeader("Accept","application/json")),C.withCredentials=f.credentials==="include",C.onerror=()=>{x(new Error(C.statusText))},C.onload=()=>{if(!_.signal.aborted)if((C.status>=200&&C.status<300||C.status===0)&&C.response!==null){let A=C.response;if(f.type==="json")try{A=JSON.parse(C.response)}catch(z){return void x(z)}w({data:A,cacheControl:C.getResponseHeader("Cache-Control"),expires:C.getResponseHeader("Expires")})}else{const A=new Blob([C.response],{type:C.getResponseHeader("Content-Type")});x(new ai(C.status,C.statusText,f.url,A))}},_.signal.addEventListener("abort",()=>{C.abort(),x(at())}),C.send(f.body)})}(s,r)};function Ri(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const r=new URL(s),c=window.location;return r.protocol===c.protocol&&r.host===c.host}function vi(s,r,c){c[s]&&c[s].indexOf(r)!==-1||(c[s]=c[s]||[],c[s].push(r))}function di(s,r,c){if(c&&c[s]){const f=c[s].indexOf(r);f!==-1&&c[s].splice(f,1)}}class lt{constructor(r,c={}){te(this,c),this.type=r}}class qe extends lt{constructor(r,c={}){super("error",te({error:r},c))}}class st{on(r,c){return this._listeners=this._listeners||{},vi(r,c,this._listeners),this}off(r,c){return di(r,c,this._listeners),di(r,c,this._oneTimeListeners),this}once(r,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},vi(r,c,this._oneTimeListeners),this):new Promise(f=>this.once(r,f))}fire(r,c){typeof r=="string"&&(r=new lt(r,c||{}));const f=r.type;if(this.listens(f)){r.target=this;const _=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const T of _)T.call(this,r);const w=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const T of w)di(f,T,this._oneTimeListeners),T.call(this,r);const x=this._eventedParent;x&&(te(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(r))}else r instanceof qe&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,c){return this._eventedParent=r,this._eventedParentData=c,this}}var Te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const mt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function yt(s,r){const c={};for(const f in s)f!=="ref"&&(c[f]=s[f]);return mt.forEach(f=>{f in r&&(c[f]=r[f])}),c}function Ie(s,r){if(Array.isArray(s)){if(!Array.isArray(r)||s.length!==r.length)return!1;for(let c=0;c<s.length;c++)if(!Ie(s[c],r[c]))return!1;return!0}if(typeof s=="object"&&s!==null&&r!==null){if(typeof r!="object"||Object.keys(s).length!==Object.keys(r).length)return!1;for(const c in s)if(!Ie(s[c],r[c]))return!1;return!0}return s===r}function nt(s,r){s.push(r)}function Xt(s,r,c){nt(c,{command:"addSource",args:[s,r[s]]})}function wi(s,r,c){nt(r,{command:"removeSource",args:[s]}),c[s]=!0}function Ni(s,r,c,f){wi(s,c,f),Xt(s,r,c)}function Li(s,r,c){let f;for(f in s[c])if(Object.prototype.hasOwnProperty.call(s[c],f)&&f!=="data"&&!Ie(s[c][f],r[c][f]))return!1;for(f in r[c])if(Object.prototype.hasOwnProperty.call(r[c],f)&&f!=="data"&&!Ie(s[c][f],r[c][f]))return!1;return!0}function gi(s,r,c,f,_,w){s=s||{},r=r||{};for(const x in s)Object.prototype.hasOwnProperty.call(s,x)&&(Ie(s[x],r[x])||c.push({command:w,args:[f,x,r[x],_]}));for(const x in r)Object.prototype.hasOwnProperty.call(r,x)&&!Object.prototype.hasOwnProperty.call(s,x)&&(Ie(s[x],r[x])||c.push({command:w,args:[f,x,r[x],_]}))}function Fi(s){return s.id}function _r(s,r){return s[r.id]=r,s}class ct{constructor(r,c,f,_){this.message=(r?`${r}: `:"")+f,_&&(this.identifier=_),c!=null&&c.__line__&&(this.line=c.__line__)}}function Yn(s,...r){for(const c of r)for(const f in c)s[f]=c[f];return s}class un extends Error{constructor(r,c){super(c),this.message=c,this.key=r}}class On{constructor(r,c=[]){this.parent=r,this.bindings={};for(const[f,_]of c)this.bindings[f]=_}concat(r){return new On(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const qr={kind:"null"},vt={kind:"number"},li={kind:"string"},Jt={kind:"boolean"},wn={kind:"color"},Dn={kind:"object"},ei={kind:"value"},gr={kind:"collator"},zr={kind:"formatted"},Zr={kind:"padding"},yr={kind:"resolvedImage"},ye={kind:"variableAnchorOffsetCollection"};function q(s,r){return{kind:"array",itemType:s,N:r}}function V(s){if(s.kind==="array"){const r=V(s.itemType);return typeof s.N=="number"?`array<${r}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${r}>`}return s.kind}const re=[qr,vt,li,Jt,wn,zr,Dn,q(ei),Zr,yr,ye];function pe(s,r){if(r.kind==="error")return null;if(s.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!pe(s.itemType,r.itemType))&&(typeof s.N!="number"||s.N===r.N))return null}else{if(s.kind===r.kind)return null;if(s.kind==="value"){for(const c of re)if(!pe(c,r))return null}}return`Expected ${V(s)} but found ${V(r)} instead.`}function Me(s,r){return r.some(c=>c.kind===s.kind)}function De(s,r){return r.some(c=>c==="null"?s===null:c==="array"?Array.isArray(s):c==="object"?s&&!Array.isArray(s)&&typeof s=="object":c===typeof s)}function $e(s,r){return s.kind==="array"&&r.kind==="array"?s.itemType.kind===r.itemType.kind&&typeof s.N=="number":s.kind===r.kind}const j=.96422,Fe=.82521,Ke=4/29,Ne=6/29,Xe=3*Ne*Ne,_t=Ne*Ne*Ne,Et=Math.PI/180,pi=180/Math.PI;function Qt(s){return(s%=360)<0&&(s+=360),s}function ci([s,r,c,f]){let _,w;const x=Ln((.2225045*(s=xi(s))+.7168786*(r=xi(r))+.0606169*(c=xi(c)))/1);s===r&&r===c?_=w=x:(_=Ln((.4360747*s+.3850649*r+.1430804*c)/j),w=Ln((.0139322*s+.0971045*r+.7141733*c)/Fe));const T=116*x-16;return[T<0?0:T,500*(_-x),200*(x-w),f]}function xi(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Ln(s){return s>_t?Math.pow(s,1/3):s/Xe+Ke}function hn([s,r,c,f]){let _=(s+16)/116,w=isNaN(r)?_:_+r/500,x=isNaN(c)?_:_-c/200;return _=1*Ui(_),w=j*Ui(w),x=Fe*Ui(x),[_i(3.1338561*w-1.6168667*_-.4906146*x),_i(-.9787684*w+1.9161415*_+.033454*x),_i(.0719453*w-.2289914*_+1.4052427*x),f]}function _i(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function Ui(s){return s>Ne?s*s*s:Xe*(s-Ke)}function on(s){return parseInt(s.padEnd(2,s),16)/255}function Nn(s,r){return Gn(r?s/100:s,0,1)}function Gn(s,r,c){return Math.min(Math.max(r,s),c)}function ur(s){return!s.some(Number.isNaN)}const Ss={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class $i{constructor(r,c,f,_=1,w=!0){this.r=r,this.g=c,this.b=f,this.a=_,w||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[r,c,f,_]))}static parse(r){if(r instanceof $i)return r;if(typeof r!="string")return;const c=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=Ss[f];if(_){const[x,T,C]=_;return[x/255,T/255,C/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const x=f.length<6?1:2;let T=1;return[on(f.slice(T,T+=x)),on(f.slice(T,T+=x)),on(f.slice(T,T+=x)),on(f.slice(T,T+x)||"ff")]}if(f.startsWith("rgb")){const x=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[T,C,A,z,B,U,W,ie,oe,_e,ve,Ge]=x,Ae=[z||" ",W||" ",_e].join("");if(Ae==="  "||Ae==="  /"||Ae===",,"||Ae===",,,"){const Oe=[A,U,oe].join(""),Je=Oe==="%%%"?100:Oe===""?255:0;if(Je){const gt=[Gn(+C/Je,0,1),Gn(+B/Je,0,1),Gn(+ie/Je,0,1),ve?Nn(+ve,Ge):1];if(ur(gt))return gt}}return}}const w=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[x,T,C,A,z,B,U,W,ie]=w,oe=[C||" ",z||" ",U].join("");if(oe==="  "||oe==="  /"||oe===",,"||oe===",,,"){const _e=[+T,Gn(+A,0,100),Gn(+B,0,100),W?Nn(+W,ie):1];if(ur(_e))return function([ve,Ge,Ae,Oe]){function Je(gt){const Mt=(gt+ve/30)%12,Kt=Ge*Math.min(Ae,1-Ae);return Ae-Kt*Math.max(-1,Math.min(Mt-3,9-Mt,1))}return ve=Qt(ve),Ge/=100,Ae/=100,[Je(0),Je(8),Je(4),Oe]}(_e)}}}(r);return c?new $i(...c,!1):void 0}get rgb(){const{r,g:c,b:f,a:_}=this,w=_||1/0;return this.overwriteGetter("rgb",[r/w,c/w,f/w,_])}get hcl(){return this.overwriteGetter("hcl",function(r){const[c,f,_,w]=ci(r),x=Math.sqrt(f*f+_*_);return[Math.round(1e4*x)?Qt(Math.atan2(_,f)*pi):NaN,x,c,w]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ci(this.rgb))}overwriteGetter(r,c){return Object.defineProperty(this,r,{value:c}),c}toString(){const[r,c,f,_]=this.rgb;return`rgba(${[r,c,f].map(w=>Math.round(255*w)).join(",")},${_})`}}$i.black=new $i(0,0,0,1),$i.white=new $i(1,1,1,1),$i.transparent=new $i(0,0,0,0),$i.red=new $i(1,0,0,1);class vc{constructor(r,c,f){this.sensitivity=r?c?"variant":"case":c?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,c){return this.collator.compare(r,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class wc{constructor(r,c,f,_,w){this.text=r,this.image=c,this.scale=f,this.fontStack=_,this.textColor=w}}class Dr{constructor(r){this.sections=r}static fromString(r){return new Dr([new wc(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof Dr?r:Dr.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}}class Rr{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof Rr)return r;if(typeof r=="number")return new Rr([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const c of r)if(typeof c!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]]}return new Rr(r)}}toString(){return JSON.stringify(this.values)}}const jd=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Gr{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof Gr)return r;if(Array.isArray(r)&&!(r.length<1)&&r.length%2==0){for(let c=0;c<r.length;c+=2){const f=r[c],_=r[c+1];if(typeof f!="string"||!jd.has(f)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new Gr(r)}}toString(){return JSON.stringify(this.values)}}class Fr{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Fr({name:r,available:!1}):null}}function Ts(s,r,c,f){return typeof s=="number"&&s>=0&&s<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof c=="number"&&c>=0&&c<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[s,r,c,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[s,r,c,f]:[s,r,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Xo(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof $i||s instanceof vc||s instanceof Dr||s instanceof Rr||s instanceof Gr||s instanceof Fr)return!0;if(Array.isArray(s)){for(const r of s)if(!Xo(r))return!1;return!0}if(typeof s=="object"){for(const r in s)if(!Xo(s[r]))return!1;return!0}return!1}function Mn(s){if(s===null)return qr;if(typeof s=="string")return li;if(typeof s=="boolean")return Jt;if(typeof s=="number")return vt;if(s instanceof $i)return wn;if(s instanceof vc)return gr;if(s instanceof Dr)return zr;if(s instanceof Rr)return Zr;if(s instanceof Gr)return ye;if(s instanceof Fr)return yr;if(Array.isArray(s)){const r=s.length;let c;for(const f of s){const _=Mn(f);if(c){if(c===_)continue;c=ei;break}c=_}return q(c||ei,r)}return Dn}function va(s){const r=typeof s;return s===null?"":r==="string"||r==="number"||r==="boolean"?String(s):s instanceof $i||s instanceof Dr||s instanceof Rr||s instanceof Gr||s instanceof Fr?s.toString():JSON.stringify(s)}class to{constructor(r,c){this.type=r,this.value=c}static parse(r,c){if(r.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Xo(r[1]))return c.error("invalid value");const f=r[1];let _=Mn(f);const w=c.expectedType;return _.kind!=="array"||_.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(_=w),new to(_,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Cn{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const el={string:li,number:vt,boolean:Jt,object:Dn};class io{constructor(r,c){this.type=r,this.args=c}static parse(r,c){if(r.length<2)return c.error("Expected at least one argument.");let f,_=1;const w=r[0];if(w==="array"){let T,C;if(r.length>2){const A=r[1];if(typeof A!="string"||!(A in el)||A==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);T=el[A],_++}else T=ei;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return c.error('The length argument to "array" must be a positive integer literal',2);C=r[2],_++}f=q(T,C)}else{if(!el[w])throw new Error(`Types doesn't contain name = ${w}`);f=el[w]}const x=[];for(;_<r.length;_++){const T=c.parse(r[_],_,ei);if(!T)return null;x.push(T)}return new io(f,x)}evaluate(r){for(let c=0;c<this.args.length;c++){const f=this.args[c].evaluate(r);if(!pe(this.type,Mn(f)))return f;if(c===this.args.length-1)throw new Cn(`Expected value to be of type ${V(this.type)}, but found ${V(Mn(f))} instead.`)}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const xc={"to-boolean":Jt,"to-color":wn,"to-number":vt,"to-string":li};class no{constructor(r,c){this.type=r,this.args=c}static parse(r,c){if(r.length<2)return c.error("Expected at least one argument.");const f=r[0];if(!xc[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&r.length!==2)return c.error("Expected one argument.");const _=xc[f],w=[];for(let x=1;x<r.length;x++){const T=c.parse(r[x],x,ei);if(!T)return null;w.push(T)}return new no(_,w)}evaluate(r){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(r);case"color":{let c,f;for(const _ of this.args){if(c=_.evaluate(r),f=null,c instanceof $i)return c;if(typeof c=="string"){const w=r.parseColor(c);if(w)return w}else if(Array.isArray(c)&&(f=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:Ts(c[0],c[1],c[2],c[3]),!f))return new $i(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new Cn(f||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"padding":{let c;for(const f of this.args){c=f.evaluate(r);const _=Rr.parse(c);if(_)return _}throw new Cn(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"variableAnchorOffsetCollection":{let c;for(const f of this.args){c=f.evaluate(r);const _=Gr.parse(c);if(_)return _}throw new Cn(`Could not parse variableAnchorOffsetCollection from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"number":{let c=null;for(const f of this.args){if(c=f.evaluate(r),c===null)return 0;const _=Number(c);if(!isNaN(_))return _}throw new Cn(`Could not convert ${JSON.stringify(c)} to number.`)}case"formatted":return Dr.fromString(va(this.args[0].evaluate(r)));case"resolvedImage":return Fr.fromString(va(this.args[0].evaluate(r)));default:return va(this.args[0].evaluate(r))}}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const Ud=["Unknown","Point","LineString","Polygon"];class tl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ud[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let c=this._parseColorCache[r];return c||(c=this._parseColorCache[r]=$i.parse(r)),c}}class Ko{constructor(r,c,f=[],_,w=new On,x=[]){this.registry=r,this.path=f,this.key=f.map(T=>`[${T}]`).join(""),this.scope=w,this.errors=x,this.expectedType=_,this._isConstant=c}parse(r,c,f,_,w={}){return c?this.concat(c,f,_)._parse(r,w):this._parse(r,w)}_parse(r,c){function f(_,w,x){return x==="assert"?new io(w,[_]):x==="coerce"?new no(w,[_]):_}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=r[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[_];if(w){let x=w.parse(r,this);if(!x)return null;if(this.expectedType){const T=this.expectedType,C=x.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||C.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string")if(T.kind!=="padding"||C.kind!=="value"&&C.kind!=="number"&&C.kind!=="array")if(T.kind!=="variableAnchorOffsetCollection"||C.kind!=="value"&&C.kind!=="array"){if(this.checkSubtype(T,C))return null}else x=f(x,T,c.typeAnnotation||"coerce");else x=f(x,T,c.typeAnnotation||"coerce");else x=f(x,T,c.typeAnnotation||"coerce");else x=f(x,T,c.typeAnnotation||"assert")}if(!(x instanceof to)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const T=new tl;try{x=new to(x.type,x.evaluate(T))}catch(C){return this.error(C.message),null}}return x}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,c,f){const _=typeof r=="number"?this.path.concat(r):this.path,w=f?this.scope.concat(f):this.scope;return new Ko(this.registry,this._isConstant,_,c||null,w,this.errors)}error(r,...c){const f=`${this.key}${c.map(_=>`[${_}]`).join("")}`;this.errors.push(new un(f,r))}checkSubtype(r,c){const f=pe(r,c);return f&&this.error(f),f}}class Uo{constructor(r,c){this.type=c.type,this.bindings=[].concat(r),this.result=c}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const c of this.bindings)r(c[1]);r(this.result)}static parse(r,c){if(r.length<4)return c.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const f=[];for(let w=1;w<r.length-1;w+=2){const x=r[w];if(typeof x!="string")return c.error(`Expected string, but found ${typeof x} instead.`,w);if(/[^a-zA-Z0-9_]/.test(x))return c.error("Variable names must contain only alphanumeric characters or '_'.",w);const T=c.parse(r[w+1],w+1);if(!T)return null;f.push([x,T])}const _=c.parse(r[r.length-1],r.length-1,c.expectedType,f);return _?new Uo(f,_):null}outputDefined(){return this.result.outputDefined()}}class Bi{constructor(r,c){this.type=c.type,this.name=r,this.boundExpression=c}static parse(r,c){if(r.length!==2||typeof r[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const f=r[1];return c.scope.has(f)?new Bi(f,c.scope.get(f)):c.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class kc{constructor(r,c,f){this.type=r,this.index=c,this.input=f}static parse(r,c){if(r.length!==3)return c.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const f=c.parse(r[1],1,vt),_=c.parse(r[2],2,q(c.expectedType||ei));return f&&_?new kc(_.type.itemType,f,_):null}evaluate(r){const c=this.index.evaluate(r),f=this.input.evaluate(r);if(c<0)throw new Cn(`Array index out of bounds: ${c} < 0.`);if(c>=f.length)throw new Cn(`Array index out of bounds: ${c} > ${f.length-1}.`);if(c!==Math.floor(c))throw new Cn(`Array index must be an integer, but found ${c} instead.`);return f[c]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class Sc{constructor(r,c){this.type=Jt,this.needle=r,this.haystack=c}static parse(r,c){if(r.length!==3)return c.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const f=c.parse(r[1],1,ei),_=c.parse(r[2],2,ei);return f&&_?Me(f.type,[Jt,li,vt,qr,ei])?new Sc(f,_):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${V(f.type)} instead`):null}evaluate(r){const c=this.needle.evaluate(r),f=this.haystack.evaluate(r);if(!f)return!1;if(!De(c,["boolean","string","number","null"]))throw new Cn(`Expected first argument to be of type boolean, string, number or null, but found ${V(Mn(c))} instead.`);if(!De(f,["string","array"]))throw new Cn(`Expected second argument to be of type array or string, but found ${V(Mn(f))} instead.`);return f.indexOf(c)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class Is{constructor(r,c,f){this.type=vt,this.needle=r,this.haystack=c,this.fromIndex=f}static parse(r,c){if(r.length<=2||r.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const f=c.parse(r[1],1,ei),_=c.parse(r[2],2,ei);if(!f||!_)return null;if(!Me(f.type,[Jt,li,vt,qr,ei]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${V(f.type)} instead`);if(r.length===4){const w=c.parse(r[3],3,vt);return w?new Is(f,_,w):null}return new Is(f,_)}evaluate(r){const c=this.needle.evaluate(r),f=this.haystack.evaluate(r);if(!De(c,["boolean","string","number","null"]))throw new Cn(`Expected first argument to be of type boolean, string, number or null, but found ${V(Mn(c))} instead.`);let _;if(this.fromIndex&&(_=this.fromIndex.evaluate(r)),De(f,["string"])){const w=f.indexOf(c,_);return w===-1?-1:[...f.slice(0,w)].length}if(De(f,["array"]))return f.indexOf(c,_);throw new Cn(`Expected second argument to be of type array or string, but found ${V(Mn(f))} instead.`)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class Tc{constructor(r,c,f,_,w,x){this.inputType=r,this.type=c,this.input=f,this.cases=_,this.outputs=w,this.otherwise=x}static parse(r,c){if(r.length<5)return c.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return c.error("Expected an even number of arguments.");let f,_;c.expectedType&&c.expectedType.kind!=="value"&&(_=c.expectedType);const w={},x=[];for(let A=2;A<r.length-1;A+=2){let z=r[A];const B=r[A+1];Array.isArray(z)||(z=[z]);const U=c.concat(A);if(z.length===0)return U.error("Expected at least one branch label.");for(const ie of z){if(typeof ie!="number"&&typeof ie!="string")return U.error("Branch labels must be numbers or strings.");if(typeof ie=="number"&&Math.abs(ie)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ie=="number"&&Math.floor(ie)!==ie)return U.error("Numeric branch labels must be integer values.");if(f){if(U.checkSubtype(f,Mn(ie)))return null}else f=Mn(ie);if(w[String(ie)]!==void 0)return U.error("Branch labels must be unique.");w[String(ie)]=x.length}const W=c.parse(B,A,_);if(!W)return null;_=_||W.type,x.push(W)}const T=c.parse(r[1],1,ei);if(!T)return null;const C=c.parse(r[r.length-1],r.length-1,_);return C?T.type.kind!=="value"&&c.concat(1).checkSubtype(f,T.type)?null:new Tc(f,_,T,w,x,C):null}evaluate(r){const c=this.input.evaluate(r);return(Mn(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}}class il{constructor(r,c,f){this.type=r,this.branches=c,this.otherwise=f}static parse(r,c){if(r.length<4)return c.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return c.error("Expected an odd number of arguments.");let f;c.expectedType&&c.expectedType.kind!=="value"&&(f=c.expectedType);const _=[];for(let x=1;x<r.length-1;x+=2){const T=c.parse(r[x],x,Jt);if(!T)return null;const C=c.parse(r[x+1],x+1,f);if(!C)return null;_.push([T,C]),f=f||C.type}const w=c.parse(r[r.length-1],r.length-1,f);if(!w)return null;if(!f)throw new Error("Can't infer output type");return new il(f,_,w)}evaluate(r){for(const[c,f]of this.branches)if(c.evaluate(r))return f.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[c,f]of this.branches)r(c),r(f);r(this.otherwise)}outputDefined(){return this.branches.every(([r,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class wa{constructor(r,c,f,_){this.type=r,this.input=c,this.beginIndex=f,this.endIndex=_}static parse(r,c){if(r.length<=2||r.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const f=c.parse(r[1],1,ei),_=c.parse(r[2],2,vt);if(!f||!_)return null;if(!Me(f.type,[q(ei),li,ei]))return c.error(`Expected first argument to be of type array or string, but found ${V(f.type)} instead`);if(r.length===4){const w=c.parse(r[3],3,vt);return w?new wa(f.type,f,_,w):null}return new wa(f.type,f,_)}evaluate(r){const c=this.input.evaluate(r),f=this.beginIndex.evaluate(r);let _;if(this.endIndex&&(_=this.endIndex.evaluate(r)),De(c,["string"]))return[...c].slice(f,_).join("");if(De(c,["array"]))return c.slice(f,_);throw new Cn(`Expected first argument to be of type array or string, but found ${V(Mn(c))} instead.`)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function nl(s,r){const c=s.length-1;let f,_,w=0,x=c,T=0;for(;w<=x;)if(T=Math.floor((w+x)/2),f=s[T],_=s[T+1],f<=r){if(T===c||r<_)return T;w=T+1}else{if(!(f>r))throw new Cn("Input is not a number.");x=T-1}return 0}class Cs{constructor(r,c,f){this.type=r,this.input=c,this.labels=[],this.outputs=[];for(const[_,w]of f)this.labels.push(_),this.outputs.push(w)}static parse(r,c){if(r.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return c.error("Expected an even number of arguments.");const f=c.parse(r[1],1,vt);if(!f)return null;const _=[];let w=null;c.expectedType&&c.expectedType.kind!=="value"&&(w=c.expectedType);for(let x=1;x<r.length;x+=2){const T=x===1?-1/0:r[x],C=r[x+1],A=x,z=x+1;if(typeof T!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(_.length&&_[_.length-1][0]>=T)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const B=c.parse(C,z,w);if(!B)return null;w=w||B.type,_.push([T,B])}return new Cs(w,f,_)}evaluate(r){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(r);const _=this.input.evaluate(r);if(_<=c[0])return f[0].evaluate(r);const w=c.length;return _>=c[w-1]?f[w-1].evaluate(r):f[nl(c,_)].evaluate(r)}eachChild(r){r(this.input);for(const c of this.outputs)r(c)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function sh(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var $d=ah;function ah(s,r,c,f){this.cx=3*s,this.bx=3*(c-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(f-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=r,this.p2x=c,this.p2y=f}ah.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,r){if(r===void 0&&(r=1e-6),s<0)return 0;if(s>1)return 1;for(var c=s,f=0;f<8;f++){var _=this.sampleCurveX(c)-s;if(Math.abs(_)<r)return c;var w=this.sampleCurveDerivativeX(c);if(Math.abs(w)<1e-6)break;c-=_/w}var x=0,T=1;for(c=s,f=0;f<20&&(_=this.sampleCurveX(c),!(Math.abs(_-s)<r));f++)s>_?x=c:T=c,c=.5*(T-x)+x;return c},solve:function(s,r){return this.sampleCurveY(this.solveCurveX(s,r))}};var Vd=sh($d);function Jo(s,r,c){return s+c*(r-s)}function xa(s,r,c){return s.map((f,_)=>Jo(f,r[_],c))}const br={number:Jo,color:function(s,r,c,f="rgb"){switch(f){case"rgb":{const[_,w,x,T]=xa(s.rgb,r.rgb,c);return new $i(_,w,x,T,!1)}case"hcl":{const[_,w,x,T]=s.hcl,[C,A,z,B]=r.hcl;let U,W;if(isNaN(_)||isNaN(C))isNaN(_)?isNaN(C)?U=NaN:(U=C,x!==1&&x!==0||(W=A)):(U=_,z!==1&&z!==0||(W=w));else{let Ge=C-_;C>_&&Ge>180?Ge-=360:C<_&&_-C>180&&(Ge+=360),U=_+c*Ge}const[ie,oe,_e,ve]=function([Ge,Ae,Oe,Je]){return Ge=isNaN(Ge)?0:Ge*Et,hn([Oe,Math.cos(Ge)*Ae,Math.sin(Ge)*Ae,Je])}([U,W??Jo(w,A,c),Jo(x,z,c),Jo(T,B,c)]);return new $i(ie,oe,_e,ve,!1)}case"lab":{const[_,w,x,T]=hn(xa(s.lab,r.lab,c));return new $i(_,w,x,T,!1)}}},array:xa,padding:function(s,r,c){return new Rr(xa(s.values,r.values,c))},variableAnchorOffsetCollection:function(s,r,c){const f=s.values,_=r.values;if(f.length!==_.length)throw new Cn(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${r.toString()}`);const w=[];for(let x=0;x<f.length;x+=2){if(f[x]!==_[x])throw new Cn(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${f[x]}, to[${x}]: ${_[x]}`);w.push(f[x]);const[T,C]=f[x+1],[A,z]=_[x+1];w.push([Jo(T,A,c),Jo(C,z,c)])}return new Gr(w)}};class vr{constructor(r,c,f,_,w){this.type=r,this.operator=c,this.interpolation=f,this.input=_,this.labels=[],this.outputs=[];for(const[x,T]of w)this.labels.push(x),this.outputs.push(T)}static interpolationFactor(r,c,f,_){let w=0;if(r.name==="exponential")w=rl(c,r.base,f,_);else if(r.name==="linear")w=rl(c,1,f,_);else if(r.name==="cubic-bezier"){const x=r.controlPoints;w=new Vd(x[0],x[1],x[2],x[3]).solve(rl(c,1,f,_))}return w}static parse(r,c){let[f,_,w,...x]=r;if(!Array.isArray(_)||_.length===0)return c.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const A=_[1];if(typeof A!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:A}}else{if(_[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const A=_.slice(1);if(A.length!==4||A.some(z=>typeof z!="number"||z<0||z>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:A}}}if(r.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(w=c.parse(w,2,vt),!w)return null;const T=[];let C=null;f==="interpolate-hcl"||f==="interpolate-lab"?C=wn:c.expectedType&&c.expectedType.kind!=="value"&&(C=c.expectedType);for(let A=0;A<x.length;A+=2){const z=x[A],B=x[A+1],U=A+3,W=A+4;if(typeof z!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(T.length&&T[T.length-1][0]>=z)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const ie=c.parse(B,W,C);if(!ie)return null;C=C||ie.type,T.push([z,ie])}return $e(C,vt)||$e(C,wn)||$e(C,Zr)||$e(C,ye)||$e(C,q(vt))?new vr(C,f,_,w,T):c.error(`Type ${V(C)} is not interpolatable.`)}evaluate(r){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(r);const _=this.input.evaluate(r);if(_<=c[0])return f[0].evaluate(r);const w=c.length;if(_>=c[w-1])return f[w-1].evaluate(r);const x=nl(c,_),T=vr.interpolationFactor(this.interpolation,_,c[x],c[x+1]),C=f[x].evaluate(r),A=f[x+1].evaluate(r);switch(this.operator){case"interpolate":return br[this.type.kind](C,A,T);case"interpolate-hcl":return br.color(C,A,T,"hcl");case"interpolate-lab":return br.color(C,A,T,"lab")}}eachChild(r){r(this.input);for(const c of this.outputs)r(c)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function rl(s,r,c,f){const _=f-c,w=s-c;return _===0?0:r===1?w/_:(Math.pow(r,w)-1)/(Math.pow(r,_)-1)}class ol{constructor(r,c){this.type=r,this.args=c}static parse(r,c){if(r.length<2)return c.error("Expectected at least one argument.");let f=null;const _=c.expectedType;_&&_.kind!=="value"&&(f=_);const w=[];for(const T of r.slice(1)){const C=c.parse(T,1+w.length,f,void 0,{typeAnnotation:"omit"});if(!C)return null;f=f||C.type,w.push(C)}if(!f)throw new Error("No output type");const x=_&&w.some(T=>pe(_,T.type));return new ol(x?ei:f,w)}evaluate(r){let c,f=null,_=0;for(const w of this.args)if(_++,f=w.evaluate(r),f&&f instanceof Fr&&!f.available&&(c||(c=f.name),f=null,_===this.args.length&&(f=c)),f!==null)break;return f}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}function sl(s,r){return s==="=="||s==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function lh(s,r,c,f){return f.compare(r,c)===0}function Es(s,r,c){const f=s!=="=="&&s!=="!=";return class n1{constructor(w,x,T){this.type=Jt,this.lhs=w,this.rhs=x,this.collator=T,this.hasUntypedArgument=w.type.kind==="value"||x.type.kind==="value"}static parse(w,x){if(w.length!==3&&w.length!==4)return x.error("Expected two or three arguments.");const T=w[0];let C=x.parse(w[1],1,ei);if(!C)return null;if(!sl(T,C.type))return x.concat(1).error(`"${T}" comparisons are not supported for type '${V(C.type)}'.`);let A=x.parse(w[2],2,ei);if(!A)return null;if(!sl(T,A.type))return x.concat(2).error(`"${T}" comparisons are not supported for type '${V(A.type)}'.`);if(C.type.kind!==A.type.kind&&C.type.kind!=="value"&&A.type.kind!=="value")return x.error(`Cannot compare types '${V(C.type)}' and '${V(A.type)}'.`);f&&(C.type.kind==="value"&&A.type.kind!=="value"?C=new io(A.type,[C]):C.type.kind!=="value"&&A.type.kind==="value"&&(A=new io(C.type,[A])));let z=null;if(w.length===4){if(C.type.kind!=="string"&&A.type.kind!=="string"&&C.type.kind!=="value"&&A.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(z=x.parse(w[3],3,gr),!z)return null}return new n1(C,A,z)}evaluate(w){const x=this.lhs.evaluate(w),T=this.rhs.evaluate(w);if(f&&this.hasUntypedArgument){const C=Mn(x),A=Mn(T);if(C.kind!==A.kind||C.kind!=="string"&&C.kind!=="number")throw new Cn(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${C.kind}, ${A.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const C=Mn(x),A=Mn(T);if(C.kind!=="string"||A.kind!=="string")return r(w,x,T)}return this.collator?c(w,x,T,this.collator.evaluate(w)):r(w,x,T)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const qd=Es("==",function(s,r,c){return r===c},lh),ch=Es("!=",function(s,r,c){return r!==c},function(s,r,c,f){return!lh(0,r,c,f)}),uh=Es("<",function(s,r,c){return r<c},function(s,r,c,f){return f.compare(r,c)<0}),Zd=Es(">",function(s,r,c){return r>c},function(s,r,c,f){return f.compare(r,c)>0}),Gd=Es("<=",function(s,r,c){return r<=c},function(s,r,c,f){return f.compare(r,c)<=0}),hh=Es(">=",function(s,r,c){return r>=c},function(s,r,c,f){return f.compare(r,c)>=0});class ka{constructor(r,c,f){this.type=gr,this.locale=f,this.caseSensitive=r,this.diacriticSensitive=c}static parse(r,c){if(r.length!==2)return c.error("Expected one argument.");const f=r[1];if(typeof f!="object"||Array.isArray(f))return c.error("Collator options argument must be an object.");const _=c.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Jt);if(!_)return null;const w=c.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Jt);if(!w)return null;let x=null;return f.locale&&(x=c.parse(f.locale,1,li),!x)?null:new ka(_,w,x)}evaluate(r){return new vc(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}class Ic{constructor(r,c,f,_,w){this.type=li,this.number=r,this.locale=c,this.currency=f,this.minFractionDigits=_,this.maxFractionDigits=w}static parse(r,c){if(r.length!==3)return c.error("Expected two arguments.");const f=c.parse(r[1],1,vt);if(!f)return null;const _=r[2];if(typeof _!="object"||Array.isArray(_))return c.error("NumberFormat options argument must be an object.");let w=null;if(_.locale&&(w=c.parse(_.locale,1,li),!w))return null;let x=null;if(_.currency&&(x=c.parse(_.currency,1,li),!x))return null;let T=null;if(_["min-fraction-digits"]&&(T=c.parse(_["min-fraction-digits"],1,vt),!T))return null;let C=null;return _["max-fraction-digits"]&&(C=c.parse(_["max-fraction-digits"],1,vt),!C)?null:new Ic(f,w,x,T,C)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class al{constructor(r){this.type=zr,this.sections=r}static parse(r,c){if(r.length<2)return c.error("Expected at least one argument.");const f=r[1];if(!Array.isArray(f)&&typeof f=="object")return c.error("First argument must be an image or text section.");const _=[];let w=!1;for(let x=1;x<=r.length-1;++x){const T=r[x];if(w&&typeof T=="object"&&!Array.isArray(T)){w=!1;let C=null;if(T["font-scale"]&&(C=c.parse(T["font-scale"],1,vt),!C))return null;let A=null;if(T["text-font"]&&(A=c.parse(T["text-font"],1,q(li)),!A))return null;let z=null;if(T["text-color"]&&(z=c.parse(T["text-color"],1,wn),!z))return null;const B=_[_.length-1];B.scale=C,B.font=A,B.textColor=z}else{const C=c.parse(r[x],1,ei);if(!C)return null;const A=C.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,_.push({content:C,scale:null,font:null,textColor:null})}}return new al(_)}evaluate(r){return new Dr(this.sections.map(c=>{const f=c.content.evaluate(r);return Mn(f)===yr?new wc("",f,null,null,null):new wc(va(f),null,c.scale?c.scale.evaluate(r):null,c.font?c.font.evaluate(r).join(","):null,c.textColor?c.textColor.evaluate(r):null)}))}eachChild(r){for(const c of this.sections)r(c.content),c.scale&&r(c.scale),c.font&&r(c.font),c.textColor&&r(c.textColor)}outputDefined(){return!1}}class Cc{constructor(r){this.type=yr,this.input=r}static parse(r,c){if(r.length!==2)return c.error("Expected two arguments.");const f=c.parse(r[1],1,li);return f?new Cc(f):c.error("No image name provided.")}evaluate(r){const c=this.input.evaluate(r),f=Fr.fromString(c);return f&&r.availableImages&&(f.available=r.availableImages.indexOf(c)>-1),f}eachChild(r){r(this.input)}outputDefined(){return!1}}class Ec{constructor(r){this.type=vt,this.input=r}static parse(r,c){if(r.length!==2)return c.error(`Expected 1 argument, but found ${r.length-1} instead.`);const f=c.parse(r[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${V(f.type)} instead.`):new Ec(f):null}evaluate(r){const c=this.input.evaluate(r);if(typeof c=="string")return[...c].length;if(Array.isArray(c))return c.length;throw new Cn(`Expected value to be of type string or array, but found ${V(Mn(c))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const yo=8192;function Wd(s,r){const c=(180+s[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,_=Math.pow(2,r.z);return[Math.round(c*_*yo),Math.round(f*_*yo)]}function Lc(s,r){const c=Math.pow(2,r.z);return[(_=(s[0]/yo+r.x)/c,360*_-180),(f=(s[1]/yo+r.y)/c,360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90)];var f,_}function Yo(s,r){s[0]=Math.min(s[0],r[0]),s[1]=Math.min(s[1],r[1]),s[2]=Math.max(s[2],r[0]),s[3]=Math.max(s[3],r[1])}function $o(s,r){return!(s[0]<=r[0]||s[2]>=r[2]||s[1]<=r[1]||s[3]>=r[3])}function ji(s,r,c){const f=s[0]-r[0],_=s[1]-r[1],w=s[0]-c[0],x=s[1]-c[1];return f*x-w*_==0&&f*w<=0&&_*x<=0}function ll(s,r,c,f){return(_=[f[0]-c[0],f[1]-c[1]])[0]*(w=[r[0]-s[0],r[1]-s[1]])[1]-_[1]*w[0]!=0&&!(!fh(s,r,c,f)||!fh(c,f,s,r));var _,w}function Hd(s,r,c){for(const f of c)for(let _=0;_<f.length-1;++_)if(ll(s,r,f[_],f[_+1]))return!0;return!1}function Ls(s,r,c=!1){let f=!1;for(const T of r)for(let C=0;C<T.length-1;C++){if(ji(s,T[C],T[C+1]))return c;(w=T[C])[1]>(_=s)[1]!=(x=T[C+1])[1]>_[1]&&_[0]<(x[0]-w[0])*(_[1]-w[1])/(x[1]-w[1])+w[0]&&(f=!f)}var _,w,x;return f}function Xd(s,r){for(const c of r)if(Ls(s,c))return!0;return!1}function dh(s,r){for(const c of s)if(!Ls(c,r))return!1;for(let c=0;c<s.length-1;++c)if(Hd(s[c],s[c+1],r))return!1;return!0}function Kd(s,r){for(const c of r)if(dh(s,c))return!0;return!1}function fh(s,r,c,f){const _=f[0]-c[0],w=f[1]-c[1],x=(s[0]-c[0])*w-_*(s[1]-c[1]),T=(r[0]-c[0])*w-_*(r[1]-c[1]);return x>0&&T<0||x<0&&T>0}function Mc(s,r,c){const f=[];for(let _=0;_<s.length;_++){const w=[];for(let x=0;x<s[_].length;x++){const T=Wd(s[_][x],c);Yo(r,T),w.push(T)}f.push(w)}return f}function ph(s,r,c){const f=[];for(let _=0;_<s.length;_++){const w=Mc(s[_],r,c);f.push(w)}return f}function mh(s,r,c,f){if(s[0]<c[0]||s[0]>c[2]){const _=.5*f;let w=s[0]-c[0]>_?-f:c[0]-s[0]>_?f:0;w===0&&(w=s[0]-c[2]>_?-f:c[2]-s[0]>_?f:0),s[0]+=w}Yo(r,s)}function _h(s,r,c,f){const _=Math.pow(2,f.z)*yo,w=[f.x*yo,f.y*yo],x=[];for(const T of s)for(const C of T){const A=[C.x+w[0],C.y+w[1]];mh(A,r,c,_),x.push(A)}return x}function gh(s,r,c,f){const _=Math.pow(2,f.z)*yo,w=[f.x*yo,f.y*yo],x=[];for(const C of s){const A=[];for(const z of C){const B=[z.x+w[0],z.y+w[1]];Yo(r,B),A.push(B)}x.push(A)}if(r[2]-r[0]<=_/2){(T=r)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const C of x)for(const A of C)mh(A,r,c,_)}var T;return x}class Qo{constructor(r,c){this.type=Jt,this.geojson=r,this.geometries=c}static parse(r,c){if(r.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Xo(r[1])){const f=r[1];if(f.type==="FeatureCollection"){const _=[];for(const w of f.features){const{type:x,coordinates:T}=w.geometry;x==="Polygon"&&_.push(T),x==="MultiPolygon"&&_.push(...T)}if(_.length)return new Qo(f,{type:"MultiPolygon",coordinates:_})}else if(f.type==="Feature"){const _=f.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Qo(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Qo(f,f)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(c,f){const _=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(f.type==="Polygon"){const T=Mc(f.coordinates,w,x),C=_h(c.geometry(),_,w,x);if(!$o(_,w))return!1;for(const A of C)if(!Ls(A,T))return!1}if(f.type==="MultiPolygon"){const T=ph(f.coordinates,w,x),C=_h(c.geometry(),_,w,x);if(!$o(_,w))return!1;for(const A of C)if(!Xd(A,T))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(c,f){const _=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(f.type==="Polygon"){const T=Mc(f.coordinates,w,x),C=gh(c.geometry(),_,w,x);if(!$o(_,w))return!1;for(const A of C)if(!dh(A,T))return!1}if(f.type==="MultiPolygon"){const T=ph(f.coordinates,w,x),C=gh(c.geometry(),_,w,x);if(!$o(_,w))return!1;for(const A of C)if(!Kd(A,T))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let yh=class{constructor(s=[],r=(c,f)=>c<f?-1:c>f?1:0){if(this.data=s,this.length=this.data.length,this.compare=r,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:r,compare:c}=this,f=r[s];for(;s>0;){const _=s-1>>1,w=r[_];if(c(f,w)>=0)break;r[s]=w,s=_}r[s]=f}_down(s){const{data:r,compare:c}=this,f=this.length>>1,_=r[s];for(;s<f;){let w=1+(s<<1);const x=w+1;if(x<this.length&&c(r[x],r[w])<0&&(w=x),c(r[w],_)>=0)break;r[s]=r[w],s=w}r[s]=_}};function Jd(s,r,c,f,_){bh(s,r,c,f||s.length-1,_||Yd)}function bh(s,r,c,f,_){for(;f>c;){if(f-c>600){var w=f-c+1,x=r-c+1,T=Math.log(w),C=.5*Math.exp(2*T/3),A=.5*Math.sqrt(T*C*(w-C)/w)*(x-w/2<0?-1:1);bh(s,r,Math.max(c,Math.floor(r-x*C/w+A)),Math.min(f,Math.floor(r+(w-x)*C/w+A)),_)}var z=s[r],B=c,U=f;for(Sa(s,c,r),_(s[f],z)>0&&Sa(s,c,f);B<U;){for(Sa(s,B,U),B++,U--;_(s[B],z)<0;)B++;for(;_(s[U],z)>0;)U--}_(s[c],z)===0?Sa(s,c,U):Sa(s,++U,f),U<=r&&(c=U+1),r<=U&&(f=U-1)}}function Sa(s,r,c){var f=s[r];s[r]=s[c],s[c]=f}function Yd(s,r){return s<r?-1:s>r?1:0}function cl(s,r){if(s.length<=1)return[s];const c=[];let f,_;for(const w of s){const x=ef(w);x!==0&&(w.area=Math.abs(x),_===void 0&&(_=x<0),_===x<0?(f&&c.push(f),f=[w]):f.push(w))}if(f&&c.push(f),r>1)for(let w=0;w<c.length;w++)c[w].length<=r||(Jd(c[w],r,1,c[w].length-1,Qd),c[w]=c[w].slice(0,r));return c}function Qd(s,r){return r.area-s.area}function ef(s){let r=0;for(let c,f,_=0,w=s.length,x=w-1;_<w;x=_++)c=s[_],f=s[x],r+=(f.x-c.x)*(c.y+f.y);return r}const vh=1/298.257223563,wh=vh*(2-vh),xh=Math.PI/180;class Ac{constructor(r){const c=6378.137*xh*1e3,f=Math.cos(r*xh),_=1/(1-wh*(1-f*f)),w=Math.sqrt(_);this.kx=c*w*f,this.ky=c*w*_*(1-wh)}distance(r,c){const f=this.wrap(r[0]-c[0])*this.kx,_=(r[1]-c[1])*this.ky;return Math.sqrt(f*f+_*_)}pointOnLine(r,c){let f,_,w,x,T=1/0;for(let C=0;C<r.length-1;C++){let A=r[C][0],z=r[C][1],B=this.wrap(r[C+1][0]-A)*this.kx,U=(r[C+1][1]-z)*this.ky,W=0;B===0&&U===0||(W=(this.wrap(c[0]-A)*this.kx*B+(c[1]-z)*this.ky*U)/(B*B+U*U),W>1?(A=r[C+1][0],z=r[C+1][1]):W>0&&(A+=B/this.kx*W,z+=U/this.ky*W)),B=this.wrap(c[0]-A)*this.kx,U=(c[1]-z)*this.ky;const ie=B*B+U*U;ie<T&&(T=ie,f=A,_=z,w=C,x=W)}return{point:[f,_],index:w,t:Math.max(0,Math.min(1,x))}}wrap(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}}function kh(s,r){return r[0]-s[0]}function ul(s){return s[1]-s[0]+1}function Ao(s,r){return s[1]>=s[0]&&s[1]<r}function Pc(s,r){if(s[0]>s[1])return[null,null];const c=ul(s);if(r){if(c===2)return[s,null];const _=Math.floor(c/2);return[[s[0],s[0]+_],[s[0]+_,s[1]]]}if(c===1)return[s,null];const f=Math.floor(c/2)-1;return[[s[0],s[0]+f],[s[0]+f+1,s[1]]]}function zc(s,r){if(!Ao(r,s.length))return[1/0,1/0,-1/0,-1/0];const c=[1/0,1/0,-1/0,-1/0];for(let f=r[0];f<=r[1];++f)Yo(c,s[f]);return c}function Dc(s){const r=[1/0,1/0,-1/0,-1/0];for(const c of s)for(const f of c)Yo(r,f);return r}function hl(s){return s[0]!==-1/0&&s[1]!==-1/0&&s[2]!==1/0&&s[3]!==1/0}function Rc(s,r,c){if(!hl(s)||!hl(r))return NaN;let f=0,_=0;return s[2]<r[0]&&(f=r[0]-s[2]),s[0]>r[2]&&(f=s[0]-r[2]),s[1]>r[3]&&(_=s[1]-r[3]),s[3]<r[1]&&(_=r[1]-s[3]),c.distance([0,0],[f,_])}function es(s,r,c){const f=c.pointOnLine(r,s);return c.distance(s,f.point)}function Fc(s,r,c,f,_){const w=Math.min(es(s,[c,f],_),es(r,[c,f],_)),x=Math.min(es(c,[s,r],_),es(f,[s,r],_));return Math.min(w,x)}function tf(s,r,c,f,_){if(!Ao(r,s.length)||!Ao(f,c.length))return 1/0;let w=1/0;for(let x=r[0];x<r[1];++x){const T=s[x],C=s[x+1];for(let A=f[0];A<f[1];++A){const z=c[A],B=c[A+1];if(ll(T,C,z,B))return 0;w=Math.min(w,Fc(T,C,z,B,_))}}return w}function xn(s,r,c,f,_){if(!Ao(r,s.length)||!Ao(f,c.length))return NaN;let w=1/0;for(let x=r[0];x<=r[1];++x)for(let T=f[0];T<=f[1];++T)if(w=Math.min(w,_.distance(s[x],c[T])),w===0)return w;return w}function nf(s,r,c){if(Ls(s,r,!0))return 0;let f=1/0;for(const _ of r){const w=_[0],x=_[_.length-1];if(w!==x&&(f=Math.min(f,es(s,[x,w],c)),f===0))return f;const T=c.pointOnLine(_,s);if(f=Math.min(f,c.distance(s,T.point)),f===0)return f}return f}function yi(s,r,c,f){if(!Ao(r,s.length))return NaN;for(let w=r[0];w<=r[1];++w)if(Ls(s[w],c,!0))return 0;let _=1/0;for(let w=r[0];w<r[1];++w){const x=s[w],T=s[w+1];for(const C of c)for(let A=0,z=C.length,B=z-1;A<z;B=A++){const U=C[B],W=C[A];if(ll(x,T,U,W))return 0;_=Math.min(_,Fc(x,T,U,W,f))}}return _}function dl(s,r){for(const c of s)for(const f of c)if(Ls(f,r,!0))return!0;return!1}function Xi(s,r,c,f=1/0){const _=Dc(s),w=Dc(r);if(f!==1/0&&Rc(_,w,c)>=f)return f;if($o(_,w)){if(dl(s,r))return 0}else if(dl(r,s))return 0;let x=1/0;for(const T of s)for(let C=0,A=T.length,z=A-1;C<A;z=C++){const B=T[z],U=T[C];for(const W of r)for(let ie=0,oe=W.length,_e=oe-1;ie<oe;_e=ie++){const ve=W[_e],Ge=W[ie];if(ll(B,U,ve,Ge))return 0;x=Math.min(x,Fc(B,U,ve,Ge,c))}}return x}function qi(s,r,c,f,_,w){if(!w)return;const x=Rc(zc(f,w),_,c);x<r&&s.push([x,w,[0,0]])}function ts(s,r,c,f,_,w,x){if(!w||!x)return;const T=Rc(zc(f,w),zc(_,x),c);T<r&&s.push([T,w,x])}function Ta(s,r,c,f,_=1/0){let w=Math.min(f.distance(s[0],c[0][0]),_);if(w===0)return w;const x=new yh([[0,[0,s.length-1],[0,0]]],kh),T=Dc(c);for(;x.length>0;){const C=x.pop();if(C[0]>=w)continue;const A=C[1],z=r?50:100;if(ul(A)<=z){if(!Ao(A,s.length))return NaN;if(r){const B=yi(s,A,c,f);if(isNaN(B)||B===0)return B;w=Math.min(w,B)}else for(let B=A[0];B<=A[1];++B){const U=nf(s[B],c,f);if(w=Math.min(w,U),w===0)return 0}}else{const B=Pc(A,r);qi(x,w,f,s,T,B[0]),qi(x,w,f,s,T,B[1])}}return w}function Ia(s,r,c,f,_,w=1/0){let x=Math.min(w,_.distance(s[0],c[0]));if(x===0)return x;const T=new yh([[0,[0,s.length-1],[0,c.length-1]]],kh);for(;T.length>0;){const C=T.pop();if(C[0]>=x)continue;const A=C[1],z=C[2],B=r?50:100,U=f?50:100;if(ul(A)<=B&&ul(z)<=U){if(!Ao(A,s.length)&&Ao(z,c.length))return NaN;let W;if(r&&f)W=tf(s,A,c,z,_),x=Math.min(x,W);else if(r&&!f){const ie=s.slice(A[0],A[1]+1);for(let oe=z[0];oe<=z[1];++oe)if(W=es(c[oe],ie,_),x=Math.min(x,W),x===0)return x}else if(!r&&f){const ie=c.slice(z[0],z[1]+1);for(let oe=A[0];oe<=A[1];++oe)if(W=es(s[oe],ie,_),x=Math.min(x,W),x===0)return x}else W=xn(s,A,c,z,_),x=Math.min(x,W)}else{const W=Pc(A,r),ie=Pc(z,f);ts(T,x,_,s,c,W[0],ie[0]),ts(T,x,_,s,c,W[0],ie[1]),ts(T,x,_,s,c,W[1],ie[0]),ts(T,x,_,s,c,W[1],ie[1])}}return x}function Bc(s){return s.type==="MultiPolygon"?s.coordinates.map(r=>({type:"Polygon",coordinates:r})):s.type==="MultiLineString"?s.coordinates.map(r=>({type:"LineString",coordinates:r})):s.type==="MultiPoint"?s.coordinates.map(r=>({type:"Point",coordinates:r})):[s]}class is{constructor(r,c){this.type=vt,this.geojson=r,this.geometries=c}static parse(r,c){if(r.length!==2)return c.error(`'distance' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Xo(r[1])){const f=r[1];if(f.type==="FeatureCollection")return new is(f,f.features.map(_=>Bc(_.geometry)).flat());if(f.type==="Feature")return new is(f,Bc(f.geometry));if("type"in f&&"coordinates"in f)return new is(f,Bc(f))}return c.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(c,f){const _=c.geometry(),w=_.flat().map(C=>Lc([C.x,C.y],c.canonical));if(_.length===0)return NaN;const x=new Ac(w[0][1]);let T=1/0;for(const C of f){switch(C.type){case"Point":T=Math.min(T,Ia(w,!1,[C.coordinates],!1,x,T));break;case"LineString":T=Math.min(T,Ia(w,!1,C.coordinates,!0,x,T));break;case"Polygon":T=Math.min(T,Ta(w,!1,C.coordinates,x,T))}if(T===0)return T}return T}(r,this.geometries);if(r.geometryType()==="LineString")return function(c,f){const _=c.geometry(),w=_.flat().map(C=>Lc([C.x,C.y],c.canonical));if(_.length===0)return NaN;const x=new Ac(w[0][1]);let T=1/0;for(const C of f){switch(C.type){case"Point":T=Math.min(T,Ia(w,!0,[C.coordinates],!1,x,T));break;case"LineString":T=Math.min(T,Ia(w,!0,C.coordinates,!0,x,T));break;case"Polygon":T=Math.min(T,Ta(w,!0,C.coordinates,x,T))}if(T===0)return T}return T}(r,this.geometries);if(r.geometryType()==="Polygon")return function(c,f){const _=c.geometry();if(_.length===0||_[0].length===0)return NaN;const w=cl(_,0).map(C=>C.map(A=>A.map(z=>Lc([z.x,z.y],c.canonical)))),x=new Ac(w[0][0][0][1]);let T=1/0;for(const C of f)for(const A of w){switch(C.type){case"Point":T=Math.min(T,Ta([C.coordinates],!1,A,x,T));break;case"LineString":T=Math.min(T,Ta(C.coordinates,!0,A,x,T));break;case"Polygon":T=Math.min(T,Xi(A,C.coordinates,x,T))}if(T===0)return T}return T}(r,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Ms={"==":qd,"!=":ch,">":Zd,"<":uh,">=":hh,"<=":Gd,array:io,at:kc,boolean:io,case:il,coalesce:ol,collator:ka,format:al,image:Cc,in:Sc,"index-of":Is,interpolate:vr,"interpolate-hcl":vr,"interpolate-lab":vr,length:Ec,let:Uo,literal:to,match:Tc,number:io,"number-format":Ic,object:io,slice:wa,step:Cs,string:io,"to-boolean":no,"to-color":no,"to-number":no,"to-string":no,var:Bi,within:Qo,distance:is};class Wr{constructor(r,c,f,_){this.name=r,this.type=c,this._evaluate=f,this.args=_}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,c){const f=r[0],_=Wr.definitions[f];if(!_)return c.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(_)?_[0]:_.type,x=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,T=x.filter(([A])=>!Array.isArray(A)||A.length===r.length-1);let C=null;for(const[A,z]of T){C=new Ko(c.registry,Ca,c.path,null,c.scope);const B=[];let U=!1;for(let W=1;W<r.length;W++){const ie=r[W],oe=Array.isArray(A)?A[W-1]:A.type,_e=C.parse(ie,1+B.length,oe);if(!_e){U=!0;break}B.push(_e)}if(!U)if(Array.isArray(A)&&A.length!==B.length)C.error(`Expected ${A.length} arguments, but found ${B.length} instead.`);else{for(let W=0;W<B.length;W++){const ie=Array.isArray(A)?A[W]:A.type,oe=B[W];C.concat(W+1).checkSubtype(ie,oe.type)}if(C.errors.length===0)return new Wr(f,w,z,B)}}if(T.length===1)c.errors.push(...C.errors);else{const A=(T.length?T:x).map(([B])=>{return U=B,Array.isArray(U)?`(${U.map(V).join(", ")})`:`(${V(U.type)}...)`;var U}).join(" | "),z=[];for(let B=1;B<r.length;B++){const U=c.parse(r[B],1+z.length);if(!U)return null;z.push(V(U.type))}c.error(`Expected arguments of type ${A}, but found (${z.join(", ")}) instead.`)}return null}static register(r,c){Wr.definitions=c;for(const f in c)r[f]=Wr}}function Oc(s,[r,c,f,_]){r=r.evaluate(s),c=c.evaluate(s),f=f.evaluate(s);const w=_?_.evaluate(s):1,x=Ts(r,c,f,w);if(x)throw new Cn(x);return new $i(r/255,c/255,f/255,w,!1)}function Nc(s,r){return s in r}function jc(s,r){const c=r[s];return c===void 0?null:c}function ns(s){return{type:s}}function Ca(s){if(s instanceof Bi)return Ca(s.boundExpression);if(s instanceof Wr&&s.name==="error"||s instanceof ka||s instanceof Qo||s instanceof is)return!1;const r=s instanceof no||s instanceof io;let c=!0;return s.eachChild(f=>{c=r?c&&Ca(f):c&&f instanceof to}),!!c&&Ea(s)&&La(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ea(s){if(s instanceof Wr&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Qo||s instanceof is)return!1;let r=!0;return s.eachChild(c=>{r&&!Ea(c)&&(r=!1)}),r}function As(s){if(s instanceof Wr&&s.name==="feature-state")return!1;let r=!0;return s.eachChild(c=>{r&&!As(c)&&(r=!1)}),r}function La(s,r){if(s instanceof Wr&&r.indexOf(s.name)>=0)return!1;let c=!0;return s.eachChild(f=>{c&&!La(f,r)&&(c=!1)}),c}function fl(s){return{result:"success",value:s}}function Ps(s){return{result:"error",value:s}}function zs(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function Sh(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function Uc(s){return!!s.expression&&s.expression.interpolated}function Pi(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function pl(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function rf(s){return s}function Th(s,r){const c=r.type==="color",f=s.stops&&typeof s.stops[0][0]=="object",_=f||!(f||s.property!==void 0),w=s.type||(Uc(r)?"exponential":"interval");if(c||r.type==="padding"){const z=c?$i.parse:Rr.parse;(s=Yn({},s)).stops&&(s.stops=s.stops.map(B=>[B[0],z(B[1])])),s.default=z(s.default?s.default:r.default)}if(s.colorSpace&&(x=s.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var x;let T,C,A;if(w==="exponential")T=Ch;else if(w==="interval")T=ml;else if(w==="categorical"){T=Ih,C=Object.create(null);for(const z of s.stops)C[z[0]]=z[1];A=typeof s.stops[0][0]}else{if(w!=="identity")throw new Error(`Unknown function type "${w}"`);T=Eh}if(f){const z={},B=[];for(let ie=0;ie<s.stops.length;ie++){const oe=s.stops[ie],_e=oe[0].zoom;z[_e]===void 0&&(z[_e]={zoom:_e,type:s.type,property:s.property,default:s.default,stops:[]},B.push(_e)),z[_e].stops.push([oe[0].value,oe[1]])}const U=[];for(const ie of B)U.push([z[ie].zoom,Th(z[ie],r)]);const W={name:"linear"};return{kind:"composite",interpolationType:W,interpolationFactor:vr.interpolationFactor.bind(void 0,W),zoomStops:U.map(ie=>ie[0]),evaluate:({zoom:ie},oe)=>Ch({stops:U,base:s.base},r,ie).evaluate(ie,oe)}}if(_){const z=w==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:vr.interpolationFactor.bind(void 0,z),zoomStops:s.stops.map(B=>B[0]),evaluate:({zoom:B})=>T(s,r,B,C,A)}}return{kind:"source",evaluate(z,B){const U=B&&B.properties?B.properties[s.property]:void 0;return U===void 0?Ds(s.default,r.default):T(s,r,U,C,A)}}}function Ds(s,r,c){return s!==void 0?s:r!==void 0?r:c!==void 0?c:void 0}function Ih(s,r,c,f,_){return Ds(typeof c===_?f[c]:void 0,s.default,r.default)}function ml(s,r,c){if(Pi(c)!=="number")return Ds(s.default,r.default);const f=s.stops.length;if(f===1||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[f-1][0])return s.stops[f-1][1];const _=nl(s.stops.map(w=>w[0]),c);return s.stops[_][1]}function Ch(s,r,c){const f=s.base!==void 0?s.base:1;if(Pi(c)!=="number")return Ds(s.default,r.default);const _=s.stops.length;if(_===1||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[_-1][0])return s.stops[_-1][1];const w=nl(s.stops.map(z=>z[0]),c),x=function(z,B,U,W){const ie=W-U,oe=z-U;return ie===0?0:B===1?oe/ie:(Math.pow(B,oe)-1)/(Math.pow(B,ie)-1)}(c,f,s.stops[w][0],s.stops[w+1][0]),T=s.stops[w][1],C=s.stops[w+1][1],A=br[r.type]||rf;return typeof T.evaluate=="function"?{evaluate(...z){const B=T.evaluate.apply(void 0,z),U=C.evaluate.apply(void 0,z);if(B!==void 0&&U!==void 0)return A(B,U,x,s.colorSpace)}}:A(T,C,x,s.colorSpace)}function Eh(s,r,c){switch(r.type){case"color":c=$i.parse(c);break;case"formatted":c=Dr.fromString(c.toString());break;case"resolvedImage":c=Fr.fromString(c.toString());break;case"padding":c=Rr.parse(c);break;default:Pi(c)===r.type||r.type==="enum"&&r.values[c]||(c=void 0)}return Ds(c,s.default,r.default)}Wr.register(Ms,{error:[{kind:"error"},[li],(s,[r])=>{throw new Cn(r.evaluate(s))}],typeof:[li,[ei],(s,[r])=>V(Mn(r.evaluate(s)))],"to-rgba":[q(vt,4),[wn],(s,[r])=>{const[c,f,_,w]=r.evaluate(s).rgb;return[255*c,255*f,255*_,w]}],rgb:[wn,[vt,vt,vt],Oc],rgba:[wn,[vt,vt,vt,vt],Oc],has:{type:Jt,overloads:[[[li],(s,[r])=>Nc(r.evaluate(s),s.properties())],[[li,Dn],(s,[r,c])=>Nc(r.evaluate(s),c.evaluate(s))]]},get:{type:ei,overloads:[[[li],(s,[r])=>jc(r.evaluate(s),s.properties())],[[li,Dn],(s,[r,c])=>jc(r.evaluate(s),c.evaluate(s))]]},"feature-state":[ei,[li],(s,[r])=>jc(r.evaluate(s),s.featureState||{})],properties:[Dn,[],s=>s.properties()],"geometry-type":[li,[],s=>s.geometryType()],id:[ei,[],s=>s.id()],zoom:[vt,[],s=>s.globals.zoom],"heatmap-density":[vt,[],s=>s.globals.heatmapDensity||0],"line-progress":[vt,[],s=>s.globals.lineProgress||0],accumulated:[ei,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[vt,ns(vt),(s,r)=>{let c=0;for(const f of r)c+=f.evaluate(s);return c}],"*":[vt,ns(vt),(s,r)=>{let c=1;for(const f of r)c*=f.evaluate(s);return c}],"-":{type:vt,overloads:[[[vt,vt],(s,[r,c])=>r.evaluate(s)-c.evaluate(s)],[[vt],(s,[r])=>-r.evaluate(s)]]},"/":[vt,[vt,vt],(s,[r,c])=>r.evaluate(s)/c.evaluate(s)],"%":[vt,[vt,vt],(s,[r,c])=>r.evaluate(s)%c.evaluate(s)],ln2:[vt,[],()=>Math.LN2],pi:[vt,[],()=>Math.PI],e:[vt,[],()=>Math.E],"^":[vt,[vt,vt],(s,[r,c])=>Math.pow(r.evaluate(s),c.evaluate(s))],sqrt:[vt,[vt],(s,[r])=>Math.sqrt(r.evaluate(s))],log10:[vt,[vt],(s,[r])=>Math.log(r.evaluate(s))/Math.LN10],ln:[vt,[vt],(s,[r])=>Math.log(r.evaluate(s))],log2:[vt,[vt],(s,[r])=>Math.log(r.evaluate(s))/Math.LN2],sin:[vt,[vt],(s,[r])=>Math.sin(r.evaluate(s))],cos:[vt,[vt],(s,[r])=>Math.cos(r.evaluate(s))],tan:[vt,[vt],(s,[r])=>Math.tan(r.evaluate(s))],asin:[vt,[vt],(s,[r])=>Math.asin(r.evaluate(s))],acos:[vt,[vt],(s,[r])=>Math.acos(r.evaluate(s))],atan:[vt,[vt],(s,[r])=>Math.atan(r.evaluate(s))],min:[vt,ns(vt),(s,r)=>Math.min(...r.map(c=>c.evaluate(s)))],max:[vt,ns(vt),(s,r)=>Math.max(...r.map(c=>c.evaluate(s)))],abs:[vt,[vt],(s,[r])=>Math.abs(r.evaluate(s))],round:[vt,[vt],(s,[r])=>{const c=r.evaluate(s);return c<0?-Math.round(-c):Math.round(c)}],floor:[vt,[vt],(s,[r])=>Math.floor(r.evaluate(s))],ceil:[vt,[vt],(s,[r])=>Math.ceil(r.evaluate(s))],"filter-==":[Jt,[li,ei],(s,[r,c])=>s.properties()[r.value]===c.value],"filter-id-==":[Jt,[ei],(s,[r])=>s.id()===r.value],"filter-type-==":[Jt,[li],(s,[r])=>s.geometryType()===r.value],"filter-<":[Jt,[li,ei],(s,[r,c])=>{const f=s.properties()[r.value],_=c.value;return typeof f==typeof _&&f<_}],"filter-id-<":[Jt,[ei],(s,[r])=>{const c=s.id(),f=r.value;return typeof c==typeof f&&c<f}],"filter->":[Jt,[li,ei],(s,[r,c])=>{const f=s.properties()[r.value],_=c.value;return typeof f==typeof _&&f>_}],"filter-id->":[Jt,[ei],(s,[r])=>{const c=s.id(),f=r.value;return typeof c==typeof f&&c>f}],"filter-<=":[Jt,[li,ei],(s,[r,c])=>{const f=s.properties()[r.value],_=c.value;return typeof f==typeof _&&f<=_}],"filter-id-<=":[Jt,[ei],(s,[r])=>{const c=s.id(),f=r.value;return typeof c==typeof f&&c<=f}],"filter->=":[Jt,[li,ei],(s,[r,c])=>{const f=s.properties()[r.value],_=c.value;return typeof f==typeof _&&f>=_}],"filter-id->=":[Jt,[ei],(s,[r])=>{const c=s.id(),f=r.value;return typeof c==typeof f&&c>=f}],"filter-has":[Jt,[ei],(s,[r])=>r.value in s.properties()],"filter-has-id":[Jt,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Jt,[q(li)],(s,[r])=>r.value.indexOf(s.geometryType())>=0],"filter-id-in":[Jt,[q(ei)],(s,[r])=>r.value.indexOf(s.id())>=0],"filter-in-small":[Jt,[li,q(ei)],(s,[r,c])=>c.value.indexOf(s.properties()[r.value])>=0],"filter-in-large":[Jt,[li,q(ei)],(s,[r,c])=>function(f,_,w,x){for(;w<=x;){const T=w+x>>1;if(_[T]===f)return!0;_[T]>f?x=T-1:w=T+1}return!1}(s.properties()[r.value],c.value,0,c.value.length-1)],all:{type:Jt,overloads:[[[Jt,Jt],(s,[r,c])=>r.evaluate(s)&&c.evaluate(s)],[ns(Jt),(s,r)=>{for(const c of r)if(!c.evaluate(s))return!1;return!0}]]},any:{type:Jt,overloads:[[[Jt,Jt],(s,[r,c])=>r.evaluate(s)||c.evaluate(s)],[ns(Jt),(s,r)=>{for(const c of r)if(c.evaluate(s))return!0;return!1}]]},"!":[Jt,[Jt],(s,[r])=>!r.evaluate(s)],"is-supported-script":[Jt,[li],(s,[r])=>{const c=s.globals&&s.globals.isSupportedScript;return!c||c(r.evaluate(s))}],upcase:[li,[li],(s,[r])=>r.evaluate(s).toUpperCase()],downcase:[li,[li],(s,[r])=>r.evaluate(s).toLowerCase()],concat:[li,ns(ei),(s,r)=>r.map(c=>va(c.evaluate(s))).join("")],"resolved-locale":[li,[gr],(s,[r])=>r.evaluate(s).resolvedLocale()]});class _l{constructor(r,c){var f;this.expression=r,this._warningHistory={},this._evaluator=new tl,this._defaultValue=c?(f=c).type==="color"&&pl(f.default)?new $i(0,0,0,0):f.type==="color"?$i.parse(f.default)||null:f.type==="padding"?Rr.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?Gr.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(r,c,f,_,w,x){return this._evaluator.globals=r,this._evaluator.feature=c,this._evaluator.featureState=f,this._evaluator.canonical=_,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(r,c,f,_,w,x){this._evaluator.globals=r,this._evaluator.feature=c||null,this._evaluator.featureState=f||null,this._evaluator.canonical=_,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Cn(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function gl(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Ms}function Rs(s,r){const c=new Ko(Ms,Ca,[],r?function(_){const w={color:wn,string:li,number:vt,enum:li,boolean:Jt,formatted:zr,padding:Zr,resolvedImage:yr,variableAnchorOffsetCollection:ye};return _.type==="array"?q(w[_.value]||ei,_.length):w[_.type]}(r):void 0),f=c.parse(s,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?fl(new _l(f,r)):Ps(c.errors)}class Fs{constructor(r,c){this.kind=r,this._styleExpression=c,this.isStateDependent=r!=="constant"&&!As(c.expression)}evaluateWithoutErrorHandling(r,c,f,_,w,x){return this._styleExpression.evaluateWithoutErrorHandling(r,c,f,_,w,x)}evaluate(r,c,f,_,w,x){return this._styleExpression.evaluate(r,c,f,_,w,x)}}class Bs{constructor(r,c,f,_){this.kind=r,this.zoomStops=f,this._styleExpression=c,this.isStateDependent=r!=="camera"&&!As(c.expression),this.interpolationType=_}evaluateWithoutErrorHandling(r,c,f,_,w,x){return this._styleExpression.evaluateWithoutErrorHandling(r,c,f,_,w,x)}evaluate(r,c,f,_,w,x){return this._styleExpression.evaluate(r,c,f,_,w,x)}interpolationFactor(r,c,f){return this.interpolationType?vr.interpolationFactor(this.interpolationType,r,c,f):0}}function $c(s,r){const c=Rs(s,r);if(c.result==="error")return c;const f=c.value.expression,_=Ea(f);if(!_&&!zs(r))return Ps([new un("","data expressions not supported")]);const w=La(f,["zoom"]);if(!w&&!Sh(r))return Ps([new un("","zoom expressions not supported")]);const x=Ma(f);return x||w?x instanceof un?Ps([x]):x instanceof vr&&!Uc(r)?Ps([new un("",'"interpolate" expressions cannot be used with this property')]):fl(x?new Bs(_?"camera":"composite",c.value,x.labels,x instanceof vr?x.interpolation:void 0):new Fs(_?"constant":"source",c.value)):Ps([new un("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Os{constructor(r,c){this._parameters=r,this._specification=c,Yn(this,Th(this._parameters,this._specification))}static deserialize(r){return new Os(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Ma(s){let r=null;if(s instanceof Uo)r=Ma(s.result);else if(s instanceof ol){for(const c of s.args)if(r=Ma(c),r)break}else(s instanceof Cs||s instanceof vr)&&s.input instanceof Wr&&s.input.name==="zoom"&&(r=s);return r instanceof un||s.eachChild(c=>{const f=Ma(c);f instanceof un?r=f:!r&&f?r=new un("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&f&&r!==f&&(r=new un("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function yl(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const r of s.slice(1))if(!yl(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}const bl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Vc(s){if(s==null)return{filter:()=>!0,needGeometry:!1};yl(s)||(s=vl(s));const r=Rs(s,bl);if(r.result==="error")throw new Error(r.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,f,_)=>r.value.evaluate(c,f,{},_),needGeometry:Lh(s)}}function of(s,r){return s<r?-1:s>r?1:0}function Lh(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let r=1;r<s.length;r++)if(Lh(s[r]))return!0;return!1}function vl(s){if(!s)return!0;const r=s[0];return s.length<=1?r!=="any":r==="=="?qc(s[1],s[2],"=="):r==="!="?Qn(qc(s[1],s[2],"==")):r==="<"||r===">"||r==="<="||r===">="?qc(s[1],s[2],r):r==="any"?(c=s.slice(1),["any"].concat(c.map(vl))):r==="all"?["all"].concat(s.slice(1).map(vl)):r==="none"?["all"].concat(s.slice(1).map(vl).map(Qn)):r==="in"?Aa(s[1],s.slice(2)):r==="!in"?Qn(Aa(s[1],s.slice(2))):r==="has"?Pa(s[1]):r!=="!has"||Qn(Pa(s[1]));var c}function qc(s,r,c){switch(s){case"$type":return[`filter-type-${c}`,r];case"$id":return[`filter-id-${c}`,r];default:return[`filter-${c}`,s,r]}}function Aa(s,r){if(r.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(c=>typeof c!=typeof r[0])?["filter-in-large",s,["literal",r.sort(of)]]:["filter-in-small",s,["literal",r]]}}function Pa(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Qn(s){return["!",s]}function rs(s){const r=typeof s;if(r==="number"||r==="boolean"||r==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let _="[";for(const w of s)_+=`${rs(w)},`;return`${_}]`}const c=Object.keys(s).sort();let f="{";for(let _=0;_<c.length;_++)f+=`${JSON.stringify(c[_])}:${rs(s[c[_]])},`;return`${f}}`}function Mh(s){let r="";for(const c of mt)r+=`/${rs(s[c])}`;return r}function Ah(s){const r=s.value;return r?[new ct(s.key,r,"constants have been deprecated as of v8")]:[]}function kn(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function ro(s){if(Array.isArray(s))return s.map(ro);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const r={};for(const c in s)r[c]=ro(s[c]);return r}return kn(s)}function Br(s){const r=s.key,c=s.value,f=s.valueSpec||{},_=s.objectElementValidators||{},w=s.style,x=s.styleSpec,T=s.validateSpec;let C=[];const A=Pi(c);if(A!=="object")return[new ct(r,c,`object expected, ${A} found`)];for(const z in c){const B=z.split(".")[0],U=f[B]||f["*"];let W;if(_[B])W=_[B];else if(f[B])W=T;else if(_["*"])W=_["*"];else{if(!f["*"]){C.push(new ct(r,c[z],`unknown property "${z}"`));continue}W=T}C=C.concat(W({key:(r&&`${r}.`)+z,value:c[z],valueSpec:U,style:w,styleSpec:x,object:c,objectKey:z,validateSpec:T},c))}for(const z in f)_[z]||f[z].required&&f[z].default===void 0&&c[z]===void 0&&C.push(new ct(r,c,`missing required property "${z}"`));return C}function za(s){const r=s.value,c=s.valueSpec,f=s.style,_=s.styleSpec,w=s.key,x=s.arrayElementValidator||s.validateSpec;if(Pi(r)!=="array")return[new ct(w,r,`array expected, ${Pi(r)} found`)];if(c.length&&r.length!==c.length)return[new ct(w,r,`array length ${c.length} expected, length ${r.length} found`)];if(c["min-length"]&&r.length<c["min-length"])return[new ct(w,r,`array length at least ${c["min-length"]} expected, length ${r.length} found`)];let T={type:c.value,values:c.values};_.$version<7&&(T.function=c.function),Pi(c.value)==="object"&&(T=c.value);let C=[];for(let A=0;A<r.length;A++)C=C.concat(x({array:r,arrayIndex:A,value:r[A],valueSpec:T,validateSpec:s.validateSpec,style:f,styleSpec:_,key:`${w}[${A}]`}));return C}function Zc(s){const r=s.key,c=s.value,f=s.valueSpec;let _=Pi(c);return _==="number"&&c!=c&&(_="NaN"),_!=="number"?[new ct(r,c,`number expected, ${_} found`)]:"minimum"in f&&c<f.minimum?[new ct(r,c,`${c} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&c>f.maximum?[new ct(r,c,`${c} is greater than the maximum value ${f.maximum}`)]:[]}function wl(s){const r=s.valueSpec,c=kn(s.value.type);let f,_,w,x={};const T=c!=="categorical"&&s.value.property===void 0,C=!T,A=Pi(s.value.stops)==="array"&&Pi(s.value.stops[0])==="array"&&Pi(s.value.stops[0][0])==="object",z=Br({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(W){if(c==="identity")return[new ct(W.key,W.value,'identity function may not have a "stops" property')];let ie=[];const oe=W.value;return ie=ie.concat(za({key:W.key,value:oe,valueSpec:W.valueSpec,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:B})),Pi(oe)==="array"&&oe.length===0&&ie.push(new ct(W.key,oe,"array must have at least one stop")),ie},default:function(W){return W.validateSpec({key:W.key,value:W.value,valueSpec:r,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec})}}});return c==="identity"&&T&&z.push(new ct(s.key,s.value,'missing required property "property"')),c==="identity"||s.value.stops||z.push(new ct(s.key,s.value,'missing required property "stops"')),c==="exponential"&&s.valueSpec.expression&&!Uc(s.valueSpec)&&z.push(new ct(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(C&&!zs(s.valueSpec)?z.push(new ct(s.key,s.value,"property functions not supported")):T&&!Sh(s.valueSpec)&&z.push(new ct(s.key,s.value,"zoom functions not supported"))),c!=="categorical"&&!A||s.value.property!==void 0||z.push(new ct(s.key,s.value,'"property" property is required')),z;function B(W){let ie=[];const oe=W.value,_e=W.key;if(Pi(oe)!=="array")return[new ct(_e,oe,`array expected, ${Pi(oe)} found`)];if(oe.length!==2)return[new ct(_e,oe,`array length 2 expected, length ${oe.length} found`)];if(A){if(Pi(oe[0])!=="object")return[new ct(_e,oe,`object expected, ${Pi(oe[0])} found`)];if(oe[0].zoom===void 0)return[new ct(_e,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new ct(_e,oe,"object stop key must have value")];if(w&&w>kn(oe[0].zoom))return[new ct(_e,oe[0].zoom,"stop zoom values must appear in ascending order")];kn(oe[0].zoom)!==w&&(w=kn(oe[0].zoom),_=void 0,x={}),ie=ie.concat(Br({key:`${_e}[0]`,value:oe[0],valueSpec:{zoom:{}},validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:Zc,value:U}}))}else ie=ie.concat(U({key:`${_e}[0]`,value:oe[0],valueSpec:{},validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec},oe));return gl(ro(oe[1]))?ie.concat([new ct(`${_e}[1]`,oe[1],"expressions are not allowed in function stops.")]):ie.concat(W.validateSpec({key:`${_e}[1]`,value:oe[1],valueSpec:r,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec}))}function U(W,ie){const oe=Pi(W.value),_e=kn(W.value),ve=W.value!==null?W.value:ie;if(f){if(oe!==f)return[new ct(W.key,ve,`${oe} stop domain type must match previous stop domain type ${f}`)]}else f=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean")return[new ct(W.key,ve,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&c!=="categorical"){let Ge=`number expected, ${oe} found`;return zs(r)&&c===void 0&&(Ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ct(W.key,ve,Ge)]}return c!=="categorical"||oe!=="number"||isFinite(_e)&&Math.floor(_e)===_e?c!=="categorical"&&oe==="number"&&_!==void 0&&_e<_?[new ct(W.key,ve,"stop domain values must appear in ascending order")]:(_=_e,c==="categorical"&&_e in x?[new ct(W.key,ve,"stop domain values must be unique")]:(x[_e]=!0,[])):[new ct(W.key,ve,`integer expected, found ${_e}`)]}}function Ns(s){const r=(s.expressionContext==="property"?$c:Rs)(ro(s.value),s.valueSpec);if(r.result==="error")return r.value.map(f=>new ct(`${s.key}${f.key}`,s.value,f.message));const c=r.value.expression||r.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!c.outputDefined())return[new ct(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!As(c))return[new ct(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!As(c))return[new ct(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!La(c,["zoom","feature-state"]))return[new ct(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Ea(c))return[new ct(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Po(s){const r=s.key,c=s.value,f=s.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(kn(c))===-1&&_.push(new ct(r,c,`expected one of [${f.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(f.values).indexOf(kn(c))===-1&&_.push(new ct(r,c,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(c)} found`)),_}function Gc(s){return yl(ro(s.value))?Ns(Yn({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):xl(s)}function xl(s){const r=s.value,c=s.key;if(Pi(r)!=="array")return[new ct(c,r,`array expected, ${Pi(r)} found`)];const f=s.styleSpec;let _,w=[];if(r.length<1)return[new ct(c,r,"filter array must have at least 1 element")];switch(w=w.concat(Po({key:`${c}[0]`,value:r[0],valueSpec:f.filter_operator,style:s.style,styleSpec:s.styleSpec})),kn(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&kn(r[1])==="$type"&&w.push(new ct(c,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&w.push(new ct(c,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(_=Pi(r[1]),_!=="string"&&w.push(new ct(`${c}[1]`,r[1],`string expected, ${_} found`)));for(let x=2;x<r.length;x++)_=Pi(r[x]),kn(r[1])==="$type"?w=w.concat(Po({key:`${c}[${x}]`,value:r[x],valueSpec:f.geometry_type,style:s.style,styleSpec:s.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&w.push(new ct(`${c}[${x}]`,r[x],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let x=1;x<r.length;x++)w=w.concat(xl({key:`${c}[${x}]`,value:r[x],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":_=Pi(r[1]),r.length!==2?w.push(new ct(c,r,`filter array for "${r[0]}" operator must have 2 elements`)):_!=="string"&&w.push(new ct(`${c}[1]`,r[1],`string expected, ${_} found`))}return w}function Wc(s,r){const c=s.key,f=s.validateSpec,_=s.style,w=s.styleSpec,x=s.value,T=s.objectKey,C=w[`${r}_${s.layerType}`];if(!C)return[];const A=T.match(/^(.*)-transition$/);if(r==="paint"&&A&&C[A[1]]&&C[A[1]].transition)return f({key:c,value:x,valueSpec:w.transition,style:_,styleSpec:w});const z=s.valueSpec||C[T];if(!z)return[new ct(c,x,`unknown property "${T}"`)];let B;if(Pi(x)==="string"&&zs(z)&&!z.tokens&&(B=/^{([^}]+)}$/.exec(x)))return[new ct(c,x,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(B[1])} }\`.`)];const U=[];return s.layerType==="symbol"&&(T==="text-field"&&_&&!_.glyphs&&U.push(new ct(c,x,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&pl(ro(x))&&kn(x.type)==="identity"&&U.push(new ct(c,x,'"text-font" does not support identity functions'))),U.concat(f({key:s.key,value:x,valueSpec:z,style:_,styleSpec:w,expressionContext:"property",propertyType:r,propertyKey:T}))}function kl(s){return Wc(s,"paint")}function Hc(s){return Wc(s,"layout")}function Xc(s){let r=[];const c=s.value,f=s.key,_=s.style,w=s.styleSpec;c.type||c.ref||r.push(new ct(f,c,'either "type" or "ref" is required'));let x=kn(c.type);const T=kn(c.ref);if(c.id){const C=kn(c.id);for(let A=0;A<s.arrayIndex;A++){const z=_.layers[A];kn(z.id)===C&&r.push(new ct(f,c.id,`duplicate layer id "${c.id}", previously used at line ${z.id.__line__}`))}}if("ref"in c){let C;["type","source","source-layer","filter","layout"].forEach(A=>{A in c&&r.push(new ct(f,c[A],`"${A}" is prohibited for ref layers`))}),_.layers.forEach(A=>{kn(A.id)===T&&(C=A)}),C?C.ref?r.push(new ct(f,c.ref,"ref cannot reference another ref layer")):x=kn(C.type):r.push(new ct(f,c.ref,`ref layer "${T}" not found`))}else if(x!=="background")if(c.source){const C=_.sources&&_.sources[c.source],A=C&&kn(C.type);C?A==="vector"&&x==="raster"?r.push(new ct(f,c.source,`layer "${c.id}" requires a raster source`)):A!=="raster-dem"&&x==="hillshade"?r.push(new ct(f,c.source,`layer "${c.id}" requires a raster-dem source`)):A==="raster"&&x!=="raster"?r.push(new ct(f,c.source,`layer "${c.id}" requires a vector source`)):A!=="vector"||c["source-layer"]?A==="raster-dem"&&x!=="hillshade"?r.push(new ct(f,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!c.paint||!c.paint["line-gradient"]||A==="geojson"&&C.lineMetrics||r.push(new ct(f,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new ct(f,c,`layer "${c.id}" must specify a "source-layer"`)):r.push(new ct(f,c.source,`source "${c.source}" not found`))}else r.push(new ct(f,c,'missing required property "source"'));return r=r.concat(Br({key:f,value:c,valueSpec:w.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${f}.type`,value:c.type,valueSpec:w.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:c,objectKey:"type"}),filter:Gc,layout:C=>Br({layer:c,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":A=>Hc(Yn({layerType:x},A))}}),paint:C=>Br({layer:c,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":A=>kl(Yn({layerType:x},A))}})}})),r}function os(s){const r=s.value,c=s.key,f=Pi(r);return f!=="string"?[new ct(c,r,`string expected, ${f} found`)]:[]}const Sl={promoteId:function({key:s,value:r}){if(Pi(r)==="string")return os({key:s,value:r});{const c=[];for(const f in r)c.push(...os({key:`${s}.${f}`,value:r[f]}));return c}}};function Da(s){const r=s.value,c=s.key,f=s.styleSpec,_=s.style,w=s.validateSpec;if(!r.type)return[new ct(c,r,'"type" is required')];const x=kn(r.type);let T;switch(x){case"vector":case"raster":return T=Br({key:c,value:r,valueSpec:f[`source_${x.replace("-","_")}`],style:s.style,styleSpec:f,objectElementValidators:Sl,validateSpec:w}),T;case"raster-dem":return T=function(C){var A;const z=(A=C.sourceName)!==null&&A!==void 0?A:"",B=C.value,U=C.styleSpec,W=U.source_raster_dem,ie=C.style;let oe=[];const _e=Pi(B);if(B===void 0)return oe;if(_e!=="object")return oe.push(new ct("source_raster_dem",B,`object expected, ${_e} found`)),oe;const ve=kn(B.encoding)==="custom",Ge=["redFactor","greenFactor","blueFactor","baseShift"],Ae=C.value.encoding?`"${C.value.encoding}"`:"Default";for(const Oe in B)!ve&&Ge.includes(Oe)?oe.push(new ct(Oe,B[Oe],`In "${z}": "${Oe}" is only valid when "encoding" is set to "custom". ${Ae} encoding found`)):W[Oe]?oe=oe.concat(C.validateSpec({key:Oe,value:B[Oe],valueSpec:W[Oe],validateSpec:C.validateSpec,style:ie,styleSpec:U})):oe.push(new ct(Oe,B[Oe],`unknown property "${Oe}"`));return oe}({sourceName:c,value:r,style:s.style,styleSpec:f,validateSpec:w}),T;case"geojson":if(T=Br({key:c,value:r,valueSpec:f.source_geojson,style:_,styleSpec:f,validateSpec:w,objectElementValidators:Sl}),r.cluster)for(const C in r.clusterProperties){const[A,z]=r.clusterProperties[C],B=typeof A=="string"?[A,["accumulated"],["get",C]]:A;T.push(...Ns({key:`${c}.${C}.map`,value:z,validateSpec:w,expressionContext:"cluster-map"})),T.push(...Ns({key:`${c}.${C}.reduce`,value:B,validateSpec:w,expressionContext:"cluster-reduce"}))}return T;case"video":return Br({key:c,value:r,valueSpec:f.source_video,style:_,validateSpec:w,styleSpec:f});case"image":return Br({key:c,value:r,valueSpec:f.source_image,style:_,validateSpec:w,styleSpec:f});case"canvas":return[new ct(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Po({key:`${c}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,validateSpec:w,styleSpec:f})}}function Kc(s){const r=s.value,c=s.styleSpec,f=c.light,_=s.style;let w=[];const x=Pi(r);if(r===void 0)return w;if(x!=="object")return w=w.concat([new ct("light",r,`object expected, ${x} found`)]),w;for(const T in r){const C=T.match(/^(.*)-transition$/);w=w.concat(C&&f[C[1]]&&f[C[1]].transition?s.validateSpec({key:T,value:r[T],valueSpec:c.transition,validateSpec:s.validateSpec,style:_,styleSpec:c}):f[T]?s.validateSpec({key:T,value:r[T],valueSpec:f[T],validateSpec:s.validateSpec,style:_,styleSpec:c}):[new ct(T,r[T],`unknown property "${T}"`)])}return w}function Jc(s){const r=s.value,c=s.styleSpec,f=c.sky,_=s.style,w=Pi(r);if(r===void 0)return[];if(w!=="object")return[new ct("sky",r,`object expected, ${w} found`)];let x=[];for(const T in r)x=x.concat(f[T]?s.validateSpec({key:T,value:r[T],valueSpec:f[T],style:_,styleSpec:c}):[new ct(T,r[T],`unknown property "${T}"`)]);return x}function Yc(s){const r=s.value,c=s.styleSpec,f=c.terrain,_=s.style;let w=[];const x=Pi(r);if(r===void 0)return w;if(x!=="object")return w=w.concat([new ct("terrain",r,`object expected, ${x} found`)]),w;for(const T in r)w=w.concat(f[T]?s.validateSpec({key:T,value:r[T],valueSpec:f[T],validateSpec:s.validateSpec,style:_,styleSpec:c}):[new ct(T,r[T],`unknown property "${T}"`)]);return w}function Qc(s){let r=[];const c=s.value,f=s.key;if(Array.isArray(c)){const _=[],w=[];for(const x in c)c[x].id&&_.includes(c[x].id)&&r.push(new ct(f,c,`all the sprites' ids must be unique, but ${c[x].id} is duplicated`)),_.push(c[x].id),c[x].url&&w.includes(c[x].url)&&r.push(new ct(f,c,`all the sprites' URLs must be unique, but ${c[x].url} is duplicated`)),w.push(c[x].url),r=r.concat(Br({key:`${f}[${x}]`,value:c[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return r}return os({key:f,value:c})}const Tl={"*":()=>[],array:za,boolean:function(s){const r=s.value,c=s.key,f=Pi(r);return f!=="boolean"?[new ct(c,r,`boolean expected, ${f} found`)]:[]},number:Zc,color:function(s){const r=s.key,c=s.value,f=Pi(c);return f!=="string"?[new ct(r,c,`color expected, ${f} found`)]:$i.parse(String(c))?[]:[new ct(r,c,`color expected, "${c}" found`)]},constants:Ah,enum:Po,filter:Gc,function:wl,layer:Xc,object:Br,source:Da,light:Kc,sky:Jc,terrain:Yc,projection:function(s){const r=s.value,c=s.styleSpec,f=c.projection,_=s.style,w=Pi(r);if(r===void 0)return[];if(w!=="object")return[new ct("projection",r,`object expected, ${w} found`)];let x=[];for(const T in r)x=x.concat(f[T]?s.validateSpec({key:T,value:r[T],valueSpec:f[T],style:_,styleSpec:c}):[new ct(T,r[T],`unknown property "${T}"`)]);return x},string:os,formatted:function(s){return os(s).length===0?[]:Ns(s)},resolvedImage:function(s){return os(s).length===0?[]:Ns(s)},padding:function(s){const r=s.key,c=s.value;if(Pi(c)==="array"){if(c.length<1||c.length>4)return[new ct(r,c,`padding requires 1 to 4 values; ${c.length} values found`)];const f={type:"number"};let _=[];for(let w=0;w<c.length;w++)_=_.concat(s.validateSpec({key:`${r}[${w}]`,value:c[w],validateSpec:s.validateSpec,valueSpec:f}));return _}return Zc({key:r,value:c,valueSpec:{}})},variableAnchorOffsetCollection:function(s){const r=s.key,c=s.value,f=Pi(c),_=s.styleSpec;if(f!=="array"||c.length<1||c.length%2!=0)return[new ct(r,c,"variableAnchorOffsetCollection requires a non-empty array of even length")];let w=[];for(let x=0;x<c.length;x+=2)w=w.concat(Po({key:`${r}[${x}]`,value:c[x],valueSpec:_.layout_symbol["text-anchor"]})),w=w.concat(za({key:`${r}[${x+1}]`,value:c[x+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:_}));return w},sprite:Qc};function js(s){const r=s.value,c=s.valueSpec,f=s.styleSpec;return s.validateSpec=js,c.expression&&pl(kn(r))?wl(s):c.expression&&gl(ro(r))?Ns(s):c.type&&Tl[c.type]?Tl[c.type](s):Br(Yn({},s,{valueSpec:c.type?f[c.type]:c}))}function Ph(s){const r=s.value,c=s.key,f=os(s);return f.length||(r.indexOf("{fontstack}")===-1&&f.push(new ct(c,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&f.push(new ct(c,r,'"glyphs" url must include a "{range}" token'))),f}function Hr(s,r=Te){let c=[];return c=c.concat(js({key:"",value:s,valueSpec:r.$root,styleSpec:r,style:s,validateSpec:js,objectElementValidators:{glyphs:Ph,"*":()=>[]}})),s.constants&&(c=c.concat(Ah({key:"constants",value:s.constants,style:s,styleSpec:r,validateSpec:js}))),eu(c)}function bo(s){return function(r){return s({...r,validateSpec:js})}}function eu(s){return[].concat(s).sort((r,c)=>r.line-c.line)}function oo(s){return function(...r){return eu(s.apply(this,r))}}Hr.source=oo(bo(Da)),Hr.sprite=oo(bo(Qc)),Hr.glyphs=oo(bo(Ph)),Hr.light=oo(bo(Kc)),Hr.sky=oo(bo(Jc)),Hr.terrain=oo(bo(Yc)),Hr.layer=oo(bo(Xc)),Hr.filter=oo(bo(Gc)),Hr.paintProperty=oo(bo(kl)),Hr.layoutProperty=oo(bo(Hc));const ss=Hr,sf=ss.light,af=ss.sky,zh=ss.paintProperty,Dh=ss.layoutProperty;function tu(s,r){let c=!1;if(r&&r.length)for(const f of r)s.fire(new qe(new Error(f.message))),c=!0;return c}class Us{constructor(r,c,f){const _=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const x=new Int32Array(this.arrayBuffer);r=x[0],this.d=(c=x[1])+2*(f=x[2]);for(let C=0;C<this.d*this.d;C++){const A=x[3+C],z=x[3+C+1];_.push(A===z?null:x.subarray(A,z))}const T=x[3+_.length+1];this.keys=x.subarray(x[3+_.length],T),this.bboxes=x.subarray(T),this.insert=this._insertReadonly}else{this.d=c+2*f;for(let x=0;x<this.d*this.d;x++)_.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=r,this.padding=f,this.scale=c/r,this.uid=0;const w=f/c*r;this.min=-w,this.max=r+w}insert(r,c,f,_,w){this._forEachCell(c,f,_,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,c,f,_,w,x){this.cells[w].push(x)}query(r,c,f,_,w){const x=this.min,T=this.max;if(r<=x&&c<=x&&T<=f&&T<=_&&!w)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(r,c,f,_,this._queryCell,C,{},w),C}}_queryCell(r,c,f,_,w,x,T,C){const A=this.cells[w];if(A!==null){const z=this.keys,B=this.bboxes;for(let U=0;U<A.length;U++){const W=A[U];if(T[W]===void 0){const ie=4*W;(C?C(B[ie+0],B[ie+1],B[ie+2],B[ie+3]):r<=B[ie+2]&&c<=B[ie+3]&&f>=B[ie+0]&&_>=B[ie+1])?(T[W]=!0,x.push(z[W])):T[W]=!1}}}}_forEachCell(r,c,f,_,w,x,T,C){const A=this._convertToCellCoord(r),z=this._convertToCellCoord(c),B=this._convertToCellCoord(f),U=this._convertToCellCoord(_);for(let W=A;W<=B;W++)for(let ie=z;ie<=U;ie++){const oe=this.d*ie+W;if((!C||C(this._convertFromCellCoord(W),this._convertFromCellCoord(ie),this._convertFromCellCoord(W+1),this._convertFromCellCoord(ie+1)))&&w.call(this,r,c,f,_,oe,x,T,C))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,c=3+this.cells.length+1+1;let f=0;for(let x=0;x<this.cells.length;x++)f+=this.cells[x].length;const _=new Int32Array(c+f+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let w=c;for(let x=0;x<r.length;x++){const T=r[x];_[3+x]=w,_.set(T,w),w+=T.length}return _[3+r.length]=w,_.set(this.keys,w),w+=this.keys.length,_[3+r.length+1]=w,_.set(this.bboxes,w),w+=this.bboxes.length,_.buffer}static serialize(r,c){const f=r.toArrayBuffer();return c&&c.push(f),{buffer:f}}static deserialize(r){return new Us(r.buffer)}}const Xr={};function zt(s,r,c={}){if(Xr[s])throw new Error(`${s} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:s,writeable:!1}),Xr[s]={klass:r,omit:c.omit||[],shallow:c.shallow||[]}}zt("Object",Object),zt("TransferableGridIndex",Us),zt("Color",$i),zt("Error",Error),zt("AJAXError",ai),zt("ResolvedImage",Fr),zt("StylePropertyFunction",Os),zt("StyleExpression",_l,{omit:["_evaluator"]}),zt("ZoomDependentExpression",Bs),zt("ZoomConstantExpression",Fs),zt("CompoundExpression",Wr,{omit:["_evaluate"]});for(const s in Ms)Ms[s]._classRegistryKey||zt(`Expression_${s}`,Ms[s]);function Il(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function iu(s){return s.$name||s.constructor._classRegistryKey}function Rh(s){return!function(r){if(r===null||typeof r!="object")return!1;const c=iu(r);return!(!c||c==="Object")}(s)&&(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||Il(s)||it(s)||ArrayBuffer.isView(s)||s instanceof ImageData)}function $s(s,r){if(Rh(s))return(Il(s)||it(s))&&r&&r.push(s),ArrayBuffer.isView(s)&&r&&r.push(s.buffer),s instanceof ImageData&&r&&r.push(s.data.buffer),s;if(Array.isArray(s)){const w=[];for(const x of s)w.push($s(x,r));return w}if(typeof s!="object")throw new Error("can't serialize object of type "+typeof s);const c=iu(s);if(!c)throw new Error(`can't serialize object of unregistered class ${s.constructor.name}`);if(!Xr[c])throw new Error(`${c} is not registered.`);const{klass:f}=Xr[c],_=f.serialize?f.serialize(s,r):{};if(f.serialize){if(r&&_===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in s){if(!s.hasOwnProperty(w)||Xr[c].omit.indexOf(w)>=0)continue;const x=s[w];_[w]=Xr[c].shallow.indexOf(w)>=0?x:$s(x,r)}s instanceof Error&&(_.message=s.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(_.$name=c),_}function Vs(s){if(Rh(s))return s;if(Array.isArray(s))return s.map(Vs);if(typeof s!="object")throw new Error("can't deserialize object of type "+typeof s);const r=iu(s)||"Object";if(!Xr[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:c}=Xr[r];if(!c)throw new Error(`can't deserialize unregistered class ${r}`);if(c.deserialize)return c.deserialize(s);const f=Object.create(c.prototype);for(const _ of Object.keys(s)){if(_==="$name")continue;const w=s[_];f[_]=Xr[r].shallow.indexOf(_)>=0?w:Vs(w)}return f}class nu{constructor(){this.first=!0}update(r,c){const f=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=c),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=f,!0))}}const Ti={"Latin-1 Supplement":s=>s>=128&&s<=255,"Hangul Jamo":s=>s>=4352&&s<=4607,Khmer:s=>s>=6016&&s<=6143,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Katakana:s=>s>=12448&&s<=12543,Kanbun:s=>s>=12688&&s<=12703,"CJK Strokes":s=>s>=12736&&s<=12783,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"Private Use Area":s=>s>=57344&&s<=63743,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function ru(s){for(const r of s)if(su(r.charCodeAt(0)))return!0;return!1}function lf(s){for(const r of s)if(!qs(r.charCodeAt(0)))return!1;return!0}function ou(s){const r=s.map(c=>{try{return new RegExp(`\\p{sc=${c}}`,"u").source}catch{return null}}).filter(c=>c);return new RegExp(r.join("|"),"u")}const cf=ou(["Arab","Dupl","Mong","Ougr","Syrc"]);function qs(s){return!cf.test(String.fromCodePoint(s))}const Fh=ou(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function su(s){return!(s!==746&&s!==747&&(s<4352||!(Ti["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||Ti["CJK Compatibility"](s)||Ti["CJK Strokes"](s)||!(!Ti["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||Ti["Enclosed CJK Letters and Months"](s)||Ti["Ideographic Description Characters"](s)||Ti.Kanbun(s)||Ti.Katakana(s)&&s!==12540||!(!Ti["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!Ti["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||Ti["Vertical Forms"](s)||Ti["Yijing Hexagram Symbols"](s)||/\p{sc=Cans}/u.test(String.fromCodePoint(s))||/\p{sc=Hang}/u.test(String.fromCodePoint(s))||Fh.test(String.fromCodePoint(s)))))}function Bh(s){return!(su(s)||function(r){return!!(Ti["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||Ti["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||Ti["Letterlike Symbols"](r)||Ti["Number Forms"](r)||Ti["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||Ti["Control Pictures"](r)&&r!==9251||Ti["Optical Character Recognition"](r)||Ti["Enclosed Alphanumerics"](r)||Ti["Geometric Shapes"](r)||Ti["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||Ti["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Ti["CJK Symbols and Punctuation"](r)||Ti.Katakana(r)||Ti["Private Use Area"](r)||Ti["CJK Compatibility Forms"](r)||Ti["Small Form Variants"](r)||Ti["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(s))}const uf=ou(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function au(s){return uf.test(String.fromCodePoint(s))}function hf(s,r){return!(!r&&au(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||Ti.Khmer(s))}function df(s){for(const r of s)if(au(r.charCodeAt(0)))return!0;return!1}const Or=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Yi{constructor(r,c){this.zoom=r,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new nu,this.transition={})}isSupportedScript(r){return function(c,f){for(const _ of c)if(!hf(_.charCodeAt(0),f))return!1;return!0}(r,Or.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,c=r-Math.floor(r),f=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*c}}}class Zs{constructor(r,c){this.property=r,this.value=c,this.expression=function(f,_){if(pl(f))return new Os(f,_);if(gl(f)){const w=$c(f,_);if(w.result==="error")throw new Error(w.value.map(x=>`${x.key}: ${x.message}`).join(", "));return w.value}{let w=f;return _.type==="color"&&typeof f=="string"?w=$i.parse(f):_.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(w=Gr.parse(f)):w=Rr.parse(f),{kind:"constant",evaluate:()=>w}}}(c===void 0?r.specification.default:c,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,c,f){return this.property.possiblyEvaluate(this,r,c,f)}}class Cl{constructor(r){this.property=r,this.value=new Zs(r,void 0)}transitioned(r,c){return new Oh(this.property,this.value,c,te({},r.transition,this.transition),r.now)}untransitioned(){return new Oh(this.property,this.value,null,{},0)}}class El{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return ce(this._values[r].value.value)}setValue(r,c){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new Cl(this._values[r].property)),this._values[r].value=new Zs(this._values[r].property,c===null?void 0:ce(c))}getTransition(r){return ce(this._values[r].transition)}setTransition(r,c){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new Cl(this._values[r].property)),this._values[r].transition=ce(c)||void 0}serialize(){const r={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(r[c]=f);const _=this.getTransition(c);_!==void 0&&(r[`${c}-transition`]=_)}return r}transitioned(r,c){const f=new Ra(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].transitioned(r,c._values[_]);return f}untransitioned(){const r=new Ra(this._properties);for(const c of Object.keys(this._values))r._values[c]=this._values[c].untransitioned();return r}}class Oh{constructor(r,c,f,_,w){this.property=r,this.value=c,this.begin=w+_.delay||0,this.end=this.begin+_.duration||0,r.specification.transition&&(_.delay||_.duration)&&(this.prior=f)}possiblyEvaluate(r,c,f){const _=r.now||0,w=this.value.possiblyEvaluate(r,c,f),x=this.prior;if(x){if(_>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(_<this.begin)return x.possiblyEvaluate(r,c,f);{const T=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(r,c,f),w,function(C){if(C<=0)return 0;if(C>=1)return 1;const A=C*C,z=A*C;return 4*(C<.5?z:3*(C-A)+z-.75)}(T))}}return w}}class Ra{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,c,f){const _=new Ba(this._properties);for(const w of Object.keys(this._values))_._values[w]=this._values[w].possiblyEvaluate(r,c,f);return _}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Fa{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}hasValue(r){return this._values[r].value!==void 0}getValue(r){return ce(this._values[r].value)}setValue(r,c){this._values[r]=new Zs(this._values[r].property,c===null?void 0:ce(c))}serialize(){const r={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(r[c]=f)}return r}possiblyEvaluate(r,c,f){const _=new Ba(this._properties);for(const w of Object.keys(this._values))_._values[w]=this._values[w].possiblyEvaluate(r,c,f);return _}}class vo{constructor(r,c,f){this.property=r,this.value=c,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,c,f,_){return this.property.evaluate(this.value,this.parameters,r,c,f,_)}}class Ba{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Ot{constructor(r){this.specification=r}possiblyEvaluate(r,c){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(c)}interpolate(r,c,f){const _=br[this.specification.type];return _?_(r,c,f):r}}class Yt{constructor(r,c){this.specification=r,this.overrides=c}possiblyEvaluate(r,c,f,_){return new vo(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(c,null,{},f,_)}:r.expression,c)}interpolate(r,c,f){if(r.value.kind!=="constant"||c.value.kind!=="constant")return r;if(r.value.value===void 0||c.value.value===void 0)return new vo(this,{kind:"constant",value:void 0},r.parameters);const _=br[this.specification.type];if(_){const w=_(r.value.value,c.value.value,f);return new vo(this,{kind:"constant",value:w},r.parameters)}return r}evaluate(r,c,f,_,w,x){return r.kind==="constant"?r.value:r.evaluate(c,f,_,w,x)}}class Ll extends Yt{possiblyEvaluate(r,c,f,_){if(r.value===void 0)return new vo(this,{kind:"constant",value:void 0},c);if(r.expression.kind==="constant"){const w=r.expression.evaluate(c,null,{},f,_),x=r.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,T=this._calculate(x,x,x,c);return new vo(this,{kind:"constant",value:T},c)}if(r.expression.kind==="camera"){const w=this._calculate(r.expression.evaluate({zoom:c.zoom-1}),r.expression.evaluate({zoom:c.zoom}),r.expression.evaluate({zoom:c.zoom+1}),c);return new vo(this,{kind:"constant",value:w},c)}return new vo(this,r.expression,c)}evaluate(r,c,f,_,w,x){if(r.kind==="source"){const T=r.evaluate(c,f,_,w,x);return this._calculate(T,T,T,c)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(c.zoom)-1},f,_),r.evaluate({zoom:Math.floor(c.zoom)},f,_),r.evaluate({zoom:Math.floor(c.zoom)+1},f,_),c):r.value}_calculate(r,c,f,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:r,to:c}:{from:f,to:c}}interpolate(r){return r}}class Ml{constructor(r){this.specification=r}possiblyEvaluate(r,c,f,_){if(r.value!==void 0){if(r.expression.kind==="constant"){const w=r.expression.evaluate(c,null,{},f,_);return this._calculate(w,w,w,c)}return this._calculate(r.expression.evaluate(new Yi(Math.floor(c.zoom-1),c)),r.expression.evaluate(new Yi(Math.floor(c.zoom),c)),r.expression.evaluate(new Yi(Math.floor(c.zoom+1),c)),c)}}_calculate(r,c,f,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:r,to:c}:{from:f,to:c}}interpolate(r){return r}}class lu{constructor(r){this.specification=r}possiblyEvaluate(r,c,f,_){return!!r.expression.evaluate(c,null,{},f,_)}interpolate(){return!1}}class v{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in r){const f=r[c];f.specification.overridable&&this.overridableProperties.push(c);const _=this.defaultPropertyValues[c]=new Zs(f,void 0),w=this.defaultTransitionablePropertyValues[c]=new Cl(f);this.defaultTransitioningPropertyValues[c]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=_.possiblyEvaluate({})}}}zt("DataDrivenProperty",Yt),zt("DataConstantProperty",Ot),zt("CrossFadedDataDrivenProperty",Ll),zt("CrossFadedProperty",Ml),zt("ColorRampProperty",lu);const i="-transition";class h extends st{constructor(r,c){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1},r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),c.layout&&(this._unevaluatedLayout=new Fa(c.layout)),c.paint)){this._transitionablePaint=new El(c.paint);for(const f in r.paint)this.setPaintProperty(f,r.paint[f],{validate:!1});for(const f in r.layout)this.setLayoutProperty(f,r.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ba(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,c,f={}){c!=null&&this._validate(Dh,`layers.${this.id}.layout.${r}`,r,c,f)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,c):this.visibility=c)}getPaintProperty(r){return r.endsWith(i)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,c,f={}){if(c!=null&&this._validate(zh,`layers.${this.id}.paint.${r}`,r,c,f))return!1;if(r.endsWith(i))return this._transitionablePaint.setTransition(r.slice(0,-11),c||void 0),!1;{const _=this._transitionablePaint._values[r],w=_.property.specification["property-type"]==="cross-faded-data-driven",x=_.value.isDataDriven(),T=_.value;this._transitionablePaint.setValue(r,c),this._handleSpecialPaintPropertyUpdate(r);const C=this._transitionablePaint._values[r].value;return C.isDataDriven()||x||w||this._handleOverridablePaintPropertyUpdate(r,T,C)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,c,f){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,c){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,c)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),fe(r,(c,f)=>!(c===void 0||f==="layout"&&!Object.keys(c).length||f==="paint"&&!Object.keys(c).length))}_validate(r,c,f,_,w={}){return(!w||w.validate!==!1)&&tu(this,r.call(ss,{key:c,layerType:this.type,objectKey:f,value:_,styleSpec:Te,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const c=this.paint.get(r);if(c instanceof vo&&zs(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const p={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class m{constructor(r,c){this._structArray=r,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class y{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,c){return r._trim(),c&&(r.isTransferred=!0,c.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const c=Object.create(this.prototype);return c.arrayBuffer=r.arrayBuffer,c.length=r.length,c.capacity=r.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function I(s,r=1){let c=0,f=0;return{members:s.map(_=>{const w=p[_.type].BYTES_PER_ELEMENT,x=c=E(c,Math.max(r,w)),T=_.components||1;return f=Math.max(f,w),c+=w*T,{name:_.name,type:_.type,components:T,offset:x}}),size:E(c,Math.max(f,r)),alignment:r}}function E(s,r){return Math.ceil(s/r)*r}class M extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c){const f=this.length;return this.resize(f+1),this.emplace(f,r,c)}emplace(r,c,f){const _=2*r;return this.int16[_+0]=c,this.int16[_+1]=f,r}}M.prototype.bytesPerElement=4,zt("StructArrayLayout2i4",M);class D extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,c,f)}emplace(r,c,f,_){const w=3*r;return this.int16[w+0]=c,this.int16[w+1]=f,this.int16[w+2]=_,r}}D.prototype.bytesPerElement=6,zt("StructArrayLayout3i6",D);class O extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,f,_){const w=this.length;return this.resize(w+1),this.emplace(w,r,c,f,_)}emplace(r,c,f,_,w){const x=4*r;return this.int16[x+0]=c,this.int16[x+1]=f,this.int16[x+2]=_,this.int16[x+3]=w,r}}O.prototype.bytesPerElement=8,zt("StructArrayLayout4i8",O);class N extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,f,_,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,r,c,f,_,w,x)}emplace(r,c,f,_,w,x,T){const C=6*r;return this.int16[C+0]=c,this.int16[C+1]=f,this.int16[C+2]=_,this.int16[C+3]=w,this.int16[C+4]=x,this.int16[C+5]=T,r}}N.prototype.bytesPerElement=12,zt("StructArrayLayout2i4i12",N);class Q extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,f,_,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,r,c,f,_,w,x)}emplace(r,c,f,_,w,x,T){const C=4*r,A=8*r;return this.int16[C+0]=c,this.int16[C+1]=f,this.uint8[A+4]=_,this.uint8[A+5]=w,this.uint8[A+6]=x,this.uint8[A+7]=T,r}}Q.prototype.bytesPerElement=8,zt("StructArrayLayout2i4ub8",Q);class se extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c){const f=this.length;return this.resize(f+1),this.emplace(f,r,c)}emplace(r,c,f){const _=2*r;return this.float32[_+0]=c,this.float32[_+1]=f,r}}se.prototype.bytesPerElement=8,zt("StructArrayLayout2f8",se);class de extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,f,_,w,x,T,C,A,z){const B=this.length;return this.resize(B+1),this.emplace(B,r,c,f,_,w,x,T,C,A,z)}emplace(r,c,f,_,w,x,T,C,A,z,B){const U=10*r;return this.uint16[U+0]=c,this.uint16[U+1]=f,this.uint16[U+2]=_,this.uint16[U+3]=w,this.uint16[U+4]=x,this.uint16[U+5]=T,this.uint16[U+6]=C,this.uint16[U+7]=A,this.uint16[U+8]=z,this.uint16[U+9]=B,r}}de.prototype.bytesPerElement=20,zt("StructArrayLayout10ui20",de);class ge extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,f,_,w,x,T,C,A,z,B,U){const W=this.length;return this.resize(W+1),this.emplace(W,r,c,f,_,w,x,T,C,A,z,B,U)}emplace(r,c,f,_,w,x,T,C,A,z,B,U,W){const ie=12*r;return this.int16[ie+0]=c,this.int16[ie+1]=f,this.int16[ie+2]=_,this.int16[ie+3]=w,this.uint16[ie+4]=x,this.uint16[ie+5]=T,this.uint16[ie+6]=C,this.uint16[ie+7]=A,this.int16[ie+8]=z,this.int16[ie+9]=B,this.int16[ie+10]=U,this.int16[ie+11]=W,r}}ge.prototype.bytesPerElement=24,zt("StructArrayLayout4i4ui4i24",ge);class xe extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,c,f)}emplace(r,c,f,_){const w=3*r;return this.float32[w+0]=c,this.float32[w+1]=f,this.float32[w+2]=_,r}}xe.prototype.bytesPerElement=12,zt("StructArrayLayout3f12",xe);class ke extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.uint32[1*r+0]=c,r}}ke.prototype.bytesPerElement=4,zt("StructArrayLayout1ul4",ke);class Ce extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,f,_,w,x,T,C,A){const z=this.length;return this.resize(z+1),this.emplace(z,r,c,f,_,w,x,T,C,A)}emplace(r,c,f,_,w,x,T,C,A,z){const B=10*r,U=5*r;return this.int16[B+0]=c,this.int16[B+1]=f,this.int16[B+2]=_,this.int16[B+3]=w,this.int16[B+4]=x,this.int16[B+5]=T,this.uint32[U+3]=C,this.uint16[B+8]=A,this.uint16[B+9]=z,r}}Ce.prototype.bytesPerElement=20,zt("StructArrayLayout6i1ul2ui20",Ce);class me extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,f,_,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,r,c,f,_,w,x)}emplace(r,c,f,_,w,x,T){const C=6*r;return this.int16[C+0]=c,this.int16[C+1]=f,this.int16[C+2]=_,this.int16[C+3]=w,this.int16[C+4]=x,this.int16[C+5]=T,r}}me.prototype.bytesPerElement=12,zt("StructArrayLayout2i2i2i12",me);class Re extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,f,_,w){const x=this.length;return this.resize(x+1),this.emplace(x,r,c,f,_,w)}emplace(r,c,f,_,w,x){const T=4*r,C=8*r;return this.float32[T+0]=c,this.float32[T+1]=f,this.float32[T+2]=_,this.int16[C+6]=w,this.int16[C+7]=x,r}}Re.prototype.bytesPerElement=16,zt("StructArrayLayout2f1f2i16",Re);class Be extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,f,_,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,r,c,f,_,w,x)}emplace(r,c,f,_,w,x,T){const C=16*r,A=4*r,z=8*r;return this.uint8[C+0]=c,this.uint8[C+1]=f,this.float32[A+1]=_,this.float32[A+2]=w,this.int16[z+6]=x,this.int16[z+7]=T,r}}Be.prototype.bytesPerElement=16,zt("StructArrayLayout2ub2f2i16",Be);class He extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,c,f)}emplace(r,c,f,_){const w=3*r;return this.uint16[w+0]=c,this.uint16[w+1]=f,this.uint16[w+2]=_,r}}He.prototype.bytesPerElement=6,zt("StructArrayLayout3ui6",He);class ot extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,f,_,w,x,T,C,A,z,B,U,W,ie,oe,_e,ve){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,r,c,f,_,w,x,T,C,A,z,B,U,W,ie,oe,_e,ve)}emplace(r,c,f,_,w,x,T,C,A,z,B,U,W,ie,oe,_e,ve,Ge){const Ae=24*r,Oe=12*r,Je=48*r;return this.int16[Ae+0]=c,this.int16[Ae+1]=f,this.uint16[Ae+2]=_,this.uint16[Ae+3]=w,this.uint32[Oe+2]=x,this.uint32[Oe+3]=T,this.uint32[Oe+4]=C,this.uint16[Ae+10]=A,this.uint16[Ae+11]=z,this.uint16[Ae+12]=B,this.float32[Oe+7]=U,this.float32[Oe+8]=W,this.uint8[Je+36]=ie,this.uint8[Je+37]=oe,this.uint8[Je+38]=_e,this.uint32[Oe+10]=ve,this.int16[Ae+22]=Ge,r}}ot.prototype.bytesPerElement=48,zt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ot);class wt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,f,_,w,x,T,C,A,z,B,U,W,ie,oe,_e,ve,Ge,Ae,Oe,Je,gt,Mt,Kt,Ct,Tt,$t,Rt){const Pt=this.length;return this.resize(Pt+1),this.emplace(Pt,r,c,f,_,w,x,T,C,A,z,B,U,W,ie,oe,_e,ve,Ge,Ae,Oe,Je,gt,Mt,Kt,Ct,Tt,$t,Rt)}emplace(r,c,f,_,w,x,T,C,A,z,B,U,W,ie,oe,_e,ve,Ge,Ae,Oe,Je,gt,Mt,Kt,Ct,Tt,$t,Rt,Pt){const tt=32*r,Zt=16*r;return this.int16[tt+0]=c,this.int16[tt+1]=f,this.int16[tt+2]=_,this.int16[tt+3]=w,this.int16[tt+4]=x,this.int16[tt+5]=T,this.int16[tt+6]=C,this.int16[tt+7]=A,this.uint16[tt+8]=z,this.uint16[tt+9]=B,this.uint16[tt+10]=U,this.uint16[tt+11]=W,this.uint16[tt+12]=ie,this.uint16[tt+13]=oe,this.uint16[tt+14]=_e,this.uint16[tt+15]=ve,this.uint16[tt+16]=Ge,this.uint16[tt+17]=Ae,this.uint16[tt+18]=Oe,this.uint16[tt+19]=Je,this.uint16[tt+20]=gt,this.uint16[tt+21]=Mt,this.uint16[tt+22]=Kt,this.uint32[Zt+12]=Ct,this.float32[Zt+13]=Tt,this.float32[Zt+14]=$t,this.uint16[tt+30]=Rt,this.uint16[tt+31]=Pt,r}}wt.prototype.bytesPerElement=64,zt("StructArrayLayout8i15ui1ul2f2ui64",wt);class It extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.float32[1*r+0]=c,r}}It.prototype.bytesPerElement=4,zt("StructArrayLayout1f4",It);class At extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,c,f)}emplace(r,c,f,_){const w=3*r;return this.uint16[6*r+0]=c,this.float32[w+1]=f,this.float32[w+2]=_,r}}At.prototype.bytesPerElement=12,zt("StructArrayLayout1ui2f12",At);class kt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,r,c,f)}emplace(r,c,f,_){const w=4*r;return this.uint32[2*r+0]=c,this.uint16[w+2]=f,this.uint16[w+3]=_,r}}kt.prototype.bytesPerElement=8,zt("StructArrayLayout1ul2ui8",kt);class xt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c){const f=this.length;return this.resize(f+1),this.emplace(f,r,c)}emplace(r,c,f){const _=2*r;return this.uint16[_+0]=c,this.uint16[_+1]=f,r}}xt.prototype.bytesPerElement=4,zt("StructArrayLayout2ui4",xt);class Nt extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.uint16[1*r+0]=c,r}}Nt.prototype.bytesPerElement=2,zt("StructArrayLayout1ui2",Nt);class ri extends y{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,f,_){const w=this.length;return this.resize(w+1),this.emplace(w,r,c,f,_)}emplace(r,c,f,_,w){const x=4*r;return this.float32[x+0]=c,this.float32[x+1]=f,this.float32[x+2]=_,this.float32[x+3]=w,r}}ri.prototype.bytesPerElement=16,zt("StructArrayLayout4f16",ri);class St extends m{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new S(this.anchorPointX,this.anchorPointY)}}St.prototype.size=20;class Lt extends Ce{get(r){return new St(this,r)}}zt("CollisionBoxArray",Lt);class ti extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ti.prototype.size=48;class Qi extends ot{get(r){return new ti(this,r)}}zt("PlacedSymbolArray",Qi);class fi extends m{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}fi.prototype.size=64;class ki extends wt{get(r){return new fi(this,r)}}zt("SymbolInstanceArray",ki);class en extends It{getoffsetX(r){return this.float32[1*r+0]}}zt("GlyphOffsetArray",en);class er extends D{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}zt("SymbolLineVertexArray",er);class so extends m{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}so.prototype.size=12;class tn extends At{get(r){return new so(this,r)}}zt("TextAnchorOffsetArray",tn);class wr extends m{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}wr.prototype.size=8;class hr extends kt{get(r){return new wr(this,r)}}zt("FeatureIndexArray",hr);class tr extends M{}class dr extends M{}class wo extends M{}class Gs extends N{}class Al extends Q{}class Ws extends se{}class Kr extends de{}class Pl extends ge{}class cu extends xe{}class Jr extends ke{}class Yr extends me{}class Vo extends Be{}class ao extends He{}class Wn extends xt{}const ir=I([{name:"a_pos",components:2,type:"Int16"}],4),{members:Nr}=ir;class Ii{constructor(r=[]){this.segments=r}prepareSegment(r,c,f,_){let w=this.segments[this.segments.length-1];return r>Ii.MAX_VERTEX_ARRAY_LENGTH&&We(`Max vertices per segment is ${Ii.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!w||w.vertexLength+r>Ii.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==_)&&(w={vertexOffset:c.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},_!==void 0&&(w.sortKey=_),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const r of this.segments)for(const c in r.vaos)r.vaos[c].destroy()}static simpleSegment(r,c,f,_){return new Ii([{vertexOffset:r,primitiveOffset:c,vertexLength:f,primitiveLength:_,vaos:{},sortKey:0}])}}function as(s,r){return 256*(s=Se(Math.floor(s),0,255))+Se(Math.floor(r),0,255)}Ii.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,zt("SegmentVector",Ii);const Hs=I([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Xs={exports:{}},Nh={exports:{}};Nh.exports=function(s,r){var c,f,_,w,x,T,C,A;for(f=s.length-(c=3&s.length),_=r,x=3432918353,T=461845907,A=0;A<f;)C=255&s.charCodeAt(A)|(255&s.charCodeAt(++A))<<8|(255&s.charCodeAt(++A))<<16|(255&s.charCodeAt(++A))<<24,++A,_=27492+(65535&(w=5*(65535&(_=(_^=C=(65535&(C=(C=(65535&C)*x+(((C>>>16)*x&65535)<<16)&4294967295)<<15|C>>>17))*T+(((C>>>16)*T&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(C=0,c){case 3:C^=(255&s.charCodeAt(A+2))<<16;case 2:C^=(255&s.charCodeAt(A+1))<<8;case 1:_^=C=(65535&(C=(C=(65535&(C^=255&s.charCodeAt(A)))*x+(((C>>>16)*x&65535)<<16)&4294967295)<<15|C>>>17))*T+(((C>>>16)*T&65535)<<16)&4294967295}return _^=s.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0};var ff=Nh.exports,jh={exports:{}};jh.exports=function(s,r){for(var c,f=s.length,_=r^f,w=0;f>=4;)c=1540483477*(65535&(c=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24))+((1540483477*(c>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),f-=4,++w;switch(f){case 3:_^=(255&s.charCodeAt(w+2))<<16;case 2:_^=(255&s.charCodeAt(w+1))<<8;case 1:_=1540483477*(65535&(_^=255&s.charCodeAt(w)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0};var qo=ff,Uh=jh.exports;Xs.exports=qo,Xs.exports.murmur3=qo,Xs.exports.murmur2=Uh;var zl=g(Xs.exports);class Oa{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,c,f,_){this.ids.push(Dl(r)),this.positions.push(c,f,_)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=Dl(r);let f=0,_=this.ids.length-1;for(;f<_;){const x=f+_>>1;this.ids[x]>=c?_=x:f=x+1}const w=[];for(;this.ids[f]===c;)w.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return w}static serialize(r,c){const f=new Float64Array(r.ids),_=new Uint32Array(r.positions);return Rl(f,_,0,f.length-1),c&&c.push(f.buffer,_.buffer),{ids:f,positions:_}}static deserialize(r){const c=new Oa;return c.ids=r.ids,c.positions=r.positions,c.indexed=!0,c}}function Dl(s){const r=+s;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:zl(String(s))}function Rl(s,r,c,f){for(;c<f;){const _=s[c+f>>1];let w=c-1,x=f+1;for(;;){do w++;while(s[w]<_);do x--;while(s[x]>_);if(w>=x)break;Ks(s,w,x),Ks(r,3*w,3*x),Ks(r,3*w+1,3*x+1),Ks(r,3*w+2,3*x+2)}x-c<f-x?(Rl(s,r,c,x),c=x+1):(Rl(s,r,x+1,f),f=x)}}function Ks(s,r,c){const f=s[r];s[r]=s[c],s[c]=f}zt("FeaturePositionMap",Oa);class Na{constructor(r,c){this.gl=r.gl,this.location=c}}class $h extends Na{constructor(r,c){super(r,c),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class tm extends Na{constructor(r,c){super(r,c),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class im extends Na{constructor(r,c){super(r,c),this.current=$i.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const H1=new Float32Array(16);function pf(s){return[as(255*s.r,255*s.g),as(255*s.b,255*s.a)]}class uu{constructor(r,c,f){this.value=r,this.uniformNames=c.map(_=>`u_${_}`),this.type=f}setUniform(r,c,f){r.set(f.constantOr(this.value))}getBinding(r,c,f){return this.type==="color"?new im(r,c):new $h(r,c)}}class Fl{constructor(r,c){this.uniformNames=c.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=r.tlbr}setUniform(r,c,f,_){const w=_==="u_pattern_to"?this.patternTo:_==="u_pattern_from"?this.patternFrom:_==="u_pixel_ratio_to"?this.pixelRatioTo:_==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&r.set(w)}getBinding(r,c,f){return f.substr(0,9)==="u_pattern"?new tm(r,c):new $h(r,c)}}class ls{constructor(r,c,f,_){this.expression=r,this.type=f,this.maxValue=0,this.paintVertexAttributes=c.map(w=>({name:`a_${w}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(r,c,f,_,w){const x=this.paintVertexArray.length,T=this.expression.evaluate(new Yi(0),c,{},_,[],w);this.paintVertexArray.resize(r),this._setPaintValue(x,r,T)}updatePaintArray(r,c,f,_){const w=this.expression.evaluate({zoom:0},f,_);this._setPaintValue(r,c,w)}_setPaintValue(r,c,f){if(this.type==="color"){const _=pf(f);for(let w=r;w<c;w++)this.paintVertexArray.emplace(w,_[0],_[1])}else{for(let _=r;_<c;_++)this.paintVertexArray.emplace(_,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class zo{constructor(r,c,f,_,w,x){this.expression=r,this.uniformNames=c.map(T=>`u_${T}_t`),this.type=f,this.useIntegerZoom=_,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=c.map(T=>({name:`a_${T}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(r,c,f,_,w){const x=this.expression.evaluate(new Yi(this.zoom),c,{},_,[],w),T=this.expression.evaluate(new Yi(this.zoom+1),c,{},_,[],w),C=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(C,r,x,T)}updatePaintArray(r,c,f,_){const w=this.expression.evaluate({zoom:this.zoom},f,_),x=this.expression.evaluate({zoom:this.zoom+1},f,_);this._setPaintValue(r,c,w,x)}_setPaintValue(r,c,f,_){if(this.type==="color"){const w=pf(f),x=pf(_);for(let T=r;T<c;T++)this.paintVertexArray.emplace(T,w[0],w[1],x[0],x[1])}else{for(let w=r;w<c;w++)this.paintVertexArray.emplace(w,f,_);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(_))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,c){const f=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,_=Se(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);r.set(_)}getBinding(r,c,f){return new $h(r,c)}}class Js{constructor(r,c,f,_,w,x){this.expression=r,this.type=c,this.useIntegerZoom=f,this.zoom=_,this.layerId=x,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(r,c,f){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(_,r,c.patterns&&c.patterns[this.layerId],f)}updatePaintArray(r,c,f,_,w){this._setPaintValues(r,c,f.patterns&&f.patterns[this.layerId],w)}_setPaintValues(r,c,f,_){if(!_||!f)return;const{min:w,mid:x,max:T}=f,C=_[w],A=_[x],z=_[T];if(C&&A&&z)for(let B=r;B<c;B++)this.zoomInPaintVertexArray.emplace(B,A.tl[0],A.tl[1],A.br[0],A.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],A.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(B,A.tl[0],A.tl[1],A.br[0],A.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],A.pixelRatio,z.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,Hs.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,Hs.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class nm{constructor(r,c,f){this.binders={},this._buffers=[];const _=[];for(const w in r.paint._values){if(!f(w))continue;const x=r.paint.get(w);if(!(x instanceof vo&&zs(x.property.specification)))continue;const T=X1(w,r.type),C=x.value,A=x.property.specification.type,z=x.property.useIntegerZoom,B=x.property.specification["property-type"],U=B==="cross-faded"||B==="cross-faded-data-driven";if(C.kind==="constant")this.binders[w]=U?new Fl(C.value,T):new uu(C.value,T,A),_.push(`/u_${w}`);else if(C.kind==="source"||U){const W=rm(w,A,"source");this.binders[w]=U?new Js(C,A,z,c,W,r.id):new ls(C,T,A,W),_.push(`/a_${w}`)}else{const W=rm(w,A,"composite");this.binders[w]=new zo(C,T,A,z,c,W),_.push(`/z_${w}`)}}this.cacheKey=_.sort().join("")}getMaxValue(r){const c=this.binders[r];return c instanceof ls||c instanceof zo?c.maxValue:0}populatePaintArrays(r,c,f,_,w){for(const x in this.binders){const T=this.binders[x];(T instanceof ls||T instanceof zo||T instanceof Js)&&T.populatePaintArray(r,c,f,_,w)}}setConstantPatternPositions(r,c){for(const f in this.binders){const _=this.binders[f];_ instanceof Fl&&_.setConstantPatternPositions(r,c)}}updatePaintArrays(r,c,f,_,w){let x=!1;for(const T in r){const C=c.getPositions(T);for(const A of C){const z=f.feature(A.index);for(const B in this.binders){const U=this.binders[B];if((U instanceof ls||U instanceof zo||U instanceof Js)&&U.expression.isStateDependent===!0){const W=_.paint.get(B);U.expression=W.value,U.updatePaintArray(A.start,A.end,z,r[T],w),x=!0}}}}return x}defines(){const r=[];for(const c in this.binders){const f=this.binders[c];(f instanceof uu||f instanceof Fl)&&r.push(...f.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return r}getBinderAttributes(){const r=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof ls||f instanceof zo)for(let _=0;_<f.paintVertexAttributes.length;_++)r.push(f.paintVertexAttributes[_].name);else if(f instanceof Js)for(let _=0;_<Hs.members.length;_++)r.push(Hs.members[_].name)}return r}getBinderUniforms(){const r=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof uu||f instanceof Fl||f instanceof zo)for(const _ of f.uniformNames)r.push(_)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,c){const f=[];for(const _ in this.binders){const w=this.binders[_];if(w instanceof uu||w instanceof Fl||w instanceof zo){for(const x of w.uniformNames)if(c[x]){const T=w.getBinding(r,c[x],x);f.push({name:x,property:_,binding:T})}}}return f}setUniforms(r,c,f,_){for(const{name:w,property:x,binding:T}of c)this.binders[x].setUniform(T,_,f.get(x),w)}updatePaintBuffers(r){this._buffers=[];for(const c in this.binders){const f=this.binders[c];if(r&&f instanceof Js){const _=r.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(f instanceof ls||f instanceof zo)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(r){for(const c in this.binders){const f=this.binders[c];(f instanceof ls||f instanceof zo||f instanceof Js)&&f.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const c=this.binders[r];(c instanceof ls||c instanceof zo||c instanceof Js)&&c.destroy()}}}class ja{constructor(r,c,f=()=>!0){this.programConfigurations={};for(const _ of r)this.programConfigurations[_.id]=new nm(_,c,f);this.needsUpload=!1,this._featureMap=new Oa,this._bufferOffset=0}populatePaintArrays(r,c,f,_,w,x){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(r,c,_,w,x);c.id!==void 0&&this._featureMap.add(c.id,f,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,c,f,_){for(const w of f)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(r,this._featureMap,c,w,_)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function X1(s,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${r}-`,"").replace(/-/g,"_")]}function rm(s,r,c){const f={color:{source:se,composite:ri},number:{source:It,composite:se}},_=function(w){return{"line-pattern":{source:Kr,composite:Kr},"fill-pattern":{source:Kr,composite:Kr},"fill-extrusion-pattern":{source:Kr,composite:Kr}}[w]}(s);return _&&_[c]||f[r][c]}zt("ConstantBinder",uu),zt("CrossFadedConstantBinder",Fl),zt("SourceExpressionBinder",ls),zt("CrossFadedCompositeBinder",Js),zt("CompositeExpressionBinder",zo),zt("ProgramConfiguration",nm,{omit:["_buffers"]}),zt("ProgramConfigurationSet",ja);const An=8192,mf=Math.pow(2,14)-1,om=-mf-1;function Ua(s){const r=An/s.extent,c=s.loadGeometry();for(let f=0;f<c.length;f++){const _=c[f];for(let w=0;w<_.length;w++){const x=_[w],T=Math.round(x.x*r),C=Math.round(x.y*r);x.x=Se(T,om,mf),x.y=Se(C,om,mf),(T<x.x||T>x.x+1||C<x.y||C>x.y+1)&&We("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function $a(s,r){return{type:s.type,id:s.id,properties:s.properties,geometry:r?Ua(s):[]}}function Vh(s,r,c,f,_){s.emplaceBack(2*r+(f+1)/2,2*c+(_+1)/2)}class _f{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new dr,this.indexArray=new ao,this.segments=new Ii,this.programConfigurations=new ja(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(r,c,f){const _=this.layers[0],w=[];let x=null,T=!1;_.type==="circle"&&(x=_.layout.get("circle-sort-key"),T=!x.isConstant());for(const{feature:C,id:A,index:z,sourceLayerIndex:B}of r){const U=this.layers[0]._featureFilter.needGeometry,W=$a(C,U);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),W,f))continue;const ie=T?x.evaluate(W,{},f):void 0,oe={id:A,properties:C.properties,type:C.type,sourceLayerIndex:B,index:z,geometry:U?W.geometry:Ua(C),patterns:{},sortKey:ie};w.push(oe)}T&&w.sort((C,A)=>C.sortKey-A.sortKey);for(const C of w){const{geometry:A,index:z,sourceLayerIndex:B}=C,U=r[z].feature;this.addFeature(C,A,z,f),c.featureIndex.insert(U,A,z,B,this.index)}}update(r,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Nr),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,c,f,_){for(const w of c)for(const x of w){const T=x.x,C=x.y;if(T<0||T>=An||C<0||C>=An)continue;const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),z=A.vertexLength;Vh(this.layoutVertexArray,T,C,-1,-1),Vh(this.layoutVertexArray,T,C,1,-1),Vh(this.layoutVertexArray,T,C,1,1),Vh(this.layoutVertexArray,T,C,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+3,z+2),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,{},_)}}function sm(s,r){for(let c=0;c<s.length;c++)if(Bl(r,s[c]))return!0;for(let c=0;c<r.length;c++)if(Bl(s,r[c]))return!0;return!!gf(s,r)}function K1(s,r,c){return!!Bl(s,r)||!!yf(r,s,c)}function am(s,r){if(s.length===1)return cm(r,s[0]);for(let c=0;c<r.length;c++){const f=r[c];for(let _=0;_<f.length;_++)if(Bl(s,f[_]))return!0}for(let c=0;c<s.length;c++)if(cm(r,s[c]))return!0;for(let c=0;c<r.length;c++)if(gf(s,r[c]))return!0;return!1}function J1(s,r,c){if(s.length>1){if(gf(s,r))return!0;for(let f=0;f<r.length;f++)if(yf(r[f],s,c))return!0}for(let f=0;f<s.length;f++)if(yf(s[f],r,c))return!0;return!1}function gf(s,r){if(s.length===0||r.length===0)return!1;for(let c=0;c<s.length-1;c++){const f=s[c],_=s[c+1];for(let w=0;w<r.length-1;w++)if(Y1(f,_,r[w],r[w+1]))return!0}return!1}function Y1(s,r,c,f){return Ee(s,c,f)!==Ee(r,c,f)&&Ee(s,r,c)!==Ee(s,r,f)}function yf(s,r,c){const f=c*c;if(r.length===1)return s.distSqr(r[0])<f;for(let _=1;_<r.length;_++)if(lm(s,r[_-1],r[_])<f)return!0;return!1}function lm(s,r,c){const f=r.distSqr(c);if(f===0)return s.distSqr(r);const _=((s.x-r.x)*(c.x-r.x)+(s.y-r.y)*(c.y-r.y))/f;return s.distSqr(_<0?r:_>1?c:c.sub(r)._mult(_)._add(r))}function cm(s,r){let c,f,_,w=!1;for(let x=0;x<s.length;x++){c=s[x];for(let T=0,C=c.length-1;T<c.length;C=T++)f=c[T],_=c[C],f.y>r.y!=_.y>r.y&&r.x<(_.x-f.x)*(r.y-f.y)/(_.y-f.y)+f.x&&(w=!w)}return w}function Bl(s,r){let c=!1;for(let f=0,_=s.length-1;f<s.length;_=f++){const w=s[f],x=s[_];w.y>r.y!=x.y>r.y&&r.x<(x.x-w.x)*(r.y-w.y)/(x.y-w.y)+w.x&&(c=!c)}return c}function Q1(s,r,c){const f=c[0],_=c[2];if(s.x<f.x&&r.x<f.x||s.x>_.x&&r.x>_.x||s.y<f.y&&r.y<f.y||s.y>_.y&&r.y>_.y)return!1;const w=Ee(s,r,c[0]);return w!==Ee(s,r,c[1])||w!==Ee(s,r,c[2])||w!==Ee(s,r,c[3])}function hu(s,r,c){const f=r.paint.get(s).value;return f.kind==="constant"?f.value:c.programConfigurations.get(r.id).getMaxValue(s)}function qh(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Zh(s,r,c,f,_){if(!r[0]&&!r[1])return s;const w=S.convert(r)._mult(_);c==="viewport"&&w._rotate(-f);const x=[];for(let T=0;T<s.length;T++)x.push(s[T].sub(w));return x}let um,hm;zt("CircleBucket",_f,{omit:["layers"]});var eb={get paint(){return hm=hm||new v({"circle-radius":new Yt(Te.paint_circle["circle-radius"]),"circle-color":new Yt(Te.paint_circle["circle-color"]),"circle-blur":new Yt(Te.paint_circle["circle-blur"]),"circle-opacity":new Yt(Te.paint_circle["circle-opacity"]),"circle-translate":new Ot(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new Ot(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ot(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ot(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Yt(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Yt(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Yt(Te.paint_circle["circle-stroke-opacity"])})},get layout(){return um=um||new v({"circle-sort-key":new Yt(Te.layout_circle["circle-sort-key"])})}},xr=1e-6,Ol=typeof Float32Array<"u"?Float32Array:Array;function bf(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function dm(s,r,c){var f=r[0],_=r[1],w=r[2],x=r[3],T=r[4],C=r[5],A=r[6],z=r[7],B=r[8],U=r[9],W=r[10],ie=r[11],oe=r[12],_e=r[13],ve=r[14],Ge=r[15],Ae=c[0],Oe=c[1],Je=c[2],gt=c[3];return s[0]=Ae*f+Oe*T+Je*B+gt*oe,s[1]=Ae*_+Oe*C+Je*U+gt*_e,s[2]=Ae*w+Oe*A+Je*W+gt*ve,s[3]=Ae*x+Oe*z+Je*ie+gt*Ge,s[4]=(Ae=c[4])*f+(Oe=c[5])*T+(Je=c[6])*B+(gt=c[7])*oe,s[5]=Ae*_+Oe*C+Je*U+gt*_e,s[6]=Ae*w+Oe*A+Je*W+gt*ve,s[7]=Ae*x+Oe*z+Je*ie+gt*Ge,s[8]=(Ae=c[8])*f+(Oe=c[9])*T+(Je=c[10])*B+(gt=c[11])*oe,s[9]=Ae*_+Oe*C+Je*U+gt*_e,s[10]=Ae*w+Oe*A+Je*W+gt*ve,s[11]=Ae*x+Oe*z+Je*ie+gt*Ge,s[12]=(Ae=c[12])*f+(Oe=c[13])*T+(Je=c[14])*B+(gt=c[15])*oe,s[13]=Ae*_+Oe*C+Je*U+gt*_e,s[14]=Ae*w+Oe*A+Je*W+gt*ve,s[15]=Ae*x+Oe*z+Je*ie+gt*Ge,s}Math.hypot||(Math.hypot=function(){for(var s=0,r=arguments.length;r--;)s+=arguments[r]*arguments[r];return Math.sqrt(s)});var du,tb=dm;function Gh(s,r,c){var f=r[0],_=r[1],w=r[2],x=r[3];return s[0]=c[0]*f+c[4]*_+c[8]*w+c[12]*x,s[1]=c[1]*f+c[5]*_+c[9]*w+c[13]*x,s[2]=c[2]*f+c[6]*_+c[10]*w+c[14]*x,s[3]=c[3]*f+c[7]*_+c[11]*w+c[15]*x,s}du=new Ol(4),Ol!=Float32Array&&(du[0]=0,du[1]=0,du[2]=0,du[3]=0);class ib extends h{constructor(r){super(r,eb)}createBucket(r){return new _f(r)}queryRadius(r){const c=r;return hu("circle-radius",this,c)+hu("circle-stroke-width",this,c)+qh(this.paint.get("circle-translate"))}queryIntersectsFeature(r,c,f,_,w,x,T,C){const A=Zh(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,T),z=this.paint.get("circle-radius").evaluate(c,f)+this.paint.get("circle-stroke-width").evaluate(c,f),B=this.paint.get("circle-pitch-alignment")==="map",U=B?A:function(ie,oe){return ie.map(_e=>fm(_e,oe))}(A,C),W=B?z*T:z;for(const ie of _)for(const oe of ie){const _e=B?oe:fm(oe,C);let ve=W;const Ge=Gh([],[oe.x,oe.y,0,1],C);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ve*=Ge[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ve*=x.cameraToCenterDistance/Ge[3]),K1(U,_e,ve))return!0}return!1}}function fm(s,r){const c=Gh([],[s.x,s.y,0,1],r);return new S(c[0]/c[3],c[1]/c[3])}class pm extends _f{}let mm;zt("HeatmapBucket",pm,{omit:["layers"]});var nb={get paint(){return mm=mm||new v({"heatmap-radius":new Yt(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Yt(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ot(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new lu(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ot(Te.paint_heatmap["heatmap-opacity"])})}};function vf(s,{width:r,height:c},f,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==r*c*f)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${r*c*f}`)}else _=new Uint8Array(r*c*f);return s.width=r,s.height=c,s.data=_,s}function _m(s,{width:r,height:c},f){if(r===s.width&&c===s.height)return;const _=vf({},{width:r,height:c},f);wf(s,_,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,r),height:Math.min(s.height,c)},f),s.width=r,s.height=c,s.data=_.data}function wf(s,r,c,f,_,w){if(_.width===0||_.height===0)return r;if(_.width>s.width||_.height>s.height||c.x>s.width-_.width||c.y>s.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>r.width||_.height>r.height||f.x>r.width-_.width||f.y>r.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const x=s.data,T=r.data;if(x===T)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<_.height;C++){const A=((c.y+C)*s.width+c.x)*w,z=((f.y+C)*r.width+f.x)*w;for(let B=0;B<_.width*w;B++)T[z+B]=x[A+B]}return r}class fu{constructor(r,c){vf(this,r,1,c)}resize(r){_m(this,r,1)}clone(){return new fu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,c,f,_,w){wf(r,c,f,_,w,1)}}class lo{constructor(r,c){vf(this,r,4,c)}resize(r){_m(this,r,4)}replace(r,c){c?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new lo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,c,f,_,w){wf(r,c,f,_,w,4)}}function gm(s){const r={},c=s.resolution||256,f=s.clips?s.clips.length:1,_=s.image||new lo({width:c,height:f});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const w=(x,T,C)=>{r[s.evaluationKey]=C;const A=s.expression.evaluate(r);_.data[x+T+0]=Math.floor(255*A.r/A.a),_.data[x+T+1]=Math.floor(255*A.g/A.a),_.data[x+T+2]=Math.floor(255*A.b/A.a),_.data[x+T+3]=Math.floor(255*A.a)};if(s.clips)for(let x=0,T=0;x<f;++x,T+=4*c)for(let C=0,A=0;C<c;C++,A+=4){const z=C/(c-1),{start:B,end:U}=s.clips[x];w(T,A,B*(1-z)+U*z)}else for(let x=0,T=0;x<c;x++,T+=4)w(0,T,x/(c-1));return _}zt("AlphaImage",fu),zt("RGBAImage",lo);const xf="big-fb";class rb extends h{createBucket(r){return new pm(r)}constructor(r){super(r,nb),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=gm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(xf)&&this.heatmapFbos.delete(xf)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let ym;var ob={get paint(){return ym=ym||new v({"hillshade-illumination-direction":new Ot(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ot(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ot(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ot(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ot(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ot(Te.paint_hillshade["hillshade-accent-color"])})}};class sb extends h{constructor(r){super(r,ob)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const ab=I([{name:"a_pos",components:2,type:"Int16"}],4),{members:lb}=ab;function bm(s,r,c=2){const f=r&&r.length,_=f?r[0]*c:s.length;let w=vm(s,0,_,c,!0);const x=[];if(!w||w.next===w.prev)return x;let T,C,A;if(f&&(w=function(z,B,U,W){const ie=[];for(let oe=0,_e=B.length;oe<_e;oe++){const ve=vm(z,B[oe]*W,oe<_e-1?B[oe+1]*W:z.length,W,!1);ve===ve.next&&(ve.steiner=!0),ie.push(_b(ve))}ie.sort(fb);for(let oe=0;oe<ie.length;oe++)U=pb(ie[oe],U);return U}(s,r,w,c)),s.length>80*c){T=1/0,C=1/0;let z=-1/0,B=-1/0;for(let U=c;U<_;U+=c){const W=s[U],ie=s[U+1];W<T&&(T=W),ie<C&&(C=ie),W>z&&(z=W),ie>B&&(B=ie)}A=Math.max(z-T,B-C),A=A!==0?32767/A:0}return pu(w,x,c,T,C,A,0),x}function vm(s,r,c,f,_){let w;if(_===function(x,T,C,A){let z=0;for(let B=T,U=C-A;B<C;B+=A)z+=(x[U]-x[B])*(x[B+1]+x[U+1]),U=B;return z}(s,r,c,f)>0)for(let x=r;x<c;x+=f)w=km(x/f|0,s[x],s[x+1],w);else for(let x=c-f;x>=r;x-=f)w=km(x/f|0,s[x],s[x+1],w);return w&&Wh(w,w.next)&&(_u(w),w=w.next),w}function Va(s,r){if(!s)return s;r||(r=s);let c,f=s;do if(c=!1,f.steiner||!Wh(f,f.next)&&En(f.prev,f,f.next)!==0)f=f.next;else{if(_u(f),f=r=f.prev,f===f.next)break;c=!0}while(c||f!==r);return r}function pu(s,r,c,f,_,w,x){if(!s)return;!x&&w&&function(C,A,z,B){let U=C;do U.z===0&&(U.z=kf(U.x,U.y,A,z,B)),U.prevZ=U.prev,U.nextZ=U.next,U=U.next;while(U!==C);U.prevZ.nextZ=null,U.prevZ=null,function(W){let ie,oe=1;do{let _e,ve=W;W=null;let Ge=null;for(ie=0;ve;){ie++;let Ae=ve,Oe=0;for(let gt=0;gt<oe&&(Oe++,Ae=Ae.nextZ,Ae);gt++);let Je=oe;for(;Oe>0||Je>0&&Ae;)Oe!==0&&(Je===0||!Ae||ve.z<=Ae.z)?(_e=ve,ve=ve.nextZ,Oe--):(_e=Ae,Ae=Ae.nextZ,Je--),Ge?Ge.nextZ=_e:W=_e,_e.prevZ=Ge,Ge=_e;ve=Ae}Ge.nextZ=null,oe*=2}while(ie>1)}(U)}(s,f,_,w);let T=s;for(;s.prev!==s.next;){const C=s.prev,A=s.next;if(w?ub(s,f,_,w):cb(s))r.push(C.i,s.i,A.i),_u(s),s=A.next,T=A.next;else if((s=A)===T){x?x===1?pu(s=hb(Va(s),r),r,c,f,_,w,2):x===2&&db(s,r,c,f,_,w):pu(Va(s),r,c,f,_,w,1);break}}}function cb(s){const r=s.prev,c=s,f=s.next;if(En(r,c,f)>=0)return!1;const _=r.x,w=c.x,x=f.x,T=r.y,C=c.y,A=f.y,z=_<w?_<x?_:x:w<x?w:x,B=T<C?T<A?T:A:C<A?C:A,U=_>w?_>x?_:x:w>x?w:x,W=T>C?T>A?T:A:C>A?C:A;let ie=f.next;for(;ie!==r;){if(ie.x>=z&&ie.x<=U&&ie.y>=B&&ie.y<=W&&Nl(_,T,w,C,x,A,ie.x,ie.y)&&En(ie.prev,ie,ie.next)>=0)return!1;ie=ie.next}return!0}function ub(s,r,c,f){const _=s.prev,w=s,x=s.next;if(En(_,w,x)>=0)return!1;const T=_.x,C=w.x,A=x.x,z=_.y,B=w.y,U=x.y,W=T<C?T<A?T:A:C<A?C:A,ie=z<B?z<U?z:U:B<U?B:U,oe=T>C?T>A?T:A:C>A?C:A,_e=z>B?z>U?z:U:B>U?B:U,ve=kf(W,ie,r,c,f),Ge=kf(oe,_e,r,c,f);let Ae=s.prevZ,Oe=s.nextZ;for(;Ae&&Ae.z>=ve&&Oe&&Oe.z<=Ge;){if(Ae.x>=W&&Ae.x<=oe&&Ae.y>=ie&&Ae.y<=_e&&Ae!==_&&Ae!==x&&Nl(T,z,C,B,A,U,Ae.x,Ae.y)&&En(Ae.prev,Ae,Ae.next)>=0||(Ae=Ae.prevZ,Oe.x>=W&&Oe.x<=oe&&Oe.y>=ie&&Oe.y<=_e&&Oe!==_&&Oe!==x&&Nl(T,z,C,B,A,U,Oe.x,Oe.y)&&En(Oe.prev,Oe,Oe.next)>=0))return!1;Oe=Oe.nextZ}for(;Ae&&Ae.z>=ve;){if(Ae.x>=W&&Ae.x<=oe&&Ae.y>=ie&&Ae.y<=_e&&Ae!==_&&Ae!==x&&Nl(T,z,C,B,A,U,Ae.x,Ae.y)&&En(Ae.prev,Ae,Ae.next)>=0)return!1;Ae=Ae.prevZ}for(;Oe&&Oe.z<=Ge;){if(Oe.x>=W&&Oe.x<=oe&&Oe.y>=ie&&Oe.y<=_e&&Oe!==_&&Oe!==x&&Nl(T,z,C,B,A,U,Oe.x,Oe.y)&&En(Oe.prev,Oe,Oe.next)>=0)return!1;Oe=Oe.nextZ}return!0}function hb(s,r){let c=s;do{const f=c.prev,_=c.next.next;!Wh(f,_)&&wm(f,c,c.next,_)&&mu(f,_)&&mu(_,f)&&(r.push(f.i,c.i,_.i),_u(c),_u(c.next),c=s=_),c=c.next}while(c!==s);return Va(c)}function db(s,r,c,f,_,w){let x=s;do{let T=x.next.next;for(;T!==x.prev;){if(x.i!==T.i&&gb(x,T)){let C=xm(x,T);return x=Va(x,x.next),C=Va(C,C.next),pu(x,r,c,f,_,w,0),void pu(C,r,c,f,_,w,0)}T=T.next}x=x.next}while(x!==s)}function fb(s,r){return s.x-r.x}function pb(s,r){const c=function(_,w){let x=w;const T=_.x,C=_.y;let A,z=-1/0;do{if(C<=x.y&&C>=x.next.y&&x.next.y!==x.y){const oe=x.x+(C-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(oe<=T&&oe>z&&(z=oe,A=x.x<x.next.x?x:x.next,oe===T))return A}x=x.next}while(x!==w);if(!A)return null;const B=A,U=A.x,W=A.y;let ie=1/0;x=A;do{if(T>=x.x&&x.x>=U&&T!==x.x&&Nl(C<W?T:z,C,U,W,C<W?z:T,C,x.x,x.y)){const oe=Math.abs(C-x.y)/(T-x.x);mu(x,_)&&(oe<ie||oe===ie&&(x.x>A.x||x.x===A.x&&mb(A,x)))&&(A=x,ie=oe)}x=x.next}while(x!==B);return A}(s,r);if(!c)return r;const f=xm(c,s);return Va(f,f.next),Va(c,c.next)}function mb(s,r){return En(s.prev,s,r.prev)<0&&En(r.next,s,s.next)<0}function kf(s,r,c,f,_){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-c)*_|0)|s<<8))|s<<4))|s<<2))|s<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-f)*_|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function _b(s){let r=s,c=s;do(r.x<c.x||r.x===c.x&&r.y<c.y)&&(c=r),r=r.next;while(r!==s);return c}function Nl(s,r,c,f,_,w,x,T){return(_-x)*(r-T)>=(s-x)*(w-T)&&(s-x)*(f-T)>=(c-x)*(r-T)&&(c-x)*(w-T)>=(_-x)*(f-T)}function gb(s,r){return s.next.i!==r.i&&s.prev.i!==r.i&&!function(c,f){let _=c;do{if(_.i!==c.i&&_.next.i!==c.i&&_.i!==f.i&&_.next.i!==f.i&&wm(_,_.next,c,f))return!0;_=_.next}while(_!==c);return!1}(s,r)&&(mu(s,r)&&mu(r,s)&&function(c,f){let _=c,w=!1;const x=(c.x+f.x)/2,T=(c.y+f.y)/2;do _.y>T!=_.next.y>T&&_.next.y!==_.y&&x<(_.next.x-_.x)*(T-_.y)/(_.next.y-_.y)+_.x&&(w=!w),_=_.next;while(_!==c);return w}(s,r)&&(En(s.prev,s,r.prev)||En(s,r.prev,r))||Wh(s,r)&&En(s.prev,s,s.next)>0&&En(r.prev,r,r.next)>0)}function En(s,r,c){return(r.y-s.y)*(c.x-r.x)-(r.x-s.x)*(c.y-r.y)}function Wh(s,r){return s.x===r.x&&s.y===r.y}function wm(s,r,c,f){const _=Xh(En(s,r,c)),w=Xh(En(s,r,f)),x=Xh(En(c,f,s)),T=Xh(En(c,f,r));return _!==w&&x!==T||!(_!==0||!Hh(s,c,r))||!(w!==0||!Hh(s,f,r))||!(x!==0||!Hh(c,s,f))||!(T!==0||!Hh(c,r,f))}function Hh(s,r,c){return r.x<=Math.max(s.x,c.x)&&r.x>=Math.min(s.x,c.x)&&r.y<=Math.max(s.y,c.y)&&r.y>=Math.min(s.y,c.y)}function Xh(s){return s>0?1:s<0?-1:0}function mu(s,r){return En(s.prev,s,s.next)<0?En(s,r,s.next)>=0&&En(s,s.prev,r)>=0:En(s,r,s.prev)<0||En(s,s.next,r)<0}function xm(s,r){const c=Sf(s.i,s.x,s.y),f=Sf(r.i,r.x,r.y),_=s.next,w=r.prev;return s.next=r,r.prev=s,c.next=_,_.prev=c,f.next=c,c.prev=f,w.next=f,f.prev=w,f}function km(s,r,c,f){const _=Sf(s,r,c);return f?(_.next=f.next,_.prev=f,f.next.prev=_,f.next=_):(_.prev=_,_.next=_),_}function _u(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Sf(s,r,c){return{i:s,x:r,y:c,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Tf(s,r,c){const f=c.patternDependencies;let _=!1;for(const w of r){const x=w.paint.get(`${s}-pattern`);x.isConstant()||(_=!0);const T=x.constantOr(null);T&&(_=!0,f[T.to]=!0,f[T.from]=!0)}return _}function If(s,r,c,f,_){const w=_.patternDependencies;for(const x of r){const T=x.paint.get(`${s}-pattern`).value;if(T.kind!=="constant"){let C=T.evaluate({zoom:f-1},c,{},_.availableImages),A=T.evaluate({zoom:f},c,{},_.availableImages),z=T.evaluate({zoom:f+1},c,{},_.availableImages);C=C&&C.name?C.name:C,A=A&&A.name?A.name:A,z=z&&z.name?z.name:z,w[C]=!0,w[A]=!0,w[z]=!0,c.patterns[x.id]={min:C,mid:A,max:z}}}return c}class Cf{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new wo,this.indexArray=new ao,this.indexArray2=new Wn,this.programConfigurations=new ja(r.layers,r.zoom),this.segments=new Ii,this.segments2=new Ii,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(r,c,f){this.hasPattern=Tf("fill",this.layers,c);const _=this.layers[0].layout.get("fill-sort-key"),w=!_.isConstant(),x=[];for(const{feature:T,id:C,index:A,sourceLayerIndex:z}of r){const B=this.layers[0]._featureFilter.needGeometry,U=$a(T,B);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),U,f))continue;const W=w?_.evaluate(U,{},f,c.availableImages):void 0,ie={id:C,properties:T.properties,type:T.type,sourceLayerIndex:z,index:A,geometry:B?U.geometry:Ua(T),patterns:{},sortKey:W};x.push(ie)}w&&x.sort((T,C)=>T.sortKey-C.sortKey);for(const T of x){const{geometry:C,index:A,sourceLayerIndex:z}=T;if(this.hasPattern){const B=If("fill",this.layers,T,this.zoom,c);this.patternFeatures.push(B)}else this.addFeature(T,C,A,f,{});c.featureIndex.insert(r[A].feature,C,A,z,this.index)}}update(r,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,f)}addFeatures(r,c,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,lb),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,c,f,_,w){for(const x of cl(c,500)){let T=0;for(const W of x)T+=W.length;const C=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),A=C.vertexLength,z=[],B=[];for(const W of x){if(W.length===0)continue;W!==x[0]&&B.push(z.length/2);const ie=this.segments2.prepareSegment(W.length,this.layoutVertexArray,this.indexArray2),oe=ie.vertexLength;this.layoutVertexArray.emplaceBack(W[0].x,W[0].y),this.indexArray2.emplaceBack(oe+W.length-1,oe),z.push(W[0].x),z.push(W[0].y);for(let _e=1;_e<W.length;_e++)this.layoutVertexArray.emplaceBack(W[_e].x,W[_e].y),this.indexArray2.emplaceBack(oe+_e-1,oe+_e),z.push(W[_e].x),z.push(W[_e].y);ie.vertexLength+=W.length,ie.primitiveLength+=W.length}const U=bm(z,B);for(let W=0;W<U.length;W+=3)this.indexArray.emplaceBack(A+U[W],A+U[W+1],A+U[W+2]);C.vertexLength+=T,C.primitiveLength+=U.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,w,_)}}let Sm,Tm;zt("FillBucket",Cf,{omit:["layers","patternFeatures"]});var yb={get paint(){return Tm=Tm||new v({"fill-antialias":new Ot(Te.paint_fill["fill-antialias"]),"fill-opacity":new Yt(Te.paint_fill["fill-opacity"]),"fill-color":new Yt(Te.paint_fill["fill-color"]),"fill-outline-color":new Yt(Te.paint_fill["fill-outline-color"]),"fill-translate":new Ot(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new Ot(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ll(Te.paint_fill["fill-pattern"])})},get layout(){return Sm=Sm||new v({"fill-sort-key":new Yt(Te.layout_fill["fill-sort-key"])})}};class bb extends h{constructor(r){super(r,yb)}recalculate(r,c){super.recalculate(r,c);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Cf(r)}queryRadius(){return qh(this.paint.get("fill-translate"))}queryIntersectsFeature(r,c,f,_,w,x,T){return am(Zh(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,T),_)}isTileClipped(){return!0}}const vb=I([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),wb=I([{name:"a_centroid",components:2,type:"Int16"}],4),{members:xb}=vb;var Ys={},kb=b,Im=jl;function jl(s,r,c,f,_){this.properties={},this.extent=c,this.type=0,this._pbf=s,this._geometry=-1,this._keys=f,this._values=_,s.readFields(Sb,this,r)}function Sb(s,r,c){s==1?r.id=c.readVarint():s==2?function(f,_){for(var w=f.readVarint()+f.pos;f.pos<w;){var x=_._keys[f.readVarint()],T=_._values[f.readVarint()];_.properties[x]=T}}(c,r):s==3?r.type=c.readVarint():s==4&&(r._geometry=c.pos)}function Tb(s){for(var r,c,f=0,_=0,w=s.length,x=w-1;_<w;x=_++)f+=((c=s[x]).x-(r=s[_]).x)*(r.y+c.y);return f}jl.types=["Unknown","Point","LineString","Polygon"],jl.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var r,c=s.readVarint()+s.pos,f=1,_=0,w=0,x=0,T=[];s.pos<c;){if(_<=0){var C=s.readVarint();f=7&C,_=C>>3}if(_--,f===1||f===2)w+=s.readSVarint(),x+=s.readSVarint(),f===1&&(r&&T.push(r),r=[]),r.push(new kb(w,x));else{if(f!==7)throw new Error("unknown command "+f);r&&r.push(r[0].clone())}}return r&&T.push(r),T},jl.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var r=s.readVarint()+s.pos,c=1,f=0,_=0,w=0,x=1/0,T=-1/0,C=1/0,A=-1/0;s.pos<r;){if(f<=0){var z=s.readVarint();c=7&z,f=z>>3}if(f--,c===1||c===2)(_+=s.readSVarint())<x&&(x=_),_>T&&(T=_),(w+=s.readSVarint())<C&&(C=w),w>A&&(A=w);else if(c!==7)throw new Error("unknown command "+c)}return[x,C,T,A]},jl.prototype.toGeoJSON=function(s,r,c){var f,_,w=this.extent*Math.pow(2,c),x=this.extent*s,T=this.extent*r,C=this.loadGeometry(),A=jl.types[this.type];function z(W){for(var ie=0;ie<W.length;ie++){var oe=W[ie];W[ie]=[360*(oe.x+x)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(oe.y+T)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var B=[];for(f=0;f<C.length;f++)B[f]=C[f][0];z(C=B);break;case 2:for(f=0;f<C.length;f++)z(C[f]);break;case 3:for(C=function(W){var ie=W.length;if(ie<=1)return[W];for(var oe,_e,ve=[],Ge=0;Ge<ie;Ge++){var Ae=Tb(W[Ge]);Ae!==0&&(_e===void 0&&(_e=Ae<0),_e===Ae<0?(oe&&ve.push(oe),oe=[W[Ge]]):oe.push(W[Ge]))}return oe&&ve.push(oe),ve}(C),f=0;f<C.length;f++)for(_=0;_<C[f].length;_++)z(C[f][_])}C.length===1?C=C[0]:A="Multi"+A;var U={type:"Feature",geometry:{type:A,coordinates:C},properties:this.properties};return"id"in this&&(U.id=this.id),U};var Ib=Im,Cm=Em;function Em(s,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Cb,this,r),this.length=this._features.length}function Cb(s,r,c){s===15?r.version=c.readVarint():s===1?r.name=c.readString():s===5?r.extent=c.readVarint():s===2?r._features.push(c.pos):s===3?r._keys.push(c.readString()):s===4&&r._values.push(function(f){for(var _=null,w=f.readVarint()+f.pos;f.pos<w;){var x=f.readVarint()>>3;_=x===1?f.readString():x===2?f.readFloat():x===3?f.readDouble():x===4?f.readVarint64():x===5?f.readVarint():x===6?f.readSVarint():x===7?f.readBoolean():null}return _}(c))}Em.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var r=this._pbf.readVarint()+this._pbf.pos;return new Ib(this._pbf,r,this.extent,this._keys,this._values)};var Eb=Cm;function Lb(s,r,c){if(s===3){var f=new Eb(c,c.readVarint()+c.pos);f.length&&(r[f.name]=f)}}Ys.VectorTile=function(s,r){this.layers=s.readFields(Lb,{},r)},Ys.VectorTileFeature=Im,Ys.VectorTileLayer=Cm;const Mb=Ys.VectorTileFeature.types,Ef=Math.pow(2,13);function gu(s,r,c,f,_,w,x,T){s.emplaceBack(r,c,2*Math.floor(f*Ef)+x,_*Ef*2,w*Ef*2,Math.round(T))}class Lf{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new Gs,this.centroidVertexArray=new tr,this.indexArray=new ao,this.programConfigurations=new ja(r.layers,r.zoom),this.segments=new Ii,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(r,c,f){this.features=[],this.hasPattern=Tf("fill-extrusion",this.layers,c);for(const{feature:_,id:w,index:x,sourceLayerIndex:T}of r){const C=this.layers[0]._featureFilter.needGeometry,A=$a(_,C);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),A,f))continue;const z={id:w,sourceLayerIndex:T,index:x,geometry:C?A.geometry:Ua(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(If("fill-extrusion",this.layers,z,this.zoom,c)):this.addFeature(z,z.geometry,x,f,{}),c.featureIndex.insert(_,z.geometry,x,T,this.index,!0)}}addFeatures(r,c,f){for(const _ of this.features){const{geometry:w}=_;this.addFeature(_,w,_.index,c,f)}}update(r,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,xb),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,wb.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,c,f,_,w){for(const x of cl(c,500)){const T={x:0,y:0,vertexCount:0};let C=0;for(const ie of x)C+=ie.length;let A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ie of x){if(ie.length===0||Pb(ie))continue;let oe=0;for(let _e=0;_e<ie.length;_e++){const ve=ie[_e];if(_e>=1){const Ge=ie[_e-1];if(!Ab(ve,Ge)){A.vertexLength+4>Ii.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ae=ve.sub(Ge)._perp()._unit(),Oe=Ge.dist(ve);oe+Oe>32768&&(oe=0),gu(this.layoutVertexArray,ve.x,ve.y,Ae.x,Ae.y,0,0,oe),gu(this.layoutVertexArray,ve.x,ve.y,Ae.x,Ae.y,0,1,oe),T.x+=2*ve.x,T.y+=2*ve.y,T.vertexCount+=2,oe+=Oe,gu(this.layoutVertexArray,Ge.x,Ge.y,Ae.x,Ae.y,0,0,oe),gu(this.layoutVertexArray,Ge.x,Ge.y,Ae.x,Ae.y,0,1,oe),T.x+=2*Ge.x,T.y+=2*Ge.y,T.vertexCount+=2;const Je=A.vertexLength;this.indexArray.emplaceBack(Je,Je+2,Je+1),this.indexArray.emplaceBack(Je+1,Je+2,Je+3),A.vertexLength+=4,A.primitiveLength+=2}}}}if(A.vertexLength+C>Ii.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray)),Mb[r.type]!=="Polygon")continue;const z=[],B=[],U=A.vertexLength;for(const ie of x)if(ie.length!==0){ie!==x[0]&&B.push(z.length/2);for(let oe=0;oe<ie.length;oe++){const _e=ie[oe];gu(this.layoutVertexArray,_e.x,_e.y,0,0,1,1,0),T.x+=_e.x,T.y+=_e.y,T.vertexCount+=1,z.push(_e.x),z.push(_e.y)}}const W=bm(z,B);for(let ie=0;ie<W.length;ie+=3)this.indexArray.emplaceBack(U+W[ie],U+W[ie+2],U+W[ie+1]);A.primitiveLength+=W.length/3,A.vertexLength+=C;for(let ie=0;ie<T.vertexCount;ie++){const oe=Math.floor(T.x/T.vertexCount),_e=Math.floor(T.y/T.vertexCount);this.centroidVertexArray.emplaceBack(oe,_e)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,w,_)}}function Ab(s,r){return s.x===r.x&&(s.x<0||s.x>An)||s.y===r.y&&(s.y<0||s.y>An)}function Pb(s){return s.every(r=>r.x<0)||s.every(r=>r.x>An)||s.every(r=>r.y<0)||s.every(r=>r.y>An)}let Lm;zt("FillExtrusionBucket",Lf,{omit:["layers","features"]});var zb={get paint(){return Lm=Lm||new v({"fill-extrusion-opacity":new Ot(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Yt(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ot(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ot(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ll(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Yt(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Yt(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ot(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Db extends h{constructor(r){super(r,zb)}createBucket(r){return new Lf(r)}queryRadius(){return qh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(r,c,f,_,w,x,T,C){const A=Zh(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,T),z=this.paint.get("fill-extrusion-height").evaluate(c,f),B=this.paint.get("fill-extrusion-base").evaluate(c,f),U=function(ie,oe,_e,ve){const Ge=[];for(const Ae of ie){const Oe=[Ae.x,Ae.y,0,1];Gh(Oe,Oe,oe),Ge.push(new S(Oe[0]/Oe[3],Oe[1]/Oe[3]))}return Ge}(A,C),W=function(ie,oe,_e,ve){const Ge=[],Ae=[],Oe=ve[8]*oe,Je=ve[9]*oe,gt=ve[10]*oe,Mt=ve[11]*oe,Kt=ve[8]*_e,Ct=ve[9]*_e,Tt=ve[10]*_e,$t=ve[11]*_e;for(const Rt of ie){const Pt=[],tt=[];for(const Zt of Rt){const Ut=Zt.x,ii=Zt.y,Hi=ve[0]*Ut+ve[4]*ii+ve[12],Gi=ve[1]*Ut+ve[5]*ii+ve[13],jn=ve[2]*Ut+ve[6]*ii+ve[14],xo=ve[3]*Ut+ve[7]*ii+ve[15],rr=jn+gt,Un=xo+Mt,kr=Hi+Kt,Sr=Gi+Ct,Tr=jn+Tt,Sn=xo+$t,$n=new S((Hi+Oe)/Un,(Gi+Je)/Un);$n.z=rr/Un,Pt.push($n);const fr=new S(kr/Sn,Sr/Sn);fr.z=Tr/Sn,tt.push(fr)}Ge.push(Pt),Ae.push(tt)}return[Ge,Ae]}(_,B,z,C);return function(ie,oe,_e){let ve=1/0;am(_e,oe)&&(ve=Mm(_e,oe[0]));for(let Ge=0;Ge<oe.length;Ge++){const Ae=oe[Ge],Oe=ie[Ge];for(let Je=0;Je<Ae.length-1;Je++){const gt=Ae[Je],Mt=[gt,Ae[Je+1],Oe[Je+1],Oe[Je],gt];sm(_e,Mt)&&(ve=Math.min(ve,Mm(_e,Mt)))}}return ve!==1/0&&ve}(W[0],W[1],U)}}function yu(s,r){return s.x*r.x+s.y*r.y}function Mm(s,r){if(s.length===1){let c=0;const f=r[c++];let _;for(;!_||f.equals(_);)if(_=r[c++],!_)return 1/0;for(;c<r.length;c++){const w=r[c],x=s[0],T=_.sub(f),C=w.sub(f),A=x.sub(f),z=yu(T,T),B=yu(T,C),U=yu(C,C),W=yu(A,T),ie=yu(A,C),oe=z*U-B*B,_e=(U*W-B*ie)/oe,ve=(z*ie-B*W)/oe,Ge=f.z*(1-_e-ve)+_.z*_e+w.z*ve;if(isFinite(Ge))return Ge}return 1/0}{let c=1/0;for(const f of r)c=Math.min(c,f.z);return c}}const Rb=I([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Fb}=Rb,Bb=I([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ob}=Bb,Nb=Ys.VectorTileFeature.types,jb=Math.cos(Math.PI/180*37.5),Am=Math.pow(2,14)/.5;class Mf{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new Al,this.layoutVertexArray2=new Ws,this.indexArray=new ao,this.programConfigurations=new ja(r.layers,r.zoom),this.segments=new Ii,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(r,c,f){this.hasPattern=Tf("line",this.layers,c);const _=this.layers[0].layout.get("line-sort-key"),w=!_.isConstant(),x=[];for(const{feature:T,id:C,index:A,sourceLayerIndex:z}of r){const B=this.layers[0]._featureFilter.needGeometry,U=$a(T,B);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom),U,f))continue;const W=w?_.evaluate(U,{},f):void 0,ie={id:C,properties:T.properties,type:T.type,sourceLayerIndex:z,index:A,geometry:B?U.geometry:Ua(T),patterns:{},sortKey:W};x.push(ie)}w&&x.sort((T,C)=>T.sortKey-C.sortKey);for(const T of x){const{geometry:C,index:A,sourceLayerIndex:z}=T;if(this.hasPattern){const B=If("line",this.layers,T,this.zoom,c);this.patternFeatures.push(B)}else this.addFeature(T,C,A,f,{});c.featureIndex.insert(r[A].feature,C,A,z,this.index)}}update(r,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,f)}addFeatures(r,c,f){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,Ob)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Fb),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,c,f,_,w){const x=this.layers[0].layout,T=x.get("line-join").evaluate(r,{}),C=x.get("line-cap"),A=x.get("line-miter-limit"),z=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const B of c)this.addLine(B,r,T,C,A,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,f,w,_)}addLine(r,c,f,_,w,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ve=0;ve<r.length-1;ve++)this.totalDistance+=r[ve].dist(r[ve+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=Nb[c.type]==="Polygon";let C=r.length;for(;C>=2&&r[C-1].equals(r[C-2]);)C--;let A=0;for(;A<C-1&&r[A].equals(r[A+1]);)A++;if(C<(T?3:2))return;f==="bevel"&&(w=1.05);const z=this.overscaling<=16?15*An/(512*this.overscaling):0,B=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let U,W,ie,oe,_e;this.e1=this.e2=-1,T&&(U=r[C-2],_e=r[A].sub(U)._unit()._perp());for(let ve=A;ve<C;ve++){if(ie=ve===C-1?T?r[A+1]:void 0:r[ve+1],ie&&r[ve].equals(ie))continue;_e&&(oe=_e),U&&(W=U),U=r[ve],_e=ie?ie.sub(U)._unit()._perp():oe,oe=oe||_e;let Ge=oe.add(_e);Ge.x===0&&Ge.y===0||Ge._unit();const Ae=oe.x*_e.x+oe.y*_e.y,Oe=Ge.x*_e.x+Ge.y*_e.y,Je=Oe!==0?1/Oe:1/0,gt=2*Math.sqrt(2-2*Oe),Mt=Oe<jb&&W&&ie,Kt=oe.x*_e.y-oe.y*_e.x>0;if(Mt&&ve>A){const $t=U.dist(W);if($t>2*z){const Rt=U.sub(U.sub(W)._mult(z/$t)._round());this.updateDistance(W,Rt),this.addCurrentVertex(Rt,oe,0,0,B),W=Rt}}const Ct=W&&ie;let Tt=Ct?f:T?"butt":_;if(Ct&&Tt==="round"&&(Je<x?Tt="miter":Je<=2&&(Tt="fakeround")),Tt==="miter"&&Je>w&&(Tt="bevel"),Tt==="bevel"&&(Je>2&&(Tt="flipbevel"),Je<w&&(Tt="miter")),W&&this.updateDistance(W,U),Tt==="miter")Ge._mult(Je),this.addCurrentVertex(U,Ge,0,0,B);else if(Tt==="flipbevel"){if(Je>100)Ge=_e.mult(-1);else{const $t=Je*oe.add(_e).mag()/oe.sub(_e).mag();Ge._perp()._mult($t*(Kt?-1:1))}this.addCurrentVertex(U,Ge,0,0,B),this.addCurrentVertex(U,Ge.mult(-1),0,0,B)}else if(Tt==="bevel"||Tt==="fakeround"){const $t=-Math.sqrt(Je*Je-1),Rt=Kt?$t:0,Pt=Kt?0:$t;if(W&&this.addCurrentVertex(U,oe,Rt,Pt,B),Tt==="fakeround"){const tt=Math.round(180*gt/Math.PI/20);for(let Zt=1;Zt<tt;Zt++){let Ut=Zt/tt;if(Ut!==.5){const Hi=Ut-.5;Ut+=Ut*Hi*(Ut-1)*((1.0904+Ae*(Ae*(3.55645-1.43519*Ae)-3.2452))*Hi*Hi+(.848013+Ae*(.215638*Ae-1.06021)))}const ii=_e.sub(oe)._mult(Ut)._add(oe)._unit()._mult(Kt?-1:1);this.addHalfVertex(U,ii.x,ii.y,!1,Kt,0,B)}}ie&&this.addCurrentVertex(U,_e,-Rt,-Pt,B)}else if(Tt==="butt")this.addCurrentVertex(U,Ge,0,0,B);else if(Tt==="square"){const $t=W?1:-1;this.addCurrentVertex(U,Ge,$t,$t,B)}else Tt==="round"&&(W&&(this.addCurrentVertex(U,oe,0,0,B),this.addCurrentVertex(U,oe,1,1,B,!0)),ie&&(this.addCurrentVertex(U,_e,-1,-1,B,!0),this.addCurrentVertex(U,_e,0,0,B)));if(Mt&&ve<C-1){const $t=U.dist(ie);if($t>2*z){const Rt=U.add(ie.sub(U)._mult(z/$t)._round());this.updateDistance(U,Rt),this.addCurrentVertex(Rt,_e,0,0,B),U=Rt}}}}addCurrentVertex(r,c,f,_,w,x=!1){const T=c.y*_-c.x,C=-c.y-c.x*_;this.addHalfVertex(r,c.x+c.y*f,c.y-c.x*f,x,!1,f,w),this.addHalfVertex(r,T,C,x,!0,-_,w),this.distance>Am/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(r,c,f,_,w,x))}addHalfVertex({x:r,y:c},f,_,w,x,T,C){const A=.5*(this.lineClips?this.scaledDistance*(Am-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(w?1:0),(c<<1)+(x?1:0),Math.round(63*f)+128,Math.round(63*_)+128,1+(T===0?0:T<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const z=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),C.primitiveLength++),x?this.e2=z:this.e1=z}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,c){this.distance+=r.dist(c),this.updateScaledDistance()}}let Pm,zm;zt("LineBucket",Mf,{omit:["layers","patternFeatures"]});var Dm={get paint(){return zm=zm||new v({"line-opacity":new Yt(Te.paint_line["line-opacity"]),"line-color":new Yt(Te.paint_line["line-color"]),"line-translate":new Ot(Te.paint_line["line-translate"]),"line-translate-anchor":new Ot(Te.paint_line["line-translate-anchor"]),"line-width":new Yt(Te.paint_line["line-width"]),"line-gap-width":new Yt(Te.paint_line["line-gap-width"]),"line-offset":new Yt(Te.paint_line["line-offset"]),"line-blur":new Yt(Te.paint_line["line-blur"]),"line-dasharray":new Ml(Te.paint_line["line-dasharray"]),"line-pattern":new Ll(Te.paint_line["line-pattern"]),"line-gradient":new lu(Te.paint_line["line-gradient"])})},get layout(){return Pm=Pm||new v({"line-cap":new Ot(Te.layout_line["line-cap"]),"line-join":new Yt(Te.layout_line["line-join"]),"line-miter-limit":new Ot(Te.layout_line["line-miter-limit"]),"line-round-limit":new Ot(Te.layout_line["line-round-limit"]),"line-sort-key":new Yt(Te.layout_line["line-sort-key"])})}};class Ub extends Yt{possiblyEvaluate(r,c){return c=new Yi(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),super.possiblyEvaluate(r,c)}evaluate(r,c,f,_){return c=te({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(r,c,f,_)}}let Kh;class $b extends h{constructor(r){super(r,Dm),this.gradientVersion=0,Kh||(Kh=new Ub(Dm.paint.properties["line-width"].specification),Kh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const c=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(c)&&c._styleExpression.expression instanceof Cs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,c){super.recalculate(r,c),this.paint._values["line-floorwidth"]=Kh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Mf(r)}queryRadius(r){const c=r,f=Rm(hu("line-width",this,c),hu("line-gap-width",this,c)),_=hu("line-offset",this,c);return f/2+Math.abs(_)+qh(this.paint.get("line-translate"))}queryIntersectsFeature(r,c,f,_,w,x,T){const C=Zh(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,T),A=T/2*Rm(this.paint.get("line-width").evaluate(c,f),this.paint.get("line-gap-width").evaluate(c,f)),z=this.paint.get("line-offset").evaluate(c,f);return z&&(_=function(B,U){const W=[];for(let ie=0;ie<B.length;ie++){const oe=B[ie],_e=[];for(let ve=0;ve<oe.length;ve++){const Ge=oe[ve-1],Ae=oe[ve],Oe=oe[ve+1],Je=ve===0?new S(0,0):Ae.sub(Ge)._unit()._perp(),gt=ve===oe.length-1?new S(0,0):Oe.sub(Ae)._unit()._perp(),Mt=Je._add(gt)._unit(),Kt=Mt.x*gt.x+Mt.y*gt.y;Kt!==0&&Mt._mult(1/Kt),_e.push(Mt._mult(U)._add(Ae))}W.push(_e)}return W}(_,z*T)),function(B,U,W){for(let ie=0;ie<U.length;ie++){const oe=U[ie];if(B.length>=3){for(let _e=0;_e<oe.length;_e++)if(Bl(B,oe[_e]))return!0}if(J1(B,oe,W))return!0}return!1}(C,_,A)}isTileClipped(){return!0}}function Rm(s,r){return r>0?r+2*s:s}const Vb=I([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),qb=I([{name:"a_projected_pos",components:3,type:"Float32"}],4);I([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Zb=I([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);I([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Fm=I([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Gb=I([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Wb(s,r,c){return s.sections.forEach(f=>{f.text=function(_,w,x){const T=w.layout.get("text-transform").evaluate(x,{});return T==="uppercase"?_=_.toLocaleUpperCase():T==="lowercase"&&(_=_.toLocaleLowerCase()),Or.applyArabicShaping&&(_=Or.applyArabicShaping(_)),_}(f.text,r,c)}),s}I([{name:"triangle",components:3,type:"Uint16"}]),I([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),I([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),I([{type:"Float32",name:"offsetX"}]),I([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),I([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const bu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Rn=24,Bm=Zi,Om=function(s,r,c,f,_){var w,x,T=8*_-f-1,C=(1<<T)-1,A=C>>1,z=-7,B=c?_-1:0,U=c?-1:1,W=s[r+B];for(B+=U,w=W&(1<<-z)-1,W>>=-z,z+=T;z>0;w=256*w+s[r+B],B+=U,z-=8);for(x=w&(1<<-z)-1,w>>=-z,z+=f;z>0;x=256*x+s[r+B],B+=U,z-=8);if(w===0)w=1-A;else{if(w===C)return x?NaN:1/0*(W?-1:1);x+=Math.pow(2,f),w-=A}return(W?-1:1)*x*Math.pow(2,w-f)},Nm=function(s,r,c,f,_,w){var x,T,C,A=8*w-_-1,z=(1<<A)-1,B=z>>1,U=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,W=f?0:w-1,ie=f?1:-1,oe=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(T=isNaN(r)?1:0,x=z):(x=Math.floor(Math.log(r)/Math.LN2),r*(C=Math.pow(2,-x))<1&&(x--,C*=2),(r+=x+B>=1?U/C:U*Math.pow(2,1-B))*C>=2&&(x++,C/=2),x+B>=z?(T=0,x=z):x+B>=1?(T=(r*C-1)*Math.pow(2,_),x+=B):(T=r*Math.pow(2,B-1)*Math.pow(2,_),x=0));_>=8;s[c+W]=255&T,W+=ie,T/=256,_-=8);for(x=x<<_|T,A+=_;A>0;s[c+W]=255&x,W+=ie,x/=256,A-=8);s[c+W-ie]|=128*oe};function Zi(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Zi.Varint=0,Zi.Fixed64=1,Zi.Bytes=2,Zi.Fixed32=5;var Af=4294967296,jm=1/Af,Um=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function cs(s){return s.type===Zi.Bytes?s.readVarint()+s.pos:s.pos+1}function Ul(s,r,c){return c?4294967296*r+(s>>>0):4294967296*(r>>>0)+(s>>>0)}function $m(s,r,c){var f=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));c.realloc(f);for(var _=c.pos-1;_>=s;_--)c.buf[_+f]=c.buf[_]}function Hb(s,r){for(var c=0;c<s.length;c++)r.writeVarint(s[c])}function Xb(s,r){for(var c=0;c<s.length;c++)r.writeSVarint(s[c])}function Kb(s,r){for(var c=0;c<s.length;c++)r.writeFloat(s[c])}function Jb(s,r){for(var c=0;c<s.length;c++)r.writeDouble(s[c])}function Yb(s,r){for(var c=0;c<s.length;c++)r.writeBoolean(s[c])}function Qb(s,r){for(var c=0;c<s.length;c++)r.writeFixed32(s[c])}function ev(s,r){for(var c=0;c<s.length;c++)r.writeSFixed32(s[c])}function tv(s,r){for(var c=0;c<s.length;c++)r.writeFixed64(s[c])}function iv(s,r){for(var c=0;c<s.length;c++)r.writeSFixed64(s[c])}function Jh(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+16777216*s[r+3]}function $l(s,r,c){s[c]=r,s[c+1]=r>>>8,s[c+2]=r>>>16,s[c+3]=r>>>24}function Vm(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+(s[r+3]<<24)}Zi.prototype={destroy:function(){this.buf=null},readFields:function(s,r,c){for(c=c||this.length;this.pos<c;){var f=this.readVarint(),_=f>>3,w=this.pos;this.type=7&f,s(_,r,this),this.pos===w&&this.skip(f)}return r},readMessage:function(s,r){return this.readFields(s,r,this.readVarint()+this.pos)},readFixed32:function(){var s=Jh(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Vm(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=Jh(this.buf,this.pos)+Jh(this.buf,this.pos+4)*Af;return this.pos+=8,s},readSFixed64:function(){var s=Jh(this.buf,this.pos)+Vm(this.buf,this.pos+4)*Af;return this.pos+=8,s},readFloat:function(){var s=Om(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=Om(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var r,c,f=this.buf;return r=127&(c=f[this.pos++]),c<128?r:(r|=(127&(c=f[this.pos++]))<<7,c<128?r:(r|=(127&(c=f[this.pos++]))<<14,c<128?r:(r|=(127&(c=f[this.pos++]))<<21,c<128?r:function(_,w,x){var T,C,A=x.buf;if(T=(112&(C=A[x.pos++]))>>4,C<128||(T|=(127&(C=A[x.pos++]))<<3,C<128)||(T|=(127&(C=A[x.pos++]))<<10,C<128)||(T|=(127&(C=A[x.pos++]))<<17,C<128)||(T|=(127&(C=A[x.pos++]))<<24,C<128)||(T|=(1&(C=A[x.pos++]))<<31,C<128))return Ul(_,T,w);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(c=f[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,r=this.pos;return this.pos=s,s-r>=12&&Um?function(c,f,_){return Um.decode(c.subarray(f,_))}(this.buf,r,s):function(c,f,_){for(var w="",x=f;x<_;){var T,C,A,z=c[x],B=null,U=z>239?4:z>223?3:z>191?2:1;if(x+U>_)break;U===1?z<128&&(B=z):U===2?(192&(T=c[x+1]))==128&&(B=(31&z)<<6|63&T)<=127&&(B=null):U===3?(C=c[x+2],(192&(T=c[x+1]))==128&&(192&C)==128&&((B=(15&z)<<12|(63&T)<<6|63&C)<=2047||B>=55296&&B<=57343)&&(B=null)):U===4&&(C=c[x+2],A=c[x+3],(192&(T=c[x+1]))==128&&(192&C)==128&&(192&A)==128&&((B=(15&z)<<18|(63&T)<<12|(63&C)<<6|63&A)<=65535||B>=1114112)&&(B=null)),B===null?(B=65533,U=1):B>65535&&(B-=65536,w+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),w+=String.fromCharCode(B),x+=U}return w}(this.buf,r,s)},readBytes:function(){var s=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,s);return this.pos=s,r},readPackedVarint:function(s,r){if(this.type!==Zi.Bytes)return s.push(this.readVarint(r));var c=cs(this);for(s=s||[];this.pos<c;)s.push(this.readVarint(r));return s},readPackedSVarint:function(s){if(this.type!==Zi.Bytes)return s.push(this.readSVarint());var r=cs(this);for(s=s||[];this.pos<r;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Zi.Bytes)return s.push(this.readBoolean());var r=cs(this);for(s=s||[];this.pos<r;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Zi.Bytes)return s.push(this.readFloat());var r=cs(this);for(s=s||[];this.pos<r;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Zi.Bytes)return s.push(this.readDouble());var r=cs(this);for(s=s||[];this.pos<r;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Zi.Bytes)return s.push(this.readFixed32());var r=cs(this);for(s=s||[];this.pos<r;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Zi.Bytes)return s.push(this.readSFixed32());var r=cs(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Zi.Bytes)return s.push(this.readFixed64());var r=cs(this);for(s=s||[];this.pos<r;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Zi.Bytes)return s.push(this.readSFixed64());var r=cs(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed64());return s},skip:function(s){var r=7&s;if(r===Zi.Varint)for(;this.buf[this.pos++]>127;);else if(r===Zi.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Zi.Fixed32)this.pos+=4;else{if(r!==Zi.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(s,r){this.writeVarint(s<<3|r)},realloc:function(s){for(var r=this.length||16;r<this.pos+s;)r*=2;if(r!==this.length){var c=new Uint8Array(r);c.set(this.buf),this.buf=c,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),$l(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),$l(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),$l(this.buf,-1&s,this.pos),$l(this.buf,Math.floor(s*jm),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),$l(this.buf,-1&s,this.pos),$l(this.buf,Math.floor(s*jm),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(r,c){var f,_;if(r>=0?(f=r%4294967296|0,_=r/4294967296|0):(_=~(-r/4294967296),4294967295^(f=~(-r%4294967296))?f=f+1|0:(f=0,_=_+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(w,x,T){T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,T.buf[T.pos]=127&(w>>>=7)}(f,0,c),function(w,x){var T=(7&w)<<4;x.buf[x.pos++]|=T|((w>>>=3)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w)))))}(_,c)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var r=this.pos;this.pos=function(f,_,w){for(var x,T,C=0;C<_.length;C++){if((x=_.charCodeAt(C))>55295&&x<57344){if(!T){x>56319||C+1===_.length?(f[w++]=239,f[w++]=191,f[w++]=189):T=x;continue}if(x<56320){f[w++]=239,f[w++]=191,f[w++]=189,T=x;continue}x=T-55296<<10|x-56320|65536,T=null}else T&&(f[w++]=239,f[w++]=191,f[w++]=189,T=null);x<128?f[w++]=x:(x<2048?f[w++]=x>>6|192:(x<65536?f[w++]=x>>12|224:(f[w++]=x>>18|240,f[w++]=x>>12&63|128),f[w++]=x>>6&63|128),f[w++]=63&x|128)}return w}(this.buf,s,this.pos);var c=this.pos-r;c>=128&&$m(r,c,this),this.pos=r-1,this.writeVarint(c),this.pos+=c},writeFloat:function(s){this.realloc(4),Nm(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Nm(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var r=s.length;this.writeVarint(r),this.realloc(r);for(var c=0;c<r;c++)this.buf[this.pos++]=s[c]},writeRawMessage:function(s,r){this.pos++;var c=this.pos;s(r,this);var f=this.pos-c;f>=128&&$m(c,f,this),this.pos=c-1,this.writeVarint(f),this.pos+=f},writeMessage:function(s,r,c){this.writeTag(s,Zi.Bytes),this.writeRawMessage(r,c)},writePackedVarint:function(s,r){r.length&&this.writeMessage(s,Hb,r)},writePackedSVarint:function(s,r){r.length&&this.writeMessage(s,Xb,r)},writePackedBoolean:function(s,r){r.length&&this.writeMessage(s,Yb,r)},writePackedFloat:function(s,r){r.length&&this.writeMessage(s,Kb,r)},writePackedDouble:function(s,r){r.length&&this.writeMessage(s,Jb,r)},writePackedFixed32:function(s,r){r.length&&this.writeMessage(s,Qb,r)},writePackedSFixed32:function(s,r){r.length&&this.writeMessage(s,ev,r)},writePackedFixed64:function(s,r){r.length&&this.writeMessage(s,tv,r)},writePackedSFixed64:function(s,r){r.length&&this.writeMessage(s,iv,r)},writeBytesField:function(s,r){this.writeTag(s,Zi.Bytes),this.writeBytes(r)},writeFixed32Field:function(s,r){this.writeTag(s,Zi.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(s,r){this.writeTag(s,Zi.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(s,r){this.writeTag(s,Zi.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(s,r){this.writeTag(s,Zi.Fixed64),this.writeSFixed64(r)},writeVarintField:function(s,r){this.writeTag(s,Zi.Varint),this.writeVarint(r)},writeSVarintField:function(s,r){this.writeTag(s,Zi.Varint),this.writeSVarint(r)},writeStringField:function(s,r){this.writeTag(s,Zi.Bytes),this.writeString(r)},writeFloatField:function(s,r){this.writeTag(s,Zi.Fixed32),this.writeFloat(r)},writeDoubleField:function(s,r){this.writeTag(s,Zi.Fixed64),this.writeDouble(r)},writeBooleanField:function(s,r){this.writeVarintField(s,!!r)}};var Pf=g(Bm);const zf=3;function nv(s,r,c){s===1&&c.readMessage(rv,r)}function rv(s,r,c){if(s===3){const{id:f,bitmap:_,width:w,height:x,left:T,top:C,advance:A}=c.readMessage(ov,{});r.push({id:f,bitmap:new fu({width:w+2*zf,height:x+2*zf},_),metrics:{width:w,height:x,left:T,top:C,advance:A}})}}function ov(s,r,c){s===1?r.id=c.readVarint():s===2?r.bitmap=c.readBytes():s===3?r.width=c.readVarint():s===4?r.height=c.readVarint():s===5?r.left=c.readSVarint():s===6?r.top=c.readSVarint():s===7&&(r.advance=c.readVarint())}const qm=zf;function Zm(s){let r=0,c=0;for(const x of s)r+=x.w*x.h,c=Math.max(c,x.w);s.sort((x,T)=>T.h-x.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),c),h:1/0}];let _=0,w=0;for(const x of s)for(let T=f.length-1;T>=0;T--){const C=f[T];if(!(x.w>C.w||x.h>C.h)){if(x.x=C.x,x.y=C.y,w=Math.max(w,x.y+x.h),_=Math.max(_,x.x+x.w),x.w===C.w&&x.h===C.h){const A=f.pop();T<f.length&&(f[T]=A)}else x.h===C.h?(C.x+=x.w,C.w-=x.w):x.w===C.w?(C.y+=x.h,C.h-=x.h):(f.push({x:C.x+x.w,y:C.y,w:C.w-x.w,h:x.h}),C.y+=x.h,C.h-=x.h);break}}return{w:_,h:w,fill:r/(_*w)||0}}const jr=1;class Df{constructor(r,{pixelRatio:c,version:f,stretchX:_,stretchY:w,content:x,textFitWidth:T,textFitHeight:C}){this.paddedRect=r,this.pixelRatio=c,this.stretchX=_,this.stretchY=w,this.content=x,this.version=f,this.textFitWidth=T,this.textFitHeight=C}get tl(){return[this.paddedRect.x+jr,this.paddedRect.y+jr]}get br(){return[this.paddedRect.x+this.paddedRect.w-jr,this.paddedRect.y+this.paddedRect.h-jr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*jr)/this.pixelRatio,(this.paddedRect.h-2*jr)/this.pixelRatio]}}class Gm{constructor(r,c){const f={},_={};this.haveRenderCallbacks=[];const w=[];this.addImages(r,f,w),this.addImages(c,_,w);const{w:x,h:T}=Zm(w),C=new lo({width:x||1,height:T||1});for(const A in r){const z=r[A],B=f[A].paddedRect;lo.copy(z.data,C,{x:0,y:0},{x:B.x+jr,y:B.y+jr},z.data)}for(const A in c){const z=c[A],B=_[A].paddedRect,U=B.x+jr,W=B.y+jr,ie=z.data.width,oe=z.data.height;lo.copy(z.data,C,{x:0,y:0},{x:U,y:W},z.data),lo.copy(z.data,C,{x:0,y:oe-1},{x:U,y:W-1},{width:ie,height:1}),lo.copy(z.data,C,{x:0,y:0},{x:U,y:W+oe},{width:ie,height:1}),lo.copy(z.data,C,{x:ie-1,y:0},{x:U-1,y:W},{width:1,height:oe}),lo.copy(z.data,C,{x:0,y:0},{x:U+ie,y:W},{width:1,height:oe})}this.image=C,this.iconPositions=f,this.patternPositions=_}addImages(r,c,f){for(const _ in r){const w=r[_],x={x:0,y:0,w:w.data.width+2*jr,h:w.data.height+2*jr};f.push(x),c[_]=new Df(x,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(r,c){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in r.updatedImages)this.patchUpdatedImage(this.iconPositions[f],r.getImage(f),c),this.patchUpdatedImage(this.patternPositions[f],r.getImage(f),c)}patchUpdatedImage(r,c,f){if(!r||!c||r.version===c.version)return;r.version=c.version;const[_,w]=r.tl;f.update(c.data,void 0,{x:_,y:w})}}var Qs;zt("ImagePosition",Df),zt("ImageAtlas",Gm),d.ah=void 0,(Qs=d.ah||(d.ah={}))[Qs.none=0]="none",Qs[Qs.horizontal=1]="horizontal",Qs[Qs.vertical=2]="vertical",Qs[Qs.horizontalOnly=3]="horizontalOnly";const vu=-17;class wu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,c){const f=new wu;return f.scale=r||1,f.fontStack=c,f}static forImage(r){const c=new wu;return c.imageName=r,c}}class Vl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,c){const f=new Vl;for(let _=0;_<r.sections.length;_++){const w=r.sections[_];w.image?f.addImageSection(w):f.addTextSection(w,c)}return f}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=function(r){let c="";for(let f=0;f<r.length;f++){const _=r.charCodeAt(f+1)||null,w=r.charCodeAt(f-1)||null;c+=_&&Bh(_)&&!bu[r[f+1]]||w&&Bh(w)&&!bu[r[f-1]]||!bu[r[f]]?r[f]:bu[r[f]]}return c}(this.text)}trim(){let r=0;for(let f=0;f<this.text.length&&Qh[this.text.charCodeAt(f)];f++)r++;let c=this.text.length;for(let f=this.text.length-1;f>=0&&f>=r&&Qh[this.text.charCodeAt(f)];f--)c--;this.text=this.text.substring(r,c),this.sectionIndex=this.sectionIndex.slice(r,c)}substring(r,c){const f=new Vl;return f.text=this.text.substring(r,c),f.sectionIndex=this.sectionIndex.slice(r,c),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,c)=>Math.max(r,this.sections[c].scale),0)}addTextSection(r,c){this.text+=r.text,this.sections.push(wu.forText(r.scale,r.fontStack||c));const f=this.sections.length-1;for(let _=0;_<r.text.length;++_)this.sectionIndex.push(f)}addImageSection(r){const c=r.image?r.image.name:"";if(c.length===0)return void We("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(wu.forImage(c)),this.sectionIndex.push(this.sections.length-1)):We("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Yh(s,r,c,f,_,w,x,T,C,A,z,B,U,W,ie){const oe=Vl.fromFeature(s,_);let _e;B===d.ah.vertical&&oe.verticalizePunctuation();const{processBidirectionalText:ve,processStyledBidirectionalText:Ge}=Or;if(ve&&oe.sections.length===1){_e=[];const Je=ve(oe.toString(),Rf(oe,A,w,r,f,W));for(const gt of Je){const Mt=new Vl;Mt.text=gt,Mt.sections=oe.sections;for(let Kt=0;Kt<gt.length;Kt++)Mt.sectionIndex.push(0);_e.push(Mt)}}else if(Ge){_e=[];const Je=Ge(oe.text,oe.sectionIndex,Rf(oe,A,w,r,f,W));for(const gt of Je){const Mt=new Vl;Mt.text=gt[0],Mt.sectionIndex=gt[1],Mt.sections=oe.sections,_e.push(Mt)}}else _e=function(Je,gt){const Mt=[],Kt=Je.text;let Ct=0;for(const Tt of gt)Mt.push(Je.substring(Ct,Tt)),Ct=Tt;return Ct<Kt.length&&Mt.push(Je.substring(Ct,Kt.length)),Mt}(oe,Rf(oe,A,w,r,f,W));const Ae=[],Oe={positionedLines:Ae,text:oe.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:B,iconsInText:!1,verticalizable:!1};return function(Je,gt,Mt,Kt,Ct,Tt,$t,Rt,Pt,tt,Zt,Ut){let ii=0,Hi=vu,Gi=0,jn=0;const xo=Rt==="right"?1:Rt==="left"?0:.5;let rr=0;for(const Sn of Ct){Sn.trim();const $n=Sn.getMaxScale(),fr=($n-1)*Rn,or={positionedGlyphs:[],lineOffset:0};Je.positionedLines[rr]=or;const Ir=or.positionedGlyphs;let sr=0;if(!Sn.length()){Hi+=Tt,++rr;continue}for(let Ur=0;Ur<Sn.length();Ur++){const zi=Sn.getSection(Ur),Ki=Sn.getSectionIndex(Ur),nn=Sn.getCharCode(Ur);let Qr=0,dn=null,Wl=null,Go=null,Wo=Rn;const ko=!(Pt===d.ah.horizontal||!Zt&&!su(nn)||Zt&&(Qh[nn]||(Un=nn,/\p{sc=Arab}/u.test(String.fromCodePoint(Un)))));if(zi.imageName){const ho=Kt[zi.imageName];if(!ho)continue;Go=zi.imageName,Je.iconsInText=Je.iconsInText||!0,Wl=ho.paddedRect;const Hn=ho.displaySize;zi.scale=zi.scale*Rn/Ut,dn={width:Hn[0],height:Hn[1],left:jr,top:-qm,advance:ko?Hn[1]:Hn[0]},Qr=fr+(Rn-Hn[1]*zi.scale),Wo=dn.advance;const us=ko?Hn[0]*zi.scale-Rn*$n:Hn[1]*zi.scale-Rn*$n;us>0&&us>sr&&(sr=us)}else{const ho=Mt[zi.fontStack],Hn=ho&&ho[nn];if(Hn&&Hn.rect)Wl=Hn.rect,dn=Hn.metrics;else{const us=gt[zi.fontStack],Cu=us&&us[nn];if(!Cu)continue;dn=Cu.metrics}Qr=($n-zi.scale)*Rn}ko?(Je.verticalizable=!0,Ir.push({glyph:nn,imageName:Go,x:ii,y:Hi+Qr,vertical:ko,scale:zi.scale,fontStack:zi.fontStack,sectionIndex:Ki,metrics:dn,rect:Wl}),ii+=Wo*zi.scale+tt):(Ir.push({glyph:nn,imageName:Go,x:ii,y:Hi+Qr,vertical:ko,scale:zi.scale,fontStack:zi.fontStack,sectionIndex:Ki,metrics:dn,rect:Wl}),ii+=dn.advance*zi.scale+tt)}Ir.length!==0&&(Gi=Math.max(ii-tt,Gi),cv(Ir,0,Ir.length-1,xo,sr)),ii=0;const uo=Tt*$n+sr;or.lineOffset=Math.max(sr,fr),Hi+=uo,jn=Math.max(uo,jn),++rr}var Un;const kr=Hi-vu,{horizontalAlign:Sr,verticalAlign:Tr}=Ff($t);(function(Sn,$n,fr,or,Ir,sr,uo,Ur,zi){const Ki=($n-fr)*Ir;let nn=0;nn=sr!==uo?-Ur*or-vu:(-or*zi+.5)*uo;for(const Qr of Sn)for(const dn of Qr.positionedGlyphs)dn.x+=Ki,dn.y+=nn})(Je.positionedLines,xo,Sr,Tr,Gi,jn,Tt,kr,Ct.length),Je.top+=-Tr*kr,Je.bottom=Je.top+kr,Je.left+=-Sr*Gi,Je.right=Je.left+Gi}(Oe,r,c,f,_e,x,T,C,B,A,U,ie),!function(Je){for(const gt of Je)if(gt.positionedGlyphs.length!==0)return!1;return!0}(Ae)&&Oe}const Qh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},sv={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},av={40:!0};function Wm(s,r,c,f,_,w){if(r.imageName){const x=f[r.imageName];return x?x.displaySize[0]*r.scale*Rn/w+_:0}{const x=c[r.fontStack],T=x&&x[s];return T?T.metrics.advance*r.scale+_:0}}function Hm(s,r,c,f){const _=Math.pow(s-r,2);return f?s<r?_/2:2*_:_+Math.abs(c)*c}function lv(s,r,c){let f=0;return s===10&&(f-=1e4),c&&(f+=150),s!==40&&s!==65288||(f+=50),r!==41&&r!==65289||(f+=50),f}function Xm(s,r,c,f,_,w){let x=null,T=Hm(r,c,_,w);for(const C of f){const A=Hm(r-C.x,c,_,w)+C.badness;A<=T&&(x=C,T=A)}return{index:s,x:r,priorBreak:x,badness:T}}function Km(s){return s?Km(s.priorBreak).concat(s.index):[]}function Rf(s,r,c,f,_,w){if(!s)return[];const x=[],T=function(B,U,W,ie,oe,_e){let ve=0;for(let Ge=0;Ge<B.length();Ge++){const Ae=B.getSection(Ge);ve+=Wm(B.getCharCode(Ge),Ae,ie,oe,U,_e)}return ve/Math.max(1,Math.ceil(ve/W))}(s,r,c,f,_,w),C=s.text.indexOf("​")>=0;let A=0;for(let B=0;B<s.length();B++){const U=s.getSection(B),W=s.getCharCode(B);if(Qh[W]||(A+=Wm(W,U,f,_,r,w)),B<s.length()-1){const ie=!((z=W)<11904)&&(!!Ti["CJK Compatibility Forms"](z)||!!Ti["CJK Compatibility"](z)||!!Ti["CJK Strokes"](z)||!!Ti["CJK Symbols and Punctuation"](z)||!!Ti["Enclosed CJK Letters and Months"](z)||!!Ti["Halfwidth and Fullwidth Forms"](z)||!!Ti["Ideographic Description Characters"](z)||!!Ti["Vertical Forms"](z)||Fh.test(String.fromCodePoint(z)));(sv[W]||ie||U.imageName||B!==s.length()-2&&av[s.getCharCode(B+1)])&&x.push(Xm(B+1,A,T,x,lv(W,s.getCharCode(B+1),ie&&C),!1))}}var z;return Km(Xm(s.length(),A,T,x,0,!0))}function Ff(s){let r=.5,c=.5;switch(s){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:r,verticalAlign:c}}function cv(s,r,c,f,_){if(!f&&!_)return;const w=s[c],x=(s[c].x+w.metrics.advance*w.scale)*f;for(let T=r;T<=c;T++)s[T].x-=x,s[T].y+=_}function uv(s,r,c){const{horizontalAlign:f,verticalAlign:_}=Ff(c),w=r[0]-s.displaySize[0]*f,x=r[1]-s.displaySize[1]*_;return{image:s,top:x,bottom:x+s.displaySize[1],left:w,right:w+s.displaySize[0]}}function Jm(s){var r,c;let f=s.left,_=s.top,w=s.right-f,x=s.bottom-_;const T=(r=s.image.textFitWidth)!==null&&r!==void 0?r:"stretchOrShrink",C=(c=s.image.textFitHeight)!==null&&c!==void 0?c:"stretchOrShrink",A=(s.image.content[2]-s.image.content[0])/(s.image.content[3]-s.image.content[1]);if(C==="proportional"){if(T==="stretchOnly"&&w/x<A||T==="proportional"){const z=Math.ceil(x*A);f*=z/w,w=z}}else if(T==="proportional"&&C==="stretchOnly"&&A!==0&&w/x>A){const z=Math.ceil(w/A);_*=z/x,x=z}return{x1:f,y1:_,x2:f+w,y2:_+x}}function Ym(s,r,c,f,_,w){const x=s.image;let T;if(x.content){const _e=x.content,ve=x.pixelRatio||1;T=[_e[0]/ve,_e[1]/ve,x.displaySize[0]-_e[2]/ve,x.displaySize[1]-_e[3]/ve]}const C=r.left*w,A=r.right*w;let z,B,U,W;c==="width"||c==="both"?(W=_[0]+C-f[3],B=_[0]+A+f[1]):(W=_[0]+(C+A-x.displaySize[0])/2,B=W+x.displaySize[0]);const ie=r.top*w,oe=r.bottom*w;return c==="height"||c==="both"?(z=_[1]+ie-f[0],U=_[1]+oe+f[2]):(z=_[1]+(ie+oe-x.displaySize[1])/2,U=z+x.displaySize[1]),{image:x,top:z,right:B,bottom:U,left:W,collisionPadding:T}}const xu=255,Zo=128,ea=xu*Zo;function Qm(s,r){const{expression:c}=r;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Yi(s+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:_}=c;let w=0;for(;w<f.length&&f[w]<=s;)w++;w=Math.max(0,w-1);let x=w;for(;x<f.length&&f[x]<s+1;)x++;x=Math.min(f.length-1,x);const T=f[w],C=f[x];return c.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:C,interpolationType:_}:{kind:"camera",minZoom:T,maxZoom:C,minSize:c.evaluate(new Yi(T)),maxSize:c.evaluate(new Yi(C)),interpolationType:_}}}function Bf(s,r,c){let f="never";const _=s.get(r);return _?f=_:s.get(c)&&(f="always"),f}const hv=Ys.VectorTileFeature.types,dv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ed(s,r,c,f,_,w,x,T,C,A,z,B,U){const W=T?Math.min(ea,Math.round(T[0])):0,ie=T?Math.min(ea,Math.round(T[1])):0;s.emplaceBack(r,c,Math.round(32*f),Math.round(32*_),w,x,(W<<1)+(C?1:0),ie,16*A,16*z,256*B,256*U)}function Of(s,r,c){s.emplaceBack(r.x,r.y,c),s.emplaceBack(r.x,r.y,c),s.emplaceBack(r.x,r.y,c),s.emplaceBack(r.x,r.y,c)}function fv(s){for(const r of s.sections)if(df(r.text))return!0;return!1}class Nf{constructor(r){this.layoutVertexArray=new Pl,this.indexArray=new ao,this.programConfigurations=r,this.segments=new Ii,this.dynamicLayoutVertexArray=new cu,this.opacityVertexArray=new Jr,this.hasVisibleVertices=!1,this.placedSymbolArray=new Qi}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,c,f,_){this.isEmpty()||(f&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Vb.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,qb.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,dv,!0),this.opacityVertexBuffer.itemSize=1),(f||_)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}zt("SymbolBuffers",Nf);class jf{constructor(r,c,f){this.layoutVertexArray=new r,this.layoutAttributes=c,this.indexArray=new f,this.segments=new Ii,this.collisionVertexArray=new Vo}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,Zb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}zt("CollisionBuffers",jf);class ql{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(x=>x.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=bf([]),this.placementViewportMatrix=bf([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Qm(this.zoom,c["text-size"]),this.iconSizeData=Qm(this.zoom,c["icon-size"]);const f=this.layers[0].layout,_=f.get("symbol-sort-key"),w=f.get("symbol-z-order");this.canOverlap=Bf(f,"text-overlap","text-allow-overlap")!=="never"||Bf(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(x=>d.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=r.sourceID}createArrays(){this.text=new Nf(new ja(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new Nf(new ja(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new en,this.lineVertexArray=new er,this.symbolInstances=new ki,this.textAnchorOffsets=new tn}calculateGlyphDependencies(r,c,f,_,w){for(let x=0;x<r.length;x++)if(c[r.charCodeAt(x)]=!0,(f||_)&&w){const T=bu[r.charAt(x)];T&&(c[T.charCodeAt(0)]=!0)}}populate(r,c,f){const _=this.layers[0],w=_.layout,x=w.get("text-font"),T=w.get("text-field"),C=w.get("icon-image"),A=(T.value.kind!=="constant"||T.value.value instanceof Dr&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),z=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,B=w.get("symbol-sort-key");if(this.features=[],!A&&!z)return;const U=c.iconDependencies,W=c.glyphDependencies,ie=c.availableImages,oe=new Yi(this.zoom);for(const{feature:_e,id:ve,index:Ge,sourceLayerIndex:Ae}of r){const Oe=_._featureFilter.needGeometry,Je=$a(_e,Oe);if(!_._featureFilter.filter(oe,Je,f))continue;let gt,Mt;if(Oe||(Je.geometry=Ua(_e)),A){const Ct=_.getValueAndResolveTokens("text-field",Je,f,ie),Tt=Dr.factory(Ct),$t=this.hasRTLText=this.hasRTLText||fv(Tt);(!$t||Or.getRTLTextPluginStatus()==="unavailable"||$t&&Or.isParsed())&&(gt=Wb(Tt,_,Je))}if(z){const Ct=_.getValueAndResolveTokens("icon-image",Je,f,ie);Mt=Ct instanceof Fr?Ct:Fr.fromString(Ct)}if(!gt&&!Mt)continue;const Kt=this.sortFeaturesByKey?B.evaluate(Je,{},f):void 0;if(this.features.push({id:ve,text:gt,icon:Mt,index:Ge,sourceLayerIndex:Ae,geometry:Je.geometry,properties:_e.properties,type:hv[_e.type],sortKey:Kt}),Mt&&(U[Mt.name]=!0),gt){const Ct=x.evaluate(Je,{},f).join(","),Tt=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(d.ah.vertical)>=0;for(const $t of gt.sections)if($t.image)U[$t.image.name]=!0;else{const Rt=ru(gt.toString()),Pt=$t.fontStack||Ct,tt=W[Pt]=W[Pt]||{};this.calculateGlyphDependencies($t.text,tt,Tt,this.allowVerticalPlacement,Rt)}}}w.get("symbol-placement")==="line"&&(this.features=function(_e){const ve={},Ge={},Ae=[];let Oe=0;function Je(Ct){Ae.push(_e[Ct]),Oe++}function gt(Ct,Tt,$t){const Rt=Ge[Ct];return delete Ge[Ct],Ge[Tt]=Rt,Ae[Rt].geometry[0].pop(),Ae[Rt].geometry[0]=Ae[Rt].geometry[0].concat($t[0]),Rt}function Mt(Ct,Tt,$t){const Rt=ve[Tt];return delete ve[Tt],ve[Ct]=Rt,Ae[Rt].geometry[0].shift(),Ae[Rt].geometry[0]=$t[0].concat(Ae[Rt].geometry[0]),Rt}function Kt(Ct,Tt,$t){const Rt=$t?Tt[0][Tt[0].length-1]:Tt[0][0];return`${Ct}:${Rt.x}:${Rt.y}`}for(let Ct=0;Ct<_e.length;Ct++){const Tt=_e[Ct],$t=Tt.geometry,Rt=Tt.text?Tt.text.toString():null;if(!Rt){Je(Ct);continue}const Pt=Kt(Rt,$t),tt=Kt(Rt,$t,!0);if(Pt in Ge&&tt in ve&&Ge[Pt]!==ve[tt]){const Zt=Mt(Pt,tt,$t),Ut=gt(Pt,tt,Ae[Zt].geometry);delete ve[Pt],delete Ge[tt],Ge[Kt(Rt,Ae[Ut].geometry,!0)]=Ut,Ae[Zt].geometry=null}else Pt in Ge?gt(Pt,tt,$t):tt in ve?Mt(Pt,tt,$t):(Je(Ct),ve[Pt]=Oe-1,Ge[tt]=Oe-1)}return Ae.filter(Ct=>Ct.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((_e,ve)=>_e.sortKey-ve.sortKey)}update(r,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,c,this.layers,f),this.icon.programConfigurations.updatePaintArrays(r,c,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,c){const f=this.lineVertexArray.length;if(r.segment!==void 0){let _=r.dist(c[r.segment+1]),w=r.dist(c[r.segment]);const x={};for(let T=r.segment+1;T<c.length;T++)x[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:_},T<c.length-1&&(_+=c[T+1].dist(c[T]));for(let T=r.segment||0;T>=0;T--)x[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:w},T>0&&(w+=c[T-1].dist(c[T]));for(let T=0;T<c.length;T++){const C=x[T];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(r,c,f,_,w,x,T,C,A,z,B,U){const W=r.indexArray,ie=r.layoutVertexArray,oe=r.segments.prepareSegment(4*c.length,ie,W,this.canOverlap?x.sortKey:void 0),_e=this.glyphOffsetArray.length,ve=oe.vertexLength,Ge=this.allowVerticalPlacement&&T===d.ah.vertical?Math.PI/2:0,Ae=x.text&&x.text.sections;for(let Oe=0;Oe<c.length;Oe++){const{tl:Je,tr:gt,bl:Mt,br:Kt,tex:Ct,pixelOffsetTL:Tt,pixelOffsetBR:$t,minFontScaleX:Rt,minFontScaleY:Pt,glyphOffset:tt,isSDF:Zt,sectionIndex:Ut}=c[Oe],ii=oe.vertexLength,Hi=tt[1];ed(ie,C.x,C.y,Je.x,Hi+Je.y,Ct.x,Ct.y,f,Zt,Tt.x,Tt.y,Rt,Pt),ed(ie,C.x,C.y,gt.x,Hi+gt.y,Ct.x+Ct.w,Ct.y,f,Zt,$t.x,Tt.y,Rt,Pt),ed(ie,C.x,C.y,Mt.x,Hi+Mt.y,Ct.x,Ct.y+Ct.h,f,Zt,Tt.x,$t.y,Rt,Pt),ed(ie,C.x,C.y,Kt.x,Hi+Kt.y,Ct.x+Ct.w,Ct.y+Ct.h,f,Zt,$t.x,$t.y,Rt,Pt),Of(r.dynamicLayoutVertexArray,C,Ge),W.emplaceBack(ii,ii+1,ii+2),W.emplaceBack(ii+1,ii+2,ii+3),oe.vertexLength+=4,oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(tt[0]),Oe!==c.length-1&&Ut===c[Oe+1].sectionIndex||r.programConfigurations.populatePaintArrays(ie.length,x,x.index,{},U,Ae&&Ae[Ut])}r.placedSymbolArray.emplaceBack(C.x,C.y,_e,this.glyphOffsetArray.length-_e,ve,A,z,C.segment,f?f[0]:0,f?f[1]:0,_[0],_[1],T,0,!1,0,B)}_addCollisionDebugVertex(r,c,f,_,w,x){return c.emplaceBack(0,0),r.emplaceBack(f.x,f.y,_,w,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(r,c,f,_,w,x,T){const C=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),A=C.vertexLength,z=w.layoutVertexArray,B=w.collisionVertexArray,U=T.anchorX,W=T.anchorY;this._addCollisionDebugVertex(z,B,x,U,W,new S(r,c)),this._addCollisionDebugVertex(z,B,x,U,W,new S(f,c)),this._addCollisionDebugVertex(z,B,x,U,W,new S(f,_)),this._addCollisionDebugVertex(z,B,x,U,W,new S(r,_)),C.vertexLength+=4;const ie=w.indexArray;ie.emplaceBack(A,A+1),ie.emplaceBack(A+1,A+2),ie.emplaceBack(A+2,A+3),ie.emplaceBack(A+3,A),C.primitiveLength+=4}addDebugCollisionBoxes(r,c,f,_){for(let w=r;w<c;w++){const x=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,_?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new jf(Yr,Fm.members,Wn),this.iconCollisionBox=new jf(Yr,Fm.members,Wn);for(let r=0;r<this.symbolInstances.length;r++){const c=this.symbolInstances.get(r);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(r,c,f,_,w,x,T,C,A){const z={};for(let B=c;B<f;B++){const U=r.get(B);z.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},z.textFeatureIndex=U.featureIndex;break}for(let B=_;B<w;B++){const U=r.get(B);z.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},z.verticalTextFeatureIndex=U.featureIndex;break}for(let B=x;B<T;B++){const U=r.get(B);z.iconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},z.iconFeatureIndex=U.featureIndex;break}for(let B=C;B<A;B++){const U=r.get(B);z.verticalIconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},z.verticalIconFeatureIndex=U.featureIndex;break}return z}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,c){const f=r.placedSymbolArray.get(c),_=f.vertexStartIndex+4*f.numGlyphs;for(let w=f.vertexStartIndex;w<_;w+=4)r.indexArray.emplaceBack(w,w+1,w+2),r.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(r),f=Math.cos(r),_=[],w=[],x=[];for(let T=0;T<this.symbolInstances.length;++T){x.push(T);const C=this.symbolInstances.get(T);_.push(0|Math.round(c*C.anchorX+f*C.anchorY)),w.push(C.featureIndex)}return x.sort((T,C)=>_[T]-_[C]||w[C]-w[T]),x}addToSortKeyRanges(r,c){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===c?f.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const f=this.symbolInstances.get(c);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((_,w,x)=>{_>=0&&x.indexOf(_)===w&&this.addIndicesForPlacedSymbol(this.text,_)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let e_,t_;zt("SymbolBucket",ql,{omit:["layers","collisionBoxArray","features","compareText"]}),ql.MAX_GLYPHS=65535,ql.addDynamicAttributes=Of;var Uf={get paint(){return t_=t_||new v({"icon-opacity":new Yt(Te.paint_symbol["icon-opacity"]),"icon-color":new Yt(Te.paint_symbol["icon-color"]),"icon-halo-color":new Yt(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new Yt(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Yt(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new Ot(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ot(Te.paint_symbol["icon-translate-anchor"]),"text-opacity":new Yt(Te.paint_symbol["text-opacity"]),"text-color":new Yt(Te.paint_symbol["text-color"],{runtimeType:wn,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Yt(Te.paint_symbol["text-halo-color"]),"text-halo-width":new Yt(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new Yt(Te.paint_symbol["text-halo-blur"]),"text-translate":new Ot(Te.paint_symbol["text-translate"]),"text-translate-anchor":new Ot(Te.paint_symbol["text-translate-anchor"])})},get layout(){return e_=e_||new v({"symbol-placement":new Ot(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new Ot(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ot(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Yt(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ot(Te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ot(Te.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ot(Te.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ot(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ot(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ot(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new Yt(Te.layout_symbol["icon-size"]),"icon-text-fit":new Ot(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ot(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new Yt(Te.layout_symbol["icon-image"]),"icon-rotate":new Yt(Te.layout_symbol["icon-rotate"]),"icon-padding":new Yt(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new Ot(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new Yt(Te.layout_symbol["icon-offset"]),"icon-anchor":new Yt(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ot(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ot(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ot(Te.layout_symbol["text-rotation-alignment"]),"text-field":new Yt(Te.layout_symbol["text-field"]),"text-font":new Yt(Te.layout_symbol["text-font"]),"text-size":new Yt(Te.layout_symbol["text-size"]),"text-max-width":new Yt(Te.layout_symbol["text-max-width"]),"text-line-height":new Ot(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new Yt(Te.layout_symbol["text-letter-spacing"]),"text-justify":new Yt(Te.layout_symbol["text-justify"]),"text-radial-offset":new Yt(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ot(Te.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Yt(Te.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Yt(Te.layout_symbol["text-anchor"]),"text-max-angle":new Ot(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new Ot(Te.layout_symbol["text-writing-mode"]),"text-rotate":new Yt(Te.layout_symbol["text-rotate"]),"text-padding":new Ot(Te.layout_symbol["text-padding"]),"text-keep-upright":new Ot(Te.layout_symbol["text-keep-upright"]),"text-transform":new Yt(Te.layout_symbol["text-transform"]),"text-offset":new Yt(Te.layout_symbol["text-offset"]),"text-allow-overlap":new Ot(Te.layout_symbol["text-allow-overlap"]),"text-overlap":new Ot(Te.layout_symbol["text-overlap"]),"text-ignore-placement":new Ot(Te.layout_symbol["text-ignore-placement"]),"text-optional":new Ot(Te.layout_symbol["text-optional"])})}};class i_{constructor(r){if(r.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:qr,this.defaultValue=r}evaluate(r){if(r.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(r.formattedSection))return c.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}zt("FormatSectionOverride",i_,{omit:["defaultValue"]});class td extends h{constructor(r){super(r,Uf)}recalculate(r,c){if(super.recalculate(r,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const _=[];for(const w of f)_.indexOf(w)<0&&_.push(w);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,c,f,_){const w=this.layout.get(r).evaluate(c,{},f,_),x=this._unevaluatedLayout._values[r];return x.isDataDriven()||gl(x.value)||!w?w:function(T,C){return C.replace(/{([^{}]+)}/g,(A,z)=>T&&z in T?String(T[z]):"")}(c.properties,w)}createBucket(r){return new ql(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of Uf.paint.overridableProperties){if(!td.hasPaintOverride(this.layout,r))continue;const c=this.paint.get(r),f=new i_(c),_=new _l(f,c.property.specification);let w=null;w=c.value.kind==="constant"||c.value.kind==="source"?new Fs("source",_):new Bs("composite",_,c.value.zoomStops),this.paint._values[r]=new vo(c.property,w,c.parameters)}}_handleOverridablePaintPropertyUpdate(r,c,f){return!(!this.layout||c.isDataDriven()||f.isDataDriven())&&td.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,c){const f=r.get("text-field"),_=Uf.paint.properties[c];let w=!1;const x=T=>{for(const C of T)if(_.overrides&&_.overrides.hasOverride(C))return void(w=!0)};if(f.value.kind==="constant"&&f.value.value instanceof Dr)x(f.value.value.sections);else if(f.value.kind==="source"){const T=A=>{w||(A instanceof to&&Mn(A.value)===zr?x(A.value.sections):A instanceof al?x(A.sections):A.eachChild(T))},C=f.value;C._styleExpression&&T(C._styleExpression.expression)}return w}}let n_;var pv={get paint(){return n_=n_||new v({"background-color":new Ot(Te.paint_background["background-color"]),"background-pattern":new Ml(Te.paint_background["background-pattern"]),"background-opacity":new Ot(Te.paint_background["background-opacity"])})}};class mv extends h{constructor(r){super(r,pv)}}let r_;var _v={get paint(){return r_=r_||new v({"raster-opacity":new Ot(Te.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ot(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ot(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ot(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new Ot(Te.paint_raster["raster-saturation"]),"raster-contrast":new Ot(Te.paint_raster["raster-contrast"]),"raster-resampling":new Ot(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new Ot(Te.paint_raster["raster-fade-duration"])})}};class gv extends h{constructor(r){super(r,_v)}}class yv extends h{constructor(r){super(r,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class bv{constructor(r){this._methodToThrottle=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const $f=63710088e-1;class ta{constructor(r,c){if(isNaN(r)||isNaN(c))throw new Error(`Invalid LngLat object: (${r}, ${c})`);if(this.lng=+r,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ta(Le(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const c=Math.PI/180,f=this.lat*c,_=r.lat*c,w=Math.sin(f)*Math.sin(_)+Math.cos(f)*Math.cos(_)*Math.cos((r.lng-this.lng)*c);return $f*Math.acos(Math.min(w,1))}static convert(r){if(r instanceof ta)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new ta(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new ta(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const o_=2*Math.PI*$f;function s_(s){return o_*Math.cos(s*Math.PI/180)}function a_(s){return(180+s)/360}function l_(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function c_(s,r){return s/s_(r)}function Vf(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class ku{constructor(r,c,f=0){this.x=+r,this.y=+c,this.z=+f}static fromLngLat(r,c=0){const f=ta.convert(r);return new ku(a_(f.lng),l_(f.lat),c_(c,f.lat))}toLngLat(){return new ta(360*this.x-180,Vf(this.y))}toAltitude(){return this.z*s_(Vf(this.y))}meterInMercatorCoordinateUnits(){return 1/o_*(r=Vf(this.y),1/Math.cos(r*Math.PI/180));var r}}function u_(s,r,c){var f=2*Math.PI*6378137/256/Math.pow(2,c);return[s*f-2*Math.PI*6378137/2,r*f-2*Math.PI*6378137/2]}class qf{constructor(r,c,f){if(!function(_,w,x){return!(_<0||_>25||x<0||x>=Math.pow(2,_)||w<0||w>=Math.pow(2,_))}(r,c,f))throw new Error(`x=${c}, y=${f}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} 0<=z<=25 `);this.z=r,this.x=c,this.y=f,this.key=Su(0,r,r,c,f)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,c,f){const _=(x=this.y,T=this.z,C=u_(256*(w=this.x),256*(x=Math.pow(2,T)-x-1),T),A=u_(256*(w+1),256*(x+1),T),C[0]+","+C[1]+","+A[0]+","+A[1]);var w,x,T,C,A;const z=function(B,U,W){let ie,oe="";for(let _e=B;_e>0;_e--)ie=1<<_e-1,oe+=(U&ie?1:0)+(W&ie?2:0);return oe}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,z).replace(/{bbox-epsg-3857}/g,_)}isChildOf(r){const c=this.z-r.z;return c>0&&r.x===this.x>>c&&r.y===this.y>>c}getTilePoint(r){const c=Math.pow(2,this.z);return new S((r.x*c-this.x)*An,(r.y*c-this.y)*An)}toString(){return`${this.z}/${this.x}/${this.y}`}}class h_{constructor(r,c){this.wrap=r,this.canonical=c,this.key=Su(r,c.z,c.z,c.x,c.y)}}class co{constructor(r,c,f,_,w){if(r<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${f}`);this.overscaledZ=r,this.wrap=c,this.canonical=new qf(f,+_,+w),this.key=Su(c,r,f,_,w)}clone(){return new co(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-r;return r>this.canonical.z?new co(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new co(r,this.wrap,r,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(r,c){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-r;return r>this.canonical.z?Su(this.wrap*+c,r,this.canonical.z,this.canonical.x,this.canonical.y):Su(this.wrap*+c,r,r,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(r){if(r.wrap!==this.wrap)return!1;const c=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>c&&r.canonical.y===this.canonical.y>>c}children(r){if(this.overscaledZ>=r)return[new co(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,f=2*this.canonical.x,_=2*this.canonical.y;return[new co(c,this.wrap,c,f,_),new co(c,this.wrap,c,f+1,_),new co(c,this.wrap,c,f,_+1),new co(c,this.wrap,c,f+1,_+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new co(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new co(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new h_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new ku(r.x-this.wrap,r.y))}}function Su(s,r,c,f,_){(s*=2)<0&&(s=-1*s-1);const w=1<<c;return(w*w*s+w*_+f).toString(36)+c.toString(36)+r.toString(36)}zt("CanonicalTileID",qf),zt("OverscaledTileID",co,{omit:["posMatrix"]});class d_{constructor(r,c,f,_=1,w=1,x=1,T=0){if(this.uid=r,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void We(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=c.height;const C=this.dim=c.height-2;switch(this.data=new Uint32Array(c.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=w,this.blueFactor=x,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let A=0;A<C;A++)this.data[this._idx(-1,A)]=this.data[this._idx(0,A)],this.data[this._idx(C,A)]=this.data[this._idx(C-1,A)],this.data[this._idx(A,-1)]=this.data[this._idx(A,0)],this.data[this._idx(A,C)]=this.data[this._idx(A,C-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(C,-1)]=this.data[this._idx(C-1,0)],this.data[this._idx(-1,C)]=this.data[this._idx(0,C-1)],this.data[this._idx(C,C)]=this.data[this._idx(C-1,C-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let A=0;A<C;A++)for(let z=0;z<C;z++){const B=this.get(A,z);B>this.max&&(this.max=B),B<this.min&&(this.min=B)}}get(r,c){const f=new Uint8Array(this.data.buffer),_=4*this._idx(r,c);return this.unpack(f[_],f[_+1],f[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(r,c){if(r<-1||r>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(r+1)}unpack(r,c,f){return r*this.redFactor+c*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new lo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,c,f){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let _=c*this.dim,w=c*this.dim+this.dim,x=f*this.dim,T=f*this.dim+this.dim;switch(c){case-1:_=w-1;break;case 1:w=_+1}switch(f){case-1:x=T-1;break;case 1:T=x+1}const C=-c*this.dim,A=-f*this.dim;for(let z=x;z<T;z++)for(let B=_;B<w;B++)this.data[this._idx(B,z)]=r.data[this._idx(B+C,z+A)]}}zt("DEMData",d_);class f_{constructor(r){this._stringToNumber={},this._numberToString=[];for(let c=0;c<r.length;c++){const f=r[c];this._stringToNumber[f]=c,this._numberToString[c]=f}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class p_{constructor(r,c,f,_,w){this.type="Feature",this._vectorTileFeature=r,r._z=c,r._x=f,r._y=_,this.properties=r.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(r[c]=this[c]);return r}}class m_{constructor(r,c){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Us(An,16,0),this.grid3D=new Us(An,16,0),this.featureIndexArray=new hr,this.promoteId=c}insert(r,c,f,_,w,x){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,_,w);const C=x?this.grid3D:this.grid;for(let A=0;A<c.length;A++){const z=c[A],B=[1/0,1/0,-1/0,-1/0];for(let U=0;U<z.length;U++){const W=z[U];B[0]=Math.min(B[0],W.x),B[1]=Math.min(B[1],W.y),B[2]=Math.max(B[2],W.x),B[3]=Math.max(B[3],W.y)}B[0]<An&&B[1]<An&&B[2]>=0&&B[3]>=0&&C.insert(T,B[0],B[1],B[2],B[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ys.VectorTile(new Pf(this.rawTileData)).layers,this.sourceLayerCoder=new f_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,c,f,_){this.loadVTLayers();const w=r.params||{},x=An/r.tileSize/r.scale,T=Vc(w.filter),C=r.queryGeometry,A=r.queryPadding*x,z=g_(C),B=this.grid.query(z.minX-A,z.minY-A,z.maxX+A,z.maxY+A),U=g_(r.cameraQueryGeometry),W=this.grid3D.query(U.minX-A,U.minY-A,U.maxX+A,U.maxY+A,(_e,ve,Ge,Ae)=>function(Oe,Je,gt,Mt,Kt){for(const Tt of Oe)if(Je<=Tt.x&&gt<=Tt.y&&Mt>=Tt.x&&Kt>=Tt.y)return!0;const Ct=[new S(Je,gt),new S(Je,Kt),new S(Mt,Kt),new S(Mt,gt)];if(Oe.length>2){for(const Tt of Ct)if(Bl(Oe,Tt))return!0}for(let Tt=0;Tt<Oe.length-1;Tt++)if(Q1(Oe[Tt],Oe[Tt+1],Ct))return!0;return!1}(r.cameraQueryGeometry,_e-A,ve-A,Ge+A,Ae+A));for(const _e of W)B.push(_e);B.sort(vv);const ie={};let oe;for(let _e=0;_e<B.length;_e++){const ve=B[_e];if(ve===oe)continue;oe=ve;const Ge=this.featureIndexArray.get(ve);let Ae=null;this.loadMatchingFeature(ie,Ge.bucketIndex,Ge.sourceLayerIndex,Ge.featureIndex,T,w.layers,w.availableImages,c,f,_,(Oe,Je,gt)=>(Ae||(Ae=Ua(Oe)),Je.queryIntersectsFeature(C,Oe,gt,Ae,this.z,r.transform,x,r.pixelPosMatrix)))}return ie}loadMatchingFeature(r,c,f,_,w,x,T,C,A,z,B){const U=this.bucketLayerIDs[c];if(x&&!function(_e,ve){for(let Ge=0;Ge<_e.length;Ge++)if(ve.indexOf(_e[Ge])>=0)return!0;return!1}(x,U))return;const W=this.sourceLayerCoder.decode(f),ie=this.vtLayers[W].feature(_);if(w.needGeometry){const _e=$a(ie,!0);if(!w.filter(new Yi(this.tileID.overscaledZ),_e,this.tileID.canonical))return}else if(!w.filter(new Yi(this.tileID.overscaledZ),ie))return;const oe=this.getId(ie,W);for(let _e=0;_e<U.length;_e++){const ve=U[_e];if(x&&x.indexOf(ve)<0)continue;const Ge=C[ve];if(!Ge)continue;let Ae={};oe&&z&&(Ae=z.getState(Ge.sourceLayer||"_geojsonTileLayer",oe));const Oe=te({},A[ve]);Oe.paint=__(Oe.paint,Ge.paint,ie,Ae,T),Oe.layout=__(Oe.layout,Ge.layout,ie,Ae,T);const Je=!B||B(ie,Ge,Ae);if(!Je)continue;const gt=new p_(ie,this.z,this.x,this.y,oe);gt.layer=Oe;let Mt=r[ve];Mt===void 0&&(Mt=r[ve]=[]),Mt.push({featureIndex:_,feature:gt,intersectionZ:Je})}}lookupSymbolFeatures(r,c,f,_,w,x,T,C){const A={};this.loadVTLayers();const z=Vc(w);for(const B of r)this.loadMatchingFeature(A,f,_,B,z,x,T,C,c);return A}hasLayer(r){for(const c of this.bucketLayerIDs)for(const f of c)if(r===f)return!0;return!1}getId(r,c){let f=r.id;return this.promoteId&&(f=r.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof f=="boolean"&&(f=Number(f))),f}}function __(s,r,c,f,_){return ue(s,(w,x)=>{const T=r instanceof Ba?r.get(x):null;return T&&T.evaluate?T.evaluate(c,f,_):T})}function g_(s){let r=1/0,c=1/0,f=-1/0,_=-1/0;for(const w of s)r=Math.min(r,w.x),c=Math.min(c,w.y),f=Math.max(f,w.x),_=Math.max(_,w.y);return{minX:r,minY:c,maxX:f,maxY:_}}function vv(s,r){return r-s}function y_(s,r,c,f,_){const w=[];for(let x=0;x<s.length;x++){const T=s[x];let C;for(let A=0;A<T.length-1;A++){let z=T[A],B=T[A+1];z.x<r&&B.x<r||(z.x<r?z=new S(r,z.y+(r-z.x)/(B.x-z.x)*(B.y-z.y))._round():B.x<r&&(B=new S(r,z.y+(r-z.x)/(B.x-z.x)*(B.y-z.y))._round()),z.y<c&&B.y<c||(z.y<c?z=new S(z.x+(c-z.y)/(B.y-z.y)*(B.x-z.x),c)._round():B.y<c&&(B=new S(z.x+(c-z.y)/(B.y-z.y)*(B.x-z.x),c)._round()),z.x>=f&&B.x>=f||(z.x>=f?z=new S(f,z.y+(f-z.x)/(B.x-z.x)*(B.y-z.y))._round():B.x>=f&&(B=new S(f,z.y+(f-z.x)/(B.x-z.x)*(B.y-z.y))._round()),z.y>=_&&B.y>=_||(z.y>=_?z=new S(z.x+(_-z.y)/(B.y-z.y)*(B.x-z.x),_)._round():B.y>=_&&(B=new S(z.x+(_-z.y)/(B.y-z.y)*(B.x-z.x),_)._round()),C&&z.equals(C[C.length-1])||(C=[z],w.push(C)),C.push(B)))))}}return w}zt("FeatureIndex",m_,{omit:["rawTileData","sourceLayerCoder"]});class ia extends S{constructor(r,c,f,_){super(r,c),this.angle=f,_!==void 0&&(this.segment=_)}clone(){return new ia(this.x,this.y,this.angle,this.segment)}}function b_(s,r,c,f,_){if(r.segment===void 0||c===0)return!0;let w=r,x=r.segment+1,T=0;for(;T>-c/2;){if(x--,x<0)return!1;T-=s[x].dist(w),w=s[x]}T+=s[x].dist(s[x+1]),x++;const C=[];let A=0;for(;T<c/2;){const z=s[x],B=s[x+1];if(!B)return!1;let U=s[x-1].angleTo(z)-z.angleTo(B);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:T,angleDelta:U}),A+=U;T-C[0].distance>f;)A-=C.shift().angleDelta;if(A>_)return!1;x++,T+=z.dist(B)}return!0}function v_(s){let r=0;for(let c=0;c<s.length-1;c++)r+=s[c].dist(s[c+1]);return r}function w_(s,r,c){return s?.6*r*c:0}function x_(s,r){return Math.max(s?s.right-s.left:0,r?r.right-r.left:0)}function wv(s,r,c,f,_,w){const x=w_(c,_,w),T=x_(c,f)*w;let C=0;const A=v_(s)/2;for(let z=0;z<s.length-1;z++){const B=s[z],U=s[z+1],W=B.dist(U);if(C+W>A){const ie=(A-C)/W,oe=br.number(B.x,U.x,ie),_e=br.number(B.y,U.y,ie),ve=new ia(oe,_e,U.angleTo(B),z);return ve._round(),!x||b_(s,ve,T,x,r)?ve:void 0}C+=W}}function xv(s,r,c,f,_,w,x,T,C){const A=w_(f,w,x),z=x_(f,_),B=z*x,U=s[0].x===0||s[0].x===C||s[0].y===0||s[0].y===C;return r-B<r/4&&(r=B+r/4),k_(s,U?r/2*T%r:(z/2+2*w)*x*T%r,r,A,c,B,U,!1,C)}function k_(s,r,c,f,_,w,x,T,C){const A=w/2,z=v_(s);let B=0,U=r-c,W=[];for(let ie=0;ie<s.length-1;ie++){const oe=s[ie],_e=s[ie+1],ve=oe.dist(_e),Ge=_e.angleTo(oe);for(;U+c<B+ve;){U+=c;const Ae=(U-B)/ve,Oe=br.number(oe.x,_e.x,Ae),Je=br.number(oe.y,_e.y,Ae);if(Oe>=0&&Oe<C&&Je>=0&&Je<C&&U-A>=0&&U+A<=z){const gt=new ia(Oe,Je,Ge,ie);gt._round(),f&&!b_(s,gt,w,f,_)||W.push(gt)}}B+=ve}return T||W.length||x||(W=k_(s,B/2,c,f,_,w,x,!0,C)),W}zt("Anchor",ia);const Zl=jr;function S_(s,r,c,f){const _=[],w=s.image,x=w.pixelRatio,T=w.paddedRect.w-2*Zl,C=w.paddedRect.h-2*Zl;let A={x1:s.left,y1:s.top,x2:s.right,y2:s.bottom};const z=w.stretchX||[[0,T]],B=w.stretchY||[[0,C]],U=(tt,Zt)=>tt+Zt[1]-Zt[0],W=z.reduce(U,0),ie=B.reduce(U,0),oe=T-W,_e=C-ie;let ve=0,Ge=W,Ae=0,Oe=ie,Je=0,gt=oe,Mt=0,Kt=_e;if(w.content&&f){const tt=w.content,Zt=tt[2]-tt[0],Ut=tt[3]-tt[1];(w.textFitWidth||w.textFitHeight)&&(A=Jm(s)),ve=id(z,0,tt[0]),Ae=id(B,0,tt[1]),Ge=id(z,tt[0],tt[2]),Oe=id(B,tt[1],tt[3]),Je=tt[0]-ve,Mt=tt[1]-Ae,gt=Zt-Ge,Kt=Ut-Oe}const Ct=A.x1,Tt=A.y1,$t=A.x2-Ct,Rt=A.y2-Tt,Pt=(tt,Zt,Ut,ii)=>{const Hi=nd(tt.stretch-ve,Ge,$t,Ct),Gi=rd(tt.fixed-Je,gt,tt.stretch,W),jn=nd(Zt.stretch-Ae,Oe,Rt,Tt),xo=rd(Zt.fixed-Mt,Kt,Zt.stretch,ie),rr=nd(Ut.stretch-ve,Ge,$t,Ct),Un=rd(Ut.fixed-Je,gt,Ut.stretch,W),kr=nd(ii.stretch-Ae,Oe,Rt,Tt),Sr=rd(ii.fixed-Mt,Kt,ii.stretch,ie),Tr=new S(Hi,jn),Sn=new S(rr,jn),$n=new S(rr,kr),fr=new S(Hi,kr),or=new S(Gi/x,xo/x),Ir=new S(Un/x,Sr/x),sr=r*Math.PI/180;if(sr){const zi=Math.sin(sr),Ki=Math.cos(sr),nn=[Ki,-zi,zi,Ki];Tr._matMult(nn),Sn._matMult(nn),fr._matMult(nn),$n._matMult(nn)}const uo=tt.stretch+tt.fixed,Ur=Zt.stretch+Zt.fixed;return{tl:Tr,tr:Sn,bl:fr,br:$n,tex:{x:w.paddedRect.x+Zl+uo,y:w.paddedRect.y+Zl+Ur,w:Ut.stretch+Ut.fixed-uo,h:ii.stretch+ii.fixed-Ur},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:or,pixelOffsetBR:Ir,minFontScaleX:gt/x/$t,minFontScaleY:Kt/x/Rt,isSDF:c}};if(f&&(w.stretchX||w.stretchY)){const tt=T_(z,oe,W),Zt=T_(B,_e,ie);for(let Ut=0;Ut<tt.length-1;Ut++){const ii=tt[Ut],Hi=tt[Ut+1];for(let Gi=0;Gi<Zt.length-1;Gi++)_.push(Pt(ii,Zt[Gi],Hi,Zt[Gi+1]))}}else _.push(Pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:C+1}));return _}function id(s,r,c){let f=0;for(const _ of s)f+=Math.max(r,Math.min(c,_[1]))-Math.max(r,Math.min(c,_[0]));return f}function T_(s,r,c){const f=[{fixed:-Zl,stretch:0}];for(const[_,w]of s){const x=f[f.length-1];f.push({fixed:_-x.stretch,stretch:x.stretch}),f.push({fixed:_-x.stretch,stretch:x.stretch+(w-_)})}return f.push({fixed:r+Zl,stretch:c}),f}function nd(s,r,c,f){return s/r*c+f}function rd(s,r,c,f){return s-r*c/f}class od{constructor(r,c,f,_,w,x,T,C,A,z){var B;if(this.boxStartIndex=r.length,A){let U=x.top,W=x.bottom;const ie=x.collisionPadding;ie&&(U-=ie[1],W+=ie[3]);let oe=W-U;oe>0&&(oe=Math.max(10,oe),this.circleDiameter=oe)}else{const U=!((B=x.image)===null||B===void 0)&&B.content&&(x.image.textFitWidth||x.image.textFitHeight)?Jm(x):{x1:x.left,y1:x.top,x2:x.right,y2:x.bottom};U.y1=U.y1*T-C[0],U.y2=U.y2*T+C[2],U.x1=U.x1*T-C[3],U.x2=U.x2*T+C[1];const W=x.collisionPadding;if(W&&(U.x1-=W[0]*T,U.y1-=W[1]*T,U.x2+=W[2]*T,U.y2+=W[3]*T),z){const ie=new S(U.x1,U.y1),oe=new S(U.x2,U.y1),_e=new S(U.x1,U.y2),ve=new S(U.x2,U.y2),Ge=z*Math.PI/180;ie._rotate(Ge),oe._rotate(Ge),_e._rotate(Ge),ve._rotate(Ge),U.x1=Math.min(ie.x,oe.x,_e.x,ve.x),U.x2=Math.max(ie.x,oe.x,_e.x,ve.x),U.y1=Math.min(ie.y,oe.y,_e.y,ve.y),U.y2=Math.max(ie.y,oe.y,_e.y,ve.y)}r.emplaceBack(c.x,c.y,U.x1,U.y1,U.x2,U.y2,f,_,w)}this.boxEndIndex=r.length}}class kv{constructor(r=[],c=(f,_)=>f<_?-1:f>_?1:0){if(this.data=r,this.length=this.data.length,this.compare=c,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],c=this.data.pop();return--this.length>0&&(this.data[0]=c,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:c,compare:f}=this,_=c[r];for(;r>0;){const w=r-1>>1,x=c[w];if(f(_,x)>=0)break;c[r]=x,r=w}c[r]=_}_down(r){const{data:c,compare:f}=this,_=this.length>>1,w=c[r];for(;r<_;){let x=1+(r<<1);const T=x+1;if(T<this.length&&f(c[T],c[x])<0&&(x=T),f(c[x],w)>=0)break;c[r]=c[x],r=x}c[r]=w}}function Sv(s,r=1,c=!1){let f=1/0,_=1/0,w=-1/0,x=-1/0;const T=s[0];for(let W=0;W<T.length;W++){const ie=T[W];(!W||ie.x<f)&&(f=ie.x),(!W||ie.y<_)&&(_=ie.y),(!W||ie.x>w)&&(w=ie.x),(!W||ie.y>x)&&(x=ie.y)}const C=Math.min(w-f,x-_);let A=C/2;const z=new kv([],Tv);if(C===0)return new S(f,_);for(let W=f;W<w;W+=C)for(let ie=_;ie<x;ie+=C)z.push(new Gl(W+A,ie+A,A,s));let B=function(W){let ie=0,oe=0,_e=0;const ve=W[0];for(let Ge=0,Ae=ve.length,Oe=Ae-1;Ge<Ae;Oe=Ge++){const Je=ve[Ge],gt=ve[Oe],Mt=Je.x*gt.y-gt.x*Je.y;oe+=(Je.x+gt.x)*Mt,_e+=(Je.y+gt.y)*Mt,ie+=3*Mt}return new Gl(oe/ie,_e/ie,0,W)}(s),U=z.length;for(;z.length;){const W=z.pop();(W.d>B.d||!B.d)&&(B=W,c&&console.log("found best %d after %d probes",Math.round(1e4*W.d)/1e4,U)),W.max-B.d<=r||(A=W.h/2,z.push(new Gl(W.p.x-A,W.p.y-A,A,s)),z.push(new Gl(W.p.x+A,W.p.y-A,A,s)),z.push(new Gl(W.p.x-A,W.p.y+A,A,s)),z.push(new Gl(W.p.x+A,W.p.y+A,A,s)),U+=4)}return c&&(console.log(`num probes: ${U}`),console.log(`best distance: ${B.d}`)),B.p}function Tv(s,r){return r.max-s.max}function Gl(s,r,c,f){this.p=new S(s,r),this.h=c,this.d=function(_,w){let x=!1,T=1/0;for(let C=0;C<w.length;C++){const A=w[C];for(let z=0,B=A.length,U=B-1;z<B;U=z++){const W=A[z],ie=A[U];W.y>_.y!=ie.y>_.y&&_.x<(ie.x-W.x)*(_.y-W.y)/(ie.y-W.y)+W.x&&(x=!x),T=Math.min(T,lm(_,W,ie))}}return(x?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var nr;d.aq=void 0,(nr=d.aq||(d.aq={}))[nr.center=1]="center",nr[nr.left=2]="left",nr[nr.right=3]="right",nr[nr.top=4]="top",nr[nr.bottom=5]="bottom",nr[nr["top-left"]=6]="top-left",nr[nr["top-right"]=7]="top-right",nr[nr["bottom-left"]=8]="bottom-left",nr[nr["bottom-right"]=9]="bottom-right";const na=7,Zf=Number.POSITIVE_INFINITY;function I_(s,r){return r[1]!==Zf?function(c,f,_){let w=0,x=0;switch(f=Math.abs(f),_=Math.abs(_),c){case"top-right":case"top-left":case"top":x=_-na;break;case"bottom-right":case"bottom-left":case"bottom":x=-_+na}switch(c){case"top-right":case"bottom-right":case"right":w=-f;break;case"top-left":case"bottom-left":case"left":w=f}return[w,x]}(s,r[0],r[1]):function(c,f){let _=0,w=0;f<0&&(f=0);const x=f/Math.SQRT2;switch(c){case"top-right":case"top-left":w=x-na;break;case"bottom-right":case"bottom-left":w=-x+na;break;case"bottom":w=-f+na;break;case"top":w=f-na}switch(c){case"top-right":case"bottom-right":_=-x;break;case"top-left":case"bottom-left":_=x;break;case"left":_=f;break;case"right":_=-f}return[_,w]}(s,r[0])}function C_(s,r,c){var f;const _=s.layout,w=(f=_.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(r,{},c);if(w){const T=w.values,C=[];for(let A=0;A<T.length;A+=2){const z=C[A]=T[A],B=T[A+1].map(U=>U*Rn);z.startsWith("top")?B[1]-=na:z.startsWith("bottom")&&(B[1]+=na),C[A+1]=B}return new Gr(C)}const x=_.get("text-variable-anchor");if(x){let T;T=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(r,{},c)*Rn,Zf]:_.get("text-offset").evaluate(r,{},c).map(A=>A*Rn);const C=[];for(const A of x)C.push(A,I_(A,T));return new Gr(C)}return null}function Gf(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Iv(s,r,c,f,_,w,x,T,C,A,z){let B=w.textMaxSize.evaluate(r,{});B===void 0&&(B=x);const U=s.layers[0].layout,W=U.get("icon-offset").evaluate(r,{},z),ie=L_(c.horizontal),oe=x/24,_e=s.tilePixelRatio*oe,ve=s.tilePixelRatio*B/24,Ge=s.tilePixelRatio*T,Ae=s.tilePixelRatio*U.get("symbol-spacing"),Oe=U.get("text-padding")*s.tilePixelRatio,Je=function(tt,Zt,Ut,ii=1){const Hi=tt.get("icon-padding").evaluate(Zt,{},Ut),Gi=Hi&&Hi.values;return[Gi[0]*ii,Gi[1]*ii,Gi[2]*ii,Gi[3]*ii]}(U,r,z,s.tilePixelRatio),gt=U.get("text-max-angle")/180*Math.PI,Mt=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point",Kt=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",Ct=U.get("symbol-placement"),Tt=Ae/2,$t=U.get("icon-text-fit");let Rt;f&&$t!=="none"&&(s.allowVerticalPlacement&&c.vertical&&(Rt=Ym(f,c.vertical,$t,U.get("icon-text-fit-padding"),W,oe)),ie&&(f=Ym(f,ie,$t,U.get("icon-text-fit-padding"),W,oe)));const Pt=(tt,Zt)=>{Zt.x<0||Zt.x>=An||Zt.y<0||Zt.y>=An||function(Ut,ii,Hi,Gi,jn,xo,rr,Un,kr,Sr,Tr,Sn,$n,fr,or,Ir,sr,uo,Ur,zi,Ki,nn,Qr,dn,Wl){const Go=Ut.addToLineVertexArray(ii,Hi);let Wo,ko,ho,Hn,us=0,Cu=0,z_=0,D_=0,ep=-1,tp=-1;const hs={};let R_=zl("");if(Ut.allowVerticalPlacement&&Gi.vertical){const pr=Un.layout.get("text-rotate").evaluate(Ki,{},dn)+90;ho=new od(kr,ii,Sr,Tr,Sn,Gi.vertical,$n,fr,or,pr),rr&&(Hn=new od(kr,ii,Sr,Tr,Sn,rr,sr,uo,or,pr))}if(jn){const pr=Un.layout.get("icon-rotate").evaluate(Ki,{}),fo=Un.layout.get("icon-text-fit")!=="none",qa=S_(jn,pr,Qr,fo),Ro=rr?S_(rr,pr,Qr,fo):void 0;ko=new od(kr,ii,Sr,Tr,Sn,jn,sr,uo,!1,pr),us=4*qa.length;const Za=Ut.iconSizeData;let Ho=null;Za.kind==="source"?(Ho=[Zo*Un.layout.get("icon-size").evaluate(Ki,{})],Ho[0]>ea&&We(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${xu}. Reduce your "icon-size".`)):Za.kind==="composite"&&(Ho=[Zo*nn.compositeIconSizes[0].evaluate(Ki,{},dn),Zo*nn.compositeIconSizes[1].evaluate(Ki,{},dn)],(Ho[0]>ea||Ho[1]>ea)&&We(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${xu}. Reduce your "icon-size".`)),Ut.addSymbols(Ut.icon,qa,Ho,zi,Ur,Ki,d.ah.none,ii,Go.lineStartIndex,Go.lineLength,-1,dn),ep=Ut.icon.placedSymbolArray.length-1,Ro&&(Cu=4*Ro.length,Ut.addSymbols(Ut.icon,Ro,Ho,zi,Ur,Ki,d.ah.vertical,ii,Go.lineStartIndex,Go.lineLength,-1,dn),tp=Ut.icon.placedSymbolArray.length-1)}const F_=Object.keys(Gi.horizontal);for(const pr of F_){const fo=Gi.horizontal[pr];if(!Wo){R_=zl(fo.text);const Ro=Un.layout.get("text-rotate").evaluate(Ki,{},dn);Wo=new od(kr,ii,Sr,Tr,Sn,fo,$n,fr,or,Ro)}const qa=fo.positionedLines.length===1;if(z_+=E_(Ut,ii,fo,xo,Un,or,Ki,Ir,Go,Gi.vertical?d.ah.horizontal:d.ah.horizontalOnly,qa?F_:[pr],hs,ep,nn,dn),qa)break}Gi.vertical&&(D_+=E_(Ut,ii,Gi.vertical,xo,Un,or,Ki,Ir,Go,d.ah.vertical,["vertical"],hs,tp,nn,dn));const Lv=Wo?Wo.boxStartIndex:Ut.collisionBoxArray.length,Mv=Wo?Wo.boxEndIndex:Ut.collisionBoxArray.length,Av=ho?ho.boxStartIndex:Ut.collisionBoxArray.length,Pv=ho?ho.boxEndIndex:Ut.collisionBoxArray.length,zv=ko?ko.boxStartIndex:Ut.collisionBoxArray.length,Dv=ko?ko.boxEndIndex:Ut.collisionBoxArray.length,Rv=Hn?Hn.boxStartIndex:Ut.collisionBoxArray.length,Fv=Hn?Hn.boxEndIndex:Ut.collisionBoxArray.length;let Do=-1;const ad=(pr,fo)=>pr&&pr.circleDiameter?Math.max(pr.circleDiameter,fo):fo;Do=ad(Wo,Do),Do=ad(ho,Do),Do=ad(ko,Do),Do=ad(Hn,Do);const B_=Do>-1?1:0;B_&&(Do*=Wl/Rn),Ut.glyphOffsetArray.length>=ql.MAX_GLYPHS&&We("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ki.sortKey!==void 0&&Ut.addToSortKeyRanges(Ut.symbolInstances.length,Ki.sortKey);const Bv=C_(Un,Ki,dn),[Ov,Nv]=function(pr,fo){const qa=pr.length,Ro=fo==null?void 0:fo.values;if((Ro==null?void 0:Ro.length)>0)for(let Za=0;Za<Ro.length;Za+=2){const Ho=Ro[Za+1];pr.emplaceBack(d.aq[Ro[Za]],Ho[0],Ho[1])}return[qa,pr.length]}(Ut.textAnchorOffsets,Bv);Ut.symbolInstances.emplaceBack(ii.x,ii.y,hs.right>=0?hs.right:-1,hs.center>=0?hs.center:-1,hs.left>=0?hs.left:-1,hs.vertical||-1,ep,tp,R_,Lv,Mv,Av,Pv,zv,Dv,Rv,Fv,Sr,z_,D_,us,Cu,B_,0,$n,Do,Ov,Nv)}(s,Zt,tt,c,f,_,Rt,s.layers[0],s.collisionBoxArray,r.index,r.sourceLayerIndex,s.index,_e,[Oe,Oe,Oe,Oe],Mt,C,Ge,Je,Kt,W,r,w,A,z,x)};if(Ct==="line")for(const tt of y_(r.geometry,0,0,An,An)){const Zt=xv(tt,Ae,gt,c.vertical||ie,f,24,ve,s.overscaling,An);for(const Ut of Zt)ie&&Cv(s,ie.text,Tt,Ut)||Pt(tt,Ut)}else if(Ct==="line-center"){for(const tt of r.geometry)if(tt.length>1){const Zt=wv(tt,gt,c.vertical||ie,f,24,ve);Zt&&Pt(tt,Zt)}}else if(r.type==="Polygon")for(const tt of cl(r.geometry,0)){const Zt=Sv(tt,16);Pt(tt[0],new ia(Zt.x,Zt.y,0))}else if(r.type==="LineString")for(const tt of r.geometry)Pt(tt,new ia(tt[0].x,tt[0].y,0));else if(r.type==="Point")for(const tt of r.geometry)for(const Zt of tt)Pt([Zt],new ia(Zt.x,Zt.y,0))}function E_(s,r,c,f,_,w,x,T,C,A,z,B,U,W,ie){const oe=function(Ge,Ae,Oe,Je,gt,Mt,Kt,Ct){const Tt=Je.layout.get("text-rotate").evaluate(Mt,{})*Math.PI/180,$t=[];for(const Rt of Ae.positionedLines)for(const Pt of Rt.positionedGlyphs){if(!Pt.rect)continue;const tt=Pt.rect||{};let Zt=qm+1,Ut=!0,ii=1,Hi=0;const Gi=(gt||Ct)&&Pt.vertical,jn=Pt.metrics.advance*Pt.scale/2;if(Ct&&Ae.verticalizable&&(Hi=Rt.lineOffset/2-(Pt.imageName?-(Rn-Pt.metrics.width*Pt.scale)/2:(Pt.scale-1)*Rn)),Pt.imageName){const zi=Kt[Pt.imageName];Ut=zi.sdf,ii=zi.pixelRatio,Zt=jr/ii}const xo=gt?[Pt.x+jn,Pt.y]:[0,0];let rr=gt?[0,0]:[Pt.x+jn+Oe[0],Pt.y+Oe[1]-Hi],Un=[0,0];Gi&&(Un=rr,rr=[0,0]);const kr=Pt.metrics.isDoubleResolution?2:1,Sr=(Pt.metrics.left-Zt)*Pt.scale-jn+rr[0],Tr=(-Pt.metrics.top-Zt)*Pt.scale+rr[1],Sn=Sr+tt.w/kr*Pt.scale/ii,$n=Tr+tt.h/kr*Pt.scale/ii,fr=new S(Sr,Tr),or=new S(Sn,Tr),Ir=new S(Sr,$n),sr=new S(Sn,$n);if(Gi){const zi=new S(-jn,jn-vu),Ki=-Math.PI/2,nn=Rn/2-jn,Qr=new S(5-vu-nn,-(Pt.imageName?nn:0)),dn=new S(...Un);fr._rotateAround(Ki,zi)._add(Qr)._add(dn),or._rotateAround(Ki,zi)._add(Qr)._add(dn),Ir._rotateAround(Ki,zi)._add(Qr)._add(dn),sr._rotateAround(Ki,zi)._add(Qr)._add(dn)}if(Tt){const zi=Math.sin(Tt),Ki=Math.cos(Tt),nn=[Ki,-zi,zi,Ki];fr._matMult(nn),or._matMult(nn),Ir._matMult(nn),sr._matMult(nn)}const uo=new S(0,0),Ur=new S(0,0);$t.push({tl:fr,tr:or,bl:Ir,br:sr,tex:tt,writingMode:Ae.writingMode,glyphOffset:xo,sectionIndex:Pt.sectionIndex,isSDF:Ut,pixelOffsetTL:uo,pixelOffsetBR:Ur,minFontScaleX:0,minFontScaleY:0})}return $t}(0,c,T,_,w,x,f,s.allowVerticalPlacement),_e=s.textSizeData;let ve=null;_e.kind==="source"?(ve=[Zo*_.layout.get("text-size").evaluate(x,{})],ve[0]>ea&&We(`${s.layerIds[0]}: Value for "text-size" is >= ${xu}. Reduce your "text-size".`)):_e.kind==="composite"&&(ve=[Zo*W.compositeTextSizes[0].evaluate(x,{},ie),Zo*W.compositeTextSizes[1].evaluate(x,{},ie)],(ve[0]>ea||ve[1]>ea)&&We(`${s.layerIds[0]}: Value for "text-size" is >= ${xu}. Reduce your "text-size".`)),s.addSymbols(s.text,oe,ve,T,w,x,A,r,C.lineStartIndex,C.lineLength,U,ie);for(const Ge of z)B[Ge]=s.text.placedSymbolArray.length-1;return 4*oe.length}function L_(s){for(const r in s)return s[r];return null}function Cv(s,r,c,f){const _=s.compareText;if(r in _){const w=_[r];for(let x=w.length-1;x>=0;x--)if(f.dist(w[x])<c)return!0}else _[r]=[];return _[r].push(f),!1}const M_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Wf{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,f]=new Uint8Array(r,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=f>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const w=M_[15&f];if(!w)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(r,2,1),[T]=new Uint32Array(r,4,1);return new Wf(T,x,w,r)}constructor(r,c=64,f=Float64Array,_){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=f,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const w=M_.indexOf(this.ArrayType),x=2*r*this.ArrayType.BYTES_PER_ELEMENT,T=r*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-T%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${f}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+T+C,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+x+T+C),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+T+C,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=r)}add(r,c){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=r,this.coords[this._pos++]=c,f}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return Hf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,c,f,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:x,nodeSize:T}=this,C=[0,w.length-1,0],A=[];for(;C.length;){const z=C.pop()||0,B=C.pop()||0,U=C.pop()||0;if(B-U<=T){for(let _e=U;_e<=B;_e++){const ve=x[2*_e],Ge=x[2*_e+1];ve>=r&&ve<=f&&Ge>=c&&Ge<=_&&A.push(w[_e])}continue}const W=U+B>>1,ie=x[2*W],oe=x[2*W+1];ie>=r&&ie<=f&&oe>=c&&oe<=_&&A.push(w[W]),(z===0?r<=ie:c<=oe)&&(C.push(U),C.push(W-1),C.push(1-z)),(z===0?f>=ie:_>=oe)&&(C.push(W+1),C.push(B),C.push(1-z))}return A}within(r,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:w,nodeSize:x}=this,T=[0,_.length-1,0],C=[],A=f*f;for(;T.length;){const z=T.pop()||0,B=T.pop()||0,U=T.pop()||0;if(B-U<=x){for(let _e=U;_e<=B;_e++)P_(w[2*_e],w[2*_e+1],r,c)<=A&&C.push(_[_e]);continue}const W=U+B>>1,ie=w[2*W],oe=w[2*W+1];P_(ie,oe,r,c)<=A&&C.push(_[W]),(z===0?r-f<=ie:c-f<=oe)&&(T.push(U),T.push(W-1),T.push(1-z)),(z===0?r+f>=ie:c+f>=oe)&&(T.push(W+1),T.push(B),T.push(1-z))}return C}}function Hf(s,r,c,f,_,w){if(_-f<=c)return;const x=f+_>>1;A_(s,r,x,f,_,w),Hf(s,r,c,f,x-1,1-w),Hf(s,r,c,x+1,_,1-w)}function A_(s,r,c,f,_,w){for(;_>f;){if(_-f>600){const A=_-f+1,z=c-f+1,B=Math.log(A),U=.5*Math.exp(2*B/3),W=.5*Math.sqrt(B*U*(A-U)/A)*(z-A/2<0?-1:1);A_(s,r,c,Math.max(f,Math.floor(c-z*U/A+W)),Math.min(_,Math.floor(c+(A-z)*U/A+W)),w)}const x=r[2*c+w];let T=f,C=_;for(Tu(s,r,f,c),r[2*_+w]>x&&Tu(s,r,f,_);T<C;){for(Tu(s,r,T,C),T++,C--;r[2*T+w]<x;)T++;for(;r[2*C+w]>x;)C--}r[2*f+w]===x?Tu(s,r,f,C):(C++,Tu(s,r,C,_)),C<=c&&(f=C+1),c<=C&&(_=C-1)}}function Tu(s,r,c,f){Xf(s,c,f),Xf(r,2*c,2*f),Xf(r,2*c+1,2*f+1)}function Xf(s,r,c){const f=s[r];s[r]=s[c],s[c]=f}function P_(s,r,c,f){const _=s-c,w=r-f;return _*_+w*w}var Kf;d.bg=void 0,(Kf=d.bg||(d.bg={})).create="create",Kf.load="load",Kf.fullLoad="fullLoad";let sd=null,Iu=[];const Jf=1e3/60,Yf="loadTime",Qf="fullLoadTime",Ev={mark(s){performance.mark(s)},frame(s){const r=s;sd!=null&&Iu.push(r-sd),sd=r},clearMetrics(){sd=null,Iu=[],performance.clearMeasures(Yf),performance.clearMeasures(Qf);for(const s in d.bg)performance.clearMarks(d.bg[s])},getPerformanceMetrics(){performance.measure(Yf,d.bg.create,d.bg.load),performance.measure(Qf,d.bg.create,d.bg.fullLoad);const s=performance.getEntriesByName(Yf)[0].duration,r=performance.getEntriesByName(Qf)[0].duration,c=Iu.length,f=1/(Iu.reduce((w,x)=>w+x,0)/c/1e3),_=Iu.filter(w=>w>Jf).reduce((w,x)=>w+(x-Jf)/Jf,0);return{loadTime:s,fullLoadTime:r,fps:f,percentDroppedFrames:_/(c+_)*100,totalFrames:c}}};d.$=class extends O{},d.A=Ol,d.B=af,d.C=function(s){if(rt==null){const r=s.navigator?s.navigator.userAgent:null;rt=!!s.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return rt},d.D=Ot,d.E=st,d.F=class{constructor(s,r){this.target=s,this.mapId=r,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new bv(()=>this.process()),this.subscription=function(c,f,_,w){return c.addEventListener(f,_,!1),{unsubscribe:()=>{c.removeEventListener(f,_,!1)}}}(this.target,"message",c=>this.receive(c)),this.globalScope=ze(self)?s:window}registerMessageHandler(s,r){this.messageHandlers[s]=r}sendAsync(s,r){return new Promise((c,f)=>{const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[_]={resolve:c,reject:f},r&&r.signal.addEventListener("abort",()=>{delete this.resolveRejects[_];const T={id:_,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},{once:!0});const w=[],x=Object.assign(Object.assign({},s),{id:_,sourceMapId:this.mapId,origin:location.origin,data:$s(s.data,w)});this.target.postMessage(x,{transfer:w})})}receive(s){const r=s.data,c=r.id;if(!(r.origin!=="file://"&&location.origin!=="file://"&&r.origin!=="resource://android"&&location.origin!=="resource://android"&&r.origin!==location.origin||r.targetMapId&&this.mapId!==r.targetMapId)){if(r.type==="<cancel>"){delete this.tasks[c];const f=this.abortControllers[c];return delete this.abortControllers[c],void(f&&f.abort())}if(ze(self)||r.mustQueue)return this.tasks[c]=r,this.taskQueue.push(c),void this.invoker.trigger();this.processTask(c,r)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),r=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),r&&this.processTask(s,r)}processTask(s,r){return a(this,void 0,void 0,function*(){if(r.type==="<response>"){const _=this.resolveRejects[s];return delete this.resolveRejects[s],_?void(r.error?_.reject(Vs(r.error)):_.resolve(Vs(r.data))):void 0}if(!this.messageHandlers[r.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${r.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const c=Vs(r.data),f=new AbortController;this.abortControllers[s]=f;try{const _=yield this.messageHandlers[r.type](r.sourceMapId,c,f);this.completeTask(s,null,_)}catch(_){this.completeTask(s,_)}})}completeTask(s,r,c){const f=[];delete this.abortControllers[s];const _={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:r?$s(r):null,data:$s(c,f)};this.target.postMessage(_,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},d.G=Ht,d.H=function(){var s=new Ol(16);return Ol!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},d.I=Df,d.J=function(s,r,c){var f,_,w,x,T,C,A,z,B,U,W,ie,oe=c[0],_e=c[1],ve=c[2];return r===s?(s[12]=r[0]*oe+r[4]*_e+r[8]*ve+r[12],s[13]=r[1]*oe+r[5]*_e+r[9]*ve+r[13],s[14]=r[2]*oe+r[6]*_e+r[10]*ve+r[14],s[15]=r[3]*oe+r[7]*_e+r[11]*ve+r[15]):(_=r[1],w=r[2],x=r[3],T=r[4],C=r[5],A=r[6],z=r[7],B=r[8],U=r[9],W=r[10],ie=r[11],s[0]=f=r[0],s[1]=_,s[2]=w,s[3]=x,s[4]=T,s[5]=C,s[6]=A,s[7]=z,s[8]=B,s[9]=U,s[10]=W,s[11]=ie,s[12]=f*oe+T*_e+B*ve+r[12],s[13]=_*oe+C*_e+U*ve+r[13],s[14]=w*oe+A*_e+W*ve+r[14],s[15]=x*oe+z*_e+ie*ve+r[15]),s},d.K=function(s,r,c){var f=c[0],_=c[1],w=c[2];return s[0]=r[0]*f,s[1]=r[1]*f,s[2]=r[2]*f,s[3]=r[3]*f,s[4]=r[4]*_,s[5]=r[5]*_,s[6]=r[6]*_,s[7]=r[7]*_,s[8]=r[8]*w,s[9]=r[9]*w,s[10]=r[10]*w,s[11]=r[11]*w,s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15],s},d.L=dm,d.M=function(s,r){const c={};for(let f=0;f<r.length;f++){const _=r[f];_ in s&&(c[_]=s[_])}return c},d.N=ta,d.O=a_,d.P=S,d.Q=l_,d.R=lo,d.S=co,d.T=El,d.U=H,d.V=G,d.W=Ft,d.X=An,d.Y=I,d.Z=ku,d._=a,d.a=Bt,d.a$=function(s,r){var c=s[0],f=s[1],_=s[2],w=s[3],x=s[4],T=s[5],C=s[6],A=s[7],z=s[8],B=s[9],U=s[10],W=s[11],ie=s[12],oe=s[13],_e=s[14],ve=s[15],Ge=r[0],Ae=r[1],Oe=r[2],Je=r[3],gt=r[4],Mt=r[5],Kt=r[6],Ct=r[7],Tt=r[8],$t=r[9],Rt=r[10],Pt=r[11],tt=r[12],Zt=r[13],Ut=r[14],ii=r[15];return Math.abs(c-Ge)<=xr*Math.max(1,Math.abs(c),Math.abs(Ge))&&Math.abs(f-Ae)<=xr*Math.max(1,Math.abs(f),Math.abs(Ae))&&Math.abs(_-Oe)<=xr*Math.max(1,Math.abs(_),Math.abs(Oe))&&Math.abs(w-Je)<=xr*Math.max(1,Math.abs(w),Math.abs(Je))&&Math.abs(x-gt)<=xr*Math.max(1,Math.abs(x),Math.abs(gt))&&Math.abs(T-Mt)<=xr*Math.max(1,Math.abs(T),Math.abs(Mt))&&Math.abs(C-Kt)<=xr*Math.max(1,Math.abs(C),Math.abs(Kt))&&Math.abs(A-Ct)<=xr*Math.max(1,Math.abs(A),Math.abs(Ct))&&Math.abs(z-Tt)<=xr*Math.max(1,Math.abs(z),Math.abs(Tt))&&Math.abs(B-$t)<=xr*Math.max(1,Math.abs(B),Math.abs($t))&&Math.abs(U-Rt)<=xr*Math.max(1,Math.abs(U),Math.abs(Rt))&&Math.abs(W-Pt)<=xr*Math.max(1,Math.abs(W),Math.abs(Pt))&&Math.abs(ie-tt)<=xr*Math.max(1,Math.abs(ie),Math.abs(tt))&&Math.abs(oe-Zt)<=xr*Math.max(1,Math.abs(oe),Math.abs(Zt))&&Math.abs(_e-Ut)<=xr*Math.max(1,Math.abs(_e),Math.abs(Ut))&&Math.abs(ve-ii)<=xr*Math.max(1,Math.abs(ve),Math.abs(ii))},d.a0=Ii,d.a1=qf,d.a2=ct,d.a3=s=>{const r=window.document.createElement("video");return r.muted=!0,new Promise(c=>{r.onloadstart=()=>{c(r)};for(const f of s){const _=window.document.createElement("source");Ri(f)||(r.crossOrigin="Anonymous"),_.src=f,r.appendChild(_)}})},d.a4=function(){return Y++},d.a5=Lt,d.a6=ql,d.a7=Vc,d.a8=$a,d.a9=p_,d.aA=function(s){if(s.type==="custom")return new yv(s);switch(s.type){case"background":return new mv(s);case"circle":return new ib(s);case"fill":return new bb(s);case"fill-extrusion":return new Db(s);case"heatmap":return new rb(s);case"hillshade":return new sb(s);case"line":return new $b(s);case"raster":return new gv(s);case"symbol":return new td(s)}},d.aB=ce,d.aC=function(s,r){if(!s)return[{command:"setStyle",args:[r]}];let c=[];try{if(!Ie(s.version,r.version))return[{command:"setStyle",args:[r]}];Ie(s.center,r.center)||c.push({command:"setCenter",args:[r.center]}),Ie(s.zoom,r.zoom)||c.push({command:"setZoom",args:[r.zoom]}),Ie(s.bearing,r.bearing)||c.push({command:"setBearing",args:[r.bearing]}),Ie(s.pitch,r.pitch)||c.push({command:"setPitch",args:[r.pitch]}),Ie(s.sprite,r.sprite)||c.push({command:"setSprite",args:[r.sprite]}),Ie(s.glyphs,r.glyphs)||c.push({command:"setGlyphs",args:[r.glyphs]}),Ie(s.transition,r.transition)||c.push({command:"setTransition",args:[r.transition]}),Ie(s.light,r.light)||c.push({command:"setLight",args:[r.light]}),Ie(s.terrain,r.terrain)||c.push({command:"setTerrain",args:[r.terrain]}),Ie(s.sky,r.sky)||c.push({command:"setSky",args:[r.sky]}),Ie(s.projection,r.projection)||c.push({command:"setProjection",args:[r.projection]});const f={},_=[];(function(x,T,C,A){let z;for(z in T=T||{},x=x||{})Object.prototype.hasOwnProperty.call(x,z)&&(Object.prototype.hasOwnProperty.call(T,z)||wi(z,C,A));for(z in T)Object.prototype.hasOwnProperty.call(T,z)&&(Object.prototype.hasOwnProperty.call(x,z)?Ie(x[z],T[z])||(x[z].type==="geojson"&&T[z].type==="geojson"&&Li(x,T,z)?nt(C,{command:"setGeoJSONSourceData",args:[z,T[z].data]}):Ni(z,T,C,A)):Xt(z,T,C))})(s.sources,r.sources,_,f);const w=[];s.layers&&s.layers.forEach(x=>{"source"in x&&f[x.source]?c.push({command:"removeLayer",args:[x.id]}):w.push(x)}),c=c.concat(_),function(x,T,C){T=T||[];const A=(x=x||[]).map(Fi),z=T.map(Fi),B=x.reduce(_r,{}),U=T.reduce(_r,{}),W=A.slice(),ie=Object.create(null);let oe,_e,ve,Ge,Ae;for(let Oe=0,Je=0;Oe<A.length;Oe++)oe=A[Oe],Object.prototype.hasOwnProperty.call(U,oe)?Je++:(nt(C,{command:"removeLayer",args:[oe]}),W.splice(W.indexOf(oe,Je),1));for(let Oe=0,Je=0;Oe<z.length;Oe++)oe=z[z.length-1-Oe],W[W.length-1-Oe]!==oe&&(Object.prototype.hasOwnProperty.call(B,oe)?(nt(C,{command:"removeLayer",args:[oe]}),W.splice(W.lastIndexOf(oe,W.length-Je),1)):Je++,Ge=W[W.length-Oe],nt(C,{command:"addLayer",args:[U[oe],Ge]}),W.splice(W.length-Oe,0,oe),ie[oe]=!0);for(let Oe=0;Oe<z.length;Oe++)if(oe=z[Oe],_e=B[oe],ve=U[oe],!ie[oe]&&!Ie(_e,ve))if(Ie(_e.source,ve.source)&&Ie(_e["source-layer"],ve["source-layer"])&&Ie(_e.type,ve.type)){for(Ae in gi(_e.layout,ve.layout,C,oe,null,"setLayoutProperty"),gi(_e.paint,ve.paint,C,oe,null,"setPaintProperty"),Ie(_e.filter,ve.filter)||nt(C,{command:"setFilter",args:[oe,ve.filter]}),Ie(_e.minzoom,ve.minzoom)&&Ie(_e.maxzoom,ve.maxzoom)||nt(C,{command:"setLayerZoomRange",args:[oe,ve.minzoom,ve.maxzoom]}),_e)Object.prototype.hasOwnProperty.call(_e,Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?gi(_e[Ae],ve[Ae],C,oe,Ae.slice(6),"setPaintProperty"):Ie(_e[Ae],ve[Ae])||nt(C,{command:"setLayerProperty",args:[oe,Ae,ve[Ae]]}));for(Ae in ve)Object.prototype.hasOwnProperty.call(ve,Ae)&&!Object.prototype.hasOwnProperty.call(_e,Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?gi(_e[Ae],ve[Ae],C,oe,Ae.slice(6),"setPaintProperty"):Ie(_e[Ae],ve[Ae])||nt(C,{command:"setLayerProperty",args:[oe,Ae,ve[Ae]]}))}else nt(C,{command:"removeLayer",args:[oe]}),Ge=W[W.lastIndexOf(oe)+1],nt(C,{command:"addLayer",args:[ve,Ge]})}(w,r.layers,c)}catch(f){console.warn("Unable to compute style diff:",f),c=[{command:"setStyle",args:[r]}]}return c},d.aD=function(s){const r=[],c=s.id;return c===void 0&&r.push({message:`layers.${c}: missing required property "id"`}),s.render===void 0&&r.push({message:`layers.${c}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&r.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),r},d.aE=function s(r,c){if(Array.isArray(r)){if(!Array.isArray(c)||r.length!==c.length)return!1;for(let f=0;f<r.length;f++)if(!s(r[f],c[f]))return!1;return!0}if(typeof r=="object"&&r!==null&&c!==null){if(typeof c!="object"||Object.keys(r).length!==Object.keys(c).length)return!1;for(const f in r)if(!s(r[f],c[f]))return!1;return!0}return r===c},d.aF=ue,d.aG=fe,d.aH=class extends Na{constructor(s,r){super(s,r),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},d.aI=$h,d.aJ=class extends Na{constructor(s,r){super(s,r),this.current=H1}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let r=1;r<16;r++)if(s[r]!==this.current[r]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},d.aK=tm,d.aL=im,d.aM=$i,d.aN=class extends Na{constructor(s,r){super(s,r),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},d.aO=class extends Na{constructor(s,r){super(s,r),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},d.aP=function(s,r,c,f,_,w,x){var T=1/(r-c),C=1/(f-_),A=1/(w-x);return s[0]=-2*T,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*C,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*A,s[11]=0,s[12]=(r+c)*T,s[13]=(_+f)*C,s[14]=(x+w)*A,s[15]=1,s},d.aQ=tb,d.aR=class extends Re{},d.aS=Gb,d.aT=class extends He{},d.aU=xf,d.aV=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},d.aW=gm,d.aX=tr,d.aY=ao,d.aZ=class extends Nt{},d.a_=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]&&s[3]===r[3]&&s[4]===r[4]&&s[5]===r[5]&&s[6]===r[6]&&s[7]===r[7]&&s[8]===r[8]&&s[9]===r[9]&&s[10]===r[10]&&s[11]===r[11]&&s[12]===r[12]&&s[13]===r[13]&&s[14]===r[14]&&s[15]===r[15]},d.aa=function(s){const r={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,f,_,w)=>{const x=_||w;return r[f]=!x||x.toLowerCase(),""}),r["max-age"]){const c=parseInt(r["max-age"],10);isNaN(c)?delete r["max-age"]:r["max-age"]=c}return r},d.ab=function(s,r){const c=[];for(const f in s)f in r||c.push(f);return c},d.ac=Se,d.ad=function(s,r,c){var f=Math.sin(c),_=Math.cos(c),w=r[0],x=r[1],T=r[2],C=r[3],A=r[4],z=r[5],B=r[6],U=r[7];return r!==s&&(s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=w*_+A*f,s[1]=x*_+z*f,s[2]=T*_+B*f,s[3]=C*_+U*f,s[4]=A*_-w*f,s[5]=z*_-x*f,s[6]=B*_-T*f,s[7]=U*_-C*f,s},d.ae=function(s){var r=new Ol(16);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=s[3],r[4]=s[4],r[5]=s[5],r[6]=s[6],r[7]=s[7],r[8]=s[8],r[9]=s[9],r[10]=s[10],r[11]=s[11],r[12]=s[12],r[13]=s[13],r[14]=s[14],r[15]=s[15],r},d.af=Gh,d.ag=function(s,r){let c=0,f=0;if(s.kind==="constant")f=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:_,minZoom:w,maxZoom:x}=s,T=_?Se(vr.interpolationFactor(_,r,w,x),0,1):0;s.kind==="camera"?f=br.number(s.minSize,s.maxSize,T):c=T}return{uSizeT:c,uSize:f}},d.ai=function(s,{uSize:r,uSizeT:c},{lowerSize:f,upperSize:_}){return s.kind==="source"?f/Zo:s.kind==="composite"?br.number(f/Zo,_/Zo,c):r},d.aj=Of,d.ak=function(s,r,c,f){const _=r.y-s.y,w=r.x-s.x,x=f.y-c.y,T=f.x-c.x,C=x*w-T*_;if(C===0)return null;const A=(T*(s.y-c.y)-x*(s.x-c.x))/C;return new S(s.x+A*w,s.y+A*_)},d.al=y_,d.am=sm,d.an=bf,d.ao=function(s){let r=1/0,c=1/0,f=-1/0,_=-1/0;for(const w of s)r=Math.min(r,w.x),c=Math.min(c,w.y),f=Math.max(f,w.x),_=Math.max(_,w.y);return[r,c,f,_]},d.ap=Rn,d.ar=Bf,d.as=function(s,r){var c=r[0],f=r[1],_=r[2],w=r[3],x=r[4],T=r[5],C=r[6],A=r[7],z=r[8],B=r[9],U=r[10],W=r[11],ie=r[12],oe=r[13],_e=r[14],ve=r[15],Ge=c*T-f*x,Ae=c*C-_*x,Oe=c*A-w*x,Je=f*C-_*T,gt=f*A-w*T,Mt=_*A-w*C,Kt=z*oe-B*ie,Ct=z*_e-U*ie,Tt=z*ve-W*ie,$t=B*_e-U*oe,Rt=B*ve-W*oe,Pt=U*ve-W*_e,tt=Ge*Pt-Ae*Rt+Oe*$t+Je*Tt-gt*Ct+Mt*Kt;return tt?(s[0]=(T*Pt-C*Rt+A*$t)*(tt=1/tt),s[1]=(_*Rt-f*Pt-w*$t)*tt,s[2]=(oe*Mt-_e*gt+ve*Je)*tt,s[3]=(U*gt-B*Mt-W*Je)*tt,s[4]=(C*Tt-x*Pt-A*Ct)*tt,s[5]=(c*Pt-_*Tt+w*Ct)*tt,s[6]=(_e*Oe-ie*Mt-ve*Ae)*tt,s[7]=(z*Mt-U*Oe+W*Ae)*tt,s[8]=(x*Rt-T*Tt+A*Kt)*tt,s[9]=(f*Tt-c*Rt-w*Kt)*tt,s[10]=(ie*gt-oe*Oe+ve*Ge)*tt,s[11]=(B*Oe-z*gt-W*Ge)*tt,s[12]=(T*Ct-x*$t-C*Kt)*tt,s[13]=(c*$t-f*Ct+_*Kt)*tt,s[14]=(oe*Ae-ie*Je-_e*Ge)*tt,s[15]=(z*Je-B*Ae+U*Ge)*tt,s):null},d.at=Gf,d.au=Ff,d.av=Wf,d.aw=function(){const s={},r=Te.$version;for(const c in Te.$root){const f=Te.$root[c];if(f.required){let _=null;_=c==="version"?r:f.type==="array"?[]:{},_!=null&&(s[c]=_)}}return s},d.ax=nu,d.ay=si,d.az=function(s){s=s.slice();const r=Object.create(null);for(let c=0;c<s.length;c++)r[s[c].id]=s[c];for(let c=0;c<s.length;c++)"ref"in s[c]&&(s[c]=yt(s[c],r[s[c].ref]));return s},d.b=it,d.b0=function(s,r){return s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15],s},d.b1=function(s,r,c){return s[0]=r[0]*c[0],s[1]=r[1]*c[1],s[2]=r[2]*c[2],s[3]=r[3]*c[3],s},d.b2=function(s,r){return s[0]*r[0]+s[1]*r[1]+s[2]*r[2]+s[3]*r[3]},d.b3=Le,d.b4=h_,d.b5=c_,d.b6=function(s,r,c,f,_){var w,x=1/Math.tan(r/2);return s[0]=x/c,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=x,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,_!=null&&_!==1/0?(s[10]=(_+f)*(w=1/(f-_)),s[14]=2*_*f*w):(s[10]=-1,s[14]=-2*f),s},d.b7=function(s,r,c){var f=Math.sin(c),_=Math.cos(c),w=r[4],x=r[5],T=r[6],C=r[7],A=r[8],z=r[9],B=r[10],U=r[11];return r!==s&&(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[4]=w*_+A*f,s[5]=x*_+z*f,s[6]=T*_+B*f,s[7]=C*_+U*f,s[8]=A*_-w*f,s[9]=z*_-x*f,s[10]=B*_-T*f,s[11]=U*_-C*f,s},d.b8=K,d.b9=le,d.bA=Bm,d.bB=function(s){return s.message===et},d.bC=Rs,d.bD=Or,d.ba=function(s){return s*Math.PI/180},d.bb=function(s,r){const{x:c,y:f}=ku.fromLngLat(r);return!(s<0||s>25||f<0||f>=1||c<0||c>=1)},d.bc=function(s,r){return s[0]=r[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=r[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=r[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},d.bd=class extends D{},d.be=$f,d.bf=Ev,d.bh=ai,d.bi=function(s,r){Bt.REGISTERED_PROTOCOLS[s]=r},d.bj=function(s){delete Bt.REGISTERED_PROTOCOLS[s]},d.bk=function(s,r){const c={};for(let _=0;_<s.length;_++){const w=r&&r[s[_].id]||Mh(s[_]);r&&(r[s[_].id]=w);let x=c[w];x||(x=c[w]=[]),x.push(s[_])}const f=[];for(const _ in c)f.push(c[_]);return f},d.bl=zt,d.bm=f_,d.bn=m_,d.bo=Gm,d.bp=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=An/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const r=s.bucket.layers[0],c=r.layout,f=r._unevaluatedLayout._values,_={layoutIconSize:f["icon-size"].possiblyEvaluate(new Yi(s.bucket.zoom+1),s.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new Yi(s.bucket.zoom+1),s.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new Yi(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:A,maxZoom:z}=s.bucket.textSizeData;_.compositeTextSizes=[f["text-size"].possiblyEvaluate(new Yi(A),s.canonical),f["text-size"].possiblyEvaluate(new Yi(z),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:A,maxZoom:z}=s.bucket.iconSizeData;_.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new Yi(A),s.canonical),f["icon-size"].possiblyEvaluate(new Yi(z),s.canonical)]}const w=c.get("text-line-height")*Rn,x=c.get("text-rotation-alignment")!=="viewport"&&c.get("symbol-placement")!=="point",T=c.get("text-keep-upright"),C=c.get("text-size");for(const A of s.bucket.features){const z=c.get("text-font").evaluate(A,{},s.canonical).join(","),B=C.evaluate(A,{},s.canonical),U=_.layoutTextSize.evaluate(A,{},s.canonical),W=_.layoutIconSize.evaluate(A,{},s.canonical),ie={horizontal:{},vertical:void 0},oe=A.text;let _e,ve=[0,0];if(oe){const Oe=oe.toString(),Je=c.get("text-letter-spacing").evaluate(A,{},s.canonical)*Rn,gt=lf(Oe)?Je:0,Mt=c.get("text-anchor").evaluate(A,{},s.canonical),Kt=C_(r,A,s.canonical);if(!Kt){const Rt=c.get("text-radial-offset").evaluate(A,{},s.canonical);ve=Rt?I_(Mt,[Rt*Rn,Zf]):c.get("text-offset").evaluate(A,{},s.canonical).map(Pt=>Pt*Rn)}let Ct=x?"center":c.get("text-justify").evaluate(A,{},s.canonical);const Tt=c.get("symbol-placement")==="point"?c.get("text-max-width").evaluate(A,{},s.canonical)*Rn:1/0,$t=()=>{s.bucket.allowVerticalPlacement&&ru(Oe)&&(ie.vertical=Yh(oe,s.glyphMap,s.glyphPositions,s.imagePositions,z,Tt,w,Mt,"left",gt,ve,d.ah.vertical,!0,U,B))};if(!x&&Kt){const Rt=new Set;if(Ct==="auto")for(let tt=0;tt<Kt.values.length;tt+=2)Rt.add(Gf(Kt.values[tt]));else Rt.add(Ct);let Pt=!1;for(const tt of Rt)if(!ie.horizontal[tt])if(Pt)ie.horizontal[tt]=ie.horizontal[0];else{const Zt=Yh(oe,s.glyphMap,s.glyphPositions,s.imagePositions,z,Tt,w,"center",tt,gt,ve,d.ah.horizontal,!1,U,B);Zt&&(ie.horizontal[tt]=Zt,Pt=Zt.positionedLines.length===1)}$t()}else{Ct==="auto"&&(Ct=Gf(Mt));const Rt=Yh(oe,s.glyphMap,s.glyphPositions,s.imagePositions,z,Tt,w,Mt,Ct,gt,ve,d.ah.horizontal,!1,U,B);Rt&&(ie.horizontal[Ct]=Rt),$t(),ru(Oe)&&x&&T&&(ie.vertical=Yh(oe,s.glyphMap,s.glyphPositions,s.imagePositions,z,Tt,w,Mt,Ct,gt,ve,d.ah.vertical,!1,U,B))}}let Ge=!1;if(A.icon&&A.icon.name){const Oe=s.imageMap[A.icon.name];Oe&&(_e=uv(s.imagePositions[A.icon.name],c.get("icon-offset").evaluate(A,{},s.canonical),c.get("icon-anchor").evaluate(A,{},s.canonical)),Ge=!!Oe.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=Ge:s.bucket.sdfIcons!==Ge&&We("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Oe.pixelRatio!==s.bucket.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const Ae=L_(ie.horizontal)||ie.vertical;s.bucket.iconsInText=!!Ae&&Ae.iconsInText,(Ae||_e)&&Iv(s.bucket,A,ie,_e,s.imageMap,_,U,W,ve,Ge,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},d.bq=Mf,d.br=Cf,d.bs=Lf,d.bt=Ys,d.bu=Pf,d.bv=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},d.bw=function(s,r,c,f,_){return a(this,void 0,void 0,function*(){if(G())try{return yield Ft(s,r,c,f,_)}catch{}return function(w,x,T,C,A){const z=w.width,B=w.height;jt&&ut||(jt=new OffscreenCanvas(z,B),ut=jt.getContext("2d",{willReadFrequently:!0})),jt.width=z,jt.height=B,ut.drawImage(w,0,0,z,B);const U=ut.getImageData(x,T,C,A);return ut.clearRect(0,0,z,B),U.data}(s,r,c,f,_)})},d.bx=d_,d.by=g,d.bz=b,d.c=at,d.d=s=>a(void 0,void 0,void 0,function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const r=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(r)}catch(c){throw new Error(`Could not load image because of ${c.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),d.e=te,d.f=s=>new Promise((r,c)=>{const f=new Image;f.onload=()=>{r(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=Qe})},f.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(s)],{type:"image/png"});f.src=s.byteLength?URL.createObjectURL(_):Qe}),d.g=Dt,d.h=(s,r)=>Si(te(s,{type:"json"}),r),d.i=ze,d.j=qe,d.k=lt,d.l=(s,r)=>Si(te(s,{type:"arrayBuffer"}),r),d.m=Si,d.n=function(s){return new Pf(s).readFields(nv,[])},d.o=fu,d.p=Zm,d.q=v,d.r=sf,d.s=Ri,d.t=tu,d.u=ss,d.v=Te,d.w=We,d.x=function([s,r,c]){return r+=90,r*=Math.PI/180,c*=Math.PI/180,{x:s*Math.cos(r)*Math.sin(c),y:s*Math.sin(r)*Math.sin(c),z:s*Math.cos(c)}},d.y=br,d.z=Yi}),l("worker",["./shared"],function(d){class a{constructor(q){this.keyCache={},q&&this.replace(q)}replace(q){this._layerConfigs={},this._layers={},this.update(q,[])}update(q,V){for(const pe of q){this._layerConfigs[pe.id]=pe;const Me=this._layers[pe.id]=d.aA(pe);Me._featureFilter=d.a7(Me.filter),this.keyCache[pe.id]&&delete this.keyCache[pe.id]}for(const pe of V)delete this.keyCache[pe],delete this._layerConfigs[pe],delete this._layers[pe];this.familiesBySource={};const re=d.bk(Object.values(this._layerConfigs),this.keyCache);for(const pe of re){const Me=pe.map(Ne=>this._layers[Ne.id]),De=Me[0];if(De.visibility==="none")continue;const $e=De.source||"";let j=this.familiesBySource[$e];j||(j=this.familiesBySource[$e]={});const Fe=De.sourceLayer||"_geojsonTileLayer";let Ke=j[Fe];Ke||(Ke=j[Fe]=[]),Ke.push(Me)}}}class g{constructor(q){const V={},re=[];for(const $e in q){const j=q[$e],Fe=V[$e]={};for(const Ke in j){const Ne=j[+Ke];if(!Ne||Ne.bitmap.width===0||Ne.bitmap.height===0)continue;const Xe={x:0,y:0,w:Ne.bitmap.width+2,h:Ne.bitmap.height+2};re.push(Xe),Fe[Ke]={rect:Xe,metrics:Ne.metrics}}}const{w:pe,h:Me}=d.p(re),De=new d.o({width:pe||1,height:Me||1});for(const $e in q){const j=q[$e];for(const Fe in j){const Ke=j[+Fe];if(!Ke||Ke.bitmap.width===0||Ke.bitmap.height===0)continue;const Ne=V[$e][Fe].rect;d.o.copy(Ke.bitmap,De,{x:0,y:0},{x:Ne.x+1,y:Ne.y+1},Ke.bitmap)}}this.image=De,this.positions=V}}d.bl("GlyphAtlas",g);class b{constructor(q){this.tileID=new d.S(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.uid=q.uid,this.zoom=q.zoom,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=q.showCollisionBoxes,this.collectResourceTiming=!!q.collectResourceTiming,this.returnDependencies=!!q.returnDependencies,this.promoteId=q.promoteId,this.inFlightDependencies=[]}parse(q,V,re,pe){return d._(this,void 0,void 0,function*(){this.status="parsing",this.data=q,this.collisionBoxArray=new d.a5;const Me=new d.bm(Object.keys(q.layers).sort()),De=new d.bn(this.tileID,this.promoteId);De.bucketLayerIDs=[];const $e={},j={featureIndex:De,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:re},Fe=V.familiesBySource[this.source];for(const _i in Fe){const Ui=q.layers[_i];if(!Ui)continue;Ui.version===1&&d.w(`Vector tile source "${this.source}" layer "${_i}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const on=Me.encode(_i),Nn=[];for(let Gn=0;Gn<Ui.length;Gn++){const ur=Ui.feature(Gn),Ss=De.getId(ur,_i);Nn.push({feature:ur,id:Ss,index:Gn,sourceLayerIndex:on})}for(const Gn of Fe[_i]){const ur=Gn[0];ur.source!==this.source&&d.w(`layer.source = ${ur.source} does not equal this.source = ${this.source}`),ur.minzoom&&this.zoom<Math.floor(ur.minzoom)||ur.maxzoom&&this.zoom>=ur.maxzoom||ur.visibility!=="none"&&(k(Gn,this.zoom,re),($e[ur.id]=ur.createBucket({index:De.bucketLayerIDs.length,layers:Gn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:on,sourceID:this.source})).populate(Nn,j,this.tileID.canonical),De.bucketLayerIDs.push(Gn.map(Ss=>Ss.id)))}}const Ke=d.aF(j.glyphDependencies,_i=>Object.keys(_i).map(Number));this.inFlightDependencies.forEach(_i=>_i==null?void 0:_i.abort()),this.inFlightDependencies=[];let Ne=Promise.resolve({});if(Object.keys(Ke).length){const _i=new AbortController;this.inFlightDependencies.push(_i),Ne=pe.sendAsync({type:"GG",data:{stacks:Ke,source:this.source,tileID:this.tileID,type:"glyphs"}},_i)}const Xe=Object.keys(j.iconDependencies);let _t=Promise.resolve({});if(Xe.length){const _i=new AbortController;this.inFlightDependencies.push(_i),_t=pe.sendAsync({type:"GI",data:{icons:Xe,source:this.source,tileID:this.tileID,type:"icons"}},_i)}const Et=Object.keys(j.patternDependencies);let pi=Promise.resolve({});if(Et.length){const _i=new AbortController;this.inFlightDependencies.push(_i),pi=pe.sendAsync({type:"GI",data:{icons:Et,source:this.source,tileID:this.tileID,type:"patterns"}},_i)}const[Qt,ci,xi]=yield Promise.all([Ne,_t,pi]),Ln=new g(Qt),hn=new d.bo(ci,xi);for(const _i in $e){const Ui=$e[_i];Ui instanceof d.a6?(k(Ui.layers,this.zoom,re),d.bp({bucket:Ui,glyphMap:Qt,glyphPositions:Ln.positions,imageMap:ci,imagePositions:hn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ui.hasPattern&&(Ui instanceof d.bq||Ui instanceof d.br||Ui instanceof d.bs)&&(k(Ui.layers,this.zoom,re),Ui.addFeatures(j,this.tileID.canonical,hn.patternPositions))}return this.status="done",{buckets:Object.values($e).filter(_i=>!_i.isEmpty()),featureIndex:De,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ln.image,imageAtlas:hn,glyphMap:this.returnDependencies?Qt:null,iconMap:this.returnDependencies?ci:null,glyphPositions:this.returnDependencies?Ln.positions:null}})}}function k(ye,q,V){const re=new d.z(q);for(const pe of ye)pe.recalculate(re,V)}class S{constructor(q,V,re){this.actor=q,this.layerIndex=V,this.availableImages=re,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(q,V){return d._(this,void 0,void 0,function*(){const re=yield d.l(q.request,V);try{return{vectorTile:new d.bt.VectorTile(new d.bu(re.data)),rawData:re.data,cacheControl:re.cacheControl,expires:re.expires}}catch(pe){const Me=new Uint8Array(re.data);let De=`Unable to parse the tile at ${q.request.url}, `;throw De+=Me[0]===31&&Me[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${pe.message}`,new Error(De)}})}loadTile(q){return d._(this,void 0,void 0,function*(){const V=q.uid,re=!!(q&&q.request&&q.request.collectResourceTiming)&&new d.bv(q.request),pe=new b(q);this.loading[V]=pe;const Me=new AbortController;pe.abort=Me;try{const De=yield this.loadVectorTile(q,Me);if(delete this.loading[V],!De)return null;const $e=De.rawData,j={};De.expires&&(j.expires=De.expires),De.cacheControl&&(j.cacheControl=De.cacheControl);const Fe={};if(re){const Ne=re.finish();Ne&&(Fe.resourceTiming=JSON.parse(JSON.stringify(Ne)))}pe.vectorTile=De.vectorTile;const Ke=pe.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[V]=pe,this.fetching[V]={rawTileData:$e,cacheControl:j,resourceTiming:Fe};try{const Ne=yield Ke;return d.e({rawTileData:$e.slice(0)},Ne,j,Fe)}finally{delete this.fetching[V]}}catch(De){throw delete this.loading[V],pe.status="done",this.loaded[V]=pe,De}})}reloadTile(q){return d._(this,void 0,void 0,function*(){const V=q.uid;if(!this.loaded||!this.loaded[V])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const re=this.loaded[V];if(re.showCollisionBoxes=q.showCollisionBoxes,re.status==="parsing"){const pe=yield re.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor);let Me;if(this.fetching[V]){const{rawTileData:De,cacheControl:$e,resourceTiming:j}=this.fetching[V];delete this.fetching[V],Me=d.e({rawTileData:De.slice(0)},pe,$e,j)}else Me=pe;return Me}if(re.status==="done"&&re.vectorTile)return re.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(q){return d._(this,void 0,void 0,function*(){const V=this.loading,re=q.uid;V&&V[re]&&V[re].abort&&(V[re].abort.abort(),delete V[re])})}removeTile(q){return d._(this,void 0,void 0,function*(){this.loaded&&this.loaded[q.uid]&&delete this.loaded[q.uid]})}}class L{constructor(){this.loaded={}}loadTile(q){return d._(this,void 0,void 0,function*(){const{uid:V,encoding:re,rawImageData:pe,redFactor:Me,greenFactor:De,blueFactor:$e,baseShift:j}=q,Fe=pe.width+2,Ke=pe.height+2,Ne=d.b(pe)?new d.R({width:Fe,height:Ke},yield d.bw(pe,-1,-1,Fe,Ke)):pe,Xe=new d.bx(V,Ne,re,Me,De,$e,j);return this.loaded=this.loaded||{},this.loaded[V]=Xe,Xe})}removeTile(q){const V=this.loaded,re=q.uid;V&&V[re]&&delete V[re]}}function P(ye,q){if(ye.length!==0){R(ye[0],q);for(var V=1;V<ye.length;V++)R(ye[V],!q)}}function R(ye,q){for(var V=0,re=0,pe=0,Me=ye.length,De=Me-1;pe<Me;De=pe++){var $e=(ye[pe][0]-ye[De][0])*(ye[De][1]+ye[pe][1]),j=V+$e;re+=Math.abs(V)>=Math.abs($e)?V-j+$e:$e-j+V,V=j}V+re>=0!=!!q&&ye.reverse()}var Z=d.by(function ye(q,V){var re,pe=q&&q.type;if(pe==="FeatureCollection")for(re=0;re<q.features.length;re++)ye(q.features[re],V);else if(pe==="GeometryCollection")for(re=0;re<q.geometries.length;re++)ye(q.geometries[re],V);else if(pe==="Feature")ye(q.geometry,V);else if(pe==="Polygon")P(q.coordinates,V);else if(pe==="MultiPolygon")for(re=0;re<q.coordinates.length;re++)P(q.coordinates[re],V);return q});const $=d.bt.VectorTileFeature.prototype.toGeoJSON;var H={exports:{}},G=d.bz,K=d.bt.VectorTileFeature,le=Se;function Se(ye,q){this.options=q||{},this.features=ye,this.length=ye.length}function Le(ye,q){this.id=typeof ye.id=="number"?ye.id:void 0,this.type=ye.type,this.rawGeometry=ye.type===1?[ye.geometry]:ye.geometry,this.properties=ye.tags,this.extent=q||4096}Se.prototype.feature=function(ye){return new Le(this.features[ye],this.options.extent)},Le.prototype.loadGeometry=function(){var ye=this.rawGeometry;this.geometry=[];for(var q=0;q<ye.length;q++){for(var V=ye[q],re=[],pe=0;pe<V.length;pe++)re.push(new G(V[pe][0],V[pe][1]));this.geometry.push(re)}return this.geometry},Le.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ye=this.geometry,q=1/0,V=-1/0,re=1/0,pe=-1/0,Me=0;Me<ye.length;Me++)for(var De=ye[Me],$e=0;$e<De.length;$e++){var j=De[$e];q=Math.min(q,j.x),V=Math.max(V,j.x),re=Math.min(re,j.y),pe=Math.max(pe,j.y)}return[q,re,V,pe]},Le.prototype.toGeoJSON=K.prototype.toGeoJSON;var te=d.bA,Y=le;function ue(ye){var q=new te;return function(V,re){for(var pe in V.layers)re.writeMessage(3,fe,V.layers[pe])}(ye,q),q.finish()}function fe(ye,q){var V;q.writeVarintField(15,ye.version||1),q.writeStringField(1,ye.name||""),q.writeVarintField(5,ye.extent||4096);var re={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<ye.length;V++)re.feature=ye.feature(V),q.writeMessage(2,ce,re);var pe=re.keys;for(V=0;V<pe.length;V++)q.writeStringField(3,pe[V]);var Me=re.values;for(V=0;V<Me.length;V++)q.writeMessage(4,rt,Me[V])}function ce(ye,q){var V=ye.feature;V.id!==void 0&&q.writeVarintField(1,V.id),q.writeMessage(2,ae,ye),q.writeVarintField(3,V.type),q.writeMessage(4,ze,V)}function ae(ye,q){var V=ye.feature,re=ye.keys,pe=ye.values,Me=ye.keycache,De=ye.valuecache;for(var $e in V.properties){var j=V.properties[$e],Fe=Me[$e];if(j!==null){Fe===void 0&&(re.push($e),Me[$e]=Fe=re.length-1),q.writeVarint(Fe);var Ke=typeof j;Ke!=="string"&&Ke!=="boolean"&&Ke!=="number"&&(j=JSON.stringify(j));var Ne=Ke+":"+j,Xe=De[Ne];Xe===void 0&&(pe.push(j),De[Ne]=Xe=pe.length-1),q.writeVarint(Xe)}}}function We(ye,q){return(q<<3)+(7&ye)}function Ee(ye){return ye<<1^ye>>31}function ze(ye,q){for(var V=ye.loadGeometry(),re=ye.type,pe=0,Me=0,De=V.length,$e=0;$e<De;$e++){var j=V[$e],Fe=1;re===1&&(Fe=j.length),q.writeVarint(We(1,Fe));for(var Ke=re===3?j.length-1:j.length,Ne=0;Ne<Ke;Ne++){Ne===1&&re!==1&&q.writeVarint(We(2,Ke-1));var Xe=j[Ne].x-pe,_t=j[Ne].y-Me;q.writeVarint(Ee(Xe)),q.writeVarint(Ee(_t)),pe+=Xe,Me+=_t}re===3&&q.writeVarint(We(7,1))}}function rt(ye,q){var V=typeof ye;V==="string"?q.writeStringField(1,ye):V==="boolean"?q.writeBooleanField(7,ye):V==="number"&&(ye%1!=0?q.writeDoubleField(3,ye):ye<0?q.writeSVarintField(6,ye):q.writeVarintField(5,ye))}H.exports=ue,H.exports.fromVectorTileJs=ue,H.exports.fromGeojsonVt=function(ye,q){q=q||{};var V={};for(var re in ye)V[re]=new Y(ye[re].features,q),V[re].name=re,V[re].version=q.version,V[re].extent=q.extent;return ue({layers:V})},H.exports.GeoJSONWrapper=Y;var it=d.by(H.exports);const Qe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ye=>ye},Ft=Math.fround||(jt=new Float32Array(1),ye=>(jt[0]=+ye,jt[0]));var jt;const ut=3,et=5,at=6;class Bt{constructor(q){this.options=Object.assign(Object.create(Qe),q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(q){const{log:V,minZoom:re,maxZoom:pe}=this.options;V&&console.time("total time");const Me=`prepare ${q.length} points`;V&&console.time(Me),this.points=q;const De=[];for(let j=0;j<q.length;j++){const Fe=q[j];if(!Fe.geometry)continue;const[Ke,Ne]=Fe.geometry.coordinates,Xe=Ft(ai(Ke)),_t=Ft(si(Ne));De.push(Xe,_t,1/0,j,-1,1),this.options.reduce&&De.push(0)}let $e=this.trees[pe+1]=this._createTree(De);V&&console.timeEnd(Me);for(let j=pe;j>=re;j--){const Fe=+Date.now();$e=this.trees[j]=this._createTree(this._cluster($e,j)),V&&console.log("z%d: %d clusters in %dms",j,$e.numItems,+Date.now()-Fe)}return V&&console.timeEnd("total time"),this}getClusters(q,V){let re=((q[0]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,q[1]));let Me=q[2]===180?180:((q[2]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)re=-180,Me=180;else if(re>Me){const Ne=this.getClusters([re,pe,180,De],V),Xe=this.getClusters([-180,pe,Me,De],V);return Ne.concat(Xe)}const $e=this.trees[this._limitZoom(V)],j=$e.range(ai(re),si(De),ai(Me),si(pe)),Fe=$e.data,Ke=[];for(const Ne of j){const Xe=this.stride*Ne;Ke.push(Fe[Xe+et]>1?Dt(Fe,Xe,this.clusterProps):this.points[Fe[Xe+ut]])}return Ke}getChildren(q){const V=this._getOriginId(q),re=this._getOriginZoom(q),pe="No cluster with the specified id.",Me=this.trees[re];if(!Me)throw new Error(pe);const De=Me.data;if(V*this.stride>=De.length)throw new Error(pe);const $e=this.options.radius/(this.options.extent*Math.pow(2,re-1)),j=Me.within(De[V*this.stride],De[V*this.stride+1],$e),Fe=[];for(const Ke of j){const Ne=Ke*this.stride;De[Ne+4]===q&&Fe.push(De[Ne+et]>1?Dt(De,Ne,this.clusterProps):this.points[De[Ne+ut]])}if(Fe.length===0)throw new Error(pe);return Fe}getLeaves(q,V,re){const pe=[];return this._appendLeaves(pe,q,V=V||10,re=re||0,0),pe}getTile(q,V,re){const pe=this.trees[this._limitZoom(q)],Me=Math.pow(2,q),{extent:De,radius:$e}=this.options,j=$e/De,Fe=(re-j)/Me,Ke=(re+1+j)/Me,Ne={features:[]};return this._addTileFeatures(pe.range((V-j)/Me,Fe,(V+1+j)/Me,Ke),pe.data,V,re,Me,Ne),V===0&&this._addTileFeatures(pe.range(1-j/Me,Fe,1,Ke),pe.data,Me,re,Me,Ne),V===Me-1&&this._addTileFeatures(pe.range(0,Fe,j/Me,Ke),pe.data,-1,re,Me,Ne),Ne.features.length?Ne:null}getClusterExpansionZoom(q){let V=this._getOriginZoom(q)-1;for(;V<=this.options.maxZoom;){const re=this.getChildren(q);if(V++,re.length!==1)break;q=re[0].properties.cluster_id}return V}_appendLeaves(q,V,re,pe,Me){const De=this.getChildren(V);for(const $e of De){const j=$e.properties;if(j&&j.cluster?Me+j.point_count<=pe?Me+=j.point_count:Me=this._appendLeaves(q,j.cluster_id,re,pe,Me):Me<pe?Me++:q.push($e),q.length===re)break}return Me}_createTree(q){const V=new d.av(q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let re=0;re<q.length;re+=this.stride)V.add(q[re],q[re+1]);return V.finish(),V.data=q,V}_addTileFeatures(q,V,re,pe,Me,De){for(const $e of q){const j=$e*this.stride,Fe=V[j+et]>1;let Ke,Ne,Xe;if(Fe)Ke=Ht(V,j,this.clusterProps),Ne=V[j],Xe=V[j+1];else{const pi=this.points[V[j+ut]];Ke=pi.properties;const[Qt,ci]=pi.geometry.coordinates;Ne=ai(Qt),Xe=si(ci)}const _t={type:1,geometry:[[Math.round(this.options.extent*(Ne*Me-re)),Math.round(this.options.extent*(Xe*Me-pe))]],tags:Ke};let Et;Et=Fe||this.options.generateId?V[j+ut]:this.points[V[j+ut]].id,Et!==void 0&&(_t.id=Et),De.features.push(_t)}}_limitZoom(q){return Math.max(this.options.minZoom,Math.min(Math.floor(+q),this.options.maxZoom+1))}_cluster(q,V){const{radius:re,extent:pe,reduce:Me,minPoints:De}=this.options,$e=re/(pe*Math.pow(2,V)),j=q.data,Fe=[],Ke=this.stride;for(let Ne=0;Ne<j.length;Ne+=Ke){if(j[Ne+2]<=V)continue;j[Ne+2]=V;const Xe=j[Ne],_t=j[Ne+1],Et=q.within(j[Ne],j[Ne+1],$e),pi=j[Ne+et];let Qt=pi;for(const ci of Et){const xi=ci*Ke;j[xi+2]>V&&(Qt+=j[xi+et])}if(Qt>pi&&Qt>=De){let ci,xi=Xe*pi,Ln=_t*pi,hn=-1;const _i=((Ne/Ke|0)<<5)+(V+1)+this.points.length;for(const Ui of Et){const on=Ui*Ke;if(j[on+2]<=V)continue;j[on+2]=V;const Nn=j[on+et];xi+=j[on]*Nn,Ln+=j[on+1]*Nn,j[on+4]=_i,Me&&(ci||(ci=this._map(j,Ne,!0),hn=this.clusterProps.length,this.clusterProps.push(ci)),Me(ci,this._map(j,on)))}j[Ne+4]=_i,Fe.push(xi/Qt,Ln/Qt,1/0,_i,-1,Qt),Me&&Fe.push(hn)}else{for(let ci=0;ci<Ke;ci++)Fe.push(j[Ne+ci]);if(Qt>1)for(const ci of Et){const xi=ci*Ke;if(!(j[xi+2]<=V)){j[xi+2]=V;for(let Ln=0;Ln<Ke;Ln++)Fe.push(j[xi+Ln])}}}}return Fe}_getOriginId(q){return q-this.points.length>>5}_getOriginZoom(q){return(q-this.points.length)%32}_map(q,V,re){if(q[V+et]>1){const De=this.clusterProps[q[V+at]];return re?Object.assign({},De):De}const pe=this.points[q[V+ut]].properties,Me=this.options.map(pe);return re&&Me===pe?Object.assign({},Me):Me}}function Dt(ye,q,V){return{type:"Feature",id:ye[q+ut],properties:Ht(ye,q,V),geometry:{type:"Point",coordinates:[(re=ye[q],360*(re-.5)),Si(ye[q+1])]}};var re}function Ht(ye,q,V){const re=ye[q+et],pe=re>=1e4?`${Math.round(re/1e3)}k`:re>=1e3?Math.round(re/100)/10+"k":re,Me=ye[q+at],De=Me===-1?{}:Object.assign({},V[Me]);return Object.assign(De,{cluster:!0,cluster_id:ye[q+ut],point_count:re,point_count_abbreviated:pe})}function ai(ye){return ye/360+.5}function si(ye){const q=Math.sin(ye*Math.PI/180),V=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return V<0?0:V>1?1:V}function Si(ye){const q=(180-360*ye)*Math.PI/180;return 360*Math.atan(Math.exp(q))/Math.PI-90}function Ri(ye,q,V,re){let pe=re;const Me=q+(V-q>>1);let De,$e=V-q;const j=ye[q],Fe=ye[q+1],Ke=ye[V],Ne=ye[V+1];for(let Xe=q+3;Xe<V;Xe+=3){const _t=vi(ye[Xe],ye[Xe+1],j,Fe,Ke,Ne);if(_t>pe)De=Xe,pe=_t;else if(_t===pe){const Et=Math.abs(Xe-Me);Et<$e&&(De=Xe,$e=Et)}}pe>re&&(De-q>3&&Ri(ye,q,De,re),ye[De+2]=pe,V-De>3&&Ri(ye,De,V,re))}function vi(ye,q,V,re,pe,Me){let De=pe-V,$e=Me-re;if(De!==0||$e!==0){const j=((ye-V)*De+(q-re)*$e)/(De*De+$e*$e);j>1?(V=pe,re=Me):j>0&&(V+=De*j,re+=$e*j)}return De=ye-V,$e=q-re,De*De+$e*$e}function di(ye,q,V,re){const pe={id:ye??null,type:q,geometry:V,tags:re,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(q==="Point"||q==="MultiPoint"||q==="LineString")lt(pe,V);else if(q==="Polygon")lt(pe,V[0]);else if(q==="MultiLineString")for(const Me of V)lt(pe,Me);else if(q==="MultiPolygon")for(const Me of V)lt(pe,Me[0]);return pe}function lt(ye,q){for(let V=0;V<q.length;V+=3)ye.minX=Math.min(ye.minX,q[V]),ye.minY=Math.min(ye.minY,q[V+1]),ye.maxX=Math.max(ye.maxX,q[V]),ye.maxY=Math.max(ye.maxY,q[V+1])}function qe(ye,q,V,re){if(!q.geometry)return;const pe=q.geometry.coordinates;if(pe&&pe.length===0)return;const Me=q.geometry.type,De=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2);let $e=[],j=q.id;if(V.promoteId?j=q.properties[V.promoteId]:V.generateId&&(j=re||0),Me==="Point")st(pe,$e);else if(Me==="MultiPoint")for(const Fe of pe)st(Fe,$e);else if(Me==="LineString")Te(pe,$e,De,!1);else if(Me==="MultiLineString"){if(V.lineMetrics){for(const Fe of pe)$e=[],Te(Fe,$e,De,!1),ye.push(di(j,"LineString",$e,q.properties));return}mt(pe,$e,De,!1)}else if(Me==="Polygon")mt(pe,$e,De,!0);else{if(Me!=="MultiPolygon"){if(Me==="GeometryCollection"){for(const Fe of q.geometry.geometries)qe(ye,{id:j,geometry:Fe,properties:q.properties},V,re);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Fe of pe){const Ke=[];mt(Fe,Ke,De,!0),$e.push(Ke)}}ye.push(di(j,Me,$e,q.properties))}function st(ye,q){q.push(yt(ye[0]),Ie(ye[1]),0)}function Te(ye,q,V,re){let pe,Me,De=0;for(let j=0;j<ye.length;j++){const Fe=yt(ye[j][0]),Ke=Ie(ye[j][1]);q.push(Fe,Ke,0),j>0&&(De+=re?(pe*Ke-Fe*Me)/2:Math.sqrt(Math.pow(Fe-pe,2)+Math.pow(Ke-Me,2))),pe=Fe,Me=Ke}const $e=q.length-3;q[2]=1,Ri(q,0,$e,V),q[$e+2]=1,q.size=Math.abs(De),q.start=0,q.end=q.size}function mt(ye,q,V,re){for(let pe=0;pe<ye.length;pe++){const Me=[];Te(ye[pe],Me,V,re),q.push(Me)}}function yt(ye){return ye/360+.5}function Ie(ye){const q=Math.sin(ye*Math.PI/180),V=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return V<0?0:V>1?1:V}function nt(ye,q,V,re,pe,Me,De,$e){if(re/=q,Me>=(V/=q)&&De<re)return ye;if(De<V||Me>=re)return null;const j=[];for(const Fe of ye){const Ke=Fe.geometry;let Ne=Fe.type;const Xe=pe===0?Fe.minX:Fe.minY,_t=pe===0?Fe.maxX:Fe.maxY;if(Xe>=V&&_t<re){j.push(Fe);continue}if(_t<V||Xe>=re)continue;let Et=[];if(Ne==="Point"||Ne==="MultiPoint")Xt(Ke,Et,V,re,pe);else if(Ne==="LineString")wi(Ke,Et,V,re,pe,!1,$e.lineMetrics);else if(Ne==="MultiLineString")Li(Ke,Et,V,re,pe,!1);else if(Ne==="Polygon")Li(Ke,Et,V,re,pe,!0);else if(Ne==="MultiPolygon")for(const pi of Ke){const Qt=[];Li(pi,Qt,V,re,pe,!0),Qt.length&&Et.push(Qt)}if(Et.length){if($e.lineMetrics&&Ne==="LineString"){for(const pi of Et)j.push(di(Fe.id,Ne,pi,Fe.tags));continue}Ne!=="LineString"&&Ne!=="MultiLineString"||(Et.length===1?(Ne="LineString",Et=Et[0]):Ne="MultiLineString"),Ne!=="Point"&&Ne!=="MultiPoint"||(Ne=Et.length===3?"Point":"MultiPoint"),j.push(di(Fe.id,Ne,Et,Fe.tags))}}return j.length?j:null}function Xt(ye,q,V,re,pe){for(let Me=0;Me<ye.length;Me+=3){const De=ye[Me+pe];De>=V&&De<=re&&gi(q,ye[Me],ye[Me+1],ye[Me+2])}}function wi(ye,q,V,re,pe,Me,De){let $e=Ni(ye);const j=pe===0?Fi:_r;let Fe,Ke,Ne=ye.start;for(let Qt=0;Qt<ye.length-3;Qt+=3){const ci=ye[Qt],xi=ye[Qt+1],Ln=ye[Qt+2],hn=ye[Qt+3],_i=ye[Qt+4],Ui=pe===0?ci:xi,on=pe===0?hn:_i;let Nn=!1;De&&(Fe=Math.sqrt(Math.pow(ci-hn,2)+Math.pow(xi-_i,2))),Ui<V?on>V&&(Ke=j($e,ci,xi,hn,_i,V),De&&($e.start=Ne+Fe*Ke)):Ui>re?on<re&&(Ke=j($e,ci,xi,hn,_i,re),De&&($e.start=Ne+Fe*Ke)):gi($e,ci,xi,Ln),on<V&&Ui>=V&&(Ke=j($e,ci,xi,hn,_i,V),Nn=!0),on>re&&Ui<=re&&(Ke=j($e,ci,xi,hn,_i,re),Nn=!0),!Me&&Nn&&(De&&($e.end=Ne+Fe*Ke),q.push($e),$e=Ni(ye)),De&&(Ne+=Fe)}let Xe=ye.length-3;const _t=ye[Xe],Et=ye[Xe+1],pi=pe===0?_t:Et;pi>=V&&pi<=re&&gi($e,_t,Et,ye[Xe+2]),Xe=$e.length-3,Me&&Xe>=3&&($e[Xe]!==$e[0]||$e[Xe+1]!==$e[1])&&gi($e,$e[0],$e[1],$e[2]),$e.length&&q.push($e)}function Ni(ye){const q=[];return q.size=ye.size,q.start=ye.start,q.end=ye.end,q}function Li(ye,q,V,re,pe,Me){for(const De of ye)wi(De,q,V,re,pe,Me,!1)}function gi(ye,q,V,re){ye.push(q,V,re)}function Fi(ye,q,V,re,pe,Me){const De=(Me-q)/(re-q);return gi(ye,Me,V+(pe-V)*De,1),De}function _r(ye,q,V,re,pe,Me){const De=(Me-V)/(pe-V);return gi(ye,q+(re-q)*De,Me,1),De}function ct(ye,q){const V=[];for(let re=0;re<ye.length;re++){const pe=ye[re],Me=pe.type;let De;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")De=Yn(pe.geometry,q);else if(Me==="MultiLineString"||Me==="Polygon"){De=[];for(const $e of pe.geometry)De.push(Yn($e,q))}else if(Me==="MultiPolygon"){De=[];for(const $e of pe.geometry){const j=[];for(const Fe of $e)j.push(Yn(Fe,q));De.push(j)}}V.push(di(pe.id,Me,De,pe.tags))}return V}function Yn(ye,q){const V=[];V.size=ye.size,ye.start!==void 0&&(V.start=ye.start,V.end=ye.end);for(let re=0;re<ye.length;re+=3)V.push(ye[re]+q,ye[re+1],ye[re+2]);return V}function un(ye,q){if(ye.transformed)return ye;const V=1<<ye.z,re=ye.x,pe=ye.y;for(const Me of ye.features){const De=Me.geometry,$e=Me.type;if(Me.geometry=[],$e===1)for(let j=0;j<De.length;j+=2)Me.geometry.push(On(De[j],De[j+1],q,V,re,pe));else for(let j=0;j<De.length;j++){const Fe=[];for(let Ke=0;Ke<De[j].length;Ke+=2)Fe.push(On(De[j][Ke],De[j][Ke+1],q,V,re,pe));Me.geometry.push(Fe)}}return ye.transformed=!0,ye}function On(ye,q,V,re,pe,Me){return[Math.round(V*(ye*re-pe)),Math.round(V*(q*re-Me))]}function qr(ye,q,V,re,pe){const Me=q===pe.maxZoom?0:pe.tolerance/((1<<q)*pe.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:ye.length,source:null,x:V,y:re,z:q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const $e of ye)vt(De,$e,Me,pe);return De}function vt(ye,q,V,re){const pe=q.geometry,Me=q.type,De=[];if(ye.minX=Math.min(ye.minX,q.minX),ye.minY=Math.min(ye.minY,q.minY),ye.maxX=Math.max(ye.maxX,q.maxX),ye.maxY=Math.max(ye.maxY,q.maxY),Me==="Point"||Me==="MultiPoint")for(let $e=0;$e<pe.length;$e+=3)De.push(pe[$e],pe[$e+1]),ye.numPoints++,ye.numSimplified++;else if(Me==="LineString")li(De,pe,ye,V,!1,!1);else if(Me==="MultiLineString"||Me==="Polygon")for(let $e=0;$e<pe.length;$e++)li(De,pe[$e],ye,V,Me==="Polygon",$e===0);else if(Me==="MultiPolygon")for(let $e=0;$e<pe.length;$e++){const j=pe[$e];for(let Fe=0;Fe<j.length;Fe++)li(De,j[Fe],ye,V,!0,Fe===0)}if(De.length){let $e=q.tags||null;if(Me==="LineString"&&re.lineMetrics){$e={};for(const Fe in q.tags)$e[Fe]=q.tags[Fe];$e.mapbox_clip_start=pe.start/pe.size,$e.mapbox_clip_end=pe.end/pe.size}const j={geometry:De,type:Me==="Polygon"||Me==="MultiPolygon"?3:Me==="LineString"||Me==="MultiLineString"?2:1,tags:$e};q.id!==null&&(j.id=q.id),ye.features.push(j)}}function li(ye,q,V,re,pe,Me){const De=re*re;if(re>0&&q.size<(pe?De:re))return void(V.numPoints+=q.length/3);const $e=[];for(let j=0;j<q.length;j+=3)(re===0||q[j+2]>De)&&(V.numSimplified++,$e.push(q[j],q[j+1])),V.numPoints++;pe&&function(j,Fe){let Ke=0;for(let Ne=0,Xe=j.length,_t=Xe-2;Ne<Xe;_t=Ne,Ne+=2)Ke+=(j[Ne]-j[_t])*(j[Ne+1]+j[_t+1]);if(Ke>0===Fe)for(let Ne=0,Xe=j.length;Ne<Xe/2;Ne+=2){const _t=j[Ne],Et=j[Ne+1];j[Ne]=j[Xe-2-Ne],j[Ne+1]=j[Xe-1-Ne],j[Xe-2-Ne]=_t,j[Xe-1-Ne]=Et}}($e,Me),ye.push($e)}const Jt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class wn{constructor(q,V){const re=(V=this.options=function(Me,De){for(const $e in De)Me[$e]=De[$e];return Me}(Object.create(Jt),V)).debug;if(re&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");let pe=function(Me,De){const $e=[];if(Me.type==="FeatureCollection")for(let j=0;j<Me.features.length;j++)qe($e,Me.features[j],De,j);else qe($e,Me.type==="Feature"?Me:{geometry:Me},De);return $e}(q,V);this.tiles={},this.tileCoords=[],re&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),pe=function(Me,De){const $e=De.buffer/De.extent;let j=Me;const Fe=nt(Me,1,-1-$e,$e,0,-1,2,De),Ke=nt(Me,1,1-$e,2+$e,0,-1,2,De);return(Fe||Ke)&&(j=nt(Me,1,-$e,1+$e,0,-1,2,De)||[],Fe&&(j=ct(Fe,1).concat(j)),Ke&&(j=j.concat(ct(Ke,-1)))),j}(pe,V),pe.length&&this.splitTile(pe,0,0,0),re&&(pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(q,V,re,pe,Me,De,$e){const j=[q,V,re,pe],Fe=this.options,Ke=Fe.debug;for(;j.length;){pe=j.pop(),re=j.pop(),V=j.pop(),q=j.pop();const Ne=1<<V,Xe=Dn(V,re,pe);let _t=this.tiles[Xe];if(!_t&&(Ke>1&&console.time("creation"),_t=this.tiles[Xe]=qr(q,V,re,pe,Fe),this.tileCoords.push({z:V,x:re,y:pe}),Ke)){Ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,re,pe,_t.numFeatures,_t.numPoints,_t.numSimplified),console.timeEnd("creation"));const Nn=`z${V}`;this.stats[Nn]=(this.stats[Nn]||0)+1,this.total++}if(_t.source=q,Me==null){if(V===Fe.indexMaxZoom||_t.numPoints<=Fe.indexMaxPoints)continue}else{if(V===Fe.maxZoom||V===Me)continue;if(Me!=null){const Nn=Me-V;if(re!==De>>Nn||pe!==$e>>Nn)continue}}if(_t.source=null,q.length===0)continue;Ke>1&&console.time("clipping");const Et=.5*Fe.buffer/Fe.extent,pi=.5-Et,Qt=.5+Et,ci=1+Et;let xi=null,Ln=null,hn=null,_i=null,Ui=nt(q,Ne,re-Et,re+Qt,0,_t.minX,_t.maxX,Fe),on=nt(q,Ne,re+pi,re+ci,0,_t.minX,_t.maxX,Fe);q=null,Ui&&(xi=nt(Ui,Ne,pe-Et,pe+Qt,1,_t.minY,_t.maxY,Fe),Ln=nt(Ui,Ne,pe+pi,pe+ci,1,_t.minY,_t.maxY,Fe),Ui=null),on&&(hn=nt(on,Ne,pe-Et,pe+Qt,1,_t.minY,_t.maxY,Fe),_i=nt(on,Ne,pe+pi,pe+ci,1,_t.minY,_t.maxY,Fe),on=null),Ke>1&&console.timeEnd("clipping"),j.push(xi||[],V+1,2*re,2*pe),j.push(Ln||[],V+1,2*re,2*pe+1),j.push(hn||[],V+1,2*re+1,2*pe),j.push(_i||[],V+1,2*re+1,2*pe+1)}}getTile(q,V,re){q=+q,V=+V,re=+re;const pe=this.options,{extent:Me,debug:De}=pe;if(q<0||q>24)return null;const $e=1<<q,j=Dn(q,V=V+$e&$e-1,re);if(this.tiles[j])return un(this.tiles[j],Me);De>1&&console.log("drilling down to z%d-%d-%d",q,V,re);let Fe,Ke=q,Ne=V,Xe=re;for(;!Fe&&Ke>0;)Ke--,Ne>>=1,Xe>>=1,Fe=this.tiles[Dn(Ke,Ne,Xe)];return Fe&&Fe.source?(De>1&&(console.log("found parent tile z%d-%d-%d",Ke,Ne,Xe),console.time("drilling down")),this.splitTile(Fe.source,Ke,Ne,Xe,q,V,re),De>1&&console.timeEnd("drilling down"),this.tiles[j]?un(this.tiles[j],Me):null):null}}function Dn(ye,q,V){return 32*((1<<ye)*V+q)+ye}function ei(ye,q){return q?ye.properties[q]:ye.id}function gr(ye,q){if(ye==null)return!0;if(ye.type==="Feature")return ei(ye,q)!=null;if(ye.type==="FeatureCollection"){const V=new Set;for(const re of ye.features){const pe=ei(re,q);if(pe==null||V.has(pe))return!1;V.add(pe)}return!0}return!1}function zr(ye,q){const V=new Map;if(ye!=null)if(ye.type==="Feature")V.set(ei(ye,q),ye);else for(const re of ye.features)V.set(ei(re,q),re);return V}class Zr extends S{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(q,V){return d._(this,void 0,void 0,function*(){const re=q.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const pe=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!pe)return null;const Me=new class{constructor($e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.X,this.length=$e.length,this._features=$e}feature($e){return new class{constructor(j){this._feature=j,this.extent=d.X,this.type=j.type,this.properties=j.tags,"id"in j&&!isNaN(j.id)&&(this.id=parseInt(j.id,10))}loadGeometry(){if(this._feature.type===1){const j=[];for(const Fe of this._feature.geometry)j.push([new d.P(Fe[0],Fe[1])]);return j}{const j=[];for(const Fe of this._feature.geometry){const Ke=[];for(const Ne of Fe)Ke.push(new d.P(Ne[0],Ne[1]));j.push(Ke)}return j}}toGeoJSON(j,Fe,Ke){return $.call(this,j,Fe,Ke)}}(this._features[$e])}}(pe.features);let De=it(Me);return De.byteOffset===0&&De.byteLength===De.buffer.byteLength||(De=new Uint8Array(De)),{vectorTile:Me,rawData:De.buffer}})}loadData(q){return d._(this,void 0,void 0,function*(){var V;(V=this._pendingRequest)===null||V===void 0||V.abort();const re=!!(q&&q.request&&q.request.collectResourceTiming)&&new d.bv(q.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(q,this._pendingRequest),this._geoJSONIndex=q.cluster?new Bt(function({superclusterOptions:De,clusterProperties:$e}){if(!$e||!De)return De;const j={},Fe={},Ke={accumulated:null,zoom:0},Ne={properties:null},Xe=Object.keys($e);for(const _t of Xe){const[Et,pi]=$e[_t],Qt=d.bC(pi),ci=d.bC(typeof Et=="string"?[Et,["accumulated"],["get",_t]]:Et);j[_t]=Qt.value,Fe[_t]=ci.value}return De.map=_t=>{Ne.properties=_t;const Et={};for(const pi of Xe)Et[pi]=j[pi].evaluate(Ke,Ne);return Et},De.reduce=(_t,Et)=>{Ne.properties=Et;for(const pi of Xe)Ke.accumulated=_t[pi],_t[pi]=Fe[pi].evaluate(Ke,Ne)},De}(q)).load((yield this._pendingData).features):(pe=yield this._pendingData,new wn(pe,q.geojsonVtOptions)),this.loaded={};const Me={};if(re){const De=re.finish();De&&(Me.resourceTiming={},Me.resourceTiming[q.source]=JSON.parse(JSON.stringify(De)))}return Me}catch(Me){if(delete this._pendingRequest,d.bB(Me))return{abandoned:!0};throw Me}var pe})}getData(){return d._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(q){const V=this.loaded;return V&&V[q.uid]?super.reloadTile(q):this.loadTile(q)}loadAndProcessGeoJSON(q,V){return d._(this,void 0,void 0,function*(){let re=yield this.loadGeoJSON(q,V);if(delete this._pendingRequest,typeof re!="object")throw new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`);if(Z(re,!0),q.filter){const pe=d.bC(q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(pe.result==="error")throw new Error(pe.value.map(De=>`${De.key}: ${De.message}`).join(", "));re={type:"FeatureCollection",features:re.features.filter(De=>pe.value.evaluate({zoom:0},De))}}return re})}loadGeoJSON(q,V){return d._(this,void 0,void 0,function*(){const{promoteId:re}=q;if(q.request){const pe=yield d.h(q.request,V);return this._dataUpdateable=gr(pe.data,re)?zr(pe.data,re):void 0,pe.data}if(typeof q.data=="string")try{const pe=JSON.parse(q.data);return this._dataUpdateable=gr(pe,re)?zr(pe,re):void 0,pe}catch{throw new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`)}if(!q.dataDiff)throw new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${q.source}`);return function(pe,Me,De){var $e,j,Fe,Ke;if(Me.removeAll&&pe.clear(),Me.remove)for(const Ne of Me.remove)pe.delete(Ne);if(Me.add)for(const Ne of Me.add){const Xe=ei(Ne,De);Xe!=null&&pe.set(Xe,Ne)}if(Me.update)for(const Ne of Me.update){let Xe=pe.get(Ne.id);if(Xe==null)continue;const _t=!Ne.removeAllProperties&&((($e=Ne.removeProperties)===null||$e===void 0?void 0:$e.length)>0||((j=Ne.addOrUpdateProperties)===null||j===void 0?void 0:j.length)>0);if((Ne.newGeometry||Ne.removeAllProperties||_t)&&(Xe=Object.assign({},Xe),pe.set(Ne.id,Xe),_t&&(Xe.properties=Object.assign({},Xe.properties))),Ne.newGeometry&&(Xe.geometry=Ne.newGeometry),Ne.removeAllProperties)Xe.properties={};else if(((Fe=Ne.removeProperties)===null||Fe===void 0?void 0:Fe.length)>0)for(const Et of Ne.removeProperties)Object.prototype.hasOwnProperty.call(Xe.properties,Et)&&delete Xe.properties[Et];if(((Ke=Ne.addOrUpdateProperties)===null||Ke===void 0?void 0:Ke.length)>0)for(const{key:Et,value:pi}of Ne.addOrUpdateProperties)Xe.properties[Et]=pi}}(this._dataUpdateable,q.dataDiff,re),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(q){return d._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(q){return this._geoJSONIndex.getClusterExpansionZoom(q.clusterId)}getClusterChildren(q){return this._geoJSONIndex.getChildren(q.clusterId)}getClusterLeaves(q){return this._geoJSONIndex.getLeaves(q.clusterId,q.limit,q.offset)}}class yr{constructor(q){this.self=q,this.actor=new d.F(q),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(V,re)=>{if(this.externalWorkerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.externalWorkerSourceTypes[V]=re},this.self.addProtocol=d.bi,this.self.removeProtocol=d.bj,this.self.registerRTLTextPlugin=V=>{if(d.bD.isParsed())throw new Error("RTL text plugin already registered.");d.bD.setMethods(V)},this.actor.registerMessageHandler("LDT",(V,re)=>this._getDEMWorkerSource(V,re.source).loadTile(re)),this.actor.registerMessageHandler("RDT",(V,re)=>d._(this,void 0,void 0,function*(){this._getDEMWorkerSource(V,re.source).removeTile(re)})),this.actor.registerMessageHandler("GCEZ",(V,re)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(V,re.type,re.source).getClusterExpansionZoom(re)})),this.actor.registerMessageHandler("GCC",(V,re)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(V,re.type,re.source).getClusterChildren(re)})),this.actor.registerMessageHandler("GCL",(V,re)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(V,re.type,re.source).getClusterLeaves(re)})),this.actor.registerMessageHandler("LD",(V,re)=>this._getWorkerSource(V,re.type,re.source).loadData(re)),this.actor.registerMessageHandler("GD",(V,re)=>this._getWorkerSource(V,re.type,re.source).getData()),this.actor.registerMessageHandler("LT",(V,re)=>this._getWorkerSource(V,re.type,re.source).loadTile(re)),this.actor.registerMessageHandler("RT",(V,re)=>this._getWorkerSource(V,re.type,re.source).reloadTile(re)),this.actor.registerMessageHandler("AT",(V,re)=>this._getWorkerSource(V,re.type,re.source).abortTile(re)),this.actor.registerMessageHandler("RMT",(V,re)=>this._getWorkerSource(V,re.type,re.source).removeTile(re)),this.actor.registerMessageHandler("RS",(V,re)=>d._(this,void 0,void 0,function*(){if(!this.workerSources[V]||!this.workerSources[V][re.type]||!this.workerSources[V][re.type][re.source])return;const pe=this.workerSources[V][re.type][re.source];delete this.workerSources[V][re.type][re.source],pe.removeSource!==void 0&&pe.removeSource(re)})),this.actor.registerMessageHandler("RM",V=>d._(this,void 0,void 0,function*(){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V]})),this.actor.registerMessageHandler("SR",(V,re)=>d._(this,void 0,void 0,function*(){this.referrer=re})),this.actor.registerMessageHandler("SRPS",(V,re)=>this._syncRTLPluginState(V,re)),this.actor.registerMessageHandler("IS",(V,re)=>d._(this,void 0,void 0,function*(){this.self.importScripts(re)})),this.actor.registerMessageHandler("SI",(V,re)=>this._setImages(V,re)),this.actor.registerMessageHandler("UL",(V,re)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(V).update(re.layers,re.removedIds)})),this.actor.registerMessageHandler("SL",(V,re)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(V).replace(re)}))}_setImages(q,V){return d._(this,void 0,void 0,function*(){this.availableImages[q]=V;for(const re in this.workerSources[q]){const pe=this.workerSources[q][re];for(const Me in pe)pe[Me].availableImages=V}})}_syncRTLPluginState(q,V){return d._(this,void 0,void 0,function*(){if(d.bD.isParsed())return d.bD.getState();if(V.pluginStatus!=="loading")return d.bD.setState(V),V;const re=V.pluginURL;if(this.self.importScripts(re),d.bD.isParsed()){const pe={pluginStatus:"loaded",pluginURL:re};return d.bD.setState(pe),pe}throw d.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${re}`)})}_getAvailableImages(q){let V=this.availableImages[q];return V||(V=[]),V}_getLayerIndex(q){let V=this.layerIndexes[q];return V||(V=this.layerIndexes[q]=new a),V}_getWorkerSource(q,V,re){if(this.workerSources[q]||(this.workerSources[q]={}),this.workerSources[q][V]||(this.workerSources[q][V]={}),!this.workerSources[q][V][re]){const pe={sendAsync:(Me,De)=>(Me.targetMapId=q,this.actor.sendAsync(Me,De))};switch(V){case"vector":this.workerSources[q][V][re]=new S(pe,this._getLayerIndex(q),this._getAvailableImages(q));break;case"geojson":this.workerSources[q][V][re]=new Zr(pe,this._getLayerIndex(q),this._getAvailableImages(q));break;default:this.workerSources[q][V][re]=new this.externalWorkerSourceTypes[V](pe,this._getLayerIndex(q),this._getAvailableImages(q))}}return this.workerSources[q][V][re]}_getDEMWorkerSource(q,V){return this.demWorkerSources[q]||(this.demWorkerSources[q]={}),this.demWorkerSources[q][V]||(this.demWorkerSources[q][V]=new L),this.demWorkerSources[q][V]}}return d.i(self)&&(self.worker=new yr(self)),yr}),l("index",["exports","./shared"],function(d,a){var g="4.7.0";let b,k;const S={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:v=>new Promise((i,h)=>{const p=requestAnimationFrame(i);v.signal.addEventListener("abort",()=>{cancelAnimationFrame(p),h(a.c())})}),getImageData(v,i=0){return this.getImageCanvasContext(v).getImageData(-i,-i,v.width+2*i,v.height+2*i)},getImageCanvasContext(v){const i=window.document.createElement("canvas"),h=i.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return i.width=v.width,i.height=v.height,h.drawImage(v,0,0,v.width,v.height),h},resolveURL:v=>(b||(b=document.createElement("a")),b.href=v,b.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(k==null&&(k=matchMedia("(prefers-reduced-motion: reduce)")),k.matches)}};class L{static testProp(i){if(!L.docStyle)return i[0];for(let h=0;h<i.length;h++)if(i[h]in L.docStyle)return i[h];return i[0]}static create(i,h,p){const m=window.document.createElement(i);return h!==void 0&&(m.className=h),p&&p.appendChild(m),m}static createNS(i,h){return window.document.createElementNS(i,h)}static disableDrag(){L.docStyle&&L.selectProp&&(L.userSelect=L.docStyle[L.selectProp],L.docStyle[L.selectProp]="none")}static enableDrag(){L.docStyle&&L.selectProp&&(L.docStyle[L.selectProp]=L.userSelect)}static setTransform(i,h){i.style[L.transformProp]=h}static addEventListener(i,h,p,m={}){i.addEventListener(h,p,"passive"in m?m:m.capture)}static removeEventListener(i,h,p,m={}){i.removeEventListener(h,p,"passive"in m?m:m.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",L.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",L.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",L.suppressClickInternal,!0)},0)}static getScale(i){const h=i.getBoundingClientRect();return{x:h.width/i.offsetWidth||1,y:h.height/i.offsetHeight||1,boundingClientRect:h}}static getPoint(i,h,p){const m=h.boundingClientRect;return new a.P((p.clientX-m.left)/h.x-i.clientLeft,(p.clientY-m.top)/h.y-i.clientTop)}static mousePos(i,h){const p=L.getScale(i);return L.getPoint(i,p,h)}static touchPos(i,h){const p=[],m=L.getScale(i);for(let y=0;y<h.length;y++)p.push(L.getPoint(i,m,h[y]));return p}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}}L.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,L.selectProp=L.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),L.transformProp=L.testProp(["transform","WebkitTransform"]);const P={supported:!1,testSupport:function(v){!$&&Z&&(H?G(v):R=v)}};let R,Z,$=!1,H=!1;function G(v){const i=v.createTexture();v.bindTexture(v.TEXTURE_2D,i);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,Z),v.isContextLost())return;P.supported=!0}catch{}v.deleteTexture(i),$=!0}var K;typeof document<"u"&&(Z=document.createElement("img"),Z.onload=()=>{R&&G(R),R=null,H=!0},Z.onerror=()=>{$=!0,R=null},Z.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(v){let i,h,p,m;v.resetRequestQueue=()=>{i=[],h=0,p=0,m={}},v.addThrottleControl=M=>{const D=p++;return m[D]=M,D},v.removeThrottleControl=M=>{delete m[M],I()},v.getImage=(M,D,O=!0)=>new Promise((N,Q)=>{P.supported&&(M.headers||(M.headers={}),M.headers.accept="image/webp,*/*"),a.e(M,{type:"image"}),i.push({abortController:D,requestParameters:M,supportImageRefresh:O,state:"queued",onError:se=>{Q(se)},onSuccess:se=>{N(se)}}),I()});const y=M=>a._(this,void 0,void 0,function*(){M.state="running";const{requestParameters:D,supportImageRefresh:O,onError:N,onSuccess:Q,abortController:se}=M,de=O===!1&&!a.i(self)&&!a.g(D.url)&&(!D.headers||Object.keys(D.headers).reduce((ke,Ce)=>ke&&Ce==="accept",!0));h++;const ge=de?E(D,se):a.m(D,se);try{const ke=yield ge;delete M.abortController,M.state="completed",ke.data instanceof HTMLImageElement||a.b(ke.data)?Q(ke):ke.data&&Q({data:yield(xe=ke.data,typeof createImageBitmap=="function"?a.d(xe):a.f(xe)),cacheControl:ke.cacheControl,expires:ke.expires})}catch(ke){delete M.abortController,N(ke)}finally{h--,I()}var xe}),I=()=>{const M=(()=>{for(const D of Object.keys(m))if(m[D]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let D=h;D<M&&i.length>0;D++){const O=i.shift();O.abortController.signal.aborted?D--:y(O)}},E=(M,D)=>new Promise((O,N)=>{const Q=new Image,se=M.url,de=M.credentials;de&&de==="include"?Q.crossOrigin="use-credentials":(de&&de==="same-origin"||!a.s(se))&&(Q.crossOrigin="anonymous"),D.signal.addEventListener("abort",()=>{Q.src="",N(a.c())}),Q.fetchPriority="high",Q.onload=()=>{Q.onerror=Q.onload=null,O({data:Q})},Q.onerror=()=>{Q.onerror=Q.onload=null,D.signal.aborted||N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Q.src=se})}(K||(K={})),K.resetRequestQueue();class le{constructor(i){this._transformRequestFn=i}transformRequest(i,h){return this._transformRequestFn&&this._transformRequestFn(i,h)||{url:i}}setTransformRequest(i){this._transformRequestFn=i}}function Se(v){var i=new a.A(3);return i[0]=v[0],i[1]=v[1],i[2]=v[2],i}var Le,te=function(v,i,h){return v[0]=i[0]-h[0],v[1]=i[1]-h[1],v[2]=i[2]-h[2],v};Le=new a.A(3),a.A!=Float32Array&&(Le[0]=0,Le[1]=0,Le[2]=0);var Y=function(v){var i=v[0],h=v[1];return i*i+h*h};function ue(v){const i=[];if(typeof v=="string")i.push({id:"default",url:v});else if(v&&v.length>0){const h=[];for(const{id:p,url:m}of v){const y=`${p}${m}`;h.indexOf(y)===-1&&(h.push(y),i.push({id:p,url:m}))}}return i}function fe(v,i,h){const p=v.split("?");return p[0]+=`${i}${h}`,p.join("?")}(function(){var v=new a.A(2);a.A!=Float32Array&&(v[0]=0,v[1]=0)})();class ce{constructor(i,h,p,m){this.context=i,this.format=p,this.texture=i.gl.createTexture(),this.update(h,m)}update(i,h,p){const{width:m,height:y}=i,I=!(this.size&&this.size[0]===m&&this.size[1]===y||p),{context:E}=this,{gl:M}=E;if(this.useMipmap=!!(h&&h.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!h||h.premultiply!==!1)),I)this.size=[m,y],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||a.b(i)?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,i):M.texImage2D(M.TEXTURE_2D,0,this.format,m,y,0,this.format,M.UNSIGNED_BYTE,i.data);else{const{x:D,y:O}=p||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||a.b(i)?M.texSubImage2D(M.TEXTURE_2D,0,D,O,M.RGBA,M.UNSIGNED_BYTE,i):M.texSubImage2D(M.TEXTURE_2D,0,D,O,m,y,M.RGBA,M.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)}bind(i,h,p){const{context:m}=this,{gl:y}=m;y.bindTexture(y.TEXTURE_2D,this.texture),p!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=y.LINEAR),i!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,i),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,p||i),this.filter=i),h!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,h),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}function ae(v){const{userImage:i}=v;return!!(i&&i.render&&i.render())&&(v.data.replace(new Uint8Array(i.data.buffer)),!0)}class We extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:h,promiseResolve:p}of this.requestors)p(this._getImagesForIds(h));this.requestors=[]}}getImage(i){const h=this.images[i];if(h&&!h.data&&h.spriteData){const p=h.spriteData;h.data=new a.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),h.spriteData=null}return h}addImage(i,h){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,h)&&(this.images[i]=h)}_validate(i,h){let p=!0;const m=h.data||h.spriteData;return this._validateStretch(h.stretchX,m&&m.width)||(this.fire(new a.j(new Error(`Image "${i}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,m&&m.height)||(this.fire(new a.j(new Error(`Image "${i}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new a.j(new Error(`Image "${i}" has invalid "content" value`))),p=!1),p}_validateStretch(i,h){if(!i)return!0;let p=0;for(const m of i){if(m[0]<p||m[1]<m[0]||h<m[1])return!1;p=m[1]}return!0}_validateContent(i,h){if(!i)return!0;if(i.length!==4)return!1;const p=h.spriteData,m=p&&p.width||h.data.width,y=p&&p.height||h.data.height;return!(i[0]<0||m<i[0]||i[1]<0||y<i[1]||i[2]<0||m<i[2]||i[3]<0||y<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,h,p=!0){const m=this.getImage(i);if(p&&(m.data.width!==h.data.width||m.data.height!==h.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=m.version+1,this.images[i]=h,this.updatedImages[i]=!0}removeImage(i){const h=this.images[i];delete this.images[i],delete this.patterns[i],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i){return new Promise((h,p)=>{let m=!0;if(!this.isLoaded())for(const y of i)this.images[y]||(m=!1);this.isLoaded()||m?h(this._getImagesForIds(i)):this.requestors.push({ids:i,promiseResolve:h})})}_getImagesForIds(i){const h={};for(const p of i){let m=this.getImage(p);m||(this.fire(new a.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?h[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:a.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:i,height:h}=this.atlasImage;return{width:i,height:h}}getPattern(i){const h=this.patterns[i],p=this.getImage(i);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},y=new a.I(m,p);this.patterns[i]={bin:m,position:y}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const h=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ce(i,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const y in this.patterns)i.push(this.patterns[y].bin);const{w:h,h:p}=a.p(i),m=this.atlasImage;m.resize({width:h||1,height:p||1});for(const y in this.patterns){const{bin:I}=this.patterns[y],E=I.x+1,M=I.y+1,D=this.getImage(y).data,O=D.width,N=D.height;a.R.copy(D,m,{x:0,y:0},{x:E,y:M},{width:O,height:N}),a.R.copy(D,m,{x:0,y:N-1},{x:E,y:M-1},{width:O,height:1}),a.R.copy(D,m,{x:0,y:0},{x:E,y:M+N},{width:O,height:1}),a.R.copy(D,m,{x:O-1,y:0},{x:E-1,y:M},{width:1,height:N}),a.R.copy(D,m,{x:0,y:0},{x:E+O,y:M},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const h of i){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.getImage(h);p||a.w(`Image with ID: "${h}" was not found`),ae(p)&&this.updateImage(h,p)}}}const Ee=1e20;function ze(v,i,h,p,m,y,I,E,M){for(let D=i;D<i+p;D++)rt(v,h*y+D,y,m,I,E,M);for(let D=h;D<h+m;D++)rt(v,D*y+i,1,p,I,E,M)}function rt(v,i,h,p,m,y,I){y[0]=0,I[0]=-Ee,I[1]=Ee,m[0]=v[i];for(let E=1,M=0,D=0;E<p;E++){m[E]=v[i+E*h];const O=E*E;do{const N=y[M];D=(m[E]-m[N]+O-N*N)/(E-N)/2}while(D<=I[M]&&--M>-1);M++,y[M]=E,I[M]=D,I[M+1]=Ee}for(let E=0,M=0;E<p;E++){for(;I[M+1]<E;)M++;const D=y[M],O=E-D;v[i+E*h]=m[D]+O*O}}class it{constructor(i,h){this.requestManager=i,this.localIdeographFontFamily=h,this.entries={}}setURL(i){this.url=i}getGlyphs(i){return a._(this,void 0,void 0,function*(){const h=[];for(const y in i)for(const I of i[y])h.push(this._getAndCacheGlyphsPromise(y,I));const p=yield Promise.all(h),m={};for(const{stack:y,id:I,glyph:E}of p)m[y]||(m[y]={}),m[y][I]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics};return m})}_getAndCacheGlyphsPromise(i,h){return a._(this,void 0,void 0,function*(){let p=this.entries[i];p||(p=this.entries[i]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[h];if(m!==void 0)return{stack:i,id:h,glyph:m};if(m=this._tinySDF(p,i,h),m)return p.glyphs[h]=m,{stack:i,id:h,glyph:m};const y=Math.floor(h/256);if(256*y>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[y])return{stack:i,id:h,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[y]){const E=it.loadGlyphRange(i,y,this.url,this.requestManager);p.requests[y]=E}const I=yield p.requests[y];for(const E in I)this._doesCharSupportLocalGlyph(+E)||(p.glyphs[+E]=I[+E]);return p.ranges[y]=!0,{stack:i,id:h,glyph:I[h]||null}})}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(i))}_tinySDF(i,h,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let y=i.tinySDF;if(!y){let E="400";/bold/i.test(h)?E="900":/medium/i.test(h)?E="500":/light/i.test(h)&&(E="200"),y=i.tinySDF=new it.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:E})}const I=y.draw(String.fromCharCode(p));return{id:p,bitmap:new a.o({width:I.width||60,height:I.height||60},I.data),metrics:{width:I.glyphWidth/2||24,height:I.glyphHeight/2||24,left:I.glyphLeft/2+.5||0,top:I.glyphTop/2-27.5||-8,advance:I.glyphAdvance/2||24,isDoubleResolution:!0}}}}it.loadGlyphRange=function(v,i,h,p){return a._(this,void 0,void 0,function*(){const m=256*i,y=m+255,I=p.transformRequest(h.replace("{fontstack}",v).replace("{range}",`${m}-${y}`),"Glyphs"),E=yield a.l(I,new AbortController);if(!E||!E.data)throw new Error(`Could not load glyph range. range: ${i}, ${m}-${y}`);const M={};for(const D of a.n(E.data))M[D.id]=D;return M})},it.TinySDF=class{constructor({fontSize:v=24,buffer:i=3,radius:h=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:y="normal",fontStyle:I="normal"}={}){this.buffer=i,this.cutoff=p,this.radius=h;const E=this.size=v+4*i,M=this._createCanvas(E),D=this.ctx=M.getContext("2d",{willReadFrequently:!0});D.font=`${I} ${y} ${v}px ${m}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(v){const i=document.createElement("canvas");return i.width=i.height=v,i}draw(v){const{width:i,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:y}=this.ctx.measureText(v),I=Math.ceil(h),E=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-m))),M=Math.min(this.size-this.buffer,I+Math.ceil(p)),D=E+2*this.buffer,O=M+2*this.buffer,N=Math.max(D*O,0),Q=new Uint8ClampedArray(N),se={data:Q,width:D,height:O,glyphWidth:E,glyphHeight:M,glyphTop:I,glyphLeft:0,glyphAdvance:i};if(E===0||M===0)return se;const{ctx:de,buffer:ge,gridInner:xe,gridOuter:ke}=this;de.clearRect(ge,ge,E,M),de.fillText(v,ge,ge+I);const Ce=de.getImageData(ge,ge,E,M);ke.fill(Ee,0,N),xe.fill(0,0,N);for(let me=0;me<M;me++)for(let Re=0;Re<E;Re++){const Be=Ce.data[4*(me*E+Re)+3]/255;if(Be===0)continue;const He=(me+ge)*D+Re+ge;if(Be===1)ke[He]=0,xe[He]=Ee;else{const ot=.5-Be;ke[He]=ot>0?ot*ot:0,xe[He]=ot<0?ot*ot:0}}ze(ke,0,0,D,O,D,this.f,this.v,this.z),ze(xe,ge,ge,E,M,D,this.f,this.v,this.z);for(let me=0;me<N;me++){const Re=Math.sqrt(ke[me])-Math.sqrt(xe[me]);Q[me]=Math.round(255-255*(Re/this.radius+this.cutoff))}return se}};class Qe{constructor(){this.specification=a.v.light.position}possiblyEvaluate(i,h){return a.x(i.expression.evaluate(h))}interpolate(i,h,p){return{x:a.y.number(i.x,h.x,p),y:a.y.number(i.y,h.y,p),z:a.y.number(i.z,h.z,p)}}}let Ft;class jt extends a.E{constructor(i){super(),Ft=Ft||new a.q({anchor:new a.D(a.v.light.anchor),position:new Qe,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Ft),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,h={}){if(!this._validate(a.r,i,h))for(const p in i){const m=i[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,h,p){return(!p||p.validate!==!1)&&a.t(this,i.call(a.u,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const ut=new a.q({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class et extends a.E{constructor(i){super(),this._transitionable=new a.T(ut),this.setSky(i),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.z(0))}setSky(i,h={}){if(!this._validate(a.B,i,h)){i||(i={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const p in i){const m=i[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,h,p={}){return(p==null?void 0:p.validate)!==!1&&a.t(this,i.call(a.u,a.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(i){return i<60?0:i<70?(i-60)/10:1}}class at{constructor(i,h){this.width=i,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,h){const p=i.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(i,h)),this.dashEntry[p]}getDashRanges(i,h,p){const m=[];let y=i.length%2==1?-i[i.length-1]*p:0,I=i[0]*p,E=!0;m.push({left:y,right:I,isDash:E,zeroLength:i[0]===0});let M=i[0];for(let D=1;D<i.length;D++){E=!E;const O=i[D];y=M*p,M+=O,I=M*p,m.push({left:y,right:I,isDash:E,zeroLength:O===0})}return m}addRoundDash(i,h,p){const m=h/2;for(let y=-p;y<=p;y++){const I=this.width*(this.nextRow+p+y);let E=0,M=i[E];for(let D=0;D<this.width;D++){D/M.right>1&&(M=i[++E]);const O=Math.abs(D-M.left),N=Math.abs(D-M.right),Q=Math.min(O,N);let se;const de=y/p*(m+1);if(M.isDash){const ge=m-Math.abs(de);se=Math.sqrt(Q*Q+ge*ge)}else se=m-Math.sqrt(Q*Q+de*de);this.data[I+D]=Math.max(0,Math.min(255,se+128))}}}addRegularDash(i){for(let E=i.length-1;E>=0;--E){const M=i[E],D=i[E+1];M.zeroLength?i.splice(E,1):D&&D.isDash===M.isDash&&(D.left=M.left,i.splice(E,1))}const h=i[0],p=i[i.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const m=this.width*this.nextRow;let y=0,I=i[y];for(let E=0;E<this.width;E++){E/I.right>1&&(I=i[++y]);const M=Math.abs(E-I.left),D=Math.abs(E-I.right),O=Math.min(M,D);this.data[m+E]=Math.max(0,Math.min(255,(I.isDash?O:-O)+128))}}addDash(i,h){const p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return a.w("LineAtlas out of space"),null;let y=0;for(let E=0;E<i.length;E++)y+=i[E];if(y!==0){const E=this.width/y,M=this.getDashRanges(i,this.width,E);h?this.addRoundDash(M,E,p):this.addRegularDash(M)}const I={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:y};return this.nextRow+=m,this.dirty=!0,I}bind(i){const h=i.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const Bt="maplibre_preloaded_worker_pool";class Dt{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<Dt.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Bt]}numActive(){return Object.keys(this.active).length}}const Ht=Math.floor(S.hardwareConcurrency/2);let ai,si;function Si(){return ai||(ai=new Dt),ai}Dt.workerCount=a.C(globalThis)?Math.max(Math.min(Ht,3),1):1;class Ri{constructor(i,h){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=h;const p=this.workerPool.acquire(h);for(let m=0;m<p.length;m++){const y=new a.F(p[m],h);y.name=`Worker ${m}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,h){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:i,data:h}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],i&&this.workerPool.release(this.id)}registerMessageHandler(i,h){for(const p of this.actors)p.registerMessageHandler(i,h)}}function vi(){return si||(si=new Ri(Si(),a.G),si.registerMessageHandler("GR",(v,i,h)=>a.m(i,h))),si}function di(v,i){const h=a.H();return a.J(h,h,[1,1,0]),a.K(h,h,[.5*v.width,.5*v.height,1]),a.L(h,h,v.calculatePosMatrix(i.toUnwrapped()))}function lt(v,i,h,p,m,y){const I=function(N,Q,se){if(N)for(const de of N){const ge=Q[de];if(ge&&ge.source===se&&ge.type==="fill-extrusion")return!0}else for(const de in Q){const ge=Q[de];if(ge.source===se&&ge.type==="fill-extrusion")return!0}return!1}(m&&m.layers,i,v.id),E=y.maxPitchScaleFactor(),M=v.tilesIn(p,E,I);M.sort(qe);const D=[];for(const N of M)D.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(i,h,v._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,m,y,E,di(v.transform,N.tileID))});const O=function(N){const Q={},se={};for(const de of N){const ge=de.queryResults,xe=de.wrappedTileID,ke=se[xe]=se[xe]||{};for(const Ce in ge){const me=ge[Ce],Re=ke[Ce]=ke[Ce]||{},Be=Q[Ce]=Q[Ce]||[];for(const He of me)Re[He.featureIndex]||(Re[He.featureIndex]=!0,Be.push(He))}}return Q}(D);for(const N in O)O[N].forEach(Q=>{const se=Q.feature,de=v.getFeatureState(se.layer["source-layer"],se.id);se.source=se.layer.source,se.layer["source-layer"]&&(se.sourceLayer=se.layer["source-layer"]),se.state=de});return O}function qe(v,i){const h=v.tileID,p=i.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}function st(v,i,h){return a._(this,void 0,void 0,function*(){let p=v;if(v.url?p=(yield a.h(i.transformRequest(v.url,"Source"),h)).data:yield S.frameAsync(h),!p)return null;const m=a.M(a.e(p,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(y=>y.id)),m})}class Te{constructor(i,h){i&&(h?this.setSouthWest(i).setNorthEast(h):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof a.N?new a.N(i.lng,i.lat):a.N.convert(i),this}setSouthWest(i){return this._sw=i instanceof a.N?new a.N(i.lng,i.lat):a.N.convert(i),this}extend(i){const h=this._sw,p=this._ne;let m,y;if(i instanceof a.N)m=i,y=i;else{if(!(i instanceof Te))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(Te.convert(i)):this.extend(a.N.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(a.N.convert(i)):this;if(m=i._sw,y=i._ne,!m||!y)return this}return h||p?(h.lng=Math.min(m.lng,h.lng),h.lat=Math.min(m.lat,h.lat),p.lng=Math.max(y.lng,p.lng),p.lat=Math.max(y.lat,p.lat)):(this._sw=new a.N(m.lng,m.lat),this._ne=new a.N(y.lng,y.lat)),this}getCenter(){return new a.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.N(this.getWest(),this.getNorth())}getSouthEast(){return new a.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:h,lat:p}=a.N.convert(i);let m=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(i){return i instanceof Te?i:i&&new Te(i)}static fromLngLat(i,h=0){const p=360*h/40075017,m=p/Math.cos(Math.PI/180*i.lat);return new Te(new a.N(i.lng-m,i.lat-p),new a.N(i.lng+m,i.lat+p))}adjustAntiMeridian(){const i=new a.N(this._sw.lng,this._sw.lat),h=new a.N(this._ne.lng,this._ne.lat);return new Te(i,i.lng>h.lng?new a.N(h.lng+360,h.lat):h)}}class mt{constructor(i,h,p){this.bounds=Te.convert(this.validateBounds(i)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const h=Math.pow(2,i.z),p=Math.floor(a.O(this.bounds.getWest())*h),m=Math.floor(a.Q(this.bounds.getNorth())*h),y=Math.ceil(a.O(this.bounds.getEast())*h),I=Math.ceil(a.Q(this.bounds.getSouth())*h);return i.x>=p&&i.x<y&&i.y>=m&&i.y<I}}class yt extends a.E{constructor(i,h,p,m){if(super(),this.id=i,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.M(h,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield st(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),i&&(a.e(this,i),i.bounds&&(this.tileBounds=new mt(i.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new a.j(i))}})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.abort(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(i){return a._(this,void 0,void 0,function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(h,"Tile"),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(i.actor&&i.state!=="expired"){if(i.state==="loading")return new Promise((y,I)=>{i.reloadPromise={resolve:y,reject:I}})}else i.actor=this.dispatcher.getActor(),m="LT";i.abortController=new AbortController;try{const y=yield i.actor.sendAsync({type:m,data:p},i.abortController);if(delete i.abortController,i.aborted)return;this._afterTileLoadWorkerResponse(i,y)}catch(y){if(delete i.abortController,i.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(i,null)}})}_afterTileLoadWorkerResponse(i,h){if(h&&h.resourceTiming&&(i.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&i.setExpiryData(h),i.loadVectorData(h,this.map.painter),i.reloadPromise){const p=i.reloadPromise;i.reloadPromise=null,this.loadTile(i).then(p.resolve).catch(p.reject)}}abortTile(i){return a._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.actor&&(yield i.actor.sendAsync({type:"AT",data:{uid:i.uid,type:this.type,source:this.id}}))})}unloadTile(i){return a._(this,void 0,void 0,function*(){i.unloadVectorData(),i.actor&&(yield i.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ie extends a.E{constructor(i,h,p,m){super(),this.id=i,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},h),a.e(this,a.M(h,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const i=yield st(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,i&&(a.e(this,i),i.bounds&&(this.tileBounds=new mt(i.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(i){this._tileJSONRequest=null,this.fire(new a.j(i))}})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(i){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}serialize(){return a.e({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i){return a._(this,void 0,void 0,function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.abortController=new AbortController;try{const p=yield K.getImage(this.map._requestManager.transformRequest(h,"Tile"),i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&i.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,y=m.gl,I=p.data;i.texture=this.map.painter.getTileTexture(I.width),i.texture?i.texture.update(I,{useMipmap:!0}):(i.texture=new ce(m,I,y.RGBA,{useMipmap:!0}),i.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST)),i.state="loaded"}}catch(p){if(delete i.abortController,i.aborted)i.state="unloaded";else if(p)throw i.state="errored",p}})}abortTile(i){return a._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController)})}unloadTile(i){return a._(this,void 0,void 0,function*(){i.texture&&this.map.painter.saveTileTexture(i.texture)})}hasTransition(){return!1}}class nt extends Ie{constructor(i,h,p,m){super(i,h,p,m),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(i){return a._(this,void 0,void 0,function*(){const h=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(h,"Tile");i.neighboringTiles=this._getNeighboringTiles(i.tileID),i.abortController=new AbortController;try{const m=yield K.getImage(p,i.abortController,this.map._refreshExpiredTiles);if(delete i.abortController,i.aborted)return void(i.state="unloaded");if(m&&m.data){const y=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&i.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const I=a.b(y)&&a.U()?y:yield this.readImageNow(y),E={type:this.type,uid:i.uid,source:this.id,rawImageData:I,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!i.actor||i.state==="expired"){i.actor=this.dispatcher.getActor();const M=yield i.actor.sendAsync({type:"LDT",data:E});i.dem=M,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded"}}}catch(m){if(delete i.abortController,i.aborted)i.state="unloaded";else if(m)throw i.state="errored",m}})}readImageNow(i){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.V()){const h=i.width+2,p=i.height+2;try{return new a.R({width:h,height:p},yield a.W(i,-1,-1,h,p))}catch{}}return S.getImageData(i,1)})}_getNeighboringTiles(i){const h=i.canonical,p=Math.pow(2,h.z),m=(h.x-1+p)%p,y=h.x===0?i.wrap-1:i.wrap,I=(h.x+1+p)%p,E=h.x+1===p?i.wrap+1:i.wrap,M={};return M[new a.S(i.overscaledZ,y,h.z,m,h.y).key]={backfilled:!1},M[new a.S(i.overscaledZ,E,h.z,I,h.y).key]={backfilled:!1},h.y>0&&(M[new a.S(i.overscaledZ,y,h.z,m,h.y-1).key]={backfilled:!1},M[new a.S(i.overscaledZ,i.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},M[new a.S(i.overscaledZ,E,h.z,I,h.y-1).key]={backfilled:!1}),h.y+1<p&&(M[new a.S(i.overscaledZ,y,h.z,m,h.y+1).key]={backfilled:!1},M[new a.S(i.overscaledZ,i.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},M[new a.S(i.overscaledZ,E,h.z,I,h.y+1).key]={backfilled:!1}),M}unloadTile(i){return a._(this,void 0,void 0,function*(){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&(yield i.actor.sendAsync({type:"RDT",data:{type:this.type,uid:i.uid,source:this.id}}))})}}class Xt extends a.E{constructor(i,h,p,m){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(m),this._data=h.data,this._options=a.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const y=a.X/this.tileSize;h.clusterMaxZoom!==void 0&&this.maxzoom<=h.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${h.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*y,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*y,extent:a.X,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:a.X,radius:(h.clusterRadius||50)*y,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._updateWorkerData(),this}updateData(i){return this._updateWorkerData(i),this}getData(){return a._(this,void 0,void 0,function*(){const i=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:i})})}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i&&(i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=i.clusterRadius),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=i.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(i){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:i,source:this.id}})}getClusterChildren(i){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:i,source:this.id}})}getClusterLeaves(i,h,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:i,limit:h,offset:p}})}_updateWorkerData(i){return a._(this,void 0,void 0,function*(){const h=a.e({type:this.type},this.workerOptions);i?h.dataDiff=i:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(S.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||p.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let m=null;p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0));const y={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&a.e(y,{resourceTiming:m}),this.fire(new a.k("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},y),{sourceDataType:"content"})))}catch(p){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(p))}})}loaded(){return this._pendingLoads===0}loadTile(i){return a._(this,void 0,void 0,function*(){const h=i.actor?"RT":"LT";i.actor=this.actor;const p={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};i.abortController=new AbortController;const m=yield this.actor.sendAsync({type:h,data:p},i.abortController);delete i.abortController,i.unloadVectorData(),i.aborted||i.loadVectorData(m,this.map.painter,h==="RT")})}abortTile(i){return a._(this,void 0,void 0,function*(){i.abortController&&(i.abortController.abort(),delete i.abortController),i.aborted=!0})}unloadTile(i){return a._(this,void 0,void 0,function*(){i.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:i.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var wi=a.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ni extends a.E{constructor(i,h,p,m){super(),this.id=i,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=h}load(i){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield K.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,i&&(this.coordinates=i),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new a.j(h))}})}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=i.url,this.load(i.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(i){this.coordinates=i;const h=i.map(a.Z.fromLngLat);this.tileID=function(m){let y=1/0,I=1/0,E=-1/0,M=-1/0;for(const Q of m)y=Math.min(y,Q.x),I=Math.min(I,Q.y),E=Math.max(E,Q.x),M=Math.max(M,Q.y);const D=Math.max(E-y,M-I),O=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),N=Math.pow(2,O);return new a.a1(O,Math.floor((y+E)/2*N),Math.floor((I+M)/2*N))}(h),this.minzoom=this.maxzoom=this.tileID.z;const p=h.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new a.$,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,a.X,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,a.X),this._boundsArray.emplaceBack(p[2].x,p[2].y,a.X,a.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,h=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,wi.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ce(i,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(i){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={}):i.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Li extends Ni{constructor(i,h,p,m){super(i,h,p,m),this.roundZoom=!0,this.type="video",this.options=h}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const i=this.options;this.urls=[];for(const h of i.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield a.a3(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new a.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const h=this.video.seekable;i<h.start(0)||i>h.end(0)?this.fire(new a.j(new a.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const i=this.map.painter.context,h=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,wi.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new ce(i,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class gi extends Ni{constructor(i,h,p,m){super(i,h,p,m),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(I=>typeof I!="number"))||this.fire(new a.j(new a.a2(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a2(`sources.${i}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new a.j(new a.a2(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a2(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a2(`sources.${i}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,wi.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ce(h,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const y in this.tiles){const I=this.tiles[y];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture,m=!0)}m&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const Fi={},_r=v=>{switch(v){case"geojson":return Xt;case"image":return Ni;case"raster":return Ie;case"raster-dem":return nt;case"vector":return yt;case"video":return Li;case"canvas":return gi}return Fi[v]},ct="RTLPluginLoaded";class Yn extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=vi()}_syncState(i){return this.status=i,this.dispatcher.broadcast("SRPS",{pluginStatus:i,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(i){return a._(this,arguments,void 0,function*(h,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=S.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(ct))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let un=null;function On(){return un||(un=new Yn),un}class qr{constructor(i,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=i,this.uid=a.a4(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const h=i+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(m,y){const I={};if(!y)return I;for(const E of m){const M=E.layerIds.map(D=>y.getLayer(D)).filter(Boolean);if(M.length!==0){E.layers=M,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(D=>M.filter(O=>O.id===D)[0]));for(const D of M)I[D.id]=E}}return I}(i.buckets,h.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const y=this.buckets[m];if(y instanceof a.a6){if(this.hasSymbolBuckets=!0,!p)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const y=this.buckets[m];if(y instanceof a.a6&&y.hasRTLText){this.hasRTLText=!0,On().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const y=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(m).queryRadius(y))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new a.a5}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(i)}const h=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ce(i,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ce(i,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,h,p,m,y,I,E,M,D,O){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:y,scale:I,tileSize:this.tileSize,pixelPosMatrix:O,transform:M,params:E,queryPadding:this.queryPadding*D},i,h,p):{}}querySourceFeatures(i,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),y=h&&h.sourceLayer?h.sourceLayer:"",I=m._geojsonTileLayer||m[y];if(!I)return;const E=a.a7(h&&h.filter),{z:M,x:D,y:O}=this.tileID.canonical,N={z:M,x:D,y:O};for(let Q=0;Q<I.length;Q++){const se=I.feature(Q);if(E.needGeometry){const xe=a.a8(se,!0);if(!E.filter(new a.z(this.tileID.overscaledZ),xe,this.tileID.canonical))continue}else if(!E.filter(new a.z(this.tileID.overscaledZ),se))continue;const de=p.getId(se,y),ge=new a.a9(se,M,D,O,de);ge.tile=N,i.push(ge)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const h=this.expirationTime;if(i.cacheControl){const p=a.aa(i.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(h)if(this.expirationTime<h)m=!0;else{const y=this.expirationTime-h;y?this.expirationTime=p+Math.max(y,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!h.style.hasLayer(m))continue;const y=this.buckets[m],I=y.layers[0].sourceLayer||"_geojsonTileLayer",E=p[I],M=i[I];if(!E||!M||Object.keys(M).length===0)continue;y.update(M,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});const D=h&&h.style&&h.style.getLayer(m);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<S.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=S.now()+i}setDependencies(i,h){const p={};for(const m of h)p[m]=!0;this.dependencies[i]=p}hasDependency(i,h){for(const p of i){const m=this.dependencies[p];if(m){for(const y of h)if(m[y])return!0}}return!1}}class vt{constructor(i,h){this.max=i,this.onRemove=h,this.reset()}reset(){for(const i in this.data)for(const h of this.data[i])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(i,h,p){const m=i.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const y={value:h,timeout:void 0};if(p!==void 0&&(y.timeout=setTimeout(()=>{this.remove(i,y)},p)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){const I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const h=this.data[i].shift();return h.timeout&&clearTimeout(h.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),h.value}getByKey(i){const h=this.data[i];return h?h[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,h){if(!this.has(i))return this;const p=i.wrapped().key,m=h===void 0?0:this.data[p].indexOf(h),y=this.data[p][m];return this.data[p].splice(m,1),y.timeout&&clearTimeout(y.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(y.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(i){const h=[];for(const p in this.data)for(const m of this.data[p])i(m.value)||h.push(m);for(const p of h)this.remove(p.value.tileID,p)}}class li{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,h,p){const m=String(h);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][m]=this.stateChanges[i][m]||{},a.e(this.stateChanges[i][m],p),this.deletedStates[i]===null){this.deletedStates[i]={};for(const y in this.state[i])y!==m&&(this.deletedStates[i][y]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][m]===null){this.deletedStates[i][m]={};for(const y in this.state[i][m])p[y]||(this.deletedStates[i][m][y]=null)}else for(const y in p)this.deletedStates[i]&&this.deletedStates[i][m]&&this.deletedStates[i][m][y]===null&&delete this.deletedStates[i][m][y]}removeFeatureState(i,h,p){if(this.deletedStates[i]===null)return;const m=String(h);if(this.deletedStates[i]=this.deletedStates[i]||{},p&&h!==void 0)this.deletedStates[i][m]!==null&&(this.deletedStates[i][m]=this.deletedStates[i][m]||{},this.deletedStates[i][m][p]=null);else if(h!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][m])for(p in this.deletedStates[i][m]={},this.stateChanges[i][m])this.deletedStates[i][m][p]=null;else this.deletedStates[i][m]=null;else this.deletedStates[i]=null}getState(i,h){const p=String(h),m=a.e({},(this.state[i]||{})[p],(this.stateChanges[i]||{})[p]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const y=this.deletedStates[i][h];if(y===null)return{};for(const I in y)delete m[I]}return m}initializeTileState(i,h){i.setFeatureState(this.state,h)}coalesceChanges(i,h){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const y={};for(const I in this.stateChanges[m])this.state[m][I]||(this.state[m][I]={}),a.e(this.state[m][I],this.stateChanges[m][I]),y[I]=this.state[m][I];p[m]=y}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const y={};if(this.deletedStates[m]===null)for(const I in this.state[m])y[I]={},this.state[m][I]={};else for(const I in this.deletedStates[m]){if(this.deletedStates[m][I]===null)this.state[m][I]={};else for(const E of Object.keys(this.deletedStates[m][I]))delete this.state[m][I][E];y[I]=this.state[m][I]}p[m]=p[m]||{},a.e(p[m],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in i)i[m].setFeatureState(p,h)}}class Jt extends a.E{constructor(i,h,p){super(),this.id=i,this.dispatcher=p,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,y,I,E)=>{const M=new(_r(y.type))(m,y,I,E);if(M.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${M.id}`);return M})(i,h,p,this),this._tiles={},this._cache=new vt(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new li,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const h=this._tiles[i];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,h,p){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(i),this._tileLoaded(i,h,p)}catch(m){i.state="errored",m.status!==404?this._source.fire(new a.j(m,{tile:i})):this.update(this.transform,this.terrain)}})}_unloadTile(i){this._source.unloadTile&&this._source.unloadTile(i)}_abortTile(i){this._source.abortTile&&this._source.abortTile(i),this._source.fire(new a.k("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(i),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(wn).map(i=>i.key)}getRenderableIds(i){const h=[];for(const p in this._tiles)this._isIdRenderable(p,i)&&h.push(this._tiles[p]);return i?h.sort((p,m)=>{const y=p.tileID,I=m.tileID,E=new a.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),M=new a.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-I.overscaledZ||M.y-E.y||M.x-E.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(wn).map(p=>p.key)}hasRenderableParent(i){const h=this.findLoadedParent(i,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(i,h){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(h||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(i,h){return a._(this,void 0,void 0,function*(){const p=this._tiles[i];p&&(p.state!=="loading"&&(p.state=h),yield this._loadTile(p,i,h))})}_tileLoaded(i,h,p){i.timeAdded=S.now(),p==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(h,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const h=this.getRenderableIds();for(let m=0;m<h.length;m++){const y=h[m];if(i.neighboringTiles&&i.neighboringTiles[y]){const I=this.getTileByID(y);p(i,I),p(I,i)}}function p(m,y){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let I=y.tileID.canonical.x-m.tileID.canonical.x;const E=y.tileID.canonical.y-m.tileID.canonical.y,M=Math.pow(2,m.tileID.canonical.z),D=y.tileID.key;I===0&&E===0||Math.abs(E)>1||(Math.abs(I)>1&&(Math.abs(I+M)===1?I+=M:Math.abs(I-M)===1&&(I-=M)),y.dem&&m.dem&&(m.dem.backfillBorder(y.dem,I,E),m.neighboringTiles&&m.neighboringTiles[D]&&(m.neighboringTiles[D].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,h,p,m){for(const y in this._tiles){let I=this._tiles[y];if(m[y]||!I.hasData()||I.tileID.overscaledZ<=h||I.tileID.overscaledZ>p)continue;let E=I.tileID;for(;I&&I.tileID.overscaledZ>h+1;){const D=I.tileID.scaledTo(I.tileID.overscaledZ-1);I=this._tiles[D.key],I&&I.hasData()&&(E=D)}let M=E;for(;M.overscaledZ>h;)if(M=M.scaledTo(M.overscaledZ-1),i[M.key]){m[E.key]=E;break}}}findLoadedParent(i,h){if(i.key in this._loadedParentTiles){const p=this._loadedParentTiles[i.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=i.overscaledZ-1;p>=h;p--){const m=i.scaledTo(p),y=this._getLoadedTile(m);if(y)return y}}findLoadedSibling(i){return this._getLoadedTile(i)}_getLoadedTile(i){const h=this._tiles[i.key];return h&&h.hasData()?h:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const h=Math.ceil(i.width/this._source.tileSize)+1,p=Math.ceil(i.height/this._source.tileSize)+1,m=Math.floor(h*p*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(i){const h=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,h){const p={};for(const m in this._tiles){const y=this._tiles[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+h),p[y.tileID.key]=y}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}_updateCoveredAndRetainedTiles(i,h,p,m,y,I){const E={},M={},D=Object.keys(i),O=S.now();for(const N of D){const Q=i[N],se=this._tiles[N];if(!se||se.fadeEndTime!==0&&se.fadeEndTime<=O)continue;const de=this.findLoadedParent(Q,h),ge=this.findLoadedSibling(Q),xe=de||ge||null;xe&&(this._addTile(xe.tileID),E[xe.tileID.key]=xe.tileID),M[N]=Q}this._retainLoadedChildren(M,m,p,i);for(const N in E)i[N]||(this._coveredTiles[N]=!0,i[N]=E[N]);if(I){const N={},Q={};for(const se of y)this._tiles[se.key].hasData()?N[se.key]=se:Q[se.key]=se;for(const se in Q){const de=Q[se].children(this._source.maxzoom);this._tiles[de[0].key]&&this._tiles[de[1].key]&&this._tiles[de[2].key]&&this._tiles[de[3].key]&&(N[de[0].key]=i[de[0].key]=de[0],N[de[1].key]=i[de[1].key]=de[1],N[de[2].key]=i[de[2].key]=de[2],N[de[3].key]=i[de[3].key]=de[3],delete Q[se])}for(const se in Q){const de=Q[se],ge=this.findLoadedParent(de,this._source.minzoom),xe=this.findLoadedSibling(de),ke=ge||xe||null;if(ke){N[ke.tileID.key]=i[ke.tileID.key]=ke.tileID;for(const Ce in N)N[Ce].isChildOf(ke.tileID)&&delete N[Ce]}}for(const se in this._tiles)N[se]||(this._coveredTiles[se]=!0)}}update(i,h){if(!this._sourceLoaded||this._paused)return;let p;this.transform=i,this.terrain=h,this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(O=>new a.S(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y)):(p=i.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(p=p.filter(O=>this._source.hasTile(O)))):p=[];const m=i.coveringZoomLevel(this._source),y=Math.max(m-Jt.maxOverzooming,this._source.minzoom),I=Math.max(m+Jt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const O={};for(const N of p)if(N.canonical.z>this._source.minzoom){const Q=N.scaledTo(N.canonical.z-1);O[Q.key]=Q;const se=N.scaledTo(Math.max(this._source.minzoom,Math.min(N.canonical.z,5)));O[se.key]=se}p=p.concat(Object.values(O))}const E=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,E&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const M=this._updateRetainedTiles(p,m);Dn(this._source.type)&&this._updateCoveredAndRetainedTiles(M,y,I,m,p,h);for(const O in M)this._tiles[O].clearFadeHold();const D=a.ab(this._tiles,M);for(const O of D){const N=this._tiles[O];N.hasSymbolBuckets&&!N.holdingForFade()?N.setHoldDuration(this.map._fadeDuration):N.hasSymbolBuckets&&!N.symbolFadeFinished()||this._removeTile(O)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,h){var p;const m={},y={},I=Math.max(h-Jt.maxOverzooming,this._source.minzoom),E=Math.max(h+Jt.maxUnderzooming,this._source.minzoom),M={};for(const D of i){const O=this._addTile(D);m[D.key]=D,O.hasData()||h<this._source.maxzoom&&(M[D.key]=D)}this._retainLoadedChildren(M,h,E,m);for(const D of i){let O=this._tiles[D.key];if(O.hasData())continue;if(h+1>this._source.maxzoom){const Q=D.children(this._source.maxzoom)[0],se=this.getTile(Q);if(se&&se.hasData()){m[Q.key]=Q;continue}}else{const Q=D.children(this._source.maxzoom);if(m[Q[0].key]&&m[Q[1].key]&&m[Q[2].key]&&m[Q[3].key])continue}let N=O.wasRequested();for(let Q=D.overscaledZ-1;Q>=I;--Q){const se=D.scaledTo(Q);if(y[se.key])break;if(y[se.key]=!0,O=this.getTile(se),!O&&N&&(O=this._addTile(se)),O){const de=O.hasData();if((de||!(!((p=this.map)===null||p===void 0)&&p.cancelPendingTileRequestsWhileZooming)||N)&&(m[se.key]=se),N=O.wasRequested(),de)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const h=[];let p,m=this._tiles[i].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}h.push(m.key);const y=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(y),p)break;m=y}for(const y of h)this._loadedParentTiles[y]=p}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const i in this._tiles){const h=this._tiles[i].tileID,p=this._getLoadedTile(h);this._loadedSiblingTiles[h.key]=p}}_addTile(i){let h=this._tiles[i.key];if(h)return h;h=this._cache.getAndRemove(i),h&&(this._setTileReloadTimer(i.key,h),h.tileID=i,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,h)));const p=h;return h||(h=new qr(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(h,i.key,h.state)),h.uses++,this._tiles[i.key]=h,p||this._source.fire(new a.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(i,h){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const p=h.getExpiryTimeout();p&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},p))}_removeTile(i){const h=this._tiles[i];h&&(h.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(i){const h=i.sourceDataType;i.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&i.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,h,p){const m=[],y=this.transform;if(!y)return m;const I=p?y.getCameraQueryGeometry(i):i,E=i.map(de=>y.pointCoordinate(de,this.terrain)),M=I.map(de=>y.pointCoordinate(de,this.terrain)),D=this.getIds();let O=1/0,N=1/0,Q=-1/0,se=-1/0;for(const de of M)O=Math.min(O,de.x),N=Math.min(N,de.y),Q=Math.max(Q,de.x),se=Math.max(se,de.y);for(let de=0;de<D.length;de++){const ge=this._tiles[D[de]];if(ge.holdingForFade())continue;const xe=ge.tileID,ke=Math.pow(2,y.zoom-ge.tileID.overscaledZ),Ce=h*ge.queryPadding*a.X/ge.tileSize/ke,me=[xe.getTilePoint(new a.Z(O,N)),xe.getTilePoint(new a.Z(Q,se))];if(me[0].x-Ce<a.X&&me[0].y-Ce<a.X&&me[1].x+Ce>=0&&me[1].y+Ce>=0){const Re=E.map(He=>xe.getTilePoint(He)),Be=M.map(He=>xe.getTilePoint(He));m.push({tile:ge,tileID:xe,queryGeometry:Re,cameraQueryGeometry:Be,scale:ke})}}return m}getVisibleCoordinates(i){const h=this.getRenderableIds(i).map(p=>this._tiles[p].tileID);for(const p of h)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(Dn(this._source.type)){const i=S.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=i)return!0}return!1}setFeatureState(i,h,p){this._state.updateState(i=i||"_geojsonTileLayer",h,p)}removeFeatureState(i,h,p){this._state.removeFeatureState(i=i||"_geojsonTileLayer",h,p)}getFeatureState(i,h){return this._state.getState(i=i||"_geojsonTileLayer",h)}setDependencies(i,h,p){const m=this._tiles[i];m&&m.setDependencies(h,p)}reloadTilesForDependencies(i,h){for(const p in this._tiles)this._tiles[p].hasDependency(i,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(i,h))}}function wn(v,i){const h=Math.abs(2*v.wrap)-+(v.wrap<0),p=Math.abs(2*i.wrap)-+(i.wrap<0);return v.overscaledZ-i.overscaledZ||p-h||i.canonical.y-v.canonical.y||i.canonical.x-v.canonical.x}function Dn(v){return v==="raster"||v==="image"||v==="video"}Jt.maxOverzooming=10,Jt.maxUnderzooming=3;class ei{constructor(i,h){this.reset(i,h)}reset(i,h){this.points=i||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=a.ac(i,0,1);let h=1,p=this._distances[h];const m=i*this.paddedLength+this.padding;for(;p<m&&h<this._distances.length;)p=this._distances[++h];const y=h-1,I=this._distances[y],E=p-I,M=E>0?(m-I)/E:0;return this.points[y].mult(1-M).add(this.points[h].mult(M))}}function gr(v,i){let h=!0;return v==="always"||v!=="never"&&i!=="never"||(h=!1),h}class zr{constructor(i,h,p){const m=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(i/p),this.yCellCount=Math.ceil(h/p);for(let I=0;I<this.xCellCount*this.yCellCount;I++)m.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=h,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,h,p,m,y){this._forEachCell(h,p,m,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(y)}insertCircle(i,h,p,m){this._forEachCell(h-m,p-m,h+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(h),this.circles.push(p),this.circles.push(m)}_insertBoxCell(i,h,p,m,y,I){this.boxCells[y].push(I)}_insertCircleCell(i,h,p,m,y,I){this.circleCells[y].push(I)}_query(i,h,p,m,y,I,E){if(p<0||i>this.width||m<0||h>this.height)return[];const M=[];if(i<=0&&h<=0&&this.width<=p&&this.height<=m){if(y)return[{key:null,x1:i,y1:h,x2:p,y2:m}];for(let D=0;D<this.boxKeys.length;D++)M.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const O=this.circles[3*D],N=this.circles[3*D+1],Q=this.circles[3*D+2];M.push({key:this.circleKeys[D],x1:O-Q,y1:N-Q,x2:O+Q,y2:N+Q})}}else this._forEachCell(i,h,p,m,this._queryCell,M,{hitTest:y,overlapMode:I,seenUids:{box:{},circle:{}}},E);return M}query(i,h,p,m){return this._query(i,h,p,m,!1,null)}hitTest(i,h,p,m,y,I){return this._query(i,h,p,m,!0,y,I).length>0}hitTestCircle(i,h,p,m,y){const I=i-p,E=i+p,M=h-p,D=h+p;if(E<0||I>this.width||D<0||M>this.height)return!1;const O=[];return this._forEachCell(I,M,E,D,this._queryCellCircle,O,{hitTest:!0,overlapMode:m,circle:{x:i,y:h,radius:p},seenUids:{box:{},circle:{}}},y),O.length>0}_queryCell(i,h,p,m,y,I,E,M){const{seenUids:D,hitTest:O,overlapMode:N}=E,Q=this.boxCells[y];if(Q!==null){const de=this.bboxes;for(const ge of Q)if(!D.box[ge]){D.box[ge]=!0;const xe=4*ge,ke=this.boxKeys[ge];if(i<=de[xe+2]&&h<=de[xe+3]&&p>=de[xe+0]&&m>=de[xe+1]&&(!M||M(ke))&&(!O||!gr(N,ke.overlapMode))&&(I.push({key:ke,x1:de[xe],y1:de[xe+1],x2:de[xe+2],y2:de[xe+3]}),O))return!0}}const se=this.circleCells[y];if(se!==null){const de=this.circles;for(const ge of se)if(!D.circle[ge]){D.circle[ge]=!0;const xe=3*ge,ke=this.circleKeys[ge];if(this._circleAndRectCollide(de[xe],de[xe+1],de[xe+2],i,h,p,m)&&(!M||M(ke))&&(!O||!gr(N,ke.overlapMode))){const Ce=de[xe],me=de[xe+1],Re=de[xe+2];if(I.push({key:ke,x1:Ce-Re,y1:me-Re,x2:Ce+Re,y2:me+Re}),O)return!0}}}return!1}_queryCellCircle(i,h,p,m,y,I,E,M){const{circle:D,seenUids:O,overlapMode:N}=E,Q=this.boxCells[y];if(Q!==null){const de=this.bboxes;for(const ge of Q)if(!O.box[ge]){O.box[ge]=!0;const xe=4*ge,ke=this.boxKeys[ge];if(this._circleAndRectCollide(D.x,D.y,D.radius,de[xe+0],de[xe+1],de[xe+2],de[xe+3])&&(!M||M(ke))&&!gr(N,ke.overlapMode))return I.push(!0),!0}}const se=this.circleCells[y];if(se!==null){const de=this.circles;for(const ge of se)if(!O.circle[ge]){O.circle[ge]=!0;const xe=3*ge,ke=this.circleKeys[ge];if(this._circlesCollide(de[xe],de[xe+1],de[xe+2],D.x,D.y,D.radius)&&(!M||M(ke))&&!gr(N,ke.overlapMode))return I.push(!0),!0}}}_forEachCell(i,h,p,m,y,I,E,M){const D=this._convertToXCellCoord(i),O=this._convertToYCellCoord(h),N=this._convertToXCellCoord(p),Q=this._convertToYCellCoord(m);for(let se=D;se<=N;se++)for(let de=O;de<=Q;de++)if(y.call(this,i,h,p,m,this.xCellCount*de+se,I,E,M))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,h,p,m,y,I){const E=m-i,M=y-h,D=p+I;return D*D>E*E+M*M}_circleAndRectCollide(i,h,p,m,y,I,E){const M=(I-m)/2,D=Math.abs(i-(m+M));if(D>M+p)return!1;const O=(E-y)/2,N=Math.abs(h-(y+O));if(N>O+p)return!1;if(D<=M||N<=O)return!0;const Q=D-M,se=N-O;return Q*Q+se*se<=p*p}}function Zr(v,i,h,p,m){const y=a.H();return i?(a.K(y,y,[1/m,1/m,1]),h||a.ad(y,y,p.angle)):a.L(y,p.labelPlaneMatrix,v),y}function yr(v,i,h,p,m){if(i){const y=a.ae(v);return a.K(y,y,[m,m,1]),h||a.ad(y,y,-p.angle),y}return p.glCoordMatrix}function ye(v,i,h,p){let m;p?(m=[v,i,p(v,i),1],a.af(m,m,h)):(m=[v,i,0,1],pi(m,m,h));const y=m[3];return{point:new a.P(m[0]/y,m[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}function q(v,i){return .5+v/i*.5}function V(v,i){return v.x>=-i[0]&&v.x<=i[0]&&v.y>=-i[1]&&v.y<=i[1]}function re(v,i,h,p,m,y,I,E,M,D,O,N,Q,se,de){const ge=p?v.textSizeData:v.iconSizeData,xe=a.ag(ge,h.transform.zoom),ke=[256/h.width*2+1,256/h.height*2+1],Ce=p?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;Ce.clear();const me=v.lineVertexArray,Re=p?v.text.placedSymbolArray:v.icon.placedSymbolArray,Be=h.transform.width/h.transform.height;let He=!1;for(let ot=0;ot<Re.length;ot++){const wt=Re.get(ot);if(wt.hidden||wt.writingMode===a.ah.vertical&&!He){Et(wt.numGlyphs,Ce);continue}He=!1;const It=ye(wt.anchorX,wt.anchorY,i,de);if(!V(It.point,ke)){Et(wt.numGlyphs,Ce);continue}const At=q(h.transform.cameraToCenterDistance,It.signedDistanceFromCamera),kt=a.ai(ge,xe,wt),xt=I?kt/At:kt*At,Nt={getElevation:de,labelPlaneMatrix:m,lineVertexArray:me,pitchWithMap:I,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:D,tileAnchorPoint:new a.P(wt.anchorX,wt.anchorY),unwrappedTileID:O,width:N,height:Q,translation:se},ri=De(Nt,wt,xt,!1,E,i,y,v.glyphOffsetArray,Ce,Be,M);He=ri.useVertical,(ri.notEnoughRoom||He||ri.needsFlipping&&De(Nt,wt,xt,!0,E,i,y,v.glyphOffsetArray,Ce,Be,M).notEnoughRoom)&&Et(wt.numGlyphs,Ce)}p?v.text.dynamicLayoutVertexBuffer.updateData(Ce):v.icon.dynamicLayoutVertexBuffer.updateData(Ce)}function pe(v,i,h,p,m,y,I,E){const M=y.glyphStartIndex+y.numGlyphs,D=y.lineStartIndex,O=y.lineStartIndex+y.lineLength,N=i.getoffsetX(y.glyphStartIndex),Q=i.getoffsetX(M-1),se=Xe(v*N,h,p,m,y.segment,D,O,E,I);if(!se)return null;const de=Xe(v*Q,h,p,m,y.segment,D,O,E,I);return de?E.projectionCache.anyProjectionOccluded?null:{first:se,last:de}:null}function Me(v,i,h,p){return v===a.ah.horizontal&&Math.abs(h.y-i.y)>Math.abs(h.x-i.x)*p?{useVertical:!0}:(v===a.ah.vertical?i.y<h.y:i.x>h.x)?{needsFlipping:!0}:null}function De(v,i,h,p,m,y,I,E,M,D,O){const N=h/24,Q=i.lineOffsetX*N,se=i.lineOffsetY*N;let de;if(i.numGlyphs>1){const ge=i.glyphStartIndex+i.numGlyphs,xe=i.lineStartIndex,ke=i.lineStartIndex+i.lineLength,Ce=pe(N,E,Q,se,p,i,O,v);if(!Ce)return{notEnoughRoom:!0};const me=ye(Ce.first.point.x,Ce.first.point.y,I,v.getElevation).point,Re=ye(Ce.last.point.x,Ce.last.point.y,I,v.getElevation).point;if(m&&!p){const Be=Me(i.writingMode,me,Re,D);if(Be)return Be}de=[Ce.first];for(let Be=i.glyphStartIndex+1;Be<ge-1;Be++)de.push(Xe(N*E.getoffsetX(Be),Q,se,p,i.segment,xe,ke,v,O));de.push(Ce.last)}else{if(m&&!p){const xe=ye(v.tileAnchorPoint.x,v.tileAnchorPoint.y,y,v.getElevation).point,ke=i.lineStartIndex+i.segment+1,Ce=new a.P(v.lineVertexArray.getx(ke),v.lineVertexArray.gety(ke)),me=ye(Ce.x,Ce.y,y,v.getElevation),Re=me.signedDistanceFromCamera>0?me.point:function(He,ot,wt,It,At,kt){return $e(He,ot,wt,1,At,kt)}(v.tileAnchorPoint,Ce,xe,0,y,v),Be=Me(i.writingMode,xe,Re,D);if(Be)return Be}const ge=Xe(N*E.getoffsetX(i.glyphStartIndex),Q,se,p,i.segment,i.lineStartIndex,i.lineStartIndex+i.lineLength,v,O);if(!ge||v.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};de=[ge]}for(const ge of de)a.aj(M,ge.point,ge.angle);return{}}function $e(v,i,h,p,m,y){const I=v.add(v.sub(i)._unit()),E=m!==void 0?ye(I.x,I.y,m,y.getElevation).point:Fe(I.x,I.y,y).point,M=h.sub(E);return h.add(M._mult(p/M.mag()))}function j(v,i,h){const p=i.projectionCache;if(p.projections[v])return p.projections[v];const m=new a.P(i.lineVertexArray.getx(v),i.lineVertexArray.gety(v)),y=Fe(m.x,m.y,i);if(y.signedDistanceFromCamera>0)return p.projections[v]=y.point,p.anyProjectionOccluded=p.anyProjectionOccluded||y.isOccluded,y.point;const I=v-h.direction;return function(E,M,D,O,N){return $e(E,M,D,O,void 0,N)}(h.distanceFromAnchor===0?i.tileAnchorPoint:new a.P(i.lineVertexArray.getx(I),i.lineVertexArray.gety(I)),m,h.previousVertex,h.absOffsetX-h.distanceFromAnchor+1,i)}function Fe(v,i,h){const p=v+h.translation[0],m=i+h.translation[1];let y;return!h.pitchWithMap&&h.projection.useSpecialProjectionForSymbols?(y=h.projection.projectTileCoordinates(p,m,h.unwrappedTileID,h.getElevation),y.point.x=(.5*y.point.x+.5)*h.width,y.point.y=(.5*-y.point.y+.5)*h.height):(y=ye(p,m,h.labelPlaneMatrix,h.getElevation),y.isOccluded=!1),y}function Ke(v,i,h){return v._unit()._perp()._mult(i*h)}function Ne(v,i,h,p,m,y,I,E,M){if(E.projectionCache.offsets[v])return E.projectionCache.offsets[v];const D=h.add(i);if(v+M.direction<p||v+M.direction>=m)return E.projectionCache.offsets[v]=D,D;const O=j(v+M.direction,E,M),N=Ke(O.sub(h),I,M.direction),Q=h.add(N),se=O.add(N);return E.projectionCache.offsets[v]=a.ak(y,D,Q,se)||D,E.projectionCache.offsets[v]}function Xe(v,i,h,p,m,y,I,E,M){const D=p?v-i:v+i;let O=D>0?1:-1,N=0;p&&(O*=-1,N=Math.PI),O<0&&(N+=Math.PI);let Q,se=O>0?y+m:y+m+1;E.projectionCache.cachedAnchorPoint?Q=E.projectionCache.cachedAnchorPoint:(Q=Fe(E.tileAnchorPoint.x,E.tileAnchorPoint.y,E).point,E.projectionCache.cachedAnchorPoint=Q);let de,ge,xe=Q,ke=Q,Ce=0,me=0;const Re=Math.abs(D),Be=[];let He;for(;Ce+me<=Re;){if(se+=O,se<y||se>=I)return null;Ce+=me,ke=xe,ge=de;const It={absOffsetX:Re,direction:O,distanceFromAnchor:Ce,previousVertex:ke};if(xe=j(se,E,It),h===0)Be.push(ke),He=xe.sub(ke);else{let At;const kt=xe.sub(ke);At=kt.mag()===0?Ke(j(se+O,E,It).sub(xe),h,O):Ke(kt,h,O),ge||(ge=ke.add(At)),de=Ne(se,At,xe,y,I,ge,h,E,It),Be.push(ge),He=de.sub(ge)}me=He.mag()}const ot=He._mult((Re-Ce)/me)._add(ge||ke),wt=N+Math.atan2(xe.y-ke.y,xe.x-ke.x);return Be.push(ot),{point:ot,angle:M?wt:0,path:Be}}const _t=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Et(v,i){for(let h=0;h<v;h++){const p=i.length;i.resize(p+4),i.float32.set(_t,3*p)}}function pi(v,i,h){const p=i[0],m=i[1];return v[0]=h[0]*p+h[4]*m+h[12],v[1]=h[1]*p+h[5]*m+h[13],v[3]=h[3]*p+h[7]*m+h[15],v}const Qt=100;class ci{constructor(i,h,p=new zr(i.width+200,i.height+200,25),m=new zr(i.width+200,i.height+200,25)){this.transform=i,this.mapProjection=h,this.grid=p,this.ignoredGrid=m,this.pitchFactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Qt,this.screenBottomBoundary=i.height+Qt,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,h,p,m,y,I,E,M,D,O,N){const Q=i.anchorPointX+M[0],se=i.anchorPointY+M[1],de=this.projectAndGetPerspectiveRatio(m,Q,se,y,O),ge=p*de.perspectiveRatio;let xe;if(I||E)xe=this._projectCollisionBox(i,ge,m,y,I,E,M,de,O,N);else{const Be=de.point.x+(N?N.x*ge:0),He=de.point.y+(N?N.y*ge:0);xe={allPointsOccluded:!1,box:[Be+i.x1*ge,He+i.y1*ge,Be+i.x2*ge,He+i.y2*ge]}}const[ke,Ce,me,Re]=xe.box;return this.mapProjection.useSpecialProjectionForSymbols&&(I?xe.allPointsOccluded:this.mapProjection.isOccluded(Q,se,y))||de.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(ke,Ce,me,Re)||h!=="always"&&this.grid.hitTest(ke,Ce,me,Re,h,D)?{box:[ke,Ce,me,Re],placeable:!1,offscreen:!1}:{box:[ke,Ce,me,Re],placeable:!0,offscreen:this.isOffscreen(ke,Ce,me,Re)}}placeCollisionCircles(i,h,p,m,y,I,E,M,D,O,N,Q,se,de,ge,xe){const ke=[],Ce=new a.P(h.anchorX,h.anchorY),me=this.getPerspectiveRatio(I,Ce.x,Ce.y,E,xe),Re=(N?y/me:y*me)/a.ap,Be={getElevation:xe,labelPlaneMatrix:M,lineVertexArray:p,pitchWithMap:N,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Ce,unwrappedTileID:E,width:this.transform.width,height:this.transform.height,translation:ge},He=pe(Re,m,h.lineOffsetX*Re,h.lineOffsetY*Re,!1,h,!1,Be);let ot=!1,wt=!1,It=!0;if(He){const At=.5*se*me+de,kt=new a.P(-100,-100),xt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Nt=new ei,ri=He.first,St=He.last;let Lt=[];for(let fi=ri.path.length-1;fi>=1;fi--)Lt.push(ri.path[fi]);for(let fi=1;fi<St.path.length;fi++)Lt.push(St.path[fi]);const ti=2.5*At;if(D){const fi=this.projectPathToScreenSpace(Lt,Be,D);Lt=fi.some(ki=>ki.signedDistanceFromCamera<=0)?[]:fi.map(ki=>ki.point)}let Qi=[];if(Lt.length>0){const fi=Lt[0].clone(),ki=Lt[0].clone();for(let en=1;en<Lt.length;en++)fi.x=Math.min(fi.x,Lt[en].x),fi.y=Math.min(fi.y,Lt[en].y),ki.x=Math.max(ki.x,Lt[en].x),ki.y=Math.max(ki.y,Lt[en].y);Qi=fi.x>=kt.x&&ki.x<=xt.x&&fi.y>=kt.y&&ki.y<=xt.y?[Lt]:ki.x<kt.x||fi.x>xt.x||ki.y<kt.y||fi.y>xt.y?[]:a.al([Lt],kt.x,kt.y,xt.x,xt.y)}for(const fi of Qi){Nt.reset(fi,.25*At);let ki=0;ki=Nt.length<=.5*At?1:Math.ceil(Nt.paddedLength/ti)+1;for(let en=0;en<ki;en++){const er=en/Math.max(ki-1,1),so=Nt.lerp(er),tn=so.x+Qt,wr=so.y+Qt;ke.push(tn,wr,At,0);const hr=tn-At,tr=wr-At,dr=tn+At,wo=wr+At;if(It=It&&this.isOffscreen(hr,tr,dr,wo),wt=wt||this.isInsideGrid(hr,tr,dr,wo),i!=="always"&&this.grid.hitTestCircle(tn,wr,At,i,Q)&&(ot=!0,!O))return{circles:[],offscreen:!1,collisionDetected:ot}}}}return{circles:!O&&ot||!wt||me<this.perspectiveRatioCutoff?[]:ke,offscreen:It,collisionDetected:ot}}projectPathToScreenSpace(i,h,p){return i.map(m=>ye(m.x,m.y,p,h.getElevation))}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let p=1/0,m=1/0,y=-1/0,I=-1/0;for(const O of i){const N=new a.P(O.x+Qt,O.y+Qt);p=Math.min(p,N.x),m=Math.min(m,N.y),y=Math.max(y,N.x),I=Math.max(I,N.y),h.push(N)}const E=this.grid.query(p,m,y,I).concat(this.ignoredGrid.query(p,m,y,I)),M={},D={};for(const O of E){const N=O.key;if(M[N.bucketInstanceId]===void 0&&(M[N.bucketInstanceId]={}),M[N.bucketInstanceId][N.featureIndex])continue;const Q=[new a.P(O.x1,O.y1),new a.P(O.x2,O.y1),new a.P(O.x2,O.y2),new a.P(O.x1,O.y2)];a.am(h,Q)&&(M[N.bucketInstanceId][N.featureIndex]=!0,D[N.bucketInstanceId]===void 0&&(D[N.bucketInstanceId]=[]),D[N.bucketInstanceId].push(N.featureIndex))}return D}insertCollisionBox(i,h,p,m,y,I){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:I,overlapMode:h},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,h,p,m,y,I){const E=p?this.ignoredGrid:this.grid,M={bucketInstanceId:m,featureIndex:y,collisionGroupID:I,overlapMode:h};for(let D=0;D<i.length;D+=4)E.insertCircle(M,i[D],i[D+1],i[D+2])}projectAndGetPerspectiveRatio(i,h,p,m,y){let I;y?(I=[h,p,y(h,p),1],a.af(I,I,i)):(I=[h,p,0,1],pi(I,I,i));const E=I[3];return{point:new a.P((I[0]/E+1)/2*this.transform.width+Qt,(-I[1]/E+1)/2*this.transform.height+Qt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/E*.5,isOccluded:!1,signedDistanceFromCamera:E}}getPerspectiveRatio(i,h,p,m,y){const I=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(h,p,m,y):ye(h,p,i,y);return .5+this.transform.cameraToCenterDistance/I.signedDistanceFromCamera*.5}isOffscreen(i,h,p,m){return p<Qt||i>=this.screenRightBoundary||m<Qt||h>this.screenBottomBoundary}isInsideGrid(i,h,p,m){return p>=0&&i<this.gridRightBoundary&&m>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const i=a.an([]);return a.J(i,i,[-100,-100,0]),i}_projectCollisionBox(i,h,p,m,y,I,E,M,D,O){let N=new a.P(1,0),Q=new a.P(0,1);const se=new a.P(i.anchorPointX+E[0],i.anchorPointY+E[1]);if(I&&!y){const It=this.projectAndGetPerspectiveRatio(p,se.x+1,se.y,m,D).point.sub(M.point).unit(),At=Math.atan(It.y/It.x)+(It.x<0?Math.PI:0),kt=Math.sin(At),xt=Math.cos(At);N=new a.P(xt,kt),Q=new a.P(-kt,xt)}else if(!I&&y){const It=-this.transform.angle,At=Math.sin(It),kt=Math.cos(It);N=new a.P(kt,At),Q=new a.P(-At,kt)}let de=M.point,ge=h;if(y){de=se;const It=this.transform.zoom-Math.floor(this.transform.zoom);ge=Math.pow(2,-It),ge*=this.mapProjection.getPitchedTextCorrection(this.transform,se,m),O||(ge*=a.ac(.5+M.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}O&&(de=de.add(N.mult(O.x*ge)).add(Q.mult(O.y*ge)));const xe=i.x1*ge,ke=i.x2*ge,Ce=(xe+ke)/2,me=i.y1*ge,Re=i.y2*ge,Be=(me+Re)/2,He=[{offsetX:xe,offsetY:me},{offsetX:Ce,offsetY:me},{offsetX:ke,offsetY:me},{offsetX:ke,offsetY:Be},{offsetX:ke,offsetY:Re},{offsetX:Ce,offsetY:Re},{offsetX:xe,offsetY:Re},{offsetX:xe,offsetY:Be}];let ot=[];for(const{offsetX:It,offsetY:At}of He)ot.push(new a.P(de.x+N.x*It+Q.x*At,de.y+N.y*It+Q.y*At));let wt=!1;if(y){const It=ot.map(At=>this.projectAndGetPerspectiveRatio(p,At.x,At.y,m,D));wt=It.some(At=>!At.isOccluded),ot=It.map(At=>At.point)}else wt=!0;return{box:a.ao(ot),allPointsOccluded:!wt}}}function xi(v,i,h){return i*(a.X/(v.tileSize*Math.pow(2,h-v.tileID.overscaledZ)))}class Ln{constructor(i,h,p,m){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?h:-h))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class hn{constructor(i,h,p,m,y){this.text=new Ln(i?i.text:null,h,p,y),this.icon=new Ln(i?i.icon:null,h,m,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class _i{constructor(i,h,p){this.text=i,this.icon=h,this.skipFade=p}}class Ui{constructor(){this.invProjMatrix=a.H(),this.viewportMatrix=a.H(),this.circles=[]}}class on{constructor(i,h,p,m,y){this.bucketInstanceId=i,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=y}}class Nn{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const h=++this.maxGroupID;this.collisionGroups[i]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[i]}}function Gn(v,i,h,p,m){const{horizontalAlign:y,verticalAlign:I}=a.au(v);return new a.P(-(y-.5)*i+p[0]*m,-(I-.5)*h+p[1]*m)}class ur{constructor(i,h,p,m,y,I){this.transform=i.clone(),this.terrain=p,this.collisionIndex=new ci(this.transform,h),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new Nn(y),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=I,I&&(I.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(i){const h=this.terrain;return h?(p,m)=>h.getElevation(i,p,m):null}getBucketParts(i,h,p,m){const y=p.getBucket(h),I=p.latestFeatureIndex;if(!y||!I||h.id!==y.layerIds[0])return;const E=p.collisionBoxArray,M=y.layers[0].layout,D=y.layers[0].paint,O=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),N=p.tileSize/a.X,Q=p.tileID.toUnwrapped(),se=this.transform.calculatePosMatrix(Q),de=M.get("text-pitch-alignment")==="map",ge=M.get("text-rotation-alignment")==="map",xe=xi(p,1,this.transform.zoom),ke=this.collisionIndex.mapProjection.translatePosition(this.transform,p,D.get("text-translate"),D.get("text-translate-anchor")),Ce=this.collisionIndex.mapProjection.translatePosition(this.transform,p,D.get("icon-translate"),D.get("icon-translate-anchor")),me=Zr(se,de,ge,this.transform,xe);let Re=null;if(de){const He=yr(se,de,ge,this.transform,xe);Re=a.L([],this.transform.labelPlaneMatrix,He)}this.retainedQueryData[y.bucketInstanceId]=new on(y.bucketInstanceId,I,y.sourceLayerIndex,y.index,p.tileID);const Be={bucket:y,layout:M,translationText:ke,translationIcon:Ce,posMatrix:se,unwrappedTileID:Q,textLabelPlaneMatrix:me,labelToScreenMatrix:Re,scale:O,textPixelRatio:N,holdingForFade:p.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:a.ag(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(m)for(const He of y.sortKeyRanges){const{sortKey:ot,symbolInstanceStart:wt,symbolInstanceEnd:It}=He;i.push({sortKey:ot,symbolInstanceStart:wt,symbolInstanceEnd:It,parameters:Be})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:Be})}attemptAnchorPlacement(i,h,p,m,y,I,E,M,D,O,N,Q,se,de,ge,xe,ke,Ce,me){const Re=a.aq[i.textAnchor],Be=[i.textOffset0,i.textOffset1],He=Gn(Re,p,m,Be,y),ot=this.collisionIndex.placeCollisionBox(h,Q,M,D,O,E,I,xe,N.predicate,me,He);if((!Ce||this.collisionIndex.placeCollisionBox(Ce,Q,M,D,O,E,I,ke,N.predicate,me,He).placeable)&&ot.placeable){let wt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID].text&&(wt=this.prevPlacement.variableOffsets[se.crossTileID].anchor),se.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[se.crossTileID]={textOffset:Be,width:p,height:m,anchor:Re,textBoxScale:y,prevAnchor:wt},this.markUsedJustification(de,Re,se,ge),de.allowVerticalPlacement&&(this.markUsedOrientation(de,ge,se),this.placedOrientations[se.crossTileID]=ge),{shift:He,placedGlyphBoxes:ot}}}placeLayerBucketPart(i,h,p){const{bucket:m,layout:y,translationText:I,translationIcon:E,posMatrix:M,unwrappedTileID:D,textLabelPlaneMatrix:O,labelToScreenMatrix:N,textPixelRatio:Q,holdingForFade:se,collisionBoxArray:de,partiallyEvaluatedTextSize:ge,collisionGroup:xe}=i.parameters,ke=y.get("text-optional"),Ce=y.get("icon-optional"),me=a.ar(y,"text-overlap","text-allow-overlap"),Re=me==="always",Be=a.ar(y,"icon-overlap","icon-allow-overlap"),He=Be==="always",ot=y.get("text-rotation-alignment")==="map",wt=y.get("text-pitch-alignment")==="map",It=y.get("icon-text-fit")!=="none",At=y.get("symbol-z-order")==="viewport-y",kt=Re&&(He||!m.hasIconData()||Ce),xt=He&&(Re||!m.hasTextData()||ke);!m.collisionArrays&&de&&m.deserializeCollisionBoxes(de);const Nt=this._getTerrainElevationFunc(this.retainedQueryData[m.bucketInstanceId].tileID),ri=(St,Lt,ti)=>{var Qi,fi;if(h[St.crossTileID])return;if(se)return void(this.placements[St.crossTileID]=new _i(!1,!1,!1));let ki=!1,en=!1,er=!0,so=null,tn={box:null,placeable:!1,offscreen:null},wr={box:null,placeable:!1,offscreen:null},hr=null,tr=null,dr=null,wo=0,Gs=0,Al=0;Lt.textFeatureIndex?wo=Lt.textFeatureIndex:St.useRuntimeCollisionCircles&&(wo=St.featureIndex),Lt.verticalTextFeatureIndex&&(Gs=Lt.verticalTextFeatureIndex);const Ws=Lt.textBox;if(Ws){const Jr=Wn=>{let ir=a.ah.horizontal;if(m.allowVerticalPlacement&&!Wn&&this.prevPlacement){const Nr=this.prevPlacement.placedOrientations[St.crossTileID];Nr&&(this.placedOrientations[St.crossTileID]=Nr,ir=Nr,this.markUsedOrientation(m,ir,St))}return ir},Yr=(Wn,ir)=>{if(m.allowVerticalPlacement&&St.numVerticalGlyphVertices>0&&Lt.verticalTextBox){for(const Nr of m.writingModes)if(Nr===a.ah.vertical?(tn=ir(),wr=tn):tn=Wn(),tn&&tn.placeable)break}else tn=Wn()},Vo=St.textAnchorOffsetStartIndex,ao=St.textAnchorOffsetEndIndex;if(ao===Vo){const Wn=(ir,Nr)=>{const Ii=this.collisionIndex.placeCollisionBox(ir,me,Q,M,D,wt,ot,I,xe.predicate,Nt);return Ii&&Ii.placeable&&(this.markUsedOrientation(m,Nr,St),this.placedOrientations[St.crossTileID]=Nr),Ii};Yr(()=>Wn(Ws,a.ah.horizontal),()=>{const ir=Lt.verticalTextBox;return m.allowVerticalPlacement&&St.numVerticalGlyphVertices>0&&ir?Wn(ir,a.ah.vertical):{box:null,offscreen:null}}),Jr(tn&&tn.placeable)}else{let Wn=a.aq[(fi=(Qi=this.prevPlacement)===null||Qi===void 0?void 0:Qi.variableOffsets[St.crossTileID])===null||fi===void 0?void 0:fi.anchor];const ir=(Ii,as,Hs)=>{const Xs=Ii.x2-Ii.x1,Nh=Ii.y2-Ii.y1,ff=St.textBoxScale,jh=It&&Be==="never"?as:null;let qo=null,Uh=me==="never"?1:2,zl="never";Wn&&Uh++;for(let Oa=0;Oa<Uh;Oa++){for(let Dl=Vo;Dl<ao;Dl++){const Rl=m.textAnchorOffsets.get(Dl);if(Wn&&Rl.textAnchor!==Wn)continue;const Ks=this.attemptAnchorPlacement(Rl,Ii,Xs,Nh,ff,ot,wt,Q,M,D,xe,zl,St,m,Hs,I,E,jh,Nt);if(Ks&&(qo=Ks.placedGlyphBoxes,qo&&qo.placeable))return ki=!0,so=Ks.shift,qo}Wn?Wn=null:zl=me}return p&&!qo&&(qo={box:this.collisionIndex.placeCollisionBox(Ws,"always",Q,M,D,wt,ot,I,xe.predicate,Nt,new a.P(0,0)).box,offscreen:!1,placeable:!1}),qo};Yr(()=>ir(Ws,Lt.iconBox,a.ah.horizontal),()=>{const Ii=Lt.verticalTextBox;return m.allowVerticalPlacement&&(!tn||!tn.placeable)&&St.numVerticalGlyphVertices>0&&Ii?ir(Ii,Lt.verticalIconBox,a.ah.vertical):{box:null,occluded:!0,offscreen:null}}),tn&&(ki=tn.placeable,er=tn.offscreen);const Nr=Jr(tn&&tn.placeable);if(!ki&&this.prevPlacement){const Ii=this.prevPlacement.variableOffsets[St.crossTileID];Ii&&(this.variableOffsets[St.crossTileID]=Ii,this.markUsedJustification(m,Ii.anchor,St,Nr))}}}if(hr=tn,ki=hr&&hr.placeable,er=hr&&hr.offscreen,St.useRuntimeCollisionCircles){const Jr=m.text.placedSymbolArray.get(St.centerJustifiedTextSymbolIndex),Yr=a.ai(m.textSizeData,ge,Jr),Vo=y.get("text-padding");tr=this.collisionIndex.placeCollisionCircles(me,Jr,m.lineVertexArray,m.glyphOffsetArray,Yr,M,D,O,N,p,wt,xe.predicate,St.collisionCircleDiameter,Vo,I,Nt),tr.circles.length&&tr.collisionDetected&&!p&&a.w("Collisions detected, but collision boxes are not shown"),ki=Re||tr.circles.length>0&&!tr.collisionDetected,er=er&&tr.offscreen}if(Lt.iconFeatureIndex&&(Al=Lt.iconFeatureIndex),Lt.iconBox){const Jr=Yr=>this.collisionIndex.placeCollisionBox(Yr,Be,Q,M,D,wt,ot,E,xe.predicate,Nt,It&&so?so:void 0);wr&&wr.placeable&&Lt.verticalIconBox?(dr=Jr(Lt.verticalIconBox),en=dr.placeable):(dr=Jr(Lt.iconBox),en=dr.placeable),er=er&&dr.offscreen}const Kr=ke||St.numHorizontalGlyphVertices===0&&St.numVerticalGlyphVertices===0,Pl=Ce||St.numIconVertices===0;Kr||Pl?Pl?Kr||(en=en&&ki):ki=en&&ki:en=ki=en&&ki;const cu=en&&dr.placeable;if(ki&&hr.placeable&&this.collisionIndex.insertCollisionBox(hr.box,me,y.get("text-ignore-placement"),m.bucketInstanceId,wr&&wr.placeable&&Gs?Gs:wo,xe.ID),cu&&this.collisionIndex.insertCollisionBox(dr.box,Be,y.get("icon-ignore-placement"),m.bucketInstanceId,Al,xe.ID),tr&&ki&&this.collisionIndex.insertCollisionCircles(tr.circles,me,y.get("text-ignore-placement"),m.bucketInstanceId,wo,xe.ID),p&&this.storeCollisionData(m.bucketInstanceId,ti,Lt,hr,dr,tr),St.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[St.crossTileID]=new _i(ki||kt,en||xt,er||m.justReloaded),h[St.crossTileID]=!0};if(At){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const St=m.getSortedSymbolIndexes(this.transform.angle);for(let Lt=St.length-1;Lt>=0;--Lt){const ti=St[Lt];ri(m.symbolInstances.get(ti),m.collisionArrays[ti],ti)}}else for(let St=i.symbolInstanceStart;St<i.symbolInstanceEnd;St++)ri(m.symbolInstances.get(St),m.collisionArrays[St],St);if(p&&m.bucketInstanceId in this.collisionCircleArrays){const St=this.collisionCircleArrays[m.bucketInstanceId];a.as(St.invProjMatrix,M),St.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}storeCollisionData(i,h,p,m,y,I){if(p.textBox||p.iconBox){let E,M;this.collisionBoxArrays.has(i)?E=this.collisionBoxArrays.get(i):(E=new Map,this.collisionBoxArrays.set(i,E)),E.has(h)?M=E.get(h):(M={text:null,icon:null},E.set(h,M)),p.textBox&&(M.text=m.box),p.iconBox&&(M.icon=y.box)}if(I){let E=this.collisionCircleArrays[i];E===void 0&&(E=this.collisionCircleArrays[i]=new Ui);for(let M=0;M<I.circles.length;M+=4)E.circles.push(I.circles[M+0]),E.circles.push(I.circles[M+1]),E.circles.push(I.circles[M+2]),E.circles.push(I.collisionDetected?1:0)}}markUsedJustification(i,h,p,m){let y;y=m===a.ah.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[a.at(h)];const I=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const E of I)E>=0&&(i.text.placedSymbolArray.get(E).crossTileID=y>=0&&E!==y?0:p.crossTileID)}markUsedOrientation(i,h,p){const m=h===a.ah.horizontal||h===a.ah.horizontalOnly?h:0,y=h===a.ah.vertical?h:0,I=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const E of I)i.text.placedSymbolArray.get(E).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const m=h?h.symbolFadeChange(i):1,y=h?h.opacities:{},I=h?h.variableOffsets:{},E=h?h.placedOrientations:{};for(const M in this.placements){const D=this.placements[M],O=y[M];O?(this.opacities[M]=new hn(O,m,D.text,D.icon),p=p||D.text!==O.text.placed||D.icon!==O.icon.placed):(this.opacities[M]=new hn(null,m,D.text,D.icon,D.skipFade),p=p||D.text||D.icon)}for(const M in y){const D=y[M];if(!this.opacities[M]){const O=new hn(D,m,!1,!1);O.isHidden()||(this.opacities[M]=O,p=p||D.text.placed||D.icon.placed)}}for(const M in I)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=I[M]);for(const M in E)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=E[M]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:i)}updateLayerOpacities(i,h){const p={};for(const m of h){const y=m.getBucket(i);y&&m.latestFeatureIndex&&i.id===y.layerIds[0]&&this.updateBucketOpacities(y,m.tileID,p,m.collisionBoxArray)}}updateBucketOpacities(i,h,p,m){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const y=i.layers[0],I=y.layout,E=new hn(null,0,!1,!1,!0),M=I.get("text-allow-overlap"),D=I.get("icon-allow-overlap"),O=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),N=I.get("text-rotation-alignment")==="map",Q=I.get("text-pitch-alignment")==="map",se=I.get("icon-text-fit")!=="none",de=new hn(null,0,M&&(D||!i.hasIconData()||I.get("icon-optional")),D&&(M||!i.hasTextData()||I.get("text-optional")),!0);!i.collisionArrays&&m&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(m);const ge=(ke,Ce,me)=>{for(let Re=0;Re<Ce/4;Re++)ke.opacityVertexArray.emplaceBack(me);ke.hasVisibleVertices=ke.hasVisibleVertices||me!==Ts},xe=this.collisionBoxArrays.get(i.bucketInstanceId);for(let ke=0;ke<i.symbolInstances.length;ke++){const Ce=i.symbolInstances.get(ke),{numHorizontalGlyphVertices:me,numVerticalGlyphVertices:Re,crossTileID:Be}=Ce;let He=this.opacities[Be];p[Be]?He=E:He||(He=de,this.opacities[Be]=He),p[Be]=!0;const ot=Ce.numIconVertices>0,wt=this.placedOrientations[Ce.crossTileID],It=wt===a.ah.vertical,At=wt===a.ah.horizontal||wt===a.ah.horizontalOnly;if(me>0||Re>0){const xt=Fr(He.text);ge(i.text,me,It?Ts:xt),ge(i.text,Re,At?Ts:xt);const Nt=He.text.isHidden();[Ce.rightJustifiedTextSymbolIndex,Ce.centerJustifiedTextSymbolIndex,Ce.leftJustifiedTextSymbolIndex].forEach(Lt=>{Lt>=0&&(i.text.placedSymbolArray.get(Lt).hidden=Nt||It?1:0)}),Ce.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(Ce.verticalPlacedTextSymbolIndex).hidden=Nt||At?1:0);const ri=this.variableOffsets[Ce.crossTileID];ri&&this.markUsedJustification(i,ri.anchor,Ce,wt);const St=this.placedOrientations[Ce.crossTileID];St&&(this.markUsedJustification(i,"left",Ce,St),this.markUsedOrientation(i,St,Ce))}if(ot){const xt=Fr(He.icon),Nt=!(se&&Ce.verticalPlacedIconSymbolIndex&&It);Ce.placedIconSymbolIndex>=0&&(ge(i.icon,Ce.numIconVertices,Nt?xt:Ts),i.icon.placedSymbolArray.get(Ce.placedIconSymbolIndex).hidden=He.icon.isHidden()),Ce.verticalPlacedIconSymbolIndex>=0&&(ge(i.icon,Ce.numVerticalIconVertices,Nt?Ts:xt),i.icon.placedSymbolArray.get(Ce.verticalPlacedIconSymbolIndex).hidden=He.icon.isHidden())}const kt=xe&&xe.has(ke)?xe.get(ke):{text:null,icon:null};if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const xt=i.collisionArrays[ke];if(xt){let Nt=new a.P(0,0);if(xt.textBox||xt.verticalTextBox){let ri=!0;if(O){const St=this.variableOffsets[Be];St?(Nt=Gn(St.anchor,St.width,St.height,St.textOffset,St.textBoxScale),N&&Nt._rotate(Q?this.transform.angle:-this.transform.angle)):ri=!1}if(xt.textBox||xt.verticalTextBox){let St;xt.textBox&&(St=It),xt.verticalTextBox&&(St=At),Ss(i.textCollisionBox.collisionVertexArray,He.text.placed,!ri||St,kt.text,Nt.x,Nt.y)}}if(xt.iconBox||xt.verticalIconBox){const ri=!!(!At&&xt.verticalIconBox);let St;xt.iconBox&&(St=ri),xt.verticalIconBox&&(St=!ri),Ss(i.iconCollisionBox.collisionVertexArray,He.icon.placed,St,kt.icon,se?Nt.x:0,se?Nt.y:0)}}}}if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);if(i.bucketInstanceId in this.collisionCircleArrays){const ke=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=ke.invProjMatrix,i.placementViewportMatrix=ke.viewportMatrix,i.collisionCircleArray=ke.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>i}setStale(){this.stale=!0}}function Ss(v,i,h,p,m,y){p&&p.length!==0||(p=[0,0,0,0]);const I=p[0]-Qt,E=p[1]-Qt,M=p[2]-Qt,D=p[3]-Qt;v.emplaceBack(i?1:0,h?1:0,m||0,y||0,I,E),v.emplaceBack(i?1:0,h?1:0,m||0,y||0,M,E),v.emplaceBack(i?1:0,h?1:0,m||0,y||0,M,D),v.emplaceBack(i?1:0,h?1:0,m||0,y||0,I,D)}const $i=Math.pow(2,25),vc=Math.pow(2,24),wc=Math.pow(2,17),Dr=Math.pow(2,16),Rr=Math.pow(2,9),jd=Math.pow(2,8),Gr=Math.pow(2,1);function Fr(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const i=v.placed?1:0,h=Math.floor(127*v.opacity);return h*$i+i*vc+h*wc+i*Dr+h*Rr+i*jd+h*Gr+i}const Ts=0;function Xo(){return{isOccluded:(v,i,h)=>!1,getPitchedTextCorrection:(v,i,h)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(v,i,h,p){throw new Error("Not implemented.")},translatePosition:(v,i,h,p)=>function(m,y,I,E,M=!1){if(!I[0]&&!I[1])return[0,0];const D=M?E==="map"?m.angle:0:E==="viewport"?-m.angle:0;if(D){const O=Math.sin(D),N=Math.cos(D);I=[I[0]*N-I[1]*O,I[0]*O+I[1]*N]}return[M?I[0]:xi(y,I[0],m.zoom),M?I[1]:xi(y,I[1],m.zoom)]}(v,i,h,p),getCircleRadiusCorrection:v=>1}}class Mn{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,h,p,m,y){const I=this._bucketParts;for(;this._currentTileIndex<i.length;)if(h.getBucketParts(I,m,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((E,M)=>E.sortKey-M.sortKey));this._currentPartIndex<I.length;)if(h.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,y())return!0;return!1}}class va{constructor(i,h,p,m,y,I,E,M){this.placement=new ur(i,Xo(),h,I,E,M),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(i,h,p){const m=S.now(),y=()=>!this._forceFullPlacement&&S.now()-m>2;for(;this._currentPlacementIndex>=0;){const I=h[i[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=E)&&(!I.maxzoom||I.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new Mn(I)),this._inProgressLayer.continuePlacement(p[I.source],this.placement,this._showCollisionBoxes,I,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const to=512/a.X/2;class Cn{constructor(i,h,p){this.tileID=i,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let y=0;y<h.length;y++){const I=h.get(y),E=I.key,M=m.get(E);M?M.push(I):m.set(E,[I])}for(const[y,I]of m){const E={positions:I.map(M=>({x:Math.floor(M.anchorX*to),y:Math.floor(M.anchorY*to)})),crossTileIDs:I.map(M=>M.crossTileID)};if(E.positions.length>128){const M=new a.av(E.positions.length,16,Uint16Array);for(const{x:D,y:O}of E.positions)M.add(D,O);M.finish(),delete E.positions,E.index=M}this._symbolsByKey[y]=E}}getScaledCoordinates(i,h){const{x:p,y:m,z:y}=this.tileID.canonical,{x:I,y:E,z:M}=h.canonical,D=to/Math.pow(2,M-y),O=(E*a.X+i.anchorY)*D,N=m*a.X*to;return{x:Math.floor((I*a.X+i.anchorX)*D-p*a.X*to),y:Math.floor(O-N)}}findMatches(i,h,p){const m=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let y=0;y<i.length;y++){const I=i.get(y);if(I.crossTileID)continue;const E=this._symbolsByKey[I.key];if(!E)continue;const M=this.getScaledCoordinates(I,h);if(E.index){const D=E.index.range(M.x-m,M.y-m,M.x+m,M.y+m).sort();for(const O of D){const N=E.crossTileIDs[O];if(!p[N]){p[N]=!0,I.crossTileID=N;break}}}else if(E.positions)for(let D=0;D<E.positions.length;D++){const O=E.positions[D],N=E.crossTileIDs[D];if(Math.abs(O.x-M.x)<=m&&Math.abs(O.y-M.y)<=m&&!p[N]){p[N]=!0,I.crossTileID=N;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:i})=>i)}}class el{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class io{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const h=Math.round((i-this.lng)/360);if(h!==0)for(const p in this.indexes){const m=this.indexes[p],y={};for(const I in m){const E=m[I];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+h),y[E.tileID.key]=E}this.indexes[p]=y}this.lng=i}addBucket(i,h,p){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let y=0;y<h.symbolInstances.length;y++)h.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const m=this.usedCrossTileIDs[i.overscaledZ];for(const y in this.indexes){const I=this.indexes[y];if(Number(y)>i.overscaledZ)for(const E in I){const M=I[E];M.tileID.isChildOf(i)&&M.findMatches(h.symbolInstances,i,m)}else{const E=I[i.scaledTo(Number(y)).key];E&&E.findMatches(h.symbolInstances,i,m)}}for(let y=0;y<h.symbolInstances.length;y++){const I=h.symbolInstances.get(y);I.crossTileID||(I.crossTileID=p.generate(),m[I.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Cn(i,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(i,h){for(const p of h.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[i][m]}removeStaleBuckets(i){let h=!1;for(const p in this.indexes){const m=this.indexes[p];for(const y in m)i[m[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[y]),delete m[y],h=!0)}return h}}class xc{constructor(){this.layerIndexes={},this.crossTileIDs=new el,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,h,p){let m=this.layerIndexes[i.id];m===void 0&&(m=this.layerIndexes[i.id]=new io);let y=!1;const I={};m.handleWrapJump(p);for(const E of h){const M=E.getBucket(i);M&&i.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(E.tileID,M,this.crossTileIDs)&&(y=!0),I[M.bucketInstanceId]=!0)}return m.removeStaleBuckets(I)&&(y=!0),y}pruneUnusedLayers(i){const h={};i.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}const no=(v,i)=>a.t(v,i&&i.filter(h=>h.identifier!=="source.canvas")),Ud=a.aw();class tl extends a.E{constructor(i,h={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const m=this.sourceCaches[p].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[p].reload()}},this.map=i,this.dispatcher=new Ri(Si(),i._getMapId()),this.dispatcher.registerMessageHandler("GG",(p,m)=>this.getGlyphs(p,m)),this.dispatcher.registerMessageHandler("GI",(p,m)=>this.getImages(p,m)),this.imageManager=new We,this.imageManager.setEventedParent(this),this.glyphManager=new it(i._requestManager,h.localIdeographFontFamily),this.lineAtlas=new at(256,512),this.crossTileSymbolIndex=new xc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ay()),On().on(ct,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const m=this.sourceCaches[p.sourceId];if(!m)return;const y=m.getSource();if(y&&y.vectorLayerIds)for(const I in this._layers){const E=this._layers[I];E.source===y.id&&this._validateLayer(E)}})}loadURL(i,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const m=this.map._requestManager.transformRequest(i,"Style");this._loadStyleRequest=new AbortController;const y=this._loadStyleRequest;a.h(m,this._loadStyleRequest).then(I=>{this._loadStyleRequest=null,this._load(I.data,h,p)}).catch(I=>{this._loadStyleRequest=null,I&&!y.signal.aborted&&this.fire(new a.j(I))})}loadJSON(i,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(i,h,p)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(Ud,{validate:!1})}_load(i,h,p){var m;const y=h.transformStyle?h.transformStyle(p,i):i;if(!h.validate||!no(this,a.u(y))){this._loaded=!0,this.stylesheet=y;for(const I in y.sources)this.addSource(I,y.sources[I],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new jt(this.stylesheet.light),this.sky=new et(this.stylesheet.sky),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const i=a.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",i),this._order=i.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of i){const p=a.aA(h);p.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=p}}_loadSprite(i,h=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(y,I,E,M){return a._(this,void 0,void 0,function*(){const D=ue(y),O=E>1?"@2x":"",N={},Q={};for(const{id:se,url:de}of D){const ge=I.transformRequest(fe(de,O,".json"),"SpriteJSON");N[se]=a.h(ge,M);const xe=I.transformRequest(fe(de,O,".png"),"SpriteImage");Q[se]=K.getImage(xe,M)}return yield Promise.all([...Object.values(N),...Object.values(Q)]),function(se,de){return a._(this,void 0,void 0,function*(){const ge={};for(const xe in se){ge[xe]={};const ke=S.getImageCanvasContext((yield de[xe]).data),Ce=(yield se[xe]).data;for(const me in Ce){const{width:Re,height:Be,x:He,y:ot,sdf:wt,pixelRatio:It,stretchX:At,stretchY:kt,content:xt,textFitWidth:Nt,textFitHeight:ri}=Ce[me];ge[xe][me]={data:null,pixelRatio:It,sdf:wt,stretchX:At,stretchY:kt,content:xt,textFitWidth:Nt,textFitHeight:ri,spriteData:{width:Re,height:Be,x:He,y:ot,context:ke}}}}return ge})}(N,Q)})}(i,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(y=>{if(this._spriteRequest=null,y)for(const I in y){this._spritesImagesIds[I]=[];const E=this._spritesImagesIds[I]?this._spritesImagesIds[I].filter(M=>!(M in y)):[];for(const M of E)this.imageManager.removeImage(M),this._changedImages[M]=!0;for(const M in y[I]){const D=I==="default"?M:`${I}:${M}`;this._spritesImagesIds[I].push(D),D in this.imageManager.images?this.imageManager.updateImage(D,y[I][M],!1):this.imageManager.addImage(D,y[I][M]),h&&(this._changedImages[D]=!0)}}}).catch(y=>{this._spriteRequest=null,m=y,this.fire(new a.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(i){const h=this.sourceCaches[i.source];if(!h)return;const p=i.sourceLayer;if(!p)return;const m=h.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.j(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i,h=!1){const p=this._serializedAllLayers();if(!i||i.length===0)return Object.values(h?a.aB(p):p);const m=[];for(const y of i)if(p[y]){const I=h?a.aB(p[y]):p[y];m.push(I)}return m}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const h=Object.keys(this._layers);for(const p of h){const m=this._layers[p];m.type!=="custom"&&(i[p]=m.serialize())}return i}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const h=this._changed;if(h){const m=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(m.length||y.length)&&this._updateWorkerLayers(m,y);for(const I in this._updatedSources){const E=this._updatedSources[I];if(E==="reload")this._reloadSource(I);else{if(E!=="clear")throw new Error(`Invalid action ${E}`);this._clearSource(I)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(i);this.light.updateTransitions(i),this.sky.updateTransitions(i),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const y=this.sourceCaches[m];p[m]=y.used,y.used=!1}for(const m of this._order){const y=this._layers[m];y.recalculate(i,this._availableImages),!y.isHidden(i.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const m in p){const y=this.sourceCaches[m];!!p[m]!=!!y.used&&y.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(i),this.sky.recalculate(i),this.z=i.zoom,h&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(i,!1),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,h={}){var p;this._checkLoaded();const m=this.serialize();if(i=h.transformStyle?h.transformStyle(m,i):i,((p=h.validate)===null||p===void 0||p)&&no(this,a.u(i)))return!1;(i=a.aB(i)).layers=a.az(i.layers);const y=a.aC(m,i),I=this._getOperationsToPerform(y);if(I.unimplemented.length>0)throw new Error(`Unimplemented: ${I.unimplemented.join(", ")}.`);if(I.operations.length===0)return!1;for(const E of I.operations)E();return this.stylesheet=i,this._serializedLayers=null,!0}_getOperationsToPerform(i){const h=[],p=[];for(const m of i)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":h.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":h.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,m.args));break;case"setSky":h.push(()=>this.setSky.apply(this,m.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":h.push(()=>{});break;default:p.push(m.command)}return{operations:h,unimplemented:p}}addImage(i,h){if(this.getImage(i))return this.fire(new a.j(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,h),this._afterImageUpdated(i)}updateImage(i,h){this.imageManager.updateImage(i,h)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new a.j(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,h,p={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.u.source,`sources.${i}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const m=this.sourceCaches[i]=new Jt(i,h,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:i})),m.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===i)return this.fire(new a.j(new Error(`Source "${i}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],h.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,h){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const p=this.sourceCaches[i].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,h,p={}){this._checkLoaded();const m=i.id;if(this.getLayer(m))return void this.fire(new a.j(new Error(`Layer "${m}" already exists on this map.`)));let y;if(i.type==="custom"){if(no(this,a.aD(i)))return;y=a.aA(i)}else{if("source"in i&&typeof i.source=="object"&&(this.addSource(m,i.source),i=a.aB(i),i=a.e(i,{source:m})),this._validate(a.u.layer,`layers.${m}`,i,{arrayIndex:-1},p))return;y=a.aA(i),this._validateLayer(y),y.setEventedParent(this,{layer:{id:m}})}const I=h?this._order.indexOf(h):this._order.length;if(h&&I===-1)this.fire(new a.j(new Error(`Cannot add layer "${m}" before non-existing layer "${h}".`)));else{if(this._order.splice(I,0,m),this._layerOrderChanged=!0,this._layers[m]=y,this._removedLayers[m]&&y.source&&y.type!=="custom"){const E=this._removedLayers[m];delete this._removedLayers[m],E.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(i,h){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new a.j(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===h)return;const p=this._order.indexOf(i);this._order.splice(p,1);const m=h?this._order.indexOf(h):this._order.length;h&&m===-1?this.fire(new a.j(new Error(`Cannot move layer "${i}" before non-existing layer "${h}".`))):(this._order.splice(m,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const h=this._layers[i];if(!h)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${i}".`)));h.setEventedParent(null);const p=this._order.indexOf(i);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=h,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],h.onRemove&&h.onRemove(this.map)}getLayer(i){return this._layers[i]}getLayersOrder(){return[...this._order]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,h,p){this._checkLoaded();const m=this.getLayer(i);m?m.minzoom===h&&m.maxzoom===p||(h!=null&&(m.minzoom=h),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,h,p={}){this._checkLoaded();const m=this.getLayer(i);if(m){if(!a.aE(m.filter,h))return h==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(a.u.filter,`layers.${m.id}.filter`,h,null,p)||(m.filter=a.aB(h),this._updateLayer(m)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return a.aB(this.getLayer(i).filter)}setLayoutProperty(i,h,p,m={}){this._checkLoaded();const y=this.getLayer(i);y?a.aE(y.getLayoutProperty(h),p)||(y.setLayoutProperty(h,p,m),this._updateLayer(y)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,h){const p=this.getLayer(i);if(p)return p.getLayoutProperty(h);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,h,p,m={}){this._checkLoaded();const y=this.getLayer(i);y?a.aE(y.getPaintProperty(h),p)||(y.setPaintProperty(h,p,m)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[i]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${i}".`)))}getPaintProperty(i,h){return this.getLayer(i).getPaintProperty(h)}setFeatureState(i,h){this._checkLoaded();const p=i.source,m=i.sourceLayer,y=this.sourceCaches[p];if(y===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const I=y.getSource().type;I==="geojson"&&m?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||m?(i.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),y.setFeatureState(m,i.id,h)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,h){this._checkLoaded();const p=i.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const y=m.getSource().type,I=y==="vector"?i.sourceLayer:void 0;y!=="vector"||I?h&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(I,i.id,h):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const h=i.source,p=i.sourceLayer,m=this.sourceCaches[h];if(m!==void 0)return m.getSource().type!=="vector"||p?(i.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,i.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const i=a.aF(this.sourceCaches,y=>y.serialize()),h=this._serializeByIds(this._order,!0),p=this.map.getTerrain()||void 0,m=this.stylesheet;return a.aG({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:i,layers:h,terrain:p},y=>y!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const h=I=>this._layers[I].type==="fill-extrusion",p={},m=[];for(let I=this._order.length-1;I>=0;I--){const E=this._order[I];if(h(E)){p[E]=I;for(const M of i){const D=M[E];if(D)for(const O of D)m.push(O)}}}m.sort((I,E)=>E.intersectionZ-I.intersectionZ);const y=[];for(let I=this._order.length-1;I>=0;I--){const E=this._order[I];if(h(E))for(let M=m.length-1;M>=0;M--){const D=m[M].feature;if(p[D.layer.id]<I)break;y.push(D),m.pop()}else for(const M of i){const D=M[E];if(D)for(const O of D)y.push(O.feature)}}return y}queryRenderedFeatures(i,h,p){h&&h.filter&&this._validate(a.u.filter,"queryRenderedFeatures.filter",h.filter,null,h);const m={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const E of h.layers){const M=this._layers[E];if(!M)return this.fire(new a.j(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];m[M.source]=!0}}const y=[];h.availableImages=this._availableImages;const I=this._serializedAllLayers();for(const E in this.sourceCaches)h.layers&&!m[E]||y.push(lt(this.sourceCaches[E],this._layers,I,i,h,p));return this.placement&&y.push(function(E,M,D,O,N,Q,se){const de={},ge=Q.queryRenderedSymbols(O),xe=[];for(const ke of Object.keys(ge).map(Number))xe.push(se[ke]);xe.sort(qe);for(const ke of xe){const Ce=ke.featureIndex.lookupSymbolFeatures(ge[ke.bucketInstanceId],M,ke.bucketIndex,ke.sourceLayerIndex,N.filter,N.layers,N.availableImages,E);for(const me in Ce){const Re=de[me]=de[me]||[],Be=Ce[me];Be.sort((He,ot)=>{const wt=ke.featureSortOrder;if(wt){const It=wt.indexOf(He.featureIndex);return wt.indexOf(ot.featureIndex)-It}return ot.featureIndex-He.featureIndex});for(const He of Be)Re.push(He)}}for(const ke in de)de[ke].forEach(Ce=>{const me=Ce.feature,Re=D[E[ke].source].getFeatureState(me.layer["source-layer"],me.id);me.source=me.layer.source,me.layer["source-layer"]&&(me.sourceLayer=me.layer["source-layer"]),me.state=Re});return de}(this._layers,I,this.sourceCaches,i,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(i,h){h&&h.filter&&this._validate(a.u.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[i];return p?function(m,y){const I=m.getRenderableIds().map(D=>m.getTileByID(D)),E=[],M={};for(let D=0;D<I.length;D++){const O=I[D],N=O.tileID.canonical.key;M[N]||(M[N]=!0,O.querySourceFeatures(E,y))}return E}(p,h):[]}getLight(){return this.light.getLight()}setLight(i,h={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const I in i)if(!a.aE(i[I],p[I])){m=!0;break}if(!m)return;const y={now:S.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,h),this.light.updateTransitions(y)}getSky(){var i;return(i=this.stylesheet)===null||i===void 0?void 0:i.sky}setSky(i,h={}){const p=this.getSky();let m=!1;if(!i&&!p)return;if(i&&!p)m=!0;else if(!i&&p)m=!0;else for(const I in i)if(!a.aE(i[I],p[I])){m=!0;break}if(!m)return;const y={now:S.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=i,this.sky.setSky(i,h),this.sky.updateTransitions(y)}_validate(i,h,p,m,y={}){return(!y||y.validate!==!1)&&no(this,i.call(a.u,a.e({key:h,style:this.serialize(),value:p,styleSpec:a.v},m)))}_remove(i=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),On().off(ct,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const p=this.sourceCaches[h];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),i&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const h in this.sourceCaches)this.sourceCaches[h].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,h,p,m,y=!1){let I=!1,E=!1;const M={};for(const D of this._order){const O=this._layers[D];if(O.type!=="symbol")continue;if(!M[O.source]){const Q=this.sourceCaches[O.source];M[O.source]=Q.getRenderableIds(!0).map(se=>Q.getTileByID(se)).sort((se,de)=>de.tileID.overscaledZ-se.tileID.overscaledZ||(se.tileID.isLessThan(de.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(O,M[O.source],i.center.lng);I=I||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(S.now(),i.zoom))&&(this.pauseablePlacement=new va(i,this.map.terrain,this._order,y,h,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(S.now()),E=!0),I&&this.pauseablePlacement.placement.setStale()),E||I)for(const D of this._order){const O=this._layers[D];O.type==="symbol"&&this.placement.updateLayerOpacities(O,M[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(S.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,h){return a._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,h.icons),p})}getGlyphs(i,h){return a._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(h.stacks),m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,h={}){this._checkLoaded(),i&&this._validate(a.u.glyphs,"glyphs",i,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}addSprite(i,h,p={},m){this._checkLoaded();const y=[{id:i,url:h}],I=[...ue(this.stylesheet.sprite),...y];this._validate(a.u.sprite,"sprite",I,null,p)||(this.stylesheet.sprite=I,this._loadSprite(y,!0,m))}removeSprite(i){this._checkLoaded();const h=ue(this.stylesheet.sprite);if(h.find(p=>p.id===i)){if(this._spritesImagesIds[i])for(const p of this._spritesImagesIds[i])this.imageManager.removeImage(p),this._changedImages[p]=!0;h.splice(h.findIndex(p=>p.id===i),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return ue(this.stylesheet.sprite)}setSprite(i,h={},p){this._checkLoaded(),i&&this._validate(a.u.sprite,"sprite",i,null,h)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,p):(this._unloadSprite(),p&&p(null)))}}var Ko=a.Y([{name:"a_pos",type:"Int16",components:2}]);const Uo={prelude:Bi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Bi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Bi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Bi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Bi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Bi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Bi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Bi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Bi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Bi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Bi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Bi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Bi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Bi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Bi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Bi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Bi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Bi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Bi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Bi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Bi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Bi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Bi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Bi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Bi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Bi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Bi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Bi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Bi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Bi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Bi(v,i){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=i.match(/attribute ([\w]+) ([\w]+)/g),m=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=y?y.concat(m):m,E={};return{fragmentSource:v=v.replace(h,(M,D,O,N,Q)=>(E[Q]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
varying ${O} ${N} ${Q};
#else
uniform ${O} ${N} u_${Q};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Q}
    ${O} ${N} ${Q} = u_${Q};
#endif
`)),vertexSource:i=i.replace(h,(M,D,O,N,Q)=>{const se=N==="float"?"vec2":"vec4",de=Q.match(/color/)?"color":se;return E[Q]?D==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
attribute ${O} ${se} a_${Q};
varying ${O} ${N} ${Q};
#else
uniform ${O} ${N} u_${Q};
#endif
`:de==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = a_${Q};
#else
    ${O} ${N} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = unpack_mix_${de}(a_${Q}, u_${Q}_t);
#else
    ${O} ${N} ${Q} = u_${Q};
#endif
`:D==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
attribute ${O} ${se} a_${Q};
#else
uniform ${O} ${N} u_${Q};
#endif
`:de==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${O} ${N} ${Q} = a_${Q};
#else
    ${O} ${N} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${O} ${N} ${Q} = unpack_mix_${de}(a_${Q}, u_${Q}_t);
#else
    ${O} ${N} ${Q} = u_${Q};
#endif
`}),staticAttributes:p,staticUniforms:I}}class kc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,h,p,m,y,I,E,M,D){this.context=i;let O=this.boundPaintVertexBuffers.length!==m.length;for(let N=0;!O&&N<m.length;N++)this.boundPaintVertexBuffers[N]!==m[N]&&(O=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==p||O||this.boundIndexBuffer!==y||this.boundVertexOffset!==I||this.boundDynamicVertexBuffer!==E||this.boundDynamicVertexBuffer2!==M||this.boundDynamicVertexBuffer3!==D?this.freshBind(h,p,m,y,I,E,M,D):(i.bindVertexArray.set(this.vao),E&&E.bind(),y&&y.dynamicDraw&&y.bind(),M&&M.bind(),D&&D.bind())}freshBind(i,h,p,m,y,I,E,M){const D=i.numAttributes,O=this.context,N=O.gl;this.vao&&this.destroy(),this.vao=O.createVertexArray(),O.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=M,h.enableAttributes(N,i);for(const Q of p)Q.enableAttributes(N,i);I&&I.enableAttributes(N,i),E&&E.enableAttributes(N,i),M&&M.enableAttributes(N,i),h.bind(),h.setVertexAttribPointers(N,i,y);for(const Q of p)Q.bind(),Q.setVertexAttribPointers(N,i,y);I&&(I.bind(),I.setVertexAttribPointers(N,i,y)),m&&m.bind(),E&&(E.bind(),E.setVertexAttribPointers(N,i,y)),M&&(M.bind(),M.setVertexAttribPointers(N,i,y)),O.currentNumAttributes=D}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Sc=(v,i,h,p,m)=>({u_matrix:v,u_texture:0,u_ele_delta:i,u_fog_matrix:h,u_fog_color:p?p.properties.get("fog-color"):a.aM.white,u_fog_ground_blend:p?p.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?p.calculateFogBlendOpacity(m):0,u_horizon_color:p?p.properties.get("horizon-color"):a.aM.white,u_horizon_fog_blend:p?p.properties.get("horizon-fog-blend"):1});function Is(v){const i=[];for(let h=0;h<v.length;h++){if(v[h]===null)continue;const p=v[h].split(" ");i.push(p.pop())}return i}class Tc{constructor(i,h,p,m,y,I){const E=i.gl;this.program=E.createProgram();const M=Is(h.staticAttributes),D=p?p.getBinderAttributes():[],O=M.concat(D),N=Uo.prelude.staticUniforms?Is(Uo.prelude.staticUniforms):[],Q=h.staticUniforms?Is(h.staticUniforms):[],se=p?p.getBinderUniforms():[],de=N.concat(Q).concat(se),ge=[];for(const He of de)ge.indexOf(He)<0&&ge.push(He);const xe=p?p.defines():[];y&&xe.push("#define OVERDRAW_INSPECTOR;"),I&&xe.push("#define TERRAIN3D;");const ke=xe.concat(Uo.prelude.fragmentSource,h.fragmentSource).join(`
`),Ce=xe.concat(Uo.prelude.vertexSource,h.vertexSource).join(`
`),me=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(me,ke),E.compileShader(me),!E.getShaderParameter(me,E.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${E.getShaderInfoLog(me)}`);E.attachShader(this.program,me);const Re=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(Re,Ce),E.compileShader(Re),!E.getShaderParameter(Re,E.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${E.getShaderInfoLog(Re)}`);E.attachShader(this.program,Re),this.attributes={};const Be={};this.numAttributes=O.length;for(let He=0;He<this.numAttributes;He++)O[He]&&(E.bindAttribLocation(this.program,He,O[He]),this.attributes[O[He]]=He);if(E.linkProgram(this.program),!E.getProgramParameter(this.program,E.LINK_STATUS))throw new Error(`Program failed to link: ${E.getProgramInfoLog(this.program)}`);E.deleteShader(Re),E.deleteShader(me);for(let He=0;He<ge.length;He++){const ot=ge[He];if(ot&&!Be[ot]){const wt=E.getUniformLocation(this.program,ot);wt&&(Be[ot]=wt)}}this.fixedUniforms=m(i,Be),this.terrainUniforms=((He,ot)=>({u_depth:new a.aH(He,ot.u_depth),u_terrain:new a.aH(He,ot.u_terrain),u_terrain_dim:new a.aI(He,ot.u_terrain_dim),u_terrain_matrix:new a.aJ(He,ot.u_terrain_matrix),u_terrain_unpack:new a.aK(He,ot.u_terrain_unpack),u_terrain_exaggeration:new a.aI(He,ot.u_terrain_exaggeration)}))(i,Be),this.binderUniforms=p?p.getUniforms(i,Be):[]}draw(i,h,p,m,y,I,E,M,D,O,N,Q,se,de,ge,xe,ke,Ce){const me=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(p),i.setStencilMode(m),i.setColorMode(y),i.setCullFace(I),M){i.activeTexture.set(me.TEXTURE2),me.bindTexture(me.TEXTURE_2D,M.depthTexture),i.activeTexture.set(me.TEXTURE3),me.bindTexture(me.TEXTURE_2D,M.texture);for(const Be in this.terrainUniforms)this.terrainUniforms[Be].set(M[Be])}for(const Be in this.fixedUniforms)this.fixedUniforms[Be].set(E[Be]);ge&&ge.setUniforms(i,this.binderUniforms,se,{zoom:de});let Re=0;switch(h){case me.LINES:Re=2;break;case me.TRIANGLES:Re=3;break;case me.LINE_STRIP:Re=1}for(const Be of Q.get()){const He=Be.vaos||(Be.vaos={});(He[D]||(He[D]=new kc)).bind(i,this,O,ge?ge.getPaintVertexBuffers():[],N,Be.vertexOffset,xe,ke,Ce),me.drawElements(h,Be.primitiveLength*Re,me.UNSIGNED_SHORT,Be.primitiveOffset*Re*2)}}}function il(v,i,h){const p=1/xi(h,1,i.transform.tileZoom),m=Math.pow(2,h.tileID.overscaledZ),y=h.tileSize*Math.pow(2,i.transform.tileZoom)/m,I=y*(h.tileID.canonical.x+h.tileID.wrap*m),E=y*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[I>>16,E>>16],u_pixel_coord_lower:[65535&I,65535&E]}}const wa=(v,i,h,p)=>{const m=i.style.light,y=m.properties.get("position"),I=[y.x,y.y,y.z],E=function(){var D=new a.A(9);return a.A!=Float32Array&&(D[1]=0,D[2]=0,D[3]=0,D[5]=0,D[6]=0,D[7]=0),D[0]=1,D[4]=1,D[8]=1,D}();m.properties.get("anchor")==="viewport"&&function(D,O){var N=Math.sin(O),Q=Math.cos(O);D[0]=Q,D[1]=N,D[2]=0,D[3]=-N,D[4]=Q,D[5]=0,D[6]=0,D[7]=0,D[8]=1}(E,-i.transform.angle),function(D,O,N){var Q=O[0],se=O[1],de=O[2];D[0]=Q*N[0]+se*N[3]+de*N[6],D[1]=Q*N[1]+se*N[4]+de*N[7],D[2]=Q*N[2]+se*N[5]+de*N[8]}(I,I,E);const M=m.properties.get("color");return{u_matrix:v,u_lightpos:I,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+h,u_opacity:p}},nl=(v,i,h,p,m,y,I)=>a.e(wa(v,i,h,p),il(y,i,I),{u_height_factor:-Math.pow(2,m.overscaledZ)/I.tileSize/8}),Cs=v=>({u_matrix:v}),sh=(v,i,h,p)=>a.e(Cs(v),il(h,i,p)),$d=(v,i)=>({u_matrix:v,u_world:i}),ah=(v,i,h,p,m)=>a.e(sh(v,i,h,p),{u_world:m}),Vd=(v,i,h,p)=>{const m=v.transform;let y,I;if(p.paint.get("circle-pitch-alignment")==="map"){const E=xi(h,1,m.zoom);y=!0,I=[E,E]}else y=!1,I=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:v.translatePosMatrix(i.posMatrix,h,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:I}},Jo=(v,i,h)=>({u_matrix:v,u_inv_matrix:i,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}),xa=(v,i,h=1)=>({u_matrix:v,u_color:i,u_overlay:0,u_overlay_scale:h}),br=v=>({u_matrix:v}),vr=(v,i,h,p)=>({u_matrix:v,u_extrude_scale:xi(i,1,h),u_intensity:p}),rl=(v,i,h,p)=>{const m=a.H();a.aP(m,0,v.width,v.height,0,0,1);const y=v.context.gl;return{u_matrix:m,u_world:[y.drawingBufferWidth,y.drawingBufferHeight],u_image:h,u_color_ramp:p,u_opacity:i.paint.get("heatmap-opacity")}};function ol(v,i){const h=Math.pow(2,i.canonical.z),p=i.canonical.y;return[new a.Z(0,p/h).toLngLat().lat,new a.Z(0,(p+1)/h).toLngLat().lat]}const sl=(v,i,h,p)=>{const m=v.transform;return{u_matrix:uh(v,i,h,p),u_ratio:1/xi(i,1,m.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},lh=(v,i,h,p,m)=>a.e(sl(v,i,h,m),{u_image:0,u_image_height:p}),Es=(v,i,h,p,m)=>{const y=v.transform,I=ch(i,y);return{u_matrix:uh(v,i,h,m),u_texsize:i.imageAtlasTexture.size,u_ratio:1/xi(i,1,y.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[I,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},qd=(v,i,h,p,m,y)=>{const I=v.lineAtlas,E=ch(i,v.transform),M=h.layout.get("line-cap")==="round",D=I.getDash(p.from,M),O=I.getDash(p.to,M),N=D.width*m.fromScale,Q=O.width*m.toScale;return a.e(sl(v,i,h,y),{u_patternscale_a:[E/N,-D.height/2],u_patternscale_b:[E/Q,-O.height/2],u_sdfgamma:I.width/(256*Math.min(N,Q)*v.pixelRatio)/2,u_image:0,u_tex_y_a:D.y,u_tex_y_b:O.y,u_mix:m.t})};function ch(v,i){return 1/xi(v,1,i.tileZoom)}function uh(v,i,h,p){return v.translatePosMatrix(p?p.posMatrix:i.tileID.posMatrix,i,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Zd=(v,i,h,p,m)=>{return{u_matrix:v,u_tl_parent:i,u_scale_parent:h,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(I=m.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(y=m.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Gd(m.paint.get("raster-hue-rotate"))};var y,I};function Gd(v){v*=Math.PI/180;const i=Math.sin(v),h=Math.cos(v);return[(2*h+1)/3,(-Math.sqrt(3)*i-h+1)/3,(Math.sqrt(3)*i-h+1)/3]}const hh=(v,i,h,p,m,y,I,E,M,D,O,N,Q,se)=>{const de=I.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:de.cameraToCenterDistance,u_pitch:de.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:de.width/de.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:M,u_coord_matrix:D,u_is_text:+N,u_pitch_with_map:+p,u_is_along_line:m,u_is_variable_anchor:y,u_texsize:Q,u_texture:0,u_translation:O,u_pitched_scale:se}},ka=(v,i,h,p,m,y,I,E,M,D,O,N,Q,se,de)=>{const ge=I.transform;return a.e(hh(v,i,h,p,m,y,I,E,M,D,O,N,Q,de),{u_gamma_scale:p?Math.cos(ge._pitch)*ge.cameraToCenterDistance:1,u_device_pixel_ratio:I.pixelRatio,u_is_halo:+se})},Ic=(v,i,h,p,m,y,I,E,M,D,O,N,Q,se)=>a.e(ka(v,i,h,p,m,y,I,E,M,D,O,!0,N,!0,se),{u_texsize_icon:Q,u_texture_icon:1}),al=(v,i,h)=>({u_matrix:v,u_opacity:i,u_color:h}),Cc=(v,i,h,p,m,y)=>a.e(function(I,E,M,D){const O=M.imageManager.getPattern(I.from.toString()),N=M.imageManager.getPattern(I.to.toString()),{width:Q,height:se}=M.imageManager.getPixelSize(),de=Math.pow(2,D.tileID.overscaledZ),ge=D.tileSize*Math.pow(2,M.transform.tileZoom)/de,xe=ge*(D.tileID.canonical.x+D.tileID.wrap*de),ke=ge*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:O.tl,u_pattern_br_a:O.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[Q,se],u_mix:E.t,u_pattern_size_a:O.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/xi(D,1,M.transform.tileZoom),u_pixel_coord_upper:[xe>>16,ke>>16],u_pixel_coord_lower:[65535&xe,65535&ke]}}(p,y,h,m),{u_matrix:v,u_opacity:i}),Ec={fillExtrusion:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_lightpos:new a.aN(v,i.u_lightpos),u_lightintensity:new a.aI(v,i.u_lightintensity),u_lightcolor:new a.aN(v,i.u_lightcolor),u_vertical_gradient:new a.aI(v,i.u_vertical_gradient),u_opacity:new a.aI(v,i.u_opacity)}),fillExtrusionPattern:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_lightpos:new a.aN(v,i.u_lightpos),u_lightintensity:new a.aI(v,i.u_lightintensity),u_lightcolor:new a.aN(v,i.u_lightcolor),u_vertical_gradient:new a.aI(v,i.u_vertical_gradient),u_height_factor:new a.aI(v,i.u_height_factor),u_image:new a.aH(v,i.u_image),u_texsize:new a.aO(v,i.u_texsize),u_pixel_coord_upper:new a.aO(v,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(v,i.u_pixel_coord_lower),u_scale:new a.aN(v,i.u_scale),u_fade:new a.aI(v,i.u_fade),u_opacity:new a.aI(v,i.u_opacity)}),fill:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix)}),fillPattern:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_image:new a.aH(v,i.u_image),u_texsize:new a.aO(v,i.u_texsize),u_pixel_coord_upper:new a.aO(v,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(v,i.u_pixel_coord_lower),u_scale:new a.aN(v,i.u_scale),u_fade:new a.aI(v,i.u_fade)}),fillOutline:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_world:new a.aO(v,i.u_world)}),fillOutlinePattern:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_world:new a.aO(v,i.u_world),u_image:new a.aH(v,i.u_image),u_texsize:new a.aO(v,i.u_texsize),u_pixel_coord_upper:new a.aO(v,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(v,i.u_pixel_coord_lower),u_scale:new a.aN(v,i.u_scale),u_fade:new a.aI(v,i.u_fade)}),circle:(v,i)=>({u_camera_to_center_distance:new a.aI(v,i.u_camera_to_center_distance),u_scale_with_map:new a.aH(v,i.u_scale_with_map),u_pitch_with_map:new a.aH(v,i.u_pitch_with_map),u_extrude_scale:new a.aO(v,i.u_extrude_scale),u_device_pixel_ratio:new a.aI(v,i.u_device_pixel_ratio),u_matrix:new a.aJ(v,i.u_matrix)}),collisionBox:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_pixel_extrude_scale:new a.aO(v,i.u_pixel_extrude_scale)}),collisionCircle:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_inv_matrix:new a.aJ(v,i.u_inv_matrix),u_camera_to_center_distance:new a.aI(v,i.u_camera_to_center_distance),u_viewport_size:new a.aO(v,i.u_viewport_size)}),debug:(v,i)=>({u_color:new a.aL(v,i.u_color),u_matrix:new a.aJ(v,i.u_matrix),u_overlay:new a.aH(v,i.u_overlay),u_overlay_scale:new a.aI(v,i.u_overlay_scale)}),clippingMask:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix)}),heatmap:(v,i)=>({u_extrude_scale:new a.aI(v,i.u_extrude_scale),u_intensity:new a.aI(v,i.u_intensity),u_matrix:new a.aJ(v,i.u_matrix)}),heatmapTexture:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_world:new a.aO(v,i.u_world),u_image:new a.aH(v,i.u_image),u_color_ramp:new a.aH(v,i.u_color_ramp),u_opacity:new a.aI(v,i.u_opacity)}),hillshade:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_image:new a.aH(v,i.u_image),u_latrange:new a.aO(v,i.u_latrange),u_light:new a.aO(v,i.u_light),u_shadow:new a.aL(v,i.u_shadow),u_highlight:new a.aL(v,i.u_highlight),u_accent:new a.aL(v,i.u_accent)}),hillshadePrepare:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_image:new a.aH(v,i.u_image),u_dimension:new a.aO(v,i.u_dimension),u_zoom:new a.aI(v,i.u_zoom),u_unpack:new a.aK(v,i.u_unpack)}),line:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_ratio:new a.aI(v,i.u_ratio),u_device_pixel_ratio:new a.aI(v,i.u_device_pixel_ratio),u_units_to_pixels:new a.aO(v,i.u_units_to_pixels)}),lineGradient:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_ratio:new a.aI(v,i.u_ratio),u_device_pixel_ratio:new a.aI(v,i.u_device_pixel_ratio),u_units_to_pixels:new a.aO(v,i.u_units_to_pixels),u_image:new a.aH(v,i.u_image),u_image_height:new a.aI(v,i.u_image_height)}),linePattern:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_texsize:new a.aO(v,i.u_texsize),u_ratio:new a.aI(v,i.u_ratio),u_device_pixel_ratio:new a.aI(v,i.u_device_pixel_ratio),u_image:new a.aH(v,i.u_image),u_units_to_pixels:new a.aO(v,i.u_units_to_pixels),u_scale:new a.aN(v,i.u_scale),u_fade:new a.aI(v,i.u_fade)}),lineSDF:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_ratio:new a.aI(v,i.u_ratio),u_device_pixel_ratio:new a.aI(v,i.u_device_pixel_ratio),u_units_to_pixels:new a.aO(v,i.u_units_to_pixels),u_patternscale_a:new a.aO(v,i.u_patternscale_a),u_patternscale_b:new a.aO(v,i.u_patternscale_b),u_sdfgamma:new a.aI(v,i.u_sdfgamma),u_image:new a.aH(v,i.u_image),u_tex_y_a:new a.aI(v,i.u_tex_y_a),u_tex_y_b:new a.aI(v,i.u_tex_y_b),u_mix:new a.aI(v,i.u_mix)}),raster:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_tl_parent:new a.aO(v,i.u_tl_parent),u_scale_parent:new a.aI(v,i.u_scale_parent),u_buffer_scale:new a.aI(v,i.u_buffer_scale),u_fade_t:new a.aI(v,i.u_fade_t),u_opacity:new a.aI(v,i.u_opacity),u_image0:new a.aH(v,i.u_image0),u_image1:new a.aH(v,i.u_image1),u_brightness_low:new a.aI(v,i.u_brightness_low),u_brightness_high:new a.aI(v,i.u_brightness_high),u_saturation_factor:new a.aI(v,i.u_saturation_factor),u_contrast_factor:new a.aI(v,i.u_contrast_factor),u_spin_weights:new a.aN(v,i.u_spin_weights)}),symbolIcon:(v,i)=>({u_is_size_zoom_constant:new a.aH(v,i.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(v,i.u_is_size_feature_constant),u_size_t:new a.aI(v,i.u_size_t),u_size:new a.aI(v,i.u_size),u_camera_to_center_distance:new a.aI(v,i.u_camera_to_center_distance),u_pitch:new a.aI(v,i.u_pitch),u_rotate_symbol:new a.aH(v,i.u_rotate_symbol),u_aspect_ratio:new a.aI(v,i.u_aspect_ratio),u_fade_change:new a.aI(v,i.u_fade_change),u_matrix:new a.aJ(v,i.u_matrix),u_label_plane_matrix:new a.aJ(v,i.u_label_plane_matrix),u_coord_matrix:new a.aJ(v,i.u_coord_matrix),u_is_text:new a.aH(v,i.u_is_text),u_pitch_with_map:new a.aH(v,i.u_pitch_with_map),u_is_along_line:new a.aH(v,i.u_is_along_line),u_is_variable_anchor:new a.aH(v,i.u_is_variable_anchor),u_texsize:new a.aO(v,i.u_texsize),u_texture:new a.aH(v,i.u_texture),u_translation:new a.aO(v,i.u_translation),u_pitched_scale:new a.aI(v,i.u_pitched_scale)}),symbolSDF:(v,i)=>({u_is_size_zoom_constant:new a.aH(v,i.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(v,i.u_is_size_feature_constant),u_size_t:new a.aI(v,i.u_size_t),u_size:new a.aI(v,i.u_size),u_camera_to_center_distance:new a.aI(v,i.u_camera_to_center_distance),u_pitch:new a.aI(v,i.u_pitch),u_rotate_symbol:new a.aH(v,i.u_rotate_symbol),u_aspect_ratio:new a.aI(v,i.u_aspect_ratio),u_fade_change:new a.aI(v,i.u_fade_change),u_matrix:new a.aJ(v,i.u_matrix),u_label_plane_matrix:new a.aJ(v,i.u_label_plane_matrix),u_coord_matrix:new a.aJ(v,i.u_coord_matrix),u_is_text:new a.aH(v,i.u_is_text),u_pitch_with_map:new a.aH(v,i.u_pitch_with_map),u_is_along_line:new a.aH(v,i.u_is_along_line),u_is_variable_anchor:new a.aH(v,i.u_is_variable_anchor),u_texsize:new a.aO(v,i.u_texsize),u_texture:new a.aH(v,i.u_texture),u_gamma_scale:new a.aI(v,i.u_gamma_scale),u_device_pixel_ratio:new a.aI(v,i.u_device_pixel_ratio),u_is_halo:new a.aH(v,i.u_is_halo),u_translation:new a.aO(v,i.u_translation),u_pitched_scale:new a.aI(v,i.u_pitched_scale)}),symbolTextAndIcon:(v,i)=>({u_is_size_zoom_constant:new a.aH(v,i.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(v,i.u_is_size_feature_constant),u_size_t:new a.aI(v,i.u_size_t),u_size:new a.aI(v,i.u_size),u_camera_to_center_distance:new a.aI(v,i.u_camera_to_center_distance),u_pitch:new a.aI(v,i.u_pitch),u_rotate_symbol:new a.aH(v,i.u_rotate_symbol),u_aspect_ratio:new a.aI(v,i.u_aspect_ratio),u_fade_change:new a.aI(v,i.u_fade_change),u_matrix:new a.aJ(v,i.u_matrix),u_label_plane_matrix:new a.aJ(v,i.u_label_plane_matrix),u_coord_matrix:new a.aJ(v,i.u_coord_matrix),u_is_text:new a.aH(v,i.u_is_text),u_pitch_with_map:new a.aH(v,i.u_pitch_with_map),u_is_along_line:new a.aH(v,i.u_is_along_line),u_is_variable_anchor:new a.aH(v,i.u_is_variable_anchor),u_texsize:new a.aO(v,i.u_texsize),u_texsize_icon:new a.aO(v,i.u_texsize_icon),u_texture:new a.aH(v,i.u_texture),u_texture_icon:new a.aH(v,i.u_texture_icon),u_gamma_scale:new a.aI(v,i.u_gamma_scale),u_device_pixel_ratio:new a.aI(v,i.u_device_pixel_ratio),u_is_halo:new a.aH(v,i.u_is_halo),u_translation:new a.aO(v,i.u_translation),u_pitched_scale:new a.aI(v,i.u_pitched_scale)}),background:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_opacity:new a.aI(v,i.u_opacity),u_color:new a.aL(v,i.u_color)}),backgroundPattern:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_opacity:new a.aI(v,i.u_opacity),u_image:new a.aH(v,i.u_image),u_pattern_tl_a:new a.aO(v,i.u_pattern_tl_a),u_pattern_br_a:new a.aO(v,i.u_pattern_br_a),u_pattern_tl_b:new a.aO(v,i.u_pattern_tl_b),u_pattern_br_b:new a.aO(v,i.u_pattern_br_b),u_texsize:new a.aO(v,i.u_texsize),u_mix:new a.aI(v,i.u_mix),u_pattern_size_a:new a.aO(v,i.u_pattern_size_a),u_pattern_size_b:new a.aO(v,i.u_pattern_size_b),u_scale_a:new a.aI(v,i.u_scale_a),u_scale_b:new a.aI(v,i.u_scale_b),u_pixel_coord_upper:new a.aO(v,i.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(v,i.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aI(v,i.u_tile_units_to_pixels)}),terrain:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_texture:new a.aH(v,i.u_texture),u_ele_delta:new a.aI(v,i.u_ele_delta),u_fog_matrix:new a.aJ(v,i.u_fog_matrix),u_fog_color:new a.aL(v,i.u_fog_color),u_fog_ground_blend:new a.aI(v,i.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.aI(v,i.u_fog_ground_blend_opacity),u_horizon_color:new a.aL(v,i.u_horizon_color),u_horizon_fog_blend:new a.aI(v,i.u_horizon_fog_blend)}),terrainDepth:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_ele_delta:new a.aI(v,i.u_ele_delta)}),terrainCoords:(v,i)=>({u_matrix:new a.aJ(v,i.u_matrix),u_texture:new a.aH(v,i.u_texture),u_terrain_coords_id:new a.aI(v,i.u_terrain_coords_id),u_ele_delta:new a.aI(v,i.u_ele_delta)}),sky:(v,i)=>({u_sky_color:new a.aL(v,i.u_sky_color),u_horizon_color:new a.aL(v,i.u_horizon_color),u_horizon:new a.aI(v,i.u_horizon),u_sky_horizon_blend:new a.aI(v,i.u_sky_horizon_blend)})};class yo{constructor(i,h,p){this.context=i;const m=i.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Wd={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Lc{constructor(i,h,p,m){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=m,this.context=i;const y=i.gl;this.buffer=y.createBuffer(),i.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,h){for(let p=0;p<this.attributes.length;p++){const m=h.attributes[this.attributes[p].name];m!==void 0&&i.enableVertexAttribArray(m)}}setVertexAttribPointers(i,h,p){for(let m=0;m<this.attributes.length;m++){const y=this.attributes[m],I=h.attributes[y.name];I!==void 0&&i.vertexAttribPointer(I,y.components,i[Wd[y.type]],!1,this.itemSize,y.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Yo=new WeakMap;function $o(v){var i;if(Yo.has(v))return Yo.get(v);{const h=(i=v.getParameter(v.VERSION))===null||i===void 0?void 0:i.startsWith("WebGL 2.0");return Yo.set(v,h),h}}class ji{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ll extends ji{getDefault(){return a.aM.transparent}set(i){const h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Hd extends ji{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Ls extends ji{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Xd extends ji{getDefault(){return[!0,!0,!0,!0]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class dh extends ji{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Kd extends ji{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class fh extends ji{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const h=this.current;(i.func!==h.func||i.ref!==h.ref||i.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Mc extends ji{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class ph extends ji{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=i,this.dirty=!1}}class mh extends ji{getDefault(){return[0,1]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class _h extends ji{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=i,this.dirty=!1}}class gh extends ji{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Qo extends ji{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.BLEND):h.disable(h.BLEND),this.current=i,this.dirty=!1}}class yh extends ji{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class Jd extends ji{getDefault(){return a.aM.transparent}set(i){const h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class bh extends ji{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Sa extends ji{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=i,this.dirty=!1}}class Yd extends ji{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class cl extends ji{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class Qd extends ji{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class ef extends ji{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class vh extends ji{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class wh extends ji{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class xh extends ji{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Ac extends ji{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class kh extends ji{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class ul extends ji{getDefault(){return null}set(i){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Ao extends ji{getDefault(){return null}set(i){var h;if(i===this.current&&!this.dirty)return;const p=this.gl;$o(p)?p.bindVertexArray(i):(h=p.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class Pc extends ji{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class zc extends ji{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Dc extends ji{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class hl extends ji{constructor(i,h){super(i),this.context=i,this.parent=h}getDefault(){return null}}class Rc extends hl{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class es extends hl{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Fc extends hl{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class tf{constructor(i,h,p,m,y){this.context=i,this.width=h,this.height=p;const I=i.gl,E=this.framebuffer=I.createFramebuffer();if(this.colorAttachment=new Rc(i,E),m)this.depthAttachment=y?new Fc(i,E):new es(i,E);else if(y)throw new Error("Stencil cannot be set without depth");if(I.checkFramebufferStatus(I.FRAMEBUFFER)!==I.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const i=this.context.gl,h=this.colorAttachment.get();if(h&&i.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&i.deleteRenderbuffer(p)}i.deleteFramebuffer(this.framebuffer)}}class xn{constructor(i,h,p){this.blendFunction=i,this.blendColor=h,this.mask=p}}xn.Replace=[1,0],xn.disabled=new xn(xn.Replace,a.aM.transparent,[!1,!1,!1,!1]),xn.unblended=new xn(xn.Replace,a.aM.transparent,[!0,!0,!0,!0]),xn.alphaBlended=new xn([1,771],a.aM.transparent,[!0,!0,!0,!0]);class nf{constructor(i){var h,p;if(this.gl=i,this.clearColor=new ll(this),this.clearDepth=new Hd(this),this.clearStencil=new Ls(this),this.colorMask=new Xd(this),this.depthMask=new dh(this),this.stencilMask=new Kd(this),this.stencilFunc=new fh(this),this.stencilOp=new Mc(this),this.stencilTest=new ph(this),this.depthRange=new mh(this),this.depthTest=new _h(this),this.depthFunc=new gh(this),this.blend=new Qo(this),this.blendFunc=new yh(this),this.blendColor=new Jd(this),this.blendEquation=new bh(this),this.cullFace=new Sa(this),this.cullFaceSide=new Yd(this),this.frontFace=new cl(this),this.program=new Qd(this),this.activeTexture=new ef(this),this.viewport=new vh(this),this.bindFramebuffer=new wh(this),this.bindRenderbuffer=new xh(this),this.bindTexture=new Ac(this),this.bindVertexBuffer=new kh(this),this.bindElementBuffer=new ul(this),this.bindVertexArray=new Ao(this),this.pixelStoreUnpack=new Pc(this),this.pixelStoreUnpackPremultiplyAlpha=new zc(this),this.pixelStoreUnpackFlipY=new Dc(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),$o(i)){this.HALF_FLOAT=i.HALF_FLOAT;const m=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=i.RGBA16F)!==null&&h!==void 0?h:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=i.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const m=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,h){return new yo(this,i,h)}createVertexBuffer(i,h,p){return new Lc(this,i,h,p)}createRenderbuffer(i,h,p){const m=this.gl,y=m.createRenderbuffer();return this.bindRenderbuffer.set(y),m.renderbufferStorage(m.RENDERBUFFER,i,h,p),this.bindRenderbuffer.set(null),y}createFramebuffer(i,h,p,m){return new tf(this,i,h,p,m)}clear({color:i,depth:h,stencil:p}){const m=this.gl;let y=0;i&&(y|=m.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(y|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p!==void 0&&(y|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(y)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){a.aE(i.blendFunction,xn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return $o(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var h;return $o(this.gl)?this.gl.deleteVertexArray(i):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}class yi{constructor(i,h,p){this.func=i,this.mask=h,this.range=p}}yi.ReadOnly=!1,yi.ReadWrite=!0,yi.disabled=new yi(519,yi.ReadOnly,[0,1]);const dl=7680;class Xi{constructor(i,h,p,m,y,I){this.test=i,this.ref=h,this.mask=p,this.fail=m,this.depthFail=y,this.pass=I}}Xi.disabled=new Xi({func:519,mask:0},0,0,dl,dl,dl);class qi{constructor(i,h,p){this.enable=i,this.mode=h,this.frontFace=p}}let ts;function Ta(v,i,h,p,m){const y=v.context,I=y.gl,E=v.useProgram("collisionBox"),M=[];let D=0,O=0;for(let ke=0;ke<p.length;ke++){const Ce=p[ke],me=i.getTile(Ce).getBucket(h);if(!me)continue;const Re=m?me.textCollisionBox:me.iconCollisionBox,Be=me.collisionCircleArray;if(Be.length>0){const He=a.H();a.aQ(He,me.placementInvProjMatrix,v.transform.glCoordMatrix),a.aQ(He,He,me.placementViewportMatrix),M.push({circleArray:Be,circleOffset:O,transform:Ce.posMatrix,invTransform:He,coord:Ce}),D+=Be.length/4,O=D}Re&&E.draw(y,I.LINES,yi.disabled,Xi.disabled,v.colorModeForRenderPass(),qi.disabled,{u_matrix:Ce.posMatrix,u_pixel_extrude_scale:[1/(N=v.transform).width,1/N.height]},v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ce),h.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,null,v.transform.zoom,null,null,Re.collisionVertexBuffer)}var N;if(!m||!M.length)return;const Q=v.useProgram("collisionCircle"),se=new a.aR;se.resize(4*D),se._trim();let de=0;for(const ke of M)for(let Ce=0;Ce<ke.circleArray.length/4;Ce++){const me=4*Ce,Re=ke.circleArray[me+0],Be=ke.circleArray[me+1],He=ke.circleArray[me+2],ot=ke.circleArray[me+3];se.emplace(de++,Re,Be,He,ot,0),se.emplace(de++,Re,Be,He,ot,1),se.emplace(de++,Re,Be,He,ot,2),se.emplace(de++,Re,Be,He,ot,3)}(!ts||ts.length<2*D)&&(ts=function(ke){const Ce=2*ke,me=new a.aT;me.resize(Ce),me._trim();for(let Re=0;Re<Ce;Re++){const Be=6*Re;me.uint16[Be+0]=4*Re+0,me.uint16[Be+1]=4*Re+1,me.uint16[Be+2]=4*Re+2,me.uint16[Be+3]=4*Re+2,me.uint16[Be+4]=4*Re+3,me.uint16[Be+5]=4*Re+0}return me}(D));const ge=y.createIndexBuffer(ts,!0),xe=y.createVertexBuffer(se,a.aS.members,!0);for(const ke of M){const Ce=Jo(ke.transform,ke.invTransform,v.transform);Q.draw(y,I.TRIANGLES,yi.disabled,Xi.disabled,v.colorModeForRenderPass(),qi.disabled,Ce,v.style.map.terrain&&v.style.map.terrain.getTerrainData(ke.coord),h.id,xe,ge,a.a0.simpleSegment(0,2*ke.circleOffset,ke.circleArray.length,ke.circleArray.length/2),null,v.transform.zoom,null,null,null)}xe.destroy(),ge.destroy()}qi.disabled=new qi(!1,1029,2305),qi.backCCW=new qi(!0,1029,2305);const Ia=a.an(new Float32Array(16));function Bc(v,i,h,p,m,y){const{horizontalAlign:I,verticalAlign:E}=a.au(v);return new a.P((-(I-.5)*i/m+p[0])*y,(-(E-.5)*h/m+p[1])*y)}function is(v,i,h,p,m,y){const I=i.tileAnchorPoint.add(new a.P(i.translation[0],i.translation[1]));if(i.pitchWithMap){let E=p.mult(y);h||(E=E.rotate(-m));const M=I.add(E);return ye(M.x,M.y,i.labelPlaneMatrix,i.getElevation).point}if(h){const E=Fe(i.tileAnchorPoint.x+1,i.tileAnchorPoint.y,i).point.sub(v),M=Math.atan(E.y/E.x)+(E.x<0?Math.PI:0);return v.add(p.rotate(M))}return v.add(p)}function Ms(v,i,h,p,m,y,I,E,M,D,O,N,Q,se){const de=v.text.placedSymbolArray,ge=v.text.dynamicLayoutVertexArray,xe=v.icon.dynamicLayoutVertexArray,ke={};ge.clear();for(let Ce=0;Ce<de.length;Ce++){const me=de.get(Ce),Re=me.hidden||!me.crossTileID||v.allowVerticalPlacement&&!me.placedOrientation?null:p[me.crossTileID];if(Re){const Be=new a.P(me.anchorX,me.anchorY),He={getElevation:se,width:m.width,height:m.height,labelPlaneMatrix:y,lineVertexArray:null,pitchWithMap:h,projection:O,projectionCache:null,tileAnchorPoint:Be,translation:N,unwrappedTileID:Q},ot=h?ye(Be.x,Be.y,I,se):Fe(Be.x,Be.y,He),wt=q(m.cameraToCenterDistance,ot.signedDistanceFromCamera);let It=a.ai(v.textSizeData,M,me)*wt/a.ap;h&&(It*=v.tilePixelRatio/E);const{width:At,height:kt,anchor:xt,textOffset:Nt,textBoxScale:ri}=Re,St=Bc(xt,At,kt,Nt,ri,It),Lt=O.getPitchedTextCorrection(m,Be.add(new a.P(N[0],N[1])),Q),ti=is(ot.point,He,i,St,m.angle,Lt),Qi=v.allowVerticalPlacement&&me.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let fi=0;fi<me.numGlyphs;fi++)a.aj(ge,ti,Qi);D&&me.associatedIconIndex>=0&&(ke[me.associatedIconIndex]={shiftedAnchor:ti,angle:Qi})}else Et(me.numGlyphs,ge)}if(D){xe.clear();const Ce=v.icon.placedSymbolArray;for(let me=0;me<Ce.length;me++){const Re=Ce.get(me);if(Re.hidden)Et(Re.numGlyphs,xe);else{const Be=ke[me];if(Be)for(let He=0;He<Re.numGlyphs;He++)a.aj(xe,Be.shiftedAnchor,Be.angle);else Et(Re.numGlyphs,xe)}}v.icon.dynamicLayoutVertexBuffer.updateData(xe)}v.text.dynamicLayoutVertexBuffer.updateData(ge)}function Wr(v,i,h){return h.iconsInText&&i?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function Oc(v,i,h,p,m,y,I,E,M,D,O,N){const Q=v.context,se=Q.gl,de=v.transform,ge=Xo(),xe=E==="map",ke=M==="map",Ce=E!=="viewport"&&h.layout.get("symbol-placement")!=="point",me=xe&&!ke&&!Ce,Re=!ke&&Ce,Be=!h.layout.get("symbol-sort-key").isConstant();let He=!1;const ot=v.depthModeForSublayer(0,yi.ReadOnly),wt=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),It=[],At=ge.getCircleRadiusCorrection(de);for(const kt of p){const xt=i.getTile(kt),Nt=xt.getBucket(h);if(!Nt)continue;const ri=m?Nt.text:Nt.icon;if(!ri||!ri.segments.get().length||!ri.hasVisibleVertices)continue;const St=ri.programConfigurations.get(h.id),Lt=m||Nt.sdfIcons,ti=m?Nt.textSizeData:Nt.iconSizeData,Qi=ke||de.pitch!==0,fi=v.useProgram(Wr(Lt,m,Nt),St),ki=a.ag(ti,de.zoom),en=v.style.map.terrain&&v.style.map.terrain.getTerrainData(kt);let er,so,tn,wr,hr=[0,0],tr=null;if(m)so=xt.glyphAtlasTexture,tn=se.LINEAR,er=xt.glyphAtlasTexture.size,Nt.iconsInText&&(hr=xt.imageAtlasTexture.size,tr=xt.imageAtlasTexture,wr=Qi||v.options.rotating||v.options.zooming||ti.kind==="composite"||ti.kind==="camera"?se.LINEAR:se.NEAREST);else{const Ii=h.layout.get("icon-size").constantOr(0)!==1||Nt.iconsNeedLinear;so=xt.imageAtlasTexture,tn=Lt||v.options.rotating||v.options.zooming||Ii||Qi?se.LINEAR:se.NEAREST,er=xt.imageAtlasTexture.size}const dr=xi(xt,1,v.transform.zoom),wo=Re?kt.posMatrix:Ia,Gs=Zr(wo,ke,xe,v.transform,dr),Al=yr(wo,ke,xe,v.transform,dr),Ws=yr(kt.posMatrix,ke,xe,v.transform,dr),Kr=ge.translatePosition(v.transform,xt,y,I),Pl=wt&&Nt.hasTextData(),cu=h.layout.get("icon-text-fit")!=="none"&&Pl&&Nt.hasIconData();if(Ce){const Ii=v.style.map.terrain?(Hs,Xs)=>v.style.map.terrain.getElevation(kt,Hs,Xs):null,as=h.layout.get("text-rotation-alignment")==="map";re(Nt,kt.posMatrix,v,m,Gs,Ws,ke,D,as,ge,kt.toUnwrapped(),de.width,de.height,Kr,Ii)}const Jr=kt.posMatrix,Yr=m&&wt||cu,Vo=Ce||Yr?Ia:Gs,ao=Al,Wn=Lt&&h.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ir;ir=Lt?Nt.iconsInText?Ic(ti.kind,ki,me,ke,Ce,Yr,v,Jr,Vo,ao,Kr,er,hr,At):ka(ti.kind,ki,me,ke,Ce,Yr,v,Jr,Vo,ao,Kr,m,er,!0,At):hh(ti.kind,ki,me,ke,Ce,Yr,v,Jr,Vo,ao,Kr,m,er,At);const Nr={program:fi,buffers:ri,uniformValues:ir,atlasTexture:so,atlasTextureIcon:tr,atlasInterpolation:tn,atlasInterpolationIcon:wr,isSDF:Lt,hasHalo:Wn};if(Be&&Nt.canOverlap){He=!0;const Ii=ri.segments.get();for(const as of Ii)It.push({segments:new a.a0([as]),sortKey:as.sortKey,state:Nr,terrainData:en})}else It.push({segments:ri.segments,sortKey:0,state:Nr,terrainData:en})}He&&It.sort((kt,xt)=>kt.sortKey-xt.sortKey);for(const kt of It){const xt=kt.state;if(Q.activeTexture.set(se.TEXTURE0),xt.atlasTexture.bind(xt.atlasInterpolation,se.CLAMP_TO_EDGE),xt.atlasTextureIcon&&(Q.activeTexture.set(se.TEXTURE1),xt.atlasTextureIcon&&xt.atlasTextureIcon.bind(xt.atlasInterpolationIcon,se.CLAMP_TO_EDGE)),xt.isSDF){const Nt=xt.uniformValues;xt.hasHalo&&(Nt.u_is_halo=1,Nc(xt.buffers,kt.segments,h,v,xt.program,ot,O,N,Nt,kt.terrainData)),Nt.u_is_halo=0}Nc(xt.buffers,kt.segments,h,v,xt.program,ot,O,N,xt.uniformValues,kt.terrainData)}}function Nc(v,i,h,p,m,y,I,E,M,D){const O=p.context;m.draw(O,O.gl.TRIANGLES,y,I,E,qi.disabled,M,D,h.id,v.layoutVertexBuffer,v.indexBuffer,i,h.paint,p.transform.zoom,v.programConfigurations.get(h.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function jc(v,i,h,p){const m=v.context,y=m.gl,I=Xi.disabled,E=new xn([y.ONE,y.ONE],a.aM.transparent,[!0,!0,!0,!0]),M=i.getBucket(h);if(!M)return;const D=p.key;let O=h.heatmapFbos.get(D);O||(O=Ca(m,i.tileSize,i.tileSize),h.heatmapFbos.set(D,O)),m.bindFramebuffer.set(O.framebuffer),m.viewport.set([0,0,i.tileSize,i.tileSize]),m.clear({color:a.aM.transparent});const N=M.programConfigurations.get(h.id),Q=v.useProgram("heatmap",N),se=v.style.map.terrain.getTerrainData(p);Q.draw(m,y.TRIANGLES,yi.disabled,I,E,qi.disabled,vr(p.posMatrix,i,v.transform.zoom,h.paint.get("heatmap-intensity")),se,h.id,M.layoutVertexBuffer,M.indexBuffer,M.segments,h.paint,v.transform.zoom,N)}function ns(v,i,h){const p=v.context,m=p.gl;p.setColorMode(v.colorModeForRenderPass());const y=Ea(p,i),I=h.key,E=i.heatmapFbos.get(I);E&&(p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,E.colorAttachment.get()),p.activeTexture.set(m.TEXTURE1),y.bind(m.LINEAR,m.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(p,m.TRIANGLES,yi.disabled,Xi.disabled,v.colorModeForRenderPass(),qi.disabled,rl(v,i,0,1),null,i.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments,i.paint,v.transform.zoom),E.destroy(),i.heatmapFbos.delete(I))}function Ca(v,i,h){var p,m;const y=v.gl,I=y.createTexture();y.bindTexture(y.TEXTURE_2D,I),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR);const E=(p=v.HALF_FLOAT)!==null&&p!==void 0?p:y.UNSIGNED_BYTE,M=(m=v.RGBA16F)!==null&&m!==void 0?m:y.RGBA;y.texImage2D(y.TEXTURE_2D,0,M,i,h,0,y.RGBA,E,null);const D=v.createFramebuffer(i,h,!1,!1);return D.colorAttachment.set(I),D}function Ea(v,i){return i.colorRampTexture||(i.colorRampTexture=new ce(v,i.colorRamp,v.gl.RGBA)),i.colorRampTexture}function As(v,i,h,p,m){if(!h||!p||!p.imageAtlas)return;const y=p.imageAtlas.patternPositions;let I=y[h.to.toString()],E=y[h.from.toString()];if(!I&&E&&(I=E),!E&&I&&(E=I),!I||!E){const M=m.getPaintProperty(i);I=y[M],E=y[M]}I&&E&&v.setConstantPatternPositions(I,E)}function La(v,i,h,p,m,y,I){const E=v.context.gl,M="fill-pattern",D=h.paint.get(M),O=D&&D.constantOr(1),N=h.getCrossfadeParameters();let Q,se,de,ge,xe;I?(se=O&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Q=E.LINES):(se=O?"fillPattern":"fill",Q=E.TRIANGLES);const ke=D.constantOr(null);for(const Ce of p){const me=i.getTile(Ce);if(O&&!me.patternsLoaded())continue;const Re=me.getBucket(h);if(!Re)continue;const Be=Re.programConfigurations.get(h.id),He=v.useProgram(se,Be),ot=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ce);O&&(v.context.activeTexture.set(E.TEXTURE0),me.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Be.updatePaintBuffers(N)),As(Be,M,ke,me,h);const wt=ot?Ce:null,It=v.translatePosMatrix(wt?wt.posMatrix:Ce.posMatrix,me,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(I){ge=Re.indexBuffer2,xe=Re.segments2;const At=[E.drawingBufferWidth,E.drawingBufferHeight];de=se==="fillOutlinePattern"&&O?ah(It,v,N,me,At):$d(It,At)}else ge=Re.indexBuffer,xe=Re.segments,de=O?sh(It,v,N,me):Cs(It);He.draw(v.context,Q,m,v.stencilModeForClipping(Ce),y,qi.disabled,de,ot,h.id,Re.layoutVertexBuffer,ge,xe,h.paint,v.transform.zoom,Be)}}function fl(v,i,h,p,m,y,I){const E=v.context,M=E.gl,D="fill-extrusion-pattern",O=h.paint.get(D),N=O.constantOr(1),Q=h.getCrossfadeParameters(),se=h.paint.get("fill-extrusion-opacity"),de=O.constantOr(null);for(const ge of p){const xe=i.getTile(ge),ke=xe.getBucket(h);if(!ke)continue;const Ce=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ge),me=ke.programConfigurations.get(h.id),Re=v.useProgram(N?"fillExtrusionPattern":"fillExtrusion",me);N&&(v.context.activeTexture.set(M.TEXTURE0),xe.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),me.updatePaintBuffers(Q)),As(me,D,de,xe,h);const Be=v.translatePosMatrix(ge.posMatrix,xe,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),He=h.paint.get("fill-extrusion-vertical-gradient"),ot=N?nl(Be,v,He,se,ge,Q,xe):wa(Be,v,He,se);Re.draw(E,E.gl.TRIANGLES,m,y,I,qi.backCCW,ot,Ce,h.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,h.paint,v.transform.zoom,me,v.style.map.terrain&&ke.centroidVertexBuffer)}}function Ps(v,i,h,p,m,y,I){const E=v.context,M=E.gl,D=h.fbo;if(!D)return;const O=v.useProgram("hillshade"),N=v.style.map.terrain&&v.style.map.terrain.getTerrainData(i);E.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,D.colorAttachment.get()),O.draw(E,M.TRIANGLES,m,y,I,qi.disabled,((Q,se,de,ge)=>{const xe=de.paint.get("hillshade-shadow-color"),ke=de.paint.get("hillshade-highlight-color"),Ce=de.paint.get("hillshade-accent-color");let me=de.paint.get("hillshade-illumination-direction")*(Math.PI/180);de.paint.get("hillshade-illumination-anchor")==="viewport"&&(me-=Q.transform.angle);const Re=!Q.options.moving;return{u_matrix:ge?ge.posMatrix:Q.transform.calculatePosMatrix(se.tileID.toUnwrapped(),Re),u_image:0,u_latrange:ol(0,se.tileID),u_light:[de.paint.get("hillshade-exaggeration"),me],u_shadow:xe,u_highlight:ke,u_accent:Ce}})(v,h,p,N?i:null),N,p.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}function zs(v,i,h,p,m,y){const I=v.context,E=I.gl,M=i.dem;if(M&&M.data){const D=M.dim,O=M.stride,N=M.getPixels();if(I.activeTexture.set(E.TEXTURE1),I.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||v.getTileTexture(O),i.demTexture){const se=i.demTexture;se.update(N,{premultiply:!1}),se.bind(E.NEAREST,E.CLAMP_TO_EDGE)}else i.demTexture=new ce(I,N,E.RGBA,{premultiply:!1}),i.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);I.activeTexture.set(E.TEXTURE0);let Q=i.fbo;if(!Q){const se=new ce(I,{width:D,height:D,data:null},E.RGBA);se.bind(E.LINEAR,E.CLAMP_TO_EDGE),Q=i.fbo=I.createFramebuffer(D,D,!0,!1),Q.colorAttachment.set(se.texture)}I.bindFramebuffer.set(Q.framebuffer),I.viewport.set([0,0,D,D]),v.useProgram("hillshadePrepare").draw(I,E.TRIANGLES,p,m,y,qi.disabled,((se,de)=>{const ge=de.stride,xe=a.H();return a.aP(xe,0,a.X,-a.X,0,0,1),a.J(xe,xe,[0,-a.X,0]),{u_matrix:xe,u_image:1,u_dimension:[ge,ge],u_zoom:se.overscaledZ,u_unpack:de.getUnpackVector()}})(i.tileID,M),null,h.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function Sh(v,i,h,p,m,y){const I=p.paint.get("raster-fade-duration");if(!y&&I>0){const E=S.now(),M=(E-v.timeAdded)/I,D=i?(E-i.timeAdded)/I:-1,O=h.getSource(),N=m.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),Q=!i||Math.abs(i.tileID.overscaledZ-N)>Math.abs(v.tileID.overscaledZ-N),se=Q&&v.refreshedUponExpiration?1:a.ac(Q?M:1-D,0,1);return v.refreshedUponExpiration&&M>=1&&(v.refreshedUponExpiration=!1),i?{opacity:1,mix:1-se}:{opacity:se,mix:0}}return{opacity:1,mix:0}}const Uc=new a.aM(1,0,0,1),Pi=new a.aM(0,1,0,1),pl=new a.aM(0,0,1,1),rf=new a.aM(1,0,1,1),Th=new a.aM(0,1,1,1);function Ds(v,i,h,p){ml(v,0,i+h/2,v.transform.width,h,p)}function Ih(v,i,h,p){ml(v,i-h/2,0,h,v.transform.height,p)}function ml(v,i,h,p,m,y){const I=v.context,E=I.gl;E.enable(E.SCISSOR_TEST),E.scissor(i*v.pixelRatio,h*v.pixelRatio,p*v.pixelRatio,m*v.pixelRatio),I.clear({color:y}),E.disable(E.SCISSOR_TEST)}function Ch(v,i,h){const p=v.context,m=p.gl,y=h.posMatrix,I=v.useProgram("debug"),E=yi.disabled,M=Xi.disabled,D=v.colorModeForRenderPass(),O="$debug",N=v.style.map.terrain&&v.style.map.terrain.getTerrainData(h);p.activeTexture.set(m.TEXTURE0);const Q=i.getTileByID(h.key).latestRawTileData,se=Math.floor((Q&&Q.byteLength||0)/1024),de=i.getTile(h).tileSize,ge=512/Math.min(de,512)*(h.overscaledZ/v.transform.zoom)*.5;let xe=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(xe+=` => ${h.overscaledZ}`),function(ke,Ce){ke.initDebugOverlayCanvas();const me=ke.debugOverlayCanvas,Re=ke.context.gl,Be=ke.debugOverlayCanvas.getContext("2d");Be.clearRect(0,0,me.width,me.height),Be.shadowColor="white",Be.shadowBlur=2,Be.lineWidth=1.5,Be.strokeStyle="white",Be.textBaseline="top",Be.font="bold 36px Open Sans, sans-serif",Be.fillText(Ce,5,5),Be.strokeText(Ce,5,5),ke.debugOverlayTexture.update(me),ke.debugOverlayTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}(v,`${xe} ${se}kB`),I.draw(p,m.TRIANGLES,E,M,xn.alphaBlended,qi.disabled,xa(y,a.aM.transparent,ge),null,O,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),I.draw(p,m.LINE_STRIP,E,M,D,qi.disabled,xa(y,a.aM.red),N,O,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function Eh(v,i,h){const p=v.context,m=p.gl,y=v.colorModeForRenderPass(),I=new yi(m.LEQUAL,yi.ReadWrite,v.depthRangeFor3D),E=v.useProgram("terrain"),M=i.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,v.width,v.height]);for(const D of h){const O=v.renderToTexture.getTexture(D),N=i.getTerrainData(D.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,O.texture);const Q=v.transform.calculatePosMatrix(D.tileID.toUnwrapped()),se=i.getMeshFrameDelta(v.transform.zoom),de=v.transform.calculateFogMatrix(D.tileID.toUnwrapped()),ge=Sc(Q,se,de,v.style.sky,v.transform.pitch);E.draw(p,m.TRIANGLES,I,Xi.disabled,y,qi.backCCW,ge,N,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}}class _l{constructor(i,h,p){this.vertexBuffer=i,this.indexBuffer=h,this.segments=p}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class gl{constructor(i,h){this.context=new nf(i),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Jt.maxUnderzooming+Jt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new xc}resize(i,h,p){if(this.width=Math.floor(i*p),this.height=Math.floor(h*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const i=this.context,h=new a.aX;h.emplaceBack(0,0),h.emplaceBack(a.X,0),h.emplaceBack(0,a.X),h.emplaceBack(a.X,a.X),this.tileExtentBuffer=i.createVertexBuffer(h,Ko.members),this.tileExtentSegments=a.a0.simpleSegment(0,0,4,2);const p=new a.aX;p.emplaceBack(0,0),p.emplaceBack(a.X,0),p.emplaceBack(0,a.X),p.emplaceBack(a.X,a.X),this.debugBuffer=i.createVertexBuffer(p,Ko.members),this.debugSegments=a.a0.simpleSegment(0,0,4,5);const m=new a.$;m.emplaceBack(0,0,0,0),m.emplaceBack(a.X,0,a.X,0),m.emplaceBack(0,a.X,0,a.X),m.emplaceBack(a.X,a.X,a.X,a.X),this.rasterBoundsBuffer=i.createVertexBuffer(m,wi.members),this.rasterBoundsSegments=a.a0.simpleSegment(0,0,4,2);const y=new a.aX;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(y,Ko.members),this.viewportSegments=a.a0.simpleSegment(0,0,4,2);const I=new a.aZ;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(I);const E=new a.aY;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(E);const M=this.context.gl;this.stencilClearMode=new Xi({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO)}clearStencil(){const i=this.context,h=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=a.H();a.aP(p,0,this.width,this.height,0,0,1),a.K(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,h.TRIANGLES,yi.disabled,this.stencilClearMode,xn.disabled,qi.disabled,br(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,h){if(this.currentStencilSource===i.source||!i.isTileClipped()||!h||!h.length)return;this.currentStencilSource=i.source;const p=this.context,m=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(xn.disabled),p.setDepthMode(yi.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of h){const E=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,M=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I);y.draw(p,m.TRIANGLES,yi.disabled,new Xi({func:m.ALWAYS,mask:0},E,255,m.KEEP,m.KEEP,m.REPLACE),xn.disabled,qi.disabled,br(I.posMatrix),M,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,h=this.context.gl;return new Xi({func:h.NOTEQUAL,mask:255},i,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(i){const h=this.context.gl;return new Xi({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(i){const h=this.context.gl,p=i.sort((I,E)=>E.overscaledZ-I.overscaledZ),m=p[p.length-1].overscaledZ,y=p[0].overscaledZ-m+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const I={};for(let E=0;E<y;E++)I[E+m]=new Xi({func:h.GEQUAL,mask:255},E+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=y,[I,p]}return[{[m]:Xi.disabled},p]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new xn([i.CONSTANT_COLOR,i.ONE],new a.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?xn.unblended:xn.alphaBlended}depthModeForSublayer(i,h,p){if(!this.opaquePassEnabledForLayer())return yi.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new yi(p||this.context.gl.LEQUAL,h,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,h){this.style=i,this.options=h,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(S.now()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.sourceCaches,y={},I={},E={};for(const M in m){const D=m[M];D.used&&D.prepare(this.context),y[M]=D.getVisibleCoordinates(),I[M]=y[M].slice().reverse(),E[M]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let M=0;M<p.length;M++)if(this.style._layers[p[M]].is3D()){this.opaquePassCutoff=M;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const M of p){const D=this.style._layers[M];if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const O=I[D.source];(D.type==="custom"||O.length)&&this.renderLayer(this,m[D.source],D,O)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?a.aM.black:a.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(M,D){const O=M.context,N=O.gl,Q=((ke,Ce,me)=>({u_sky_color:ke.properties.get("sky-color"),u_horizon_color:ke.properties.get("horizon-color"),u_horizon:(Ce.height/2+Ce.getHorizon())*me,u_sky_horizon_blend:ke.properties.get("sky-horizon-blend")*Ce.height/2*me}))(D,M.style.map.transform,M.pixelRatio),se=new yi(N.LEQUAL,yi.ReadWrite,[0,1]),de=Xi.disabled,ge=M.colorModeForRenderPass(),xe=M.useProgram("sky");if(!D.mesh){const ke=new a.aX;ke.emplaceBack(-1,-1),ke.emplaceBack(1,-1),ke.emplaceBack(1,1),ke.emplaceBack(-1,1);const Ce=new a.aY;Ce.emplaceBack(0,1,2),Ce.emplaceBack(0,2,3),D.mesh=new _l(O.createVertexBuffer(ke,Ko.members),O.createIndexBuffer(Ce),a.a0.simpleSegment(0,0,ke.length,Ce.length))}xe.draw(O,N.TRIANGLES,se,de,ge,qi.disabled,Q,void 0,"sky",D.mesh.vertexBuffer,D.mesh.indexBuffer,D.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const M=this.style._layers[p[this.currentLayer]],D=m[M.source],O=y[M.source];this._renderTileClippingMasks(M,O),this.renderLayer(this,D,M,O)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const M=this.style._layers[p[this.currentLayer]],D=m[M.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(M))continue;const O=(M.type==="symbol"?E:I)[M.source];this._renderTileClippingMasks(M,y[M.source]),this.renderLayer(this,D,M,O)}if(this.options.showTileBoundaries){const M=function(D,O){let N=null;const Q=Object.values(D._layers).flatMap(xe=>xe.source&&!xe.isHidden(O)?[D.sourceCaches[xe.source]]:[]),se=Q.filter(xe=>xe.getSource().type==="vector"),de=Q.filter(xe=>xe.getSource().type!=="vector"),ge=xe=>{(!N||N.getSource().maxzoom<xe.getSource().maxzoom)&&(N=xe)};return se.forEach(xe=>ge(xe)),N||de.forEach(xe=>ge(xe)),N}(this.style,this.transform.zoom);M&&function(D,O,N){for(let Q=0;Q<N.length;Q++)Ch(D,O,N[Q])}(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const D=M.transform.padding;Ds(M,M.transform.height-(D.top||0),3,Uc),Ds(M,D.bottom||0,3,Pi),Ih(M,D.left||0,3,pl),Ih(M,M.transform.width-(D.right||0),3,rf);const O=M.transform.centerPoint;(function(N,Q,se,de){ml(N,Q-1,se-10,2,20,de),ml(N,Q-10,se-1,20,2,de)})(M,O.x,M.transform.height-O.y,Th)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(i){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,p=this.transform.modelViewProjectionMatrix;let m=this.terrainFacilitator.dirty;m||(m=i?!a.a_(h,p):!a.a$(h,p)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(a.b0(h,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(y,I){const E=y.context,M=E.gl,D=xn.unblended,O=new yi(M.LEQUAL,yi.ReadWrite,[0,1]),N=I.getTerrainMesh(),Q=I.sourceCache.getRenderableTiles(),se=y.useProgram("terrainDepth");E.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),E.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),E.clear({color:a.aM.transparent,depth:1});for(const de of Q){const ge=I.getTerrainData(de.tileID),xe={u_matrix:y.transform.calculatePosMatrix(de.tileID.toUnwrapped()),u_ele_delta:I.getMeshFrameDelta(y.transform.zoom)};se.draw(E,M.TRIANGLES,O,Xi.disabled,D,qi.backCCW,xe,ge,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}E.bindFramebuffer.set(null),E.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain),function(y,I){const E=y.context,M=E.gl,D=xn.unblended,O=new yi(M.LEQUAL,yi.ReadWrite,[0,1]),N=I.getTerrainMesh(),Q=I.getCoordsTexture(),se=I.sourceCache.getRenderableTiles(),de=y.useProgram("terrainCoords");E.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),E.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),E.clear({color:a.aM.transparent,depth:1}),I.coordsIndex=[];for(const ge of se){const xe=I.getTerrainData(ge.tileID);E.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,Q.texture);const ke={u_matrix:y.transform.calculatePosMatrix(ge.tileID.toUnwrapped()),u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0,u_ele_delta:I.getMeshFrameDelta(y.transform.zoom)};de.draw(E,M.TRIANGLES,O,Xi.disabled,D,qi.backCCW,ke,xe,"terrain",N.vertexBuffer,N.indexBuffer,N.segments),I.coordsIndex.push(ge.tileID.key)}E.bindFramebuffer.set(null),E.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain))}renderLayer(i,h,p,m){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(m||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(y,I,E,M,D){if(y.renderPass!=="translucent")return;const O=Xi.disabled,N=y.colorModeForRenderPass();(E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Q,se,de,ge,xe,ke,Ce,me,Re){const Be=se.transform,He=Xo(),ot=xe==="map",wt=ke==="map";for(const It of Q){const At=ge.getTile(It),kt=At.getBucket(de);if(!kt||!kt.text||!kt.text.segments.get().length)continue;const xt=a.ag(kt.textSizeData,Be.zoom),Nt=xi(At,1,se.transform.zoom),ri=Zr(It.posMatrix,wt,ot,se.transform,Nt),St=de.layout.get("icon-text-fit")!=="none"&&kt.hasIconData();if(xt){const Lt=Math.pow(2,Be.zoom-At.tileID.overscaledZ),ti=se.style.map.terrain?(fi,ki)=>se.style.map.terrain.getElevation(It,fi,ki):null,Qi=He.translatePosition(Be,At,Ce,me);Ms(kt,ot,wt,Re,Be,ri,It.posMatrix,Lt,xt,St,He,Qi,It.toUnwrapped(),ti)}}}(M,y,E,I,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),D),E.paint.get("icon-opacity").constantOr(1)!==0&&Oc(y,I,E,M,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),O,N),E.paint.get("text-opacity").constantOr(1)!==0&&Oc(y,I,E,M,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),O,N),I.map.showCollisionBoxes&&(Ta(y,I,E,M,!0),Ta(y,I,E,M,!1))})(i,h,p,m,this.style.placement.variableOffsets);break;case"circle":(function(y,I,E,M){if(y.renderPass!=="translucent")return;const D=E.paint.get("circle-opacity"),O=E.paint.get("circle-stroke-width"),N=E.paint.get("circle-stroke-opacity"),Q=!E.layout.get("circle-sort-key").isConstant();if(D.constantOr(1)===0&&(O.constantOr(1)===0||N.constantOr(1)===0))return;const se=y.context,de=se.gl,ge=y.depthModeForSublayer(0,yi.ReadOnly),xe=Xi.disabled,ke=y.colorModeForRenderPass(),Ce=[];for(let me=0;me<M.length;me++){const Re=M[me],Be=I.getTile(Re),He=Be.getBucket(E);if(!He)continue;const ot=He.programConfigurations.get(E.id),wt=y.useProgram("circle",ot),It=He.layoutVertexBuffer,At=He.indexBuffer,kt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Re),xt={programConfiguration:ot,program:wt,layoutVertexBuffer:It,indexBuffer:At,uniformValues:Vd(y,Re,Be,E),terrainData:kt};if(Q){const Nt=He.segments.get();for(const ri of Nt)Ce.push({segments:new a.a0([ri]),sortKey:ri.sortKey,state:xt})}else Ce.push({segments:He.segments,sortKey:0,state:xt})}Q&&Ce.sort((me,Re)=>me.sortKey-Re.sortKey);for(const me of Ce){const{programConfiguration:Re,program:Be,layoutVertexBuffer:He,indexBuffer:ot,uniformValues:wt,terrainData:It}=me.state;Be.draw(se,de.TRIANGLES,ge,xe,ke,qi.disabled,wt,It,E.id,He,ot,me.segments,E.paint,y.transform.zoom,Re)}})(i,h,p,m);break;case"heatmap":(function(y,I,E,M){if(E.paint.get("heatmap-opacity")===0)return;const D=y.context;if(y.style.map.terrain){for(const O of M){const N=I.getTile(O);I.hasRenderableParent(O)||(y.renderPass==="offscreen"?jc(y,N,E,O):y.renderPass==="translucent"&&ns(y,E,O))}D.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?function(O,N,Q,se){const de=O.context,ge=de.gl,xe=Xi.disabled,ke=new xn([ge.ONE,ge.ONE],a.aM.transparent,[!0,!0,!0,!0]);(function(Ce,me,Re){const Be=Ce.gl;Ce.activeTexture.set(Be.TEXTURE1),Ce.viewport.set([0,0,me.width/4,me.height/4]);let He=Re.heatmapFbos.get(a.aU);He?(Be.bindTexture(Be.TEXTURE_2D,He.colorAttachment.get()),Ce.bindFramebuffer.set(He.framebuffer)):(He=Ca(Ce,me.width/4,me.height/4),Re.heatmapFbos.set(a.aU,He))})(de,O,Q),de.clear({color:a.aM.transparent});for(let Ce=0;Ce<se.length;Ce++){const me=se[Ce];if(N.hasRenderableParent(me))continue;const Re=N.getTile(me),Be=Re.getBucket(Q);if(!Be)continue;const He=Be.programConfigurations.get(Q.id),ot=O.useProgram("heatmap",He),{zoom:wt}=O.transform;ot.draw(de,ge.TRIANGLES,yi.disabled,xe,ke,qi.disabled,vr(me.posMatrix,Re,wt,Q.paint.get("heatmap-intensity")),null,Q.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,Q.paint,O.transform.zoom,He)}de.viewport.set([0,0,O.width,O.height])}(y,I,E,M):y.renderPass==="translucent"&&function(O,N){const Q=O.context,se=Q.gl;Q.setColorMode(O.colorModeForRenderPass());const de=N.heatmapFbos.get(a.aU);de&&(Q.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_2D,de.colorAttachment.get()),Q.activeTexture.set(se.TEXTURE1),Ea(Q,N).bind(se.LINEAR,se.CLAMP_TO_EDGE),O.useProgram("heatmapTexture").draw(Q,se.TRIANGLES,yi.disabled,Xi.disabled,O.colorModeForRenderPass(),qi.disabled,rl(O,N,0,1),null,N.id,O.viewportBuffer,O.quadTriangleIndexBuffer,O.viewportSegments,N.paint,O.transform.zoom))}(y,E)})(i,h,p,m);break;case"line":(function(y,I,E,M){if(y.renderPass!=="translucent")return;const D=E.paint.get("line-opacity"),O=E.paint.get("line-width");if(D.constantOr(1)===0||O.constantOr(1)===0)return;const N=y.depthModeForSublayer(0,yi.ReadOnly),Q=y.colorModeForRenderPass(),se=E.paint.get("line-dasharray"),de=E.paint.get("line-pattern"),ge=de.constantOr(1),xe=E.paint.get("line-gradient"),ke=E.getCrossfadeParameters(),Ce=ge?"linePattern":se?"lineSDF":xe?"lineGradient":"line",me=y.context,Re=me.gl;let Be=!0;for(const He of M){const ot=I.getTile(He);if(ge&&!ot.patternsLoaded())continue;const wt=ot.getBucket(E);if(!wt)continue;const It=wt.programConfigurations.get(E.id),At=y.context.program.get(),kt=y.useProgram(Ce,It),xt=Be||kt.program!==At,Nt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(He),ri=de.constantOr(null);if(ri&&ot.imageAtlas){const ti=ot.imageAtlas,Qi=ti.patternPositions[ri.to.toString()],fi=ti.patternPositions[ri.from.toString()];Qi&&fi&&It.setConstantPatternPositions(Qi,fi)}const St=Nt?He:null,Lt=ge?Es(y,ot,E,ke,St):se?qd(y,ot,E,se,ke,St):xe?lh(y,ot,E,wt.lineClipsArray.length,St):sl(y,ot,E,St);if(ge)me.activeTexture.set(Re.TEXTURE0),ot.imageAtlasTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE),It.updatePaintBuffers(ke);else if(se&&(xt||y.lineAtlas.dirty))me.activeTexture.set(Re.TEXTURE0),y.lineAtlas.bind(me);else if(xe){const ti=wt.gradients[E.id];let Qi=ti.texture;if(E.gradientVersion!==ti.version){let fi=256;if(E.stepInterpolant){const ki=I.getSource().maxzoom,en=He.canonical.z===ki?Math.ceil(1<<y.transform.maxZoom-He.canonical.z):1;fi=a.ac(a.aV(wt.maxLineLength/a.X*1024*en),256,me.maxTextureSize)}ti.gradient=a.aW({expression:E.gradientExpression(),evaluationKey:"lineProgress",resolution:fi,image:ti.gradient||void 0,clips:wt.lineClipsArray}),ti.texture?ti.texture.update(ti.gradient):ti.texture=new ce(me,ti.gradient,Re.RGBA),ti.version=E.gradientVersion,Qi=ti.texture}me.activeTexture.set(Re.TEXTURE0),Qi.bind(E.stepInterpolant?Re.NEAREST:Re.LINEAR,Re.CLAMP_TO_EDGE)}kt.draw(me,Re.TRIANGLES,N,y.stencilModeForClipping(He),Q,qi.disabled,Lt,Nt,E.id,wt.layoutVertexBuffer,wt.indexBuffer,wt.segments,E.paint,y.transform.zoom,It,wt.layoutVertexBuffer2),Be=!1}})(i,h,p,m);break;case"fill":(function(y,I,E,M){const D=E.paint.get("fill-color"),O=E.paint.get("fill-opacity");if(O.constantOr(1)===0)return;const N=y.colorModeForRenderPass(),Q=E.paint.get("fill-pattern"),se=y.opaquePassEnabledForLayer()&&!Q.constantOr(1)&&D.constantOr(a.aM.transparent).a===1&&O.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===se){const de=y.depthModeForSublayer(1,y.renderPass==="opaque"?yi.ReadWrite:yi.ReadOnly);La(y,I,E,M,de,N,!1)}if(y.renderPass==="translucent"&&E.paint.get("fill-antialias")){const de=y.depthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,yi.ReadOnly);La(y,I,E,M,de,N,!0)}})(i,h,p,m);break;case"fill-extrusion":(function(y,I,E,M){const D=E.paint.get("fill-extrusion-opacity");if(D!==0&&y.renderPass==="translucent"){const O=new yi(y.context.gl.LEQUAL,yi.ReadWrite,y.depthRangeFor3D);if(D!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))fl(y,I,E,M,O,Xi.disabled,xn.disabled),fl(y,I,E,M,O,y.stencilModeFor3D(),y.colorModeForRenderPass());else{const N=y.colorModeForRenderPass();fl(y,I,E,M,O,Xi.disabled,N)}}})(i,h,p,m);break;case"hillshade":(function(y,I,E,M){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const D=y.context,O=y.depthModeForSublayer(0,yi.ReadOnly),N=y.colorModeForRenderPass(),[Q,se]=y.renderPass==="translucent"?y.stencilConfigForOverlap(M):[{},M];for(const de of se){const ge=I.getTile(de);ge.needsHillshadePrepare!==void 0&&ge.needsHillshadePrepare&&y.renderPass==="offscreen"?zs(y,ge,E,O,Xi.disabled,N):y.renderPass==="translucent"&&Ps(y,de,ge,E,O,Q[de.overscaledZ],N)}D.viewport.set([0,0,y.width,y.height])})(i,h,p,m);break;case"raster":(function(y,I,E,M){if(y.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!M.length)return;const D=y.context,O=D.gl,N=I.getSource(),Q=y.useProgram("raster"),se=y.colorModeForRenderPass(),[de,ge]=N instanceof Ni?[{},M]:y.stencilConfigForOverlap(M),xe=ge[ge.length-1].overscaledZ,ke=!y.options.moving;for(const Ce of ge){const me=y.depthModeForSublayer(Ce.overscaledZ-xe,E.paint.get("raster-opacity")===1?yi.ReadWrite:yi.ReadOnly,O.LESS),Re=I.getTile(Ce);Re.registerFadeDuration(E.paint.get("raster-fade-duration"));const Be=I.findLoadedParent(Ce,0),He=I.findLoadedSibling(Ce),ot=Sh(Re,Be||He||null,I,E,y.transform,y.style.map.terrain);let wt,It;const At=E.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;D.activeTexture.set(O.TEXTURE0),Re.texture.bind(At,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),D.activeTexture.set(O.TEXTURE1),Be?(Be.texture.bind(At,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),wt=Math.pow(2,Be.tileID.overscaledZ-Re.tileID.overscaledZ),It=[Re.tileID.canonical.x*wt%1,Re.tileID.canonical.y*wt%1]):Re.texture.bind(At,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),Re.texture.useMipmap&&D.extTextureFilterAnisotropic&&y.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const kt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ce),xt=kt?Ce:null,Nt=xt?xt.posMatrix:y.transform.calculatePosMatrix(Ce.toUnwrapped(),ke),ri=Zd(Nt,It||[0,0],wt||1,ot,E);N instanceof Ni?Q.draw(D,O.TRIANGLES,me,Xi.disabled,se,qi.disabled,ri,kt,E.id,N.boundsBuffer,y.quadTriangleIndexBuffer,N.boundsSegments):Q.draw(D,O.TRIANGLES,me,de[Ce.overscaledZ],se,qi.disabled,ri,kt,E.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}})(i,h,p,m);break;case"background":(function(y,I,E,M){const D=E.paint.get("background-color"),O=E.paint.get("background-opacity");if(O===0)return;const N=y.context,Q=N.gl,se=y.transform,de=se.tileSize,ge=E.paint.get("background-pattern");if(y.isPatternMissing(ge))return;const xe=!ge&&D.a===1&&O===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==xe)return;const ke=Xi.disabled,Ce=y.depthModeForSublayer(0,xe==="opaque"?yi.ReadWrite:yi.ReadOnly),me=y.colorModeForRenderPass(),Re=y.useProgram(ge?"backgroundPattern":"background"),Be=M||se.coveringTiles({tileSize:de,terrain:y.style.map.terrain});ge&&(N.activeTexture.set(Q.TEXTURE0),y.imageManager.bind(y.context));const He=E.getCrossfadeParameters();for(const ot of Be){const wt=M?ot.posMatrix:y.transform.calculatePosMatrix(ot.toUnwrapped()),It=ge?Cc(wt,O,y,ge,{tileID:ot,tileSize:de},He):al(wt,O,D),At=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ot);Re.draw(N,Q.TRIANGLES,Ce,ke,me,qi.disabled,It,At,E.id,y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}})(i,0,p,m);break;case"custom":(function(y,I,E){const M=y.context,D=E.implementation;if(y.renderPass==="offscreen"){const O=D.prerender;O&&(y.setCustomLayerDefaults(),M.setColorMode(y.colorModeForRenderPass()),O.call(D,M.gl,y.transform.customLayerMatrix()),M.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),M.setColorMode(y.colorModeForRenderPass()),M.setStencilMode(Xi.disabled);const O=D.renderingMode==="3d"?new yi(y.context.gl.LEQUAL,yi.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,yi.ReadOnly);M.setDepthMode(O),D.render(M.gl,y.transform.customLayerMatrix(),{farZ:y.transform.farZ,nearZ:y.transform.nearZ,fov:y.transform._fov,modelViewProjectionMatrix:y.transform.modelViewProjectionMatrix,projectionMatrix:y.transform.projectionMatrix}),M.setDirty(),y.setBaseState(),M.bindFramebuffer.set(null)}})(i,0,p)}}translatePosMatrix(i,h,p,m,y){if(!p[0]&&!p[1])return i;const I=y?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(I){const D=Math.sin(I),O=Math.cos(I);p=[p[0]*O-p[1]*D,p[0]*D+p[1]*O]}const E=[y?p[0]:xi(h,p[0],this.transform.zoom),y?p[1]:xi(h,p[1],this.transform.zoom),0],M=new Float32Array(16);return a.J(M,i,E),M}saveTileTexture(i){const h=this._tileTextures[i.size[0]];h?h.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const h=this._tileTextures[i];return h&&h.length>0?h.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const h=this.imageManager.getPattern(i.from.toString()),p=this.imageManager.getPattern(i.to.toString());return!h||!p}useProgram(i,h){this.cache=this.cache||{};const p=i+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new Tc(this.context,Uo[i],h,Ec[i],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ce(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:i,drawingBufferHeight:h}=this.context.gl;return this.width!==i||this.height!==h}}class Rs{constructor(i,h){this.points=i,this.planes=h}static fromInvProjectionMatrix(i,h,p){const m=Math.pow(2,p),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const M=1/(E=a.af([],E,i))[3]/h*m;return a.b1(E,E,[M,M,1/E[3],M])}),I=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const M=function(Q,se){var de=se[0],ge=se[1],xe=se[2],ke=de*de+ge*ge+xe*xe;return ke>0&&(ke=1/Math.sqrt(ke)),Q[0]=se[0]*ke,Q[1]=se[1]*ke,Q[2]=se[2]*ke,Q}([],function(Q,se,de){var ge=se[0],xe=se[1],ke=se[2],Ce=de[0],me=de[1],Re=de[2];return Q[0]=xe*Re-ke*me,Q[1]=ke*Ce-ge*Re,Q[2]=ge*me-xe*Ce,Q}([],te([],y[E[0]],y[E[1]]),te([],y[E[2]],y[E[1]]))),D=-((O=M)[0]*(N=y[E[1]])[0]+O[1]*N[1]+O[2]*N[2]);var O,N;return M.concat(D)});return new Rs(y,I)}}class Fs{constructor(i,h){this.min=i,this.max=h,this.center=function(p,m,y){return p[0]=.5*m[0],p[1]=.5*m[1],p[2]=.5*m[2],p}([],function(p,m,y){return p[0]=m[0]+y[0],p[1]=m[1]+y[1],p[2]=m[2]+y[2],p}([],this.min,this.max))}quadrant(i){const h=[i%2==0,i<2],p=Se(this.min),m=Se(this.max);for(let y=0;y<h.length;y++)p[y]=h[y]?this.min[y]:this.center[y],m[y]=h[y]?this.center[y]:this.max[y];return m[2]=this.max[2],new Fs(p,m)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersects(i){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<i.planes.length;m++){const y=i.planes[m];let I=0;for(let E=0;E<h.length;E++)a.b2(y,h[E])>=0&&I++;if(I===0)return 0;I!==h.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let y=Number.MAX_VALUE,I=-Number.MAX_VALUE;for(let E=0;E<i.points.length;E++){const M=i.points[E][m]-this.min[m];y=Math.min(y,M),I=Math.max(I,M)}if(I<0||y>this.max[m]-this.min[m])return 0}return 1}}class Bs{constructor(i=0,h=0,p=0,m=0){if(isNaN(i)||i<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=h,this.left=p,this.right=m}interpolate(i,h,p){return h.top!=null&&i.top!=null&&(this.top=a.y.number(i.top,h.top,p)),h.bottom!=null&&i.bottom!=null&&(this.bottom=a.y.number(i.bottom,h.bottom,p)),h.left!=null&&i.left!=null&&(this.left=a.y.number(i.left,h.left,p)),h.right!=null&&i.right!=null&&(this.right=a.y.number(i.right,h.right,p)),this}getCenter(i,h){const p=a.ac((this.left+i-this.right)/2,0,i),m=a.ac((this.top+h-this.bottom)/2,0,h);return new a.P(p,m)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Bs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const $c=85.051129;class Os{constructor(i,h,p,m,y){this.tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=i||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Bs,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const i=new Os(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.apply(this),i}apply(i){this.tileSize=i.tileSize,this.latRange=i.latRange,this.lngRange=i.lngRange,this.width=i.width,this.height=i.height,this._center=i._center,this._elevation=i._elevation,this.minElevationForCurrentTile=i.minElevationForCurrentTile,this.zoom=i.zoom,this.angle=i.angle,this._fov=i._fov,this._pitch=i._pitch,this._unmodified=i._unmodified,this._edgeInsets=i._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(i){const h=-a.b3(i,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var p=new a.A(4);return a.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,m,y){var I=m[0],E=m[1],M=m[2],D=m[3],O=Math.sin(y),N=Math.cos(y);p[0]=I*N+M*O,p[1]=E*N+D*O,p[2]=I*-O+M*N,p[3]=E*-O+D*N}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const h=a.ac(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(i){const h=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,h,p){this._unmodified=!1,this._edgeInsets.interpolate(i,h,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const h=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(i){const h=[new a.b4(0,i)];if(this._renderWorldCopies){const p=this.pointCoordinate(new a.P(0,0)),m=this.pointCoordinate(new a.P(this.width,0)),y=this.pointCoordinate(new a.P(this.width,this.height)),I=this.pointCoordinate(new a.P(0,this.height)),E=Math.floor(Math.min(p.x,m.x,y.x,I.x)),M=Math.floor(Math.max(p.x,m.x,y.x,I.x)),D=1;for(let O=E-D;O<=M+D;O++)O!==0&&h.push(new a.b4(O,i))}return h}coveringTiles(i){var h,p;let m=this.coveringZoomLevel(i);const y=m;if(i.minzoom!==void 0&&m<i.minzoom)return[];i.maxzoom!==void 0&&m>i.maxzoom&&(m=i.maxzoom);const I=this.pointCoordinate(this.getCameraPoint()),E=a.Z.fromLngLat(this.center),M=Math.pow(2,m),D=[M*I.x,M*I.y,0],O=[M*E.x,M*E.y,0],N=Rs.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,m);let Q=i.minzoom||0;!i.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Q=m);const se=i.terrain?2/Math.min(this.tileSize,i.tileSize)*this.tileSize:3,de=me=>({aabb:new Fs([me*M,0,0],[(me+1)*M,M,0]),zoom:0,x:0,y:0,wrap:me,fullyVisible:!1}),ge=[],xe=[],ke=m,Ce=i.reparseOverscaled?y:m;if(this._renderWorldCopies)for(let me=1;me<=3;me++)ge.push(de(-me)),ge.push(de(me));for(ge.push(de(0));ge.length>0;){const me=ge.pop(),Re=me.x,Be=me.y;let He=me.fullyVisible;if(!He){const kt=me.aabb.intersects(N);if(kt===0)continue;He=kt===2}const ot=i.terrain?D:O,wt=me.aabb.distanceX(ot),It=me.aabb.distanceY(ot),At=Math.max(Math.abs(wt),Math.abs(It));if(me.zoom===ke||At>se+(1<<ke-me.zoom)-2&&me.zoom>=Q){const kt=ke-me.zoom,xt=D[0]-.5-(Re<<kt),Nt=D[1]-.5-(Be<<kt);xe.push({tileID:new a.S(me.zoom===ke?Ce:me.zoom,me.wrap,me.zoom,Re,Be),distanceSq:Y([O[0]-.5-Re,O[1]-.5-Be]),tileDistanceToCamera:Math.sqrt(xt*xt+Nt*Nt)})}else for(let kt=0;kt<4;kt++){const xt=(Re<<1)+kt%2,Nt=(Be<<1)+(kt>>1),ri=me.zoom+1;let St=me.aabb.quadrant(kt);if(i.terrain){const Lt=new a.S(ri,me.wrap,ri,xt,Nt),ti=i.terrain.getMinMaxElevation(Lt),Qi=(h=ti.minElevation)!==null&&h!==void 0?h:this.elevation,fi=(p=ti.maxElevation)!==null&&p!==void 0?p:this.elevation;St=new Fs([St.min[0],St.min[1],Qi],[St.max[0],St.max[1],fi])}ge.push({aabb:St,zoom:ri,x:xt,y:Nt,wrap:me.wrap,fullyVisible:He})}}return xe.sort((me,Re)=>me.distanceSq-Re.distanceSq).map(me=>me.tileID)}resize(i,h){this.width=i,this.height=h,this.pixelsToGLUnits=[2/i,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const h=a.ac(i.lat,-85.051129,$c);return new a.P(a.O(i.lng)*this.worldSize,a.Q(h)*this.worldSize)}unproject(i){return new a.Z(i.x/this.worldSize,i.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(i){const h=this.elevation,p=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,i),y=i.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-y))return;const I=p+h-y,E=Math.cos(this._pitch)*this.cameraToCenterDistance/I/a.b5(1,m.lat),M=this.scaleZoom(E/this.tileSize);this._elevation=y,this._center=m,this.zoom=M}setLocationAtPoint(i,h){const p=this.pointCoordinate(h),m=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(i),I=new a.Z(y.x-(p.x-m.x),y.y-(p.y-m.y));this.center=this.coordinateLocation(I),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(i,h){return h?this.coordinatePoint(this.locationCoordinate(i),h.getElevationForLngLatZoom(i,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(i))}pointLocation(i,h){return this.coordinateLocation(this.pointCoordinate(i,h))}locationCoordinate(i){return a.Z.fromLngLat(i)}coordinateLocation(i){return i&&i.toLngLat()}pointCoordinate(i,h){if(h){const Q=h.pointCoordinate(i);if(Q!=null)return Q}const p=[i.x,i.y,0,1],m=[i.x,i.y,1,1];a.af(p,p,this.pixelMatrixInverse),a.af(m,m,this.pixelMatrixInverse);const y=p[3],I=m[3],E=p[1]/y,M=m[1]/I,D=p[2]/y,O=m[2]/I,N=D===O?0:(0-D)/(O-D);return new a.Z(a.y.number(p[0]/y,m[0]/I,N)/this.worldSize,a.y.number(E,M,N)/this.worldSize)}coordinatePoint(i,h=0,p=this.pixelMatrix){const m=[i.x*this.worldSize,i.y*this.worldSize,h,1];return a.af(m,m,p),new a.P(m[0]/m[3],m[1]/m[3])}getBounds(){const i=Math.max(0,this.height/2-this.getHorizon());return new Te().extend(this.pointLocation(new a.P(0,i))).extend(this.pointLocation(new a.P(this.width,i))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Te([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,$c])}calculateTileMatrix(i){const h=i.canonical,p=this.worldSize/this.zoomScale(h.z),m=h.x+Math.pow(2,h.z)*i.wrap,y=a.an(new Float64Array(16));return a.J(y,y,[m*p,h.y*p,0]),a.K(y,y,[p/a.X,p/a.X,1]),y}calculatePosMatrix(i,h=!1){const p=i.key,m=h?this._alignedPosMatrixCache:this._posMatrixCache;if(m[p])return m[p];const y=this.calculateTileMatrix(i);return a.L(y,h?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,y),m[p]=new Float32Array(y),m[p]}calculateFogMatrix(i){const h=i.key,p=this._fogMatrixCache;if(p[h])return p[h];const m=this.calculateTileMatrix(i);return a.L(m,this.fogMatrix,m),p[h]=new Float32Array(m),p[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(i,h){h=a.ac(+h,this.minZoom,this.maxZoom);const p={center:new a.N(i.lng,i.lat),zoom:h};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const me=179.9999999999;m=[-me,me]}const y=this.tileSize*this.zoomScale(p.zoom);let I=0,E=y,M=0,D=y,O=0,N=0;const{x:Q,y:se}=this.size;if(this.latRange){const me=this.latRange;I=a.Q(me[1])*y,E=a.Q(me[0])*y,E-I<se&&(O=se/(E-I))}m&&(M=a.b3(a.O(m[0])*y,0,y),D=a.b3(a.O(m[1])*y,0,y),D<M&&(D+=y),D-M<Q&&(N=Q/(D-M)));const{x:de,y:ge}=this.project.call({worldSize:y},i);let xe,ke;const Ce=Math.max(N||0,O||0);if(Ce){const me=new a.P(N?(D+M)/2:de,O?(E+I)/2:ge);return p.center=this.unproject.call({worldSize:y},me).wrap(),p.zoom+=this.scaleZoom(Ce),p}if(this.latRange){const me=se/2;ge-me<I&&(ke=I+me),ge+me>E&&(ke=E-me)}if(m){const me=(M+D)/2;let Re=de;this._renderWorldCopies&&(Re=a.b3(de,me-y/2,me+y/2));const Be=Q/2;Re-Be<M&&(xe=M+Be),Re+Be>D&&(xe=D-Be)}if(xe!==void 0||ke!==void 0){const me=new a.P(xe??de,ke??ge);p.center=this.unproject.call({worldSize:y},me).wrap()}return p}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this._unmodified,{center:h,zoom:p}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=p,this._unmodified=i,this._constraining=!1}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,h=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b5(1,this.center.lat)*this.worldSize;let m=a.an(new Float64Array(16));a.K(m,m,[this.width/2,-this.height/2,1]),a.J(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=a.an(new Float64Array(16)),a.K(m,m,[1,-1,1]),a.J(m,m,[-1,-1,0]),a.K(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const y=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),I=Math.min(this.elevation,this.minElevationForCurrentTile),E=y-I*this._pixelPerMeter/Math.cos(this._pitch),M=I<0?E:y,D=Math.PI/2+this._pitch,O=this._fov*(.5+i.y/this.height),N=Math.sin(O)*M/Math.sin(a.ac(Math.PI-D-O,.01,Math.PI-.01)),Q=this.getHorizon(),se=2*Math.atan(Q/this.cameraToCenterDistance)*(.5+i.y/(2*Q)),de=Math.sin(se)*M/Math.sin(a.ac(Math.PI-D-se,.01,Math.PI-.01)),ge=Math.min(N,de);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*ge+M),this.nearZ=this.height/50,m=new Float64Array(16),a.b6(m,this._fov,this.width/this.height,this.nearZ,this.farZ),m[8]=2*-i.x/this.width,m[9]=2*i.y/this.height,this.projectionMatrix=a.ae(m),a.K(m,m,[1,-1,1]),a.J(m,m,[0,0,-this.cameraToCenterDistance]),a.b7(m,m,this._pitch),a.ad(m,m,this.angle),a.J(m,m,[-h,-p,0]),this.mercatorMatrix=a.K([],m,[this.worldSize,this.worldSize,this.worldSize]),a.K(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.L(new Float64Array(16),this.labelPlaneMatrix,m),a.J(m,m,[0,0,-this.elevation]),this.modelViewProjectionMatrix=m,this.invModelViewProjectionMatrix=a.as([],m),this.fogMatrix=new Float64Array(16),a.b6(this.fogMatrix,this._fov,this.width/this.height,y,this.farZ),this.fogMatrix[8]=2*-i.x/this.width,this.fogMatrix[9]=2*i.y/this.height,a.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),a.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),a.b7(this.fogMatrix,this.fogMatrix,this._pitch),a.ad(this.fogMatrix,this.fogMatrix,this.angle),a.J(this.fogMatrix,this.fogMatrix,[-h,-p,0]),a.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),a.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=a.L(new Float64Array(16),this.labelPlaneMatrix,m);const xe=this.width%2/2,ke=this.height%2/2,Ce=Math.cos(this.angle),me=Math.sin(this.angle),Re=h-Math.round(h)+Ce*xe+me*ke,Be=p-Math.round(p)+Ce*ke+me*xe,He=new Float64Array(m);if(a.J(He,He,[Re>.5?Re-1:Re,Be>.5?Be-1:Be,0]),this.alignedModelViewProjectionMatrix=He,m=a.as(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const i=this.pointCoordinate(new a.P(0,0)),h=[i.x*this.worldSize,i.y*this.worldSize,0,1];return a.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,i))}getCameraQueryGeometry(i){const h=this.getCameraPoint();if(i.length===1)return[i[0],h];{let p=h.x,m=h.y,y=h.x,I=h.y;for(const E of i)p=Math.min(p,E.x),m=Math.min(m,E.y),y=Math.max(y,E.x),I=Math.max(I,E.y);return[new a.P(p,m),new a.P(y,m),new a.P(y,I),new a.P(p,I),new a.P(p,m)]}}lngLatToCameraDepth(i,h){const p=this.locationCoordinate(i),m=[p.x*this.worldSize,p.y*this.worldSize,h,1];return a.af(m,m,this.modelViewProjectionMatrix),m[2]/m[3]}}function Ma(v,i){let h,p=!1,m=null,y=null;const I=()=>{m=null,p&&(v.apply(y,h),m=setTimeout(I,i),p=!1)};return(...E)=>(p=!0,y=this,h=E,m||I(),m)}class yl{constructor(i){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let p;return h.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:p,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());window.history.replaceState(window.history.state,null,h)},this._removeHash=()=>{const h=this._getCurrentHash();if(h.length===0)return;const p=h.join("/");let m=p;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${p}`);let y=window.location.hash.replace(m,"");y.startsWith("#&")?y=y.slice(0,1)+y.slice(2):y==="#"&&(y="");let I=window.location.href.replace(/(#.+)?$/,y);I=I.replace("&&","&"),window.history.replaceState(window.history.state,null,I)},this._updateHash=Ma(this._updateHashUnthrottled,300),this._hashName=i&&encodeURIComponent(i)}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(i){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,m),I=Math.round(h.lng*y)/y,E=Math.round(h.lat*y)/y,M=this._map.getBearing(),D=this._map.getPitch();let O="";if(O+=i?`/${I}/${E}/${p}`:`${p}/${E}/${I}`,(M||D)&&(O+="/"+Math.round(10*M)/10),D&&(O+=`/${Math.round(D)}`),this._hashName){const N=this._hashName;let Q=!1;const se=window.location.hash.slice(1).split("&").map(de=>{const ge=de.split("=")[0];return ge===N?(Q=!0,`${ge}=${O}`):de}).filter(de=>de);return Q||se.push(`${N}=${O}`),`#${se.join("&")}`}return`#${O}`}}const bl={linearity:.3,easing:a.b8(0,0,.3,1)},Vc=a.e({deceleration:2500,maxSpeed:1400},bl),of=a.e({deceleration:20,maxSpeed:1400},bl),Lh=a.e({deceleration:1e3,maxSpeed:360},bl),vl=a.e({deceleration:1e3,maxSpeed:90},bl);class qc{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:S.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,h=S.now();for(;i.length>0&&h-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)h.zoom+=y.zoomDelta||0,h.bearing+=y.bearingDelta||0,h.pitch+=y.pitchDelta||0,y.panDelta&&h.pan._add(y.panDelta),y.around&&(h.around=y.around),y.pinchAround&&(h.pinchAround=y.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(h.pan.mag()){const y=Pa(h.pan.mag(),p,a.e({},Vc,i||{}));m.offset=h.pan.mult(y.amount/h.pan.mag()),m.center=this._map.transform.center,Aa(m,y)}if(h.zoom){const y=Pa(h.zoom,p,of);m.zoom=this._map.transform.zoom+y.amount,Aa(m,y)}if(h.bearing){const y=Pa(h.bearing,p,Lh);m.bearing=this._map.transform.bearing+a.ac(y.amount,-179,179),Aa(m,y)}if(h.pitch){const y=Pa(h.pitch,p,vl);m.pitch=this._map.transform.pitch+y.amount,Aa(m,y)}if(m.zoom||m.bearing){const y=h.pinchAround===void 0?h.around:h.pinchAround;m.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),a.e(m,{noMoveStart:!0})}}function Aa(v,i){(!v.duration||v.duration<i.duration)&&(v.duration=i.duration,v.easing=i.easing)}function Pa(v,i,h){const{maxSpeed:p,linearity:m,deceleration:y}=h,I=a.ac(v*m/(i/1e3),-p,p),E=Math.abs(I)/(y*m);return{easing:h.easing,duration:1e3*E,amount:I*(E/2)}}class Qn extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,p,m={}){const y=L.mousePos(h.getCanvas(),p),I=h.unproject(y);super(i,a.e({point:y,lngLat:I,originalEvent:p},m)),this._defaultPrevented=!1,this.target=h}}class rs extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,p){const m=i==="touchend"?p.changedTouches:p.touches,y=L.touchPos(h.getCanvasContainer(),m),I=y.map(M=>h.unproject(M)),E=y.reduce((M,D,O,N)=>M.add(D.div(N.length)),new a.P(0,0));super(i,{points:y,point:E,lngLats:I,lngLat:h.unproject(E),originalEvent:p}),this._defaultPrevented=!1}}class Mh extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,p){super(i,{originalEvent:p}),this._defaultPrevented=!1}}class Ah{constructor(i,h){this._map=i,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new Mh(i.type,this._map,i))}mousedown(i,h){return this._mousedownPos=h,this._firePreventable(new Qn(i.type,this._map,i))}mouseup(i){this._map.fire(new Qn(i.type,this._map,i))}click(i,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Qn(i.type,this._map,i))}dblclick(i){return this._firePreventable(new Qn(i.type,this._map,i))}mouseover(i){this._map.fire(new Qn(i.type,this._map,i))}mouseout(i){this._map.fire(new Qn(i.type,this._map,i))}touchstart(i){return this._firePreventable(new rs(i.type,this._map,i))}touchmove(i){this._map.fire(new rs(i.type,this._map,i))}touchend(i){this._map.fire(new rs(i.type,this._map,i))}touchcancel(i){this._map.fire(new rs(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class kn{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new Qn(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new Qn(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ro{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.pointLocation(a.P.convert(i),this._map.terrain)}}class Br{constructor(i,h){this._map=i,this._tr=new ro(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,h){this.isEnabled()&&i.shiftKey&&i.button===0&&(L.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(i,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=L.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const y=Math.min(m.x,p.x),I=Math.max(m.x,p.x),E=Math.min(m.y,p.y),M=Math.max(m.y,p.y);L.setTransform(this._box,`translate(${y}px,${E}px)`),this._box.style.width=I-y+"px",this._box.style.height=M-E+"px"}mouseupWindow(i,h){if(!this._active||i.button!==0)return;const p=this._startPos,m=h;if(this.reset(),L.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:i})),{cameraAnimation:y=>y.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(L.remove(this._box),this._box=null),L.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,h){return this._map.fire(new a.k(i,{originalEvent:h}))}}function za(v,i){if(v.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${i.length}`);const h={};for(let p=0;p<v.length;p++)h[v[p].identifier]=i[p];return h}class Zc{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const y=new a.P(0,0);for(const I of m)y._add(I);return y.div(m.length)}(h),this.touches=za(p,h)))}touchmove(i,h,p){if(this.aborted||!this.centroid)return;const m=za(p,h);for(const y in this.touches){const I=m[y];(!I||I.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(i,h,p){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class wl{constructor(i){this.singleTap=new Zc(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,h,p){this.singleTap.touchstart(i,h,p)}touchmove(i,h,p){this.singleTap.touchmove(i,h,p)}touchend(i,h,p){const m=this.singleTap.touchend(i,h,p);if(m){const y=i.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(m)<30;if(y&&I||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Ns{constructor(i){this._tr=new ro(i),this._zoomIn=new wl({numTouches:1,numTaps:2}),this._zoomOut=new wl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,h,p){this._zoomIn.touchstart(i,h,p),this._zoomOut.touchstart(i,h,p)}touchmove(i,h,p){this._zoomIn.touchmove(i,h,p),this._zoomOut.touchmove(i,h,p)}touchend(i,h,p){const m=this._zoomIn.touchend(i,h,p),y=this._zoomOut.touchend(i,h,p),I=this._tr;return m?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:I.zoom+1,around:I.unproject(m)},{originalEvent:i})}):y?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:I.zoom-1,around:I.unproject(y)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Po{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const h=this._moveFunction(...i);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(i,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,h){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const m=h.length?h[0]:h;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&L.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Gc={0:1,2:2};class xl{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const h=L.mouseButton(i);this._eventButton=h}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!function(h,p){const m=Gc[p];return h.buttons===void 0||(h.buttons&m)!==m}(i,this._eventButton)}isValidEndEvent(i){return L.mouseButton(i)===this._eventButton}}class Wc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}const kl=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=i=>{i.preventDefault()}},Hc=({enable:v,clickTolerance:i,bearingDegreesPerPixelMoved:h=.8})=>{const p=new xl({checkCorrectEvent:m=>L.mouseButton(m)===0&&m.ctrlKey||L.mouseButton(m)===2});return new Po({clickTolerance:i,move:(m,y)=>({bearingDelta:(y.x-m.x)*h}),moveStateManager:p,enable:v,assignEvents:kl})},Xc=({enable:v,clickTolerance:i,pitchDegreesPerPixelMoved:h=-.5})=>{const p=new xl({checkCorrectEvent:m=>L.mouseButton(m)===0&&m.ctrlKey||L.mouseButton(m)===2});return new Po({clickTolerance:i,move:(m,y)=>({pitchDelta:(y.y-m.y)*h}),moveStateManager:p,enable:v,assignEvents:kl})};class os{constructor(i,h){this._clickTolerance=i.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(i){return i<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(i,h,p){return this._calculateTransform(i,h,p)}touchmove(i,h,p){if(this._active){if(!this._shouldBePrevented(p.length))return i.preventDefault(),this._calculateTransform(i,h,p);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",i)}}touchend(i,h,p){this._calculateTransform(i,h,p),this._active&&this._shouldBePrevented(p.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,h,p){p.length>0&&(this._active=!0);const m=za(p,h),y=new a.P(0,0),I=new a.P(0,0);let E=0;for(const D in m){const O=m[D],N=this._touches[D];N&&(y._add(O),I._add(O.sub(N)),E++,m[D]=O)}if(this._touches=m,this._shouldBePrevented(E)||!I.mag())return;const M=I.div(E);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(E),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(i,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(i,h,p){if(!this._firstTwoTouches)return;i.preventDefault();const[m,y]=this._firstTwoTouches,I=Da(p,h,m),E=Da(p,h,y);if(!I||!E)return;const M=this._aroundCenter?null:I.add(E).div(2);return this._move([I,E],M,i)}touchend(i,h,p){if(!this._firstTwoTouches)return;const[m,y]=this._firstTwoTouches,I=Da(p,h,m),E=Da(p,h,y);I&&E||(this._active&&L.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Da(v,i,h){for(let p=0;p<v.length;p++)if(v[p].identifier===h)return i[p]}function Kc(v,i){return Math.log(v/i)/Math.LN2}class Jc extends Sl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,h){const p=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Kc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kc(this._distance,p),pinchAround:h}}}function Yc(v,i){return 180*v.angleWith(i)/Math.PI}class Qc extends Sl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,h,p){const m=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Yc(this._vector,m),pinchAround:h}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const h=25/(Math.PI*this._minDiameter)*360,p=Yc(i,this._startVector);return Math.abs(p)<h}}function Tl(v){return Math.abs(v.y)>Math.abs(v.x)}class js extends Sl{constructor(i){super(),this._currentTouchCount=0,this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,h,p){super.touchstart(i,h,p),this._currentTouchCount=p.length}_start(i){this._lastPoints=i,Tl(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,h,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=i[0].sub(this._lastPoints[0]),y=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,y,p.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(m.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(i,h,p){if(this._valid!==void 0)return this._valid;const m=i.mag()>=2,y=h.mag()>=2;if(!m&&!y)return;if(!m||!y)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const I=i.y>0==h.y>0;return Tl(i)&&Tl(h)&&I}}const Ph={panStep:100,bearingStep:15,pitchStep:10};class Hr{constructor(i){this._tr=new ro(i);const h=Ph;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let h=0,p=0,m=0,y=0,I=0;switch(i.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:i.shiftKey?p=-1:(i.preventDefault(),y=-1);break;case 39:i.shiftKey?p=1:(i.preventDefault(),y=1);break;case 38:i.shiftKey?m=1:(i.preventDefault(),I=-1);break;case 40:i.shiftKey?m=-1:(i.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:E=>{const M=this._tr;E.easeTo({duration:300,easeId:"keyboardHandler",easing:bo,zoom:h?Math.round(M.zoom)+h*(i.shiftKey?2:1):M.zoom,bearing:M.bearing+p*this._bearingStep,pitch:M.pitch+m*this._pitchStep,offset:[-y*this._panStep,-I*this._panStep],center:M.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function bo(v){return v*(2-v)}const eu=4.000244140625;class oo{constructor(i,h){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=i,this._tr=new ro(i),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(i){return!!this._map.cooperativeGestures.isEnabled()&&!(i.ctrlKey||this._map.cooperativeGestures.isBypassed(i))}wheel(i){if(!this.isEnabled())return;if(this._shouldBePrevented(i))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",i);let h=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const p=S.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%eu==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(m*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),i.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=i,this._delta-=h,this._active||this._start(i)),i.preventDefault()}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=L.mousePos(this._map.getCanvas(),i),p=this._tr;this._around=h.y>p.transform.height/2-p.transform.getHorizon()?a.N.convert(this._aroundCenter?p.center:p.unproject(h)):a.N.convert(p.center),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>eu?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&D!==0&&(D=1/D);const O=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(O*D))),this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:i.zoom,p=this._startZoom,m=this._easing;let y,I=!1;const E=S.now()-this._lastWheelEventTime;if(this._type==="wheel"&&p&&m&&E){const M=Math.min(E/200,1),D=m(M);y=a.y.number(p,h,D),M<1?this._frameId||(this._frameId=!0):I=!0}else y=h,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:y-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let h=a.b9;if(this._prevEase){const p=this._prevEase,m=(S.now()-p.start)/p.duration,y=p.easing(m+.01)-p.easing(m),I=.27/Math.sqrt(y*y+1e-4)*.01,E=Math.sqrt(.0729-I*I);h=a.b8(I,E,.25,1)}return this._prevEase={start:S.now(),duration:i,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ss{constructor(i,h){this._clickZoom=i,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class sf{constructor(i){this._tr=new ro(i),this.reset()}reset(){this._active=!1}dblclick(i,h){return i.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class af{constructor(){this._tap=new wl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(i,h,p){if(!this._swipePoint)if(this._tapTime){const m=h[0],y=i.timeStamp-this._tapTime<500,I=this._tapPoint.dist(m)<30;y&&I?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(i,h,p)}touchmove(i,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=h[0],y=m.y-this._swipePoint.y;return this._swipePoint=m,i.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(i,h,p)}touchend(i,h,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(i,h,p);m&&(this._tapTime=i.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zh{constructor(i,h,p){this._el=i,this._mousePan=h,this._touchPan=p}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Dh{constructor(i,h,p){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=h,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class tu{constructor(i,h,p,m){this._el=i,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Us{constructor(i,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=i,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const i=this._map.getCanvasContainer();i.classList.add("maplibregl-cooperative-gestures"),this._container=L.create("div","maplibregl-cooperative-gesture-screen",i);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=h,this._container.appendChild(m);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=p,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(L.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(i){return i[this._bypassKey]}notifyGestureBlocked(i,h){this._enabled&&(this._map.fire(new a.k("cooperativegestureprevented",{gestureType:i,originalEvent:h})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Xr=v=>v.zoom||v.drag||v.pitch||v.rotate;class zt extends a.k{}function Il(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class iu{constructor(i,h){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,y)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const I=m.type==="renderFrame"?void 0:m,E={needsRenderFrame:!1},M={},D={},O=m.touches,N=O?this._getMapTouches(O):void 0,Q=N?L.touchPos(this._map.getCanvas(),N):L.mousePos(this._map.getCanvas(),m);for(const{handlerName:ge,handler:xe,allowed:ke}of this._handlers){if(!xe.isEnabled())continue;let Ce;this._blockedByActive(D,ke,ge)?xe.reset():xe[y||m.type]&&(Ce=xe[y||m.type](m,Q,N),this.mergeHandlerResult(E,M,Ce,ge,I),Ce&&Ce.needsRenderFrame&&this._triggerRenderFrame()),(Ce||xe.isActive())&&(D[ge]=xe)}const se={};for(const ge in this._previousActiveHandlers)D[ge]||(se[ge]=I);this._previousActiveHandlers=D,(Object.keys(se).length||Il(E))&&(this._changes.push([E,M,se]),this._triggerRenderFrame()),(Object.keys(D).length||Il(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:de}=E;de&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],de(this._map))},this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qc(i),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,y,I]of this._listeners)L.addEventListener(m,y,m===document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[i,h,p]of this._listeners)L.removeEventListener(i,h,i===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(i){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new Ah(h,i));const m=h.boxZoom=new Br(h,i);this._add("boxZoom",m),i.interactive&&i.boxZoom&&m.enable();const y=h.cooperativeGestures=new Us(h,i.cooperativeGestures);this._add("cooperativeGestures",y),i.cooperativeGestures&&y.enable();const I=new Ns(h),E=new sf(h);h.doubleClickZoom=new ss(E,I),this._add("tapZoom",I),this._add("clickZoom",E),i.interactive&&i.doubleClickZoom&&h.doubleClickZoom.enable();const M=new af;this._add("tapDragZoom",M);const D=h.touchPitch=new js(h);this._add("touchPitch",D),i.interactive&&i.touchPitch&&h.touchPitch.enable(i.touchPitch);const O=Hc(i),N=Xc(i);h.dragRotate=new Dh(i,O,N),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]),i.interactive&&i.dragRotate&&h.dragRotate.enable();const Q=(({enable:Ce,clickTolerance:me})=>{const Re=new xl({checkCorrectEvent:Be=>L.mouseButton(Be)===0&&!Be.ctrlKey});return new Po({clickTolerance:me,move:(Be,He)=>({around:He,panDelta:He.sub(Be)}),activateOnStart:!0,moveStateManager:Re,enable:Ce,assignEvents:kl})})(i),se=new os(i,h);h.dragPan=new zh(p,Q,se),this._add("mousePan",Q),this._add("touchPan",se,["touchZoom","touchRotate"]),i.interactive&&i.dragPan&&h.dragPan.enable(i.dragPan);const de=new Qc,ge=new Jc;h.touchZoomRotate=new tu(p,ge,de,M),this._add("touchRotate",de,["touchPan","touchZoom"]),this._add("touchZoom",ge,["touchPan","touchRotate"]),i.interactive&&i.touchZoomRotate&&h.touchZoomRotate.enable(i.touchZoomRotate);const xe=h.scrollZoom=new oo(h,()=>this._triggerRenderFrame());this._add("scrollZoom",xe,["mousePan"]),i.interactive&&i.scrollZoom&&h.scrollZoom.enable(i.scrollZoom);const ke=h.keyboard=new Hr(h);this._add("keyboard",ke),i.interactive&&i.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new kn(h))}_add(i,h,p){this._handlers.push({handlerName:i,handler:h,allowed:p}),this._handlersById[i]=h}stop(i){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Xr(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,h,p){for(const m in i)if(m!==p&&(!h||h.indexOf(m)<0))return!0;return!1}_getMapTouches(i){const h=[];for(const p of i)this._el.contains(p.target)&&h.push(p);return h}mergeHandlerResult(i,h,p,m,y){if(!p)return;a.e(i,p);const I={handlerName:m,originalEvent:p.originalEvent||y};p.zoomDelta!==void 0&&(h.zoom=I),p.panDelta!==void 0&&(h.drag=I),p.pitchDelta!==void 0&&(h.pitch=I),p.bearingDelta!==void 0&&(h.rotate=I)}_applyChanges(){const i={},h={},p={};for(const[m,y,I]of this._changes)m.panDelta&&(i.panDelta=(i.panDelta||new a.P(0,0))._add(m.panDelta)),m.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(i.around=m.around),m.pinchAround!==void 0&&(i.pinchAround=m.pinchAround),m.noInertia&&(i.noInertia=m.noInertia),a.e(h,y),a.e(p,I);this._updateMapTransform(i,h,p),this._changes=[]}_updateMapTransform(i,h,p){const m=this._map,y=m._getTransformForUpdate(),I=m.terrain;if(!(Il(i)||I&&this._terrainMovement))return this._fireEvents(h,p,!0);let{panDelta:E,zoomDelta:M,bearingDelta:D,pitchDelta:O,around:N,pinchAround:Q}=i;Q!==void 0&&(N=Q),m._stop(!0),N=N||m.transform.centerPoint;const se=y.pointLocation(E?N.sub(E):N);D&&(y.bearing+=D),O&&(y.pitch+=O),M&&(y.zoom+=M),I?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?y.center=y.pointLocation(y.centerPoint.sub(E)):y.setLocationAtPoint(se,N):(this._terrainMovement=!0,this._map._elevationFreeze=!0,y.setLocationAtPoint(se,N)):y.setLocationAtPoint(se,N),m._applyUpdatedTransform(y),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(h,p,!0)}_fireEvents(i,h,p){const m=Xr(this._eventsInProgress),y=Xr(i),I={};for(const N in i){const{originalEvent:Q}=i[N];this._eventsInProgress[N]||(I[`${N}start`]=Q),this._eventsInProgress[N]=i[N]}!m&&y&&this._fireEvent("movestart",y.originalEvent);for(const N in I)this._fireEvent(N,I[N]);y&&this._fireEvent("move",y.originalEvent);for(const N in i){const{originalEvent:Q}=i[N];this._fireEvent(N,Q)}const E={};let M;for(const N in this._eventsInProgress){const{handlerName:Q,originalEvent:se}=this._eventsInProgress[N];this._handlersById[Q].isActive()||(delete this._eventsInProgress[N],M=h[Q]||se,E[`${N}end`]=M)}for(const N in E)this._fireEvent(N,E[N]);const D=Xr(this._eventsInProgress),O=(m||y)&&!D;if(O&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const N=this._map._getTransformForUpdate();N.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(N)}if(p&&O){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Q=se=>se!==0&&-this._bearingSnap<se&&se<this._bearingSnap;!N||!N.essential&&S.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:M})),Q(this._map.getBearing())&&this._map.resetNorth()):(Q(N.bearing||this._map.getBearing())&&(N.bearing=0),N.freezeElevation=!0,this._map.easeTo(N,{originalEvent:M})),this._updatingCamera=!1}}_fireEvent(i,h){this._map.fire(new a.k(i,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new zt("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Rh extends a.E{constructor(i,h){super(),this._renderFrameCallback=()=>{const p=Math.min((S.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.N(this.transform.center.lng,this.transform.center.lat)}setCenter(i,h){return this.jumpTo({center:i},h)}panBy(i,h,p){return i=a.P.convert(i).mult(-1),this.panTo(this.transform.center,a.e({offset:i},h),p)}panTo(i,h,p){return this.easeTo(a.e({center:i},h),p)}getZoom(){return this.transform.zoom}setZoom(i,h){return this.jumpTo({zoom:i},h),this}zoomTo(i,h,p){return this.easeTo(a.e({zoom:i},h),p)}zoomIn(i,h){return this.zoomTo(this.getZoom()+1,i,h),this}zoomOut(i,h){return this.zoomTo(this.getZoom()-1,i,h),this}getBearing(){return this.transform.bearing}setBearing(i,h){return this.jumpTo({bearing:i},h),this}getPadding(){return this.transform.padding}setPadding(i,h){return this.jumpTo({padding:i},h),this}rotateTo(i,h,p){return this.easeTo(a.e({bearing:i},h),p)}resetNorth(i,h){return this.rotateTo(0,a.e({duration:1e3},i),h),this}resetNorthPitch(i,h){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},i),h),this}snapToNorth(i,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,h):this}getPitch(){return this.transform.pitch}setPitch(i,h){return this.jumpTo({pitch:i},h),this}cameraForBounds(i,h){i=Te.convert(i).adjustAntiMeridian();const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),p,h)}_cameraForBoxAndBearing(i,h,p,m){const y={top:0,bottom:0,right:0,left:0};if(typeof(m=a.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const kt=m.padding;m.padding={top:kt,bottom:kt,right:kt,left:kt}}m.padding=a.e(y,m.padding);const I=this.transform,E=I.padding,M=new Te(i,h),D=I.project(M.getNorthWest()),O=I.project(M.getNorthEast()),N=I.project(M.getSouthEast()),Q=I.project(M.getSouthWest()),se=a.ba(-p),de=D.rotate(se),ge=O.rotate(se),xe=N.rotate(se),ke=Q.rotate(se),Ce=new a.P(Math.max(de.x,ge.x,ke.x,xe.x),Math.max(de.y,ge.y,ke.y,xe.y)),me=new a.P(Math.min(de.x,ge.x,ke.x,xe.x),Math.min(de.y,ge.y,ke.y,xe.y)),Re=Ce.sub(me),Be=(I.width-(E.left+E.right+m.padding.left+m.padding.right))/Re.x,He=(I.height-(E.top+E.bottom+m.padding.top+m.padding.bottom))/Re.y;if(He<0||Be<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ot=Math.min(I.scaleZoom(I.scale*Math.min(Be,He)),m.maxZoom),wt=a.P.convert(m.offset),It=new a.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(a.ba(p)),At=wt.add(It).mult(I.scale/I.zoomScale(ot));return{center:I.unproject(D.add(N).div(2).sub(At)),zoom:ot,bearing:p}}fitBounds(i,h,p){return this._fitInternal(this.cameraForBounds(i,h),h,p)}fitScreenCoordinates(i,h,p,m,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(i)),this.transform.pointLocation(a.P.convert(h)),p,m),m,y)}_fitInternal(i,h,p){return i?(delete(h=a.e(i,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(i,h){this.stop();const p=this._getTransformForUpdate();let m=!1,y=!1,I=!1;return"zoom"in i&&p.zoom!==+i.zoom&&(m=!0,p.zoom=+i.zoom),i.center!==void 0&&(p.center=a.N.convert(i.center)),"bearing"in i&&p.bearing!==+i.bearing&&(y=!0,p.bearing=+i.bearing),"pitch"in i&&p.pitch!==+i.pitch&&(I=!0,p.pitch=+i.pitch),i.padding==null||p.isPaddingEqual(i.padding)||(p.padding=i.padding),this._applyUpdatedTransform(p),this.fire(new a.k("movestart",h)).fire(new a.k("move",h)),m&&this.fire(new a.k("zoomstart",h)).fire(new a.k("zoom",h)).fire(new a.k("zoomend",h)),y&&this.fire(new a.k("rotatestart",h)).fire(new a.k("rotate",h)).fire(new a.k("rotateend",h)),I&&this.fire(new a.k("pitchstart",h)).fire(new a.k("pitch",h)).fire(new a.k("pitchend",h)),this.fire(new a.k("moveend",h))}calculateCameraOptionsFromTo(i,h,p,m=0){const y=a.Z.fromLngLat(i,h),I=a.Z.fromLngLat(p,m),E=I.x-y.x,M=I.y-y.y,D=I.z-y.z,O=Math.hypot(E,M,D);if(O===0)throw new Error("Can't calculate camera options with same From and To");const N=Math.hypot(E,M),Q=this.transform.scaleZoom(this.transform.cameraToCenterDistance/O/this.transform.tileSize),se=180*Math.atan2(E,-M)/Math.PI;let de=180*Math.acos(N/O)/Math.PI;return de=D<0?90-de:90+de,{center:I.toLngLat(),zoom:Q,pitch:de,bearing:se}}easeTo(i,h){var p;this._stop(!1,i.easeId),((i=a.e({offset:[0,0],duration:500,easing:a.b9},i)).animate===!1||!i.essential&&S.prefersReducedMotion)&&(i.duration=0);const m=this._getTransformForUpdate(),y=m.zoom,I=m.bearing,E=m.pitch,M=m.padding,D="bearing"in i?this._normalizeBearing(i.bearing,I):I,O="pitch"in i?+i.pitch:E,N="padding"in i?i.padding:m.padding,Q=a.P.convert(i.offset);let se=m.centerPoint.add(Q);const de=m.pointLocation(se),{center:ge,zoom:xe}=m.getConstrained(a.N.convert(i.center||de),(p=i.zoom)!==null&&p!==void 0?p:y);this._normalizeCenter(ge,m);const ke=m.project(de),Ce=m.project(ge).sub(ke),me=m.zoomScale(xe-y);let Re,Be;i.around&&(Re=a.N.convert(i.around),Be=m.locationPoint(Re));const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||xe!==y,this._rotating=this._rotating||I!==D,this._pitching=this._pitching||O!==E,this._padding=!m.isPaddingEqual(N),this._easeId=i.easeId,this._prepareEase(h,i.noMoveStart,He),this.terrain&&this._prepareElevation(ge),this._ease(ot=>{if(this._zooming&&(m.zoom=a.y.number(y,xe,ot)),this._rotating&&(m.bearing=a.y.number(I,D,ot)),this._pitching&&(m.pitch=a.y.number(E,O,ot)),this._padding&&(m.interpolatePadding(M,N,ot),se=m.centerPoint.add(Q)),this.terrain&&!i.freezeElevation&&this._updateElevation(ot),Re)m.setLocationAtPoint(Re,Be);else{const wt=m.zoomScale(m.zoom-y),It=xe>y?Math.min(2,me):Math.max(.5,me),At=Math.pow(It,1-ot),kt=m.unproject(ke.add(Ce.mult(ot*At)).mult(wt));m.setLocationAtPoint(m.renderWorldCopies?kt.wrap():kt,se)}this._applyUpdatedTransform(m),this._fireMoveEvents(h)},ot=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(h,ot)},i),this}_prepareEase(i,h,p={}){this._moving=!0,h||p.moving||this.fire(new a.k("movestart",i)),this._zooming&&!p.zooming&&this.fire(new a.k("zoomstart",i)),this._rotating&&!p.rotating&&this.fire(new a.k("rotatestart",i)),this._pitching&&!p.pitching&&this.fire(new a.k("pitchstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(i,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(i){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(i<1&&h!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(p-(h-(p*i+this._elevationStart))/(1-i)),this._elevationTarget=h}this.transform.elevation=a.y.number(this._elevationStart,this._elevationTarget,i)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(i){const h=i.getCameraPosition(),p=this.terrain.getElevationForLngLatZoom(h.lngLat,i.zoom);if(h.altitude<p){const m=this.calculateCameraOptionsFromTo(h.lngLat,p,i.center,i.elevation);return{pitch:m.pitch,zoom:m.zoom}}return{}}_applyUpdatedTransform(i){const h=[];if(this.terrain&&h.push(m=>this._elevateCameraIfInsideTerrain(m)),this.transformCameraUpdate&&h.push(m=>this.transformCameraUpdate(m)),!h.length)return;const p=i.clone();for(const m of h){const y=p.clone(),{center:I,zoom:E,pitch:M,bearing:D,elevation:O}=m(y);I&&(y.center=I),E!==void 0&&(y.zoom=E),M!==void 0&&(y.pitch=M),D!==void 0&&(y.bearing=D),O!==void 0&&(y.elevation=O),p.apply(y)}this.transform.apply(p)}_fireMoveEvents(i){this.fire(new a.k("move",i)),this._zooming&&this.fire(new a.k("zoom",i)),this._rotating&&this.fire(new a.k("rotate",i)),this._pitching&&this.fire(new a.k("pitch",i))}_afterEase(i,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const p=this._zooming,m=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new a.k("zoomend",i)),m&&this.fire(new a.k("rotateend",i)),y&&this.fire(new a.k("pitchend",i)),this.fire(new a.k("moveend",i))}flyTo(i,h){var p;if(!i.essential&&S.prefersReducedMotion){const Lt=a.M(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Lt,h)}this.stop(),i=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b9},i);const m=this._getTransformForUpdate(),y=m.zoom,I=m.bearing,E=m.pitch,M=m.padding,D="bearing"in i?this._normalizeBearing(i.bearing,I):I,O="pitch"in i?+i.pitch:E,N="padding"in i?i.padding:m.padding,Q=a.P.convert(i.offset);let se=m.centerPoint.add(Q);const de=m.pointLocation(se),{center:ge,zoom:xe}=m.getConstrained(a.N.convert(i.center||de),(p=i.zoom)!==null&&p!==void 0?p:y);this._normalizeCenter(ge,m);const ke=m.zoomScale(xe-y),Ce=m.project(de),me=m.project(ge).sub(Ce);let Re=i.curve;const Be=Math.max(m.width,m.height),He=Be/ke,ot=me.mag();if("minZoom"in i){const Lt=a.ac(Math.min(i.minZoom,y,xe),m.minZoom,m.maxZoom),ti=Be/m.zoomScale(Lt-y);Re=Math.sqrt(ti/ot*2)}const wt=Re*Re;function It(Lt){const ti=(He*He-Be*Be+(Lt?-1:1)*wt*wt*ot*ot)/(2*(Lt?He:Be)*wt*ot);return Math.log(Math.sqrt(ti*ti+1)-ti)}function At(Lt){return(Math.exp(Lt)-Math.exp(-Lt))/2}function kt(Lt){return(Math.exp(Lt)+Math.exp(-Lt))/2}const xt=It(!1);let Nt=function(Lt){return kt(xt)/kt(xt+Re*Lt)},ri=function(Lt){return Be*((kt(xt)*(At(ti=xt+Re*Lt)/kt(ti))-At(xt))/wt)/ot;var ti},St=(It(!0)-xt)/Re;if(Math.abs(ot)<1e-6||!isFinite(St)){if(Math.abs(Be-He)<1e-6)return this.easeTo(i,h);const Lt=He<Be?-1:1;St=Math.abs(Math.log(He/Be))/Re,ri=()=>0,Nt=ti=>Math.exp(Lt*Re*ti)}return i.duration="duration"in i?+i.duration:1e3*St/("screenSpeed"in i?+i.screenSpeed/Re:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=I!==D,this._pitching=O!==E,this._padding=!m.isPaddingEqual(N),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(ge),this._ease(Lt=>{const ti=Lt*St,Qi=1/Nt(ti);m.zoom=Lt===1?xe:y+m.scaleZoom(Qi),this._rotating&&(m.bearing=a.y.number(I,D,Lt)),this._pitching&&(m.pitch=a.y.number(E,O,Lt)),this._padding&&(m.interpolatePadding(M,N,Lt),se=m.centerPoint.add(Q)),this.terrain&&!i.freezeElevation&&this._updateElevation(Lt);const fi=Lt===1?ge:m.unproject(Ce.add(me.mult(ri(ti))).mult(Qi));m.setLocationAtPoint(m.renderWorldCopies?fi.wrap():fi,se),this._applyUpdatedTransform(m),this._fireMoveEvents(h)},()=>{this.terrain&&i.freezeElevation&&this._finalizeElevation(),this._afterEase(h)},i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,h){var p;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,h)}return i||(p=this.handlers)===null||p===void 0||p.stop(!1),this}_ease(i,h,p){p.animate===!1||p.duration===0?(i(1),h()):(this._easeStart=S.now(),this._easeOptions=p,this._onEaseFrame=i,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(i,h){i=a.b3(i,-180,180);const p=Math.abs(i-h);return Math.abs(i-360-h)<p&&(i-=360),Math.abs(i+360-h)<p&&(i+=360),i}_normalizeCenter(i,h){if(!h.renderWorldCopies||h.lngRange)return;const p=i.lng-h.center.lng;i.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(i){return this.terrain?this.terrain.getElevationForLngLatZoom(a.N.convert(i),this.transform.tileZoom)-this.transform.elevation:null}}const $s={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Vs{constructor(i=$s){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=i}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options.compact,this._container=L.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=L.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=L.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){L.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,h){const p=this._map._getUIString(`AttributionControl.${h}`);i.title=p,i.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const h=this._map.style.sourceCaches;for(const m in h){const y=h[m];if(y.used||y.usedForTerrain){const I=y.getSource();I.attribution&&i.indexOf(I.attribution)<0&&i.push(I.attribution)}}i=i.filter(m=>String(m).trim()),i.sort((m,y)=>m.length-y.length),i=i.filter((m,y)=>{for(let I=y+1;I<i.length;I++)if(i[I].indexOf(m)>=0)return!1;return!0});const p=i.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,i.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class nu{constructor(i={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const p=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=i}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=L.create("div","maplibregl-ctrl");const h=L.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){L.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ti{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const h=++this._id;return this._queue.push({callback:i,id:h,cancelled:!1}),h}remove(i){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const m of p)if(m.id===i)return void(m.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ru=a.Y([{name:"a_pos3d",type:"Int16",components:3}]);class lf extends a.E{constructor(i){super(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,i.usedForTerrain=!0,i.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,h){this.sourceCache.update(i,h),this._renderableTilesKeys=[];const p={};for(const m of i.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),a.aP(m.posMatrix,0,a.X,0,a.X,0,1),this._tiles[m.key]=new qr(m,this.tileSize));for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(i){for(const h in this._tiles){const p=this._tiles[h];(!i||p.tileID.equals(i)||p.tileID.isChildOf(i)||i.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(i=>this.getTileByID(i))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i){const h={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID;if(m.canonical.equals(i.canonical)){const y=i.clone();y.posMatrix=new Float64Array(16),a.aP(y.posMatrix,0,a.X,0,a.X,0,1),h[p]=y}else if(m.canonical.isChildOf(i.canonical)){const y=i.clone();y.posMatrix=new Float64Array(16);const I=m.canonical.z-i.canonical.z,E=m.canonical.x-(m.canonical.x>>I<<I),M=m.canonical.y-(m.canonical.y>>I<<I),D=a.X>>I;a.aP(y.posMatrix,0,D,0,D,0,1),a.J(y.posMatrix,y.posMatrix,[-E*D,-M*D,0]),h[p]=y}else if(i.canonical.isChildOf(m.canonical)){const y=i.clone();y.posMatrix=new Float64Array(16);const I=i.canonical.z-m.canonical.z,E=i.canonical.x-(i.canonical.x>>I<<I),M=i.canonical.y-(i.canonical.y>>I<<I),D=a.X>>I;a.aP(y.posMatrix,0,a.X,0,a.X,0,1),a.J(y.posMatrix,y.posMatrix,[E*D,M*D,0]),a.K(y.posMatrix,y.posMatrix,[1/2**I,1/2**I,0]),h[p]=y}}return h}getSourceTile(i,h){const p=this.sourceCache._source;let m=i.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(m).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!y||!y.dem)&&h)for(;m>=p.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(i.scaledTo(m--).key);return y}tilesAfterTime(i=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=i)}}class ou{constructor(i,h,p){this.painter=i,this.sourceCache=new lf(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,h,p,m=a.X){var y;if(!(h>=0&&h<m&&p>=0&&p<m))return 0;const I=this.getTerrainData(i),E=(y=I.tile)===null||y===void 0?void 0:y.dem;if(!E)return 0;const M=function(de,ge,xe){var ke=ge[0],Ce=ge[1];return de[0]=xe[0]*ke+xe[4]*Ce+xe[12],de[1]=xe[1]*ke+xe[5]*Ce+xe[13],de}([],[h/m*a.X,p/m*a.X],I.u_terrain_matrix),D=[M[0]*E.dim,M[1]*E.dim],O=Math.floor(D[0]),N=Math.floor(D[1]),Q=D[0]-O,se=D[1]-N;return E.get(O,N)*(1-Q)*(1-se)+E.get(O+1,N)*Q*(1-se)+E.get(O,N+1)*(1-Q)*se+E.get(O+1,N+1)*Q*se}getElevationForLngLatZoom(i,h){if(!a.bb(h,i.wrap()))return 0;const{tileID:p,mercatorX:m,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(i,h);return this.getElevation(p,m%a.X,y%a.X,a.X)}getElevation(i,h,p,m=a.X){return this.getDEMElevation(i,h,p,m)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const m=this.painter.context,y=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ce(m,y,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ce(m,new a.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const h=this.sourceCache.getSourceTile(i,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const m=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new ce(m,h.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),h.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+i.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let y=i.canonical.z-h.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=m?y=i.canonical.z-m:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const I=i.canonical.x-(i.canonical.x>>y<<y),E=i.canonical.y-(i.canonical.y>>y<<y),M=a.bc(new Float64Array(16),[1/(a.X<<y),1/(a.X<<y),0]);a.J(M,M,[I*a.X,E*a.X,0]),this._demMatrixCache[i.key]={matrix:M,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(i){const h=this.painter,p=h.width/devicePixelRatio,m=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ce(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ce(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,I=0;y<this._coordsTextureSize;y++)for(let E=0;E<this._coordsTextureSize;E++,I+=4)h[I+0]=255&E,h[I+1]=255&y,h[I+2]=E>>8<<4|y>>8,h[I+3]=0;const p=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),m=new ce(i,p,i.gl.RGBA,{premultiply:!1});return m.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(i){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),p=this.painter.context,m=p.gl,y=Math.round(i.x*this.painter.pixelRatio/devicePixelRatio),I=Math.round(i.y*this.painter.pixelRatio/devicePixelRatio),E=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(y,E-I-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null);const M=h[0]+(h[2]>>4<<8),D=h[1]+((15&h[2])<<8),O=this.coordsIndex[255-h[3]],N=O&&this.sourceCache.getTileByID(O);if(!N)return null;const Q=this._coordsTextureSize,se=(1<<N.tileID.canonical.z)*Q;return new a.Z((N.tileID.canonical.x*Q+M)/se+N.tileID.wrap,(N.tileID.canonical.y*Q+D)/se,this.getElevation(N.tileID,M,D,Q))}depthAtPoint(i){const h=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const i=this.painter.context,h=new a.bd,p=new a.aY,m=this.meshSize,y=a.X/m,I=m*m;for(let N=0;N<=m;N++)for(let Q=0;Q<=m;Q++)h.emplaceBack(Q*y,N*y,0);for(let N=0;N<I;N+=m+1)for(let Q=0;Q<m;Q++)p.emplaceBack(Q+N,m+Q+N+1,m+Q+N+2),p.emplaceBack(Q+N,m+Q+N+2,Q+N+1);const E=h.length,M=E+2*(m+1);for(const N of[0,1])for(let Q=0;Q<=m;Q++)for(const se of[0,1])h.emplaceBack(Q*y,N*a.X,se);for(let N=0;N<2*m;N+=2)p.emplaceBack(M+N,M+N+1,M+N+3),p.emplaceBack(M+N,M+N+3,M+N+2),p.emplaceBack(E+N,E+N+3,E+N+1),p.emplaceBack(E+N,E+N+2,E+N+3);const D=h.length,O=D+2*(m+1);for(const N of[0,1])for(let Q=0;Q<=m;Q++)for(const se of[0,1])h.emplaceBack(N*a.X,Q*y,se);for(let N=0;N<2*m;N+=2)p.emplaceBack(D+N,D+N+1,D+N+3),p.emplaceBack(D+N,D+N+3,D+N+2),p.emplaceBack(O+N,O+N+3,O+N+1),p.emplaceBack(O+N,O+N+2,O+N+3);return this._mesh=new _l(i.createVertexBuffer(h,ru.members),i.createIndexBuffer(p),a.a0.simpleSegment(0,0,h.length,p.length)),this._mesh}getMeshFrameDelta(i){return 2*Math.PI*a.be/Math.pow(2,i)/5}getMinTileElevationForLngLatZoom(i,h){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(i,h);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(i){const h=this.getTerrainData(i).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=h.dem.min*this.exaggeration,p.maxElevation=h.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(i,h){const p=a.Z.fromLngLat(i.wrap()),m=(1<<h)*a.X,y=p.x*m,I=p.y*m,E=Math.floor(y/a.X),M=Math.floor(I/a.X);return{tileID:new a.S(h,0,h,E,M),mercatorX:y,mercatorY:I}}}class cf{constructor(i,h,p){this._context=i,this._size=h,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new ce(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(p.texture),{id:i,fbo:h,texture:p,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>i.id!==h),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(i=>!i.inUse)===!1}}const qs={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Fh{constructor(i,h){this.painter=i,this.terrain=h,this.pool=new cf(i.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter(p=>!i._layers[p].isHidden(h)),this._coordsDescendingInv={};for(const p in i.sourceCaches){this._coordsDescendingInv[p]={};const m=i.sourceCaches[p].getVisibleCoordinates();for(const y of m){const I=this.terrain.sourceCache.getTerrainCoords(y);for(const E in I)this._coordsDescendingInv[p][E]||(this._coordsDescendingInv[p][E]=[]),this._coordsDescendingInv[p][E].push(I[E])}}this._coordsDescendingInvStr={};for(const p of i._order){const m=i._layers[p],y=m.source;if(qs[m.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const I in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][I]=this._coordsDescendingInv[y][I].map(E=>E.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[m][p.tileID.key];y&&y!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(i){if(i.isHidden(this.painter.transform.zoom))return!1;const h=i.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(qs[h]&&(this._prevType&&qs[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(i.id),!m))return!0;if(qs[this._prevType]||qs[h]&&m){this._prevType=h;const y=this._stacks.length-1,I=this._stacks[y]||[];for(const E of this._renderableTiles){if(this.pool.isFull()&&(Eh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(E),E.rtt[y]){const D=this.pool.getObjectForId(E.rtt[y].id);if(D.stamp===E.rtt[y].stamp){this.pool.useObject(D);continue}}const M=this.pool.getOrCreateFreeObject();this.pool.useObject(M),this.pool.stampObject(M),E.rtt[y]={id:M.id,stamp:M.stamp},p.context.bindFramebuffer.set(M.fbo.framebuffer),p.context.clear({color:a.aM.transparent,stencil:0}),p.currentStencilSource=void 0;for(let D=0;D<I.length;D++){const O=p.style._layers[I[D]],N=O.source?this._coordsDescendingInv[O.source][E.tileID.key]:[E.tileID];p.context.viewport.set([0,0,M.fbo.width,M.fbo.height]),p._renderTileClippingMasks(O,N),p.renderLayer(p,p.style.sourceCaches[O.source],O,N),O.source&&(E.rttCoords[O.source]=this._coordsDescendingInvStr[O.source][E.tileID.key])}}return Eh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),qs[h]}return!1}}const su={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Bh=g,uf={hash:!1,interactive:!0,bearingSnap:7,attributionControl:$s,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},au=v=>{v.touchstart=v.dragStart,v.touchmoveWindow=v.dragMove,v.touchend=v.dragEnd},hf={showCompass:!0,showZoom:!0,visualizePitch:!1};class df{constructor(i,h,p=!1){this.mousedown=I=>{this.startMouse(a.e({},I,{ctrlKey:!0,preventDefault:()=>I.preventDefault()}),L.mousePos(this.element,I)),L.addEventListener(window,"mousemove",this.mousemove),L.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=I=>{this.moveMouse(I,L.mousePos(this.element,I))},this.mouseup=I=>{this.mouseRotate.dragEnd(I),this.mousePitch&&this.mousePitch.dragEnd(I),this.offTemp()},this.touchstart=I=>{I.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=L.touchPos(this.element,I.targetTouches)[0],this.startTouch(I,this._startPos),L.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.addEventListener(window,"touchend",this.touchend))},this.touchmove=I=>{I.targetTouches.length!==1?this.reset():(this._lastPos=L.touchPos(this.element,I.targetTouches)[0],this.moveTouch(I,this._lastPos))},this.touchend=I=>{I.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=i.dragRotate._mouseRotate.getClickTolerance(),y=i.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=Hc({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:I,clickTolerance:E,bearingDegreesPerPixelMoved:M=.8})=>{const D=new Wc;return new Po({clickTolerance:E,move:(O,N)=>({bearingDelta:(N.x-O.x)*M}),moveStateManager:D,enable:I,assignEvents:au})})({clickTolerance:m,enable:!0}),this.map=i,p&&(this.mousePitch=Xc({clickTolerance:y,enable:!0}),this.touchPitch=(({enable:I,clickTolerance:E,pitchDegreesPerPixelMoved:M=-.5})=>{const D=new Wc;return new Po({clickTolerance:E,move:(O,N)=>({pitchDelta:(N.y-O.y)*M}),moveStateManager:D,enable:I,assignEvents:au})})({clickTolerance:y,enable:!0})),L.addEventListener(h,"mousedown",this.mousedown),L.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),L.addEventListener(h,"touchcancel",this.reset)}startMouse(i,h){this.mouseRotate.dragStart(i,h),this.mousePitch&&this.mousePitch.dragStart(i,h),L.disableDrag()}startTouch(i,h){this.touchRotate.dragStart(i,h),this.touchPitch&&this.touchPitch.dragStart(i,h),L.disableDrag()}moveMouse(i,h){const p=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(i,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.mousePitch){const{pitchDelta:y}=this.mousePitch.dragMove(i,h)||{};y&&p.setPitch(p.getPitch()+y)}}moveTouch(i,h){const p=this.map,{bearingDelta:m}=this.touchRotate.dragMove(i,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.touchPitch){const{pitchDelta:y}=this.touchPitch.dragMove(i,h)||{};y&&p.setPitch(p.getPitch()+y)}}off(){const i=this.element;L.removeEventListener(i,"mousedown",this.mousedown),L.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend),L.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){L.enableDrag(),L.removeEventListener(window,"mousemove",this.mousemove),L.removeEventListener(window,"mouseup",this.mouseup),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend)}}let Or;function Yi(v,i,h){const p=new a.N(v.lng,v.lat);if(v=new a.N(v.lng,v.lat),i){const m=new a.N(v.lng-360,v.lat),y=new a.N(v.lng+360,v.lat),I=h.locationPoint(v).distSqr(i);h.locationPoint(m).distSqr(i)<I?v=m:h.locationPoint(y).distSqr(i)<I&&(v=y)}for(;Math.abs(v.lng-h.center.lng)>180;){const m=h.locationPoint(v);if(m.x>=0&&m.y>=0&&m.x<=h.width&&m.y<=h.height)break;v.lng>h.center.lng?v.lng-=360:v.lng+=360}return v.lng!==p.lng&&h.locationPoint(v).y>h.height/2-h.getHorizon()?v:p}const Zs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Cl(v,i,h){const p=v.classList;for(const m in Zs)p.remove(`maplibregl-${h}-anchor-${m}`);p.add(`maplibregl-${h}-anchor-${i}`)}class El extends a.E{constructor(i){if(super(),this._onKeyPress=h=>{const p=h.code,m=h.charCode||h.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=h=>{const p=h.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=h=>{var p;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Yi(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(y=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let I="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?I="rotateX(0deg)":this._pitchAlignment==="map"&&(I=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||h&&h.type!=="moveend"||(this._pos=this._pos.round()),L.setTransform(this._element,`${Zs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${I} ${y}`),S.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._subpixelPositioning=i&&i.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(i==null?void 0:i.opacity,i==null?void 0:i.opacityWhenCovered),i&&i.element)this._element=i.element,this._offset=a.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=L.create("div");const h=L.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${p}px`),h.setAttributeNS(null,"width",`${m}px`),h.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const y=L.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const I=L.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");const E=L.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"transform","translate(3.0, 29.0)"),E.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ke of M){const Ce=L.createNS("http://www.w3.org/2000/svg","ellipse");Ce.setAttributeNS(null,"opacity","0.04"),Ce.setAttributeNS(null,"cx","10.5"),Ce.setAttributeNS(null,"cy","5.80029008"),Ce.setAttributeNS(null,"rx",ke.rx),Ce.setAttributeNS(null,"ry",ke.ry),E.appendChild(Ce)}const D=L.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill",this._color);const O=L.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),D.appendChild(O);const N=L.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"opacity","0.25"),N.setAttributeNS(null,"fill","#000000");const Q=L.createNS("http://www.w3.org/2000/svg","path");Q.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),N.appendChild(Q);const se=L.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"transform","translate(6.0, 7.0)"),se.setAttributeNS(null,"fill","#FFFFFF");const de=L.createNS("http://www.w3.org/2000/svg","g");de.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ge=L.createNS("http://www.w3.org/2000/svg","circle");ge.setAttributeNS(null,"fill","#000000"),ge.setAttributeNS(null,"opacity","0.25"),ge.setAttributeNS(null,"cx","5.5"),ge.setAttributeNS(null,"cy","5.5"),ge.setAttributeNS(null,"r","5.4999962");const xe=L.createNS("http://www.w3.org/2000/svg","circle");xe.setAttributeNS(null,"fill","#FFFFFF"),xe.setAttributeNS(null,"cx","5.5"),xe.setAttributeNS(null,"cy","5.5"),xe.setAttributeNS(null,"r","5.4999962"),de.appendChild(ge),de.appendChild(xe),I.appendChild(E),I.appendChild(D),I.appendChild(N),I.appendChild(se),I.appendChild(de),h.appendChild(I),h.setAttributeNS(null,"height",p*this._scale+"px"),h.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(h),this._offset=a.P.convert(i&&i.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),Cl(this._element,this._anchor,"marker"),i&&i.className)for(const h of i.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(i){return this.remove(),this._map=i,this._element.setAttribute("aria-label",i._getUIString("Marker.Title")),i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),L.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=a.N.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const m=Math.abs(13.5)/Math.SQRT2;i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(i){return this._subpixelPositioning=i,this}getPopup(){return this._popup}togglePopup(){const i=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:i?(i.isOpen()?i.remove():(i.setLngLat(this._lngLat),i.addTo(this._map)),this):this}_updateOpacity(i=!1){var h,p;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(i)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,y=m.terrain.depthAtPoint(this._pos),I=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,I)-y<.006)return void(this._element.style.opacity=this._opacity);const E=-this._offset.y/m.transform._pixelPerMeter,M=Math.sin(m.getPitch()*Math.PI/180)*E,D=m.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),O=m.transform.lngLatToCameraDepth(this._lngLat,I+M)-D>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&O&&this._popup.remove(),this._element.style.opacity=O?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(i){return this._offset=a.P.convert(i),this._update(),this}addClassName(i){this._element.classList.add(i)}removeClassName(i){this._element.classList.remove(i)}toggleClassName(i){return this._element.classList.toggle(i)}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(i,h){return i===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),i!==void 0&&(this._opacity=i),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const Oh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ra=0,Fa=!1;const vo={maxWidth:100,unit:"metric"};function Ba(v,i,h){const p=h&&h.maxWidth||100,m=v._container.clientHeight/2,y=v.unproject([0,m]),I=v.unproject([p,m]),E=y.distanceTo(I);if(h&&h.unit==="imperial"){const M=3.2808*E;M>5280?Ot(i,p,M/5280,v._getUIString("ScaleControl.Miles")):Ot(i,p,M,v._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Ot(i,p,E/1852,v._getUIString("ScaleControl.NauticalMiles")):E>=1e3?Ot(i,p,E/1e3,v._getUIString("ScaleControl.Kilometers")):Ot(i,p,E,v._getUIString("ScaleControl.Meters"))}function Ot(v,i,h,p){const m=function(y){const I=Math.pow(10,`${Math.floor(y)}`.length-1);let E=y/I;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(M){const D=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*D)/D}(E),I*E}(h);v.style.width=i*(m/h)+"px",v.innerHTML=`${m}&nbsp;${p}`}const Yt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Ll=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ml(v){if(v){if(typeof v=="number"){const i=Math.round(Math.abs(v)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,v),"top-left":new a.P(i,i),"top-right":new a.P(-i,i),bottom:new a.P(0,-v),"bottom-left":new a.P(i,-i),"bottom-right":new a.P(-i,-i),left:new a.P(v,0),right:new a.P(-v,0)}}if(v instanceof a.P||Array.isArray(v)){const i=a.P.convert(v);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:a.P.convert(v.center||[0,0]),top:a.P.convert(v.top||[0,0]),"top-left":a.P.convert(v["top-left"]||[0,0]),"top-right":a.P.convert(v["top-right"]||[0,0]),bottom:a.P.convert(v.bottom||[0,0]),"bottom-left":a.P.convert(v["bottom-left"]||[0,0]),"bottom-right":a.P.convert(v["bottom-right"]||[0,0]),left:a.P.convert(v.left||[0,0]),right:a.P.convert(v.right||[0,0])}}return Ml(new a.P(0,0))}const lu=g;d.AJAXError=a.bh,d.Evented=a.E,d.LngLat=a.N,d.MercatorCoordinate=a.Z,d.Point=a.P,d.addProtocol=a.bi,d.config=a.a,d.removeProtocol=a.bj,d.AttributionControl=Vs,d.BoxZoomHandler=Br,d.CanvasSource=gi,d.CooperativeGesturesHandler=Us,d.DoubleClickZoomHandler=ss,d.DragPanHandler=zh,d.DragRotateHandler=Dh,d.EdgeInsets=Bs,d.FullscreenControl=class extends a.E{constructor(v={}){super(),this._onFullscreenChange=()=>{var i;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((i=h==null?void 0:h.shadowRoot)===null||i===void 0)&&i.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){L.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const v=this._fullscreenButton=L.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);L.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},d.GeoJSONSource=Xt,d.GeolocateControl=class extends a.E{constructor(v){super(),this._onSuccess=i=>{if(this._map){if(this._isOutOfMapMaxBounds(i))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",i)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=i,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(i),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(i),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",i)),this._finish()}},this._updateCamera=i=>{const h=new a.N(i.coords.longitude,i.coords.latitude),p=i.coords.accuracy,m=this._map.getBearing(),y=a.e({bearing:m},this.options.fitBoundsOptions),I=Te.fromLngLat(h,p);this._map.fitBounds(I,y,{geolocateSource:!0})},this._updateMarker=i=>{if(i){const h=new a.N(i.coords.longitude,i.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=i.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=i=>{if(this._map){if(this.options.trackUserLocation)if(i.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(i.code===3&&Fa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",i)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=L.create("button","maplibregl-ctrl-geolocate",this._container),L.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=i=>{if(this._map){if(i===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new El({element:this._dotElement}),this._circleElement=L.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new El({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")),this.fire(new a.k("userlocationlostfocus")))})}},this.options=a.e({},Oh,v)}onAdd(v){return this._map=v,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function*(i=!1){if(Or!==void 0&&!i)return Or;if(window.navigator.permissions===void 0)return Or=!!window.navigator.geolocation,Or;try{Or=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Or=!!window.navigator.geolocation}return Or})}().then(i=>this._finishSetupUI(i)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),L.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ra=0,Fa=!1}_isOutOfMapMaxBounds(v){const i=this._map.getMaxBounds(),h=v.coords;return i&&(h.longitude<i.getWest()||h.longitude>i.getEast()||h.latitude<i.getSouth()||h.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const v=this._map.getBounds(),i=v.getSouthEast(),h=v.getNorthEast(),p=i.distanceTo(h),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ra--,Fa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart")),this.fire(new a.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ra++,Ra>1?(v={maximumAge:6e5,timeout:0},Fa=!0):(v=this.options.positionOptions,Fa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},d.Hash=yl,d.ImageSource=Ni,d.KeyboardHandler=Hr,d.LngLatBounds=Te,d.LogoControl=nu,d.Map=class extends Rh{constructor(v){a.bf.mark(a.bg.create);const i=Object.assign(Object.assign({},uf),v);if(i.minZoom!=null&&i.maxZoom!=null&&i.minZoom>i.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(i.minPitch!=null&&i.maxPitch!=null&&i.minPitch>i.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(i.minPitch!=null&&i.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(i.maxPitch!=null&&i.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Os(i.minZoom,i.maxZoom,i.minPitch,i.maxPitch,i.renderWorldCopies),{bearingSnap:i.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Ti,this._controls=[],this._mapId=a.a4(),this._contextLost=h=>{h.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:h}))},this._contextRestored=h=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:h}))},this._onMapScroll=h=>{if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=i.interactive,this._maxTileCacheSize=i.maxTileCacheSize,this._maxTileCacheZoomLevels=i.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=i.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=i.preserveDrawingBuffer===!0,this._antialias=i.antialias===!0,this._trackResize=i.trackResize===!0,this._bearingSnap=i.bearingSnap,this._refreshExpiredTiles=i.refreshExpiredTiles===!0,this._fadeDuration=i.fadeDuration,this._crossSourceCollisions=i.crossSourceCollisions===!0,this._collectResourceTiming=i.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},su),i.locale),this._clickTolerance=i.clickTolerance,this._overridePixelRatio=i.pixelRatio,this._maxCanvasSize=i.maxCanvasSize,this.transformCameraUpdate=i.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=i.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=K.addThrottleControl(()=>this.isMoving()),this._requestManager=new le(i.transformRequest),typeof i.container=="string"){if(this._container=document.getElementById(i.container),!this._container)throw new Error(`Container '${i.container}' not found.`)}else{if(!(i.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=i.container}if(i.maxBounds&&this.setMaxBounds(i.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let h=!1;const p=Ma(m=>{this._trackResize&&!this._removed&&(this.resize(m),this.redraw())},50);this._resizeObserver=new ResizeObserver(m=>{h?p(m):h=!0}),this._resizeObserver.observe(this._container)}this.handlers=new iu(this,i),this._hash=i.hash&&new yl(typeof i.hash=="string"&&i.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:i.center,zoom:i.zoom,bearing:i.bearing,pitch:i.pitch}),i.bounds&&(this.resize(),this.fitBounds(i.bounds,a.e({},i.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=i.localIdeographFontFamily,this._validateStyle=i.validateStyle,i.style&&this.setStyle(i.style,{localIdeographFontFamily:i.localIdeographFontFamily}),i.attributionControl&&this.addControl(new Vs(typeof i.attributionControl=="boolean"?void 0:i.attributionControl)),i.maplibreLogo&&this.addControl(new nu,i.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new a.k(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new a.k(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new a.k("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(v,i){if(i===void 0&&(i=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=v.onAdd(this);this._controls.push(v);const p=this._controlPositions[i];return i.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(v);return i>-1&&this._controls.splice(i,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}calculateCameraOptionsFromTo(v,i,h,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(v,i,h,p)}resize(v){var i;const h=this._containerDimensions(),p=h[0],m=h[1],y=this._getClampedPixelRatio(p,m);if(this._resizeCanvas(p,m,y),this.painter.resize(p,m,y),this.painter.overLimit()){const E=this.painter.context.gl;this._maxCanvasSize=[E.drawingBufferWidth,E.drawingBufferHeight];const M=this._getClampedPixelRatio(p,m);this._resizeCanvas(p,m,M),this.painter.resize(p,m,M)}this.transform.resize(p,m),(i=this._requestedCameraState)===null||i===void 0||i.resize(p,m);const I=!this._moving;return I&&(this.stop(),this.fire(new a.k("movestart",v)).fire(new a.k("move",v))),this.fire(new a.k("resize",v)),I&&this.fire(new a.k("moveend",v)),this}_getClampedPixelRatio(v,i){const{0:h,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),y=v*m,I=i*m;return Math.min(y>h?h/y:1,I>p?p/I:1)*m}getPixelRatio(){var v;return(v=this._overridePixelRatio)!==null&&v!==void 0?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(Te.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this._update()}project(v){return this.transform.locationPoint(a.N.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.pointLocation(a.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||((v=this.handlers)===null||v===void 0?void 0:v.isMoving())}isZooming(){var v;return this._zooming||((v=this.handlers)===null||v===void 0?void 0:v.isZooming())}isRotating(){var v;return this._rotating||((v=this.handlers)===null||v===void 0?void 0:v.isRotating())}_createDelegatedListener(v,i,h){if(v==="mouseenter"||v==="mouseover"){let p=!1;return{layers:i,listener:h,delegates:{mousemove:y=>{const I=i.filter(M=>this.getLayer(M)),E=I.length!==0?this.queryRenderedFeatures(y.point,{layers:I}):[];E.length?p||(p=!0,h.call(this,new Qn(v,this,y.originalEvent,{features:E}))):p=!1},mouseout:()=>{p=!1}}}}if(v==="mouseleave"||v==="mouseout"){let p=!1;return{layers:i,listener:h,delegates:{mousemove:I=>{const E=i.filter(M=>this.getLayer(M));(E.length!==0?this.queryRenderedFeatures(I.point,{layers:E}):[]).length?p=!0:p&&(p=!1,h.call(this,new Qn(v,this,I.originalEvent)))},mouseout:I=>{p&&(p=!1,h.call(this,new Qn(v,this,I.originalEvent)))}}}}{const p=m=>{const y=i.filter(E=>this.getLayer(E)),I=y.length!==0?this.queryRenderedFeatures(m.point,{layers:y}):[];I.length&&(m.features=I,h.call(this,m),delete m.features)};return{layers:i,listener:h,delegates:{[v]:p}}}}_saveDelegatedListener(v,i){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(i)}_removeDelegatedListener(v,i,h){if(!this._delegatedListeners||!this._delegatedListeners[v])return;const p=this._delegatedListeners[v];for(let m=0;m<p.length;m++){const y=p[m];if(y.listener===h&&y.layers.length===i.length&&y.layers.every(I=>i.includes(I))){for(const I in y.delegates)this.off(I,y.delegates[I]);return void p.splice(m,1)}}}on(v,i,h){if(h===void 0)return super.on(v,i);const p=this._createDelegatedListener(v,typeof i=="string"?[i]:i,h);this._saveDelegatedListener(v,p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(v,i,h){if(h===void 0)return super.once(v,i);const p=typeof i=="string"?[i]:i,m=this._createDelegatedListener(v,p,h);for(const y in m.delegates){const I=m.delegates[y];m.delegates[y]=(...E)=>{this._removeDelegatedListener(v,p,h),I(...E)}}this._saveDelegatedListener(v,m);for(const y in m.delegates)this.once(y,m.delegates[y]);return this}off(v,i,h){return h===void 0?super.off(v,i):(this._removeDelegatedListener(v,typeof i=="string"?[i]:i,h),this)}queryRenderedFeatures(v,i){if(!this.style)return[];let h;const p=v instanceof a.P||Array.isArray(v),m=p?v:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(p?{}:v)||{},m instanceof a.P||typeof m[0]=="number")h=[a.P.convert(m)];else{const y=a.P.convert(m[0]),I=a.P.convert(m[1]);h=[y,new a.P(I.x,y.y),I,new a.P(y.x,I.y),y]}return this.style.queryRenderedFeatures(h,i,this.transform)}querySourceFeatures(v,i){return this.style.querySourceFeatures(v,i)}setStyle(v,i){return(i=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(v,i))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const i=this._locale[v];if(i==null)throw new Error(`Missing UI string '${v}'`);return i}_updateStyle(v,i){if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(v,i));const h=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new tl(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v,i,h):this.style.loadJSON(v,i,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new tl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,i){if(typeof v=="string"){const h=this._requestManager.transformRequest(v,"Style");a.h(h,new AbortController).then(p=>{this._updateDiff(p.data,i)}).catch(p=>{p&&this.fire(new a.j(p))})}else typeof v=="object"&&this._updateDiff(v,i)}_updateDiff(v,i){try{this.style.setState(v,i)&&this._update(!0)}catch(h){a.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(v,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(v,i){return this._lazyInitEmptyStyle(),this.style.addSource(v,i),this._update(!0)}isSourceLoaded(v){const i=this.style&&this.style.sourceCaches[v];if(i!==void 0)return i.loaded();this.fire(new a.j(new Error(`There is no source with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){const i=this.style.sourceCaches[v.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);this.terrain===null&&i.reload();for(const h in this.style._layers){const p=this.style._layers[h];p.type==="hillshade"&&p.source===v.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ou(this.painter,i,v),this.painter.renderToTexture=new Fh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==v.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:v})),this}getTerrain(){var v,i;return(i=(v=this.terrain)===null||v===void 0?void 0:v.options)!==null&&i!==void 0?i:null}areTilesLoaded(){const v=this.style&&this.style.sourceCaches;for(const i in v){const h=v[i]._tiles;for(const p in h){const m=h[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,i,h={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:y,stretchY:I,content:E,textFitWidth:M,textFitHeight:D}=h;if(this._lazyInitEmptyStyle(),!(i instanceof HTMLImageElement||a.b(i))){if(i.width===void 0||i.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:O,height:N,data:Q}=i,se=i;return this.style.addImage(v,{data:new a.R({width:O,height:N},new Uint8Array(Q)),pixelRatio:p,stretchX:y,stretchY:I,content:E,textFitWidth:M,textFitHeight:D,sdf:m,version:0,userImage:se}),se.onAdd&&se.onAdd(this,v),this}}{const{width:O,height:N,data:Q}=S.getImageData(i);this.style.addImage(v,{data:new a.R({width:O,height:N},Q),pixelRatio:p,stretchX:y,stretchY:I,content:E,textFitWidth:M,textFitHeight:D,sdf:m,version:0})}}updateImage(v,i){const h=this.style.getImage(v);if(!h)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=i instanceof HTMLImageElement||a.b(i)?S.getImageData(i):i,{width:m,height:y,data:I}=p;if(m===void 0||y===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==h.data.width||y!==h.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const E=!(i instanceof HTMLImageElement||a.b(i));return h.data.replace(I,E),this.style.updateImage(v,h),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v){return K.getImage(this._requestManager.transformRequest(v,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(v,i){return this._lazyInitEmptyStyle(),this.style.addLayer(v,i),this._update(!0)}moveLayer(v,i){return this.style.moveLayer(v,i),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,i,h){return this.style.setLayerZoomRange(v,i,h),this._update(!0)}setFilter(v,i,h={}){return this.style.setFilter(v,i,h),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,i,h,p={}){return this.style.setPaintProperty(v,i,h,p),this._update(!0)}getPaintProperty(v,i){return this.style.getPaintProperty(v,i)}setLayoutProperty(v,i,h,p={}){return this.style.setLayoutProperty(v,i,h,p),this._update(!0)}getLayoutProperty(v,i){return this.style.getLayoutProperty(v,i)}setGlyphs(v,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,i,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,i,h,p=>{p||this._update(!0)}),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,i,h=>{h||this._update(!0)}),this}setLight(v,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,i),this._update(!0)}getLight(){return this.style.getLight()}setSky(v){return this._lazyInitEmptyStyle(),this.style.setSky(v),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(v,i){return this.style.setFeatureState(v,i),this._update()}removeFeatureState(v,i){return this.style.removeFeatureState(v,i),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,i=0;return this._container&&(v=this._container.clientWidth||400,i=this._container.clientHeight||300),[v,i]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map");const i=this._canvasContainer=L.create("div","maplibregl-canvas-container",v);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=L.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),p=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],p);const m=this._controlContainer=L.create("div","maplibregl-control-container",v),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(I=>{y[I]=L.create("div",`maplibregl-ctrl-${I} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,i,h){this._canvas.width=Math.floor(h*v),this._canvas.height=Math.floor(h*i),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const v={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let i=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{i={requestedAttributes:v},p&&(i.statusMessage=p.statusMessage,i.type=p.type)},{once:!0});const h=this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v);if(!h){const p="Failed to initialize WebGL";throw i?(i.message=p,new Error(JSON.stringify(i))):new Error(p)}this.painter=new gl(h,this.transform),P.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){const i=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,y=S.now();this.style.zoomHistory.update(m,y);const I=new a.z(m,{now:y,fadeDuration:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),E=I.crossFadingFactor();E===1&&E===this._crossFadingFactor||(h=!0,this._crossFadingFactor=E),this.style.update(I)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,i,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:i,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bf.mark(a.bg.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,a.bf.mark(a.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),K.removeThrottleControl(this._imageQueueHandle),(v=this._resizeObserver)===null||v===void 0||v.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i!=null&&i.loseContext&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),L.remove(this._canvasContainer),L.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bf.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(v=>{a.bf.frame(v),this._frameRequest=null,this._render(v)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return Bh}getCameraTargetElevation(){return this.transform.elevation}},d.MapMouseEvent=Qn,d.MapTouchEvent=rs,d.MapWheelEvent=Mh,d.Marker=El,d.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{const i=this._map.getZoom(),h=i===this._map.getMaxZoom(),p=i===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=i},this._setButtonTitle=(i,h)=>{const p=this._map._getUIString(`NavigationControl.${h}`);i.title=p,i.setAttribute("aria-label",p)},this.options=a.e({},hf,v),this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),L.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),L.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=L.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new df(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){L.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,i){const h=L.create("button",v,this._container);return h.type="button",h.addEventListener("click",i),h}},d.Popup=class extends a.E{constructor(v){super(),this.remove=()=>(this._content&&L.remove(this._content),this._container&&(L.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=i=>{this._update(i.point)},this._onMouseMove=i=>{this._update(i.point)},this._onDrag=i=>{this._update(i.point)},this._update=i=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=L.create("div","maplibregl-popup",this._map.getContainer()),this._tip=L.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const E of this.options.className.split(" "))this._container.classList.add(E);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Yi(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!i)return;const p=this._flatPos=this._pos=this._trackPointer&&i?i:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&i?i:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const y=Ml(this.options.offset);if(!m){const E=this._container.offsetWidth,M=this._container.offsetHeight;let D;D=p.y+y.bottom.y<M?["top"]:p.y>this._map.transform.height-M?["bottom"]:[],p.x<E/2?D.push("left"):p.x>this._map.transform.width-E/2&&D.push("right"),m=D.length===0?"bottom":D.join("-")}let I=p.add(y[m]);this.options.subpixelPositioning||(I=I.round()),L.setTransform(this._container,`${Zs[m]} translate(${I.x}px,${I.y}px)`),Cl(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(Yt),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=a.N.convert(v),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const i=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=v;p=h.firstChild,p;)i.appendChild(p);return this.setDOMContent(i)}getMaxWidth(){var v;return(v=this._container)===null||v===void 0?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=L.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){return this._container&&this._container.classList.add(v),this}removeClassName(v){return this._container&&this._container.classList.remove(v),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}setSubpixelPositioning(v){this.options.subpixelPositioning=v}_createCloseButton(){this.options.closeButton&&(this._closeButton=L.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(Ll);v&&v.focus()}},d.RasterDEMTileSource=nt,d.RasterTileSource=Ie,d.ScaleControl=class{constructor(v){this._onMove=()=>{Ba(this._map,this._container,this.options)},this.setUnit=i=>{this.options.unit=i,Ba(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},vo),v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){L.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},d.ScrollZoomHandler=oo,d.Style=tl,d.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=v}onAdd(v){return this._map=v,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=L.create("button","maplibregl-ctrl-terrain",this._container),L.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){L.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},d.TwoFingersTouchPitchHandler=js,d.TwoFingersTouchRotateHandler=Qc,d.TwoFingersTouchZoomHandler=Jc,d.TwoFingersTouchZoomRotateHandler=tu,d.VectorTileSource=yt,d.VideoSource=Li,d.addSourceType=(v,i)=>a._(void 0,void 0,void 0,function*(){if(_r(v))throw new Error(`A source type called "${v}" already exists.`);((h,p)=>{Fi[h]=p})(v,i)}),d.clearPrewarmedResources=function(){const v=ai;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(Bt),ai=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},d.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},d.getRTLTextPluginStatus=function(){return On().getRTLTextPluginStatus()},d.getVersion=function(){return lu},d.getWorkerCount=function(){return Dt.workerCount},d.getWorkerUrl=function(){return a.a.WORKER_URL},d.importScriptInWorkers=function(v){return vi().broadcast("IS",v)},d.prewarm=function(){Si().acquire(Bt)},d.setMaxParallelImageRequests=function(v){a.a.MAX_PARALLEL_IMAGE_REQUESTS=v},d.setRTLTextPlugin=function(v,i){return On().setRTLTextPlugin(v,i)},d.setWorkerCount=function(v){Dt.workerCount=v},d.setWorkerUrl=function(v){a.a.WORKER_URL=v}});var u=t;return u})})(i1);var Op=i1.exports;const Lr=nw(Op),rw=$v({__proto__:null,default:Lr},[Op]);var ow=Object.defineProperty,r1=o=>{throw TypeError(o)},sw=(o,e,t)=>e in o?ow(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,po=(o,e,t)=>sw(o,typeof e!="symbol"?e+"":e,t),o1=(o,e,t)=>e.has(o)||r1("Cannot "+t),Xn=(o,e,t)=>(o1(o,e,"read from private field"),t?t.call(o):e.get(o)),j_=(o,e,t)=>e.has(o)?r1("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(o):e.set(o,t),U_=(o,e,t,n)=>(o1(o,e,"write to private field"),n?n.call(o,t):e.set(o,t),t);function gn(){}function aw(o,e){for(const t in e)o[t]=e[t];return o}function s1(o){return o()}function $_(){return Object.create(null)}function ks(o){o.forEach(s1)}function a1(o){return typeof o=="function"}function ma(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}let cd;function Pr(o,e){return o===e?!0:(cd||(cd=document.createElement("a")),cd.href=e,o===cd.href)}function lw(o){return Object.keys(o).length===0}function cw(o,e,t,n){if(o){const l=l1(o,e,t,n);return o[0](l)}}function l1(o,e,t,n){return o[1]&&n?aw(t.ctx.slice(),o[1](n(e))):t.ctx}function uw(o,e,t,n){if(o[2]&&n){const l=o[2](n(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],d=Math.max(e.dirty.length,l.length);for(let a=0;a<d;a+=1)u[a]=e.dirty[a]|l[a];return u}return e.dirty|l}return e.dirty}function hw(o,e,t,n,l,u){if(l){const d=l1(e,t,n,u);o.p(d,l)}}function dw(o){if(o.ctx.length>32){const e=[],t=o.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function V_(o){return o??""}function Oi(o,e){o.appendChild(e)}function Tn(o,e,t){o.insertBefore(e,t||null)}function yn(o){o.parentNode&&o.parentNode.removeChild(o)}function rn(o){return document.createElement(o)}function jo(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function ua(o){return document.createTextNode(o)}function _o(){return ua(" ")}function fw(){return ua("")}function Vr(o,e,t,n){return o.addEventListener(e,t,n),()=>o.removeEventListener(e,t,n)}function pw(o){return function(e){return e.preventDefault(),o.call(this,e)}}function ht(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function mw(o){return Array.from(o.childNodes)}function Hu(o,e){e=""+e,o.data!==e&&(o.data=e)}function q_(o,e){o.value=e??""}function Eo(o,e,t){o.classList.toggle(e,!!t)}function _w(o,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:n})}let Xu;function $u(o){Xu=o}function c1(){if(!Xu)throw new Error("Function called outside component initialization");return Xu}function gw(o){c1().$$.on_destroy.push(o)}function yw(){const o=c1();return(e,t,{cancelable:n=!1}={})=>{const l=o.$$.callbacks[e];if(l){const u=_w(e,t,{cancelable:n});return l.slice().forEach(d=>{d.call(o,u)}),!u.defaultPrevented}return!0}}function Z_(o,e){const t=o.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const tc=[],mp=[];let sc=[];const G_=[],bw=Promise.resolve();let _p=!1;function vw(){_p||(_p=!0,bw.then(u1))}function gp(o){sc.push(o)}const rp=new Set;let Xl=0;function u1(){if(Xl!==0)return;const o=Xu;do{try{for(;Xl<tc.length;){const e=tc[Xl];Xl++,$u(e),ww(e.$$)}}catch(e){throw tc.length=0,Xl=0,e}for($u(null),tc.length=0,Xl=0;mp.length;)mp.pop()();for(let e=0;e<sc.length;e+=1){const t=sc[e];rp.has(t)||(rp.add(t),t())}sc.length=0}while(tc.length);for(;G_.length;)G_.pop()();_p=!1,rp.clear(),$u(o)}function ww(o){if(o.fragment!==null){o.update(),ks(o.before_update);const e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(gp)}}function xw(o){const e=[],t=[];sc.forEach(n=>o.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),sc=e}const _d=new Set;let Xa;function gd(){Xa={r:0,c:[],p:Xa}}function yd(){Xa.r||ks(Xa.c),Xa=Xa.p}function Fn(o,e){o&&o.i&&(_d.delete(o),o.i(e))}function ar(o,e,t,n){if(o&&o.o){if(_d.has(o))return;_d.add(o),Xa.c.push(()=>{_d.delete(o),n&&(t&&o.d(1),n())}),o.o(e)}else n&&n()}function W_(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function kw(o,e){ar(o,1,1,()=>{e.delete(o.key)})}function Sw(o,e,t,n,l,u,d,a,g,b,k,S){let L=o.length,P=u.length,R=L;const Z={};for(;R--;)Z[o[R].key]=R;const $=[],H=new Map,G=new Map,K=[];for(R=P;R--;){const te=S(l,u,R),Y=t(te);let ue=d.get(Y);ue?K.push(()=>ue.p(te,e)):(ue=b(Y,te),ue.c()),H.set(Y,$[R]=ue),Y in Z&&G.set(Y,Math.abs(R-Z[Y]))}const le=new Set,Se=new Set;function Le(te){Fn(te,1),te.m(a,k),d.set(te.key,te),k=te.first,P--}for(;L&&P;){const te=$[P-1],Y=o[L-1],ue=te.key,fe=Y.key;te===Y?(k=te.first,L--,P--):H.has(fe)?!d.has(ue)||le.has(ue)?Le(te):Se.has(fe)?L--:G.get(ue)>G.get(fe)?(Se.add(ue),Le(te)):(le.add(fe),L--):(g(Y,d),L--)}for(;L--;){const te=o[L];H.has(te.key)||g(te,d)}for(;P;)Le($[P-1]);return ks(K),$}function ha(o){o&&o.c()}function ws(o,e,t){const{fragment:n,after_update:l}=o.$$;n&&n.m(e,t),gp(()=>{const u=o.$$.on_mount.map(s1).filter(a1);o.$$.on_destroy?o.$$.on_destroy.push(...u):ks(u),o.$$.on_mount=[]}),l.forEach(gp)}function xs(o,e){const t=o.$$;t.fragment!==null&&(xw(t.after_update),ks(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Tw(o,e){o.$$.dirty[0]===-1&&(tc.push(o),vw(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function _a(o,e,t,n,l,u,d=null,a=[-1]){const g=Xu;$u(o);const b=o.$$={fragment:null,ctx:[],props:u,update:gn,not_equal:l,bound:$_(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(g?g.$$.context:[])),callbacks:$_(),dirty:a,skip_bound:!1,root:e.target||g.$$.root};d&&d(b.root);let k=!1;if(b.ctx=t?t(o,e.props||{},(S,L,...P)=>{const R=P.length?P[0]:L;return b.ctx&&l(b.ctx[S],b.ctx[S]=R)&&(!b.skip_bound&&b.bound[S]&&b.bound[S](R),k&&Tw(o,S)),L}):[],b.update(),k=!0,ks(b.before_update),b.fragment=n?n(b.ctx):!1,e.target){if(e.hydrate){const S=mw(e.target);b.fragment&&b.fragment.l(S),S.forEach(yn)}else b.fragment&&b.fragment.c();e.intro&&Fn(o.$$.fragment),ws(o,e.target,e.anchor),u1()}$u(g)}class ga{constructor(){po(this,"$$"),po(this,"$$set")}$destroy(){xs(this,1),this.$destroy=gn}$on(e,t){if(!a1(t))return gn;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const l=n.indexOf(t);l!==-1&&n.splice(l,1)}}$set(e){this.$$set&&!lw(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Iw="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Iw);function Cw(o){let e,t;return{c(){e=jo("svg"),t=jo("path"),ht(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),ht(e,"viewBox","0 0 14 14"),ht(e,"width","13"),ht(e,"height","13"),ht(e,"class","svelte-en2qvf")},m(n,l){Tn(n,e,l),Oi(e,t)},p:gn,i:gn,o:gn,d(n){n&&yn(e)}}}class h1 extends ga{constructor(e){super(),_a(this,e,null,Cw,ma,{})}}function Ew(o){let e,t;return{c(){e=jo("svg"),t=jo("path"),ht(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),ht(e,"viewBox","0 0 30 30"),ht(e,"fill","none"),ht(e,"xmlns","http://www.w3.org/2000/svg"),ht(e,"class","svelte-d2loi5")},m(n,l){Tn(n,e,l),Oi(e,t)},p:gn,i:gn,o:gn,d(n){n&&yn(e)}}}class d1 extends ga{constructor(e){super(),_a(this,e,null,Ew,ma,{})}}function Lw(o){let e,t;return{c(){e=rn("img"),Pr(e.src,t=o[3]+"area.svg")||ht(e,"src",t),ht(e,"alt",o[6]),ht(e,"class","svelte-ltkwvy")},m(n,l){Tn(n,e,l)},p(n,l){l&8&&!Pr(e.src,t=n[3]+"area.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",n[6])},d(n){n&&yn(e)}}}function Mw(o){let e,t;return{c(){e=rn("img"),Pr(e.src,t=o[3]+"reverse.svg")||ht(e,"src",t),ht(e,"alt",o[6]),ht(e,"class","svelte-ltkwvy")},m(n,l){Tn(n,e,l)},p(n,l){l&8&&!Pr(e.src,t=n[3]+"reverse.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",n[6])},d(n){n&&yn(e)}}}function Aw(o){let e,t;return{c(){e=rn("img"),Pr(e.src,t=o[3]+"poi.svg")||ht(e,"src",t),ht(e,"alt",o[6]),ht(e,"class","svelte-ltkwvy")},m(n,l){Tn(n,e,l)},p(n,l){l&8&&!Pr(e.src,t=n[3]+"poi.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",n[6])},d(n){n&&yn(e)}}}function Pw(o){let e,t;return{c(){e=rn("img"),Pr(e.src,t=o[3]+"postal_code.svg")||ht(e,"src",t),ht(e,"alt",o[6]),ht(e,"class","svelte-ltkwvy")},m(n,l){Tn(n,e,l)},p(n,l){l&8&&!Pr(e.src,t=n[3]+"postal_code.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",n[6])},d(n){n&&yn(e)}}}function zw(o){let e,t;return{c(){e=rn("img"),Pr(e.src,t=o[3]+"street.svg")||ht(e,"src",t),ht(e,"alt",o[6]),ht(e,"class","svelte-ltkwvy")},m(n,l){Tn(n,e,l)},p(n,l){l&8&&!Pr(e.src,t=n[3]+"street.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",n[6])},d(n){n&&yn(e)}}}function Dw(o){let e,t;return{c(){e=rn("img"),Pr(e.src,t=o[3]+"road.svg")||ht(e,"src",t),ht(e,"alt",o[6]),ht(e,"class","svelte-ltkwvy")},m(n,l){Tn(n,e,l)},p(n,l){l&8&&!Pr(e.src,t=n[3]+"road.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",n[6])},d(n){n&&yn(e)}}}function Rw(o){let e,t;return{c(){e=rn("img"),Pr(e.src,t=o[3]+"housenumber.svg")||ht(e,"src",t),ht(e,"alt",o[6]),ht(e,"class","svelte-ltkwvy")},m(n,l){Tn(n,e,l)},p(n,l){l&8&&!Pr(e.src,t=n[3]+"housenumber.svg")&&ht(e,"src",t),l&64&&ht(e,"alt",n[6])},d(n){n&&yn(e)}}}function Fw(o){let e,t,n,l;return{c(){e=rn("img"),Pr(e.src,t=o[5])||ht(e,"src",t),ht(e,"alt",o[4]),ht(e,"class","svelte-ltkwvy")},m(u,d){Tn(u,e,d),n||(l=Vr(e,"error",o[14]),n=!0)},p(u,d){d&32&&!Pr(e.src,t=u[5])&&ht(e,"src",t),d&16&&ht(e,"alt",u[4])},d(u){u&&yn(e),n=!1,l()}}}function H_(o){let e,t;return{c(){e=rn("span"),t=ua(o[6]),ht(e,"class","secondary svelte-ltkwvy")},m(n,l){Tn(n,e,l),Oi(e,t)},p(n,l){l&64&&Hu(t,n[6])},d(n){n&&yn(e)}}}function Bw(o){let e,t,n,l,u,d,a,g,b,k=(o[7]?o[0].place_name:o[0].place_name.replace(/,.*/,""))+"",S,L,P=o[2]==="always"||o[2]!=="never"&&!o[0].address&&!o[0].id.startsWith("road.")&&!o[0].id.startsWith("address.")&&!o[0].id.startsWith("postal_code.")&&(!o[0].id.startsWith("poi.")||!o[5])&&!o[7],R,Z,$=(o[7]?"":o[0].place_name.replace(/[^,]*,?\s*/,""))+"",H,G,K;function le(Y,ue){return ue&1&&(t=null),ue&1&&(n=null),ue&1&&(l=null),ue&1&&(u=null),Y[5]?Fw:Y[0].address?Rw:(t==null&&(t=!!Y[0].id.startsWith("road.")),t?Dw:(n==null&&(n=!!Y[0].id.startsWith("address.")),n?zw:(l==null&&(l=!!Y[0].id.startsWith("postal_code.")),l?Pw:(u==null&&(u=!!Y[0].id.startsWith("poi.")),u?Aw:Y[7]?Mw:Lw))))}let Se=le(o,-1),Le=Se(o),te=P&&H_(o);return{c(){e=rn("li"),Le.c(),d=_o(),a=rn("span"),g=rn("span"),b=rn("span"),S=ua(k),L=_o(),te&&te.c(),R=_o(),Z=rn("span"),H=ua($),ht(b,"class","primary svelte-ltkwvy"),ht(g,"class","svelte-ltkwvy"),ht(Z,"class","line2 svelte-ltkwvy"),ht(a,"class","texts svelte-ltkwvy"),ht(e,"tabindex","0"),ht(e,"data-selected",o[1]),ht(e,"class","svelte-ltkwvy"),Eo(e,"selected",o[1])},m(Y,ue){Tn(Y,e,ue),Le.m(e,null),Oi(e,d),Oi(e,a),Oi(a,g),Oi(g,b),Oi(b,S),Oi(g,L),te&&te.m(g,null),Oi(a,R),Oi(a,Z),Oi(Z,H),G||(K=[Vr(e,"mouseenter",o[12]),Vr(e,"focus",o[13])],G=!0)},p(Y,[ue]){Se===(Se=le(Y,ue))&&Le?Le.p(Y,ue):(Le.d(1),Le=Se(Y),Le&&(Le.c(),Le.m(e,d))),ue&1&&k!==(k=(Y[7]?Y[0].place_name:Y[0].place_name.replace(/,.*/,""))+"")&&Hu(S,k),ue&37&&(P=Y[2]==="always"||Y[2]!=="never"&&!Y[0].address&&!Y[0].id.startsWith("road.")&&!Y[0].id.startsWith("address.")&&!Y[0].id.startsWith("postal_code.")&&(!Y[0].id.startsWith("poi.")||!Y[5])&&!Y[7]),P?te?te.p(Y,ue):(te=H_(Y),te.c(),te.m(g,null)):te&&(te.d(1),te=null),ue&1&&$!==($=(Y[7]?"":Y[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Hu(H,$),ue&2&&ht(e,"data-selected",Y[1]),ue&2&&Eo(e,"selected",Y[1])},i:gn,o:gn,d(Y){Y&&yn(e),Le.d(),te&&te.d(),G=!1,ks(K)}}}function Ow(o,e,t){var n;let l,u,{feature:d}=e,{selected:a=!1}=e,{showPlaceType:g}=e,{missingIconsCache:b}=e,{iconsBaseUrl:k}=e;const S=(n=d.properties)==null?void 0:n.categories;let L,P,R=0,Z=d.place_type[0]==="reverse";function $(){P&&b.add(P),t(10,R++,R)}function H(le){Z_.call(this,o,le)}function G(le){Z_.call(this,o,le)}const K=()=>$();return o.$$set=le=>{"feature"in le&&t(0,d=le.feature),"selected"in le&&t(1,a=le.selected),"showPlaceType"in le&&t(2,g=le.showPlaceType),"missingIconsCache"in le&&t(9,b=le.missingIconsCache),"iconsBaseUrl"in le&&t(3,k=le.iconsBaseUrl)},o.$$.update=()=>{var le,Se,Le,te;if(o.$$.dirty&3640)do t(11,l--,l),t(4,L=S==null?void 0:S[l]),t(5,P=L?k+L.replace(/ /g,"_")+".svg":void 0);while(l>-1&&(!P||b.has(P)));o.$$.dirty&1&&t(6,u=((Se=(le=d.properties)==null?void 0:le.categories)==null?void 0:Se.join(", "))??((te=(Le=d.properties)==null?void 0:Le.place_type_name)==null?void 0:te[0])??d.place_type[0])},t(11,l=(S==null?void 0:S.length)??0),[d,a,g,k,L,P,u,Z,$,b,R,l,H,G,K]}class Nw extends ga{constructor(e){super(),_a(this,e,Ow,Bw,ma,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function jw(o){let e;return{c(){e=rn("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',ht(e,"class","svelte-7cmwmc")},m(t,n){Tn(t,e,n)},p:gn,i:gn,o:gn,d(t){t&&yn(e)}}}class Uw extends ga{constructor(e){super(),_a(this,e,null,jw,ma,{})}}function $w(o){let e,t,n;return{c(){e=jo("svg"),t=jo("path"),ht(t,"stroke-width","4"),ht(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),ht(t,"class","svelte-gzo3ar"),ht(e,"width",n=o[0]==="list"?20:void 0),ht(e,"viewBox","0 0 70 85"),ht(e,"fill","none"),ht(e,"class","svelte-gzo3ar"),Eo(e,"in-map",o[0]!=="list"),Eo(e,"list-icon",o[0]==="list")},m(l,u){Tn(l,e,u),Oi(e,t)},p(l,[u]){u&1&&n!==(n=l[0]==="list"?20:void 0)&&ht(e,"width",n),u&1&&Eo(e,"in-map",l[0]!=="list"),u&1&&Eo(e,"list-icon",l[0]==="list")},i:gn,o:gn,d(l){l&&yn(e)}}}function Vw(o,e,t){let{displayIn:n}=e;return o.$$set=l=>{"displayIn"in l&&t(0,n=l.displayIn)},[n]}class qw extends ga{constructor(e){super(),_a(this,e,Vw,$w,ma,{displayIn:0})}}function Zw(o){let e,t;return{c(){e=jo("svg"),t=jo("path"),ht(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),ht(e,"viewBox","0 0 60.006 21.412"),ht(e,"width","14"),ht(e,"height","20"),ht(e,"class","svelte-en2qvf")},m(n,l){Tn(n,e,l),Oi(e,t)},p:gn,i:gn,o:gn,d(n){n&&yn(e)}}}class Gw extends ga{constructor(e){super(),_a(this,e,null,Zw,ma,{})}}function Ww(o){let e,t,n;return{c(){e=jo("svg"),t=jo("circle"),n=jo("path"),ht(t,"cx","4.789"),ht(t,"cy","4.787"),ht(t,"r","3.85"),ht(t,"class","svelte-1aq105l"),ht(n,"d","M12.063 12.063 7.635 7.635"),ht(n,"class","svelte-1aq105l"),ht(e,"xmlns","http://www.w3.org/2000/svg"),ht(e,"width","13"),ht(e,"height","13"),ht(e,"viewBox","0 0 13 13"),ht(e,"class","svelte-1aq105l")},m(l,u){Tn(l,e,u),Oi(e,t),Oi(e,n)},p:gn,i:gn,o:gn,d(l){l&&yn(e)}}}class Hw extends ga{constructor(e){super(),_a(this,e,null,Ww,ma,{})}}function Xw(o,e,t){const n=e[1],l=e[0],u=n-l;return o===n&&t?o:((o-l)%u+u)%u+l}function Sd(o){const e=[...o];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Lu;async function Kw(o,e,t){const n=o==null?void 0:o.getCenterAndZoom();for(const l of e??[])if(!(n&&(l.minZoom!=null&&l.minZoom>n[0]||l.maxZoom!=null&&l.maxZoom<n[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(Lu&&l.cachedLocationExpiry&&Lu.time+l.cachedLocationExpiry>Date.now()){if(!Lu.coords)break e;return Lu.coords}let u;try{return u=await new Promise((d,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(g=>{d([g.coords.longitude,g.coords.latitude].map(b=>b.toFixed(6)).join(","))},g=>{a(g)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(Lu={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(n&&l.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const Jw=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,X_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,K_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,J_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,Y_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,Q_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function Yw(o){if(!["DMS","DM","DD"].includes(o))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(P=>Number(P.trim())),t=Number(e[0]),n=Number(e[1]),l=Math.abs(t),u=Math.abs(n),d=t>0?"N":"S",a=n>0?"E":"W";let g;o=="DD"&&(g=`${l}° ${d}, ${u}° ${a}`);const b=Math.floor(l),k=Math.floor(u),S=(l-b)*60,L=(u-k)*60;if(o=="DM"){let P=eg(S,3).toFixed(3).padStart(6,"0"),R=eg(L,3).toFixed(3).padStart(6,"0");P.endsWith(".000")&&R.endsWith(".000")&&(P=P.replace(/\.000$/,""),R=R.replace(/\.000$/,"")),g=`${b}° ${P}' ${d}, ${k}° ${R}' ${a}`}if(o=="DMS"){const P=Math.floor(S),R=Math.floor(L);let Z=((S-P)*60).toFixed(1).padStart(4,"0"),$=((L-R)*60).toFixed(1).padStart(4,"0");const H=P.toString().padStart(2,"0"),G=R.toString().padStart(2,"0");Z.endsWith(".0")&&$.endsWith(".0")&&(Z=Z.replace(/\.0$/,""),$=$.replace(/\.0$/,"")),g=`${b}° ${H}' ${Z}" ${d}, ${k}° ${G}' ${$}" ${a}`}return g}else throw new Error("no decimal coordinates to convert")}function eg(o,e){const t=Math.pow(10,e);return Math.round((o+Number.EPSILON)*t)/t}function Np(o,e){e||(e=5),o=o.replace(/\s+/g," ").trim();let t=null,n=null,l="",u="",d=null,a=[],g=!1;if(Jw.test(o))throw new Error("invalid coordinate value");if(X_.test(o))if(a=X_.exec(o),g=Mu(a),g)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),d="DM";else throw new Error("invalid coordinate format");else if(K_.test(o))if(a=K_.exec(o),g=Mu(a),g){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),d="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(l=a[1],u=a[5]):a[4]&&(l=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if(J_.test(o))if(a=J_.exec(o),g=Mu(a),g)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(l=a[1],u=a[8]):a[7]&&(l=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(Y_.test(o))if(a=Y_.exec(o),g=Mu(a),g)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6]/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(Q_.test(o)){if(a=Q_.exec(o),g=Mu(a),a.filter(b=>b).length<=5)throw new Error("invalid coordinates format");if(g)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(g){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let b=/S|SOUTH/i;b.test(l)&&t>0&&(t=-1*t),b=/W|WEST/i,b.test(u)&&n>0&&(n=-1*n);const k=a[0].trim();let S,L;const P=/[,/;\u0020]/g,R=k.match(P);if(R==null){const H=Math.floor(o.length/2);S=k.substring(0,H).trim(),L=k.substring(H).trim()}else{let H;R.length%2==1?H=Math.floor(R.length/2):H=R.length/2-1;let G=0;if(H==0)G=k.indexOf(R[0]),S=k.substring(0,G).trim(),L=k.substring(G+1).trim();else{let K=0,le=0;for(;K<=H;)G=k.indexOf(R[K],le),le=G+1,K++;S=k.substring(0,G).trim(),L=k.substring(G+1).trim()}}const Z=S.split(".");if(Z.length==2&&Z[1]==0&&Z[1].length!=2)throw new Error("invalid coordinates format");const $=L.split(".");if($.length==2&&$[1]==0&&$[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(L))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:k,verbatimLatitude:S,verbatimLongitude:L,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:d,closeEnough:Qw,toCoordinateFormat:Yw})}else throw new Error("coordinates pattern match failed")}function Mu(o){if(!isNaN(o[0]))return!1;const e=[...o];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const d=e[u],a=e[u+l],g=t.test(d)&&t.test(a),b=n.test(d)&&n.test(a),k=d==a;if(!(d==null&&a==null)){if(d==null||a==null)return!1;if(g||b||k)continue;return!1}}return!0}function tg(o,e){const t=Math.abs(o-e);return Number(t.toFixed(6))<=1e-5}function Qw(o){if(!o)throw new Error("coords must be provided");if(o.includes(",")){const e=o.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return tg(this.decimalLatitude,Number(e[0]))&&tg(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const ex=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Np.to=ex;const tx=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],ix={decimalLatitude:40.123,decimalLongitude:-74.123},nx=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],rx=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function ox(){const o=[];return tx.forEach(e=>{e.decimalLatitude?o.push(e):o.push({...e,...ix})}),[...o,...nx,...rx]}const sx=ox();Np.formats=sx.map(o=>o.verbatimCoordinates);const ax=Np;function ig(o,e,t){const n=o.slice();return n[84]=e[t],n[86]=t,n}function ng(o){let e,t;return e=new Uw({}),{c(){ha(e.$$.fragment)},m(n,l){ws(e,n,l),t=!0},i(n){t||(Fn(e.$$.fragment,n),t=!0)},o(n){ar(e.$$.fragment,n),t=!1},d(n){xs(e,n)}}}function rg(o){let e,t,n,l,u;return t=new Gw({}),{c(){e=rn("button"),ha(t.$$.fragment),ht(e,"type","button"),ht(e,"title",o[9]),ht(e,"class","svelte-bz0zu3"),Eo(e,"active",o[0])},m(d,a){Tn(d,e,a),ws(t,e,null),n=!0,l||(u=Vr(e,"click",o[69]),l=!0)},p(d,a){(!n||a[0]&512)&&ht(e,"title",d[9]),(!n||a[0]&1)&&Eo(e,"active",d[0])},i(d){n||(Fn(t.$$.fragment,d),n=!0)},o(d){ar(t.$$.fragment,d),n=!1},d(d){d&&yn(e),xs(t),l=!1,u()}}}function lx(o){let e,t=[],n=new Map,l,u,d,a=W_(o[14]);const g=b=>b[84].id+(b[84].address?","+b[84].address:"");for(let b=0;b<a.length;b+=1){let k=ig(o,a,b),S=g(k);n.set(S,t[b]=og(S,k))}return{c(){e=rn("ul");for(let b=0;b<t.length;b+=1)t[b].c();ht(e,"class","options svelte-bz0zu3")},m(b,k){Tn(b,e,k);for(let S=0;S<t.length;S+=1)t[S]&&t[S].m(e,null);l=!0,u||(d=[Vr(e,"mouseleave",o[73]),Vr(e,"blur",o[74])],u=!0)},p(b,k){k[0]&17880064&&(a=W_(b[14]),gd(),t=Sw(t,k,g,1,b,a,n,e,kw,og,null,ig),yd())},i(b){if(!l){for(let k=0;k<a.length;k+=1)Fn(t[k]);l=!0}},o(b){for(let k=0;k<t.length;k+=1)ar(t[k]);l=!1},d(b){b&&yn(e);for(let k=0;k<t.length;k+=1)t[k].d();u=!1,ks(d)}}}function cx(o){let e,t,n,l,u,d;return t=new d1({}),{c(){e=rn("div"),ha(t.$$.fragment),n=_o(),l=rn("div"),u=ua(o[7]),ht(l,"class","svelte-bz0zu3"),ht(e,"class","no-results svelte-bz0zu3")},m(a,g){Tn(a,e,g),ws(t,e,null),Oi(e,n),Oi(e,l),Oi(l,u),d=!0},p(a,g){(!d||g[0]&128)&&Hu(u,a[7])},i(a){d||(Fn(t.$$.fragment,a),d=!0)},o(a){ar(t.$$.fragment,a),d=!1},d(a){a&&yn(e),xs(t)}}}function ux(o){let e="",t;return{c(){t=ua(e)},m(n,l){Tn(n,t,l)},p:gn,i:gn,o:gn,d(n){n&&yn(t)}}}function hx(o){let e,t,n,l,u,d,a,g,b,k,S;return t=new d1({}),g=new h1({}),{c(){e=rn("div"),ha(t.$$.fragment),n=_o(),l=rn("div"),u=ua(o[6]),d=_o(),a=rn("button"),ha(g.$$.fragment),ht(l,"class","svelte-bz0zu3"),ht(a,"class","svelte-bz0zu3"),ht(e,"class","error svelte-bz0zu3")},m(L,P){Tn(L,e,P),ws(t,e,null),Oi(e,n),Oi(e,l),Oi(l,u),Oi(e,d),Oi(e,a),ws(g,a,null),b=!0,k||(S=Vr(a,"click",o[70]),k=!0)},p(L,P){(!b||P[0]&64)&&Hu(u,L[6])},i(L){b||(Fn(t.$$.fragment,L),Fn(g.$$.fragment,L),b=!0)},o(L){ar(t.$$.fragment,L),ar(g.$$.fragment,L),b=!1},d(L){L&&yn(e),xs(t),xs(g),k=!1,S()}}}function og(o,e){let t,n,l;function u(){return e[71](e[86])}function d(){return e[72](e[84])}return n=new Nw({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",u),n.$on("focus",d),{key:o,first:null,c(){t=fw(),ha(n.$$.fragment),this.first=t},m(a,g){Tn(a,t,g),ws(n,a,g),l=!0},p(a,g){e=a;const b={};g[0]&16384&&(b.feature=e[84]),g[0]&1024&&(b.showPlaceType=e[10]),g[0]&49152&&(b.selected=e[15]===e[86]),g[0]&4096&&(b.iconsBaseUrl=e[12]),n.$set(b)},i(a){l||(Fn(n.$$.fragment,a),l=!0)},o(a){ar(n.$$.fragment,a),l=!1},d(a){a&&yn(t),xs(n,a)}}}function dx(o){let e,t,n,l,u,d,a,g,b,k,S,L,P,R,Z,$,H,G,K,le,Se,Le=!1;u=new Hw({}),S=new h1({});let te=o[19]&&ng(),Y=o[5]==="button"&&rg(o);const ue=o[61].default,fe=cw(ue,o,o[60],null),ce=[hx,ux,cx,lx],ae=[];function We(Ee,ze){var rt,it;return Ee[18]?0:Ee[16]?((rt=Ee[14])==null?void 0:rt.length)===0?2:Ee[16]&&(it=Ee[14])!=null&&it.length?3:-1:1}return~($=We(o))&&(H=ae[$]=ce[$](o)),{c(){e=_o(),t=rn("form"),n=rn("div"),l=rn("button"),ha(u.$$.fragment),d=_o(),a=rn("input"),g=_o(),b=rn("div"),k=rn("button"),ha(S.$$.fragment),L=_o(),te&&te.c(),P=_o(),Y&&Y.c(),R=_o(),fe&&fe.c(),Z=_o(),H&&H.c(),ht(l,"class","search-button svelte-bz0zu3"),ht(l,"type","button"),ht(a,"placeholder",o[8]),ht(a,"aria-label",o[8]),ht(a,"class","svelte-bz0zu3"),ht(k,"type","button"),ht(k,"title",o[3]),ht(k,"class","svelte-bz0zu3"),ht(b,"class","clear-button-container svelte-bz0zu3"),Eo(b,"displayable",o[1]!==""),ht(n,"class","input-group svelte-bz0zu3"),ht(t,"tabindex","0"),ht(t,"class",G=V_(o[2])+" svelte-bz0zu3"),Eo(t,"can-collapse",o[4]&&o[1]==="")},m(Ee,ze){Tn(Ee,e,ze),Tn(Ee,t,ze),Oi(t,n),Oi(n,l),ws(u,l,null),Oi(n,d),Oi(n,a),o[63](a),q_(a,o[1]),Oi(n,g),Oi(n,b),Oi(b,k),ws(S,k,null),Oi(b,L),te&&te.m(b,null),Oi(n,P),Y&&Y.m(n,null),Oi(n,R),fe&&fe.m(n,null),Oi(t,Z),~$&&ae[$].m(t,null),K=!0,le||(Se=[Vr(l,"click",o[62]),Vr(a,"input",o[64]),Vr(a,"focus",o[65]),Vr(a,"blur",o[66]),Vr(a,"keydown",o[22]),Vr(a,"input",o[67]),Vr(k,"click",o[68]),Vr(t,"submit",pw(o[21]))],le=!0)},p(Ee,ze){(!K||ze[0]&256)&&ht(a,"placeholder",Ee[8]),(!K||ze[0]&256)&&ht(a,"aria-label",Ee[8]),ze[0]&2&&a.value!==Ee[1]&&q_(a,Ee[1]),(!K||ze[0]&8)&&ht(k,"title",Ee[3]),Ee[19]?te?ze[0]&524288&&Fn(te,1):(te=ng(),te.c(),Fn(te,1),te.m(b,null)):te&&(gd(),ar(te,1,1,()=>{te=null}),yd()),(!K||ze[0]&2)&&Eo(b,"displayable",Ee[1]!==""),Ee[5]==="button"?Y?(Y.p(Ee,ze),ze[0]&32&&Fn(Y,1)):(Y=rg(Ee),Y.c(),Fn(Y,1),Y.m(n,R)):Y&&(gd(),ar(Y,1,1,()=>{Y=null}),yd()),fe&&fe.p&&(!K||ze[1]&536870912)&&hw(fe,ue,Ee,Ee[60],K?uw(ue,Ee[60],ze,null):dw(Ee[60]),null);let rt=$;$=We(Ee),$===rt?~$&&ae[$].p(Ee,ze):(H&&(gd(),ar(ae[rt],1,1,()=>{ae[rt]=null}),yd()),~$?(H=ae[$],H?H.p(Ee,ze):(H=ae[$]=ce[$](Ee),H.c()),Fn(H,1),H.m(t,null)):H=null),(!K||ze[0]&4&&G!==(G=V_(Ee[2])+" svelte-bz0zu3"))&&ht(t,"class",G),(!K||ze[0]&22)&&Eo(t,"can-collapse",Ee[4]&&Ee[1]==="")},i(Ee){K||(Fn(Le),Fn(u.$$.fragment,Ee),Fn(S.$$.fragment,Ee),Fn(te),Fn(Y),Fn(fe,Ee),Fn(H),K=!0)},o(Ee){ar(Le),ar(u.$$.fragment,Ee),ar(S.$$.fragment,Ee),ar(te),ar(Y),ar(fe,Ee),ar(H),K=!1},d(Ee){Ee&&(yn(e),yn(t)),xs(u),o[63](null),xs(S),te&&te.d(),Y&&Y.d(),fe&&fe.d(Ee),~$&&ae[$].d(),le=!1,ks(Se)}}}function fx(o,e,t){let n,l,{$$slots:u={},$$scope:d}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:g=void 0}=e,{apiKey:b}=e,{bbox:k=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:L=!1}=e,{collapsed:P=!1}=e,{country:R=void 0}=e,{debounceSearch:Z=200}=e,{enableReverse:$="never"}=e,{errorMessage:H="Something went wrong…"}=e,{filter:G=()=>!0}=e,{flyTo:K=!0}=e,{fuzzyMatch:le=!0}=e,{language:Se=void 0}=e,{limit:Le=void 0}=e,{mapController:te=void 0}=e,{minLength:Y=2}=e,{noResultsMessage:ue="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:fe="Search"}=e,{proximity:ce=[{type:"server-geolocation"}]}=e,{reverseActive:ae=$==="always"}=e,{reverseButtonTitle:We="toggle reverse geocoding"}=e,{searchValue:Ee=""}=e,{pickedResultStyle:ze="full-geometry"}=e,{showPlaceType:rt="if-needed"}=e,{showResultsWhileTyping:it=!0}=e,{selectFirst:Qe=!0}=e,{flyToSelected:Ft=!1}=e,{markerOnSelected:jt=!0}=e,{types:ut=void 0}=e,{exhaustiveReverseGeocoding:et=!1}=e,{excludeTypes:at=!1}=e,{zoom:Bt=a}=e,{apiUrl:Dt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Ht={}}=e,{iconsBaseUrl:ai="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:si=()=>{}}=e;function Si(){Ie.focus()}function Ri(){Ie.blur()}function vi(j,Fe=!0,Ke=!1){t(1,Ee=j),Fe?(t(15,nt=-1),Yn()):(wn(!Ke,Ke),setTimeout(()=>{Ie.focus(),Ie.select()}))}function di(){t(14,st=void 0),t(56,mt=void 0),t(15,nt=-1)}function lt(){t(55,Te=[]),t(56,mt=void 0)}let qe=!1,st,Te,mt,yt="",Ie,nt=-1,Xt,wi=[],Ni,Li,gi,Fi;const _r=new Set,ct=yw();gw(()=>{te&&(te.setEventHandler(void 0),te.indicateReverse(!1),te.setSelectedMarker(-1),te.setFeatures(void 0,void 0,!1))});function Yn(j){if(Li&&(clearTimeout(Li),Li=void 0),nt>-1&&st)t(56,mt=st[nt]),t(1,Ee=mt.place_type[0]==="reverse"?mt.place_name:mt.place_name.replace(/,.*/,"")),t(18,Xt=void 0),t(55,Te=void 0),t(15,nt=-1);else if(Ee){const Fe=j||!un(Ee);On(Ee,{exact:!0}).then(()=>{t(55,Te=st),t(56,mt=void 0),Fe&&qr()}).catch(Ke=>t(18,Xt=Ke))}}function un(j){try{return ax(j,6)}catch{return!1}}async function On(j,{byId:Fe=!1,exact:Ke=!1}={}){t(18,Xt=void 0),Ni==null||Ni.abort();const Ne=new AbortController;t(19,Ni=Ne);try{const Xe=un(j),_t=new URLSearchParams;if(Se!==void 0&&_t.set("language",Array.isArray(Se)?Se.join(","):Se??""),ut&&_t.set("types",ut.join(",")),at&&_t.set("excludeTypes",String(at)),k&&_t.set("bbox",k.map(ci=>ci.toFixed(6)).join(",")),R&&_t.set("country",Array.isArray(R)?R.join(","):R),!Fe&&!Xe){const ci=await Kw(te,ce,Ne);ci&&_t.set("proximity",ci),(Ke||!it)&&_t.set("autocomplete","false"),_t.set("fuzzyMatch",String(le))}Le!==void 0&&(et||!Xe||(ut==null?void 0:ut.length)===1)&&_t.set("limit",String(Le)),_t.set("key",b),si(_t);const Et=Dt+"/"+encodeURIComponent(Xe?Xe.decimalLongitude+","+Xe.decimalLatitude:j)+".json?"+_t.toString();if(Et===yt){Fe?(t(14,st=void 0),t(56,mt=wi[0])):t(14,st=wi);return}yt=Et;const pi=await fetch(Et,{signal:Ne.signal,...Ht});if(!pi.ok)throw new Error(await pi.text());const Qt=await pi.json();ct("response",{url:Et,featureCollection:Qt}),Fe?(t(14,st=void 0),t(56,mt=Qt.features[0]),wi=[mt]):(t(14,st=Qt.features.filter(G)),Xe&&st.unshift({type:"Feature",properties:{},id:"reverse_"+Xe.decimalLongitude+"_"+Xe.decimalLatitude,text:Xe.decimalLatitude+", "+Xe.decimalLongitude,place_name:Xe.decimalLatitude+", "+Xe.decimalLongitude,place_type:["reverse"],center:[Xe.decimalLongitude,Xe.decimalLatitude],bbox:[Xe.decimalLongitude,Xe.decimalLatitude,Xe.decimalLongitude,Xe.decimalLatitude],geometry:{type:"Point",coordinates:[Xe.decimalLongitude,Xe.decimalLatitude]}}),wi=st,Xe&&Ie.focus())}catch(Xe){if(Xe&&typeof Xe=="object"&&"name"in Xe&&Xe.name==="AbortError")return;throw Xe}finally{Ne===Ni&&t(19,Ni=void 0)}}function qr(){var j;if(!(Te!=null&&Te.length)||!K)return;const Fe=[180,90,-180,-90],Ke=!Te.some(Xe=>!Xe.matching_text);let Ne;for(const Xe of Te){const _t=vt(Xe);if(Ne=Ne===void 0?_t:_t===void 0?Ne:Math.max(Ne,_t),Ke||!Xe.matching_text)for(const Et of[0,1,2,3])Fe[Et]=Math[Et<2?"min":"max"](Fe[Et],((j=Xe.bbox)==null?void 0:j[Et])??Xe.center[Et%2])}te&&Te.length>0&&(mt&&Fe[0]===Fe[2]&&Fe[1]===Fe[3]?te.flyTo(mt.center,vt(mt)):te.fitBounds(Sd(Fe),50,Ne))}function vt(j){var Fe;if(!j.bbox||j.bbox[0]!==j.bbox[2]&&j.bbox[1]!==j.bbox[3])return;const Ke=j.id.replace(/\..*/,"");return(Array.isArray((Fe=j.properties)==null?void 0:Fe.categories)?j.properties.categories.reduce((Ne,Xe)=>{const _t=Bt[Ke+"."+Xe];return Ne===void 0?_t:_t===void 0?Ne:Math.max(Ne,_t)},void 0):void 0)??Bt[Ke]}function li(j){t(0,ae=$==="always"),t(14,st=void 0),t(56,mt=void 0),t(15,nt=-1),vi(j[1].toFixed(6)+", "+Xw(j[0],[-180,180],!0).toFixed(6),!1,!0)}function Jt(j){if(!st)return;let Fe=j.key==="ArrowDown"?1:j.key==="ArrowUp"?-1:0;Fe&&(nt===(Qe?0:-1)&&Fe===-1&&t(15,nt=st.length),t(15,nt+=Fe),nt>=st.length&&t(15,nt=-1),nt<0&&Qe&&t(15,nt=0),j.preventDefault())}function wn(j=!0,Fe=!1){if(t(18,Xt=void 0),it||Fe){if(Li&&clearTimeout(Li),Ee.length<Y)return;const Ke=Ee;Li=window.setTimeout(()=>{On(Ke).catch(Ne=>t(18,Xt=Ne))},j?Z:0)}else t(14,st=void 0),t(18,Xt=void 0)}function Dn(j){t(56,mt=j),t(1,Ee=j.place_name),t(15,nt=-1)}const ei=()=>Ie.focus();function gr(j){mp[j?"unshift":"push"](()=>{Ie=j,t(17,Ie)})}function zr(){Ee=this.value,t(1,Ee),t(13,qe),t(28,L)}const Zr=()=>t(13,qe=!0),yr=()=>t(13,qe=!1),ye=()=>wn(),q=()=>{t(1,Ee=""),Ie.focus()},V=()=>t(0,ae=!ae),re=()=>t(18,Xt=void 0),pe=j=>t(15,nt=j),Me=j=>Dn(j),De=()=>{Qe||t(15,nt=-1)},$e=()=>{};return o.$$set=j=>{"class"in j&&t(2,g=j.class),"apiKey"in j&&t(26,b=j.apiKey),"bbox"in j&&t(27,k=j.bbox),"clearButtonTitle"in j&&t(3,S=j.clearButtonTitle),"clearOnBlur"in j&&t(28,L=j.clearOnBlur),"collapsed"in j&&t(4,P=j.collapsed),"country"in j&&t(29,R=j.country),"debounceSearch"in j&&t(30,Z=j.debounceSearch),"enableReverse"in j&&t(5,$=j.enableReverse),"errorMessage"in j&&t(6,H=j.errorMessage),"filter"in j&&t(31,G=j.filter),"flyTo"in j&&t(32,K=j.flyTo),"fuzzyMatch"in j&&t(33,le=j.fuzzyMatch),"language"in j&&t(34,Se=j.language),"limit"in j&&t(35,Le=j.limit),"mapController"in j&&t(36,te=j.mapController),"minLength"in j&&t(37,Y=j.minLength),"noResultsMessage"in j&&t(7,ue=j.noResultsMessage),"placeholder"in j&&t(8,fe=j.placeholder),"proximity"in j&&t(38,ce=j.proximity),"reverseActive"in j&&t(0,ae=j.reverseActive),"reverseButtonTitle"in j&&t(9,We=j.reverseButtonTitle),"searchValue"in j&&t(1,Ee=j.searchValue),"pickedResultStyle"in j&&t(39,ze=j.pickedResultStyle),"showPlaceType"in j&&t(10,rt=j.showPlaceType),"showResultsWhileTyping"in j&&t(40,it=j.showResultsWhileTyping),"selectFirst"in j&&t(11,Qe=j.selectFirst),"flyToSelected"in j&&t(41,Ft=j.flyToSelected),"markerOnSelected"in j&&t(42,jt=j.markerOnSelected),"types"in j&&t(43,ut=j.types),"exhaustiveReverseGeocoding"in j&&t(44,et=j.exhaustiveReverseGeocoding),"excludeTypes"in j&&t(45,at=j.excludeTypes),"zoom"in j&&t(46,Bt=j.zoom),"apiUrl"in j&&t(47,Dt=j.apiUrl),"fetchParameters"in j&&t(48,Ht=j.fetchParameters),"iconsBaseUrl"in j&&t(12,ai=j.iconsBaseUrl),"adjustUrlQuery"in j&&t(49,si=j.adjustUrlQuery),"$$scope"in j&&t(60,d=j.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&32&&t(0,ae=$==="always"),o.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,gi=qe),L&&!qe&&t(1,Ee="")}),o.$$.dirty[0]&16386|o.$$.dirty[1]&64&&Ee.length<Y&&(t(56,mt=void 0),t(14,st=void 0),t(18,Xt=void 0),t(55,Te=st)),o.$$.dirty[1]&33554688&&ze!=="marker-only"&&mt&&!mt.address&&mt.geometry.type==="Point"&&mt.place_type[0]!=="reverse"&&On(mt.id,{byId:!0}).catch(j=>t(18,Xt=j)),o.$$.dirty[1]&100663330&&(te&&mt&&mt.id!==Fi&&K&&(!mt.bbox||mt.bbox[0]===mt.bbox[2]&&mt.bbox[1]===mt.bbox[3]?te.flyTo(mt.center,vt(mt)):te.fitBounds(Sd(mt.bbox),50,vt(mt)),t(14,st=void 0),t(55,Te=void 0),t(15,nt=-1)),t(57,Fi=mt==null?void 0:mt.id)),o.$$.dirty[0]&18432&&Qe&&st!=null&&st.length&&t(15,nt=0),o.$$.dirty[0]&2&&t(15,nt=-1),o.$$.dirty[0]&16384|o.$$.dirty[1]&16777216&&Te!==st&&t(55,Te=void 0),o.$$.dirty[0]&81921|o.$$.dirty[1]&16777248&&te&&te.setEventHandler(j=>{switch(j.type){case"mapClick":ae&&li(j.coordinates);break;case"markerClick":{const Fe=st==null?void 0:st.find(Ke=>Ke.id===j.id);Fe&&Dn(Fe)}break;case"markerMouseEnter":Te&&t(15,nt=gi?(st==null?void 0:st.findIndex(Fe=>Fe.id===j.id))??-1:-1);break;case"markerMouseLeave":Te&&t(15,nt=-1);break}}),o.$$.dirty[0]&49152&&t(58,l=st==null?void 0:st[nt]),o.$$.dirty[1]&134218786&&te&&l&&K&&Ft&&te.flyTo(l.center,vt(l)),o.$$.dirty[1]&256&&t(59,n=ze==="full-geometry-including-polygon-center-marker"),o.$$.dirty[1]&268437536&&(jt||te==null||te.setFeatures(void 0,void 0,n)),o.$$.dirty[1]&419432480&&te&&jt&&!Te&&(te.setFeatures(l?[l]:void 0,void 0,n),te.setSelectedMarker(l?0:-1)),o.$$.dirty[1]&318767136&&te&&te.setFeatures(Te,mt,n),o.$$.dirty[0]&32768|o.$$.dirty[1]&16777248&&Te&&te&&te.setSelectedMarker(nt),o.$$.dirty[0]&2|o.$$.dirty[1]&32&&te){const j=un(Ee);te.setReverseMarker(j?[j.decimalLongitude,j.decimalLatitude]:void 0)}o.$$.dirty[1]&134217728&&ct("select",{feature:l}),o.$$.dirty[1]&33554432&&ct("pick",{feature:mt}),o.$$.dirty[0]&81920&&ct("optionsvisibilitychange",{optionsVisible:gi&&!!st}),o.$$.dirty[0]&16384&&ct("featureslisted",{features:st}),o.$$.dirty[1]&16777216&&ct("featuresmarked",{features:Te}),o.$$.dirty[0]&1&&ct("reversetoggle",{reverse:ae}),o.$$.dirty[0]&2&&ct("querychange",{query:Ee}),o.$$.dirty[0]&1|o.$$.dirty[1]&32&&te&&te.indicateReverse(ae)},[ae,Ee,g,S,P,$,H,ue,fe,We,rt,Qe,ai,qe,st,nt,gi,Ie,Xt,Ni,_r,Yn,Jt,wn,Dn,a,b,k,L,R,Z,G,K,le,Se,Le,te,Y,ce,ze,it,Ft,jt,ut,et,at,Bt,Dt,Ht,si,Si,Ri,vi,di,lt,Te,mt,Fi,l,n,d,u,ei,gr,zr,Zr,yr,ye,q,V,re,pe,Me,De,$e]}let px=class extends ga{constructor(o){super(),_a(this,o,fx,dx,ma,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function Ku(o,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=o,n}function jp(o,e,t={}){for(const n of o){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<n[n.length-1].length;l++)if(n[n.length-1][l]!==n[0][l])throw new Error("First and last Position are not equivalent.")}return Ku({type:"Polygon",coordinates:o},e,t)}function Ju(o,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=o,t}function f1(o,e,t={}){return Ku({type:"MultiPolygon",coordinates:o},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function mx(o,e){var t={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},n,l,u,d;return d={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function a(b){return function(k){return g([b,k])}}function g(b){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,l&&(u=b[0]&2?l.return:b[0]?l.throw||((u=l.return)&&u.call(l),0):l.next)&&!(u=u.call(l,b[1])).done)return u;switch(l=0,u&&(b=[b[0]&2,u.value]),b[0]){case 0:case 1:u=b;break;case 4:return t.label++,{value:b[1],done:!1};case 5:t.label++,l=b[1],b=[0];continue;case 7:b=t.ops.pop(),t.trys.pop();continue;default:if(u=t.trys,!(u=u.length>0&&u[u.length-1])&&(b[0]===6||b[0]===2)){t=0;continue}if(b[0]===3&&(!u||b[1]>u[0]&&b[1]<u[3])){t.label=b[1];break}if(b[0]===6&&t.label<u[1]){t.label=u[1],u=b;break}if(u&&t.label<u[2]){t.label=u[2],t.ops.push(b);break}u[2]&&t.ops.pop(),t.trys.pop();continue}b=e.call(o,t)}catch(k){b=[6,k],l=0}finally{n=u=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}}var da=function(){function o(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return o}();function _x(o,e){return o>e?1:o<e?-1:0}function oa(o,e,t){for(var n=new da(null,null),l=n,u=n;;){var d=t(o,e.key);if(d<0){if(e.left===null)break;if(t(o,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}u.left=e,u=e,e=e.left}else if(d>0){if(e.right===null)break;if(t(o,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}l.right=e,l=e,e=e.right}else break}return l.right=e.left,u.left=e.right,e.left=n.right,e.right=n.left,e}function op(o,e,t,n){var l=new da(o,e);if(t===null)return l.left=l.right=null,l;t=oa(o,t,n);var u=n(o,t.key);return u<0?(l.left=t.left,l.right=t,t.left=null):u>=0&&(l.right=t.right,l.left=t,t.right=null),l}function sg(o,e,t){var n=null,l=null;if(e){e=oa(o,e,t);var u=t(e.key,o);u===0?(n=e.left,l=e.right):u<0?(l=e.right,e.right=null,n=e):(n=e.left,e.left=null,l=e)}return{left:n,right:l}}function gx(o,e,t){return e===null?o:(o===null||(e=oa(o.key,e,t),e.left=o),e)}function yp(o,e,t,n,l){if(o){n(""+e+(t?"└── ":"├── ")+l(o)+`
`);var u=e+(t?"    ":"│   ");o.left&&yp(o.left,u,!1,n,l),o.right&&yp(o.right,u,!0,n,l)}}var Up=function(){function o(e){e===void 0&&(e=_x),this._root=null,this._size=0,this._comparator=e}return o.prototype.insert=function(e,t){return this._size++,this._root=op(e,t,this._root,this._comparator)},o.prototype.add=function(e,t){var n=new da(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var l=this._comparator,u=oa(e,this._root,l),d=l(e,u.key);return d===0?this._root=u:(d<0?(n.left=u.left,n.right=u,u.left=null):d>0&&(n.right=u.right,n.left=u,u.right=null),this._size++,this._root=n),this._root},o.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},o.prototype._remove=function(e,t,n){var l;if(t===null)return null;t=oa(e,t,n);var u=n(e,t.key);return u===0?(t.left===null?l=t.right:(l=oa(e,t.left,n),l.right=t.right),this._size--,l):t},o.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=oa(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},o.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var l=n(e,t.key);if(l===0)return t;l<0?t=t.left:t=t.right}return null},o.prototype.find=function(e){return this._root&&(this._root=oa(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},o.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var l=n(e,t.key);if(l===0)return!0;l<0?t=t.left:t=t.right}return!1},o.prototype.forEach=function(e,t){for(var n=this._root,l=[],u=!1;!u;)n!==null?(l.push(n),n=n.left):l.length!==0?(n=l.pop(),e.call(t,n),n=n.right):u=!0;return this},o.prototype.range=function(e,t,n,l){for(var u=[],d=this._comparator,a=this._root,g;u.length!==0||a;)if(a)u.push(a),a=a.left;else{if(a=u.pop(),g=d(a.key,t),g>0)break;if(d(a.key,e)>=0&&n.call(l,a))return this;a=a.right}return this},o.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},o.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},o.prototype.min=function(){return this._root?this.minNode(this._root).key:null},o.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},o.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},o.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},o.prototype.at=function(e){for(var t=this._root,n=!1,l=0,u=[];!n;)if(t)u.push(t),t=t.left;else if(u.length>0){if(t=u.pop(),l===e)return t;l++,t=t.right}else n=!0;return null},o.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?(n=t,t=t.left):t=t.right}return n},o.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?t=t.left:(n=t,t=t.right)}return n},o.prototype.clear=function(){return this._root=null,this._size=0,this},o.prototype.toList=function(){return bx(this._root)},o.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var l=e.length,u=this._comparator;if(n&&wp(e,t,0,l-1,u),this._root===null)this._root=bp(e,t,0,l),this._size=l;else{var d=vx(this.toList(),yx(e,t),u);l=this._size+l,this._root=vp({head:d},0,l)}return this},o.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(o.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),o.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return yp(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},o.prototype.update=function(e,t,n){var l=this._comparator,u=sg(e,this._root,l),d=u.left,a=u.right;l(e,t)<0?a=op(t,n,a,l):d=op(t,n,d,l),this._root=gx(d,a,l)},o.prototype.split=function(e){return sg(e,this._root,this._comparator)},o.prototype[Symbol.iterator]=function(){var e,t,n;return mx(this,function(l){switch(l.label){case 0:e=this._root,t=[],n=!1,l.label=1;case 1:return n?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return l.sent(),e=e.right,[3,5];case 4:n=!0,l.label=5;case 5:return[3,1];case 6:return[2]}})},o}();function bp(o,e,t,n){var l=n-t;if(l>0){var u=t+Math.floor(l/2),d=o[u],a=e[u],g=new da(d,a);return g.left=bp(o,e,t,u),g.right=bp(o,e,u+1,n),g}return null}function yx(o,e){for(var t=new da(null,null),n=t,l=0;l<o.length;l++)n=n.next=new da(o[l],e[l]);return n.next=null,t.next}function bx(o){for(var e=o,t=[],n=!1,l=new da(null,null),u=l;!n;)e?(t.push(e),e=e.left):t.length>0?(e=u=u.next=t.pop(),e=e.right):n=!0;return u.next=null,l.next}function vp(o,e,t){var n=t-e;if(n>0){var l=e+Math.floor(n/2),u=vp(o,e,l),d=o.head;return d.left=u,o.head=o.head.next,d.right=vp(o,l+1,t),d}return null}function vx(o,e,t){for(var n=new da(null,null),l=n,u=o,d=e;u!==null&&d!==null;)t(u.key,d.key)<0?(l.next=u,u=u.next):(l.next=d,d=d.next),l=l.next;return u!==null?l.next=u:d!==null&&(l.next=d),n.next}function wp(o,e,t,n,l){if(!(t>=n)){for(var u=o[t+n>>1],d=t-1,a=n+1;;){do d++;while(l(o[d],u)<0);do a--;while(l(o[a],u)>0);if(d>=a)break;var g=o[d];o[d]=o[a],o[a]=g,g=e[d],e[d]=e[a],e[a]=g}wp(o,e,t,a,l),wp(o,e,a+1,n,l)}}const vs=11102230246251565e-32,Cr=134217729,wx=(3+8*vs)*vs;function sp(o,e,t,n,l){let u,d,a,g,b=e[0],k=n[0],S=0,L=0;k>b==k>-b?(u=b,b=e[++S]):(u=k,k=n[++L]);let P=0;if(S<o&&L<t)for(k>b==k>-b?(d=b+u,a=u-(d-b),b=e[++S]):(d=k+u,a=u-(d-k),k=n[++L]),u=d,a!==0&&(l[P++]=a);S<o&&L<t;)k>b==k>-b?(d=u+b,g=d-u,a=u-(d-g)+(b-g),b=e[++S]):(d=u+k,g=d-u,a=u-(d-g)+(k-g),k=n[++L]),u=d,a!==0&&(l[P++]=a);for(;S<o;)d=u+b,g=d-u,a=u-(d-g)+(b-g),b=e[++S],u=d,a!==0&&(l[P++]=a);for(;L<t;)d=u+k,g=d-u,a=u-(d-g)+(k-g),k=n[++L],u=d,a!==0&&(l[P++]=a);return(u!==0||P===0)&&(l[P++]=u),P}function xx(o,e){let t=e[0];for(let n=1;n<o;n++)t+=e[n];return t}function nh(o){return new Float64Array(o)}const kx=(3+16*vs)*vs,Sx=(2+12*vs)*vs,Tx=(9+64*vs)*vs*vs,Kl=nh(4),ag=nh(8),lg=nh(12),cg=nh(16),$r=nh(4);function Ix(o,e,t,n,l,u,d){let a,g,b,k,S,L,P,R,Z,$,H,G,K,le,Se,Le,te,Y;const ue=o-l,fe=t-l,ce=e-u,ae=n-u;le=ue*ae,L=Cr*ue,P=L-(L-ue),R=ue-P,L=Cr*ae,Z=L-(L-ae),$=ae-Z,Se=R*$-(le-P*Z-R*Z-P*$),Le=ce*fe,L=Cr*ce,P=L-(L-ce),R=ce-P,L=Cr*fe,Z=L-(L-fe),$=fe-Z,te=R*$-(Le-P*Z-R*Z-P*$),H=Se-te,S=Se-H,Kl[0]=Se-(H+S)+(S-te),G=le+H,S=G-le,K=le-(G-S)+(H-S),H=K-Le,S=K-H,Kl[1]=K-(H+S)+(S-Le),Y=G+H,S=Y-G,Kl[2]=G-(Y-S)+(H-S),Kl[3]=Y;let We=xx(4,Kl),Ee=Sx*d;if(We>=Ee||-We>=Ee||(S=o-ue,a=o-(ue+S)+(S-l),S=t-fe,b=t-(fe+S)+(S-l),S=e-ce,g=e-(ce+S)+(S-u),S=n-ae,k=n-(ae+S)+(S-u),a===0&&g===0&&b===0&&k===0)||(Ee=Tx*d+wx*Math.abs(We),We+=ue*k+ae*a-(ce*b+fe*g),We>=Ee||-We>=Ee))return We;le=a*ae,L=Cr*a,P=L-(L-a),R=a-P,L=Cr*ae,Z=L-(L-ae),$=ae-Z,Se=R*$-(le-P*Z-R*Z-P*$),Le=g*fe,L=Cr*g,P=L-(L-g),R=g-P,L=Cr*fe,Z=L-(L-fe),$=fe-Z,te=R*$-(Le-P*Z-R*Z-P*$),H=Se-te,S=Se-H,$r[0]=Se-(H+S)+(S-te),G=le+H,S=G-le,K=le-(G-S)+(H-S),H=K-Le,S=K-H,$r[1]=K-(H+S)+(S-Le),Y=G+H,S=Y-G,$r[2]=G-(Y-S)+(H-S),$r[3]=Y;const ze=sp(4,Kl,4,$r,ag);le=ue*k,L=Cr*ue,P=L-(L-ue),R=ue-P,L=Cr*k,Z=L-(L-k),$=k-Z,Se=R*$-(le-P*Z-R*Z-P*$),Le=ce*b,L=Cr*ce,P=L-(L-ce),R=ce-P,L=Cr*b,Z=L-(L-b),$=b-Z,te=R*$-(Le-P*Z-R*Z-P*$),H=Se-te,S=Se-H,$r[0]=Se-(H+S)+(S-te),G=le+H,S=G-le,K=le-(G-S)+(H-S),H=K-Le,S=K-H,$r[1]=K-(H+S)+(S-Le),Y=G+H,S=Y-G,$r[2]=G-(Y-S)+(H-S),$r[3]=Y;const rt=sp(ze,ag,4,$r,lg);le=a*k,L=Cr*a,P=L-(L-a),R=a-P,L=Cr*k,Z=L-(L-k),$=k-Z,Se=R*$-(le-P*Z-R*Z-P*$),Le=g*b,L=Cr*g,P=L-(L-g),R=g-P,L=Cr*b,Z=L-(L-b),$=b-Z,te=R*$-(Le-P*Z-R*Z-P*$),H=Se-te,S=Se-H,$r[0]=Se-(H+S)+(S-te),G=le+H,S=G-le,K=le-(G-S)+(H-S),H=K-Le,S=K-H,$r[1]=K-(H+S)+(S-Le),Y=G+H,S=Y-G,$r[2]=G-(Y-S)+(H-S),$r[3]=Y;const it=sp(rt,lg,4,$r,cg);return cg[it-1]}function Cx(o,e,t,n,l,u){const d=(e-u)*(t-l),a=(o-l)*(n-u),g=d-a,b=Math.abs(d+a);return Math.abs(g)>=kx*b?g:-Ix(o,e,t,n,l,u,b)}const Au=(o,e)=>o.ll.x<=e.x&&e.x<=o.ur.x&&o.ll.y<=e.y&&e.y<=o.ur.y,xp=(o,e)=>{if(e.ur.x<o.ll.x||o.ur.x<e.ll.x||e.ur.y<o.ll.y||o.ur.y<e.ll.y)return null;const t=o.ll.x<e.ll.x?e.ll.x:o.ll.x,n=o.ur.x<e.ur.x?o.ur.x:e.ur.x,l=o.ll.y<e.ll.y?e.ll.y:o.ll.y,u=o.ur.y<e.ur.y?o.ur.y:e.ur.y;return{ll:{x:t,y:l},ur:{x:n,y:u}}};let sa=Number.EPSILON;sa===void 0&&(sa=Math.pow(2,-52));const Ex=sa*sa,ug=(o,e)=>{if(-sa<o&&o<sa&&-sa<e&&e<sa)return 0;const t=o-e;return t*t<Ex*o*e?0:o<e?-1:1};class Lx{constructor(){this.reset()}reset(){this.xRounder=new hg,this.yRounder=new hg}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class hg{constructor(){this.tree=new Up,this.round(0)}round(e){const t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&ug(t.key,n.key)===0)return this.tree.remove(e),n.key;const l=this.tree.next(t);return l!==null&&ug(t.key,l.key)===0?(this.tree.remove(e),l.key):e}}const Yu=new Lx,bd=(o,e)=>o.x*e.y-o.y*e.x,p1=(o,e)=>o.x*e.x+o.y*e.y,dg=(o,e,t)=>{const n=Cx(o.x,o.y,e.x,e.y,t.x,t.y);return n>0?-1:n<0?1:0},Td=o=>Math.sqrt(p1(o,o)),Mx=(o,e,t)=>{const n={x:e.x-o.x,y:e.y-o.y},l={x:t.x-o.x,y:t.y-o.y};return bd(l,n)/Td(l)/Td(n)},Ax=(o,e,t)=>{const n={x:e.x-o.x,y:e.y-o.y},l={x:t.x-o.x,y:t.y-o.y};return p1(l,n)/Td(l)/Td(n)},fg=(o,e,t)=>e.y===0?null:{x:o.x+e.x/e.y*(t-o.y),y:t},pg=(o,e,t)=>e.x===0?null:{x:t,y:o.y+e.y/e.x*(t-o.x)},Px=(o,e,t,n)=>{if(e.x===0)return pg(t,n,o.x);if(n.x===0)return pg(o,e,t.x);if(e.y===0)return fg(t,n,o.y);if(n.y===0)return fg(o,e,t.y);const l=bd(e,n);if(l==0)return null;const u={x:t.x-o.x,y:t.y-o.y},d=bd(u,e)/l,a=bd(u,n)/l,g=o.x+a*e.x,b=t.x+d*n.x,k=o.y+a*e.y,S=t.y+d*n.y,L=(g+b)/2,P=(k+S)/2;return{x:L,y:P}};class Io{static compare(e,t){const n=Io.comparePoints(e.point,t.point);return n!==0?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:ca.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let n=0,l=t.length;n<l;n++){const u=t[n];this.point.events.push(u),u.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(n.segment.consumedBy===void 0)for(let l=t+1;l<e;l++){const u=this.point.events[l];u.consumedBy===void 0&&n.otherSE.point.events===u.otherSE.point.events&&n.segment.consume(u.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const l=this.point.events[t];l!==this&&!l.segment.ringOut&&l.segment.isInResult()&&e.push(l)}return e}getLeftmostComparator(e){const t=new Map,n=l=>{const u=l.otherSE;t.set(l,{sine:Mx(this.point,e.point,u.point),cosine:Ax(this.point,e.point,u.point)})};return(l,u)=>{t.has(l)||n(l),t.has(u)||n(u);const{sine:d,cosine:a}=t.get(l),{sine:g,cosine:b}=t.get(u);return d>=0&&g>=0?a<b?1:a>b?-1:0:d<0&&g<0?a<b?-1:a>b?1:0:g<d?-1:g>d?1:0}}}let zx=0;class ca{static compare(e,t){const n=e.leftSE.point.x,l=t.leftSE.point.x,u=e.rightSE.point.x,d=t.rightSE.point.x;if(d<n)return 1;if(u<l)return-1;const a=e.leftSE.point.y,g=t.leftSE.point.y,b=e.rightSE.point.y,k=t.rightSE.point.y;if(n<l){if(g<a&&g<b)return 1;if(g>a&&g>b)return-1;const S=e.comparePoint(t.leftSE.point);if(S<0)return 1;if(S>0)return-1;const L=t.comparePoint(e.rightSE.point);return L!==0?L:-1}if(n>l){if(a<g&&a<k)return-1;if(a>g&&a>k)return 1;const S=t.comparePoint(e.leftSE.point);if(S!==0)return S;const L=e.comparePoint(t.rightSE.point);return L<0?1:L>0?-1:1}if(a<g)return-1;if(a>g)return 1;if(u<d){const S=t.comparePoint(e.rightSE.point);if(S!==0)return S}if(u>d){const S=e.comparePoint(t.rightSE.point);if(S<0)return 1;if(S>0)return-1}if(u!==d){const S=b-a,L=u-n,P=k-g,R=d-l;if(S>L&&P<R)return 1;if(S<L&&P>R)return-1}return u>d?1:u<d||b<k?-1:b>k?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,l){this.id=++zx,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=l}static fromRing(e,t,n){let l,u,d;const a=Io.comparePoints(e,t);if(a<0)l=e,u=t,d=1;else if(a>0)l=t,u=e,d=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const g=new Io(l,!0),b=new Io(u,!1);return new ca(g,b,[n],[d])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,n=this.rightSE.point,l=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;const u=(e.y-t.y)/l.y,d=t.x+u*l.x;if(e.x===d)return 0;const a=(e.x-t.x)/l.x,g=t.y+a*l.y;return e.y===g?0:e.y<g?-1:1}getIntersection(e){const t=this.bbox(),n=e.bbox(),l=xp(t,n);if(l===null)return null;const u=this.leftSE.point,d=this.rightSE.point,a=e.leftSE.point,g=e.rightSE.point,b=Au(t,a)&&this.comparePoint(a)===0,k=Au(n,u)&&e.comparePoint(u)===0,S=Au(t,g)&&this.comparePoint(g)===0,L=Au(n,d)&&e.comparePoint(d)===0;if(k&&b)return L&&!S?d:!L&&S?g:null;if(k)return S&&u.x===g.x&&u.y===g.y?null:u;if(b)return L&&d.x===a.x&&d.y===a.y?null:a;if(L&&S)return null;if(L)return d;if(S)return g;const P=Px(u,this.vector(),a,e.vector());return P===null||!Au(l,P)?null:Yu.round(P.x,P.y)}split(e){const t=[],n=e.events!==void 0,l=new Io(e,!0),u=new Io(e,!1),d=this.rightSE;this.replaceRightSE(u),t.push(u),t.push(l);const a=new ca(l,d,this.rings.slice(),this.windings.slice());return Io.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Io.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(l.checkForConsuming(),u.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const l=ca.compare(t,n);if(l!==0){if(l>0){const u=t;t=n,n=u}if(t.prev===n){const u=t;t=n,n=u}for(let u=0,d=n.rings.length;u<d;u++){const a=n.rings[u],g=n.windings[u],b=t.rings.indexOf(a);b===-1?(t.rings.push(a),t.windings.push(g)):t.windings[b]+=g}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,l=this._afterState.multiPolys;for(let a=0,g=this.rings.length;a<g;a++){const b=this.rings[a],k=this.windings[a],S=t.indexOf(b);S===-1?(t.push(b),n.push(k)):n[S]+=k}const u=[],d=[];for(let a=0,g=t.length;a<g;a++){if(n[a]===0)continue;const b=t[a],k=b.poly;if(d.indexOf(k)===-1)if(b.isExterior)u.push(k);else{d.indexOf(k)===-1&&d.push(k);const S=u.indexOf(b.poly);S!==-1&&u.splice(S,1)}}for(let a=0,g=u.length;a<g;a++){const b=u[a].multiPoly;l.indexOf(b)===-1&&l.push(b)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(Oo.type){case"union":{const n=e.length===0,l=t.length===0;this._isInResult=n!==l;break}case"intersection":{let n,l;e.length<t.length?(n=e.length,l=t.length):(n=t.length,l=e.length),this._isInResult=l===Oo.numMultiPolys&&n<l;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2===1;break}case"difference":{const n=l=>l.length===1&&l[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw new Error(`Unrecognized operation type found ${Oo.type}`)}return this._isInResult}}class mg{constructor(e,t,n){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const l=Yu.round(e[0][0],e[0][1]);this.bbox={ll:{x:l.x,y:l.y},ur:{x:l.x,y:l.y}};let u=l;for(let d=1,a=e.length;d<a;d++){if(typeof e[d][0]!="number"||typeof e[d][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let g=Yu.round(e[d][0],e[d][1]);g.x===u.x&&g.y===u.y||(this.segments.push(ca.fromRing(u,g,this)),g.x<this.bbox.ll.x&&(this.bbox.ll.x=g.x),g.y<this.bbox.ll.y&&(this.bbox.ll.y=g.y),g.x>this.bbox.ur.x&&(this.bbox.ur.x=g.x),g.y>this.bbox.ur.y&&(this.bbox.ur.y=g.y),u=g)}(l.x!==u.x||l.y!==u.y)&&this.segments.push(ca.fromRing(u,l,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const l=this.segments[t];e.push(l.leftSE),e.push(l.rightSE)}return e}}class Dx{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new mg(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,l=e.length;n<l;n++){const u=new mg(e[n],this,!1);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.interiorRings.push(u)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const l=this.interiorRings[t].getSweepEvents();for(let u=0,d=l.length;u<d;u++)e.push(l[u])}return e}}class _g{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,l=e.length;n<l;n++){const u=new Dx(e[n],this);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.polys.push(u)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const l=this.polys[t].getSweepEvents();for(let u=0,d=l.length;u<d;u++)e.push(l[u])}return e}}class Id{static factory(e){const t=[];for(let n=0,l=e.length;n<l;n++){const u=e[n];if(!u.isInResult()||u.ringOut)continue;let d=null,a=u.leftSE,g=u.rightSE;const b=[a],k=a.point,S=[];for(;d=a,a=g,b.push(a),a.point!==k;)for(;;){const L=a.getAvailableLinkedEvents();if(L.length===0){const Z=b[0].point,$=b[b.length-1].point;throw new Error(`Unable to complete output ring starting at [${Z.x}, ${Z.y}]. Last matching segment found ends at [${$.x}, ${$.y}].`)}if(L.length===1){g=L[0].otherSE;break}let P=null;for(let Z=0,$=S.length;Z<$;Z++)if(S[Z].point===a.point){P=Z;break}if(P!==null){const Z=S.splice(P)[0],$=b.splice(Z.index);$.unshift($[0].otherSE),t.push(new Id($.reverse()));continue}S.push({index:b.length,point:a.point});const R=a.getLeftmostComparator(d);g=L.sort(R)[0].otherSE;break}t.push(new Id(b))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let b=1,k=this.events.length-1;b<k;b++){const S=this.events[b].point,L=this.events[b+1].point;dg(S,e,L)!==0&&(t.push(S),e=S)}if(t.length===1)return null;const n=t[0],l=t[1];dg(n,e,l)===0&&t.shift(),t.push(t[0]);const u=this.isExteriorRing()?1:-1,d=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,g=[];for(let b=d;b!=a;b+=u)g.push([t[b].x,t[b].y]);return g}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let l=1,u=this.events.length;l<u;l++){const d=this.events[l];Io.compare(e,d)>0&&(e=d)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}}class gg{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,n=this.interiorRings.length;t<n;t++){const l=this.interiorRings[t].getGeom();l!==null&&e.push(l)}return e}}class Rx{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const l=this.polys[t].getGeom();l!==null&&e.push(l)}return e}_composePolys(e){const t=[];for(let n=0,l=e.length;n<l;n++){const u=e[n];if(!u.poly)if(u.isExteriorRing())t.push(new gg(u));else{const d=u.enclosingRing();d.poly||t.push(new gg(d)),d.poly.addInterior(u)}}return t}}class Fx{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ca.compare;this.queue=e,this.tree=new Up(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;const l=e.isLeft?this.tree.add(t):this.tree.find(t);if(!l)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let u=l,d=l,a,g;for(;a===void 0;)u=this.tree.prev(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);for(;g===void 0;)d=this.tree.next(d),d===null?g=null:d.key.consumedBy===void 0&&(g=d.key);if(e.isLeft){let b=null;if(a){const S=a.getIntersection(t);if(S!==null&&(t.isAnEndpoint(S)||(b=S),!a.isAnEndpoint(S))){const L=this._splitSafely(a,S);for(let P=0,R=L.length;P<R;P++)n.push(L[P])}}let k=null;if(g){const S=g.getIntersection(t);if(S!==null&&(t.isAnEndpoint(S)||(k=S),!g.isAnEndpoint(S))){const L=this._splitSafely(g,S);for(let P=0,R=L.length;P<R;P++)n.push(L[P])}}if(b!==null||k!==null){let S=null;b===null?S=k:k===null?S=b:S=Io.comparePoints(b,k)<=0?b:k,this.queue.remove(t.rightSE),n.push(t.rightSE);const L=t.split(S);for(let P=0,R=L.length;P<R;P++)n.push(L[P])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&g){const b=a.getIntersection(g);if(b!==null){if(!a.isAnEndpoint(b)){const k=this._splitSafely(a,b);for(let S=0,L=k.length;S<L;S++)n.push(k[S])}if(!g.isAnEndpoint(b)){const k=this._splitSafely(g,b);for(let S=0,L=k.length;S<L;S++)n.push(k[S])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);const n=e.rightSE;this.queue.remove(n);const l=e.split(t);return l.push(n),e.consumedBy===void 0&&this.tree.add(e),l}}const yg=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Bx=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class Ox{run(e,t,n){Oo.type=e,Yu.reset();const l=[new _g(t,!0)];for(let k=0,S=n.length;k<S;k++)l.push(new _g(n[k],!1));if(Oo.numMultiPolys=l.length,Oo.type==="difference"){const k=l[0];let S=1;for(;S<l.length;)xp(l[S].bbox,k.bbox)!==null?S++:l.splice(S,1)}if(Oo.type==="intersection")for(let k=0,S=l.length;k<S;k++){const L=l[k];for(let P=k+1,R=l.length;P<R;P++)if(xp(L.bbox,l[P].bbox)===null)return[]}const u=new Up(Io.compare);for(let k=0,S=l.length;k<S;k++){const L=l[k].getSweepEvents();for(let P=0,R=L.length;P<R;P++)if(u.insert(L[P]),u.size>yg)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const d=new Fx(u);let a=u.size,g=u.pop();for(;g;){const k=g.key;if(u.size===a){const L=k.segment;throw new Error(`Unable to pop() ${k.isLeft?"left":"right"} SweepEvent [${k.point.x}, ${k.point.y}] from segment #${L.id} [${L.leftSE.point.x}, ${L.leftSE.point.y}] -> [${L.rightSE.point.x}, ${L.rightSE.point.y}] from queue.`)}if(u.size>yg)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(d.segments.length>Bx)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const S=d.process(k);for(let L=0,P=S.length;L<P;L++){const R=S[L];R.consumedBy===void 0&&u.insert(R)}a=u.size,g=u.pop()}Yu.reset();const b=Id.factory(d.segments);return new Rx(b).getGeom()}}const Oo=new Ox,Nx=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Oo.run("union",o,t)},jx=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Oo.run("intersection",o,t)},Ux=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Oo.run("xor",o,t)},$x=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Oo.run("difference",o,t)};var m1={union:Nx,intersection:jx,xor:Ux,difference:$x};function _1(o,e,t){if(o!==null)for(var n,l,u,d,a,g,b,k=0,S=0,L,P=o.type,R=P==="FeatureCollection",Z=P==="Feature",$=R?o.features.length:1,H=0;H<$;H++){b=R?o.features[H].geometry:Z?o.geometry:o,L=b?b.type==="GeometryCollection":!1,a=L?b.geometries.length:1;for(var G=0;G<a;G++){var K=0,le=0;if(d=L?b.geometries[G]:b,d!==null){g=d.coordinates;var Se=d.type;switch(k=0,Se){case null:break;case"Point":if(e(g,S,H,K,le)===!1)return!1;S++,K++;break;case"LineString":case"MultiPoint":for(n=0;n<g.length;n++){if(e(g[n],S,H,K,le)===!1)return!1;S++,Se==="MultiPoint"&&K++}Se==="LineString"&&K++;break;case"Polygon":case"MultiLineString":for(n=0;n<g.length;n++){for(l=0;l<g[n].length-k;l++){if(e(g[n][l],S,H,K,le)===!1)return!1;S++}Se==="MultiLineString"&&K++,Se==="Polygon"&&le++}Se==="Polygon"&&K++;break;case"MultiPolygon":for(n=0;n<g.length;n++){for(le=0,l=0;l<g[n].length;l++){for(u=0;u<g[n][l].length-k;u++){if(e(g[n][l][u],S,H,K,le)===!1)return!1;S++}le++}K++}break;case"GeometryCollection":for(n=0;n<d.geometries.length;n++)if(_1(d.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function $p(o,e){var t,n,l,u,d,a,g,b,k,S,L=0,P=o.type==="FeatureCollection",R=o.type==="Feature",Z=P?o.features.length:1;for(t=0;t<Z;t++){for(a=P?o.features[t].geometry:R?o.geometry:o,b=P?o.features[t].properties:R?o.properties:{},k=P?o.features[t].bbox:R?o.bbox:void 0,S=P?o.features[t].id:R?o.id:void 0,g=a?a.type==="GeometryCollection":!1,d=g?a.geometries.length:1,l=0;l<d;l++){if(u=g?a.geometries[l]:a,u===null){if(e(null,L,b,k,S)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,L,b,k,S)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<u.geometries.length;n++)if(e(u.geometries[n],L,b,k,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}L++}}function Vx(o,e){$p(o,function(t,n,l,u,d){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Ku(t,l,{bbox:u,id:d}),n,0)===!1?!1:void 0}var g;switch(a){case"MultiPoint":g="Point";break;case"MultiLineString":g="LineString";break;case"MultiPolygon":g="Polygon";break}for(var b=0;b<t.coordinates.length;b++){var k=t.coordinates[b],S={type:g,coordinates:k};if(e(Ku(S,l),n,b)===!1)return!1}})}function qx(o,e={}){const t=[];if($p(o,l=>{t.push(l.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const n=m1.union(t[0],...t.slice(1));return n.length===0?null:n.length===1?jp(n[0],e.properties):f1(n,e.properties)}var g1=qx;function Zx(o,e={}){if(o.bbox!=null&&e.recompute!==!0)return o.bbox;const t=[1/0,1/0,-1/0,-1/0];return _1(o,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var bg=Zx;function Gx(o){const e=[];if($p(o,l=>{e.push(l.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=o.features[0].properties||{},n=m1.difference(e[0],...e.slice(1));return n.length===0?null:n.length===1?jp(n[0],t):f1(n,t)}var Wx=Gx;function Hx(o){if(!o)throw new Error("geojson is required");var e=[];return Vx(o,function(t){e.push(t)}),Ju(e)}var Xx=Hx;function vg(o,e){const t=Wx(Ju([jp([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),o]));if(!t)return;t.properties={isMask:!0};const n=Sd(bg(o)),l=(n[2]-n[0])/360/1e3,u=n[0]<-180,d=n[2]>180,a=Xx(o);if(a.features.length>1&&(u||d))for(const g of a.features){const b=Sd(bg(g));if(d&&b[0]<-180+l)for(const k of g.geometry.coordinates)for(const S of k)S[0]+=360-l;if(u&&b[2]>180-l)for(const k of g.geometry.coordinates)for(const S of k)S[0]-=360-l}e(Ju([a.features.length<2?o:g1(a)??o,t]))}const wg={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},ud="mtlr-gc-full-geom",xg="mtlr-gc-full-geom-fill",kg="mtlr-gc-full-geom-line";function y1(o,e,t=!0,n=!0,l={},u={},d=wg){let a;const g=[];let b,k,S;function L(){if(!o.loaded){o.once("load",L);return}const $=d?d===!0?wg:d:void 0;if(!($!=null&&$.fill)&&!($!=null&&$.line))return;const H=o.getSource(ud);if(H)H.setData(S??Ju([]));else if(S)o.addSource(ud,{type:"geojson",data:S});else return;!o.getLayer(xg)&&$!=null&&$.fill&&o.addLayer({...$==null?void 0:$.fill,id:xg,type:"fill",source:ud}),!o.getLayer(kg)&&$!=null&&$.line&&o.addLayer({...$==null?void 0:$.line,id:kg,type:"line",source:ud})}function P($){S=$,L()}o.on("styledata",()=>{setTimeout(()=>{S&&L()})});const R=$=>{a==null||a({type:"mapClick",coordinates:[$.lngLat.lng,$.lngLat.lat]})};function Z($=!1){if(!e)throw new Error;const H=document.createElement("div");return $&&H.classList.add("marker-interactive"),new qw({props:{displayIn:"maplibre"},target:H}),new e.Marker({element:H,offset:[1,-13]})}return{setEventHandler($){$?(a=$,o.on("click",R)):(a=void 0,o.off("click",R))},flyTo($,H){o.flyTo({center:$,...H?{zoom:H}:{},...l})},fitBounds($,H,G){o.fitBounds([[$[0],$[1]],[$[2],$[3]]],{padding:H,...G?{maxZoom:G}:{},...u})},indicateReverse($){o.getCanvasContainer().style.cursor=$?"crosshair":""},setReverseMarker($){!e||!t||(k?$?k.setLngLat($):(k.remove(),k=void 0):$&&(t instanceof Function?k=t(o)??void 0:(k=(typeof t=="object"?new e.Marker(t):Z()).setLngLat($).addTo(o),k.getElement().classList.add("marker-reverse"))))},setFeatures($,H,G){for(const K of g)K.remove();if(g.length=0,P(void 0),!!e){if(H){let K=!1;if(H.geometry.type==="GeometryCollection"){const le=H.geometry.geometries.filter(Se=>Se.type==="Polygon"||Se.type==="MultiPolygon");e:if(le.length>0){const Se=g1(Ju(le.map(Le=>Ku(Le))));if(!Se)break e;vg({...H,geometry:Se.geometry},P),K=!0}else{const Se=H.geometry.geometries.filter(Le=>Le.type==="LineString"||Le.type==="MultiLineString");Se.length>0&&(P({...H,geometry:{type:"GeometryCollection",geometries:Se}}),K=!0)}}if(!K){if(H.geometry.type==="Polygon"||H.geometry.type==="MultiPolygon")vg(H,P);else if(H.geometry.type==="LineString"||H.geometry.type==="MultiLineString"){P(H);return}}if(!G&&H.geometry.type!=="Point")return;if(t instanceof Function){const le=t(o,H);le&&g.push(le)}else t&&g.push(typeof t=="object"?new e.Marker(t):Z().setLngLat(H.center).addTo(o))}if(n)for(const K of $??[]){if(K===H)continue;let le;if(n instanceof Function){if(le=n(o,K),!le)continue}else le=(typeof n=="object"?new e.Marker(n):Z(!0)).setLngLat(K.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(K.place_type[0]==="reverse"?K.place_name:K.place_name.replace(/,.*/,""))).addTo(o);const Se=le.getElement();Se.addEventListener("click",Le=>{Le.stopPropagation(),a==null||a({type:"markerClick",id:K.id})}),Se.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:K.id}),le.togglePopup()}),Se.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:K.id}),le.togglePopup()}),g.push(le)}}},setSelectedMarker($){b&&b.getElement().classList.toggle("marker-selected",!1),b=$>-1?g[$]:void 0,b==null||b.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const $=o.getCenter();return[o.getZoom(),$.lng,$.lat]}}}function Kx(o,e,t){var n,l;class u{constructor($,H){po(this,"type"),po(this,"target"),this.type=H,this.target=$}}class d extends u{constructor($,H){super($,"select"),po(this,"feature"),Object.assign(this,H)}}class a extends u{constructor($,H){super($,"featureslisted"),po(this,"features"),this.features=H}}class g extends u{constructor($,H){super($,"featuresmarked"),po(this,"features"),this.features=H}}class b extends u{constructor($,H){super($,"optionsvisibilitychange"),po(this,"optionsVisible"),this.optionsVisible=H}}class k extends u{constructor($,H){super($,"pick"),po(this,"feature"),this.feature=H}}class S extends u{constructor($,H){super($,"querychange"),po(this,"query"),this.query=H}}class L extends u{constructor($,H,G){super($,"response"),po(this,"url"),po(this,"featureCollection"),this.url=H,this.featureCollection=G}}class P extends u{constructor($,H){super($,"reversetoggle"),po(this,"reverse"),this.reverse=H}}class R extends o{constructor($={}){super(),j_(this,n),j_(this,l),U_(this,l,$)}onAddInt($){const H=document.createElement("div");H.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:G,showResultMarkers:K,flyTo:le,fullGeometryStyle:Se,...Le}=Xn(this,l),te=typeof le=="boolean"?{}:le,Y={mapController:y1($,e,G,K,te,te,Se),flyTo:le===void 0?!0:!!le,apiKey:"",...t==null?void 0:t($,H),...Le};if(!Y.apiKey)throw new Error("no apiKey provided");return U_(this,n,new px({target:H,props:Y})),Xn(this,n).$on("select",ue=>{this.fire(new d(this,ue.detail))}),Xn(this,n).$on("pick",ue=>{this.fire(new k(this,ue.detail.feature))}),Xn(this,n).$on("featureslisted",ue=>{this.fire(new a(this,ue.detail.features))}),Xn(this,n).$on("featuresmarked",ue=>{this.fire(new g(this,ue.detail.features))}),Xn(this,n).$on("response",ue=>{this.fire(new L(this,ue.detail.url,ue.detail.featureCollection))}),Xn(this,n).$on("optionsvisibilitychange",ue=>{this.fire(new b(this,ue.detail.optionsVisible))}),Xn(this,n).$on("reversetoggle",ue=>{this.fire(new P(this,ue.detail.reverse))}),Xn(this,n).$on("querychange",ue=>{this.fire(new S(this,ue.detail.query))}),H}on($,H){return super.on($,H)}once($,H){return super.once($,H)}off($,H){return super.off($,H)}listens($){return super.listens($)}setOptions($){var H;Object.assign(Xn(this,l),$);const{marker:G,showResultMarkers:K,flyTo:le,fullGeometryStyle:Se,...Le}=Xn(this,l);(H=Xn(this,n))==null||H.$set(Le)}setQuery($,H=!0){var G;(G=Xn(this,n))==null||G.setQuery($,H)}clearMap(){var $;($=Xn(this,n))==null||$.clearMap()}clearList(){var $;($=Xn(this,n))==null||$.clearList()}setReverseMode($){var H;(H=Xn(this,n))==null||H.$set({reverseActive:$})}focus(){var $;($=Xn(this,n))==null||$.focus()}blur(){var $;($=Xn(this,n))==null||$.blur()}onRemove(){var $;($=Xn(this,n))==null||$.$destroy()}}return n=new WeakMap,l=new WeakMap,{MapLibreBasedGeocodingControl:R,events:{SelectEvent:d,FeaturesListedEvent:a,FeaturesMarkedEvent:g,OptionsVisibilityChangeEvent:b,PickEvent:k,QueryChangeEvent:S,ResponseEvent:L,ReverseToggleEvent:P}}}const{MapLibreBasedGeocodingControl:_C,events:ya}=Kx(Op.Evented,rw);ya.SelectEvent;ya.FeaturesListedEvent;ya.FeaturesMarkedEvent;ya.OptionsVisibilityChangeEvent;ya.PickEvent;ya.QueryChangeEvent;ya.ResponseEvent;ya.ReverseToggleEvent;function Jx(o){let e,t;return{c(){e=bs("svg"),t=bs("path"),Pe(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Pe(e,"viewBox","0 0 14 14"),Pe(e,"width","13"),Pe(e,"height","13"),Pe(e,"class","svelte-en2qvf")},m(n,l){J(n,e,l),F(e,t)},p:Ze,i:Ze,o:Ze,d(n){n&&X(e)}}}class b1 extends Wt{constructor(e){super(),Gt(this,e,null,Jx,Vt,{})}}function Yx(o){let e,t;return{c(){e=bs("svg"),t=bs("path"),Pe(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Pe(e,"viewBox","0 0 30 30"),Pe(e,"fill","none"),Pe(e,"xmlns","http://www.w3.org/2000/svg"),Pe(e,"class","svelte-d2loi5")},m(n,l){J(n,e,l),F(e,t)},p:Ze,i:Ze,o:Ze,d(n){n&&X(e)}}}class v1 extends Wt{constructor(e){super(),Gt(this,e,null,Yx,Vt,{})}}function Qx(o){let e,t;return{c(){e=ee("img"),Mr(e.src,t=o[3]+"area.svg")||Pe(e,"src",t),Pe(e,"alt",o[6]),Pe(e,"class","svelte-ltkwvy")},m(n,l){J(n,e,l)},p(n,l){l&8&&!Mr(e.src,t=n[3]+"area.svg")&&Pe(e,"src",t),l&64&&Pe(e,"alt",n[6])},d(n){n&&X(e)}}}function e2(o){let e,t;return{c(){e=ee("img"),Mr(e.src,t=o[3]+"reverse.svg")||Pe(e,"src",t),Pe(e,"alt",o[6]),Pe(e,"class","svelte-ltkwvy")},m(n,l){J(n,e,l)},p(n,l){l&8&&!Mr(e.src,t=n[3]+"reverse.svg")&&Pe(e,"src",t),l&64&&Pe(e,"alt",n[6])},d(n){n&&X(e)}}}function t2(o){let e,t;return{c(){e=ee("img"),Mr(e.src,t=o[3]+"poi.svg")||Pe(e,"src",t),Pe(e,"alt",o[6]),Pe(e,"class","svelte-ltkwvy")},m(n,l){J(n,e,l)},p(n,l){l&8&&!Mr(e.src,t=n[3]+"poi.svg")&&Pe(e,"src",t),l&64&&Pe(e,"alt",n[6])},d(n){n&&X(e)}}}function i2(o){let e,t;return{c(){e=ee("img"),Mr(e.src,t=o[3]+"postal_code.svg")||Pe(e,"src",t),Pe(e,"alt",o[6]),Pe(e,"class","svelte-ltkwvy")},m(n,l){J(n,e,l)},p(n,l){l&8&&!Mr(e.src,t=n[3]+"postal_code.svg")&&Pe(e,"src",t),l&64&&Pe(e,"alt",n[6])},d(n){n&&X(e)}}}function n2(o){let e,t;return{c(){e=ee("img"),Mr(e.src,t=o[3]+"street.svg")||Pe(e,"src",t),Pe(e,"alt",o[6]),Pe(e,"class","svelte-ltkwvy")},m(n,l){J(n,e,l)},p(n,l){l&8&&!Mr(e.src,t=n[3]+"street.svg")&&Pe(e,"src",t),l&64&&Pe(e,"alt",n[6])},d(n){n&&X(e)}}}function r2(o){let e,t;return{c(){e=ee("img"),Mr(e.src,t=o[3]+"road.svg")||Pe(e,"src",t),Pe(e,"alt",o[6]),Pe(e,"class","svelte-ltkwvy")},m(n,l){J(n,e,l)},p(n,l){l&8&&!Mr(e.src,t=n[3]+"road.svg")&&Pe(e,"src",t),l&64&&Pe(e,"alt",n[6])},d(n){n&&X(e)}}}function o2(o){let e,t;return{c(){e=ee("img"),Mr(e.src,t=o[3]+"housenumber.svg")||Pe(e,"src",t),Pe(e,"alt",o[6]),Pe(e,"class","svelte-ltkwvy")},m(n,l){J(n,e,l)},p(n,l){l&8&&!Mr(e.src,t=n[3]+"housenumber.svg")&&Pe(e,"src",t),l&64&&Pe(e,"alt",n[6])},d(n){n&&X(e)}}}function s2(o){let e,t,n,l;return{c(){e=ee("img"),Mr(e.src,t=o[5])||Pe(e,"src",t),Pe(e,"alt",o[4]),Pe(e,"class","svelte-ltkwvy")},m(u,d){J(u,e,d),n||(l=ft(e,"error",o[14]),n=!0)},p(u,d){d&32&&!Mr(e.src,t=u[5])&&Pe(e,"src",t),d&16&&Pe(e,"alt",u[4])},d(u){u&&X(e),n=!1,l()}}}function Sg(o){let e,t;return{c(){e=ee("span"),t=be(o[6]),Pe(e,"class","secondary svelte-ltkwvy")},m(n,l){J(n,e,l),F(e,t)},p(n,l){l&64&&pt(t,n[6])},d(n){n&&X(e)}}}function a2(o){let e,t,n,l,u,d,a,g,b,k=(o[7]?o[0].place_name:o[0].place_name.replace(/,.*/,""))+"",S,L,P=o[2]==="always"||o[2]!=="never"&&!o[0].address&&!o[0].id.startsWith("road.")&&!o[0].id.startsWith("address.")&&!o[0].id.startsWith("postal_code.")&&(!o[0].id.startsWith("poi.")||!o[5])&&!o[7],R,Z,$=(o[7]?"":o[0].place_name.replace(/[^,]*,?\s*/,""))+"",H,G,K;function le(Y,ue){return ue&1&&(t=null),ue&1&&(n=null),ue&1&&(l=null),ue&1&&(u=null),Y[5]?s2:Y[0].address?o2:(t==null&&(t=!!Y[0].id.startsWith("road.")),t?r2:(n==null&&(n=!!Y[0].id.startsWith("address.")),n?n2:(l==null&&(l=!!Y[0].id.startsWith("postal_code.")),l?i2:(u==null&&(u=!!Y[0].id.startsWith("poi.")),u?t2:Y[7]?e2:Qx))))}let Se=le(o,-1),Le=Se(o),te=P&&Sg(o);return{c(){e=ee("li"),Le.c(),d=we(),a=ee("span"),g=ee("span"),b=ee("span"),S=be(k),L=we(),te&&te.c(),R=we(),Z=ee("span"),H=be($),Pe(b,"class","primary svelte-ltkwvy"),Pe(g,"class","svelte-ltkwvy"),Pe(Z,"class","line2 svelte-ltkwvy"),Pe(a,"class","texts svelte-ltkwvy"),Pe(e,"tabindex","0"),Pe(e,"data-selected",o[1]),Pe(e,"class","svelte-ltkwvy"),cr(e,"selected",o[1])},m(Y,ue){J(Y,e,ue),Le.m(e,null),F(e,d),F(e,a),F(a,g),F(g,b),F(b,S),F(g,L),te&&te.m(g,null),F(a,R),F(a,Z),F(Z,H),G||(K=[ft(e,"mouseenter",o[12]),ft(e,"focus",o[13])],G=!0)},p(Y,[ue]){Se===(Se=le(Y,ue))&&Le?Le.p(Y,ue):(Le.d(1),Le=Se(Y),Le&&(Le.c(),Le.m(e,d))),ue&1&&k!==(k=(Y[7]?Y[0].place_name:Y[0].place_name.replace(/,.*/,""))+"")&&pt(S,k),ue&37&&(P=Y[2]==="always"||Y[2]!=="never"&&!Y[0].address&&!Y[0].id.startsWith("road.")&&!Y[0].id.startsWith("address.")&&!Y[0].id.startsWith("postal_code.")&&(!Y[0].id.startsWith("poi.")||!Y[5])&&!Y[7]),P?te?te.p(Y,ue):(te=Sg(Y),te.c(),te.m(g,null)):te&&(te.d(1),te=null),ue&1&&$!==($=(Y[7]?"":Y[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&pt(H,$),ue&2&&Pe(e,"data-selected",Y[1]),ue&2&&cr(e,"selected",Y[1])},i:Ze,o:Ze,d(Y){Y&&X(e),Le.d(),te&&te.d(),G=!1,an(K)}}}function l2(o,e,t){var K;let n,l,{feature:u}=e,{selected:d=!1}=e,{showPlaceType:a}=e,{missingIconsCache:g}=e,{iconsBaseUrl:b}=e;const k=(K=u.properties)==null?void 0:K.categories;let S,L,P=0,R=u.place_type[0]==="reverse";function Z(){L&&g.add(L),t(10,P++,P)}function $(le){zn.call(this,o,le)}function H(le){zn.call(this,o,le)}const G=()=>Z();return o.$$set=le=>{"feature"in le&&t(0,u=le.feature),"selected"in le&&t(1,d=le.selected),"showPlaceType"in le&&t(2,a=le.showPlaceType),"missingIconsCache"in le&&t(9,g=le.missingIconsCache),"iconsBaseUrl"in le&&t(3,b=le.iconsBaseUrl)},o.$$.update=()=>{var le,Se,Le,te;if(o.$$.dirty&3640)do t(11,n--,n),t(4,S=k==null?void 0:k[n]),t(5,L=S?b+S.replace(/ /g,"_")+".svg":void 0);while(n>-1&&(!L||g.has(L)));o.$$.dirty&1&&t(6,l=((Se=(le=u.properties)==null?void 0:le.categories)==null?void 0:Se.join(", "))??((te=(Le=u.properties)==null?void 0:Le.place_type_name)==null?void 0:te[0])??u.place_type[0])},t(11,n=(k==null?void 0:k.length)??0),[u,d,a,b,S,L,l,R,Z,g,P,n,$,H,G]}class c2 extends Wt{constructor(e){super(),Gt(this,e,l2,a2,Vt,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function u2(o){let e;return{c(){e=ee("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Pe(e,"class","svelte-7cmwmc")},m(t,n){J(t,e,n)},p:Ze,i:Ze,o:Ze,d(t){t&&X(e)}}}class h2 extends Wt{constructor(e){super(),Gt(this,e,null,u2,Vt,{})}}function d2(o){let e,t;return{c(){e=bs("svg"),t=bs("path"),Pe(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Pe(e,"viewBox","0 0 60.006 21.412"),Pe(e,"width","14"),Pe(e,"height","20"),Pe(e,"class","svelte-en2qvf")},m(n,l){J(n,e,l),F(e,t)},p:Ze,i:Ze,o:Ze,d(n){n&&X(e)}}}class f2 extends Wt{constructor(e){super(),Gt(this,e,null,d2,Vt,{})}}function p2(o){let e,t,n;return{c(){e=bs("svg"),t=bs("circle"),n=bs("path"),Pe(t,"cx","4.789"),Pe(t,"cy","4.787"),Pe(t,"r","3.85"),Pe(t,"class","svelte-1aq105l"),Pe(n,"d","M12.063 12.063 7.635 7.635"),Pe(n,"class","svelte-1aq105l"),Pe(e,"xmlns","http://www.w3.org/2000/svg"),Pe(e,"width","13"),Pe(e,"height","13"),Pe(e,"viewBox","0 0 13 13"),Pe(e,"class","svelte-1aq105l")},m(l,u){J(l,e,u),F(e,t),F(e,n)},p:Ze,i:Ze,o:Ze,d(l){l&&X(e)}}}class m2 extends Wt{constructor(e){super(),Gt(this,e,null,p2,Vt,{})}}function _2(o,e,t){const n=e[1],l=e[0],u=n-l;return o===n&&t?o:((o-l)%u+u)%u+l}function Tg(o){const e=[...o];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Pu;async function g2(o,e,t){const n=o==null?void 0:o.getCenterAndZoom();for(const l of e??[])if(!(n&&(l.minZoom!=null&&l.minZoom>n[0]||l.maxZoom!=null&&l.maxZoom<n[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(Pu&&l.cachedLocationExpiry&&Pu.time+l.cachedLocationExpiry>Date.now()){if(!Pu.coords)break e;return Pu.coords}let u;try{return u=await new Promise((d,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(g=>{d([g.coords.longitude,g.coords.latitude].map(b=>b.toFixed(6)).join(","))},g=>{a(g)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(Pu={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(n&&l.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const y2=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,Ig=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,Cg=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,Eg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,Lg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,Mg=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function b2(o){if(!["DMS","DM","DD"].includes(o))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(P=>Number(P.trim())),t=Number(e[0]),n=Number(e[1]),l=Math.abs(t),u=Math.abs(n),d=t>0?"N":"S",a=n>0?"E":"W";let g;o=="DD"&&(g=`${l}° ${d}, ${u}° ${a}`);const b=Math.floor(l),k=Math.floor(u),S=(l-b)*60,L=(u-k)*60;if(o=="DM"){let P=Ag(S,3).toFixed(3).padStart(6,"0"),R=Ag(L,3).toFixed(3).padStart(6,"0");P.endsWith(".000")&&R.endsWith(".000")&&(P=P.replace(/\.000$/,""),R=R.replace(/\.000$/,"")),g=`${b}° ${P}' ${d}, ${k}° ${R}' ${a}`}if(o=="DMS"){const P=Math.floor(S),R=Math.floor(L);let Z=((S-P)*60).toFixed(1).padStart(4,"0"),$=((L-R)*60).toFixed(1).padStart(4,"0");const H=P.toString().padStart(2,"0"),G=R.toString().padStart(2,"0");Z.endsWith(".0")&&$.endsWith(".0")&&(Z=Z.replace(/\.0$/,""),$=$.replace(/\.0$/,"")),g=`${b}° ${H}' ${Z}" ${d}, ${k}° ${G}' ${$}" ${a}`}return g}else throw new Error("no decimal coordinates to convert")}function Ag(o,e){const t=Math.pow(10,e);return Math.round((o+Number.EPSILON)*t)/t}function Vp(o,e){e||(e=5),o=o.replace(/\s+/g," ").trim();let t=null,n=null,l="",u="",d=null,a=[],g=!1;if(y2.test(o))throw new Error("invalid coordinate value");if(Ig.test(o))if(a=Ig.exec(o),g=zu(a),g)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),d="DM";else throw new Error("invalid coordinate format");else if(Cg.test(o))if(a=Cg.exec(o),g=zu(a),g){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),d="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(l=a[1],u=a[5]):a[4]&&(l=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if(Eg.test(o))if(a=Eg.exec(o),g=zu(a),g)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(l=a[1],u=a[8]):a[7]&&(l=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(Lg.test(o))if(a=Lg.exec(o),g=zu(a),g)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6]/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(Mg.test(o)){if(a=Mg.exec(o),g=zu(a),a.filter(b=>b).length<=5)throw new Error("invalid coordinates format");if(g)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(g){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let b=/S|SOUTH/i;b.test(l)&&t>0&&(t=-1*t),b=/W|WEST/i,b.test(u)&&n>0&&(n=-1*n);const k=a[0].trim();let S,L;const P=/[,/;\u0020]/g,R=k.match(P);if(R==null){const H=Math.floor(o.length/2);S=k.substring(0,H).trim(),L=k.substring(H).trim()}else{let H;R.length%2==1?H=Math.floor(R.length/2):H=R.length/2-1;let G=0;if(H==0)G=k.indexOf(R[0]),S=k.substring(0,G).trim(),L=k.substring(G+1).trim();else{let K=0,le=0;for(;K<=H;)G=k.indexOf(R[K],le),le=G+1,K++;S=k.substring(0,G).trim(),L=k.substring(G+1).trim()}}const Z=S.split(".");if(Z.length==2&&Z[1]==0&&Z[1].length!=2)throw new Error("invalid coordinates format");const $=L.split(".");if($.length==2&&$[1]==0&&$[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(L))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:k,verbatimLatitude:S,verbatimLongitude:L,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:d,closeEnough:v2,toCoordinateFormat:b2})}else throw new Error("coordinates pattern match failed")}function zu(o){if(!isNaN(o[0]))return!1;const e=[...o];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const d=e[u],a=e[u+l],g=t.test(d)&&t.test(a),b=n.test(d)&&n.test(a),k=d==a;if(!(d==null&&a==null)){if(d==null||a==null)return!1;if(g||b||k)continue;return!1}}return!0}function Pg(o,e){const t=Math.abs(o-e);return Number(t.toFixed(6))<=1e-5}function v2(o){if(!o)throw new Error("coords must be provided");if(o.includes(",")){const e=o.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return Pg(this.decimalLatitude,Number(e[0]))&&Pg(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const w2=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Vp.to=w2;const x2=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],k2={decimalLatitude:40.123,decimalLongitude:-74.123},S2=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],T2=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function I2(){const o=[];return x2.forEach(e=>{e.decimalLatitude?o.push(e):o.push({...e,...k2})}),[...o,...S2,...T2]}const C2=I2();Vp.formats=C2.map(o=>o.verbatimCoordinates);const E2=Vp;function zg(o,e,t){const n=o.slice();return n[84]=e[t],n[86]=t,n}function Dg(o){let e,t;return e=new h2({}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function Rg(o){let e,t,n,l,u;return t=new f2({}),{c(){e=ee("button"),Ve(t.$$.fragment),Pe(e,"type","button"),Pe(e,"title",o[9]),Pe(e,"class","svelte-bz0zu3"),cr(e,"active",o[0])},m(d,a){J(d,e,a),je(t,e,null),n=!0,l||(u=ft(e,"click",o[69]),l=!0)},p(d,a){(!n||a[0]&512)&&Pe(e,"title",d[9]),(!n||a[0]&1)&&cr(e,"active",d[0])},i(d){n||(ne(t.$$.fragment,d),n=!0)},o(d){he(t.$$.fragment,d),n=!1},d(d){d&&X(e),Ue(t),l=!1,u()}}}function L2(o){let e,t=[],n=new Map,l,u,d,a=bi(o[14]);const g=b=>b[84].id+(b[84].address?","+b[84].address:"");for(let b=0;b<a.length;b+=1){let k=zg(o,a,b),S=g(k);n.set(S,t[b]=Fg(S,k))}return{c(){e=ee("ul");for(let b=0;b<t.length;b+=1)t[b].c();Pe(e,"class","options svelte-bz0zu3")},m(b,k){J(b,e,k);for(let S=0;S<t.length;S+=1)t[S]&&t[S].m(e,null);l=!0,u||(d=[ft(e,"mouseleave",o[73]),ft(e,"blur",o[74])],u=!0)},p(b,k){k[0]&17880064&&(a=bi(b[14]),ui(),t=Qv(t,k,g,1,b,a,n,e,Yv,Fg,null,zg),hi())},i(b){if(!l){for(let k=0;k<a.length;k+=1)ne(t[k]);l=!0}},o(b){for(let k=0;k<t.length;k+=1)he(t[k]);l=!1},d(b){b&&X(e);for(let k=0;k<t.length;k+=1)t[k].d();u=!1,an(d)}}}function M2(o){let e,t,n,l,u,d;return t=new v1({}),{c(){e=ee("div"),Ve(t.$$.fragment),n=we(),l=ee("div"),u=be(o[7]),Pe(l,"class","svelte-bz0zu3"),Pe(e,"class","no-results svelte-bz0zu3")},m(a,g){J(a,e,g),je(t,e,null),F(e,n),F(e,l),F(l,u),d=!0},p(a,g){(!d||g[0]&128)&&pt(u,a[7])},i(a){d||(ne(t.$$.fragment,a),d=!0)},o(a){he(t.$$.fragment,a),d=!1},d(a){a&&X(e),Ue(t)}}}function A2(o){let e="",t;return{c(){t=be(e)},m(n,l){J(n,t,l)},p:Ze,i:Ze,o:Ze,d(n){n&&X(t)}}}function P2(o){let e,t,n,l,u,d,a,g,b,k,S;return t=new v1({}),g=new b1({}),{c(){e=ee("div"),Ve(t.$$.fragment),n=we(),l=ee("div"),u=be(o[6]),d=we(),a=ee("button"),Ve(g.$$.fragment),Pe(l,"class","svelte-bz0zu3"),Pe(a,"class","svelte-bz0zu3"),Pe(e,"class","error svelte-bz0zu3")},m(L,P){J(L,e,P),je(t,e,null),F(e,n),F(e,l),F(l,u),F(e,d),F(e,a),je(g,a,null),b=!0,k||(S=ft(a,"click",o[70]),k=!0)},p(L,P){(!b||P[0]&64)&&pt(u,L[6])},i(L){b||(ne(t.$$.fragment,L),ne(g.$$.fragment,L),b=!0)},o(L){he(t.$$.fragment,L),he(g.$$.fragment,L),b=!1},d(L){L&&X(e),Ue(t),Ue(g),k=!1,S()}}}function Fg(o,e){let t,n,l;function u(){return e[71](e[86])}function d(){return e[72](e[84])}return n=new c2({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",u),n.$on("focus",d),{key:o,first:null,c(){t=Ei(),Ve(n.$$.fragment),this.first=t},m(a,g){J(a,t,g),je(n,a,g),l=!0},p(a,g){e=a;const b={};g[0]&16384&&(b.feature=e[84]),g[0]&1024&&(b.showPlaceType=e[10]),g[0]&49152&&(b.selected=e[15]===e[86]),g[0]&4096&&(b.iconsBaseUrl=e[12]),n.$set(b)},i(a){l||(ne(n.$$.fragment,a),l=!0)},o(a){he(n.$$.fragment,a),l=!1},d(a){a&&X(t),Ue(n,a)}}}function z2(o){let e,t,n,l,u,d,a,g,b,k,S,L,P,R,Z,$,H,G,K,le,Se,Le=!1;u=new m2({}),S=new b1({});let te=o[19]&&Dg(),Y=o[5]==="button"&&Rg(o);const ue=o[61].default,fe=fn(ue,o,o[60],null),ce=[P2,A2,M2,L2],ae=[];function We(Ee,ze){var rt,it;return Ee[18]?0:Ee[16]?((rt=Ee[14])==null?void 0:rt.length)===0?2:Ee[16]&&((it=Ee[14])!=null&&it.length)?3:-1:1}return~($=We(o))&&(H=ae[$]=ce[$](o)),{c(){e=we(),t=ee("form"),n=ee("div"),l=ee("button"),Ve(u.$$.fragment),d=we(),a=ee("input"),g=we(),b=ee("div"),k=ee("button"),Ve(S.$$.fragment),L=we(),te&&te.c(),P=we(),Y&&Y.c(),R=we(),fe&&fe.c(),Z=we(),H&&H.c(),Pe(l,"class","search-button svelte-bz0zu3"),Pe(l,"type","button"),Pe(a,"placeholder",o[8]),Pe(a,"aria-label",o[8]),Pe(a,"class","svelte-bz0zu3"),Pe(k,"type","button"),Pe(k,"title",o[3]),Pe(k,"class","svelte-bz0zu3"),Pe(b,"class","clear-button-container svelte-bz0zu3"),cr(b,"displayable",o[1]!==""),Pe(n,"class","input-group svelte-bz0zu3"),Pe(t,"tabindex","0"),Pe(t,"class",G=kd(o[2])+" svelte-bz0zu3"),cr(t,"can-collapse",o[4]&&o[1]==="")},m(Ee,ze){J(Ee,e,ze),J(Ee,t,ze),F(t,n),F(n,l),je(u,l,null),F(n,d),F(n,a),o[63](a),Vi(a,o[1]),F(n,g),F(n,b),F(b,k),je(S,k,null),F(b,L),te&&te.m(b,null),F(n,P),Y&&Y.m(n,null),F(n,R),fe&&fe.m(n,null),F(t,Z),~$&&ae[$].m(t,null),K=!0,le||(Se=[ft(l,"click",o[62]),ft(a,"input",o[64]),ft(a,"focus",o[65]),ft(a,"blur",o[66]),ft(a,"keydown",o[22]),ft(a,"input",o[67]),ft(k,"click",o[68]),ft(t,"submit",ih(o[21]))],le=!0)},p(Ee,ze){(!K||ze[0]&256)&&Pe(a,"placeholder",Ee[8]),(!K||ze[0]&256)&&Pe(a,"aria-label",Ee[8]),ze[0]&2&&a.value!==Ee[1]&&Vi(a,Ee[1]),(!K||ze[0]&8)&&Pe(k,"title",Ee[3]),Ee[19]?te?ze[0]&524288&&ne(te,1):(te=Dg(),te.c(),ne(te,1),te.m(b,null)):te&&(ui(),he(te,1,1,()=>{te=null}),hi()),(!K||ze[0]&2)&&cr(b,"displayable",Ee[1]!==""),Ee[5]==="button"?Y?(Y.p(Ee,ze),ze[0]&32&&ne(Y,1)):(Y=Rg(Ee),Y.c(),ne(Y,1),Y.m(n,R)):Y&&(ui(),he(Y,1,1,()=>{Y=null}),hi()),fe&&fe.p&&(!K||ze[1]&536870912)&&mn(fe,ue,Ee,Ee[60],K?pn(ue,Ee[60],ze,null):_n(Ee[60]),null);let rt=$;$=We(Ee),$===rt?~$&&ae[$].p(Ee,ze):(H&&(ui(),he(ae[rt],1,1,()=>{ae[rt]=null}),hi()),~$?(H=ae[$],H?H.p(Ee,ze):(H=ae[$]=ce[$](Ee),H.c()),ne(H,1),H.m(t,null)):H=null),(!K||ze[0]&4&&G!==(G=kd(Ee[2])+" svelte-bz0zu3"))&&Pe(t,"class",G),(!K||ze[0]&22)&&cr(t,"can-collapse",Ee[4]&&Ee[1]==="")},i(Ee){K||(ne(Le),ne(u.$$.fragment,Ee),ne(S.$$.fragment,Ee),ne(te),ne(Y),ne(fe,Ee),ne(H),K=!0)},o(Ee){he(Le),he(u.$$.fragment,Ee),he(S.$$.fragment,Ee),he(te),he(Y),he(fe,Ee),he(H),K=!1},d(Ee){Ee&&(X(e),X(t)),Ue(u),o[63](null),Ue(S),te&&te.d(),Y&&Y.d(),fe&&fe.d(Ee),~$&&ae[$].d(),le=!1,an(Se)}}}function D2(o,e,t){let n,l,{$$slots:u={},$$scope:d}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:g=void 0}=e,{apiKey:b}=e,{bbox:k=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:L=!1}=e,{collapsed:P=!1}=e,{country:R=void 0}=e,{debounceSearch:Z=200}=e,{enableReverse:$="never"}=e,{errorMessage:H="Something went wrong…"}=e,{filter:G=()=>!0}=e,{flyTo:K=!0}=e,{fuzzyMatch:le=!0}=e,{language:Se=void 0}=e,{limit:Le=void 0}=e,{mapController:te=void 0}=e,{minLength:Y=2}=e,{noResultsMessage:ue="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:fe="Search"}=e,{proximity:ce=[{type:"server-geolocation"}]}=e,{reverseActive:ae=$==="always"}=e,{reverseButtonTitle:We="toggle reverse geocoding"}=e,{searchValue:Ee=""}=e,{pickedResultStyle:ze="full-geometry"}=e,{showPlaceType:rt="if-needed"}=e,{showResultsWhileTyping:it=!0}=e,{selectFirst:Qe=!0}=e,{flyToSelected:Ft=!1}=e,{markerOnSelected:jt=!0}=e,{types:ut=void 0}=e,{exhaustiveReverseGeocoding:et=!1}=e,{excludeTypes:at=!1}=e,{zoom:Bt=a}=e,{apiUrl:Dt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Ht={}}=e,{iconsBaseUrl:ai="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:si=()=>{}}=e;function Si(){Ie.focus()}function Ri(){Ie.blur()}function vi(j,Fe=!0,Ke=!1){t(1,Ee=j),Fe?(t(15,nt=-1),Yn()):(wn(!Ke,Ke),setTimeout(()=>{Ie.focus(),Ie.select()}))}function di(){t(14,st=void 0),t(56,mt=void 0),t(15,nt=-1)}function lt(){t(55,Te=[]),t(56,mt=void 0)}let qe=!1,st,Te,mt,yt="",Ie,nt=-1,Xt,wi=[],Ni,Li,gi,Fi;const _r=new Set,ct=pc();Lo(()=>{te&&(te.setEventHandler(void 0),te.indicateReverse(!1),te.setSelectedMarker(-1),te.setFeatures(void 0,void 0,!1))});function Yn(j){if(Li&&(clearTimeout(Li),Li=void 0),nt>-1&&st)t(56,mt=st[nt]),t(1,Ee=mt.place_type[0]==="reverse"?mt.place_name:mt.place_name.replace(/,.*/,"")),t(18,Xt=void 0),t(55,Te=void 0),t(15,nt=-1);else if(Ee){const Fe=j||!un(Ee);On(Ee,{exact:!0}).then(()=>{t(55,Te=st),t(56,mt=void 0),Fe&&qr()}).catch(Ke=>t(18,Xt=Ke))}}function un(j){try{return E2(j,6)}catch{return!1}}async function On(j,{byId:Fe=!1,exact:Ke=!1}={}){t(18,Xt=void 0),Ni==null||Ni.abort();const Ne=new AbortController;t(19,Ni=Ne);try{const Xe=un(j),_t=new URLSearchParams;if(Se!==void 0&&_t.set("language",Array.isArray(Se)?Se.join(","):Se??""),ut&&_t.set("types",ut.join(",")),at&&_t.set("excludeTypes",String(at)),k&&_t.set("bbox",k.map(ci=>ci.toFixed(6)).join(",")),R&&_t.set("country",Array.isArray(R)?R.join(","):R),!Fe&&!Xe){const ci=await g2(te,ce,Ne);ci&&_t.set("proximity",ci),(Ke||!it)&&_t.set("autocomplete","false"),_t.set("fuzzyMatch",String(le))}Le!==void 0&&(et||!Xe||(ut==null?void 0:ut.length)===1)&&_t.set("limit",String(Le)),_t.set("key",b),si(_t);const Et=Dt+"/"+encodeURIComponent(Xe?Xe.decimalLongitude+","+Xe.decimalLatitude:j)+".json?"+_t.toString();if(Et===yt){Fe?(t(14,st=void 0),t(56,mt=wi[0])):t(14,st=wi);return}yt=Et;const pi=await fetch(Et,{signal:Ne.signal,...Ht});if(!pi.ok)throw new Error(await pi.text());const Qt=await pi.json();ct("response",{url:Et,featureCollection:Qt}),Fe?(t(14,st=void 0),t(56,mt=Qt.features[0]),wi=[mt]):(t(14,st=Qt.features.filter(G)),Xe&&st.unshift({type:"Feature",properties:{},id:"reverse_"+Xe.decimalLongitude+"_"+Xe.decimalLatitude,text:Xe.decimalLatitude+", "+Xe.decimalLongitude,place_name:Xe.decimalLatitude+", "+Xe.decimalLongitude,place_type:["reverse"],center:[Xe.decimalLongitude,Xe.decimalLatitude],bbox:[Xe.decimalLongitude,Xe.decimalLatitude,Xe.decimalLongitude,Xe.decimalLatitude],geometry:{type:"Point",coordinates:[Xe.decimalLongitude,Xe.decimalLatitude]}}),wi=st,Xe&&Ie.focus())}catch(Xe){if(Xe&&typeof Xe=="object"&&"name"in Xe&&Xe.name==="AbortError")return;throw Xe}finally{Ne===Ni&&t(19,Ni=void 0)}}function qr(){var Ne;if(!(Te!=null&&Te.length)||!K)return;const j=[180,90,-180,-90],Fe=!Te.some(Xe=>!Xe.matching_text);let Ke;for(const Xe of Te){const _t=vt(Xe);if(Ke=Ke===void 0?_t:_t===void 0?Ke:Math.max(Ke,_t),Fe||!Xe.matching_text)for(const Et of[0,1,2,3])j[Et]=Math[Et<2?"min":"max"](j[Et],((Ne=Xe.bbox)==null?void 0:Ne[Et])??Xe.center[Et%2])}te&&Te.length>0&&(mt&&j[0]===j[2]&&j[1]===j[3]?te.flyTo(mt.center,vt(mt)):te.fitBounds(Tg(j),50,Ke))}function vt(j){var Ke;if(!j.bbox||j.bbox[0]!==j.bbox[2]&&j.bbox[1]!==j.bbox[3])return;const Fe=j.id.replace(/\..*/,"");return(Array.isArray((Ke=j.properties)==null?void 0:Ke.categories)?j.properties.categories.reduce((Ne,Xe)=>{const _t=Bt[Fe+"."+Xe];return Ne===void 0?_t:_t===void 0?Ne:Math.max(Ne,_t)},void 0):void 0)??Bt[Fe]}function li(j){t(0,ae=$==="always"),t(14,st=void 0),t(56,mt=void 0),t(15,nt=-1),vi(j[1].toFixed(6)+", "+_2(j[0],[-180,180],!0).toFixed(6),!1,!0)}function Jt(j){if(!st)return;let Fe=j.key==="ArrowDown"?1:j.key==="ArrowUp"?-1:0;Fe&&(nt===(Qe?0:-1)&&Fe===-1&&t(15,nt=st.length),t(15,nt+=Fe),nt>=st.length&&t(15,nt=-1),nt<0&&Qe&&t(15,nt=0),j.preventDefault())}function wn(j=!0,Fe=!1){if(t(18,Xt=void 0),it||Fe){if(Li&&clearTimeout(Li),Ee.length<Y)return;const Ke=Ee;Li=window.setTimeout(()=>{On(Ke).catch(Ne=>t(18,Xt=Ne))},j?Z:0)}else t(14,st=void 0),t(18,Xt=void 0)}function Dn(j){t(56,mt=j),t(1,Ee=j.place_name),t(15,nt=-1)}const ei=()=>Ie.focus();function gr(j){Ai[j?"unshift":"push"](()=>{Ie=j,t(17,Ie)})}function zr(){Ee=this.value,t(1,Ee),t(13,qe),t(28,L)}const Zr=()=>t(13,qe=!0),yr=()=>t(13,qe=!1),ye=()=>wn(),q=()=>{t(1,Ee=""),Ie.focus()},V=()=>t(0,ae=!ae),re=()=>t(18,Xt=void 0),pe=j=>t(15,nt=j),Me=j=>Dn(j),De=()=>{Qe||t(15,nt=-1)},$e=()=>{};return o.$$set=j=>{"class"in j&&t(2,g=j.class),"apiKey"in j&&t(26,b=j.apiKey),"bbox"in j&&t(27,k=j.bbox),"clearButtonTitle"in j&&t(3,S=j.clearButtonTitle),"clearOnBlur"in j&&t(28,L=j.clearOnBlur),"collapsed"in j&&t(4,P=j.collapsed),"country"in j&&t(29,R=j.country),"debounceSearch"in j&&t(30,Z=j.debounceSearch),"enableReverse"in j&&t(5,$=j.enableReverse),"errorMessage"in j&&t(6,H=j.errorMessage),"filter"in j&&t(31,G=j.filter),"flyTo"in j&&t(32,K=j.flyTo),"fuzzyMatch"in j&&t(33,le=j.fuzzyMatch),"language"in j&&t(34,Se=j.language),"limit"in j&&t(35,Le=j.limit),"mapController"in j&&t(36,te=j.mapController),"minLength"in j&&t(37,Y=j.minLength),"noResultsMessage"in j&&t(7,ue=j.noResultsMessage),"placeholder"in j&&t(8,fe=j.placeholder),"proximity"in j&&t(38,ce=j.proximity),"reverseActive"in j&&t(0,ae=j.reverseActive),"reverseButtonTitle"in j&&t(9,We=j.reverseButtonTitle),"searchValue"in j&&t(1,Ee=j.searchValue),"pickedResultStyle"in j&&t(39,ze=j.pickedResultStyle),"showPlaceType"in j&&t(10,rt=j.showPlaceType),"showResultsWhileTyping"in j&&t(40,it=j.showResultsWhileTyping),"selectFirst"in j&&t(11,Qe=j.selectFirst),"flyToSelected"in j&&t(41,Ft=j.flyToSelected),"markerOnSelected"in j&&t(42,jt=j.markerOnSelected),"types"in j&&t(43,ut=j.types),"exhaustiveReverseGeocoding"in j&&t(44,et=j.exhaustiveReverseGeocoding),"excludeTypes"in j&&t(45,at=j.excludeTypes),"zoom"in j&&t(46,Bt=j.zoom),"apiUrl"in j&&t(47,Dt=j.apiUrl),"fetchParameters"in j&&t(48,Ht=j.fetchParameters),"iconsBaseUrl"in j&&t(12,ai=j.iconsBaseUrl),"adjustUrlQuery"in j&&t(49,si=j.adjustUrlQuery),"$$scope"in j&&t(60,d=j.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&32&&t(0,ae=$==="always"),o.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,gi=qe),L&&!qe&&t(1,Ee="")}),o.$$.dirty[0]&16386|o.$$.dirty[1]&64&&Ee.length<Y&&(t(56,mt=void 0),t(14,st=void 0),t(18,Xt=void 0),t(55,Te=st)),o.$$.dirty[1]&33554688&&ze!=="marker-only"&&mt&&!mt.address&&mt.geometry.type==="Point"&&mt.place_type[0]!=="reverse"&&On(mt.id,{byId:!0}).catch(j=>t(18,Xt=j)),o.$$.dirty[1]&100663330&&(te&&mt&&mt.id!==Fi&&K&&(!mt.bbox||mt.bbox[0]===mt.bbox[2]&&mt.bbox[1]===mt.bbox[3]?te.flyTo(mt.center,vt(mt)):te.fitBounds(Tg(mt.bbox),50,vt(mt)),t(14,st=void 0),t(55,Te=void 0),t(15,nt=-1)),t(57,Fi=mt==null?void 0:mt.id)),o.$$.dirty[0]&18432&&Qe&&st!=null&&st.length&&t(15,nt=0),o.$$.dirty[0]&2&&t(15,nt=-1),o.$$.dirty[0]&16384|o.$$.dirty[1]&16777216&&Te!==st&&t(55,Te=void 0),o.$$.dirty[0]&81921|o.$$.dirty[1]&16777248&&te&&te.setEventHandler(j=>{switch(j.type){case"mapClick":ae&&li(j.coordinates);break;case"markerClick":{const Fe=st==null?void 0:st.find(Ke=>Ke.id===j.id);Fe&&Dn(Fe)}break;case"markerMouseEnter":Te&&t(15,nt=gi?(st==null?void 0:st.findIndex(Fe=>Fe.id===j.id))??-1:-1);break;case"markerMouseLeave":Te&&t(15,nt=-1);break}}),o.$$.dirty[0]&49152&&t(58,l=st==null?void 0:st[nt]),o.$$.dirty[1]&134218786&&te&&l&&K&&Ft&&te.flyTo(l.center,vt(l)),o.$$.dirty[1]&256&&t(59,n=ze==="full-geometry-including-polygon-center-marker"),o.$$.dirty[1]&268437536&&(jt||te==null||te.setFeatures(void 0,void 0,n)),o.$$.dirty[1]&419432480&&te&&jt&&!Te&&(te.setFeatures(l?[l]:void 0,void 0,n),te.setSelectedMarker(l?0:-1)),o.$$.dirty[1]&318767136&&te&&te.setFeatures(Te,mt,n),o.$$.dirty[0]&32768|o.$$.dirty[1]&16777248&&Te&&te&&te.setSelectedMarker(nt),o.$$.dirty[0]&2|o.$$.dirty[1]&32&&te){const j=un(Ee);te.setReverseMarker(j?[j.decimalLongitude,j.decimalLatitude]:void 0)}o.$$.dirty[1]&134217728&&ct("select",{feature:l}),o.$$.dirty[1]&33554432&&ct("pick",{feature:mt}),o.$$.dirty[0]&81920&&ct("optionsvisibilitychange",{optionsVisible:gi&&!!st}),o.$$.dirty[0]&16384&&ct("featureslisted",{features:st}),o.$$.dirty[1]&16777216&&ct("featuresmarked",{features:Te}),o.$$.dirty[0]&1&&ct("reversetoggle",{reverse:ae}),o.$$.dirty[0]&2&&ct("querychange",{query:Ee}),o.$$.dirty[0]&1|o.$$.dirty[1]&32&&te&&te.indicateReverse(ae)},[ae,Ee,g,S,P,$,H,ue,fe,We,rt,Qe,ai,qe,st,nt,gi,Ie,Xt,Ni,_r,Yn,Jt,wn,Dn,a,b,k,L,R,Z,G,K,le,Se,Le,te,Y,ce,ze,it,Ft,jt,ut,et,at,Bt,Dt,Ht,si,Si,Ri,vi,di,lt,Te,mt,Fi,l,n,d,u,ei,gr,zr,Zr,yr,ye,q,V,re,pe,Me,De,$e]}class R2 extends Wt{constructor(e){super(),Gt(this,e,D2,z2,Vt,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function Bg(o){let e,t,n;return t=new R2({props:{mapController:o[2],apiKey:o[0],country:o[1],proximity:[{type:"map-center"}]}}),{c(){e=ee("div"),Ve(t.$$.fragment),Pe(e,"class","svelte-ixhnie")},m(l,u){J(l,e,u),je(t,e,null),n=!0},p(l,u){const d={};u&4&&(d.mapController=l[2]),u&1&&(d.apiKey=l[0]),u&2&&(d.country=l[1]),t.$set(d)},i(l){n||(ne(t.$$.fragment,l),n=!0)},o(l){he(t.$$.fragment,l),n=!1},d(l){l&&X(e),Ue(t)}}}function F2(o){let e,t,n=o[2]&&Bg(o);return{c(){n&&n.c(),e=Ei()},m(l,u){n&&n.m(l,u),J(l,e,u),t=!0},p(l,[u]){l[2]?n?(n.p(l,u),u&4&&ne(n,1)):(n=Bg(l),n.c(),ne(n,1),n.m(e.parentNode,e)):n&&(ui(),he(n,1,1,()=>{n=null}),hi())},i(l){t||(ne(n),t=!0)},o(l){he(n),t=!1},d(l){l&&X(e),n&&n.d(l)}}}function B2(o,e,t){let n,{apiKey:l}=e,{map:u}=e,{country:d}=e;function a(g){return g?y1(g,Lr,!0,!0,{duration:1e3},{duration:1e3}):null}return o.$$set=g=>{"apiKey"in g&&t(0,l=g.apiKey),"map"in g&&t(3,u=g.map),"country"in g&&t(1,d=g.country)},o.$$.update=()=>{o.$$.dirty&8&&t(2,n=a(u))},[l,d,n,u]}class O2 extends Wt{constructor(e){super(),Gt(this,e,B2,F2,Vt,{apiKey:0,map:3,country:1})}}const Jl=[];function ap(o,e){return{subscribe:Mi(o,e).subscribe}}function Mi(o,e=Ze){let t;const n=new Set;function l(a){if(Vt(o,a)&&(o=a,t)){const g=!Jl.length;for(const b of n)b[1](),Jl.push(b,o);if(g){for(let b=0;b<Jl.length;b+=2)Jl[b][0](Jl[b+1]);Jl.length=0}}}function u(a){l(a(o))}function d(a,g=Ze){const b=[a,g];return n.add(b),n.size===1&&(t=e(l,u)||Ze),a(o),()=>{n.delete(b),n.size===0&&t&&(t(),t=null)}}return{set:l,update:u,subscribe:d}}const N2=Symbol.for("svelte-maplibre");function j2(){return Q0(N2)}function U2(o){return"layerType"in o&&o.layerType==="deckgl"}var Qu=$2;function $2(o){var e,t,n;if(o){if(Array.isArray(o)){for(e=[],t=o.length,n=0;n<t;n++){var l=o[n];l!=null&&e.push(l)}return e}if(typeof o=="object"){e={};var u=Object.keys(o);for(t=u.length,n=0;n<t;n++){var d=u[n],a=o[d];a!=null&&(e[d]=a)}return e}}}var Yl=qp;function qp(o,e){return o===e||o!==o&&e!==e?!0:typeof o!=typeof e||{}.toString.call(o)!={}.toString.call(e)||o!==Object(o)||!o?!1:Array.isArray(o)?Og(o,e):{}.toString.call(o)=="[object Set]"?Og(Array.from(o),Array.from(e)):{}.toString.call(o)=="[object Object]"?q2(o,e):V2(o,e)}function V2(o,e){return o.toString()===e.toString()}function Og(o,e){var t=o.length;if(t!=e.length)return!1;for(var n=0;n<t;n++)if(!qp(o[n],e[n]))return!1;return!0}function q2(o,e){var t=Object.keys(o),n=t.length;if(n!=Object.keys(e).length)return!1;for(var l=0;l<n;l++){var u=t[l];if(!(e.hasOwnProperty(u)&&qp(o[u],e[u])))return!1}return!0}const Z2=o=>({features:o[0]&16,data:o[0]&16,map:o[0]&4,close:o[0]&1}),Ng=o=>{var e;return{features:o[4],data:(e=o[4])==null?void 0:e[0],map:o[2],close:o[31]}};function jg(o){let e,t,n=(o[4]||o[3]instanceof Lr.Marker)&&Ug(o);return{c(){e=ee("div"),n&&n.c()},m(l,u){J(l,e,u),n&&n.m(e,null),o[32](e),t=!0},p(l,u){l[4]||l[3]instanceof Lr.Marker?n?(n.p(l,u),u[0]&24&&ne(n,1)):(n=Ug(l),n.c(),ne(n,1),n.m(e,null)):n&&(ui(),he(n,1,1,()=>{n=null}),hi())},i(l){t||(ne(n),t=!0)},o(l){he(n),t=!1},d(l){l&&X(e),n&&n.d(),o[32](null)}}}function Ug(o){let e;const t=o[30].default,n=fn(t,o,o[29],Ng);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u[0]&536870933)&&mn(n,t,l,l[29],e?pn(t,l[29],u,Z2):_n(l[29]),Ng)},i(l){e||(ne(n,l),e=!0)},o(l){he(n,l),e=!1},d(l){n&&n.d(l)}}}function G2(o){let e,t,n=o[9].default&&jg(o);return{c(){n&&n.c(),e=Ei()},m(l,u){n&&n.m(l,u),J(l,e,u),t=!0},p(l,u){l[9].default?n?(n.p(l,u),u[0]&512&&ne(n,1)):(n=jg(l),n.c(),ne(n,1),n.m(e.parentNode,e)):n&&(ui(),he(n,1,1,()=>{n=null}),hi())},i(l){t||(ne(n),t=!0)},o(l){he(n),t=!1},d(l){l&&X(e),n&&n.d(l)}}}function W2(o,e,t){let n,l,u,d,a,g,{$$slots:b={},$$scope:k}=e;const S=Gv(b);let{closeButton:L=void 0}=e,{closeOnClickOutside:P=!0}=e,{closeOnClickInside:R=!1}=e,{closeOnMove:Z=!1}=e,{openOn:$="click"}=e,{openIfTopMost:H=!0}=e,{focusAfterOpen:G=!0}=e,{anchor:K=void 0}=e,{offset:le=void 0}=e,{popupClass:Se=void 0}=e,{maxWidth:Le=void 0}=e,{lngLat:te=void 0}=e,{html:Y=void 0}=e,{open:ue=!1}=e;const fe=pc(),{map:ce,popupTarget:ae,layerEvent:We,layer:Ee,eventTopMost:ze}=j2();bt(o,ce,qe=>t(2,u=qe)),bt(o,ae,qe=>t(3,a=qe)),bt(o,We,qe=>t(28,d=qe)),bt(o,Ee,qe=>t(35,g=qe));const rt=["click","dblclick","contextmenu"];let it,Qe=!1,Ft;function jt(){if(!it)return;let qe=it.getElement();!qe||qe===Ft||(Ft=qe,$==="hover"&&(Ft.style.pointerEvents="none"),Ft.addEventListener("mouseenter",()=>{t(24,Qe=!0)},{passive:!0}),Ft.addEventListener("mouseleave",()=>{t(24,Qe=!1)},{passive:!0}),Ft.addEventListener("click",()=>{R&&t(0,ue=!1)},{passive:!0}))}fc(()=>{if(u)return u.on("click",Ri),u.on("contextmenu",Ri),typeof a=="string"&&(u.on("click",a,Bt),u.on("dblclick",a,Bt),u.on("contextmenu",a,Bt),u.on("mousemove",a,Si),u.on("mouseleave",a,si),u.on("touchstart",a,Ht),u.on("touchend",a,ai)),()=>{u!=null&&u.loaded()&&(it==null||it.remove(),u.off("click",Ri),u.off("contextmenu",Ri),a instanceof Lr.Marker?a.getPopup()===it&&a.setPopup(void 0):typeof a=="string"&&(u.off("click",a,Bt),u.off("dblclick",a,Bt),u.off("contextmenu",a,Bt),u.off("mousemove",a,Si),u.off("mouseleave",a,si),u.off("touchstart",a,Ht),u.off("touchend",a,ai)))}});function ut(qe){return H?!("marker"in qe)&&!U2(qe)&&ze(qe)!==g:!1}let et=null,at="normal";function Bt(qe){qe.type===$&&(ut(qe)||("layerType"in qe?qe.layerType==="deckgl"?(t(10,te=qe.coordinate),t(4,et=qe.object?[qe.object]:null)):(t(10,te=qe.lngLat),t(4,et=qe.features??[])):(t(10,te=qe.lngLat),t(4,et=qe.features??[])),setTimeout(()=>t(0,ue=!0))))}let Dt=null;function Ht(qe){Dt=qe.point}function ai(qe){if(!Dt||$!=="hover")return;let st=Dt.dist(qe.point);Dt=null,st<3&&(t(10,te=qe.lngLat),t(4,et=qe.features??[]),it.isOpen()?t(25,at="justOpened"):(t(25,at="opening"),t(0,ue=!0)))}function si(qe){$!=="hover"||Dt||at!=="normal"||(t(0,ue=!1),t(4,et=null))}function Si(qe){if(!($!=="hover"||Dt||at!=="normal")){if(ut(qe)){t(0,ue=!1),t(4,et=null);return}t(0,ue=!0),t(4,et=qe.features??[]),t(10,te=qe.lngLat)}}function Ri(qe){if(at==="justOpened"){t(25,at="normal");return}if(!P)return;let st=[Ft,a instanceof Lr.Marker?a==null?void 0:a.getElement():null];ue&&it.isOpen()&&!st.some(Te=>Te==null?void 0:Te.contains(qe.originalEvent.target))&&(qe.type==="contextmenu"&&$==="contextmenu"||qe.type!=="contextmenu")&&t(0,ue=!1)}Lo(()=>{u&&(it!=null&&it.isOpen())&&it.remove()});let vi;const di=()=>t(0,ue=!1);function lt(qe){Ai[qe?"unshift":"push"](()=>{vi=qe,t(1,vi)})}return o.$$set=qe=>{"closeButton"in qe&&t(11,L=qe.closeButton),"closeOnClickOutside"in qe&&t(12,P=qe.closeOnClickOutside),"closeOnClickInside"in qe&&t(13,R=qe.closeOnClickInside),"closeOnMove"in qe&&t(14,Z=qe.closeOnMove),"openOn"in qe&&t(15,$=qe.openOn),"openIfTopMost"in qe&&t(16,H=qe.openIfTopMost),"focusAfterOpen"in qe&&t(17,G=qe.focusAfterOpen),"anchor"in qe&&t(18,K=qe.anchor),"offset"in qe&&t(19,le=qe.offset),"popupClass"in qe&&t(20,Se=qe.popupClass),"maxWidth"in qe&&t(21,Le=qe.maxWidth),"lngLat"in qe&&t(10,te=qe.lngLat),"html"in qe&&t(22,Y=qe.html),"open"in qe&&t(0,ue=qe.open),"$$scope"in qe&&t(29,k=qe.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&14336&&t(27,n=L??(!P&&!R)),o.$$.dirty[0]&146685952&&(it||(t(23,it=new Lr.Popup({closeButton:n,closeOnClick:!1,closeOnMove:Z,focusAfterOpen:G,maxWidth:Le,className:Se,anchor:K,offset:le})),Ft=it.getElement(),it.on("open",()=>{t(0,ue=!0),jt(),fe("open",it)}),it.on("close",()=>{t(0,ue=!1),fe("close",it)}),it.on("hover",()=>{fe("hover",it)}))),o.$$.dirty[0]&8421384&&it&&a instanceof Lr.Marker&&($==="click"?a.setPopup(it):a.getPopup()===it&&a.setPopup(void 0)),o.$$.dirty[0]&268468224&&rt.includes($)&&(d==null?void 0:d.type)===$&&(Bt(d),oi(We,d=null,d)),o.$$.dirty[0]&268468224&&t(26,l=$==="hover"&&((d==null?void 0:d.type)==="mousemove"||(d==null?void 0:d.type)==="mouseenter")),o.$$.dirty[0]&352354304&&$==="hover"&&We&&(l&&d&&(d.layerType==="deckgl"?(t(10,te=d.coordinate),t(4,et=d.object?[d.object]:null)):(t(10,te=d.lngLat),t(4,et=d.features??[]))),t(0,ue=(l||Qe)??!1)),o.$$.dirty[0]&12582914&&(vi?it.setDOMContent(vi):Y&&it.setHTML(Y)),o.$$.dirty[0]&8389632&&te&&it.setLngLat(te),o.$$.dirty[0]&41943045&&u){let qe=it.isOpen();ue&&!qe?(it.addTo(u),at==="opening"&&t(25,at="justOpened")):!ue&&qe&&it.remove()}},[ue,vi,u,a,et,ce,ae,We,Ee,S,te,L,P,R,Z,$,H,G,K,le,Se,Le,Y,it,Qe,at,l,n,d,k,b,di,lt]}class H2 extends Wt{constructor(e){super(),Gt(this,e,W2,G2,Vt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var ac=Math.pow,Er=(o,e,t)=>new Promise((n,l)=>{var u=g=>{try{a(t.next(g))}catch(b){l(b)}},d=g=>{try{a(t.throw(g))}catch(b){l(b)}},a=g=>g.done?n(g.value):Promise.resolve(g.value).then(u,d);a((t=t.apply(o,e)).next())}),go=Uint8Array,nc=Uint16Array,X2=Int32Array,w1=new go([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),x1=new go([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),K2=new go([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),k1=function(o,e){for(var t=new nc(31),n=0;n<31;++n)t[n]=e+=1<<o[n-1];for(var l=new X2(t[30]),n=1;n<30;++n)for(var u=t[n];u<t[n+1];++u)l[u]=u-t[n]<<5|n;return{b:t,r:l}},S1=k1(w1,2),T1=S1.b,J2=S1.r;T1[28]=258,J2[258]=28;var Y2=k1(x1,0),Q2=Y2.b,kp=new nc(32768);for(Wi=0;Wi<32768;++Wi)ds=(Wi&43690)>>1|(Wi&21845)<<1,ds=(ds&52428)>>2|(ds&13107)<<2,ds=(ds&61680)>>4|(ds&3855)<<4,kp[Wi]=((ds&65280)>>8|(ds&255)<<8)>>1;var ds,Wi,Vu=function(o,e,t){for(var n=o.length,l=0,u=new nc(e);l<n;++l)o[l]&&++u[o[l]-1];var d=new nc(e);for(l=1;l<e;++l)d[l]=d[l-1]+u[l-1]<<1;var a;if(t){a=new nc(1<<e);var g=15-e;for(l=0;l<n;++l)if(o[l])for(var b=l<<4|o[l],k=e-o[l],S=d[o[l]-1]++<<k,L=S|(1<<k)-1;S<=L;++S)a[kp[S]>>g]=b}else for(a=new nc(n),l=0;l<n;++l)o[l]&&(a[l]=kp[d[o[l]-1]++]>>15-o[l]);return a},rh=new go(288);for(Wi=0;Wi<144;++Wi)rh[Wi]=8;var Wi;for(Wi=144;Wi<256;++Wi)rh[Wi]=9;var Wi;for(Wi=256;Wi<280;++Wi)rh[Wi]=7;var Wi;for(Wi=280;Wi<288;++Wi)rh[Wi]=8;var Wi,I1=new go(32);for(Wi=0;Wi<32;++Wi)I1[Wi]=5;var Wi,ek=Vu(rh,9,1),tk=Vu(I1,5,1),lp=function(o){for(var e=o[0],t=1;t<o.length;++t)o[t]>e&&(e=o[t]);return e},Fo=function(o,e,t){var n=e/8|0;return(o[n]|o[n+1]<<8)>>(e&7)&t},cp=function(o,e){var t=e/8|0;return(o[t]|o[t+1]<<8|o[t+2]<<16)>>(e&7)},ik=function(o){return(o+7)/8|0},nk=function(o,e,t){(e==null||e<0)&&(e=0),(t==null||t>o.length)&&(t=o.length);var n=new go(t-e);return n.set(o.subarray(e,t)),n},rk=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],mo=function(o,e,t){var n=new Error(e||rk[o]);if(n.code=o,Error.captureStackTrace&&Error.captureStackTrace(n,mo),!t)throw n;return n},Zp=function(o,e,t,n){var l=o.length,u=n?n.length:0;if(!l||e.f&&!e.l)return t||new go(0);var d=!t||e.i!=2,a=e.i;t||(t=new go(l*3));var g=function(Ri){var vi=t.length;if(Ri>vi){var di=new go(Math.max(vi*2,Ri));di.set(t),t=di}},b=e.f||0,k=e.p||0,S=e.b||0,L=e.l,P=e.d,R=e.m,Z=e.n,$=l*8;do{if(!L){b=Fo(o,k,1);var H=Fo(o,k+1,3);if(k+=3,H)if(H==1)L=ek,P=tk,R=9,Z=5;else if(H==2){var Se=Fo(o,k,31)+257,Le=Fo(o,k+10,15)+4,te=Se+Fo(o,k+5,31)+1;k+=14;for(var Y=new go(te),ue=new go(19),fe=0;fe<Le;++fe)ue[K2[fe]]=Fo(o,k+fe*3,7);k+=Le*3;for(var ce=lp(ue),ae=(1<<ce)-1,We=Vu(ue,ce,1),fe=0;fe<te;){var Ee=We[Fo(o,k,ae)];k+=Ee&15;var G=Ee>>4;if(G<16)Y[fe++]=G;else{var ze=0,rt=0;for(G==16?(rt=3+Fo(o,k,3),k+=2,ze=Y[fe-1]):G==17?(rt=3+Fo(o,k,7),k+=3):G==18&&(rt=11+Fo(o,k,127),k+=7);rt--;)Y[fe++]=ze}}var it=Y.subarray(0,Se),Qe=Y.subarray(Se);R=lp(it),Z=lp(Qe),L=Vu(it,R,1),P=Vu(Qe,Z,1)}else mo(1);else{var G=ik(k)+4,K=o[G-4]|o[G-3]<<8,le=G+K;if(le>l){a&&mo(0);break}d&&g(S+K),t.set(o.subarray(G,le),S),e.b=S+=K,e.p=k=le*8,e.f=b;continue}if(k>$){a&&mo(0);break}}d&&g(S+131072);for(var Ft=(1<<R)-1,jt=(1<<Z)-1,ut=k;;ut=k){var ze=L[cp(o,k)&Ft],et=ze>>4;if(k+=ze&15,k>$){a&&mo(0);break}if(ze||mo(2),et<256)t[S++]=et;else if(et==256){ut=k,L=null;break}else{var at=et-254;if(et>264){var fe=et-257,Bt=w1[fe];at=Fo(o,k,(1<<Bt)-1)+T1[fe],k+=Bt}var Dt=P[cp(o,k)&jt],Ht=Dt>>4;Dt||mo(3),k+=Dt&15;var Qe=Q2[Ht];if(Ht>3){var Bt=x1[Ht];Qe+=cp(o,k)&(1<<Bt)-1,k+=Bt}if(k>$){a&&mo(0);break}d&&g(S+131072);var ai=S+at;if(S<Qe){var si=u-Qe,Si=Math.min(Qe,ai);for(si+S<0&&mo(3);S<Si;++S)t[S]=n[si+S]}for(;S<ai;S+=4)t[S]=t[S-Qe],t[S+1]=t[S+1-Qe],t[S+2]=t[S+2-Qe],t[S+3]=t[S+3-Qe];S=ai}}e.l=L,e.p=ut,e.b=S,e.f=b,L&&(b=1,e.m=R,e.d=P,e.n=Z)}while(!b);return S==t.length?t:nk(t,0,S)},ok=new go(0),sk=function(o){(o[0]!=31||o[1]!=139||o[2]!=8)&&mo(6,"invalid gzip data");var e=o[3],t=10;e&4&&(t+=(o[10]|o[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!o[t++]);return t+(e&2)},ak=function(o){var e=o.length;return(o[e-4]|o[e-3]<<8|o[e-2]<<16|o[e-1]<<24)>>>0},lk=function(o,e){return((o[0]&15)!=8||o[0]>>4>7||(o[0]<<8|o[1])%31)&&mo(6,"invalid zlib data"),(o[1]>>5&1)==+!e&&mo(6,"invalid zlib data: "+(o[1]&32?"need":"unexpected")+" dictionary"),(o[1]>>3&4)+2};function ck(o,e){return Zp(o,{i:2},e&&e.out,e&&e.dictionary)}function uk(o,e){var t=sk(o);return t+8>o.length&&mo(6,"invalid gzip data"),Zp(o.subarray(t,-8),{i:2},e&&e.out||new go(ak(o)),e&&e.dictionary)}function hk(o,e){return Zp(o.subarray(lk(o,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Sp(o,e){return o[0]==31&&o[1]==139&&o[2]==8?uk(o,e):(o[0]&15)!=8||o[0]>>4>7||(o[0]<<8|o[1])%31?ck(o,e):hk(o,e)}var dk=typeof TextDecoder<"u"&&new TextDecoder,fk=0;try{dk.decode(ok,{stream:!0}),fk=1}catch{}var C1=(o,e)=>o*ac(2,e),Du=(o,e)=>Math.floor(o/ac(2,e)),Cd=(o,e)=>C1(o.getUint16(e+1,!0),8)+o.getUint8(e),E1=(o,e)=>C1(o.getUint32(e+2,!0),16)+o.getUint16(e,!0),pk=(o,e,t,n,l)=>{if(o!==n.getUint8(l))return o-n.getUint8(l);const u=Cd(n,l+1);if(e!==u)return e-u;const d=Cd(n,l+4);return t!==d?t-d:0},mk=(o,e,t,n)=>{const l=L1(o,e|128,t,n);return l?{z:e,x:t,y:n,offset:l[0],length:l[1],isDir:!0}:null},$g=(o,e,t,n)=>{const l=L1(o,e,t,n);return l?{z:e,x:t,y:n,offset:l[0],length:l[1],isDir:!1}:null},L1=(o,e,t,n)=>{let l=0,u=o.byteLength/17-1;for(;l<=u;){const d=u+l>>1,a=pk(e,t,n,o,d*17);if(a>0)l=d+1;else if(a<0)u=d-1;else return[E1(o,d*17+7),o.getUint32(d*17+13,!0)]}return null},_k=(o,e)=>o.isDir&&!e.isDir?1:!o.isDir&&e.isDir?-1:o.z!==e.z?o.z-e.z:o.x!==e.x?o.x-e.x:o.y-e.y,M1=(o,e)=>{const t=o.getUint8(e*17);return{z:t&127,x:Cd(o,e*17+1),y:Cd(o,e*17+4),offset:E1(o,e*17+7),length:o.getUint32(e*17+13,!0),isDir:t>>7===1}},Vg=o=>{const e=[],t=new DataView(o);for(let n=0;n<t.byteLength/17;n++)e.push(M1(t,n));return gk(e)},gk=o=>{o.sort(_k);const e=new ArrayBuffer(17*o.length),t=new Uint8Array(e);for(let n=0;n<o.length;n++){const l=o[n];let u=l.z;l.isDir&&(u=u|128),t[n*17]=u,t[n*17+1]=l.x&255,t[n*17+2]=l.x>>8&255,t[n*17+3]=l.x>>16&255,t[n*17+4]=l.y&255,t[n*17+5]=l.y>>8&255,t[n*17+6]=l.y>>16&255,t[n*17+7]=l.offset&255,t[n*17+8]=Du(l.offset,8)&255,t[n*17+9]=Du(l.offset,16)&255,t[n*17+10]=Du(l.offset,24)&255,t[n*17+11]=Du(l.offset,32)&255,t[n*17+12]=Du(l.offset,48)&255,t[n*17+13]=l.length&255,t[n*17+14]=l.length>>8&255,t[n*17+15]=l.length>>16&255,t[n*17+16]=l.length>>24&255}return e},yk=(o,e)=>{if(o.byteLength<17)return null;const t=o.byteLength/17,n=M1(o,t-1);if(n.isDir){const l=n.z,u=e.z-l,d=Math.trunc(e.x/(1<<u)),a=Math.trunc(e.y/(1<<u));return{z:l,x:d,y:a}}return null};function bk(o){return Er(this,null,function*(){const e=yield o.getBytes(0,512e3),t=new DataView(e.data),n=t.getUint32(4,!0),l=t.getUint16(8,!0),u=new TextDecoder("utf-8"),d=JSON.parse(u.decode(new DataView(e.data,10,n)));let a=0;d.compression==="gzip"&&(a=2);let g=0;"minzoom"in d&&(g=+d.minzoom);let b=0;"maxzoom"in d&&(b=+d.maxzoom);let k=0,S=0,L=0,P=-180,R=-85,Z=180,$=85;if(d.bounds){const G=d.bounds.split(",");P=+G[0],R=+G[1],Z=+G[2],$=+G[3]}if(d.center){const G=d.center.split(",");k=+G[0],S=+G[1],L=+G[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:l*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:g,maxZoom:b,minLon:P,minLat:R,maxLon:Z,maxLat:$,centerZoom:L,centerLon:k,centerLat:S,etag:e.etag}})}function vk(o,e,t,n,l,u,d){return Er(this,null,function*(){let a=yield t.getArrayBuffer(e,o.rootDirectoryOffset,o.rootDirectoryLength,o);o.specVersion===1&&(a=Vg(a));const g=$g(new DataView(a),n,l,u);if(g){let S=(yield e.getBytes(g.offset,g.length,d)).data;const L=new DataView(S);return L.getUint8(0)===31&&L.getUint8(1)===139&&(S=Sp(new Uint8Array(S))),{data:S}}const b=yk(new DataView(a),{z:n,x:l,y:u});if(b){const k=mk(new DataView(a),b.z,b.x,b.y);if(k){let S=yield t.getArrayBuffer(e,k.offset,k.length,o);o.specVersion===1&&(S=Vg(S));const L=$g(new DataView(S),n,l,u);if(L){let R=(yield e.getBytes(L.offset,L.length,d)).data;const Z=new DataView(R);return Z.getUint8(0)===31&&Z.getUint8(1)===139&&(R=Sp(new Uint8Array(R))),{data:R}}}}})}var A1={getHeader:bk,getZxy:vk},wk=o=>(e,t)=>{if(t instanceof AbortController)return o(e,t);const n=new AbortController;return o(e,n).then(l=>t(void 0,l.data,l.cacheControl||"",l.expires||""),l=>t(l)).catch(l=>t(l)),{cancel:()=>n.abort()}},xk=class{constructor(){this.tilev4=(o,e)=>Er(this,null,function*(){if(o.type==="json"){const S=o.url.substr(10);let L=this.tiles.get(S);L||(L=new qg(S),this.tiles.set(S,L));const P=yield L.getHeader();return{data:{tiles:[`${o.url}/{z}/{x}/{y}`],minzoom:P.minZoom,maxzoom:P.maxZoom,bounds:[P.minLon,P.minLat,P.maxLon,P.maxLat]}}}const t=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),n=o.url.match(t);if(!n)throw new Error("Invalid PMTiles protocol URL");const l=n[1];let u=this.tiles.get(l);u||(u=new qg(l),this.tiles.set(l,u));const d=n[2],a=n[3],g=n[4],b=yield u.getHeader(),k=yield u==null?void 0:u.getZxy(+d,+a,+g,e.signal);return k?{data:new Uint8Array(k.data),cacheControl:k.cacheControl,expires:k.expires}:b.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=wk(this.tilev4),this.tiles=new Map}add(o){this.tiles.set(o.source.getKey(),o)}get(o){return this.tiles.get(o)}};function Ql(o,e){return(e>>>0)*4294967296+(o>>>0)}function kk(o,e){const t=e.buf;let n=t[e.pos++],l=(n&112)>>4;if(n<128||(n=t[e.pos++],l|=(n&127)<<3,n<128)||(n=t[e.pos++],l|=(n&127)<<10,n<128)||(n=t[e.pos++],l|=(n&127)<<17,n<128)||(n=t[e.pos++],l|=(n&127)<<24,n<128)||(n=t[e.pos++],l|=(n&1)<<31,n<128))return Ql(o,l);throw new Error("Expected varint not more than 10 bytes")}function Ru(o){const e=o.buf;let t=e[o.pos++],n=t&127;return t<128||(t=e[o.pos++],n|=(t&127)<<7,t<128)||(t=e[o.pos++],n|=(t&127)<<14,t<128)||(t=e[o.pos++],n|=(t&127)<<21,t<128)?n:(t=e[o.pos],n|=(t&15)<<28,kk(n,o))}function Sk(o,e,t,n){if(n===0){t===1&&(e[0]=o-1-e[0],e[1]=o-1-e[1]);const l=e[0];e[0]=e[1],e[1]=l}}var Tk=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Ik(o,e,t){if(o>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>ac(2,o)-1||t>ac(2,o)-1)throw Error("tile x/y outside zoom level bounds");const n=Tk[o],l=ac(2,o);let u=0,d=0,a=0;const g=[e,t];let b=l/2;for(;b>0;)u=(g[0]&b)>0?1:0,d=(g[1]&b)>0?1:0,a+=b*b*(3*u^d),Sk(b,g,u,d),b=b/2;return n+a}function P1(o,e){return Er(this,null,function*(){if(e===1||e===0)return o;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Sp(new Uint8Array(o));const t=new Response(o).body;if(!t)throw Error("Failed to read response stream");const n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw Error("Compression method not supported")})}var Ck=127;function Ek(o,e){let t=0,n=o.length-1;for(;t<=n;){const l=n+t>>1,u=e-o[l].tileId;if(u>0)t=l+1;else if(u<0)n=l-1;else return o[l]}return n>=0&&(o[n].runLength===0||e-o[n].tileId<o[n].runLength)?o[n]:null}var Lk=class{constructor(o,e=new Headers){this.url=o,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(o){this.customHeaders=o}getBytes(o,e,t,n){return Er(this,null,function*(){let l,u;t?u=t:(l=new AbortController,u=l.signal);const d=new Headers(this.customHeaders);d.set("range",`bytes=${o}-${o+e-1}`);let a;this.mustReload&&(a="reload");let g=yield fetch(this.url,{signal:u,cache:a,headers:d});if(o===0&&g.status===416){const L=g.headers.get("Content-Range");if(!L||!L.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const P=+L.substr(8);g=yield fetch(this.url,{signal:u,cache:"reload",headers:{range:`bytes=0-${P-1}`}})}let b=g.headers.get("Etag");if(b!=null&&b.startsWith("W/")&&(b=null),g.status===416||n&&b&&b!==n)throw this.mustReload=!0,new Tp(`Server returned non-matching ETag ${n} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(g.status>=300)throw Error(`Bad response code: ${g.status}`);const k=g.headers.get("Content-Length");if(g.status===200&&(!k||+k>e))throw l&&l.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield g.arrayBuffer(),etag:b||void 0,cacheControl:g.headers.get("Cache-Control")||void 0,expires:g.headers.get("Expires")||void 0}})}};function Bo(o,e){const t=o.getUint32(e+4,!0),n=o.getUint32(e+0,!0);return t*ac(2,32)+n}function Mk(o,e){const t=new DataView(o),n=t.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:Bo(t,8),rootDirectoryLength:Bo(t,16),jsonMetadataOffset:Bo(t,24),jsonMetadataLength:Bo(t,32),leafDirectoryOffset:Bo(t,40),leafDirectoryLength:Bo(t,48),tileDataOffset:Bo(t,56),tileDataLength:Bo(t,64),numAddressedTiles:Bo(t,72),numTileEntries:Bo(t,80),numTileContents:Bo(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function z1(o){const e={buf:new Uint8Array(o),pos:0},t=Ru(e),n=[];let l=0;for(let u=0;u<t;u++){const d=Ru(e);n.push({tileId:l+d,offset:0,length:0,runLength:1}),l+=d}for(let u=0;u<t;u++)n[u].runLength=Ru(e);for(let u=0;u<t;u++)n[u].length=Ru(e);for(let u=0;u<t;u++){const d=Ru(e);d===0&&u>0?n[u].offset=n[u-1].offset+n[u-1].length:n[u].offset=d-1}return n}function Ak(o){const e=new DataView(o);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Tp=class extends Error{};function Pk(o,e){return Er(this,null,function*(){const t=yield o.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Ak(t.data)<3)return[yield A1.getHeader(o)];const l=t.data.slice(0,Ck),u=Mk(l,t.etag),d=t.data.slice(u.rootDirectoryOffset,u.rootDirectoryOffset+u.rootDirectoryLength),a=`${o.getKey()}|${u.etag||""}|${u.rootDirectoryOffset}|${u.rootDirectoryLength}`,g=z1(yield e(d,u.internalCompression));return[u,[a,g.length,g]]})}function zk(o,e,t,n,l){return Er(this,null,function*(){const u=yield o.getBytes(t,n,void 0,l.etag),d=yield e(u.data,l.internalCompression),a=z1(d);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var Dk=class{constructor(o=100,e=!0,t=P1){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=o,this.counter=1,this.decompress=t}getHeader(o){return Er(this,null,function*(){const e=o.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;const n=new Promise((l,u)=>{Pk(o,this.decompress).then(d=>{d[1]&&this.cache.set(d[1][0],{lastUsed:this.counter++,data:Promise.resolve(d[1][2])}),l(d[0]),this.prune()}).catch(d=>{u(d)})});return this.cache.set(e,{lastUsed:this.counter++,data:n}),n})}getDirectory(o,e,t,n){return Er(this,null,function*(){const l=`${o.getKey()}|${n.etag||""}|${e}|${t}`,u=this.cache.get(l);if(u)return u.lastUsed=this.counter++,yield u.data;const d=new Promise((a,g)=>{zk(o,this.decompress,e,t,n).then(b=>{a(b),this.prune()}).catch(b=>{g(b)})});return this.cache.set(l,{lastUsed:this.counter++,data:d}),d})}getArrayBuffer(o,e,t,n){return Er(this,null,function*(){const l=`${o.getKey()}|${n.etag||""}|${e}|${t}`,u=this.cache.get(l);if(u)return u.lastUsed=this.counter++,yield u.data;const d=new Promise((a,g)=>{o.getBytes(e,t,void 0,n.etag).then(b=>{a(b.data),this.cache.has(l),this.prune()}).catch(b=>{g(b)})});return this.cache.set(l,{lastUsed:this.counter++,data:d}),d})}prune(){if(this.cache.size>=this.maxCacheEntries){let o=1/0,e;this.cache.forEach((t,n)=>{t.lastUsed<o&&(o=t.lastUsed,e=n)}),e&&this.cache.delete(e)}}invalidate(o){return Er(this,null,function*(){const e=o.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(o.getKey());const t=new Promise((n,l)=>{this.getHeader(o).then(u=>{n(),this.invalidations.delete(e)}).catch(u=>{l(u)})});this.invalidations.set(e,t)})}},qg=class{constructor(o,e,t){typeof o=="string"?this.source=new Lk(o):this.source=o,t?this.decompress=t:this.decompress=P1,e?this.cache=e:this.cache=new Dk}getHeader(){return Er(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(o,e,t,n){return Er(this,null,function*(){const l=Ik(o,e,t),u=yield this.cache.getHeader(this.source);if(u.specVersion<3)return A1.getZxy(u,this.source,this.cache,o,e,t,n);if(o<u.minZoom||o>u.maxZoom)return;let d=u.rootDirectoryOffset,a=u.rootDirectoryLength;for(let g=0;g<=3;g++){const b=yield this.cache.getDirectory(this.source,d,a,u),k=Ek(b,l);if(k){if(k.runLength>0){const S=yield this.source.getBytes(u.tileDataOffset+k.offset,k.length,n,u.etag);return{data:yield this.decompress(S.data,u.tileCompression),cacheControl:S.cacheControl,expires:S.expires}}d=u.leafDirectoryOffset+k.offset,a=k.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(o,e,t,n){return Er(this,null,function*(){try{return yield this.getZxyAttempt(o,e,t,n)}catch(l){if(l instanceof Tp)return this.cache.invalidate(this.source),yield this.getZxyAttempt(o,e,t,n);throw l}})}getMetadataAttempt(){return Er(this,null,function*(){const o=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(o.jsonMetadataOffset,o.jsonMetadataLength,void 0,o.etag),t=yield this.decompress(e.data,o.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(t))})}getMetadata(){return Er(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(o){if(o instanceof Tp)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw o}})}};const Rk=o=>({props:o&8}),Zg=o=>({props:Ok(o[3])});function Fk(o){let e;const t=o[1].default,n=fn(t,o,o[2],Zg);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&12)&&mn(n,t,l,l[2],e?pn(t,l[2],u,Rk):_n(l[2]),Zg)},i(l){e||(ne(n,l),e=!0)},o(l){he(n,l),e=!1},d(l){n&&n.d(l)}}}function Bk(o){let e,t;return e=new H2({props:{openOn:o[0],$$slots:{default:[Fk,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.openOn=n[0]),l&12&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function Ok(o){return o?o[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function Nk(o,e,t){let{$$slots:n={},$$scope:l}=e,{openOn:u="hover"}=e;return o.$$set=d=>{"openOn"in d&&t(0,u=d.openOn),"$$scope"in d&&t(2,l=d.$$scope)},[u,n,l]}class mr extends Wt{constructor(e){super(),Gt(this,e,Nk,Bk,Vt,{openOn:0})}}function ba(o,e,t){let n=["match",o];for(let[l,u]of Object.entries(e))n.push(l),n.push(u);return n.push(t),n}function Ed(o,e,t){let n=["step",o];for(let l=1;l<e.length;l++)n.push(t[l-1]),n.push(e[l]);return n.push(t[t.length-1]),n}function lc(){return{type:"FeatureCollection",features:[]}}let jk=Date.now();function mc(o){return`${o}-${jk++}`}const Gp=Symbol.for("svelte-maplibre");function _c(){return Q0(Gp)}function Uk(o){let e=new WeakMap;return t=>{var d;let n=e.get(t.originalEvent);if(n!==void 0)return n;let u=(d=t.target.queryRenderedFeatures(t.point).find(a=>{var g;return(g=o.get(a.layer.id))==null?void 0:g.interactive}))==null?void 0:d.layer.id;return e.set(t.originalEvent,u),u}}function $k(){let o=new Map;return Y0(Gp,{map:Mi(null),source:ap(null),layer:ap(null),popupTarget:ap(null),cluster:Mi(),loadedImages:Mi(new Set),minzoom:Mi(0),maxzoom:Mi(24),layerEvent:Mi(null),layerInfo:o,eventTopMost:Uk(o),markerClickManager:new Zk})}function Gg(o){return{subscribe:o.subscribe}}function Wp({key:o,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let l=_c(),u=Mi(null),d=Gg(u),a={...l,[o]:Gg(u)};if(e&&(a.popupTarget=d),n){let g=Mi(null);a.layerEvent=g,l.layerEvent=g}return t&&(a.cluster=Mi()),Y0(Gp,a),{...l,self:u}}function D1(){return Wp({key:"source",setCluster:!0})}function Vk(o=!0){return Wp({key:"layer",setPopupTarget:o,setMouseEvent:o})}function qk(){return Wp({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}class Zk{constructor(){Eu(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function Wg(o){let e;return t=>{if(t)for(let n in t){let l=e==null?void 0:e[n],u=t[n];l!==u&&o(n,u,l)}else if(e)for(let n in e)o(n,void 0,e[n]);e=t}}function Gk(o,...e){let t=[o];for(let n of e)if(n)Array.isArray(n)&&n[0]===o?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function Wk(o){return o===!0?["has","point_count"]:o===!1?["!",["has","point_count"]]:void 0}function Jn(o,e){return["case",["boolean",["feature-state","hover"],!1],e,o]}function Hg(o){let e=o[0],t,n,l=Xg(o);return{c(){l.c(),t=Ei()},m(u,d){l.m(u,d),J(u,t,d),n=!0},p(u,d){d[0]&1&&Vt(e,e=u[0])?(ui(),he(l,1,1,Ze),hi(),l=Xg(u),l.c(),ne(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){n||(ne(l),n=!0)},o(u){he(l),n=!1},d(u){u&&X(t),l.d(u)}}}function Xg(o){let e;const t=o[36].default,n=fn(t,o,o[35],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u[1]&16)&&mn(n,t,l,l[35],e?pn(t,l[35],u,null):_n(l[35]),null)},i(l){e||(ne(n,l),e=!0)},o(l){he(n,l),e=!1},d(l){n&&n.d(l)}}}function Hk(o){let e,t,n=o[0]&&Hg(o);return{c(){n&&n.c(),e=Ei()},m(l,u){n&&n.m(l,u),J(l,e,u),t=!0},p(l,u){l[0]?n?(n.p(l,u),u[0]&1&&ne(n,1)):(n=Hg(l),n.c(),ne(n,1),n.m(e.parentNode,e)):n&&(ui(),he(n,1,1,()=>{n=null}),hi())},i(l){t||(ne(n),t=!0)},o(l){he(n),t=!1},d(l){l&&X(e),n&&n.d(l)}}}function Xk(o,e,t){let n,l,u,d,a,g,b,k,S,L,P,R,{$$slots:Z={},$$scope:$}=e,{id:H=mc("layer")}=e,{source:G=void 0}=e,{sourceLayer:K=void 0}=e,{beforeId:le=void 0}=e,{beforeLayerType:Se=void 0}=e,{type:Le}=e,{paint:te=void 0}=e,{layout:Y=void 0}=e,{filter:ue=void 0}=e,{applyToClusters:fe=void 0}=e,{minzoom:ce=void 0}=e,{maxzoom:ae=void 0}=e,{manageHoverState:We=!1}=e,{hovered:Ee=null}=e,{interactive:ze=!0}=e,{hoverCursor:rt=void 0}=e,{eventsIfTopMost:it=!1}=e;const Qe=pc(),{map:Ft,source:jt,self:ut,minzoom:et,maxzoom:at,eventTopMost:Bt,layerInfo:Dt}=Vk();bt(o,Ft,lt=>t(31,S=lt)),bt(o,jt,lt=>t(32,L=lt)),bt(o,ut,lt=>t(0,k=lt)),bt(o,et,lt=>t(34,R=lt)),bt(o,at,lt=>t(33,P=lt)),Lo(()=>{k&&S&&(Dt.delete(k),S==null||S.removeLayer(k))});let Ht;function ai(lt){var mt,yt;if(!ze||!k||!S||it&&Bt(lt)!==k)return;let qe=lt.features??[],st=(yt=(mt=qe[0])==null?void 0:mt.properties)==null?void 0:yt.cluster_id,Te={event:lt,map:S,clusterId:st,layer:k,source:a,features:qe};Qe(lt.type,Te)}function si(lt){var mt,yt;if(!ze||!k||!S||it&&Bt(lt)!==k)return;rt&&(S.getCanvas().style.cursor=rt);let qe=lt.features??[];t(6,Ee=qe[0]??null);let st=(yt=(mt=qe[0])==null?void 0:mt.properties)==null?void 0:yt.cluster_id;Qe("mouseenter",{event:lt,map:S,clusterId:st,layer:k,source:a,features:qe})}function Si(lt){var mt,yt,Ie;if(!ze||!S)return;if(it&&Bt(lt)!==k){t(6,Ee=null),We&&Ht!==void 0&&(S==null||S.setFeatureState({source:a,sourceLayer:K,id:Ht},{hover:!1}),Ht=void 0);return}S.getCanvas().style.cursor=rt;let qe=lt.features??[],st=(yt=(mt=qe[0])==null?void 0:mt.properties)==null?void 0:yt.cluster_id,Te=(Ie=qe[0])==null?void 0:Ie.id;Te!==Ht&&(We&&(Ht!==void 0&&(S==null||S.setFeatureState({source:a,id:Ht,sourceLayer:K},{hover:!1})),S==null||S.setFeatureState({source:a,id:Te,sourceLayer:K},{hover:!0})),Ht=Te,t(6,Ee=qe[0]??null)),Qe("mousemove",{event:lt,map:S,clusterId:st,layer:k,source:a,features:qe})}function Ri(lt){if(!(!ze||!k||!S)){if(rt&&(S.getCanvas().style.cursor=""),t(6,Ee=null),We&&Ht!==void 0){const qe={source:a,id:Ht,sourceLayer:K};S==null||S.setFeatureState(qe,{hover:!1}),Ht=void 0}Qe("mouseleave",{map:S,layer:k,source:a})}}let vi=!0;function di(lt){S&&(S.off("click",lt,ai),S.off("dblclick",lt,ai),S.off("contextmenu",lt,ai),S.off("mouseenter",lt,si),S.off("mousemove",lt,Si),S.off("mouseleave",lt,Ri))}return Lo(()=>{S&&k&&di(k)}),o.$$set=lt=>{"id"in lt&&t(7,H=lt.id),"source"in lt&&t(8,G=lt.source),"sourceLayer"in lt&&t(9,K=lt.sourceLayer),"beforeId"in lt&&t(10,le=lt.beforeId),"beforeLayerType"in lt&&t(11,Se=lt.beforeLayerType),"type"in lt&&t(12,Le=lt.type),"paint"in lt&&t(13,te=lt.paint),"layout"in lt&&t(14,Y=lt.layout),"filter"in lt&&t(15,ue=lt.filter),"applyToClusters"in lt&&t(16,fe=lt.applyToClusters),"minzoom"in lt&&t(17,ce=lt.minzoom),"maxzoom"in lt&&t(18,ae=lt.maxzoom),"manageHoverState"in lt&&t(19,We=lt.manageHoverState),"hovered"in lt&&t(6,Ee=lt.hovered),"interactive"in lt&&t(20,ze=lt.interactive),"hoverCursor"in lt&&t(21,rt=lt.hoverCursor),"eventsIfTopMost"in lt&&t(22,it=lt.eventsIfTopMost),"$$scope"in lt&&t(35,$=lt.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&65536&&t(30,n=Wk(fe)),o.$$.dirty[0]&1073774592&&t(24,l=Gk("all",n,ue)),o.$$.dirty[0]&131072|o.$$.dirty[1]&8&&t(26,u=ce??R),o.$$.dirty[0]&262144|o.$$.dirty[1]&4&&t(25,d=ae??P),o.$$.dirty[0]&256|o.$$.dirty[1]&2&&t(29,a=G||L),o.$$.dirty[0]&654343809|o.$$.dirty[1]&1&&S&&k!==H&&a){k&&(di(k),Dt.delete(k));let lt=le;if(!le&&Se){let qe=S.getStyle().layers,st=typeof Se=="function"?Se:mt=>mt.type===Se,Te=qe==null?void 0:qe.find(st);Te&&(lt=Te.id)}oi(ut,k=H,k),S.addLayer(Qu({id:k,type:Le,source:a,"source-layer":K,filter:l,paint:te,layout:Y,minzoom:u,maxzoom:d}),lt),t(23,vi=!0),S.on("click",k,ai),S.on("dblclick",k,ai),S.on("contextmenu",k,ai),S.on("mouseenter",k,si),S.on("mousemove",k,Si),S.on("mouseleave",k,Ri)}o.$$.dirty[0]&1048577&&k&&Dt.set(k,{interactive:ze}),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(28,g=k?Wg((lt,qe)=>S==null?void 0:S.setPaintProperty(k,lt,qe)):void 0),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(27,b=k?Wg((lt,qe)=>S==null?void 0:S.setLayoutProperty(k,lt,qe)):void 0),o.$$.dirty[0]&268443648&&(g==null||g(te)),o.$$.dirty[0]&134234112&&(b==null||b(Y)),o.$$.dirty[0]&100663297|o.$$.dirty[1]&1&&k&&(S==null||S.setLayerZoomRange(k,u,d)),o.$$.dirty[0]&25165825|o.$$.dirty[1]&1&&k&&(vi?t(23,vi=!1):S==null||S.setFilter(k,l))},[k,Ft,jt,ut,et,at,Ee,H,G,K,le,Se,Le,te,Y,ue,fe,ce,ae,We,ze,rt,it,vi,l,d,u,b,g,a,n,S,L,P,R,$,Z]}class Hp extends Wt{constructor(e){super(),Gt(this,e,Xk,Hk,Vt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function Kk(o){let e;const t=o[16].default,n=fn(t,o,o[24],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&16777216)&&mn(n,t,l,l[24],e?pn(t,l[24],u,null):_n(l[24]),null)},i(l){e||(ne(n,l),e=!0)},o(l){he(n,l),e=!1},d(l){n&&n.d(l)}}}function Jk(o){let e,t,n;function l(d){o[17](d)}let u={id:o[1],type:"circle",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],applyToClusters:o[9],minzoom:o[10],maxzoom:o[11],hoverCursor:o[12],manageHoverState:o[13],eventsIfTopMost:o[14],interactive:o[15],$$slots:{default:[Kk]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Hp({props:u}),Ai.push(()=>Zn(e,"hovered",l)),e.$on("click",o[18]),e.$on("dblclick",o[19]),e.$on("contextmenu",o[20]),e.$on("mouseenter",o[21]),e.$on("mousemove",o[22]),e.$on("mouseleave",o[23]),{c(){Ve(e.$$.fragment)},m(d,a){je(e,d,a),n=!0},p(d,[a]){const g={};a&2&&(g.id=d[1]),a&4&&(g.source=d[2]),a&8&&(g.sourceLayer=d[3]),a&16&&(g.beforeId=d[4]),a&32&&(g.beforeLayerType=d[5]),a&64&&(g.paint=d[6]),a&128&&(g.layout=d[7]),a&256&&(g.filter=d[8]),a&512&&(g.applyToClusters=d[9]),a&1024&&(g.minzoom=d[10]),a&2048&&(g.maxzoom=d[11]),a&4096&&(g.hoverCursor=d[12]),a&8192&&(g.manageHoverState=d[13]),a&16384&&(g.eventsIfTopMost=d[14]),a&32768&&(g.interactive=d[15]),a&16777216&&(g.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,g.hovered=d[0],qn(()=>t=!1)),e.$set(g)},i(d){n||(ne(e.$$.fragment,d),n=!0)},o(d){he(e.$$.fragment,d),n=!1},d(d){Ue(e,d)}}}function Yk(o,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=mc("circle")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:g=void 0}=e,{beforeLayerType:b=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:L=void 0}=e,{applyToClusters:P=void 0}=e,{minzoom:R=void 0}=e,{maxzoom:Z=void 0}=e,{hoverCursor:$=void 0}=e,{manageHoverState:H=!1}=e,{hovered:G=null}=e,{eventsIfTopMost:K=!1}=e,{interactive:le=!0}=e;function Se(ae){G=ae,t(0,G)}function Le(ae){zn.call(this,o,ae)}function te(ae){zn.call(this,o,ae)}function Y(ae){zn.call(this,o,ae)}function ue(ae){zn.call(this,o,ae)}function fe(ae){zn.call(this,o,ae)}function ce(ae){zn.call(this,o,ae)}return o.$$set=ae=>{"id"in ae&&t(1,u=ae.id),"source"in ae&&t(2,d=ae.source),"sourceLayer"in ae&&t(3,a=ae.sourceLayer),"beforeId"in ae&&t(4,g=ae.beforeId),"beforeLayerType"in ae&&t(5,b=ae.beforeLayerType),"paint"in ae&&t(6,k=ae.paint),"layout"in ae&&t(7,S=ae.layout),"filter"in ae&&t(8,L=ae.filter),"applyToClusters"in ae&&t(9,P=ae.applyToClusters),"minzoom"in ae&&t(10,R=ae.minzoom),"maxzoom"in ae&&t(11,Z=ae.maxzoom),"hoverCursor"in ae&&t(12,$=ae.hoverCursor),"manageHoverState"in ae&&t(13,H=ae.manageHoverState),"hovered"in ae&&t(0,G=ae.hovered),"eventsIfTopMost"in ae&&t(14,K=ae.eventsIfTopMost),"interactive"in ae&&t(15,le=ae.interactive),"$$scope"in ae&&t(24,l=ae.$$scope)},[G,u,d,a,g,b,k,S,L,P,R,Z,$,H,K,le,n,Se,Le,te,Y,ue,fe,ce,l]}class Xp extends Wt{constructor(e){super(),Gt(this,e,Yk,Jk,Vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Qk(o){let e;const t=o[15].default,n=fn(t,o,o[23],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&8388608)&&mn(n,t,l,l[23],e?pn(t,l[23],u,null):_n(l[23]),null)},i(l){e||(ne(n,l),e=!0)},o(l){he(n,l),e=!1},d(l){n&&n.d(l)}}}function e3(o){let e,t,n;function l(d){o[16](d)}let u={id:o[1],type:"fill",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[Qk]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Hp({props:u}),Ai.push(()=>Zn(e,"hovered",l)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Ve(e.$$.fragment)},m(d,a){je(e,d,a),n=!0},p(d,[a]){const g={};a&2&&(g.id=d[1]),a&4&&(g.source=d[2]),a&8&&(g.sourceLayer=d[3]),a&16&&(g.beforeId=d[4]),a&32&&(g.beforeLayerType=d[5]),a&64&&(g.paint=d[6]),a&128&&(g.layout=d[7]),a&256&&(g.filter=d[8]),a&512&&(g.minzoom=d[9]),a&1024&&(g.maxzoom=d[10]),a&2048&&(g.hoverCursor=d[11]),a&4096&&(g.manageHoverState=d[12]),a&8192&&(g.eventsIfTopMost=d[13]),a&16384&&(g.interactive=d[14]),a&8388608&&(g.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,g.hovered=d[0],qn(()=>t=!1)),e.$set(g)},i(d){n||(ne(e.$$.fragment,d),n=!0)},o(d){he(e.$$.fragment,d),n=!1},d(d){Ue(e,d)}}}function t3(o,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=mc("fill")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:g=void 0}=e,{beforeLayerType:b=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:L=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:Z=void 0}=e,{manageHoverState:$=!1}=e,{hovered:H=null}=e,{eventsIfTopMost:G=!1}=e,{interactive:K=!0}=e;function le(ce){H=ce,t(0,H)}function Se(ce){zn.call(this,o,ce)}function Le(ce){zn.call(this,o,ce)}function te(ce){zn.call(this,o,ce)}function Y(ce){zn.call(this,o,ce)}function ue(ce){zn.call(this,o,ce)}function fe(ce){zn.call(this,o,ce)}return o.$$set=ce=>{"id"in ce&&t(1,u=ce.id),"source"in ce&&t(2,d=ce.source),"sourceLayer"in ce&&t(3,a=ce.sourceLayer),"beforeId"in ce&&t(4,g=ce.beforeId),"beforeLayerType"in ce&&t(5,b=ce.beforeLayerType),"paint"in ce&&t(6,k=ce.paint),"layout"in ce&&t(7,S=ce.layout),"filter"in ce&&t(8,L=ce.filter),"minzoom"in ce&&t(9,P=ce.minzoom),"maxzoom"in ce&&t(10,R=ce.maxzoom),"hoverCursor"in ce&&t(11,Z=ce.hoverCursor),"manageHoverState"in ce&&t(12,$=ce.manageHoverState),"hovered"in ce&&t(0,H=ce.hovered),"eventsIfTopMost"in ce&&t(13,G=ce.eventsIfTopMost),"interactive"in ce&&t(14,K=ce.interactive),"$$scope"in ce&&t(23,l=ce.$$scope)},[H,u,d,a,g,b,k,S,L,P,R,Z,$,G,K,n,le,Se,Le,te,Y,ue,fe,l]}class gc extends Wt{constructor(e){super(),Gt(this,e,t3,e3,Vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function i3(o,e,t){let n;const{map:l}=_c();bt(o,l,g=>t(4,n=g));let{position:u="top-left"}=e,{container:d=void 0}=e,a=null;return Lo(()=>{n!=null&&n.loaded()&&a&&n.removeControl(a)}),o.$$set=g=>{"position"in g&&t(1,u=g.position),"container"in g&&t(2,d=g.container)},o.$$.update=()=>{if(o.$$.dirty&30&&n&&!a){let g;typeof d=="string"?g=document.querySelector(d)??void 0:g=d,t(3,a=new Lr.FullscreenControl({container:g})),n.addControl(a,u)}},[l,u,d,a,n]}class n3 extends Wt{constructor(e){super(),Gt(this,e,i3,null,Vt,{position:1,container:2})}}function R1(o,e,t,n,l){let u=!1;o.getSource(e)&&(u=!0,o.removeSource(e));const d=()=>{n(e)&&(o.addSource(e,t),l())};if(u){const a=()=>{e&&(o.getSource(e)?setTimeout(a,1):d())};a()}else d()}function F1(o,e,t){Xv().then(()=>{let n=xd(o);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function Kg(o){let e=o[0],t,n,l=Jg(o);return{c(){l.c(),t=Ei()},m(u,d){l.m(u,d),J(u,t,d),n=!0},p(u,d){d&1&&Vt(e,e=u[0])?(ui(),he(l,1,1,Ze),hi(),l=Jg(u),l.c(),ne(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){n||(ne(l),n=!0)},o(u){he(l),n=!1},d(u){u&&X(t),l.d(u)}}}function Jg(o){let e;const t=o[19].default,n=fn(t,o,o[18],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&262144)&&mn(n,t,l,l[18],e?pn(t,l[18],u,null):_n(l[18]),null)},i(l){e||(ne(n,l),e=!0)},o(l){he(n,l),e=!1},d(l){n&&n.d(l)}}}function r3(o){let e,t,n=o[0]&&Kg(o);return{c(){n&&n.c(),e=Ei()},m(l,u){n&&n.m(l,u),J(l,e,u),t=!0},p(l,[u]){l[0]?n?(n.p(l,u),u&1&&ne(n,1)):(n=Kg(l),n.c(),ne(n,1),n.m(e.parentNode,e)):n&&(ui(),he(n,1,1,()=>{n=null}),hi())},i(l){t||(ne(n),t=!0)},o(l){he(n),t=!1},d(l){l&&X(e),n&&n.d(l)}}}function o3(o,e,t){let n,l,u,{$$slots:d={},$$scope:a}=e,{id:g=mc("geojson")}=e,{data:b}=e,{generateId:k=!1}=e,{promoteId:S=void 0}=e,{filter:L=void 0}=e,{lineMetrics:P=void 0}=e,{cluster:R=void 0}=e,{maxzoom:Z=void 0}=e,{attribution:$=void 0}=e,{buffer:H=void 0}=e,{tolerance:G=void 0}=e;const{map:K,cluster:le,self:Se}=D1();bt(o,K,Y=>t(17,l=Y)),bt(o,le,Y=>t(20,u=Y)),bt(o,Se,Y=>t(0,n=Y));let Le,te=!0;return Lo(()=>{n&&Le&&l&&(F1(K,n,Le),oi(Se,n=null,n),t(15,Le=void 0))}),o.$$set=Y=>{"id"in Y&&t(4,g=Y.id),"data"in Y&&t(5,b=Y.data),"generateId"in Y&&t(6,k=Y.generateId),"promoteId"in Y&&t(7,S=Y.promoteId),"filter"in Y&&t(8,L=Y.filter),"lineMetrics"in Y&&t(9,P=Y.lineMetrics),"cluster"in Y&&t(10,R=Y.cluster),"maxzoom"in Y&&t(11,Z=Y.maxzoom),"attribution"in Y&&t(12,$=Y.attribution),"buffer"in Y&&t(13,H=Y.buffer),"tolerance"in Y&&t(14,G=Y.tolerance),"$$scope"in Y&&t(18,a=Y.$$scope)},o.$$.update=()=>{o.$$.dirty&1024&&oi(le,u=R,u),o.$$.dirty&196593&&l&&n!==g&&(oi(Se,n=g,n),R1(l,n,Qu({type:"geojson",data:b,filter:L,lineMetrics:P,generateId:k,promoteId:S,cluster:!!R,clusterMinPoints:R==null?void 0:R.minPoints,clusterMaxZoom:R==null?void 0:R.maxZoom,clusterRadius:R==null?void 0:R.radius,clusterProperties:R==null?void 0:R.properties,maxzoom:Z,attribution:$,buffer:H,tolerance:G}),Y=>l&&Y===n,()=>{n&&(t(15,Le=l==null?void 0:l.getSource(n)),t(16,te=!0))})),o.$$.dirty&131088&&(l==null||l.on("style.load",()=>{t(15,Le=l==null?void 0:l.getSource(g))})),o.$$.dirty&98336&&Le&&(te?t(16,te=!1):Le.setData(b)),o.$$.dirty&33792&&(Le==null||Le.setClusterOptions(Qu({cluster:!!R,clusterMaxZoom:R==null?void 0:R.maxZoom,clusterRadius:R==null?void 0:R.radius})))},[n,K,le,Se,g,b,k,S,L,P,R,Z,$,H,G,Le,te,l,a,d]}class bn extends Wt{constructor(e){super(),Gt(this,e,o3,r3,Vt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}}function s3(o,e,t){let n;const{map:l}=_c();bt(o,l,L=>t(8,n=L));let{position:u="top-left"}=e,{positionOptions:d=void 0}=e,{fitBoundsOptions:a=void 0}=e,{trackUserLocation:g=!1}=e,{showAccuracyCircle:b=!0}=e,{showUserLocation:k=!0}=e,{control:S=null}=e;return Lo(()=>{n!=null&&n.loaded()&&S&&n.removeControl(S)}),o.$$set=L=>{"position"in L&&t(2,u=L.position),"positionOptions"in L&&t(3,d=L.positionOptions),"fitBoundsOptions"in L&&t(4,a=L.fitBoundsOptions),"trackUserLocation"in L&&t(5,g=L.trackUserLocation),"showAccuracyCircle"in L&&t(6,b=L.showAccuracyCircle),"showUserLocation"in L&&t(7,k=L.showUserLocation),"control"in L&&t(1,S=L.control)},o.$$.update=()=>{o.$$.dirty&510&&n&&!S&&(t(1,S=new Lr.GeolocateControl({positionOptions:d,fitBoundsOptions:a,trackUserLocation:g,showAccuracyCircle:b,showUserLocation:k})),n.addControl(S,u))},[l,S,u,d,a,g,b,k,n]}class a3 extends Wt{constructor(e){super(),Gt(this,e,s3,null,Vt,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function l3(o){let e;const t=o[15].default,n=fn(t,o,o[23],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&8388608)&&mn(n,t,l,l[23],e?pn(t,l[23],u,null):_n(l[23]),null)},i(l){e||(ne(n,l),e=!0)},o(l){he(n,l),e=!1},d(l){n&&n.d(l)}}}function c3(o){let e,t,n;function l(d){o[16](d)}let u={id:o[1],type:"line",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[l3]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Hp({props:u}),Ai.push(()=>Zn(e,"hovered",l)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Ve(e.$$.fragment)},m(d,a){je(e,d,a),n=!0},p(d,[a]){const g={};a&2&&(g.id=d[1]),a&4&&(g.source=d[2]),a&8&&(g.sourceLayer=d[3]),a&16&&(g.beforeId=d[4]),a&32&&(g.beforeLayerType=d[5]),a&64&&(g.paint=d[6]),a&128&&(g.layout=d[7]),a&256&&(g.filter=d[8]),a&512&&(g.minzoom=d[9]),a&1024&&(g.maxzoom=d[10]),a&2048&&(g.hoverCursor=d[11]),a&4096&&(g.manageHoverState=d[12]),a&8192&&(g.eventsIfTopMost=d[13]),a&16384&&(g.interactive=d[14]),a&8388608&&(g.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,g.hovered=d[0],qn(()=>t=!1)),e.$set(g)},i(d){n||(ne(e.$$.fragment,d),n=!0)},o(d){he(e.$$.fragment,d),n=!1},d(d){Ue(e,d)}}}function u3(o,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=mc("line")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:g=void 0}=e,{beforeLayerType:b=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:L=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:Z=void 0}=e,{manageHoverState:$=!1}=e,{hovered:H=null}=e,{eventsIfTopMost:G=!1}=e,{interactive:K=!0}=e;function le(ce){H=ce,t(0,H)}function Se(ce){zn.call(this,o,ce)}function Le(ce){zn.call(this,o,ce)}function te(ce){zn.call(this,o,ce)}function Y(ce){zn.call(this,o,ce)}function ue(ce){zn.call(this,o,ce)}function fe(ce){zn.call(this,o,ce)}return o.$$set=ce=>{"id"in ce&&t(1,u=ce.id),"source"in ce&&t(2,d=ce.source),"sourceLayer"in ce&&t(3,a=ce.sourceLayer),"beforeId"in ce&&t(4,g=ce.beforeId),"beforeLayerType"in ce&&t(5,b=ce.beforeLayerType),"paint"in ce&&t(6,k=ce.paint),"layout"in ce&&t(7,S=ce.layout),"filter"in ce&&t(8,L=ce.filter),"minzoom"in ce&&t(9,P=ce.minzoom),"maxzoom"in ce&&t(10,R=ce.maxzoom),"hoverCursor"in ce&&t(11,Z=ce.hoverCursor),"manageHoverState"in ce&&t(12,$=ce.manageHoverState),"hovered"in ce&&t(0,H=ce.hovered),"eventsIfTopMost"in ce&&t(13,G=ce.eventsIfTopMost),"interactive"in ce&&t(14,K=ce.interactive),"$$scope"in ce&&t(23,l=ce.$$scope)},[H,u,d,a,g,b,k,S,L,P,R,Z,$,G,K,n,le,Se,Le,te,Y,ue,fe,l]}class vn extends Wt{constructor(e){super(),Gt(this,e,u3,c3,Vt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function h3(o,e,t){let n;const l=pc();let{layer:u=void 0}=e;const{map:d}=_c();bt(o,d,k=>t(2,n=k));function a(k){l(k.type,{...k,map:d})}const g=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],b=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Lo(()=>{if(n)if(u)for(const k of g)n.off(k,u,a);else for(const k of b)n.off(k,a)}),o.$$set=k=>{"layer"in k&&t(1,u=k.layer)},o.$$.update=()=>{if(o.$$.dirty&6&&n)if(u)for(const k of g)n.on(k,u,a);else for(const k of b)n.on(k,a)},[d,u,n]}class B1 extends Wt{constructor(e){super(),Gt(this,e,h3,null,Vt,{layer:1})}}function d3(o){let e=o.getCenter(),t=Math.round(o.getZoom()*100)/100,n=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),l=Math.pow(10,n),u=Math.round(e.lat*l)/l,d=Math.round(e.lng*l)/l,a=`${t}/${u}/${d}`,g=o.getBearing(),b=o.getPitch();return(g||b)&&(a+=`/${Math.round(g*10)/10}`),b&&(a+=`/${Math.round(b)}`),`#${a}`}function f3(o){return o.replace("#","").split("/").map(parseFloat)}function p3(o,e,t){let n;const{map:l}=_c();bt(o,l,k=>t(6,n=k));let{position:u="top-left"}=e,{showCompass:d=!0}=e,{showZoom:a=!0}=e,{visualizePitch:g=!1}=e,b=null;return Lo(()=>{n!=null&&n.loaded()&&b&&n.removeControl(b)}),o.$$set=k=>{"position"in k&&t(1,u=k.position),"showCompass"in k&&t(2,d=k.showCompass),"showZoom"in k&&t(3,a=k.showZoom),"visualizePitch"in k&&t(4,g=k.visualizePitch)},o.$$.update=()=>{o.$$.dirty&126&&n&&!b&&(t(5,b=new Lr.NavigationControl({showCompass:d,showZoom:a,visualizePitch:g})),n.addControl(b,u))},[l,u,d,a,g,b,n]}class m3 extends Wt{constructor(e){super(),Gt(this,e,p3,null,Vt,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function _3(o,e,t){let n;const{map:l}=_c();bt(o,l,b=>t(5,n=b));let{position:u="bottom-left"}=e,{maxWidth:d=void 0}=e,{unit:a="metric"}=e,g=null;return Lo(()=>{n!=null&&n.loaded()&&g&&n.removeControl(g)}),o.$$set=b=>{"position"in b&&t(1,u=b.position),"maxWidth"in b&&t(2,d=b.maxWidth),"unit"in b&&t(3,a=b.unit)},o.$$.update=()=>{o.$$.dirty&62&&n&&!g&&(t(4,g=new Lr.ScaleControl({maxWidth:d,unit:a})),n.addControl(g,u))},[l,u,d,a,g,n]}class g3 extends Wt{constructor(e){super(),Gt(this,e,_3,null,Vt,{position:1,maxWidth:2,unit:3})}}const{window:y3}=J0,b3=o=>({map:o[0]&16,loadedImages:o[0]&32,allImagesLoaded:o[0]&64}),Yg=o=>({map:o[4],loadedImages:o[5],allImagesLoaded:o[6]});function Qg(o){let e,t,n=o[3]&&ey(o);const l=o[46].default,u=fn(l,o,o[45],Yg);return{c(){n&&n.c(),e=we(),u&&u.c()},m(d,a){n&&n.m(d,a),J(d,e,a),u&&u.m(d,a),t=!0},p(d,a){d[3]?n?(n.p(d,a),a[0]&8&&ne(n,1)):(n=ey(d),n.c(),ne(n,1),n.m(e.parentNode,e)):n&&(ui(),he(n,1,1,()=>{n=null}),hi()),u&&u.p&&(!t||a[0]&112|a[1]&16384)&&mn(u,l,d,d[45],t?pn(l,d[45],a,b3):_n(d[45]),Yg)},i(d){t||(ne(n),ne(u,d),t=!0)},o(d){he(n),he(u,d),t=!1},d(d){d&&X(e),n&&n.d(d),u&&u.d(d)}}}function ey(o){let e,t,n,l,u,d,a,g;return e=new m3({props:{position:o[7]}}),n=new a3({props:{position:o[7],fitBoundsOptions:{maxZoom:12}}}),u=new n3({props:{position:o[7]}}),a=new g3({props:{position:o[7]}}),{c(){Ve(e.$$.fragment),t=we(),Ve(n.$$.fragment),l=we(),Ve(u.$$.fragment),d=we(),Ve(a.$$.fragment)},m(b,k){je(e,b,k),J(b,t,k),je(n,b,k),J(b,l,k),je(u,b,k),J(b,d,k),je(a,b,k),g=!0},p(b,k){const S={};k[0]&128&&(S.position=b[7]),e.$set(S);const L={};k[0]&128&&(L.position=b[7]),n.$set(L);const P={};k[0]&128&&(P.position=b[7]),u.$set(P);const R={};k[0]&128&&(R.position=b[7]),a.$set(R)},i(b){g||(ne(e.$$.fragment,b),ne(n.$$.fragment,b),ne(u.$$.fragment,b),ne(a.$$.fragment,b),g=!0)},o(b){he(e.$$.fragment,b),he(n.$$.fragment,b),he(u.$$.fragment,b),he(a.$$.fragment,b),g=!1},d(b){b&&(X(t),X(l),X(d)),Ue(e,b),Ue(n,b),Ue(u,b),Ue(a,b)}}}function v3(o){let e,t,n,l,u,d=o[4]&&o[0]&&Qg(o);return{c(){e=ee("div"),d&&d.c(),Pe(e,"class",t=kd(o[2])+" svelte-p00lfq"),Pe(e,"data-testid","map-container"),cr(e,"expand-map",!o[2])},m(a,g){J(a,e,g),d&&d.m(e,null),o[47](e),n=!0,l||(u=[ft(y3,"hashchange",o[11]),dp(o[10].call(null,e))],l=!0)},p(a,g){a[4]&&a[0]?d?(d.p(a,g),g[0]&17&&ne(d,1)):(d=Qg(a),d.c(),ne(d,1),d.m(e,null)):d&&(ui(),he(d,1,1,()=>{d=null}),hi()),(!n||g[0]&4&&t!==(t=kd(a[2])+" svelte-p00lfq"))&&Pe(e,"class",t),(!n||g[0]&4)&&cr(e,"expand-map",!a[2])},i(a){n||(ne(d),n=!0)},o(a){he(d),n=!1},d(a){a&&X(e),d&&d.d(),o[47](null),l=!1,an(u)}}}function w3(o,e,t){let n,l,u,d,{$$slots:a={},$$scope:g}=e,{map:b=null}=e,{mapContainer:k=void 0}=e,{class:S=void 0}=e,{style:L}=e,{diffStyleUpdates:P=!1}=e,{center:R=void 0}=e,{zoom:Z=void 0}=e,{pitch:$=0}=e,{bearing:H=0}=e,{bounds:G=void 0}=e,{hash:K=!1}=e,{updateHash:le=Ie=>{window.history.replaceState(window.history.state,"",Ie)}}=e,{loaded:Se=!1}=e,{minZoom:Le=0}=e,{maxZoom:te=22}=e,{minPitch:Y=0}=e,{maxPitch:ue=60}=e,{renderWorldCopies:fe=void 0}=e,{dragPan:ce=void 0}=e,{dragRotate:ae=void 0}=e,{pitchWithRotate:We=void 0}=e,{antialias:Ee=void 0}=e,{zoomOnDoubleClick:ze=!0}=e,{locale:rt=void 0}=e,{interactive:it=!0}=e,{attributionControl:Qe=!0}=e,{cooperativeGestures:Ft=!1}=e,{preserveDrawingBuffer:jt=!1}=e,{maxBounds:ut=void 0}=e,{images:et=[]}=e,{standardControls:at=!1}=e,{filterLayers:Bt=void 0}=e,{transformRequest:Dt=void 0}=e;const Ht=pc(),{map:ai,loadedImages:si}=$k();bt(o,ai,Ie=>t(4,u=Ie)),bt(o,si,Ie=>t(5,d=Ie));let Si=new Set;async function Ri(Ie,nt=!1){if(u&&!(!u.loaded()&&!nt))if("url"in Ie){Si.add(Ie.id);try{let Xt=await u.loadImage(Ie.url);u==null||u.addImage(Ie.id,Xt.data,Ie.options),d.add(Ie.id),si.set(d)}catch(Xt){Ht("error",Xt)}finally{Si.delete(Ie.id)}}else u.addImage(Ie.id,Ie.data,Ie.options),d.add(Ie.id),si.set(d)}let vi,di,lt,qe;function st(Ie){return mt(),oi(ai,u=new Lr.Map(Qu({container:Ie,style:L,locale:rt,center:R,zoom:Z,pitch:$,bearing:H,minZoom:Le,maxZoom:te,minPitch:Y,maxPitch:ue,renderWorldCopies:fe,dragPan:ce,dragRotate:ae,pitchWithRotate:We,antialias:Ee,interactive:it,preserveDrawingBuffer:jt,maxBounds:ut,bounds:G,attributionControl:Qe,transformRequest:Dt,cooperativeGestures:Ft})),u),u.on("load",nt=>{nt.target.getContainer().setAttribute("data-testid","map"),nt.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,Se=!0),Ht("load",u)}),u.on("error",nt=>Ht("error",{...nt,map:u})),u.on("movestart",nt=>Ht("movestart",{...nt,map:u})),u.on("moveend",nt=>{if(t(12,R=nt.target.getCenter()),t(13,Z=nt.target.getZoom()),t(14,$=nt.target.getPitch()),t(15,H=nt.target.getBearing()),t(16,G=nt.target.getBounds()),Ht("moveend",{...nt,map:u}),K){let Xt=new URL(window.location.href.replace(/(#.+)?$/,d3(u)));le(Xt)}}),u.on("click",nt=>Ht("click",{...nt,map:u})),u.on("dblclick",nt=>Ht("dblclick",{...nt,map:u})),u.on("contextmenu",nt=>Ht("contextmenu",{...nt,map:u})),u.on("zoomstart",nt=>Ht("zoomstart",{...nt,map:u})),u.on("zoom",nt=>{Ht("zoom",{...nt,map:u})}),u.on("zoomend",nt=>{Ht("zoomend",{...nt,map:u})}),u.on("style.load",()=>{if(u){const nt=u.getStyle();if(t(42,vi=nt.layers.map(Xt=>Xt.id)),t(43,di=Object.keys(nt.sources)),qe)for(const[Xt,wi]of Object.entries(qe))u.addSource(Xt,wi);if(lt)for(const Xt of lt)u.addLayer(Xt);for(const Xt of et)Ri(Xt,!0)}}),u.on("styledata",nt=>{if(u&&Bt){const Xt=u.getStyle().layers;if(Xt)for(let wi of Xt)Bt(wi)||u.setLayoutProperty(wi.id,"visibility","none")}Ht("styledata",{...nt,map:u})}),{destroy(){t(0,Se=!1),u==null||u.remove(),oi(ai,u=null,u)}}}let Te=L;function mt(){if(K){let Ie=f3(window.location.hash);Ie.length>=3&&(t(13,Z=Ie[0]),t(12,R=[Ie[2],Ie[1]])),Ie.length==5&&(t(15,H=Ie[3]),t(14,$=Ie[4]))}}function yt(Ie){Ai[Ie?"unshift":"push"](()=>{k=Ie,t(1,k)})}return o.$$set=Ie=>{"map"in Ie&&t(17,b=Ie.map),"mapContainer"in Ie&&t(1,k=Ie.mapContainer),"class"in Ie&&t(2,S=Ie.class),"style"in Ie&&t(18,L=Ie.style),"diffStyleUpdates"in Ie&&t(19,P=Ie.diffStyleUpdates),"center"in Ie&&t(12,R=Ie.center),"zoom"in Ie&&t(13,Z=Ie.zoom),"pitch"in Ie&&t(14,$=Ie.pitch),"bearing"in Ie&&t(15,H=Ie.bearing),"bounds"in Ie&&t(16,G=Ie.bounds),"hash"in Ie&&t(20,K=Ie.hash),"updateHash"in Ie&&t(21,le=Ie.updateHash),"loaded"in Ie&&t(0,Se=Ie.loaded),"minZoom"in Ie&&t(22,Le=Ie.minZoom),"maxZoom"in Ie&&t(23,te=Ie.maxZoom),"minPitch"in Ie&&t(24,Y=Ie.minPitch),"maxPitch"in Ie&&t(25,ue=Ie.maxPitch),"renderWorldCopies"in Ie&&t(26,fe=Ie.renderWorldCopies),"dragPan"in Ie&&t(27,ce=Ie.dragPan),"dragRotate"in Ie&&t(28,ae=Ie.dragRotate),"pitchWithRotate"in Ie&&t(29,We=Ie.pitchWithRotate),"antialias"in Ie&&t(30,Ee=Ie.antialias),"zoomOnDoubleClick"in Ie&&t(31,ze=Ie.zoomOnDoubleClick),"locale"in Ie&&t(32,rt=Ie.locale),"interactive"in Ie&&t(33,it=Ie.interactive),"attributionControl"in Ie&&t(34,Qe=Ie.attributionControl),"cooperativeGestures"in Ie&&t(35,Ft=Ie.cooperativeGestures),"preserveDrawingBuffer"in Ie&&t(36,jt=Ie.preserveDrawingBuffer),"maxBounds"in Ie&&t(37,ut=Ie.maxBounds),"images"in Ie&&t(38,et=Ie.images),"standardControls"in Ie&&t(3,at=Ie.standardControls),"filterLayers"in Ie&&t(39,Bt=Ie.filterLayers),"transformRequest"in Ie&&t(40,Dt=Ie.transformRequest),"$$scope"in Ie&&t(45,g=Ie.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&8&&t(7,n=typeof at=="boolean"?void 0:at),o.$$.dirty[0]&16&&t(17,b=u),o.$$.dirty[0]&786448|o.$$.dirty[1]&14336&&u&&!Yl(L,Te)){const Ie=u.getStyle();if(vi&&(lt=Ie.layers.filter(nt=>!vi.includes(nt.id))),di){const nt=Object.keys(Ie.sources).filter(Xt=>!di.includes(Xt));qe={};for(const Xt of nt)qe[Xt]=Ie.sources[Xt]}t(44,Te=L),u.setStyle(L,{diff:P}),oi(si,d=new Set,d),t(41,Si=new Set)}if(o.$$.dirty[0]&49|o.$$.dirty[1]&1152&&Se&&u!=null&&u.loaded())for(let Ie of et)!d.has(Ie.id)&&!Si.has(Ie.id)&&!u.hasImage(Ie.id)&&Ri(Ie);if(o.$$.dirty[0]&32|o.$$.dirty[1]&128&&t(6,l=et.every(Ie=>d.has(Ie.id))),o.$$.dirty[0]&61456&&u){let Ie={};R!=null&&!Yl(R,u==null?void 0:u.getCenter())&&(Ie.center=R),Z!=null&&!Yl(Z,u==null?void 0:u.getZoom())&&(Ie.zoom=Z),H!=null&&!Yl(H,u==null?void 0:u.getBearing())&&(Ie.bearing=H),$!=null&&!Yl($,u==null?void 0:u.getPitch())&&(Ie.pitch=$),Object.keys(Ie).length&&u.easeTo(Ie)}o.$$.dirty[0]&65552&&G&&!Yl(G,u==null?void 0:u.getBounds())&&(u==null||u.fitBounds(G)),o.$$.dirty[0]&16|o.$$.dirty[1]&1&&(ze?u==null||u.doubleClickZoom.enable():u==null||u.doubleClickZoom.disable())},[Se,k,S,at,u,d,l,n,ai,si,st,mt,R,Z,$,H,G,b,L,P,K,le,Le,te,Y,ue,fe,ce,ae,We,Ee,ze,rt,it,Qe,Ft,jt,ut,et,Bt,Dt,Si,vi,di,Te,g,a,yt]}class x3 extends Wt{constructor(e){super(),Gt(this,e,w3,v3,Vt,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const k3=o=>({marker:o&8}),ty=o=>({marker:o[3]});function S3(o){let e,t,n,l,u,d,a;const g=o[19].default,b=fn(g,o,o[18],ty);return{c(){e=ee("div"),b&&b.c(),Pe(e,"tabindex",t=o[1]?0:void 0),Pe(e,"role",n=o[1]?"button":void 0),mi(e,"z-index",o[2])},m(k,S){J(k,e,S),b&&b.m(e,null),u=!0,d||(a=[dp(o[7].call(null,e)),dp(l=T3.call(null,e,o[0])),ft(e,"click",ip(o[20])),ft(e,"dblclick",ip(o[21])),ft(e,"contextmenu",ip(ih(o[22]))),ft(e,"mouseenter",o[23]),ft(e,"mouseleave",o[24]),ft(e,"mousemove",o[25]),ft(e,"keydown",o[8])],d=!0)},p(k,[S]){b&&b.p&&(!u||S&262152)&&mn(b,g,k,k[18],u?pn(g,k[18],S,k3):_n(k[18]),ty),(!u||S&2&&t!==(t=k[1]?0:void 0))&&Pe(e,"tabindex",t),(!u||S&2&&n!==(n=k[1]?"button":void 0))&&Pe(e,"role",n),l&&Ja(l.update)&&S&1&&l.update.call(null,k[0]),S&4&&mi(e,"z-index",k[2])},i(k){u||(ne(b,k),u=!0)},o(k){he(b,k),u=!1},d(k){k&&X(e),b&&b.d(k),d=!1,an(a)}}}function T3(o,e){const t=o.className;function n(l){l?o.className=`${t} ${l}`:o.className=t}return n(e),{update:n}}function I3(o,e,t){let n,l,u,{$$slots:d={},$$scope:a}=e,{marker:g=void 0}=e,{lngLat:b}=e,{class:k=void 0}=e,{interactive:S=!0}=e,{asButton:L=!1}=e,{draggable:P=!1}=e,{feature:R=null}=e,{offset:Z=void 0}=e,{zIndex:$=void 0}=e,{rotation:H=0}=e,{opacity:G=1}=e;const K=pc(),{map:le,layerEvent:Se,self:Le,markerClickManager:te}=qk();bt(o,le,Qe=>t(27,u=Qe)),bt(o,Se,Qe=>t(26,n=Qe)),bt(o,Le,Qe=>t(3,l=Qe));function Y(Qe){oi(Le,l=new Lr.Marker({element:Qe,rotation:H,draggable:P,offset:Z,opacity:G.toString()}).setLngLat(b).addTo(u),l),t(11,g=l);const Ft=()=>ce("dragstart"),jt=()=>{ue(),ce("drag")},ut=()=>{ue(),ce("dragend")};return P&&(l.on("dragstart",Ft),l.on("drag",jt),l.on("dragend",ut)),{destroy(){P&&(l==null||l.off("dragstart",Ft),l==null||l.off("drag",jt),l==null||l.off("dragend",ut)),t(11,g=void 0),l==null||l.remove()}}}function ue(){let Qe=l==null?void 0:l.getLngLat();Qe&&(Array.isArray(b)?t(10,b=[Qe.lng,Qe.lat]):b&&"lon"in b?t(10,b={lon:Qe.lng,lat:Qe.lat}):t(10,b=Qe))}function fe(Qe){Qe.key===" "&&(Qe.preventDefault(),Qe.stopPropagation(),ce("click"))}function ce(Qe){if(!S)return;let Ft=l==null?void 0:l.getLngLat();if(!Ft)return;const jt=[Ft.lng,Ft.lat];let ut={map:u,marker:l,lngLat:jt,features:[{type:"Feature",properties:(R==null?void 0:R.properties)??{},geometry:{type:"Point",coordinates:jt}}]};(Qe==="click"||Qe==="contextmenu")&&te.handleClick(ut),oi(Se,n={...ut,layerType:"marker",type:Qe},n),K(Qe,ut)}const ae=()=>ce("click"),We=()=>ce("dblclick"),Ee=()=>{ce("contextmenu")},ze=()=>{ce("mouseenter")},rt=()=>{ce("mouseleave")},it=()=>ce("mousemove");return o.$$set=Qe=>{"marker"in Qe&&t(11,g=Qe.marker),"lngLat"in Qe&&t(10,b=Qe.lngLat),"class"in Qe&&t(0,k=Qe.class),"interactive"in Qe&&t(12,S=Qe.interactive),"asButton"in Qe&&t(1,L=Qe.asButton),"draggable"in Qe&&t(13,P=Qe.draggable),"feature"in Qe&&t(14,R=Qe.feature),"offset"in Qe&&t(15,Z=Qe.offset),"zIndex"in Qe&&t(2,$=Qe.zIndex),"rotation"in Qe&&t(16,H=Qe.rotation),"opacity"in Qe&&t(17,G=Qe.opacity),"$$scope"in Qe&&t(18,a=Qe.$$scope)},o.$$.update=()=>{o.$$.dirty&1032&&(l==null||l.setLngLat(b)),o.$$.dirty&32776&&(l==null||l.setOffset(Z??[0,0])),o.$$.dirty&65544&&(l==null||l.setRotation(H)),o.$$.dirty&131080&&(l==null||l.setOpacity(G.toString()))},[k,L,$,l,le,Se,Le,Y,fe,ce,b,g,S,P,R,Z,H,G,a,d,ae,We,Ee,ze,rt,it]}class Ld extends Wt{constructor(e){super(),Gt(this,e,I3,S3,Vt,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}function iy(o){let e=o[0],t,n,l=ny(o);return{c(){l.c(),t=Ei()},m(u,d){l.m(u,d),J(u,t,d),n=!0},p(u,d){d&1&&Vt(e,e=u[0])?(ui(),he(l,1,1,Ze),hi(),l=ny(u),l.c(),ne(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){n||(ne(l),n=!0)},o(u){he(l),n=!1},d(u){u&&X(t),l.d(u)}}}function ny(o){let e;const t=o[15].default,n=fn(t,o,o[14],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&16384)&&mn(n,t,l,l[14],e?pn(t,l[14],u,null):_n(l[14]),null)},i(l){e||(ne(n,l),e=!0)},o(l){he(n,l),e=!1},d(l){n&&n.d(l)}}}function C3(o){let e,t,n=o[0]&&iy(o);return{c(){n&&n.c(),e=Ei()},m(l,u){n&&n.m(l,u),J(l,e,u),t=!0},p(l,[u]){l[0]?n?(n.p(l,u),u&1&&ne(n,1)):(n=iy(l),n.c(),ne(n,1),n.m(e.parentNode,e)):n&&(ui(),he(n,1,1,()=>{n=null}),hi())},i(l){t||(ne(n),t=!0)},o(l){he(n),t=!1},d(l){l&&X(e),n&&n.d(l)}}}function E3(o,e,t){let n,l,{$$slots:u={},$$scope:d}=e,{id:a=mc("vector")}=e,{url:g=null}=e,{tiles:b=null}=e,{promoteId:k=null}=e,{bounds:S=null}=e,{scheme:L=null}=e,{attribution:P=null}=e,{minzoom:R=null}=e,{maxzoom:Z=null}=e,{volatile:$=null}=e;if(g&&g.includes("pmtiles://")&&!Lr.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let le=new xk;Lr.addProtocol("pmtiles",le.tile)}const{map:H,self:G}=D1();bt(o,H,le=>t(13,l=le)),bt(o,G,le=>t(0,n=le));let K;return Lo(()=>{n&&l&&(F1(H,n,K),oi(G,n=null,n),K=void 0)}),o.$$set=le=>{"id"in le&&t(3,a=le.id),"url"in le&&t(4,g=le.url),"tiles"in le&&t(5,b=le.tiles),"promoteId"in le&&t(6,k=le.promoteId),"bounds"in le&&t(7,S=le.bounds),"scheme"in le&&t(8,L=le.scheme),"attribution"in le&&t(9,P=le.attribution),"minzoom"in le&&t(10,R=le.minzoom),"maxzoom"in le&&t(11,Z=le.maxzoom),"volatile"in le&&t(12,$=le.volatile),"$$scope"in le&&t(14,d=le.$$scope)},o.$$.update=()=>{o.$$.dirty&16377&&l&&n!==a&&(oi(G,n=a,n),R1(l,n,Qu({type:"vector",url:g,tiles:b,promoteId:k,bounds:S,scheme:L,attribution:P,minzoom:R,maxzoom:Z,volatile:$}),le=>l&&le===n,()=>{n&&(K=l==null?void 0:l.getSource(n))})),o.$$.dirty&8200&&(l==null||l.on("style.load",()=>{K=l==null?void 0:l.getSource(a)}))},[n,H,G,a,g,b,k,S,L,P,R,Z,$,l,d,u]}class oh extends Wt{constructor(e){super(),Gt(this,e,E3,C3,Vt,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const L3=o=>({}),ry=o=>({}),M3=o=>({}),oy=o=>({}),A3=o=>({}),sy=o=>({}),P3=o=>({}),ay=o=>({});function z3(o){let e,t,n,l,u,d,a,g,b;const k=o[1].top,S=fn(k,o,o[0],ay),L=o[1].left,P=fn(L,o,o[0],sy),R=o[1].main,Z=fn(R,o,o[0],oy),$=o[1].right,H=fn($,o,o[0],ry);return{c(){e=ee("div"),S&&S.c(),t=we(),n=ee("div"),l=ee("div"),P&&P.c(),u=we(),d=ee("div"),Z&&Z.c(),a=we(),g=ee("div"),H&&H.c(),Pe(e,"class","top svelte-11kzs8g"),Pe(l,"class","left svelte-11kzs8g"),Pe(d,"class","main svelte-11kzs8g"),Pe(g,"class","right svelte-11kzs8g"),Pe(n,"class","main-row svelte-11kzs8g")},m(G,K){J(G,e,K),S&&S.m(e,null),J(G,t,K),J(G,n,K),F(n,l),P&&P.m(l,null),F(n,u),F(n,d),Z&&Z.m(d,null),F(n,a),F(n,g),H&&H.m(g,null),b=!0},p(G,[K]){S&&S.p&&(!b||K&1)&&mn(S,k,G,G[0],b?pn(k,G[0],K,P3):_n(G[0]),ay),P&&P.p&&(!b||K&1)&&mn(P,L,G,G[0],b?pn(L,G[0],K,A3):_n(G[0]),sy),Z&&Z.p&&(!b||K&1)&&mn(Z,R,G,G[0],b?pn(R,G[0],K,M3):_n(G[0]),oy),H&&H.p&&(!b||K&1)&&mn(H,$,G,G[0],b?pn($,G[0],K,L3):_n(G[0]),ry)},i(G){b||(ne(S,G),ne(P,G),ne(Z,G),ne(H,G),b=!0)},o(G){he(S,G),he(P,G),he(Z,G),he(H,G),b=!1},d(G){G&&(X(e),X(t),X(n)),S&&S.d(G),P&&P.d(G),Z&&Z.d(G),H&&H.d(G)}}}function D3(o,e,t){let{$$slots:n={},$$scope:l}=e;return o.$$set=u=>{"$$scope"in u&&t(0,l=u.$$scope)},[l,n]}class R3 extends Wt{constructor(e){super(),Gt(this,e,D3,z3,Vt,{})}}const F3=o=>({}),ly=o=>({}),B3=o=>({}),cy=o=>({}),O3=o=>({}),uy=o=>({});function N3(o){let e,t,n,l,u,d;const a=o[4].left,g=fn(a,o,o[3],uy),b=o[4].map,k=fn(b,o,o[3],cy),S=o[4].right,L=fn(S,o,o[3],ly);return{c(){e=ee("div"),g&&g.c(),t=we(),n=ee("div"),k&&k.c(),l=we(),u=ee("div"),L&&L.c()},m(P,R){J(P,e,R),g&&g.m(e,null),o[5](e),J(P,t,R),J(P,n,R),k&&k.m(n,null),o[6](n),J(P,l,R),J(P,u,R),L&&L.m(u,null),o[7](u),d=!0},p(P,[R]){g&&g.p&&(!d||R&8)&&mn(g,a,P,P[3],d?pn(a,P[3],R,O3):_n(P[3]),uy),k&&k.p&&(!d||R&8)&&mn(k,b,P,P[3],d?pn(b,P[3],R,B3):_n(P[3]),cy),L&&L.p&&(!d||R&8)&&mn(L,S,P,P[3],d?pn(S,P[3],R,F3):_n(P[3]),ly)},i(P){d||(ne(g,P),ne(k,P),ne(L,P),d=!0)},o(P){he(g,P),he(k,P),he(L,P),d=!1},d(P){P&&(X(e),X(t),X(n),X(l),X(u)),g&&g.d(P),o[5](null),k&&k.d(P),o[6](null),L&&L.d(P),o[7](null)}}}function j3(o,e,t){let n,l,u;bt(o,Ip,S=>t(0,n=S)),bt(o,Ep,S=>t(1,l=S)),bt(o,Cp,S=>t(2,u=S));let{$$slots:d={},$$scope:a}=e;function g(S){Ai[S?"unshift":"push"](()=>{n=S,Ip.set(n)})}function b(S){Ai[S?"unshift":"push"](()=>{l=S,Ep.set(l)})}function k(S){Ai[S?"unshift":"push"](()=>{u=S,Cp.set(u)})}return o.$$set=S=>{"$$scope"in S&&t(3,a=S.$$scope)},[n,l,u,a,d,g,b,k]}class yc extends Wt{constructor(e){super(),Gt(this,e,j3,N3,Vt,{})}}let Ip=Mi(null),Cp=Mi(null),Ep=Mi(null);function hy(o){let e,t;return{c(){e=ee("div"),t=be(o[0]),Pe(e,"class","svelte-1uuov7f")},m(n,l){J(n,e,l),F(e,t)},p(n,l){l&1&&pt(t,n[0])},d(n){n&&X(e)}}}function U3(o){let e,t=o[0]&&hy(o);return{c(){t&&t.c(),e=Ei()},m(n,l){t&&t.m(n,l),J(n,e,l)},p(n,[l]){n[0]?t?t.p(n,l):(t=hy(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ze,o:Ze,d(n){n&&X(e),t&&t.d(n)}}}function $3(o,e,t){let{loading:n}=e;return o.$$set=l=>{"loading"in l&&t(0,n=l.loading)},[n]}class V3 extends Wt{constructor(e){super(),Gt(this,e,$3,U3,Vt,{loading:0})}}const q3=o=>({dialog:o&1}),dy=o=>({dialog:o[0]});function Z3(o){let e,t,n,l,u;const d=o[4].default,a=fn(d,o,o[3],dy);return{c(){e=ee("dialog"),t=ee("article"),a&&a.c(),e.open=!0},m(g,b){J(g,e,b),F(e,t),a&&a.m(t,null),o[6](e),n=!0,l||(u=[ft(window,"click",o[1]),ft(window,"keydown",o[2]),ft(e,"close",o[5])],l=!0)},p(g,[b]){a&&a.p&&(!n||b&9)&&mn(a,d,g,g[3],n?pn(d,g[3],b,q3):_n(g[3]),dy)},i(g){n||(ne(a,g),n=!0)},o(g){he(a,g),n=!1},d(g){g&&X(e),a&&a.d(g),o[6](null),l=!1,an(u)}}}function G3(o,e,t){let{$$slots:n={},$$scope:l}=e,u;function d(k){u.open&&k.target==u&&u.close()}function a(k){(k.key=="Escape"||k.key=="Enter")&&(k.stopPropagation(),u.close())}function g(k){zn.call(this,o,k)}function b(k){Ai[k?"unshift":"push"](()=>{u=k,t(0,u)})}return o.$$set=k=>{"$$scope"in k&&t(3,l=k.$$scope)},[u,d,a,l,n,g,b]}class O1 extends Wt{constructor(e){super(),Gt(this,e,G3,Z3,Vt,{})}}function fy(o,e,t){const n=o.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function py(o){let e,t,n=o[1]+"",l,u,d,a=o[2]+"",g,b;return{c(){e=ee("tr"),t=ee("td"),l=be(n),u=we(),d=ee("td"),g=be(a),b=we()},m(k,S){J(k,e,S),F(e,t),F(t,l),F(e,u),F(e,d),F(d,g),F(e,b)},p(k,S){S&1&&n!==(n=k[1]+"")&&pt(l,n),S&1&&a!==(a=k[2]+"")&&pt(g,a)},d(k){k&&X(e)}}}function W3(o){let e,t,n=bi(Object.entries(o[0])),l=[];for(let u=0;u<n.length;u+=1)l[u]=py(fy(o,n,u));return{c(){e=ee("table"),t=ee("tbody");for(let u=0;u<l.length;u+=1)l[u].c();Pe(e,"class","svelte-lh2o9l")},m(u,d){J(u,e,d),F(e,t);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(t,null)},p(u,[d]){if(d&1){n=bi(Object.entries(u[0]));let a;for(a=0;a<n.length;a+=1){const g=fy(u,n,a);l[a]?l[a].p(g,d):(l[a]=py(g),l[a].c(),l[a].m(t,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=n.length}},i:Ze,o:Ze,d(u){u&&X(e),Bn(l,u)}}}function H3(o,e,t){let{properties:n}=e;return o.$$set=l=>{"properties"in l&&t(0,n=l.properties)},[n]}class X3 extends Wt{constructor(e){super(),Gt(this,e,H3,W3,Vt,{properties:0})}}function my(o,e,t){const n=o.slice();return n[3]=e[t],n}function _y(o,e,t){const n=o.slice();return n[6]=e[t],n}function gy(o){let e,t;return{c(){e=ee("span"),t=be(` 
    `),mi(e,"background",o[6]),mi(e,"width","100%"),mi(e,"border","1px solid black")},m(n,l){J(n,e,l),F(e,t)},p(n,l){l&1&&mi(e,"background",n[6])},d(n){n&&X(e)}}}function K3(o){let e,t=o[3]+"",n;return{c(){e=ee("span"),n=be(t)},m(l,u){J(l,e,u),F(e,n)},p(l,u){u&2&&t!==(t=l[3]+"")&&pt(n,t)},d(l){l&&X(e)}}}function J3(o){let e,t=o[3].toFixed(o[2])+"",n;return{c(){e=ee("span"),n=be(t)},m(l,u){J(l,e,u),F(e,n)},p(l,u){u&6&&t!==(t=l[3].toFixed(l[2])+"")&&pt(n,t)},d(l){l&&X(e)}}}function yy(o){let e;function t(u,d){return u[2]>0?J3:K3}let n=t(o),l=n(o);return{c(){l.c(),e=Ei()},m(u,d){l.m(u,d),J(u,e,d)},p(u,d){n===(n=t(u))&&l?l.p(u,d):(l.d(1),l=n(u),l&&(l.c(),l.m(e.parentNode,e)))},d(u){u&&X(e),l.d(u)}}}function Y3(o){let e,t,n,l=bi(o[0]),u=[];for(let g=0;g<l.length;g+=1)u[g]=gy(_y(o,l,g));let d=bi(o[1]),a=[];for(let g=0;g<d.length;g+=1)a[g]=yy(my(o,d,g));return{c(){e=ee("div");for(let g=0;g<u.length;g+=1)u[g].c();t=we(),n=ee("div");for(let g=0;g<a.length;g+=1)a[g].c();mi(e,"display","flex"),mi(n,"display","flex"),mi(n,"justify-content","space-between")},m(g,b){J(g,e,b);for(let k=0;k<u.length;k+=1)u[k]&&u[k].m(e,null);J(g,t,b),J(g,n,b);for(let k=0;k<a.length;k+=1)a[k]&&a[k].m(n,null)},p(g,[b]){if(b&1){l=bi(g[0]);let k;for(k=0;k<l.length;k+=1){const S=_y(g,l,k);u[k]?u[k].p(S,b):(u[k]=gy(S),u[k].c(),u[k].m(e,null))}for(;k<u.length;k+=1)u[k].d(1);u.length=l.length}if(b&6){d=bi(g[1]);let k;for(k=0;k<d.length;k+=1){const S=my(g,d,k);a[k]?a[k].p(S,b):(a[k]=yy(S),a[k].c(),a[k].m(n,null))}for(;k<a.length;k+=1)a[k].d(1);a.length=d.length}},i:Ze,o:Ze,d(g){g&&(X(e),X(t),X(n)),Bn(u,g),Bn(a,g)}}}function Q3(o,e,t){let{colorScale:n}=e,{limits:l}=e,{decimalPlaces:u=0}=e;return o.$$set=d=>{"colorScale"in d&&t(0,n=d.colorScale),"limits"in d&&t(1,l=d.limits),"decimalPlaces"in d&&t(2,u=d.decimalPlaces)},[n,l,u]}class Kp extends Wt{constructor(e){super(),Gt(this,e,Q3,Y3,Vt,{colorScale:0,limits:1,decimalPlaces:2})}}function Mo(o){if(o==null||o==null)throw new Error("Oops, notNull given something null");return o}let Ye;const fs=new Array(128).fill(void 0);fs.push(void 0,null,!0,!1);function ni(o){return fs[o]}let qu=fs.length;function e4(o){o<132||(fs[o]=qu,qu=o)}function ln(o){const e=ni(o);return e4(o),e}const N1=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&N1.decode();let Bu=null;function cc(){return(Bu===null||Bu.byteLength===0)&&(Bu=new Uint8Array(Ye.memory.buffer)),Bu}function cn(o,e){return o=o>>>0,N1.decode(cc().subarray(o,o+e))}function Ji(o){qu===fs.length&&fs.push(fs.length+1);const e=qu;return qu=fs[e],fs[e]=o,e}let No=0;const vd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},t4=typeof vd.encodeInto=="function"?function(o,e){return vd.encodeInto(o,e)}:function(o,e){const t=vd.encode(o);return e.set(t),{read:o.length,written:t.length}};function Ka(o,e,t){if(t===void 0){const a=vd.encode(o),g=e(a.length,1)>>>0;return cc().subarray(g,g+a.length).set(a),No=a.length,g}let n=o.length,l=e(n,1)>>>0;const u=cc();let d=0;for(;d<n;d++){const a=o.charCodeAt(d);if(a>127)break;u[l+d]=a}if(d!==n){d!==0&&(o=o.slice(d)),l=t(l,n,n=d+o.length*3,1)>>>0;const a=cc().subarray(l+d,l+n),g=t4(o,a);d+=g.written,l=t(l,n,d,1)>>>0}return No=d,l}function Wa(o){return o==null}let Ga=null;function dt(){return(Ga===null||Ga.buffer.detached===!0||Ga.buffer.detached===void 0&&Ga.buffer!==Ye.memory.buffer)&&(Ga=new DataView(Ye.memory.buffer)),Ga}function Lp(o){const e=typeof o;if(e=="number"||e=="boolean"||o==null)return`${o}`;if(e=="string")return`"${o}"`;if(e=="symbol"){const l=o.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=o.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(o)){const l=o.length;let u="[";l>0&&(u+=Lp(o[0]));for(let d=1;d<l;d++)u+=", "+Lp(o[d]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(o));let n;if(t.length>1)n=t[1];else return toString.call(o);if(n=="Object")try{return"Object("+JSON.stringify(o)+")"}catch{return"Object"}return o instanceof Error?`${o.name}: ${o.message}
${o.stack}`:n}function i4(o,e){const t=e(o.length*1,1)>>>0;return cc().set(o,t/1),No=o.length,t}let Ou=null;function n4(){return(Ou===null||Ou.byteLength===0)&&(Ou=new Float64Array(Ye.memory.buffer)),Ou}function r4(o,e){return o=o>>>0,n4().subarray(o/8,o/8+e)}function o4(o,e){return o=o>>>0,cc().subarray(o/1,o/1+e)}function ra(o,e){try{return o.apply(this,e)}catch(t){Ye.__wbindgen_exn_store(Ji(t))}}const by=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(o=>Ye.__wbg_mapmodel_free(o>>>0,1));class s4{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,by.unregister(this),e}free(){const e=this.__destroy_into_raw();Ye.__wbg_mapmodel_free(e,0)}constructor(e){try{const u=Ye.__wbindgen_add_to_stack_pointer(-16),d=i4(e,Ye.__wbindgen_malloc),a=No;Ye.mapmodel_new(u,d,a);var t=dt().getInt32(u+4*0,!0),n=dt().getInt32(u+4*1,!0),l=dt().getInt32(u+4*2,!0);if(l)throw ln(n);return this.__wbg_ptr=t>>>0,by.register(this,this.__wbg_ptr,this),this}finally{Ye.__wbindgen_add_to_stack_pointer(16)}}renderDebug(){let e,t;try{const b=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_renderDebug(b,this.__wbg_ptr);var n=dt().getInt32(b+4*0,!0),l=dt().getInt32(b+4*1,!0),u=dt().getInt32(b+4*2,!0),d=dt().getInt32(b+4*3,!0),a=n,g=l;if(d)throw a=0,g=0,ln(u);return e=a,t=g,cn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}getInvertedBoundary(){let e,t;try{const b=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getInvertedBoundary(b,this.__wbg_ptr);var n=dt().getInt32(b+4*0,!0),l=dt().getInt32(b+4*1,!0),u=dt().getInt32(b+4*2,!0),d=dt().getInt32(b+4*3,!0),a=n,g=l;if(d)throw a=0,g=0,ln(u);return e=a,t=g,cn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}getBounds(){try{const l=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getBounds(l,this.__wbg_ptr);var e=dt().getInt32(l+4*0,!0),t=dt().getInt32(l+4*1,!0),n=r4(e,t).slice();return Ye.__wbindgen_free(e,t*8,8),n}finally{Ye.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const l=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_toRouteSnapper(l,this.__wbg_ptr);var e=dt().getInt32(l+4*0,!0),t=dt().getInt32(l+4*1,!0),n=o4(e,t).slice();return Ye.__wbindgen_free(e,t*1,1),n}finally{Ye.__wbindgen_add_to_stack_pointer(16)}}setRoute(e,t){try{const u=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_setRoute(u,this.__wbg_ptr,!Wa(e),Wa(e)?0:e,Ji(t));var n=dt().getInt32(u+4*0,!0),l=dt().getInt32(u+4*1,!0);if(l)throw ln(n)}finally{Ye.__wbindgen_add_to_stack_pointer(16)}}deleteRoute(e){try{const l=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_deleteRoute(l,this.__wbg_ptr,e);var t=dt().getInt32(l+4*0,!0),n=dt().getInt32(l+4*1,!0);if(n)throw ln(t)}finally{Ye.__wbindgen_add_to_stack_pointer(16)}}clearAllRoutes(){Ye.mapmodel_clearAllRoutes(this.__wbg_ptr)}autosplitRoute(e){let t,n;try{const k=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_autosplitRoute(k,this.__wbg_ptr,Ji(e));var l=dt().getInt32(k+4*0,!0),u=dt().getInt32(k+4*1,!0),d=dt().getInt32(k+4*2,!0),a=dt().getInt32(k+4*3,!0),g=l,b=u;if(a)throw g=0,b=0,ln(d);return t=g,n=b,cn(g,b)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(t,n,1)}}renderRoutes(){let e,t;try{const b=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_renderRoutes(b,this.__wbg_ptr);var n=dt().getInt32(b+4*0,!0),l=dt().getInt32(b+4*1,!0),u=dt().getInt32(b+4*2,!0),d=dt().getInt32(b+4*3,!0),a=n,g=l;if(d)throw a=0,g=0,ln(u);return e=a,t=g,cn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}evaluateRoute(e){let t,n;try{const k=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_evaluateRoute(k,this.__wbg_ptr,Ji(e));var l=dt().getInt32(k+4*0,!0),u=dt().getInt32(k+4*1,!0),d=dt().getInt32(k+4*2,!0),a=dt().getInt32(k+4*3,!0),g=l,b=u;if(a)throw g=0,b=0,ln(d);return t=g,n=b,cn(g,b)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(t,n,1)}}debugReachablePath(e,t){let n,l;try{const S=Ye.__wbindgen_add_to_stack_pointer(-16),L=Ka(e,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),P=No;Ye.mapmodel_debugReachablePath(S,this.__wbg_ptr,L,P,t);var u=dt().getInt32(S+4*0,!0),d=dt().getInt32(S+4*1,!0),a=dt().getInt32(S+4*2,!0),g=dt().getInt32(S+4*3,!0),b=u,k=d;if(g)throw b=0,k=0,ln(a);return n=b,l=k,cn(b,k)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(n,l,1)}}debugUnreachablePath(e,t){let n,l;try{const S=Ye.__wbindgen_add_to_stack_pointer(-16),L=Ka(e,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),P=No;Ye.mapmodel_debugUnreachablePath(S,this.__wbg_ptr,L,P,t);var u=dt().getInt32(S+4*0,!0),d=dt().getInt32(S+4*1,!0),a=dt().getInt32(S+4*2,!0),g=dt().getInt32(S+4*3,!0),b=u,k=d;if(g)throw b=0,k=0,ln(a);return n=b,l=k,cn(b,k)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(n,l,1)}}evaluateOD(){let e,t;try{const b=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_evaluateOD(b,this.__wbg_ptr);var n=dt().getInt32(b+4*0,!0),l=dt().getInt32(b+4*1,!0),u=dt().getInt32(b+4*2,!0),d=dt().getInt32(b+4*3,!0),a=n,g=l;if(d)throw a=0,g=0,ln(u);return e=a,t=g,cn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}recalculateStats(){let e,t;try{const b=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_recalculateStats(b,this.__wbg_ptr);var n=dt().getInt32(b+4*0,!0),l=dt().getInt32(b+4*1,!0),u=dt().getInt32(b+4*2,!0),d=dt().getInt32(b+4*3,!0),a=n,g=l;if(d)throw a=0,g=0,ln(u);return e=a,t=g,cn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const b=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_toSavefile(b,this.__wbg_ptr);var n=dt().getInt32(b+4*0,!0),l=dt().getInt32(b+4*1,!0),u=dt().getInt32(b+4*2,!0),d=dt().getInt32(b+4*3,!0),a=n,g=l;if(d)throw a=0,g=0,ln(u);return e=a,t=g,cn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const l=Ye.__wbindgen_add_to_stack_pointer(-16),u=Ka(e,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),d=No;Ye.mapmodel_loadSavefile(l,this.__wbg_ptr,u,d);var t=dt().getInt32(l+4*0,!0),n=dt().getInt32(l+4*1,!0);if(n)throw ln(t)}finally{Ye.__wbindgen_add_to_stack_pointer(16)}}meshDensity(){let e,t;try{const b=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_meshDensity(b,this.__wbg_ptr);var n=dt().getInt32(b+4*0,!0),l=dt().getInt32(b+4*1,!0),u=dt().getInt32(b+4*2,!0),d=dt().getInt32(b+4*3,!0),a=n,g=l;if(d)throw a=0,g=0,ln(u);return e=a,t=g,cn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}classifyExistingNetwork(){let e,t;try{const b=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_classifyExistingNetwork(b,this.__wbg_ptr);var n=dt().getInt32(b+4*0,!0),l=dt().getInt32(b+4*1,!0),u=dt().getInt32(b+4*2,!0),d=dt().getInt32(b+4*3,!0),a=n,g=l;if(d)throw a=0,g=0,ln(u);return e=a,t=g,cn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}importExistingRoutes(){return Ye.mapmodel_importExistingRoutes(this.__wbg_ptr)>>>0}importCoreNetwork(){return Ye.mapmodel_importCoreNetwork(this.__wbg_ptr)>>>0}getSchools(){let e,t;try{const b=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getSchools(b,this.__wbg_ptr);var n=dt().getInt32(b+4*0,!0),l=dt().getInt32(b+4*1,!0),u=dt().getInt32(b+4*2,!0),d=dt().getInt32(b+4*3,!0),a=n,g=l;if(d)throw a=0,g=0,ln(u);return e=a,t=g,cn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}getGPHospitals(){let e,t;try{const b=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getGPHospitals(b,this.__wbg_ptr);var n=dt().getInt32(b+4*0,!0),l=dt().getInt32(b+4*1,!0),u=dt().getInt32(b+4*2,!0),d=dt().getInt32(b+4*3,!0),a=n,g=l;if(d)throw a=0,g=0,ln(u);return e=a,t=g,cn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}getTownCentres(){let e,t;try{const b=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getTownCentres(b,this.__wbg_ptr);var n=dt().getInt32(b+4*0,!0),l=dt().getInt32(b+4*1,!0),u=dt().getInt32(b+4*2,!0),d=dt().getInt32(b+4*3,!0),a=n,g=l;if(d)throw a=0,g=0,ln(u);return e=a,t=g,cn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}getDataZones(){let e,t;try{const b=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getDataZones(b,this.__wbg_ptr);var n=dt().getInt32(b+4*0,!0),l=dt().getInt32(b+4*1,!0),u=dt().getInt32(b+4*2,!0),d=dt().getInt32(b+4*3,!0),a=n,g=l;if(d)throw a=0,g=0,ln(u);return e=a,t=g,cn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}renderReachableNetwork(){let e,t;try{const b=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_renderReachableNetwork(b,this.__wbg_ptr);var n=dt().getInt32(b+4*0,!0),l=dt().getInt32(b+4*1,!0),u=dt().getInt32(b+4*2,!0),d=dt().getInt32(b+4*3,!0),a=n,g=l;if(d)throw a=0,g=0,ln(u);return e=a,t=g,cn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}renderLevelOfService(){let e,t;try{const b=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_renderLevelOfService(b,this.__wbg_ptr);var n=dt().getInt32(b+4*0,!0),l=dt().getInt32(b+4*1,!0),u=dt().getInt32(b+4*2,!0),d=dt().getInt32(b+4*3,!0),a=n,g=l;if(d)throw a=0,g=0,ln(u);return e=a,t=g,cn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}renderCoreNetwork(){let e,t;try{const b=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_renderCoreNetwork(b,this.__wbg_ptr);var n=dt().getInt32(b+4*0,!0),l=dt().getInt32(b+4*1,!0),u=dt().getInt32(b+4*2,!0),d=dt().getInt32(b+4*3,!0),a=n,g=l;if(d)throw a=0,g=0,ln(u);return e=a,t=g,cn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}renderPrecalculatedFlows(){let e,t;try{const b=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_renderPrecalculatedFlows(b,this.__wbg_ptr);var n=dt().getInt32(b+4*0,!0),l=dt().getInt32(b+4*1,!0),u=dt().getInt32(b+4*2,!0),d=dt().getInt32(b+4*3,!0),a=n,g=l;if(d)throw a=0,g=0,ln(u);return e=a,t=g,cn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}getMajorJunctions(){let e,t;try{const b=Ye.__wbindgen_add_to_stack_pointer(-16);Ye.mapmodel_getMajorJunctions(b,this.__wbg_ptr);var n=dt().getInt32(b+4*0,!0),l=dt().getInt32(b+4*1,!0),u=dt().getInt32(b+4*2,!0),d=dt().getInt32(b+4*3,!0),a=n,g=l;if(d)throw a=0,g=0,ln(u);return e=a,t=g,cn(a,g)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,t,1)}}}async function a4(o,e){if(typeof Response=="function"&&o instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(o,e)}catch(n){if(o.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await o.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(o,e);return t instanceof WebAssembly.Instance?{instance:t,module:o}:t}}function l4(){const o={};return o.wbg={},o.wbg.__wbindgen_object_drop_ref=function(e){ln(e)},o.wbg.__wbindgen_string_new=function(e,t){const n=cn(e,t);return Ji(n)},o.wbg.__wbindgen_string_get=function(e,t){const n=ni(t),l=typeof n=="string"?n:void 0;var u=Wa(l)?0:Ka(l,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),d=No;dt().setInt32(e+4*1,d,!0),dt().setInt32(e+4*0,u,!0)},o.wbg.__wbindgen_number_get=function(e,t){const n=ni(t),l=typeof n=="number"?n:void 0;dt().setFloat64(e+8*1,Wa(l)?0:l,!0),dt().setInt32(e+4*0,!Wa(l),!0)},o.wbg.__wbindgen_error_new=function(e,t){const n=new Error(cn(e,t));return Ji(n)},o.wbg.__wbindgen_boolean_get=function(e){const t=ni(e);return typeof t=="boolean"?t?1:0:2},o.wbg.__wbindgen_is_bigint=function(e){return typeof ni(e)=="bigint"},o.wbg.__wbindgen_is_object=function(e){const t=ni(e);return typeof t=="object"&&t!==null},o.wbg.__wbindgen_in=function(e,t){return ni(e)in ni(t)},o.wbg.__wbindgen_bigint_from_i64=function(e){return Ji(e)},o.wbg.__wbindgen_jsval_eq=function(e,t){return ni(e)===ni(t)},o.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return Ji(t)},o.wbg.__wbindgen_is_string=function(e){return typeof ni(e)=="string"},o.wbg.__wbindgen_is_undefined=function(e){return ni(e)===void 0},o.wbg.__wbindgen_jsval_loose_eq=function(e,t){return ni(e)==ni(t)},o.wbg.__wbindgen_as_number=function(e){return+ni(e)},o.wbg.__wbg_String_b9412f8799faab3e=function(e,t){const n=String(ni(t)),l=Ka(n,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),u=No;dt().setInt32(e+4*1,u,!0),dt().setInt32(e+4*0,l,!0)},o.wbg.__wbindgen_object_clone_ref=function(e){const t=ni(e);return Ji(t)},o.wbg.__wbg_getwithrefkey_edc2c8960f0f1191=function(e,t){const n=ni(e)[ni(t)];return Ji(n)},o.wbg.__wbg_debug_5a33c41aeac15ee6=function(e){console.debug(ni(e))},o.wbg.__wbg_error_09480e4aadca50ad=function(e){console.error(ni(e))},o.wbg.__wbg_info_c261acb2deacd903=function(e){console.info(ni(e))},o.wbg.__wbg_log_b103404cc5920657=function(e){console.log(ni(e))},o.wbg.__wbg_warn_2b3adb99ce26c314=function(e){console.warn(ni(e))},o.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Ji(e)},o.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=ni(t).stack,l=Ka(n,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),u=No;dt().setInt32(e+4*1,u,!0),dt().setInt32(e+4*0,l,!0)},o.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,l;try{n=e,l=t,console.error(cn(e,t))}finally{Ye.__wbindgen_free(n,l,1)}},o.wbg.__wbg_performance_a1b8bde2ee512264=function(e){const t=ni(e).performance;return Ji(t)},o.wbg.__wbg_now_abd80e969af37148=function(e){return ni(e).now()},o.wbg.__wbg_get_3baa728f9d58d3f6=function(e,t){const n=ni(e)[t>>>0];return Ji(n)},o.wbg.__wbg_length_ae22078168b726f5=function(e){return ni(e).length},o.wbg.__wbindgen_is_function=function(e){return typeof ni(e)=="function"},o.wbg.__wbg_newnoargs_76313bd6ff35d0f2=function(e,t){const n=new Function(cn(e,t));return Ji(n)},o.wbg.__wbg_next_de3e9db4440638b2=function(e){const t=ni(e).next;return Ji(t)},o.wbg.__wbg_next_f9cb570345655b9a=function(){return ra(function(e){const t=ni(e).next();return Ji(t)},arguments)},o.wbg.__wbg_done_bfda7aa8f252b39f=function(e){return ni(e).done},o.wbg.__wbg_value_6d39332ab4788d86=function(e){const t=ni(e).value;return Ji(t)},o.wbg.__wbg_iterator_888179a48810a9fe=function(){return Ji(Symbol.iterator)},o.wbg.__wbg_get_224d16597dbbfd96=function(){return ra(function(e,t){const n=Reflect.get(ni(e),ni(t));return Ji(n)},arguments)},o.wbg.__wbg_call_1084a111329e68ce=function(){return ra(function(e,t){const n=ni(e).call(ni(t));return Ji(n)},arguments)},o.wbg.__wbg_self_3093d5d1f7bcb682=function(){return ra(function(){const e=self.self;return Ji(e)},arguments)},o.wbg.__wbg_window_3bcfc4d31bc012f8=function(){return ra(function(){const e=window.window;return Ji(e)},arguments)},o.wbg.__wbg_globalThis_86b222e13bdf32ed=function(){return ra(function(){const e=globalThis.globalThis;return Ji(e)},arguments)},o.wbg.__wbg_global_e5a3fe56f8be9485=function(){return ra(function(){const e=global.global;return Ji(e)},arguments)},o.wbg.__wbg_isArray_8364a5371e9737d8=function(e){return Array.isArray(ni(e))},o.wbg.__wbg_instanceof_ArrayBuffer_61dfc3198373c902=function(e){let t;try{t=ni(e)instanceof ArrayBuffer}catch{t=!1}return t},o.wbg.__wbg_call_89af060b4e1523f2=function(){return ra(function(e,t,n){const l=ni(e).call(ni(t),ni(n));return Ji(l)},arguments)},o.wbg.__wbg_instanceof_Map_763ce0e95960d55e=function(e){let t;try{t=ni(e)instanceof Map}catch{t=!1}return t},o.wbg.__wbg_isSafeInteger_7f1ed56200d90674=function(e){return Number.isSafeInteger(ni(e))},o.wbg.__wbg_entries_7a0e06255456ebcd=function(e){const t=Object.entries(ni(e));return Ji(t)},o.wbg.__wbg_buffer_b7b08af79b0b0974=function(e){const t=ni(e).buffer;return Ji(t)},o.wbg.__wbg_new_ea1883e1e5e86686=function(e){const t=new Uint8Array(ni(e));return Ji(t)},o.wbg.__wbg_set_d1e79e2388520f18=function(e,t,n){ni(e).set(ni(t),n>>>0)},o.wbg.__wbg_length_8339fcf5d8ecd12e=function(e){return ni(e).length},o.wbg.__wbg_instanceof_Uint8Array_247a91427532499e=function(e){let t;try{t=ni(e)instanceof Uint8Array}catch{t=!1}return t},o.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=ni(t),l=typeof n=="bigint"?n:void 0;dt().setBigInt64(e+8*1,Wa(l)?BigInt(0):l,!0),dt().setInt32(e+4*0,!Wa(l),!0)},o.wbg.__wbindgen_debug_string=function(e,t){const n=Lp(ni(t)),l=Ka(n,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),u=No;dt().setInt32(e+4*1,u,!0),dt().setInt32(e+4*0,l,!0)},o.wbg.__wbindgen_throw=function(e,t){throw new Error(cn(e,t))},o.wbg.__wbindgen_memory=function(){const e=Ye.memory;return Ji(e)},o}function c4(o,e){return Ye=o.exports,j1.__wbindgen_wasm_module=e,Ga=null,Ou=null,Bu=null,Ye}async function j1(o){if(Ye!==void 0)return Ye;typeof o<"u"&&Object.getPrototypeOf(o)===Object.prototype?{module_or_path:o}=o:console.warn("using deprecated parameters for the initialization function; pass a single object instead"),typeof o>"u"&&(o=new URL("backend_bg.wasm",self.location));const e=l4();(typeof o=="string"||typeof Request=="function"&&o instanceof Request||typeof URL=="function"&&o instanceof URL)&&(o=fetch(o));const{instance:t,module:n}=await a4(await o,e);return c4(t,n)}class u4{constructor(){Eu(this,"inner");this.inner=null}async loadFile(e){await j1(),this.inner=new s4(e)}getBounds(){return this.checkReady(),Array.from(this.inner.getBounds())}getInvertedBoundary(){return this.checkReady(),JSON.parse(this.inner.getInvertedBoundary())}renderDebug(){return this.checkReady(),JSON.parse(this.inner.renderDebug())}renderLevelOfService(){return this.checkReady(),JSON.parse(this.inner.renderLevelOfService())}renderCoreNetwork(){return this.checkReady(),JSON.parse(this.inner.renderCoreNetwork())}renderPrecalculatedFlows(){return this.checkReady(),JSON.parse(this.inner.renderPrecalculatedFlows())}toRouteSnapper(){return this.checkReady(),this.inner.toRouteSnapper()}renderRoutes(){return this.checkReady(),JSON.parse(this.inner.renderRoutes())}setRoute(e,t){this.checkReady(),this.inner.setRoute(e??void 0,t)}deleteRoute(e){this.checkReady(),this.inner.deleteRoute(e)}clearAllRoutes(){this.checkReady(),this.inner.clearAllRoutes()}autosplitRoute(e){return this.checkReady(),JSON.parse(this.inner.autosplitRoute(e))}evaluateRoute(e){return this.checkReady(),JSON.parse(this.inner.evaluateRoute({x1:e.start.lng,y1:e.start.lat,x2:e.end[0],y2:e.end[1],breakdown:e.breakdown}))}evaluateOD(){return this.checkReady(),JSON.parse(this.inner.evaluateOD())}recalculateStats(){return this.checkReady(),JSON.parse(this.inner.recalculateStats())}meshDensity(){return this.checkReady(),JSON.parse(this.inner.meshDensity())}classifyExistingNetwork(){return this.checkReady(),JSON.parse(this.inner.classifyExistingNetwork())}importExistingRoutes(){return this.checkReady(),this.inner.importExistingRoutes()}importCoreNetwork(){return this.checkReady(),this.inner.importCoreNetwork()}toSavefile(){return this.checkReady(),this.inner.toSavefile()}loadSavefile(e){this.checkReady(),this.inner.loadSavefile(e)}getSchools(){return this.checkReady(),JSON.parse(this.inner.getSchools())}getGpHospitals(){return this.checkReady(),JSON.parse(this.inner.getGPHospitals())}getTownCentres(){return this.checkReady(),JSON.parse(this.inner.getTownCentres())}getDataZones(){return this.checkReady(),JSON.parse(this.inner.getDataZones())}renderReachableNetwork(){return this.checkReady(),JSON.parse(this.inner.renderReachableNetwork())}debugReachablePath(e,t){return this.checkReady(),JSON.parse(this.inner.debugReachablePath(e,t))}debugUnreachablePath(e,t){return this.checkReady(),JSON.parse(this.inner.debugUnreachablePath(e,t))}getMajorJunctions(){return this.checkReady(),JSON.parse(this.inner.getMajorJunctions())}checkReady(){if(!this.inner)throw new Error("Backend used without a file loaded")}}let U1="MZEJTanw3WpxRvt7qDfo",Md=Mi(""),sn=Mi({kind:"main"}),ps=Mi("Primary"),h4=Mi(null),eh=Mi(0),In=Mi(null),aa=Mi(null),Ya=Mi(null),Mp=Mi("infra_type"),Jp=[["SegregatedWide","Segregated Track (wide)","#054d05"],["OffRoad","Off Road Cycleway","#3a9120"],["SegregatedNarrow","Segregated Track (narrow)","#87d668"],["SharedFootway","Shared Footway","#ffbf00"],["CycleLane","Painted Cycle Lane","#FF0000"],["MixedTraffic","Mixed traffic","#EFD1C5"],["Unknown","Unknown","blue"]],uc=Object.fromEntries(Jp.map(([o,e,t])=>[o,[e,t]]));async function th(){let o=xd(In),e=xd(Md);if(!o||!e)return;let t=await o.toSavefile();window.localStorage.setItem(`tmp-npt-editor/${e}`,t)}let Ap=Mi(!0);function bc(o){return xd(Ap)?`https://assets.od2net.org/tmp_npt_editor/${o}`:o}let vy=Mi(null);function d4(o){let e,t,n,l,u,d,a,g;return{c(){e=ee("div"),t=ee("h2"),t.textContent="Debug network mode",n=we(),l=ee("button"),l.textContent="Back",u=we(),d=ee("p"),d.textContent="Hover to see a segment's properties, and click to open OSM",Pe(e,"slot","left")},m(b,k){J(b,e,k),F(e,t),F(e,n),F(e,l),F(e,u),F(e,d),a||(g=ft(l,"click",o[3]),a=!0)},p:Ze,d(b){b&&X(e),a=!1,g()}}}function f4(o){return{c:Ze,m:Ze,p:Ze,i:Ze,o:Ze,d:Ze}}function p4(o){let e,t;return e=new bn({props:{data:o[4],generateId:!0,$$slots:{default:[g4]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.data=n[4]),l&64&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function m4(o){let e,t;return e=new X3({props:{properties:o[5]}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&32&&(u.properties=n[5]),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function _4(o){let e,t;return e=new mr({props:{openOn:"hover",$$slots:{default:[m4,({props:n})=>({5:n}),({props:n})=>n?32:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&96&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function g4(o){let e,t;return e=new vn({props:{paint:{"line-width":Jn(5,7),"line-color":"black"},manageHoverState:!0,hoverCursor:"pointer",eventsIfTopMost:!0,$$slots:{default:[_4]},$$scope:{ctx:o}}}),e.$on("click",o[2]),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&64&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function y4(o){return{c:Ze,m:Ze,p:Ze,i:Ze,o:Ze,d:Ze}}function b4(o){let e,t,n,l={ctx:o,current:null,token:null,hasCatch:!1,pending:y4,then:p4,catch:f4,value:4,blocks:[,,,]};return Ar(t=Mo(o[0]).renderDebug(),l),{c(){e=ee("div"),l.block.c(),Pe(e,"slot","map")},m(u,d){J(u,e,d),l.block.m(e,l.anchor=null),l.mount=()=>e,l.anchor=null,n=!0},p(u,d){o=u,l.ctx=o,d&1&&t!==(t=Mo(o[0]).renderDebug())&&Ar(t,l)||pa(l,o,d)},i(u){n||(ne(l.block),n=!0)},o(u){for(let d=0;d<3;d+=1){const a=l.blocks[d];he(a)}n=!1},d(u){u&&X(e),l.block.d(),l.token=null,l=null}}}function v4(o){let e,t;return e=new yc({props:{$$slots:{map:[b4],left:[d4]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,[l]){const u={};l&67&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function w4(o,e,t){let n,l;return bt(o,In,a=>t(0,n=a)),bt(o,sn,a=>t(1,l=a)),[n,l,a=>window.open(Mo(a.detail.features[0].properties).way,"_blank"),()=>oi(sn,l={kind:"main"},l)]}class x4 extends Wt{constructor(e){super(),Gt(this,e,w4,v4,Vt,{})}}function k4(o){let e,t,n,l,u,d;return{c(){e=ee("div"),t=ee("h2"),t.textContent="Debug mesh density mode",n=we(),l=ee("button"),l.textContent="Back",Pe(e,"slot","left")},m(a,g){J(a,e,g),F(e,t),F(e,n),F(e,l),u||(d=ft(l,"click",o[2]),u=!0)},p:Ze,d(a){a&&X(e),u=!1,d()}}}function S4(o){return{c:Ze,m:Ze,p:Ze,i:Ze,o:Ze,d:Ze}}function T4(o){let e,t;return e=new bn({props:{data:o[3],generateId:!0,$$slots:{default:[I4]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.data=n[3]),l&16&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function I4(o){let e,t,n,l;return e=new vn({props:{paint:{"line-color":"black"}}}),n=new gc({props:{paint:{"fill-color":"grey","fill-opacity":Jn(.5,1)},manageHoverState:!0}}),{c(){Ve(e.$$.fragment),t=we(),Ve(n.$$.fragment)},m(u,d){je(e,u,d),J(u,t,d),je(n,u,d),l=!0},p:Ze,i(u){l||(ne(e.$$.fragment,u),ne(n.$$.fragment,u),l=!0)},o(u){he(e.$$.fragment,u),he(n.$$.fragment,u),l=!1},d(u){u&&X(t),Ue(e,u),Ue(n,u)}}}function C4(o){return{c:Ze,m:Ze,p:Ze,i:Ze,o:Ze,d:Ze}}function E4(o){let e,t,n,l={ctx:o,current:null,token:null,hasCatch:!1,pending:C4,then:T4,catch:S4,value:3,blocks:[,,,]};return Ar(t=Mo(o[0]).meshDensity(),l),{c(){e=ee("div"),l.block.c(),Pe(e,"slot","map")},m(u,d){J(u,e,d),l.block.m(e,l.anchor=null),l.mount=()=>e,l.anchor=null,n=!0},p(u,d){o=u,l.ctx=o,d&1&&t!==(t=Mo(o[0]).meshDensity())&&Ar(t,l)||pa(l,o,d)},i(u){n||(ne(l.block),n=!0)},o(u){for(let d=0;d<3;d+=1){const a=l.blocks[d];he(a)}n=!1},d(u){u&&X(e),l.block.d(),l.token=null,l=null}}}function L4(o){let e,t;return e=new yc({props:{$$slots:{map:[E4],left:[k4]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,[l]){const u={};l&19&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function M4(o,e,t){let n,l;return bt(o,In,d=>t(0,n=d)),bt(o,sn,d=>t(1,l=d)),[n,l,()=>oi(sn,l={kind:"main"},l)]}class A4 extends Wt{constructor(e){super(),Gt(this,e,M4,L4,Vt,{})}}let $1=Mi(new Map),Pp=Mi(!0),Ad=Mi(!1),Pd=Mi(!1),zd=Mi(!1),Dd=Mi(!1),Rd=Mi(!1),rc=Mi(!1),zp=Mi(!0),wy=Mi(!1);function P4(o){let e,t,n,l;const u=o[1].default,d=fn(u,o,o[0],null);return{c(){e=ee("a"),d&&d.c(),Pe(e,"href","#")},m(a,g){J(a,e,g),d&&d.m(e,null),t=!0,n||(l=ft(e,"click",ih(o[2])),n=!0)},p(a,[g]){d&&d.p&&(!t||g&1)&&mn(d,u,a,a[0],t?pn(u,a[0],g,null):_n(a[0]),null)},i(a){t||(ne(d,a),t=!0)},o(a){he(d,a),t=!1},d(a){a&&X(e),d&&d.d(a),n=!1,l()}}}function z4(o,e,t){let{$$slots:n={},$$scope:l}=e;function u(d){zn.call(this,o,d)}return o.$$set=d=>{"$$scope"in d&&t(0,l=d.$$scope)},[l,n,u]}class D4 extends Wt{constructor(e){super(),Gt(this,e,z4,P4,Vt,{})}}let Kn={Primary:"#c00000",Secondary:"#e97132",LocalAccess:"#ffc000",LongDistance:"#4ea72e"},Yp={High:"mediumseagreen",Medium:"orange",Low:"red",ShouldNotBeUsed:"brown"},V1={"<= 3%":"#59ee19","3 - 5%":"#37a009","5 - 7%":"#FFC300","7 - 10%":"#C70039","> 10%":"#581845"},fa=ba(["get","infra_type"],Object.fromEntries(Jp.map(o=>[o[0],o[2]])),"red"),Dp=ba(["get","tier"],Kn,"cyan"),Rp=ba(["get","los"],Yp,"black"),xy=ba(["get","gradient_group"],V1,"black");function ky(o){let e,t,n,l,u=`2px solid ${Kn.Primary}`;return{c(){e=ee("details"),t=ee("summary"),t.textContent="Primary Route Reference Layers",n=we(),l=ee("div"),e.open=!0,mi(e,"border",u)},m(d,a){J(d,e,a),F(e,t),F(e,n),F(e,l),o[8](l)},p:Ze,d(d){d&&X(e),o[8](null)}}}function Sy(o){let e,t,n,l,u=`2px solid ${Kn.Secondary}`;return{c(){e=ee("details"),t=ee("summary"),t.textContent="Secondary Route Reference Layers",n=we(),l=ee("div"),e.open=!0,mi(e,"border",u)},m(d,a){J(d,e,a),F(e,t),F(e,n),F(e,l),o[9](l)},p:Ze,d(d){d&&X(e),o[9](null)}}}function Ty(o){let e,t,n,l,u=`2px solid ${Kn.LocalAccess}`;return{c(){e=ee("details"),t=ee("summary"),t.textContent="Local Access Route Reference Layers",n=we(),l=ee("div"),e.open=!0,mi(e,"border",u)},m(d,a){J(d,e,a),F(e,t),F(e,n),F(e,l),o[10](l)},p:Ze,d(d){d&&X(e),o[10](null)}}}function Iy(o){let e,t,n,l,u=`2px solid ${Kn.LongDistance}`;return{c(){e=ee("details"),t=ee("summary"),t.textContent="Long Disance Route Reference Layers",n=we(),l=ee("div"),e.open=!0,mi(e,"border",u)},m(d,a){J(d,e,a),F(e,t),F(e,n),F(e,l),o[11](l)},p:Ze,d(d){d&&X(e),o[11](null)}}}function R4(o){let e,t,n,l,u,d,a,g,b,k=o[5]=="Primary"&&ky(o),S=o[5]=="Secondary"&&Sy(o),L=o[5]=="LocalAccess"&&Ty(o),P=o[5]=="LongDistance"&&Iy(o);return{c(){e=ee("details"),t=ee("summary"),t.textContent="Basic Reference Layers",n=we(),l=ee("div"),u=we(),k&&k.c(),d=we(),S&&S.c(),a=we(),L&&L.c(),g=we(),P&&P.c(),b=Ei(),e.open=!0,mi(e,"border","2px solid black")},m(R,Z){J(R,e,Z),F(e,t),F(e,n),F(e,l),o[7](l),J(R,u,Z),k&&k.m(R,Z),J(R,d,Z),S&&S.m(R,Z),J(R,a,Z),L&&L.m(R,Z),J(R,g,Z),P&&P.m(R,Z),J(R,b,Z)},p(R,[Z]){R[5]=="Primary"?k?k.p(R,Z):(k=ky(R),k.c(),k.m(d.parentNode,d)):k&&(k.d(1),k=null),R[5]=="Secondary"?S?S.p(R,Z):(S=Sy(R),S.c(),S.m(a.parentNode,a)):S&&(S.d(1),S=null),R[5]=="LocalAccess"?L?L.p(R,Z):(L=Ty(R),L.c(),L.m(g.parentNode,g)):L&&(L.d(1),L=null),R[5]=="LongDistance"?P?P.p(R,Z):(P=Iy(R),P.c(),P.m(b.parentNode,b)):P&&(P.d(1),P=null)},i:Ze,o:Ze,d(R){R&&(X(e),X(u),X(d),X(a),X(g),X(b)),o[7](null),k&&k.d(R),S&&S.d(R),L&&L.d(R),P&&P.d(R)}}}function Fu(o,e,t){if(o){o.innerHTML="";for(let n of t){let l=e.get(n);l&&o.appendChild(l)}}}function F4(o,e,t){let n,l;bt(o,$1,Z=>t(6,n=Z)),bt(o,ps,Z=>t(5,l=Z));let u=null,d=null,a=null,g=null,b=null;function k(Z){Ai[Z?"unshift":"push"](()=>{u=Z,t(0,u)})}function S(Z){Ai[Z?"unshift":"push"](()=>{d=Z,t(1,d)})}function L(Z){Ai[Z?"unshift":"push"](()=>{a=Z,t(2,a)})}function P(Z){Ai[Z?"unshift":"push"](()=>{g=Z,t(3,g)})}function R(Z){Ai[Z?"unshift":"push"](()=>{b=Z,t(4,b)})}return o.$$.update=()=>{o.$$.dirty&65&&Fu(u,n,["route network","simd","population density","core network","existing network","level of service","traffic volume","gradient","reachable network"]),o.$$.dirty&66&&Fu(d,n,["high npt route coverage"]),o.$$.dirty&68&&Fu(a,n,["town centres"]),o.$$.dirty&72&&Fu(g,n,["schools","gp hospitals"]),o.$$.dirty&80&&Fu(b,n,["urban areas"])},[u,d,a,g,b,l,n,k,S,L,P,R]}class B4 extends Wt{constructor(e){super(),Gt(this,e,F4,R4,Vt,{})}}function O4(o){let e,t,n,l,u,d=Math.round(o[2]*100)+"",a,g,b,k,S,L,P;return{c(){e=ee("p"),t=ee("a"),n=be(o[1]),l=be(`
  :
  `),u=ee("b"),a=be(d),g=be("%"),b=we(),k=ee("progress"),Pe(t,"href","#"),k.value=S=o[2]*100,Pe(k,"max","100")},m(R,Z){J(R,e,Z),F(e,t),F(t,n),F(e,l),F(e,u),F(u,a),F(u,g),F(e,b),F(e,k),L||(P=ft(t,"click",ih(o[3])),L=!0)},p(R,[Z]){Z&2&&pt(n,R[1]),Z&4&&d!==(d=Math.round(R[2]*100)+"")&&pt(a,d),Z&4&&S!==(S=R[2]*100)&&(k.value=S)},i:Ze,o:Ze,d(R){R&&X(e),L=!1,P()}}}function N4(o,e,t){let{label:n}=e,{showLayer:l}=e,{pct:u}=e;const d=()=>t(0,l=!0);return o.$$set=a=>{"label"in a&&t(1,n=a.label),"showLayer"in a&&t(0,l=a.showLayer),"pct"in a&&t(2,u=a.pct)},[l,n,u,d]}class ms extends Wt{constructor(e){super(),Gt(this,e,N4,O4,Vt,{label:1,showLayer:0,pct:2})}}function Cy(o,e,t){const n=o.slice();return n[22]=e[t][0],n[23]=e[t][1],n}function Ey(o,e,t){const n=o.slice();return n[22]=e[t][0],n[23]=e[t][1],n}function Ly(o){let e,t,n,l=`2px solid ${Kn.Primary}`,u,d,a,g,b,k,S,L,P=o[0].average_weighted_directness.toFixed(1)+"",R,Z,$,H,G,K,le,Se,Le,te,Y,ue,fe,ce,ae;function We(et){o[11](et)}let Ee={label:"High cycling flow coverage",pct:hc(o[0].covered_flow_quintile_sums[0],o[0].total_flow_quintile_sums[0])};o[1]!==void 0&&(Ee.showLayer=o[1]),t=new ms({props:Ee}),Ai.push(()=>Zn(t,"showLayer",We));let ze=(o[2]=="Secondary"||o[2]=="LocalAccess"||o[2]=="LongDistance")&&My(o),rt=(o[2]=="LocalAccess"||o[2]=="LongDistance")&&Ay(o),it=o[2]=="LongDistance"&&Py(o),Qe=bi(Object.entries(o[0].od_percents_infra_type).toSorted(Ry)),Ft=[];for(let et=0;et<Qe.length;et+=1)Ft[et]=zy(Ey(o,Qe,et));let jt=bi(Object.entries(o[0].od_percents_los).toSorted(Fy)),ut=[];for(let et=0;et<jt.length;et+=1)ut[et]=Dy(Cy(o,jt,et));return{c(){e=ee("div"),Ve(t.$$.fragment),u=we(),ze&&ze.c(),d=we(),rt&&rt.c(),a=we(),it&&it.c(),g=we(),b=ee("div"),k=ee("p"),S=ee("a"),S.textContent="Average weighted directness",L=be(`
      : `),R=be(P),Z=be("x"),$=we(),H=ee("details"),G=ee("summary"),G.textContent="Percent of demand by infrastructure type",K=we(),le=ee("ul");for(let et=0;et<Ft.length;et+=1)Ft[et].c();Se=we(),Le=ee("details"),te=ee("summary"),te.textContent="Percent of demand by level of service:",Y=we(),ue=ee("ul");for(let et=0;et<ut.length;et+=1)ut[et].c();mi(e,"border",l),Pe(S,"href","#"),mi(b,"margin-top","4px"),mi(b,"border","2px solid black")},m(et,at){J(et,e,at),je(t,e,null),J(et,u,at),ze&&ze.m(et,at),J(et,d,at),rt&&rt.m(et,at),J(et,a,at),it&&it.m(et,at),J(et,g,at),J(et,b,at),F(b,k),F(k,S),F(k,L),F(k,R),F(k,Z),F(b,$),F(b,H),F(H,G),F(H,K),F(H,le);for(let Bt=0;Bt<Ft.length;Bt+=1)Ft[Bt]&&Ft[Bt].m(le,null);F(b,Se),F(b,Le),F(Le,te),F(Le,Y),F(Le,ue);for(let Bt=0;Bt<ut.length;Bt+=1)ut[Bt]&&ut[Bt].m(ue,null);fe=!0,ce||(ae=ft(S,"click",ih(o[20])),ce=!0)},p(et,at){const Bt={};if(at&1&&(Bt.pct=hc(et[0].covered_flow_quintile_sums[0],et[0].total_flow_quintile_sums[0])),!n&&at&2&&(n=!0,Bt.showLayer=et[1],qn(()=>n=!1)),t.$set(Bt),et[2]=="Secondary"||et[2]=="LocalAccess"||et[2]=="LongDistance"?ze?(ze.p(et,at),at&4&&ne(ze,1)):(ze=My(et),ze.c(),ne(ze,1),ze.m(d.parentNode,d)):ze&&(ui(),he(ze,1,1,()=>{ze=null}),hi()),et[2]=="LocalAccess"||et[2]=="LongDistance"?rt?(rt.p(et,at),at&4&&ne(rt,1)):(rt=Ay(et),rt.c(),ne(rt,1),rt.m(a.parentNode,a)):rt&&(ui(),he(rt,1,1,()=>{rt=null}),hi()),et[2]=="LongDistance"?it?(it.p(et,at),at&4&&ne(it,1)):(it=Py(et),it.c(),ne(it,1),it.m(g.parentNode,g)):it&&(ui(),he(it,1,1,()=>{it=null}),hi()),(!fe||at&1)&&P!==(P=et[0].average_weighted_directness.toFixed(1)+"")&&pt(R,P),at&1){Qe=bi(Object.entries(et[0].od_percents_infra_type).toSorted(Ry));let Dt;for(Dt=0;Dt<Qe.length;Dt+=1){const Ht=Ey(et,Qe,Dt);Ft[Dt]?Ft[Dt].p(Ht,at):(Ft[Dt]=zy(Ht),Ft[Dt].c(),Ft[Dt].m(le,null))}for(;Dt<Ft.length;Dt+=1)Ft[Dt].d(1);Ft.length=Qe.length}if(at&1){jt=bi(Object.entries(et[0].od_percents_los).toSorted(Fy));let Dt;for(Dt=0;Dt<jt.length;Dt+=1){const Ht=Cy(et,jt,Dt);ut[Dt]?ut[Dt].p(Ht,at):(ut[Dt]=Dy(Ht),ut[Dt].c(),ut[Dt].m(ue,null))}for(;Dt<ut.length;Dt+=1)ut[Dt].d(1);ut.length=jt.length}},i(et){fe||(ne(t.$$.fragment,et),ne(ze),ne(rt),ne(it),fe=!0)},o(et){he(t.$$.fragment,et),he(ze),he(rt),he(it),fe=!1},d(et){et&&(X(e),X(u),X(d),X(a),X(g),X(b)),Ue(t),ze&&ze.d(et),rt&&rt.d(et),it&&it.d(et),Bn(Ft,et),Bn(ut,et),ce=!1,ae()}}}function My(o){let e,t,n,l,u,d,a=`2px solid ${Kn.Secondary}`,g;function b(P){o[12](P)}let k={label:"Medium cycling flow coverage",pct:hc(o[0].covered_flow_quintile_sums[1],o[0].total_flow_quintile_sums[1])};o[1]!==void 0&&(k.showLayer=o[1]),t=new ms({props:k}),Ai.push(()=>Zn(t,"showLayer",b));function S(P){o[13](P)}let L={label:"Town centres",pct:o[0].percent_reachable_town_centres};return o[3]!==void 0&&(L.showLayer=o[3]),u=new ms({props:L}),Ai.push(()=>Zn(u,"showLayer",S)),{c(){e=ee("div"),Ve(t.$$.fragment),l=we(),Ve(u.$$.fragment),mi(e,"margin-top","4px"),mi(e,"border",a)},m(P,R){J(P,e,R),je(t,e,null),F(e,l),je(u,e,null),g=!0},p(P,R){const Z={};R&1&&(Z.pct=hc(P[0].covered_flow_quintile_sums[1],P[0].total_flow_quintile_sums[1])),!n&&R&2&&(n=!0,Z.showLayer=P[1],qn(()=>n=!1)),t.$set(Z);const $={};R&1&&($.pct=P[0].percent_reachable_town_centres),!d&&R&8&&(d=!0,$.showLayer=P[3],qn(()=>d=!1)),u.$set($)},i(P){g||(ne(t.$$.fragment,P),ne(u.$$.fragment,P),g=!0)},o(P){he(t.$$.fragment,P),he(u.$$.fragment,P),g=!1},d(P){P&&X(e),Ue(t),Ue(u)}}}function Ay(o){let e,t,n,l,u,d,a,g,b,k,S,L,P,R,Z,$=`2px solid ${Kn.LocalAccess}`,H;function G(ae){o[14](ae)}let K={label:"Low cycling flow coverage",pct:hc(o[0].covered_flow_quintile_sums[2],o[0].total_flow_quintile_sums[2])};o[1]!==void 0&&(K.showLayer=o[1]),t=new ms({props:K}),Ai.push(()=>Zn(t,"showLayer",G));function le(ae){o[15](ae)}let Se={label:"Schools",pct:o[0].percent_reachable_schools};o[4]!==void 0&&(Se.showLayer=o[4]),u=new ms({props:Se}),Ai.push(()=>Zn(u,"showLayer",le));function Le(ae){o[16](ae)}let te={label:"GPs and hospitals",pct:o[0].percent_reachable_gp_hospitals};o[5]!==void 0&&(te.showLayer=o[5]),g=new ms({props:te}),Ai.push(()=>Zn(g,"showLayer",Le));function Y(ae){o[17](ae)}let ue={label:"Deprived population coverage",pct:o[0].percent_reachable_imd_population};o[6]!==void 0&&(ue.showLayer=o[6]),S=new ms({props:ue}),Ai.push(()=>Zn(S,"showLayer",Y));function fe(ae){o[18](ae)}let ce={label:"Population coverage",pct:o[0].percent_reachable_population};return o[7]!==void 0&&(ce.showLayer=o[7]),R=new ms({props:ce}),Ai.push(()=>Zn(R,"showLayer",fe)),{c(){e=ee("div"),Ve(t.$$.fragment),l=we(),Ve(u.$$.fragment),a=we(),Ve(g.$$.fragment),k=we(),Ve(S.$$.fragment),P=we(),Ve(R.$$.fragment),mi(e,"margin-top","4px"),mi(e,"border",$)},m(ae,We){J(ae,e,We),je(t,e,null),F(e,l),je(u,e,null),F(e,a),je(g,e,null),F(e,k),je(S,e,null),F(e,P),je(R,e,null),H=!0},p(ae,We){const Ee={};We&1&&(Ee.pct=hc(ae[0].covered_flow_quintile_sums[2],ae[0].total_flow_quintile_sums[2])),!n&&We&2&&(n=!0,Ee.showLayer=ae[1],qn(()=>n=!1)),t.$set(Ee);const ze={};We&1&&(ze.pct=ae[0].percent_reachable_schools),!d&&We&16&&(d=!0,ze.showLayer=ae[4],qn(()=>d=!1)),u.$set(ze);const rt={};We&1&&(rt.pct=ae[0].percent_reachable_gp_hospitals),!b&&We&32&&(b=!0,rt.showLayer=ae[5],qn(()=>b=!1)),g.$set(rt);const it={};We&1&&(it.pct=ae[0].percent_reachable_imd_population),!L&&We&64&&(L=!0,it.showLayer=ae[6],qn(()=>L=!1)),S.$set(it);const Qe={};We&1&&(Qe.pct=ae[0].percent_reachable_population),!Z&&We&128&&(Z=!0,Qe.showLayer=ae[7],qn(()=>Z=!1)),R.$set(Qe)},i(ae){H||(ne(t.$$.fragment,ae),ne(u.$$.fragment,ae),ne(g.$$.fragment,ae),ne(S.$$.fragment,ae),ne(R.$$.fragment,ae),H=!0)},o(ae){he(t.$$.fragment,ae),he(u.$$.fragment,ae),he(g.$$.fragment,ae),he(S.$$.fragment,ae),he(R.$$.fragment,ae),H=!1},d(ae){ae&&X(e),Ue(t),Ue(u),Ue(g),Ue(S),Ue(R)}}}function Py(o){let e,t,n,l=`2px solid ${Kn.LongDistance}`,u;function d(g){o[19](g)}let a={label:"Reachable settlements (TODO)",pct:0};return o[8]!==void 0&&(a.showLayer=o[8]),t=new ms({props:a}),Ai.push(()=>Zn(t,"showLayer",d)),{c(){e=ee("div"),Ve(t.$$.fragment),mi(e,"margin-top","4px"),mi(e,"border",l)},m(g,b){J(g,e,b),je(t,e,null),u=!0},p(g,b){const k={};!n&&b&256&&(n=!0,k.showLayer=g[8],qn(()=>n=!1)),t.$set(k)},i(g){u||(ne(t.$$.fragment,g),u=!0)},o(g){he(t.$$.fragment,g),u=!1},d(g){g&&X(e),Ue(t)}}}function zy(o){let e,t=o[22]+"",n,l,u=Math.round(o[23]*100)+"",d,a;return{c(){e=ee("li"),n=be(t),l=be(": "),d=be(u),a=be("%")},m(g,b){J(g,e,b),F(e,n),F(e,l),F(e,d),F(e,a)},p(g,b){b&1&&t!==(t=g[22]+"")&&pt(n,t),b&1&&u!==(u=Math.round(g[23]*100)+"")&&pt(d,u)},d(g){g&&X(e)}}}function Dy(o){let e,t=o[22]+"",n,l,u=Math.round(o[23]*100)+"",d,a;return{c(){e=ee("li"),n=be(t),l=be(": "),d=be(u),a=be("%")},m(g,b){J(g,e,b),F(e,n),F(e,l),F(e,d),F(e,a)},p(g,b){b&1&&t!==(t=g[22]+"")&&pt(n,t),b&1&&u!==(u=Math.round(g[23]*100)+"")&&pt(d,u)},d(g){g&&X(e)}}}function j4(o){let e,t,n,l,u,d,a=o[0]&&Ly(o);return{c(){e=ee("button"),e.textContent="Recalculate",t=we(),a&&a.c(),n=Ei()},m(g,b){J(g,e,b),J(g,t,b),a&&a.m(g,b),J(g,n,b),l=!0,u||(d=ft(e,"click",o[10]),u=!0)},p(g,[b]){g[0]?a?(a.p(g,b),b&1&&ne(a,1)):(a=Ly(g),a.c(),ne(a,1),a.m(n.parentNode,n)):a&&(ui(),he(a,1,1,()=>{a=null}),hi())},i(g){l||(ne(a),l=!0)},o(g){he(a),l=!1},d(g){g&&(X(e),X(t),X(n)),a&&a.d(g),u=!1,d()}}}function hc(o,e){return e==0?0:o/e}const Ry=(o,e)=>e[1]-o[1],Fy=(o,e)=>e[1]-o[1];function U4(o,e,t){let n,l,u,d,a,g,b,k,S,L,P;bt(o,vy,ue=>t(0,n=ue)),bt(o,In,ue=>t(21,l=ue)),bt(o,rc,ue=>t(1,u=ue)),bt(o,ps,ue=>t(2,d=ue)),bt(o,zd,ue=>t(3,a=ue)),bt(o,Ad,ue=>t(4,g=ue)),bt(o,Pd,ue=>t(5,b=ue)),bt(o,Dd,ue=>t(6,k=ue)),bt(o,Rd,ue=>t(7,S=ue)),bt(o,wy,ue=>t(8,L=ue)),bt(o,sn,ue=>t(9,P=ue));async function R(){oi(vy,n=await l.recalculateStats(),n)}fc(async()=>{n==null&&await R()});function Z(ue){u=ue,rc.set(u)}function $(ue){u=ue,rc.set(u)}function H(ue){a=ue,zd.set(a)}function G(ue){u=ue,rc.set(u)}function K(ue){g=ue,Ad.set(g)}function le(ue){b=ue,Pd.set(b)}function Se(ue){k=ue,Dd.set(k)}function Le(ue){S=ue,Rd.set(S)}function te(ue){L=ue,wy.set(L)}return[n,u,d,a,g,b,k,S,L,P,R,Z,$,H,G,K,le,Se,Le,te,()=>oi(sn,P={kind:"evaluate-route",prevMode:{kind:"main"},browse:Mo(n).worst_directness_routes},P)]}class $4 extends Wt{constructor(e){super(),Gt(this,e,U4,j4,Vt,{})}}function By(o,e,t){const n=o.slice();return n[4]=e[t],n}function Oy(o){let e,t=o[4]+"",n;return{c(){e=ee("option"),n=be(t),e.__value=o[4],Vi(e,e.__value)},m(l,u){J(l,e,u),F(e,n)},p:Ze,d(l){l&&X(e)}}}function V4(o){let e,t,n,l,u,d=bi(o[1]),a=[];for(let g=0;g<d.length;g+=1)a[g]=Oy(By(o,d,g));return{c(){e=ee("label"),t=be(`Area:
  `),n=ee("select");for(let g=0;g<a.length;g+=1)a[g].c();o[0]===void 0&&Co(()=>o[3].call(n))},m(g,b){J(g,e,b),F(e,t),F(e,n);for(let k=0;k<a.length;k+=1)a[k]&&a[k].m(n,null);lr(n,o[0],!0),l||(u=[ft(n,"change",o[3]),ft(n,"change",o[2])],l=!0)},p(g,[b]){if(b&2){d=bi(g[1]);let k;for(k=0;k<d.length;k+=1){const S=By(g,d,k);a[k]?a[k].p(S,b):(a[k]=Oy(S),a[k].c(),a[k].m(n,null))}for(;k<a.length;k+=1)a[k].d(1);a.length=d.length}b&3&&lr(n,g[0])},i:Ze,o:Ze,d(g){g&&X(e),Bn(a,g),l=!1,an(u)}}}function q4(o,e,t){let{area:n}=e,l=["REGION_Aberdeen and North East","REGION_Edinburgh and Lothians","REGION_Glasgow and Strathclyde","REGION_Highlands and Islands","REGION_Scotland South","REGION_Tayside, Central and Fife","LAD_Clackmannanshire","LAD_Dumfries and Galloway","LAD_East Ayrshire","LAD_East Lothian","LAD_East Renfrewshire","LAD_Na h-Eileanan Siar","LAD_Falkirk","LAD_Highland","LAD_Inverclyde","LAD_Midlothian","LAD_Moray","LAD_North Ayrshire","LAD_Orkney Islands","LAD_Scottish Borders","LAD_Shetland Islands","LAD_South Ayrshire","LAD_South Lanarkshire","LAD_Stirling","LAD_Aberdeen City","LAD_Aberdeenshire","LAD_Argyll and Bute","LAD_City of Edinburgh","LAD_Renfrewshire","LAD_West Dunbartonshire","LAD_West Lothian","LAD_Angus","LAD_Dundee City","LAD_East Dunbartonshire","LAD_Fife","LAD_Perth and Kinross","LAD_Glasgow City","LAD_North Lanarkshire"];l.sort();function u(){window.location.href=`index.html?boundary=${n}`}function d(){n=gs(this),t(0,n),t(1,l)}return o.$$set=a=>{"area"in a&&t(0,n=a.area)},[n,l,u,d]}class Z4 extends Wt{constructor(e){super(),Gt(this,e,q4,V4,Vt,{area:0})}}const{window:G4}=J0;function Ny(o,e,t){const n=o.slice();return n[22]=e[t],n}function jy(o){let e,t,n=bi(o[0].features),l=[];for(let d=0;d<n.length;d+=1)l[d]=Uy(Ny(o,n,d));const u=d=>he(l[d],1,1,()=>{l[d]=null});return{c(){e=ee("ol");for(let d=0;d<l.length;d+=1)l[d].c()},m(d,a){J(d,e,a);for(let g=0;g<l.length;g+=1)l[g]&&l[g].m(e,null);t=!0},p(d,a){if(a&257){n=bi(d[0].features);let g;for(g=0;g<n.length;g+=1){const b=Ny(d,n,g);l[g]?(l[g].p(b,a),ne(l[g],1)):(l[g]=Uy(b),l[g].c(),ne(l[g],1),l[g].m(e,null))}for(ui(),g=n.length;g<l.length;g+=1)u(g);hi()}},i(d){if(!t){for(let a=0;a<n.length;a+=1)ne(l[a]);t=!0}},o(d){l=l.filter(Boolean);for(let a=0;a<l.length;a+=1)he(l[a]);t=!1},d(d){d&&X(e),Bn(l,d)}}}function W4(o){var a,g;let e=(((a=o[22].properties)==null?void 0:a.name)||`Untitled route ${o[22].id}`)+"",t,n,l=((g=o[22].properties)==null?void 0:g.infra_type)+"",u,d;return{c(){t=be(e),n=be(" ("),u=be(l),d=be(")")},m(b,k){J(b,t,k),J(b,n,k),J(b,u,k),J(b,d,k)},p(b,k){var S,L;k&1&&e!==(e=(((S=b[22].properties)==null?void 0:S.name)||`Untitled route ${b[22].id}`)+"")&&pt(t,e),k&1&&l!==(l=((L=b[22].properties)==null?void 0:L.infra_type)+"")&&pt(u,l)},d(b){b&&(X(t),X(n),X(u),X(d))}}}function Uy(o){let e,t,n,l;function u(){return o[18](o[22])}return t=new D4({props:{$$slots:{default:[W4]},$$scope:{ctx:o}}}),t.$on("click",u),{c(){e=ee("li"),Ve(t.$$.fragment),n=we()},m(d,a){J(d,e,a),je(t,e,null),F(e,n),l=!0},p(d,a){o=d;const g={};a&33554433&&(g.$$scope={dirty:a,ctx:o}),t.$set(g)},i(d){l||(ne(t.$$.fragment,d),l=!0)},o(d){he(t.$$.fragment,d),l=!1},d(d){d&&X(e),Ue(t)}}}function H4(o){let e,t,n,l,u,d,a,g,b,k,S,L,P,R,Z,$,H,G,K,le,Se,Le,te,Y,ue,fe,ce,ae;t=new Z4({props:{area:o[5]}});let We=o[0]&&jy(o);return ue=new B4({}),{c(){e=ee("div"),Ve(t.$$.fragment),n=we(),l=ee("div"),u=ee("button"),u.innerHTML=`Draw new <u>r</u>
        oute line`,d=we(),a=ee("button"),a.textContent="Clear all",g=we(),b=ee("label"),k=ee("input"),S=be(`
      Show current network`),L=we(),P=ee("details"),R=ee("summary"),R.textContent="Current network routes",Z=we(),$=ee("label"),H=be(`Show routes by:
        `),G=ee("select"),K=ee("option"),K.textContent="Infrastructure type",le=ee("option"),le.textContent="Tier",Se=we(),We&&We.c(),Le=we(),te=ee("hr"),Y=we(),Ve(ue.$$.fragment),Pe(a,"class","secondary"),Pe(k,"type","checkbox"),K.__value="infra_type",Vi(K,K.__value),le.__value="tier",Vi(le,le.__value),o[3]===void 0&&Co(()=>o[17].call(G)),Pe(e,"slot","left")},m(Ee,ze){J(Ee,e,ze),je(t,e,null),F(e,n),F(e,l),F(l,u),F(l,d),F(l,a),F(e,g),F(e,b),F(b,k),k.checked=o[4],F(b,S),F(e,L),F(e,P),F(P,R),F(P,Z),F(P,$),F($,H),F($,G),F(G,K),F(G,le),lr(G,o[3],!0),F(P,Se),We&&We.m(P,null),F(e,Le),F(e,te),F(e,Y),je(ue,e,null),fe=!0,ce||(ae=[ft(u,"click",o[15]),ft(a,"click",o[9]),ft(k,"change",o[16]),ft(G,"change",o[17])],ce=!0)},p(Ee,ze){const rt={};ze&32&&(rt.area=Ee[5]),t.$set(rt),ze&16&&(k.checked=Ee[4]),ze&8&&lr(G,Ee[3]),Ee[0]?We?(We.p(Ee,ze),ze&1&&ne(We,1)):(We=jy(Ee),We.c(),ne(We,1),We.m(P,null)):We&&(ui(),he(We,1,1,()=>{We=null}),hi())},i(Ee){fe||(ne(t.$$.fragment,Ee),ne(We),ne(ue.$$.fragment,Ee),fe=!0)},o(Ee){he(t.$$.fragment,Ee),he(We),he(ue.$$.fragment,Ee),fe=!1},d(Ee){Ee&&X(e),Ue(t),We&&We.d(),Ue(ue),ce=!1,an(ae)}}}function $y(o){let e,t;return e=new bn({props:{data:o[0],$$slots:{default:[J4]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.data=n[0]),l&33554460&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function X4(o){let e=(o[21].name||"Untitled")+"",t,n,l=uc[o[21].infra_type][0]+"",u,d,a=o[21].tier+"",g,b;return{c(){t=be(e),n=be(" ("),u=be(l),d=be(`,
            `),g=be(a),b=be(")")},m(k,S){J(k,t,S),J(k,n,S),J(k,u,S),J(k,d,S),J(k,g,S),J(k,b,S)},p(k,S){S&2097152&&e!==(e=(k[21].name||"Untitled")+"")&&pt(t,e),S&2097152&&l!==(l=uc[k[21].infra_type][0]+"")&&pt(u,l),S&2097152&&a!==(a=k[21].tier+"")&&pt(g,a)},d(k){k&&(X(t),X(n),X(u),X(d),X(g),X(b))}}}function K4(o){let e,t;return e=new mr({props:{openOn:"hover",$$slots:{default:[X4,({props:n})=>({21:n}),({props:n})=>n?2097152:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&35651584&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function J4(o){let e,t;return e=new vn({props:{paint:{"line-width":["case",["==",["get","tier"],o[2]],Jn(5,7),Jn(3,5)],"line-color":o[3]=="infra_type"?fa:Dp},layout:{visibility:o[4]?"visible":"none"},manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[K4]},$$scope:{ctx:o}}}),e.$on("click",o[7]),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&12&&(u.paint={"line-width":["case",["==",["get","tier"],n[2]],Jn(5,7),Jn(3,5)],"line-color":n[3]=="infra_type"?fa:Dp}),l&16&&(u.layout={visibility:n[4]?"visible":"none"}),l&33554432&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function Y4(o){let e,t,n=o[0]&&$y(o);return{c(){e=ee("div"),n&&n.c(),Pe(e,"slot","map")},m(l,u){J(l,e,u),n&&n.m(e,null),t=!0},p(l,u){l[0]?n?(n.p(l,u),u&1&&ne(n,1)):(n=$y(l),n.c(),ne(n,1),n.m(e,null)):n&&(ui(),he(n,1,1,()=>{n=null}),hi())},i(l){t||(ne(n),t=!0)},o(l){he(n),t=!1},d(l){l&&X(e),n&&n.d()}}}function Q4(o){let e,t,n,l,u,d,a,g,b,k,S,L,P,R,Z,$,H;return t=new $4({}),{c(){e=ee("div"),Ve(t.$$.fragment),n=we(),l=ee("div"),u=ee("button"),u.textContent="Evaluate a route",d=we(),a=ee("div"),g=ee("button"),g.textContent="Evaluate OD",b=we(),k=ee("div"),S=ee("button"),S.textContent="Debug network",L=we(),P=ee("div"),R=ee("button"),R.textContent="Debug mesh density",Pe(u,"class","secondary"),Pe(g,"class","secondary"),Pe(S,"class","secondary"),Pe(R,"class","secondary"),Pe(e,"slot","right")},m(G,K){J(G,e,K),je(t,e,null),F(e,n),F(e,l),F(l,u),F(e,d),F(e,a),F(a,g),F(e,b),F(e,k),F(k,S),F(e,L),F(e,P),F(P,R),Z=!0,$||(H=[ft(u,"click",o[11]),ft(g,"click",o[12]),ft(S,"click",o[13]),ft(R,"click",o[14])],$=!0)},p:Ze,i(G){Z||(ne(t.$$.fragment,G),Z=!0)},o(G){he(t.$$.fragment,G),Z=!1},d(G){G&&X(e),Ue(t),$=!1,an(H)}}}function eS(o){let e,t,n,l;return e=new yc({props:{$$slots:{right:[Q4],map:[Y4],left:[H4]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0,n||(l=ft(G4,"keydown",o[6]),n=!0)},p(u,[d]){const a={};d&33554495&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){Ue(e,u),n=!1,l()}}}function tS(o,e,t){let n,l,u,d,a,g,b;bt(o,In,Y=>t(19,n=Y)),bt(o,sn,Y=>t(1,l=Y)),bt(o,eh,Y=>t(10,u=Y)),bt(o,ps,Y=>t(2,d=Y)),bt(o,Mp,Y=>t(3,a=Y)),bt(o,Pp,Y=>t(4,g=Y)),bt(o,Md,Y=>t(5,b=Y));let k=null;fc(S);async function S(){t(0,k=await n.renderRoutes())}function L(Y){Y.key=="r"&&(Y.preventDefault(),oi(sn,l={kind:"edit-route",id:null},l))}function P(Y){oi(sn,l={kind:"edit-route",id:Y.detail.features[0].id},l)}function R(Y){oi(sn,l={kind:"edit-route",id:Y},l)}async function Z(){window.confirm("Clear everything? You can't undo this")&&(await(n==null?void 0:n.clearAllRoutes()),await th(),await S())}const $=()=>oi(sn,l={kind:"evaluate-route",prevMode:{kind:"main"},browse:[]},l),H=()=>oi(sn,l={kind:"evaluate-od"},l),G=()=>oi(sn,l={kind:"debug-network"},l),K=()=>oi(sn,l={kind:"debug-mesh-density"},l),le=()=>oi(sn,l={kind:"edit-route",id:null},l);function Se(){g=this.checked,Pp.set(g)}function Le(){a=gs(this),Mp.set(a)}const te=Y=>R(Y.id);return o.$$.update=()=>{o.$$.dirty&1024&&u>0&&S()},[k,l,d,a,g,b,L,P,R,Z,u,$,H,G,K,le,Se,Le,te]}class iS extends Wt{constructor(e){super(),Gt(this,e,tS,eS,Vt,{})}}function Vy(o,e,t){const n=o.slice();return n[2]=e[t][0],n[3]=e[t][1],n}function nS(o,e,t){const n=o.slice();return n[1]=e[t][0],n[2]=e[t][1],n[3]=e[t][2],n}function rS(o){let e,t=bi(Object.entries(Kn)),n=[];for(let l=0;l<t.length;l+=1)n[l]=qy(Vy(o,t,l));return{c(){for(let l=0;l<n.length;l+=1)n[l].c();e=Ei()},m(l,u){for(let d=0;d<n.length;d+=1)n[d]&&n[d].m(l,u);J(l,e,u)},p(l,u){if(u&0){t=bi(Object.entries(Kn));let d;for(d=0;d<t.length;d+=1){const a=Vy(l,t,d);n[d]?n[d].p(a,u):(n[d]=qy(a),n[d].c(),n[d].m(e.parentNode,e))}for(;d<n.length;d+=1)n[d].d(1);n.length=t.length}},d(l){l&&X(e),Bn(n,l)}}}function oS(o){let e,t=bi(Jp),n=[];for(let l=0;l<t.length;l+=1)n[l]=sS(nS(o,t,l));return{c(){for(let l=0;l<n.length;l+=1)n[l].c();e=Ei()},m(l,u){for(let d=0;d<n.length;d+=1)n[d]&&n[d].m(l,u);J(l,e,u)},p:Ze,d(l){l&&X(e),Bn(n,l)}}}function qy(o){let e,t,n;return{c(){e=ee("span"),e.textContent=`${o[2]}`,t=we(),n=ee("br"),mi(e,"color",o[3])},m(l,u){J(l,e,u),J(l,t,u),J(l,n,u)},p:Ze,d(l){l&&(X(e),X(t),X(n))}}}function sS(o){let e,t,n;return{c(){e=ee("span"),e.textContent=`${o[2]}`,t=we(),n=ee("br"),mi(e,"color",o[3])},m(l,u){J(l,e,u),J(l,t,u),J(l,n,u)},p:Ze,d(l){l&&(X(e),X(t),X(n))}}}function aS(o){let e,t,n,l;function u(g,b){return g[0]=="infra_type"?oS:rS}let d=u(o),a=d(o);return{c(){e=ee("div"),t=ee("details"),n=ee("summary"),n.textContent="Legend",l=we(),a.c(),Pe(e,"class","svelte-1oq1sox")},m(g,b){J(g,e,b),F(e,t),F(t,n),F(t,l),a.m(t,null)},p(g,[b]){d===(d=u(g))&&a?a.p(g,b):(a.d(1),a=d(g),a&&(a.c(),a.m(t,null)))},i:Ze,o:Ze,d(g){g&&X(e),a.d()}}}function lS(o,e,t){let n;return bt(o,Mp,l=>t(0,n=l)),[n]}class cS extends Wt{constructor(e){super(),Gt(this,e,lS,aS,Vt,{})}}const uS="/npw/assets/help-d011708a.svg";function Zy(o){let e,t;return e=new O1({props:{$$slots:{default:[hS]},$$scope:{ctx:o}}}),e.$on("close",o[3]),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&16&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function hS(o){let e,t,n;const l=o[1].default,u=fn(l,o,o[4],null);return{c(){e=ee("h2"),e.textContent="Help",t=we(),u&&u.c()},m(d,a){J(d,e,a),J(d,t,a),u&&u.m(d,a),n=!0},p(d,a){u&&u.p&&(!n||a&16)&&mn(u,l,d,d[4],n?pn(l,d[4],a,null):_n(d[4]),null)},i(d){n||(ne(u,d),n=!0)},o(d){he(u,d),n=!1},d(d){d&&(X(e),X(t)),u&&u.d(d)}}}function dS(o){let e,t,n,l,u,d,a=o[0]&&Zy(o);return{c(){e=ee("button"),e.innerHTML=`<img src="${uS}" title="Help" alt="Help"/>`,t=we(),a&&a.c(),n=Ei(),Pe(e,"class","svelte-gb6dzm")},m(g,b){J(g,e,b),J(g,t,b),a&&a.m(g,b),J(g,n,b),l=!0,u||(d=ft(e,"click",o[2]),u=!0)},p(g,[b]){g[0]?a?(a.p(g,b),b&1&&ne(a,1)):(a=Zy(g),a.c(),ne(a,1),a.m(n.parentNode,n)):a&&(ui(),he(a,1,1,()=>{a=null}),hi())},i(g){l||(ne(a),l=!0)},o(g){he(a),l=!1},d(g){g&&(X(e),X(t),X(n)),a&&a.d(g),u=!1,d()}}}function fS(o,e,t){let{$$slots:n={},$$scope:l}=e,u=!1;const d=()=>t(0,u=!0),a=()=>t(0,u=!1);return o.$$set=g=>{"$$scope"in g&&t(4,l=g.$$scope)},[u,n,d,a,l]}class q1 extends Wt{constructor(e){super(),Gt(this,e,fS,dS,Vt,{})}}function Gy(o,e,t){const n=o.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function Wy(o){let e,t,n,l=o[1]+"",u,d;return{c(){e=ee("li"),t=ee("span"),n=we(),u=be(l),d=we(),Pe(t,"class","svelte-kzgqtg"),mi(t,"background",o[2])},m(a,g){J(a,e,g),F(e,t),F(e,n),F(e,u),F(e,d)},p(a,g){g&1&&mi(t,"background",a[2]),g&1&&l!==(l=a[1]+"")&&pt(u,l)},d(a){a&&X(e)}}}function pS(o){let e,t=bi(Object.entries(o[0])),n=[];for(let l=0;l<t.length;l+=1)n[l]=Wy(Gy(o,t,l));return{c(){e=ee("ul");for(let l=0;l<n.length;l+=1)n[l].c()},m(l,u){J(l,e,u);for(let d=0;d<n.length;d+=1)n[d]&&n[d].m(e,null)},p(l,[u]){if(u&1){t=bi(Object.entries(l[0]));let d;for(d=0;d<t.length;d+=1){const a=Gy(l,t,d);n[d]?n[d].p(a,u):(n[d]=Wy(a),n[d].c(),n[d].m(e,null))}for(;d<n.length;d+=1)n[d].d(1);n.length=t.length}},i:Ze,o:Ze,d(l){l&&X(e),Bn(n,l)}}}function mS(o,e,t){let{colors:n}=e;return o.$$set=l=>{"colors"in l&&t(0,n=l.colors)},[n]}class Qa extends Wt{constructor(e){super(),Gt(this,e,mS,pS,Vt,{colors:0})}}let qt;const Z1=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Z1.decode();let Nu=null;function Zu(){return(Nu===null||Nu.byteLength===0)&&(Nu=new Uint8Array(qt.memory.buffer)),Nu}function To(o,e){return o=o>>>0,Z1.decode(Zu().subarray(o,o+e))}const _s=new Array(128).fill(void 0);_s.push(void 0,null,!0,!1);let Gu=_s.length;function Pn(o){Gu===_s.length&&_s.push(_s.length+1);const e=Gu;return Gu=_s[e],_s[e]=o,e}function Ci(o){return _s[o]}function _S(o){o<132||(_s[o]=Gu,Gu=o)}function ic(o){const e=Ci(o);return _S(o),e}function up(o){return o==null}let ju=null;function gS(){return(ju===null||ju.byteLength===0)&&(ju=new Float64Array(qt.memory.buffer)),ju}let Uu=null;function Di(){return(Uu===null||Uu.byteLength===0)&&(Uu=new Int32Array(qt.memory.buffer)),Uu}let la=0;const wd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},yS=typeof wd.encodeInto=="function"?function(o,e){return wd.encodeInto(o,e)}:function(o,e){const t=wd.encode(o);return e.set(t),{read:o.length,written:t.length}};function hd(o,e,t){if(t===void 0){const a=wd.encode(o),g=e(a.length,1)>>>0;return Zu().subarray(g,g+a.length).set(a),la=a.length,g}let n=o.length,l=e(n,1)>>>0;const u=Zu();let d=0;for(;d<n;d++){const a=o.charCodeAt(d);if(a>127)break;u[l+d]=a}if(d!==n){d!==0&&(o=o.slice(d)),l=t(l,n,n=d+o.length*3,1)>>>0;const a=Zu().subarray(l+d,l+n),g=yS(o,a);d+=g.written}return la=d,l}function Fp(o){const e=typeof o;if(e=="number"||e=="boolean"||o==null)return`${o}`;if(e=="string")return`"${o}"`;if(e=="symbol"){const l=o.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=o.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(o)){const l=o.length;let u="[";l>0&&(u+=Fp(o[0]));for(let d=1;d<l;d++)u+=", "+Fp(o[d]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(o));let n;if(t.length>1)n=t[1];else return toString.call(o);if(n=="Object")try{return"Object("+JSON.stringify(o)+")"}catch{return"Object"}return o instanceof Error?`${o.name}: ${o.message}
${o.stack}`:n}function bS(o,e){const t=e(o.length*1,1)>>>0;return Zu().set(o,t/1),la=o.length,t}function hp(o,e){try{return o.apply(this,e)}catch(t){qt.__wbindgen_exn_store(Pn(t))}}class Fd{static __wrap(e){e=e>>>0;const t=Object.create(Fd.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();qt.__wbg_jsroutesnapper_free(e)}constructor(e){try{const u=qt.__wbindgen_add_to_stack_pointer(-16),d=bS(e,qt.__wbindgen_malloc),a=la;qt.jsroutesnapper_new(u,d,a);var t=Di()[u/4+0],n=Di()[u/4+1],l=Di()[u/4+2];if(l)throw ic(n);return Fd.__wrap(t)}finally{qt.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){qt.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Pn(e))}setAreaMode(){qt.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const u=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_getConfig(u,this.__wbg_ptr);var n=Di()[u/4+0],l=Di()[u/4+1];return e=n,t=l,To(n,l)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=Di()[n/4+0],t=Di()[n/4+1];let l;return e!==0&&(l=To(e,t).slice(),qt.__wbindgen_free(e,t*1)),l}finally{qt.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const u=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_renderGeojson(u,this.__wbg_ptr);var n=Di()[u/4+0],l=Di()[u/4+1];return e=n,t=l,To(n,l)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(e,t,1)}}toggleSnapMode(){qt.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return qt.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){qt.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return qt.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return qt.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){qt.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const l=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_editExisting(l,this.__wbg_ptr,Pn(e));var t=Di()[l/4+0],n=Di()[l/4+1];if(n)throw ic(t)}finally{qt.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const u=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_debugRenderGraph(u,this.__wbg_ptr);var n=Di()[u/4+0],l=Di()[u/4+1];return e=n,t=l,To(n,l)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const u=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_debugSnappableNodes(u,this.__wbg_ptr);var n=Di()[u/4+0],l=Di()[u/4+1];return e=n,t=l,To(n,l)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const k=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_routeNameForWaypoints(k,this.__wbg_ptr,Pn(e));var l=Di()[k/4+0],u=Di()[k/4+1],d=Di()[k/4+2],a=Di()[k/4+3],g=l,b=u;if(a)throw g=0,b=0,ic(d);return t=g,n=b,To(g,b)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){qt.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){qt.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const k=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_calculateRoute(k,this.__wbg_ptr,Pn(e));var l=Di()[k/4+0],u=Di()[k/4+1],d=Di()[k/4+2],a=Di()[k/4+3],g=l,b=u;if(a)throw g=0,b=0,ic(d);return t=g,n=b,To(g,b)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,l;try{const S=qt.__wbindgen_add_to_stack_pointer(-16);qt.jsroutesnapper_getExtraNodes(S,this.__wbg_ptr,Pn(e),Pn(t));var u=Di()[S/4+0],d=Di()[S/4+1],a=Di()[S/4+2],g=Di()[S/4+3],b=u,k=d;if(g)throw b=0,k=0,ic(a);return n=b,l=k,To(b,k)}finally{qt.__wbindgen_add_to_stack_pointer(16),qt.__wbindgen_free(n,l,1)}}}async function vS(o,e){if(typeof Response=="function"&&o instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(o,e)}catch(n){if(o.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await o.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(o,e);return t instanceof WebAssembly.Instance?{instance:t,module:o}:t}}function wS(){const o={};return o.wbg={},o.wbg.__wbindgen_string_new=function(e,t){const n=To(e,t);return Pn(n)},o.wbg.__wbindgen_object_drop_ref=function(e){ic(e)},o.wbg.__wbindgen_error_new=function(e,t){const n=new Error(To(e,t));return Pn(n)},o.wbg.__wbindgen_number_get=function(e,t){const n=Ci(t),l=typeof n=="number"?n:void 0;gS()[e/8+1]=up(l)?0:l,Di()[e/4+0]=!up(l)},o.wbg.__wbindgen_is_object=function(e){const t=Ci(e);return typeof t=="object"&&t!==null},o.wbg.__wbindgen_is_undefined=function(e){return Ci(e)===void 0},o.wbg.__wbindgen_in=function(e,t){return Ci(e)in Ci(t)},o.wbg.__wbindgen_boolean_get=function(e){const t=Ci(e);return typeof t=="boolean"?t?1:0:2},o.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Ci(e)==Ci(t)},o.wbg.__wbindgen_string_get=function(e,t){const n=Ci(t),l=typeof n=="string"?n:void 0;var u=up(l)?0:hd(l,qt.__wbindgen_malloc,qt.__wbindgen_realloc),d=la;Di()[e/4+1]=d,Di()[e/4+0]=u},o.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(Ci(t)),l=hd(n,qt.__wbindgen_malloc,qt.__wbindgen_realloc),u=la;Di()[e/4+1]=u,Di()[e/4+0]=l},o.wbg.__wbindgen_object_clone_ref=function(e){const t=Ci(e);return Pn(t)},o.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=Ci(e)[Ci(t)];return Pn(n)},o.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Pn(e)},o.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Ci(t).stack,l=hd(n,qt.__wbindgen_malloc,qt.__wbindgen_realloc),u=la;Di()[e/4+1]=u,Di()[e/4+0]=l},o.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,l;try{n=e,l=t,console.error(To(e,t))}finally{qt.__wbindgen_free(n,l,1)}},o.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Ci(e))},o.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Ci(e))},o.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Ci(e))},o.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Ci(e))},o.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Ci(e))},o.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=Ci(e)[t>>>0];return Pn(n)},o.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Ci(e).length},o.wbg.__wbindgen_is_function=function(e){return typeof Ci(e)=="function"},o.wbg.__wbg_next_526fc47e980da008=function(e){const t=Ci(e).next;return Pn(t)},o.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return hp(function(e){const t=Ci(e).next();return Pn(t)},arguments)},o.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Ci(e).done},o.wbg.__wbg_value_1695675138684bd5=function(e){const t=Ci(e).value;return Pn(t)},o.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Pn(Symbol.iterator)},o.wbg.__wbg_get_97b561fb56f034b5=function(){return hp(function(e,t){const n=Reflect.get(Ci(e),Ci(t));return Pn(n)},arguments)},o.wbg.__wbg_call_cb65541d95d71282=function(){return hp(function(e,t){const n=Ci(e).call(Ci(t));return Pn(n)},arguments)},o.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Ci(e))},o.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Ci(e)instanceof ArrayBuffer}catch{t=!1}return t},o.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Ci(e).buffer;return Pn(t)},o.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Ci(e));return Pn(t)},o.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){Ci(e).set(Ci(t),n>>>0)},o.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Ci(e).length},o.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Ci(e)instanceof Uint8Array}catch{t=!1}return t},o.wbg.__wbindgen_debug_string=function(e,t){const n=Fp(Ci(t)),l=hd(n,qt.__wbindgen_malloc,qt.__wbindgen_realloc),u=la;Di()[e/4+1]=u,Di()[e/4+0]=l},o.wbg.__wbindgen_throw=function(e,t){throw new Error(To(e,t))},o.wbg.__wbindgen_memory=function(){const e=qt.memory;return Pn(e)},o}function xS(o,e){return qt=o.exports,G1.__wbindgen_wasm_module=e,ju=null,Uu=null,Nu=null,qt}async function G1(o){if(qt!==void 0)return qt;typeof o>"u"&&(o="/npw/assets/route_snapper_bg.wasm");const e=wS();(typeof o=="string"||typeof Request=="function"&&o instanceof Request||typeof URL=="function"&&o instanceof URL)&&(o=fetch(o));const{instance:t,module:n}=await vS(await o,e);return xS(t,n)}const kS=30;class SS{constructor(e,t,n,l,u){this.onMouseMove=d=>{if(!this.active)return;const a=[d.point.x-kS,d.point.y],g=this.map.unproject(d.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(d.lngLat.lng,d.lngLat.lat,g)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=d=>{this.active&&(d.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=d=>{if(!this.active)return;let a=d.target.tagName;a=="INPUT"||a=="TEXTAREA"||d.key=="Escape"&&(d.stopPropagation(),this.cancel())},this.onKeyPress=d=>{if(!this.active)return;let a=d.target.tagName;a=="INPUT"||a=="TEXTAREA"||(d.key=="Enter"?(d.stopPropagation(),this.finish()):d.key=="s"||d.key=="S"?(d.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):d.key=="z"&&d.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Fd(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=l,this.undoLength=u,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}let Bd=Mi(null);const So=Mi([]);const TS=o=>({}),Hy=o=>({}),IS=o=>({}),Xy=o=>({});function Ky(o,e,t){const n=o.slice();return n[51]=e[t],n[52]=e,n[53]=t,n}function Jy(o,e,t){const n=o.slice();return n[54]=e[t],n[55]=e,n[56]=t,n}const CS=o=>({}),Yy=o=>({});function ES(o){let e;return{c(){e=ee("h2"),e.textContent="Drawing a new route"},m(t,n){J(t,e,n)},d(t){t&&X(e)}}}function LS(o){let e;return{c(){e=ee("h2"),e.textContent="Editing a route"},m(t,n){J(t,e,n)},d(t){t&&X(e)}}}function MS(o){let e,t=o[11].length+"",n,l;return{c(){e=be("Undo ("),n=be(t),l=be(")")},m(u,d){J(u,e,d),J(u,n,d),J(u,l,d)},p(u,d){d[0]&2048&&t!==(t=u[11].length+"")&&pt(n,t)},d(u){u&&(X(e),X(n),X(l))}}}function AS(o){let e;return{c(){e=be("Undo")},m(t,n){J(t,e,n)},p:Ze,d(t){t&&X(e)}}}function PS(o){let e,t,n,l,u;return{c(){e=ee("ul"),e.innerHTML=`<li><b>Click</b>
          the map to add new points, while extending from the start or end</li> <li><b>Click and drag</b>
          any point to move it</li> <li><b>Click</b>
          a waypoint to toggle snapping</li> <li><b>Right click</b>
          a waypoint to delete it</li>`,t=we(),n=ee("p"),n.textContent="Keyboard shortcuts:",l=we(),u=ee("ul"),u.innerHTML=`<li><b>1</b>
          to extend from start</li> <li><b>2</b>
          to extend from end</li> <li><b>3</b>
          to drag middle points</li> <li><b>s</b>
          to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
          to undo your last change</li> <li><b>Enter</b>
          to finish</li> <li><b>Escape</b>
          to cancel</li>`},m(d,a){J(d,e,a),J(d,t,a),J(d,n,a),J(d,l,a),J(d,u,a)},p:Ze,d(d){d&&(X(e),X(t),X(n),X(l),X(u))}}}function zS(o){let e,t,n,l,u,d,a,g,b,k,S,L,P,R,Z,$,H,G,K,le,Se,Le,te,Y,ue,fe,ce,ae,We,Ee,ze,rt,it,Qe,Ft,jt,ut,et,at,Bt,Dt,Ht,ai,si,Si,Ri,vi,di,lt,qe,st,Te;function mt(gi,Fi){return gi[3]?LS:ES}let yt=mt(o),Ie=yt(o);function nt(gi,Fi){return gi[11].length==0?AS:MS}let Xt=nt(o),wi=Xt(o);R=new q1({props:{$$slots:{default:[PS]},$$scope:{ctx:o}}});const Ni=o[29]["extra-left"],Li=fn(Ni,o,o[46],Hy);return lt=N_(o[40][0]),qe=N_(o[40][1]),{c(){e=ee("div"),Ie.c(),t=we(),n=ee("button"),l=be("Finish"),d=we(),a=ee("button"),wi.c(),b=we(),k=ee("button"),k.textContent="Delete",S=we(),L=ee("button"),L.textContent="Cancel",P=we(),Ve(R.$$.fragment),Z=we(),$=ee("fieldset"),H=ee("label"),G=ee("input"),K=be(`
        Snap to roads`),le=we(),Se=ee("label"),Le=ee("input"),te=be(`
        Draw anywhere`),Y=we(),ue=ee("fieldset"),fe=ee("label"),ce=ee("input"),ae=be(`
        Extend from start (
        `),We=ee("b"),We.textContent="1",Ee=be(`
        )`),ze=we(),rt=ee("label"),it=ee("input"),Qe=be(`
        Extend from end (
        `),Ft=ee("b"),Ft.textContent="2",jt=be(`
        )`),ut=we(),et=ee("label"),at=ee("input"),Bt=be(`
        Adjust middle points (
        `),Dt=ee("b"),Dt.textContent="3",Ht=be(`
        )`),ai=we(),si=ee("label"),Si=ee("input"),Ri=be(`
      Show major junctions`),vi=we(),Li&&Li.c(),n.disabled=u=o[8].length<2,Pe(a,"class","secondary"),a.disabled=g=o[11].length==0,Pe(k,"class","secondary"),Pe(L,"class","secondary"),Pe(G,"type","radio"),G.__value="snap",Vi(G,G.__value),Pe(Le,"type","radio"),Le.__value="free",Vi(Le,Le.__value),Pe(ce,"type","radio"),ce.__value="append-start",Vi(ce,ce.__value),Pe(it,"type","radio"),it.__value="append-end",Vi(it,it.__value),Pe(at,"type","radio"),at.__value="adjust",Vi(at,at.__value),Pe(Si,"type","checkbox"),Pe(e,"slot","left"),lt.p(ce,it,at),qe.p(G,Le)},m(gi,Fi){J(gi,e,Fi),Ie.m(e,null),F(e,t),F(e,n),F(n,l),F(e,d),F(e,a),wi.m(a,null),F(e,b),F(e,k),F(e,S),F(e,L),F(e,P),je(R,e,null),F(e,Z),F(e,$),F($,H),F(H,G),G.checked=G.__value===o[10],F(H,K),F($,le),F($,Se),F(Se,Le),Le.checked=Le.__value===o[10],F(Se,te),F(e,Y),F(e,ue),F(ue,fe),F(fe,ce),ce.checked=ce.__value===o[4],F(fe,ae),F(fe,We),F(fe,Ee),F(ue,ze),F(ue,rt),F(rt,it),it.checked=it.__value===o[4],F(rt,Qe),F(rt,Ft),F(rt,jt),F(ue,ut),F(ue,et),F(et,at),at.checked=at.__value===o[4],F(et,Bt),F(et,Dt),F(et,Ht),F(e,ai),F(e,si),F(si,Si),Si.checked=o[14],F(si,Ri),F(e,vi),Li&&Li.m(e,null),di=!0,st||(Te=[ft(n,"click",function(){Ja(o[0])&&o[0].apply(this,arguments)}),ft(a,"click",o[15]),ft(k,"click",function(){Ja(o[2])&&o[2].apply(this,arguments)}),ft(L,"click",function(){Ja(o[1])&&o[1].apply(this,arguments)}),ft(G,"change",o[39]),ft(G,"change",o[16]),ft(Le,"change",o[41]),ft(Le,"change",o[16]),ft(ce,"change",o[42]),ft(it,"change",o[43]),ft(at,"change",o[44]),ft(Si,"change",o[45])],st=!0)},p(gi,Fi){o=gi,yt!==(yt=mt(o))&&(Ie.d(1),Ie=yt(o),Ie&&(Ie.c(),Ie.m(e,t))),(!di||Fi[0]&256&&u!==(u=o[8].length<2))&&(n.disabled=u),Xt===(Xt=nt(o))&&wi?wi.p(o,Fi):(wi.d(1),wi=Xt(o),wi&&(wi.c(),wi.m(a,null))),(!di||Fi[0]&2048&&g!==(g=o[11].length==0))&&(a.disabled=g);const _r={};Fi[1]&32768&&(_r.$$scope={dirty:Fi,ctx:o}),R.$set(_r),Fi[0]&1024&&(G.checked=G.__value===o[10]),Fi[0]&1024&&(Le.checked=Le.__value===o[10]),Fi[0]&16&&(ce.checked=ce.__value===o[4]),Fi[0]&16&&(it.checked=it.__value===o[4]),Fi[0]&16&&(at.checked=at.__value===o[4]),Fi[0]&16384&&(Si.checked=o[14]),Li&&Li.p&&(!di||Fi[1]&32768)&&mn(Li,Ni,o,o[46],di?pn(Ni,o[46],Fi,TS):_n(o[46]),Hy)},i(gi){di||(ne(R.$$.fragment,gi),ne(Li,gi),di=!0)},o(gi){he(R.$$.fragment,gi),he(Li,gi),di=!1},d(gi){gi&&X(e),Ie.d(),wi.d(),Ue(R),Li&&Li.d(gi),lt.r(),qe.r(),st=!1,an(Te)}}}function DS(o){let e;return{c(){e=ee("span"),Pe(e,"class","dot svelte-1cj4rwq"),cr(e,"snapped-node",o[54].snapped),cr(e,"free-node",!o[54].snapped),cr(e,"hide",o[7])},m(t,n){J(t,e,n)},p(t,n){n[0]&4096&&cr(e,"snapped-node",t[54].snapped),n[0]&4096&&cr(e,"free-node",!t[54].snapped),n[0]&128&&cr(e,"hide",t[7])},d(t){t&&X(e)}}}function Qy(o){let e,t,n;function l(g){o[30](g,o[54])}function u(){return o[31](o[54])}function d(){return o[32](o[54])}let a={draggable:!0,zIndex:0,$$slots:{default:[DS]},$$scope:{ctx:o}};return o[54].point!==void 0&&(a.lngLat=o[54].point),e=new Ld({props:a}),Ai.push(()=>Zn(e,"lngLat",l)),e.$on("dragstart",u),e.$on("drag",d),e.$on("dragend",o[24]),{c(){Ve(e.$$.fragment)},m(g,b){je(e,g,b),n=!0},p(g,b){o=g;const k={};b[0]&4224|b[1]&32768&&(k.$$scope={dirty:b,ctx:o}),!t&&b[0]&4096&&(t=!0,k.lngLat=o[54].point,qn(()=>t=!1)),e.$set(k)},i(g){n||(ne(e.$$.fragment,g),n=!0)},o(g){he(e.$$.fragment,g),n=!1},d(g){Ue(e,g)}}}function RS(o){let e;return{c(){e=ee("span"),e.textContent=`${o[53]+1}`,Pe(e,"class","dot svelte-1cj4rwq"),cr(e,"snapped",o[51].snapped)},m(t,n){J(t,e,n)},p(t,n){n[0]&256&&cr(e,"snapped",t[51].snapped)},d(t){t&&X(e)}}}function e0(o){let e,t,n;function l(g){o[33](g,o[51])}function u(){return o[34](o[53])}function d(){return o[35](o[53])}let a={draggable:!0,zIndex:1,$$slots:{default:[RS]},$$scope:{ctx:o}};return o[51].point!==void 0&&(a.lngLat=o[51].point),e=new Ld({props:a}),Ai.push(()=>Zn(e,"lngLat",l)),e.$on("click",u),e.$on("contextmenu",d),e.$on("mouseenter",o[36]),e.$on("mouseleave",o[37]),e.$on("dragstart",o[26]),e.$on("dragend",o[38]),{c(){Ve(e.$$.fragment)},m(g,b){je(e,g,b),n=!0},p(g,b){o=g;const k={};b[0]&256|b[1]&32768&&(k.$$scope={dirty:b,ctx:o}),!t&&b[0]&256&&(t=!0,k.lngLat=o[51].point,qn(()=>t=!1)),e.$set(k)},i(g){n||(ne(e.$$.fragment,g),n=!0)},o(g){he(e.$$.fragment,g),n=!1},d(g){Ue(e,g)}}}function FS(o){let e,t;return e=new vn({props:{paint:{"line-color":"black","line-width":10}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p:Ze,i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function BS(o){let e,t;return e=new vn({props:{paint:{"line-color":"black","line-width":3}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p:Ze,i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function OS(o){let e,t,n,l,u,d,a,g,b,k;t=new B1({}),t.$on("click",o[17]),t.$on("mousemove",o[18]);let S=bi(o[12]),L=[];for(let K=0;K<S.length;K+=1)L[K]=Qy(Jy(o,S,K));const P=K=>he(L[K],1,1,()=>{L[K]=null});let R=bi(o[8]),Z=[];for(let K=0;K<R.length;K+=1)Z[K]=e0(Ky(o,R,K));const $=K=>he(Z[K],1,1,()=>{Z[K]=null});d=new bn({props:{data:o[21](o[9],o[8]),generateId:!0,$$slots:{default:[FS]},$$scope:{ctx:o}}}),g=new bn({props:{data:o[13],$$slots:{default:[BS]},$$scope:{ctx:o}}});const H=o[29]["extra-map"],G=fn(H,o,o[46],Xy);return{c(){e=ee("div"),Ve(t.$$.fragment),n=we();for(let K=0;K<L.length;K+=1)L[K].c();l=we();for(let K=0;K<Z.length;K+=1)Z[K].c();u=we(),Ve(d.$$.fragment),a=we(),Ve(g.$$.fragment),b=we(),G&&G.c(),Pe(e,"slot","map")},m(K,le){J(K,e,le),je(t,e,null),F(e,n);for(let Se=0;Se<L.length;Se+=1)L[Se]&&L[Se].m(e,null);F(e,l);for(let Se=0;Se<Z.length;Se+=1)Z[Se]&&Z[Se].m(e,null);F(e,u),je(d,e,null),F(e,a),je(g,e,null),F(e,b),G&&G.m(e,null),k=!0},p(K,le){if(le[0]&29364352){S=bi(K[12]);let te;for(te=0;te<S.length;te+=1){const Y=Jy(K,S,te);L[te]?(L[te].p(Y,le),ne(L[te],1)):(L[te]=Qy(Y),L[te].c(),ne(L[te],1),L[te].m(e,l))}for(ui(),te=S.length;te<L.length;te+=1)P(te);hi()}if(le[0]&68682080){R=bi(K[8]);let te;for(te=0;te<R.length;te+=1){const Y=Ky(K,R,te);Z[te]?(Z[te].p(Y,le),ne(Z[te],1)):(Z[te]=e0(Y),Z[te].c(),ne(Z[te],1),Z[te].m(e,u))}for(ui(),te=R.length;te<Z.length;te+=1)$(te);hi()}const Se={};le[0]&768&&(Se.data=K[21](K[9],K[8])),le[1]&32768&&(Se.$$scope={dirty:le,ctx:K}),d.$set(Se);const Le={};le[0]&8192&&(Le.data=K[13]),le[1]&32768&&(Le.$$scope={dirty:le,ctx:K}),g.$set(Le),G&&G.p&&(!k||le[1]&32768)&&mn(G,H,K,K[46],k?pn(H,K[46],le,IS):_n(K[46]),Xy)},i(K){if(!k){ne(t.$$.fragment,K);for(let le=0;le<S.length;le+=1)ne(L[le]);for(let le=0;le<R.length;le+=1)ne(Z[le]);ne(d.$$.fragment,K),ne(g.$$.fragment,K),ne(G,K),k=!0}},o(K){he(t.$$.fragment,K),L=L.filter(Boolean);for(let le=0;le<L.length;le+=1)he(L[le]);Z=Z.filter(Boolean);for(let le=0;le<Z.length;le+=1)he(Z[le]);he(d.$$.fragment,K),he(g.$$.fragment,K),he(G,K),k=!1},d(K){K&&X(e),Ue(t),Bn(L,K),Bn(Z,K),Ue(d),Ue(g),G&&G.d(K)}}}function NS(o){let e,t;const n=o[29]["extra-right"],l=fn(n,o,o[46],Yy);return{c(){e=ee("div"),l&&l.c(),Pe(e,"slot","right")},m(u,d){J(u,e,d),l&&l.m(e,null),t=!0},p(u,d){l&&l.p&&(!t||d[1]&32768)&&mn(l,n,u,u[46],t?pn(n,u[46],d,CS):_n(u[46]),Yy)},i(u){t||(ne(l,u),t=!0)},o(u){he(l,u),t=!1},d(u){u&&X(e),l&&l.d(u)}}}function jS(o){let e,t,n,l;return e=new yc({props:{$$slots:{right:[NS],map:[OS],left:[zS]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0,n||(l=ft(window,"keydown",o[25]),n=!0)},p(u,d){const a={};d[0]&32767|d[1]&32768&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){Ue(e,u),n=!1,l()}}}function US(o,e,t){let n,l,u,d;bt(o,So,yt=>t(8,l=yt)),bt(o,Bd,yt=>t(9,u=yt)),bt(o,zp,yt=>t(14,d=yt));let{$$slots:a={},$$scope:g}=e,{map:b}=e,{finish:k}=e,{cancel:S}=e,{deleteRoute:L}=e,{editingExisting:P}=e;Lo(()=>{oi(So,l=[],l),u==null||u.stop(),b.getCanvas().style.cursor="inherit"});let R=P?"adjust":"append-end",Z="snap",$=[],H=[],G=null,K=!1,le=!1,Se=!1;function Le(yt){let Ie=yt.length==0?"crosshair":"inherit";b.getCanvas().style.cursor=Ie}function te(){let yt=$.pop();t(11,$),yt&&oi(So,l=yt,l)}function Y(){$.length==100&&$.shift(),t(11,$=[...$,JSON.parse(JSON.stringify(l))])}function ue(){t(10,Z=Z=="snap"?"free":"snap"),G&&t(28,G.snapped=Z=="snap",G)}function fe(yt){Y(),So.update(Ie=>(R=="append-start"?Ie.splice(0,0,{point:yt.detail.lngLat.toArray(),snapped:Z=="snap"}):R=="append-end"&&Ie.push({point:yt.detail.lngLat.toArray(),snapped:Z=="snap"}),Ie))}function ce(yt){t(28,G={point:yt.detail.lngLat.toArray(),snapped:Z=="snap"})}function ae(yt){Y(),So.update(Ie=>(Ie[yt].snapped=!Ie[yt].snapped,Ie))}function We(yt){Y(),So.update(Ie=>(Ie.splice(yt,1),Ie)),t(5,K=!1)}function Ee(yt,Ie){try{if(yt)return JSON.parse(yt.inner.calculateRoute(Ie))}catch{}return lc()}function ze(yt,Ie,nt,Xt,wi){if(wi)return lc();try{if(yt&&Ie.length>0&&Xt){if(nt=="append-start")return JSON.parse(yt.inner.calculateRoute([Xt,Ie[0]]));if(nt=="append-end")return JSON.parse(yt.inner.calculateRoute([Ie[Ie.length-1],Xt]))}}catch{}return lc()}function rt(yt,Ie,nt,Xt){if(Xt)return;if(!yt||nt!="adjust"){t(12,H=[]);return}let wi=[],Ni=1;for(let Li=0;Li<Ie.length-1;Li++){let gi=JSON.parse(yt.inner.getExtraNodes(Ie[Li],Ie[Li+1]));for(let[Fi,_r,ct]of gi)wi.push({point:[Fi,_r],snapped:ct,insertIdx:Ni});Ni++}t(12,H=wi)}function it(yt){Y(),So.update(Ie=>(Ie.splice(yt.insertIdx,0,{point:yt.point,snapped:yt.snapped}),Ie)),t(7,Se=!0)}function Qe(yt){So.update(Ie=>(Ie[yt.insertIdx].point=yt.point,Ie))}function Ft(){t(7,Se=!1)}function jt(yt){let Ie=yt.target.tagName,nt=Ie=="INPUT"||Ie=="TEXTAREA";yt.key==="Enter"&&!nt?(yt.stopPropagation(),l.length>=2&&k()):yt.key==="Escape"?(yt.stopPropagation(),S()):yt.key=="s"&&!nt?ue():yt.key=="1"&&!nt?t(4,R="append-start"):yt.key=="2"&&!nt?t(4,R="append-end"):yt.key=="3"&&!nt?t(4,R="adjust"):yt.key=="z"&&yt.ctrlKey&&(yt.stopPropagation(),te())}function ut(){Y(),t(6,le=!0)}const et=[[],[]];function at(yt,Ie){o.$$.not_equal(Ie.point,yt)&&(Ie.point=yt,t(12,H))}const Bt=yt=>it(yt),Dt=yt=>Qe(yt);function Ht(yt,Ie){o.$$.not_equal(Ie.point,yt)&&(Ie.point=yt,So.set(l))}const ai=yt=>ae(yt),si=yt=>We(yt),Si=()=>t(5,K=!0),Ri=()=>t(5,K=!1),vi=()=>t(6,le=!1);function di(){Z=this.__value,t(10,Z)}function lt(){Z=this.__value,t(10,Z)}function qe(){R=this.__value,t(4,R)}function st(){R=this.__value,t(4,R)}function Te(){R=this.__value,t(4,R)}function mt(){d=this.checked,zp.set(d)}return o.$$set=yt=>{"map"in yt&&t(27,b=yt.map),"finish"in yt&&t(0,k=yt.finish),"cancel"in yt&&t(1,S=yt.cancel),"deleteRoute"in yt&&t(2,L=yt.deleteRoute),"editingExisting"in yt&&t(3,P=yt.editingExisting),"$$scope"in yt&&t(46,g=yt.$$scope)},o.$$.update=()=>{o.$$.dirty[0]&912&&rt(u,l,R,Se),o.$$.dirty[0]&268436336&&t(13,n=ze(u,l,R,G,K||le)),o.$$.dirty[0]&256&&Le(l)},[k,S,L,P,R,K,le,Se,l,u,Z,$,H,n,d,te,ue,fe,ce,ae,We,Ee,it,Qe,Ft,jt,ut,b,G,a,at,Bt,Dt,Ht,ai,si,Si,Ri,vi,di,et,lt,qe,st,Te,mt,g]}class $S extends Wt{constructor(e){super(),Gt(this,e,US,jS,Vt,{map:27,finish:0,cancel:1,deleteRoute:2,editingExisting:3},null,[-1,-1])}}function t0(o,e,t){const n=o.slice();return n[23]=e[t],n}function VS(o){let e,t,n,l,u,d,a,g,b,k,S,L,P,R;return{c(){e=ee("div"),t=ee("label"),n=be(`Tier:
      `),l=ee("select"),u=ee("option"),u.textContent="Primary routes",d=ee("option"),d.textContent="Secondary routes",a=ee("option"),a.textContent="Local access routes",g=ee("option"),g.textContent="Long distance routes",b=we(),k=ee("button"),S=be("Evaluate this route"),u.__value="Primary",Vi(u,u.__value),d.__value="Secondary",Vi(d,d.__value),a.__value="LocalAccess",Vi(a,a.__value),g.__value="LongDistance",Vi(g,g.__value),o[5]===void 0&&Co(()=>o[14].call(l)),Pe(k,"class","secondary"),k.disabled=L=o[2].length<2,Pe(e,"slot","extra-left")},m(Z,$){J(Z,e,$),F(e,t),F(t,n),F(t,l),F(l,u),F(l,d),F(l,a),F(l,g),lr(l,o[5],!0),F(e,b),F(e,k),F(k,S),P||(R=[ft(l,"change",o[14]),ft(k,"click",o[11])],P=!0)},p(Z,$){$&32&&lr(l,Z[5]),$&4&&L!==(L=Z[2].length<2)&&(k.disabled=L)},d(Z){Z&&X(e),P=!1,an(R)}}}function i0(o){let e,t;return e=new bn({props:{data:o[6],$$slots:{default:[qS]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&64&&(u.data=n[6]),l&134217730&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function qS(o){let e,t;return e=new vn({props:{filter:o[1]==null?void 0:["!=",["id"],o[1]],paint:{"line-width":5,"line-color":fa,"line-opacity":.5}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&2&&(u.filter=n[1]==null?void 0:["!=",["id"],n[1]]),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function ZS(o){let e,t,n=o[26].infra_type+"",l;return{c(){e=ee("p"),t=be("This section will be "),l=be(n)},m(u,d){J(u,e,d),F(e,t),F(e,l)},p(u,d){d&67108864&&n!==(n=u[26].infra_type+"")&&pt(l,n)},d(u){u&&X(e)}}}function GS(o){let e,t;return e=new mr({props:{openOn:"hover",$$slots:{default:[ZS,({props:n})=>({26:n}),({props:n})=>n?67108864:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&201326592&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function WS(o){let e,t;return e=new vn({props:{filter:["==",["get","kind"],"new"],paint:{"line-width":3,"line-color":fa},$$slots:{default:[GS]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&134217728&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function HS(o){let e,t,n,l,u=o[6]&&i0(o);return n=new bn({props:{data:o[7],$$slots:{default:[WS]},$$scope:{ctx:o}}}),{c(){e=ee("span"),u&&u.c(),t=we(),Ve(n.$$.fragment),Pe(e,"slot","extra-map")},m(d,a){J(d,e,a),u&&u.m(e,null),F(e,t),je(n,e,null),l=!0},p(d,a){d[6]?u?(u.p(d,a),a&64&&ne(u,1)):(u=i0(d),u.c(),ne(u,1),u.m(e,t)):u&&(ui(),he(u,1,1,()=>{u=null}),hi());const g={};a&128&&(g.data=d[7]),a&134217728&&(g.$$scope={dirty:a,ctx:d}),n.$set(g)},i(d){l||(ne(u),ne(n.$$.fragment,d),l=!0)},o(d){he(u),he(n.$$.fragment,d),l=!1},d(d){d&&X(e),u&&u.d(),Ue(n)}}}function n0(o){let e,t,n,l=bi(o[7].features),u=[];for(let d=0;d<l.length;d+=1)u[d]=r0(t0(o,l,d));return{c(){e=ee("p"),e.textContent="The route you've drawn has been split into sections:",t=we(),n=ee("ol");for(let d=0;d<u.length;d+=1)u[d].c()},m(d,a){J(d,e,a),J(d,t,a),J(d,n,a);for(let g=0;g<u.length;g+=1)u[g]&&u[g].m(n,null)},p(d,a){if(a&128){l=bi(d[7].features);let g;for(g=0;g<l.length;g+=1){const b=t0(d,l,g);u[g]?u[g].p(b,a):(u[g]=r0(b),u[g].c(),u[g].m(n,null))}for(;g<u.length;g+=1)u[g].d(1);u.length=l.length}},d(d){d&&(X(e),X(t),X(n)),Bn(u,d)}}}function XS(o){let e;return{c(){e=ee("li"),e.textContent="An existing section from another route"},m(t,n){J(t,e,n)},p:Ze,d(t){t&&X(e)}}}function KS(o){let e,t,n=Mo(o[23].properties).infra_type+"",l,u;return{c(){e=ee("li"),t=be("A section where "),l=be(n),u=be(` is most appropriate
            `)},m(d,a){J(d,e,a),F(e,t),F(e,l),F(e,u)},p(d,a){a&128&&n!==(n=Mo(d[23].properties).infra_type+"")&&pt(l,n)},d(d){d&&X(e)}}}function r0(o){let e,t;function n(d,a){return a&128&&(e=null),e==null&&(e=Mo(d[23].properties).kind=="new"),e?KS:XS}let l=n(o,-1),u=l(o);return{c(){u.c(),t=Ei()},m(d,a){u.m(d,a),J(d,t,a)},p(d,a){l===(l=n(d,a))&&u?u.p(d,a):(u.d(1),u=l(d),u&&(u.c(),u.m(t.parentNode,t)))},d(d){d&&X(t),u.d(d)}}}function JS(o){let e,t,n,l,u,d,a,g,b,k,S,L=o[7].features.length>0&&n0(o);return{c(){e=ee("div"),t=ee("label"),n=be(`Name:
      `),l=ee("input"),u=we(),d=ee("label"),a=be(`Notes:
      `),g=ee("textarea"),b=we(),L&&L.c(),Pe(l,"type","text"),Pe(g,"rows","5"),Pe(e,"slot","extra-right")},m(P,R){J(P,e,R),F(e,t),F(t,n),F(t,l),Vi(l,o[3]),F(e,u),F(e,d),F(d,a),F(d,g),Vi(g,o[4]),F(e,b),L&&L.m(e,null),k||(S=[ft(l,"input",o[12]),ft(g,"input",o[13])],k=!0)},p(P,R){R&8&&l.value!==P[3]&&Vi(l,P[3]),R&16&&Vi(g,P[4]),P[7].features.length>0?L?L.p(P,R):(L=n0(P),L.c(),L.m(e,null)):L&&(L.d(1),L=null)},d(P){P&&X(e),L&&L.d(),k=!1,an(S)}}}function YS(o){let e,t;return e=new $S({props:{map:o[0],finish:o[9],cancel:o[10],deleteRoute:o[8],editingExisting:o[1]!=null,$$slots:{"extra-right":[JS],"extra-map":[HS],"extra-left":[VS]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.map=n[0]),l&2&&(u.editingExisting=n[1]!=null),l&134217982&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function QS(o,e,t){let n,l,u,d,a,g,b;bt(o,In,fe=>t(16,n=fe)),bt(o,Bd,fe=>t(17,l=fe)),bt(o,sn,fe=>t(18,u=fe)),bt(o,Ya,fe=>t(19,d=fe)),bt(o,aa,fe=>t(20,a=fe)),bt(o,So,fe=>t(2,g=fe)),bt(o,ps,fe=>t(21,b=fe));let{map:k}=e,{id:S}=e,L="",P="",R="Unknown",Z=b,$=null,H=lc();fc(async()=>{if(t(6,$=await n.renderRoutes()),oi(So,g=[],g),S!=null){let fe=$.features.find(ce=>ce.id==S);t(3,L=fe.properties.name),t(4,P=fe.properties.notes),R=fe.properties.infra_type,t(5,Z=fe.properties.tier),oi(So,g=fe.properties.waypoints.map(ce=>({point:[ce.lon,ce.lat],snapped:ce.snapped})),g)}});async function G(){S&&(await n.deleteRoute(S),await th()),oi(sn,u={kind:"main"},u)}async function K(){try{let fe=JSON.parse(l.inner.calculateRoute(g));if(!fe){window.alert("No route drawn");return}await n.setRoute(S,{feature:fe,name:L,notes:P,full_path:fe.properties.full_path,infra_type:R,tier:Z}),await th(),oi(sn,u={kind:"main"},u)}catch(fe){window.alert(fe)}}function le(){oi(sn,u={kind:"main"},u)}function Se(){let fe=JSON.parse(l.inner.calculateRoute(g)),ce=fe.geometry.coordinates[0],ae=fe.geometry.coordinates[fe.geometry.coordinates.length-1];oi(aa,a={lng:ce[0],lat:ce[1]},a),oi(Ya,d={lng:ae[0],lat:ae[1]},d),oi(sn,u={kind:"evaluate-route",prevMode:{kind:"edit-route",id:S},browse:[]},u)}async function Le(fe){try{let ce=JSON.parse(l.inner.calculateRoute(fe));t(7,H=await n.autosplitRoute(ce.properties.full_path))}catch{t(7,H=lc())}}function te(){L=this.value,t(3,L)}function Y(){P=this.value,t(4,P)}function ue(){Z=gs(this),t(5,Z)}return o.$$set=fe=>{"map"in fe&&t(0,k=fe.map),"id"in fe&&t(1,S=fe.id)},o.$$.update=()=>{o.$$.dirty&4&&Le(g)},[k,S,g,L,P,Z,$,H,G,K,le,Se,te,Y,ue]}class e5 extends Wt{constructor(e){super(),Gt(this,e,QS,YS,Vt,{map:0,id:1})}}function o0(o,e,t){const n=o.slice();return n[3]=e[t],n}function s0(o){let e,t,n,l=o[3].infra_type+"",u,d,a=o[3].name+"",g,b,k;return{c(){e=ee("li"),t=ee("a"),n=be("["),u=be(l),d=be("] "),g=be(a),k=we(),Pe(t,"href",b=o[3].way),Pe(t,"target","_blank")},m(S,L){J(S,e,L),F(e,t),F(t,n),F(t,u),F(t,d),F(t,g),F(e,k)},p(S,L){L&1&&l!==(l=S[3].infra_type+"")&&pt(u,l),L&1&&a!==(a=S[3].name+"")&&pt(g,a),L&1&&b!==(b=S[3].way)&&Pe(t,"href",b)},d(S){S&&X(e)}}}function t5(o){let e,t,n,l=(o[0].route_length/o[0].direct_length).toFixed(1)+"",u,d,a,g,b,k,S=(o[0].route_length/o[0].car_length).toFixed(1)+"",L,P,R,Z,$,H,G,K,le,Se=dd(o[0],o[1])+"",Le,te,Y,ue,fe,ce=fd(o[0],o[1])+"",ae,We,Ee,ze,rt,it=dd(o[0],o[2])+"",Qe,Ft,jt,ut,et,at=fd(o[0],o[2])+"",Bt,Dt,Ht,ai,si,Si,Ri,vi,di=bi(o[0].directions),lt=[];for(let qe=0;qe<di.length;qe+=1)lt[qe]=s0(o0(o,di,qe));return{c(){e=ee("p"),t=be("Detour factor: "),n=ee("b"),u=be(l),d=be("x"),a=be(`
  longer than straight line`),g=we(),b=ee("p"),k=ee("b"),L=be(S),P=be("x"),R=be(`
  longer than the driving route (in
  `),Z=ee("span"),Z.textContent="red",$=be(`
  )`),H=we(),G=ee("hr"),K=we(),le=ee("p"),Le=be(Se),te=be(" changes in infrastructure type"),Y=we(),ue=ee("p"),fe=be("By length: "),ae=be(ce),We=we(),Ee=ee("hr"),ze=we(),rt=ee("p"),Qe=be(it),Ft=be(" changes in level of service"),jt=we(),ut=ee("p"),et=be("By length: "),Bt=be(at),Dt=we(),Ht=ee("hr"),ai=we(),si=ee("details"),Si=ee("summary"),Si.textContent="Route directions",Ri=we(),vi=ee("ol");for(let qe=0;qe<lt.length;qe+=1)lt[qe].c();mi(Z,"color","red")},m(qe,st){J(qe,e,st),F(e,t),F(e,n),F(n,u),F(n,d),F(e,a),J(qe,g,st),J(qe,b,st),F(b,k),F(k,L),F(k,P),F(b,R),F(b,Z),F(b,$),J(qe,H,st),J(qe,G,st),J(qe,K,st),J(qe,le,st),F(le,Le),F(le,te),J(qe,Y,st),J(qe,ue,st),F(ue,fe),F(ue,ae),J(qe,We,st),J(qe,Ee,st),J(qe,ze,st),J(qe,rt,st),F(rt,Qe),F(rt,Ft),J(qe,jt,st),J(qe,ut,st),F(ut,et),F(ut,Bt),J(qe,Dt,st),J(qe,Ht,st),J(qe,ai,st),J(qe,si,st),F(si,Si),F(si,Ri),F(si,vi);for(let Te=0;Te<lt.length;Te+=1)lt[Te]&&lt[Te].m(vi,null)},p(qe,[st]){if(st&1&&l!==(l=(qe[0].route_length/qe[0].direct_length).toFixed(1)+"")&&pt(u,l),st&1&&S!==(S=(qe[0].route_length/qe[0].car_length).toFixed(1)+"")&&pt(L,S),st&1&&Se!==(Se=dd(qe[0],qe[1])+"")&&pt(Le,Se),st&1&&ce!==(ce=fd(qe[0],qe[1])+"")&&pt(ae,ce),st&1&&it!==(it=dd(qe[0],qe[2])+"")&&pt(Qe,it),st&1&&at!==(at=fd(qe[0],qe[2])+"")&&pt(Bt,at),st&1){di=bi(qe[0].directions);let Te;for(Te=0;Te<di.length;Te+=1){const mt=o0(qe,di,Te);lt[Te]?lt[Te].p(mt,st):(lt[Te]=s0(mt),lt[Te].c(),lt[Te].m(vi,null))}for(;Te<lt.length;Te+=1)lt[Te].d(1);lt.length=di.length}},i:Ze,o:Ze,d(qe){qe&&(X(e),X(g),X(b),X(H),X(G),X(K),X(le),X(Y),X(ue),X(We),X(Ee),X(ze),X(rt),X(jt),X(ut),X(Dt),X(Ht),X(ai),X(si)),Bn(lt,qe)}}}function dd(o,e){let t=0;for(let n=0;n<o.directions.length-1;n++){let l=e(o.directions[n]),u=e(o.directions[n+1]);l!=u&&t++}return t}function fd(o,e){let t={};for(let u of o.directions){let d=e(u);Object.hasOwn(t,d)||(t[d]=0),t[d]+=u.length}let n=0;for(let u of Object.values(t))n+=u;let l=[];for(let[u,d]of Object.entries(t).toSorted((a,g)=>g[1]-a[1])){let a=Math.round(d/n*100);l.push(`${a}% ${u}`)}return l.join(", ")}function i5(o,e,t){let{gj:n}=e,l=d=>d.infra_type,u=d=>d.los;return o.$$set=d=>{"gj"in d&&t(0,n=d.gj)},[n,l,u]}class n5 extends Wt{constructor(e){super(),Gt(this,e,i5,t5,Vt,{gj:0})}}function a0(o){let e,t;return{c(){e=ee("p"),t=be(o[7])},m(n,l){J(n,e,l),F(e,t)},p(n,l){l&128&&pt(t,n[7])},d(n){n&&X(e)}}}function r5(o){let e,t;return e=new Qa({props:{colors:V1}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function o5(o){let e,t;return e=new Qa({props:{colors:Yp}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function l0(o){let e,t;return e=new n5({props:{gj:o[6]}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&64&&(u.gj=n[6]),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function s5(o){let e,t,n,l,u,d,a,g,b,k,S,L,P,R,Z,$,H,G,K,le,Se,Le,te=o[7]&&a0(o);const Y=[o5,r5],ue=[];function fe(ae,We){return ae[3]=="los"?0:ae[3]=="gradient"?1:-1}~(H=fe(o))&&(G=ue[H]=Y[H](o));let ce=o[6]&&l0(o);return{c(){e=ee("div"),t=ee("h2"),t.textContent="Evaluate a route mode",n=we(),l=ee("button"),l.textContent="Back",u=we(),d=ee("p"),d.innerHTML=`Move the <b>A</b>
      and
      <b>B</b>
      pins to find a route. (Hint: right-click to set the first pin somewhere.)`,a=we(),te&&te.c(),g=we(),b=ee("label"),k=be(`Show details along route
      `),S=ee("select"),L=ee("option"),L.textContent="Just show route",P=ee("option"),P.textContent="Level of service",R=ee("option"),R.textContent="Infrastructure type",Z=ee("option"),Z.textContent="Gradient",$=we(),G&&G.c(),K=we(),ce&&ce.c(),L.__value="",Vi(L,L.__value),P.__value="los",Vi(P,P.__value),R.__value="infra_type",Vi(R,R.__value),Z.__value="gradient",Vi(Z,Z.__value),o[3]===void 0&&Co(()=>o[18].call(S)),Pe(e,"slot","left")},m(ae,We){J(ae,e,We),F(e,t),F(e,n),F(e,l),F(e,u),F(e,d),F(e,a),te&&te.m(e,null),F(e,g),F(e,b),F(b,k),F(b,S),F(S,L),F(S,P),F(S,R),F(S,Z),lr(S,o[3],!0),F(e,$),~H&&ue[H].m(e,null),F(e,K),ce&&ce.m(e,null),le=!0,Se||(Le=[ft(l,"click",o[17]),ft(S,"change",o[18])],Se=!0)},p(ae,We){ae[7]?te?te.p(ae,We):(te=a0(ae),te.c(),te.m(e,g)):te&&(te.d(1),te=null),We&8&&lr(S,ae[3]);let Ee=H;H=fe(ae),H!==Ee&&(G&&(ui(),he(ue[Ee],1,1,()=>{ue[Ee]=null}),hi()),~H?(G=ue[H],G||(G=ue[H]=Y[H](ae),G.c()),ne(G,1),G.m(e,K)):G=null),ae[6]?ce?(ce.p(ae,We),We&64&&ne(ce,1)):(ce=l0(ae),ce.c(),ne(ce,1),ce.m(e,null)):ce&&(ui(),he(ce,1,1,()=>{ce=null}),hi())},i(ae){le||(ne(G),ne(ce),le=!0)},o(ae){he(G),he(ce),le=!1},d(ae){ae&&X(e),te&&te.d(),~H&&ue[H].d(),ce&&ce.d(),Se=!1,an(Le)}}}function a5(o){return{c:Ze,m:Ze,p:Ze,i:Ze,o:Ze,d:Ze}}function l5(o){let e,t;return e=new bn({props:{data:o[21],$$slots:{default:[c5]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&512&&(u.data=n[21]),l&4195328&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function c5(o){let e,t;return e=new vn({props:{paint:{"line-width":5,"line-color":fa},layout:{visibility:o[10]?"visible":"none"}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&1024&&(u.layout={visibility:n[10]?"visible":"none"}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function u5(o){return{c:Ze,m:Ze,p:Ze,i:Ze,o:Ze,d:Ze}}function c0(o){let e,t,n,l,u,d;function a(S){o[15](S)}let g={draggable:!0,$$slots:{default:[h5]},$$scope:{ctx:o}};o[5]!==void 0&&(g.lngLat=o[5]),e=new Ld({props:g}),Ai.push(()=>Zn(e,"lngLat",a));function b(S){o[16](S)}let k={draggable:!0,$$slots:{default:[d5]},$$scope:{ctx:o}};return o[4]!==void 0&&(k.lngLat=o[4]),l=new Ld({props:k}),Ai.push(()=>Zn(l,"lngLat",b)),{c(){Ve(e.$$.fragment),n=we(),Ve(l.$$.fragment)},m(S,L){je(e,S,L),J(S,n,L),je(l,S,L),d=!0},p(S,L){const P={};L&4194304&&(P.$$scope={dirty:L,ctx:S}),!t&&L&32&&(t=!0,P.lngLat=S[5],qn(()=>t=!1)),e.$set(P);const R={};L&4194304&&(R.$$scope={dirty:L,ctx:S}),!u&&L&16&&(u=!0,R.lngLat=S[4],qn(()=>u=!1)),l.$set(R)},i(S){d||(ne(e.$$.fragment,S),ne(l.$$.fragment,S),d=!0)},o(S){he(e.$$.fragment,S),he(l.$$.fragment,S),d=!1},d(S){S&&X(n),Ue(e,S),Ue(l,S)}}}function h5(o){let e;return{c(){e=ee("span"),e.textContent="A",Pe(e,"class","dot svelte-1ej0v4r")},m(t,n){J(t,e,n)},p:Ze,d(t){t&&X(e)}}}function d5(o){let e;return{c(){e=ee("span"),e.textContent="B",Pe(e,"class","dot svelte-1ej0v4r")},m(t,n){J(t,e,n)},p:Ze,d(t){t&&X(e)}}}function u0(o){let e,t;return e=new bn({props:{data:o[6],generateId:!0,$$slots:{default:[f5]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&64&&(u.data=n[6]),l&4194312&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function f5(o){let e,t,n,l;return e=new vn({props:{filter:["!",["has","car_route"]],paint:{"line-width":20,"line-color":{"":"cyan",los:Rp,infra_type:fa,gradient:xy}[o[3]],"line-opacity":Jn(.5,1)},manageHoverState:!0}}),n=new vn({props:{filter:["has","car_route"],paint:{"line-width":10,"line-color":"red","line-opacity":Jn(.5,1)},manageHoverState:!0}}),{c(){Ve(e.$$.fragment),t=we(),Ve(n.$$.fragment)},m(u,d){je(e,u,d),J(u,t,d),je(n,u,d),l=!0},p(u,d){const a={};d&8&&(a.paint={"line-width":20,"line-color":{"":"cyan",los:Rp,infra_type:fa,gradient:xy}[u[3]],"line-opacity":Jn(.5,1)}),e.$set(a)},i(u){l||(ne(e.$$.fragment,u),ne(n.$$.fragment,u),l=!0)},o(u){he(e.$$.fragment,u),he(n.$$.fragment,u),l=!1},d(u){u&&X(t),Ue(e,u),Ue(n,u)}}}function p5(o){let e,t,n,l,u,d,a;t=new B1({}),t.$on("contextmenu",o[11]);let g={ctx:o,current:null,token:null,hasCatch:!1,pending:u5,then:l5,catch:a5,value:21,blocks:[,,,]};Ar(l=Mo(o[9]).renderRoutes(),g);let b=o[5]&&o[4]&&c0(o),k=o[6]&&u0(o);return{c(){e=ee("div"),Ve(t.$$.fragment),n=we(),g.block.c(),u=we(),b&&b.c(),d=we(),k&&k.c(),Pe(e,"slot","map")},m(S,L){J(S,e,L),je(t,e,null),F(e,n),g.block.m(e,g.anchor=null),g.mount=()=>e,g.anchor=u,F(e,u),b&&b.m(e,null),F(e,d),k&&k.m(e,null),a=!0},p(S,L){o=S,g.ctx=o,L&512&&l!==(l=Mo(o[9]).renderRoutes())&&Ar(l,g)||pa(g,o,L),o[5]&&o[4]?b?(b.p(o,L),L&48&&ne(b,1)):(b=c0(o),b.c(),ne(b,1),b.m(e,d)):b&&(ui(),he(b,1,1,()=>{b=null}),hi()),o[6]?k?(k.p(o,L),L&64&&ne(k,1)):(k=u0(o),k.c(),ne(k,1),k.m(e,null)):k&&(ui(),he(k,1,1,()=>{k=null}),hi())},i(S){a||(ne(t.$$.fragment,S),ne(g.block),ne(b),ne(k),a=!0)},o(S){he(t.$$.fragment,S);for(let L=0;L<3;L+=1){const P=g.blocks[L];he(P)}he(b),he(k),a=!1},d(S){S&&X(e),Ue(t),g.block.d(),g.token=null,g=null,b&&b.d(),k&&k.d()}}}function h0(o){let e,t,n,l,u,d,a,g=o[2]+1+"",b,k,S=o[1].length+"",L,P,R,Z,$,H,G;return{c(){e=ee("p"),e.textContent="These routes, from a sample of the OD data, have the worst directness.",t=we(),n=ee("div"),l=ee("button"),u=be("Previous"),a=we(),b=be(g),k=be(" / "),L=be(S),P=we(),R=ee("button"),Z=be("Next"),Pe(l,"class","secondary"),l.disabled=d=o[2]==0,Pe(R,"class","secondary"),R.disabled=$=o[2]==o[1].length-1},m(K,le){J(K,e,le),J(K,t,le),J(K,n,le),F(n,l),F(l,u),F(n,a),F(n,b),F(n,k),F(n,L),F(n,P),F(n,R),F(R,Z),H||(G=[ft(l,"click",o[13]),ft(R,"click",o[14])],H=!0)},p(K,le){le&4&&d!==(d=K[2]==0)&&(l.disabled=d),le&4&&g!==(g=K[2]+1+"")&&pt(b,g),le&2&&S!==(S=K[1].length+"")&&pt(L,S),le&6&&$!==($=K[2]==K[1].length-1)&&(R.disabled=$)},d(K){K&&(X(e),X(t),X(n)),H=!1,an(G)}}}function m5(o){let e,t=o[1].length>0&&h0(o);return{c(){e=ee("div"),t&&t.c(),Pe(e,"slot","right")},m(n,l){J(n,e,l),t&&t.m(e,null)},p(n,l){n[1].length>0?t?t.p(n,l):(t=h0(n),t.c(),t.m(e,null)):t&&(t.d(1),t=null)},d(n){n&&X(e),t&&t.d()}}}function _5(o){let e,t,n,l;return e=new yc({props:{$$slots:{right:[m5],map:[p5],left:[s5]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(u,d){je(e,u,d),t=!0,n||(l=ft(window,"keydown",o[12]),n=!0)},p(u,[d]){const a={};d&4196351&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(ne(e.$$.fragment,u),t=!0)},o(u){he(e.$$.fragment,u),t=!1},d(u){Ue(e,u),n=!1,l()}}}function g5(o,e,t){let n,l,u,d,a;bt(o,sn,Y=>t(8,n=Y)),bt(o,Ya,Y=>t(4,l=Y)),bt(o,aa,Y=>t(5,u=Y)),bt(o,In,Y=>t(9,d=Y)),bt(o,Pp,Y=>t(10,a=Y));let{prevMode:g}=e,{browse:b}=e,k=0,S=null,L="",P="los";async function R(Y,ue,fe=""){try{t(6,S=await d.evaluateRoute({start:Y,end:[ue.lng,ue.lat],breakdown:fe})),t(7,L="")}catch(ce){t(6,S=null),t(7,L=ce.toString())}}function Z(Y){oi(aa,u=Y.detail.lngLat,u)}async function $(Y){if(b.length==0)return;let ue=b[Y];oi(aa,u={lng:ue[0].x,lat:ue[0].y},u),oi(Ya,l={lng:ue[1].x,lat:ue[1].y},l),R(u,l,P)}function H(Y){Y.key==="Escape"&&(Y.stopPropagation(),oi(sn,n={kind:"main"},n))}const G=()=>t(2,k--,k),K=()=>t(2,k++,k);function le(Y){u=Y,aa.set(u)}function Se(Y){l=Y,Ya.set(l)}const Le=()=>oi(sn,n=g,n);function te(){P=gs(this),t(3,P)}return o.$$set=Y=>{"prevMode"in Y&&t(0,g=Y.prevMode),"browse"in Y&&t(1,b=Y.browse)},o.$$.update=()=>{o.$$.dirty&56&&R(u,l,P),o.$$.dirty&4&&$(k)},[g,b,k,P,l,u,S,L,n,d,a,Z,H,G,K,le,Se,Le,te]}class y5 extends Wt{constructor(e){super(),Gt(this,e,g5,_5,Vt,{prevMode:0,browse:1})}}function Vn(o,e){return e==0?"0%":`${Math.round(o/e*100)}%`}function Od(o){return o.reduce((e,t)=>e+t,0)}function Nd(o){return["interpolate",["linear"],["zoom"],12,["*",2.1,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",o],.0021]]]]]]],14,["*",5.25,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",o],.0021]]]]]]],15,["*",7.5,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",o],.0021]]]]]]],16,["*",18,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",o],.0021]]]]]]],18,["*",52.5,["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",["get",o],.0021]]]]]]]]}function Qp(o){return["step",["get",o],"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function W1(){return["step",["abs",["get","gradient"]],"#59ee19",3,"#37a009",5,"#FFC300",7,"#C70039",10,"#581845",100,"#000000"]}function d0(o,e,t){const n=o.slice();return n[5]=e[t][0],n[6]=e[t][1],n}function f0(o){let e,t=o[0].succeeded.toLocaleString()+"",n,l,u=o[0].failed.toLocaleString()+"",d,a,g,b,k,S=o[0].max_count.toLocaleString()+"",L,P,R,Z,$,H,G,K=(100*o[0].percent_off_network).toFixed(1)+"",le,Se,Le,te=bi(Object.entries(o[0].percent_on_network)),Y=[];for(let ue=0;ue<te.length;ue+=1)Y[ue]=p0(d0(o,te,ue));return{c(){e=ee("p"),n=be(t),l=be(" routes succeeded, "),d=be(u),a=be(`
        failed`),g=we(),b=ee("p"),k=be("Highest count on any one road is "),L=be(S),P=we(),R=ee("p"),R.textContent="Percent of demand by infrastructure type:",Z=we(),$=ee("ul"),H=ee("li"),G=be("Off the network: "),le=be(K),Se=be("%"),Le=we();for(let ue=0;ue<Y.length;ue+=1)Y[ue].c()},m(ue,fe){J(ue,e,fe),F(e,n),F(e,l),F(e,d),F(e,a),J(ue,g,fe),J(ue,b,fe),F(b,k),F(b,L),J(ue,P,fe),J(ue,R,fe),J(ue,Z,fe),J(ue,$,fe),F($,H),F(H,G),F(H,le),F(H,Se),F($,Le);for(let ce=0;ce<Y.length;ce+=1)Y[ce]&&Y[ce].m($,null)},p(ue,fe){if(fe&1&&t!==(t=ue[0].succeeded.toLocaleString()+"")&&pt(n,t),fe&1&&u!==(u=ue[0].failed.toLocaleString()+"")&&pt(d,u),fe&1&&S!==(S=ue[0].max_count.toLocaleString()+"")&&pt(L,S),fe&1&&K!==(K=(100*ue[0].percent_off_network).toFixed(1)+"")&&pt(le,K),fe&1){te=bi(Object.entries(ue[0].percent_on_network));let ce;for(ce=0;ce<te.length;ce+=1){const ae=d0(ue,te,ce);Y[ce]?Y[ce].p(ae,fe):(Y[ce]=p0(ae),Y[ce].c(),Y[ce].m($,null))}for(;ce<Y.length;ce+=1)Y[ce].d(1);Y.length=te.length}},d(ue){ue&&(X(e),X(g),X(b),X(P),X(R),X(Z),X($)),Bn(Y,ue)}}}function p0(o){let e,t=o[5]+"",n,l,u=(100*o[6]).toFixed(1)+"",d,a;return{c(){e=ee("li"),n=be(t),l=be(": "),d=be(u),a=be("%")},m(g,b){J(g,e,b),F(e,n),F(e,l),F(e,d),F(e,a)},p(g,b){b&1&&t!==(t=g[5]+"")&&pt(n,t),b&1&&u!==(u=(100*g[6]).toFixed(1)+"")&&pt(d,u)},d(g){g&&X(e)}}}function b5(o){let e,t,n,l,u,d,a,g=o[0]&&f0(o);return{c(){e=ee("div"),t=ee("h2"),t.textContent="Evaluate OD mode",n=we(),l=ee("button"),l.textContent="Back",u=we(),g&&g.c(),Pe(e,"slot","left")},m(b,k){J(b,e,k),F(e,t),F(e,n),F(e,l),F(e,u),g&&g.m(e,null),d||(a=ft(l,"click",o[2]),d=!0)},p(b,k){b[0]?g?g.p(b,k):(g=f0(b),g.c(),g.m(e,null)):g&&(g.d(1),g=null)},d(b){b&&X(e),g&&g.d(),d=!1,a()}}}function m0(o){let e,t;return e=new bn({props:{data:o[0],generateId:!0,$$slots:{default:[x5]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.data=n[0]),l&512&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function v5(o){let e=o[4].count+"",t,n,l=o[4].infra_type+"",u;return{c(){t=be(e),n=be(" on "),u=be(l)},m(d,a){J(d,t,a),J(d,n,a),J(d,u,a)},p(d,a){a&16&&e!==(e=d[4].count+"")&&pt(t,e),a&16&&l!==(l=d[4].infra_type+"")&&pt(u,l)},d(d){d&&(X(t),X(n),X(u))}}}function w5(o){let e,t;return e=new mr({props:{openOn:"hover",$$slots:{default:[v5,({props:n})=>({4:n}),({props:n})=>n?16:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&528&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function x5(o){let e,t;return e=new vn({props:{paint:{"line-width":Nd("count"),"line-color":Qp("count")},manageHoverState:!0,eventsIfTopMost:!0,$$slots:{default:[w5]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&512&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function k5(o){let e,t,n=o[0]&&m0(o);return{c(){e=ee("div"),n&&n.c(),Pe(e,"slot","map")},m(l,u){J(l,e,u),n&&n.m(e,null),t=!0},p(l,u){l[0]?n?(n.p(l,u),u&1&&ne(n,1)):(n=m0(l),n.c(),ne(n,1),n.m(e,null)):n&&(ui(),he(n,1,1,()=>{n=null}),hi())},i(l){t||(ne(n),t=!0)},o(l){he(n),t=!1},d(l){l&&X(e),n&&n.d()}}}function S5(o){let e,t;return e=new yc({props:{$$slots:{map:[k5],left:[b5]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,[l]){const u={};l&515&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function T5(o,e,t){let n,l;bt(o,In,a=>t(3,n=a)),bt(o,sn,a=>t(1,l=a));let u=null;return fc(async()=>{t(0,u=await n.evaluateOD())}),[u,l,()=>oi(sn,l={kind:"main"},l)]}class I5 extends Wt{constructor(e){super(),Gt(this,e,T5,S5,Vt,{})}}function C5(o){let e;return{c(){e=ee("ul"),e.innerHTML=`<li>Long distance routes connect EDJ reachable settlements out with main
          urban areas.</li> <li>Settlements should be connected by high demand routes forming a direct
          connection in most cases.</li> <li>Long distance routes should connect directly to primary routes within
          each settlement.</li> <li>Consider SIMD/transport poverty</li> <li>In limited circumstances, settlement can be connected by less
          direct/more scenic routes (NCN)</li>`},m(t,n){J(t,e,n)},d(t){t&&X(e)}}}function E5(o){let e;return{c(){e=ee("p"),e.textContent=`To draw the local access route, connect schools, GPs, hospitals, green
        spaces, neighbourhoods (especially deprived and densely populated ones),
        and above-minimum cycling flow routes on the base map.`},m(t,n){J(t,e,n)},d(t){t&&X(e)}}}function L5(o){let e;return{c(){e=ee("p"),e.textContent=`To draw the secondary route, please connect town centres and cover
        medium cycling flow routes on the base map.`},m(t,n){J(t,e,n)},d(t){t&&X(e)}}}function M5(o){let e;return{c(){e=ee("p"),e.textContent=`The primary route should be direct, coherent, meet high demand, and
        potentially connect settlements. Key primary routes will form Active
        Freeways. To draw the primary route, connect the high cycling flow
        routes on the base map.`},m(t,n){J(t,e,n)},d(t){t&&X(e)}}}function A5(o){let e;function t(u,d){if(u[0]=="Primary")return M5;if(u[0]=="Secondary")return L5;if(u[0]=="LocalAccess")return E5;if(u[0]=="LongDistance")return C5}let n=t(o),l=n&&n(o);return{c(){l&&l.c(),e=Ei()},m(u,d){l&&l.m(u,d),J(u,e,d)},p(u,d){n!==(n=t(u))&&(l&&l.d(1),l=n&&n(u),l&&(l.c(),l.m(e.parentNode,e)))},d(u){u&&X(e),l&&l.d(u)}}}function P5(o){let e,t,n,l,u,d,a,g,b,k,S,L,P;return k=new q1({props:{$$slots:{default:[A5]},$$scope:{ctx:o}}}),{c(){e=ee("div"),t=ee("button"),t.textContent="Primary routes",n=we(),l=ee("button"),l.textContent="Secondary routes",u=we(),d=ee("button"),d.textContent="Local access routes",a=we(),g=ee("button"),g.textContent="Long distance routes",b=we(),Ve(k.$$.fragment),Pe(t,"class","svelte-gv50c1"),mi(t,"background",o[0]=="Primary"?Kn.Primary:"grey"),Pe(l,"class","svelte-gv50c1"),mi(l,"background",o[0]=="Secondary"?Kn.Secondary:"grey"),Pe(d,"class","svelte-gv50c1"),mi(d,"background",o[0]=="LocalAccess"?Kn.LocalAccess:"grey"),Pe(g,"class","svelte-gv50c1"),mi(g,"background",o[0]=="LongDistance"?Kn.LongDistance:"grey"),Pe(e,"class","svelte-gv50c1")},m(R,Z){J(R,e,Z),F(e,t),F(e,n),F(e,l),F(e,u),F(e,d),F(e,a),F(e,g),F(e,b),je(k,e,null),S=!0,L||(P=[ft(t,"click",o[1]),ft(l,"click",o[2]),ft(d,"click",o[3]),ft(g,"click",o[4])],L=!0)},p(R,[Z]){Z&1&&mi(t,"background",R[0]=="Primary"?Kn.Primary:"grey"),Z&1&&mi(l,"background",R[0]=="Secondary"?Kn.Secondary:"grey"),Z&1&&mi(d,"background",R[0]=="LocalAccess"?Kn.LocalAccess:"grey"),Z&1&&mi(g,"background",R[0]=="LongDistance"?Kn.LongDistance:"grey");const $={};Z&33&&($.$$scope={dirty:Z,ctx:R}),k.$set($)},i(R){S||(ne(k.$$.fragment,R),S=!0)},o(R){he(k.$$.fragment,R),S=!1},d(R){R&&X(e),Ue(k),L=!1,an(P)}}}function z5(o,e,t){let n;return bt(o,ps,g=>t(0,n=g)),[n,()=>oi(ps,n="Primary",n),()=>oi(ps,n="Secondary",n),()=>oi(ps,n="LocalAccess",n),()=>oi(ps,n="LongDistance",n)]}class D5 extends Wt{constructor(e){super(),Gt(this,e,z5,P5,Vt,{})}}function R5(o){let e,t;const n=o[3].default,l=fn(n,o,o[2],null);return{c(){e=ee("div"),l&&l.c()},m(u,d){J(u,e,d),l&&l.m(e,null),o[4](e),t=!0},p(u,[d]){l&&l.p&&(!t||d&4)&&mn(l,n,u,u[2],t?pn(n,u[2],d,null):_n(u[2]),null)},i(u){t||(ne(l,u),t=!0)},o(u){he(l,u),t=!1},d(u){u&&X(e),l&&l.d(u),o[4](null)}}}function F5(o,e,t){let{$$slots:n={},$$scope:l}=e,{name:u}=e,d=null;function a(g){Ai[g?"unshift":"push"](()=>{d=g,t(0,d)})}return o.$$set=g=>{"name"in g&&t(1,u=g.name),"$$scope"in g&&t(2,l=g.$$scope)},o.$$.update=()=>{o.$$.dirty&3&&d&&$1.update(g=>(g.set(u,d),g))},[d,u,l,n,a]}class eo extends Wt{constructor(e){super(),Gt(this,e,F5,R5,Vt,{name:1})}}function _0(o){let e,t,n,l,u,d,a,g,b,k,S;return{c(){e=ee("button"),e.textContent="Import existing routes",t=we(),n=ee("label"),l=ee("input"),u=be(`
      Show osmactive data`),d=we(),a=ee("label"),g=ee("input"),b=be(`
      Show calculated data`),Pe(e,"class","outline"),Pe(l,"type","checkbox"),Pe(g,"type","checkbox")},m(L,P){J(L,e,P),J(L,t,P),J(L,n,P),F(n,l),l.checked=o[3],F(n,u),J(L,d,P),J(L,a,P),F(a,g),g.checked=o[4],F(a,b),k||(S=[ft(e,"click",o[8]),ft(l,"change",o[9]),ft(g,"change",o[10])],k=!0)},p(L,P){P&8&&(l.checked=L[3]),P&16&&(g.checked=L[4])},d(L){L&&(X(e),X(t),X(n),X(d),X(a)),k=!1,an(S)}}}function B5(o){let e,t,n,l,u,d,a,g=o[0]&&_0(o);return{c(){e=ee("label"),t=ee("input"),n=be(`
    Existing network`),l=we(),g&&g.c(),u=Ei(),Pe(t,"type","checkbox")},m(b,k){J(b,e,k),F(e,t),t.checked=o[0],F(e,n),J(b,l,k),g&&g.m(b,k),J(b,u,k),d||(a=ft(t,"change",o[7]),d=!0)},p(b,k){k&1&&(t.checked=b[0]),b[0]?g?g.p(b,k):(g=_0(b),g.c(),g.m(u.parentNode,u)):g&&(g.d(1),g=null)},d(b){b&&(X(e),X(l),X(u)),g&&g.d(b),d=!1,a()}}}function g0(o){let e,t;return e=new O1({props:{$$slots:{default:[O5]},$$scope:{ctx:o}}}),e.$on("close",o[12]),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&131076&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function O5(o){let e,t,n,l,u,d,a,g,b;return{c(){e=ee("h2"),e.textContent="Import existing routes from OpenStreetMap",t=we(),n=ee("p"),l=be(`This will add existing routes to your network. Only Segregated Tracks
      (wide and narrow) and Off Road Cycleways will be imported; other
      infrastructure types are not high-quality enough in practice to be
      considered part of the network. OpenStreetMap data and this tool's
      interpretation of it are imperfect, so please check the results carefully
      and remove / adjust any errors.

      `),u=ee("button"),u.textContent="Import existing routes",d=we(),a=ee("button"),a.textContent="Cancel",Pe(a,"class","secondary")},m(k,S){J(k,e,S),J(k,t,S),J(k,n,S),F(n,l),F(n,u),F(n,d),F(n,a),g||(b=[ft(u,"click",o[6]),ft(a,"click",o[11])],g=!0)},p:Ze,d(k){k&&(X(e),X(t),X(n)),g=!1,an(b)}}}function N5(o){let e,t=o[16]["Infrastructure type"]+"",n;return{c(){e=be("osmactive: "),n=be(t)},m(l,u){J(l,e,u),J(l,n,u)},p(l,u){u&65536&&t!==(t=l[16]["Infrastructure type"]+"")&&pt(n,t)},d(l){l&&(X(e),X(n))}}}function j5(o){let e,t;return e=new mr({props:{openOn:"hover",$$slots:{default:[N5,({props:n})=>({16:n}),({props:n})=>n?65536:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&196608&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function U5(o){let e,t;return e=new vn({props:{sourceLayer:"cbd_layer",filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"],paint:{"line-color":ba(["get","Infrastructure type"],{"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#FF0000"},"cyan"),"line-width":3},layout:{visibility:o[0]&&o[3]?"visible":"none"},$$slots:{default:[j5]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&9&&(u.layout={visibility:n[0]&&n[3]?"visible":"none"}),l&131072&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function y0(o){let e,t,n,l={ctx:o,current:null,token:null,hasCatch:!1,pending:W5,then:V5,catch:$5,value:15,blocks:[,,,]};return Ar(t=o[5].classifyExistingNetwork(),l),{c(){e=Ei(),l.block.c()},m(u,d){J(u,e,d),l.block.m(u,l.anchor=d),l.mount=()=>e.parentNode,l.anchor=e,n=!0},p(u,d){o=u,l.ctx=o,d&32&&t!==(t=o[5].classifyExistingNetwork())&&Ar(t,l)||pa(l,o,d)},i(u){n||(ne(l.block),n=!0)},o(u){for(let d=0;d<3;d+=1){const a=l.blocks[d];he(a)}n=!1},d(u){u&&X(e),l.block.d(u),l.token=null,l=null}}}function $5(o){return{c:Ze,m:Ze,p:Ze,i:Ze,o:Ze,d:Ze}}function V5(o){let e,t;return e=new bn({props:{data:o[15],generateId:!0,$$slots:{default:[G5]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&32&&(u.data=n[15]),l&131089&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function q5(o){let e=uc[o[16].infra_type][0]+"",t;return{c(){t=be(e)},m(n,l){J(n,t,l)},p(n,l){l&65536&&e!==(e=uc[n[16].infra_type][0]+"")&&pt(t,e)},d(n){n&&X(t)}}}function Z5(o){let e,t;return e=new mr({props:{openOn:"hover",$$slots:{default:[q5,({props:n})=>({16:n}),({props:n})=>n?65536:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&196608&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function G5(o){let e,t;return e=new vn({props:{layout:{visibility:o[0]&&o[4]?"visible":"none"},paint:{"line-width":Jn(5,7),"line-color":fa,"line-opacity":.8},manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[Z5]},$$scope:{ctx:o}}}),e.$on("click",o[13]),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&17&&(u.layout={visibility:n[0]&&n[4]?"visible":"none"}),l&131072&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function W5(o){return{c:Ze,m:Ze,p:Ze,i:Ze,o:Ze,d:Ze}}function H5(o){let e,t,n,l,u,d,a;e=new eo({props:{name:"existing network",$$slots:{default:[B5]},$$scope:{ctx:o}}});let g=o[2]&&g0(o);l=new oh({props:{url:`pmtiles://${bc("cbd.pmtiles")}`,$$slots:{default:[U5]},$$scope:{ctx:o}}});let b=o[5]&&o[1]&&y0(o);return{c(){Ve(e.$$.fragment),t=we(),g&&g.c(),n=we(),Ve(l.$$.fragment),u=we(),b&&b.c(),d=Ei()},m(k,S){je(e,k,S),J(k,t,S),g&&g.m(k,S),J(k,n,S),je(l,k,S),J(k,u,S),b&&b.m(k,S),J(k,d,S),a=!0},p(k,[S]){const L={};S&131101&&(L.$$scope={dirty:S,ctx:k}),e.$set(L),k[2]?g?(g.p(k,S),S&4&&ne(g,1)):(g=g0(k),g.c(),ne(g,1),g.m(n.parentNode,n)):g&&(ui(),he(g,1,1,()=>{g=null}),hi());const P={};S&131081&&(P.$$scope={dirty:S,ctx:k}),l.$set(P),k[5]&&k[1]?b?(b.p(k,S),S&34&&ne(b,1)):(b=y0(k),b.c(),ne(b,1),b.m(d.parentNode,d)):b&&(ui(),he(b,1,1,()=>{b=null}),hi())},i(k){a||(ne(e.$$.fragment,k),ne(g),ne(l.$$.fragment,k),ne(b),a=!0)},o(k){he(e.$$.fragment,k),he(g),he(l.$$.fragment,k),he(b),a=!1},d(k){k&&(X(t),X(n),X(u),X(d)),Ue(e,k),g&&g.d(k),Ue(l,k),b&&b.d(k)}}}function X5(o,e,t){let n,l;bt(o,eh,G=>t(14,n=G)),bt(o,In,G=>t(5,l=G));let u=!1,d=!1,a=!1;async function g(){if(t(2,a=!1),l){let G=l.importExistingRoutes(),K=G==1?"route segment":"route segments";await th(),oi(eh,n+=1,n),window.alert(`Imported ${G} ${K}`),t(0,u=!1)}}let b=!0,k=!0;function S(){u=this.checked,t(0,u)}const L=()=>t(2,a=!0);function P(){b=this.checked,t(3,b)}function R(){k=this.checked,t(4,k)}const Z=()=>t(2,a=!1),$=()=>t(2,a=!1),H=G=>window.open(Mo(G.detail.features[0].properties).way,"_blank");return o.$$.update=()=>{o.$$.dirty&1&&u&&t(1,d=!0)},[u,d,a,b,k,l,g,S,L,P,R,Z,$,H]}class K5 extends Wt{constructor(e){super(),Gt(this,e,X5,H5,Vt,{})}}function b0(o,e,t){const n=o.slice();return n[17]=e[t][0],n[18]=e[t][1],n}function v0(o,e,t){const n=o.slice();return n[17]=e[t][0],n[18]=e[t][1],n}function w0(o,e,t){const n=o.slice();return n[17]=e[t][0],n[18]=e[t][1],n}function x0(o,e,t){const n=o.slice();return n[17]=e[t][0],n[18]=e[t][1],n}function k0(o,e,t){const n=o.slice();return n[17]=e[t][0],n[18]=e[t][1],n}function S0(o,e,t){const n=o.slice();return n[17]=e[t][0],n[18]=e[t][1],n}function T0(o){let e,t,n,l,u,d,a,g,b,k,S,L,P,R,Z,$,H,G=bi(o[7]),K=[];for(let fe=0;fe<G.length;fe+=1)K[fe]=I0(S0(o,G,fe));let le=bi(o[8]),Se=[];for(let fe=0;fe<le.length;fe+=1)Se[fe]=C0(k0(o,le,fe));let Le=bi(o[9]),te=[];for(let fe=0;fe<Le.length;fe+=1)te[fe]=E0(x0(o,Le,fe));let Y=bi(o[10]),ue=[];for(let fe=0;fe<Y.length;fe+=1)ue[fe]=L0(w0(o,Y,fe));return{c(){e=ee("label"),t=be(`Trip purpose:
      `),n=ee("select");for(let fe=0;fe<K.length;fe+=1)K[fe].c();l=we(),u=ee("label"),d=be(`Scenario:
      `),a=ee("select");for(let fe=0;fe<Se.length;fe+=1)Se[fe].c();g=we(),b=ee("label"),k=be(`Network type:
      `),S=ee("select");for(let fe=0;fe<te.length;fe+=1)te[fe].c();L=we(),P=ee("label"),R=be(`Color by:
      `),Z=ee("select");for(let fe=0;fe<ue.length;fe+=1)ue[fe].c();o[0]===void 0&&Co(()=>o[12].call(n)),o[1]===void 0&&Co(()=>o[13].call(a)),o[2]===void 0&&Co(()=>o[14].call(S)),o[3]===void 0&&Co(()=>o[15].call(Z))},m(fe,ce){J(fe,e,ce),F(e,t),F(e,n);for(let ae=0;ae<K.length;ae+=1)K[ae]&&K[ae].m(n,null);lr(n,o[0],!0),J(fe,l,ce),J(fe,u,ce),F(u,d),F(u,a);for(let ae=0;ae<Se.length;ae+=1)Se[ae]&&Se[ae].m(a,null);lr(a,o[1],!0),J(fe,g,ce),J(fe,b,ce),F(b,k),F(b,S);for(let ae=0;ae<te.length;ae+=1)te[ae]&&te[ae].m(S,null);lr(S,o[2],!0),J(fe,L,ce),J(fe,P,ce),F(P,R),F(P,Z);for(let ae=0;ae<ue.length;ae+=1)ue[ae]&&ue[ae].m(Z,null);lr(Z,o[3],!0),$||(H=[ft(n,"change",o[12]),ft(a,"change",o[13]),ft(S,"change",o[14]),ft(Z,"change",o[15])],$=!0)},p(fe,ce){if(ce[0]&128){G=bi(fe[7]);let ae;for(ae=0;ae<G.length;ae+=1){const We=S0(fe,G,ae);K[ae]?K[ae].p(We,ce):(K[ae]=I0(We),K[ae].c(),K[ae].m(n,null))}for(;ae<K.length;ae+=1)K[ae].d(1);K.length=G.length}if(ce[0]&129&&lr(n,fe[0]),ce[0]&256){le=bi(fe[8]);let ae;for(ae=0;ae<le.length;ae+=1){const We=k0(fe,le,ae);Se[ae]?Se[ae].p(We,ce):(Se[ae]=C0(We),Se[ae].c(),Se[ae].m(a,null))}for(;ae<Se.length;ae+=1)Se[ae].d(1);Se.length=le.length}if(ce[0]&258&&lr(a,fe[1]),ce[0]&512){Le=bi(fe[9]);let ae;for(ae=0;ae<Le.length;ae+=1){const We=x0(fe,Le,ae);te[ae]?te[ae].p(We,ce):(te[ae]=E0(We),te[ae].c(),te[ae].m(S,null))}for(;ae<te.length;ae+=1)te[ae].d(1);te.length=Le.length}if(ce[0]&516&&lr(S,fe[2]),ce[0]&1024){Y=bi(fe[10]);let ae;for(ae=0;ae<Y.length;ae+=1){const We=w0(fe,Y,ae);ue[ae]?ue[ae].p(We,ce):(ue[ae]=L0(We),ue[ae].c(),ue[ae].m(Z,null))}for(;ae<ue.length;ae+=1)ue[ae].d(1);ue.length=Y.length}ce[0]&1032&&lr(Z,fe[3])},d(fe){fe&&(X(e),X(l),X(u),X(g),X(b),X(L),X(P)),Bn(K,fe),Bn(Se,fe),Bn(te,fe),Bn(ue,fe),$=!1,an(H)}}}function I0(o){let e,t=o[18]+"",n;return{c(){e=ee("option"),n=be(t),e.__value=o[17],Vi(e,e.__value)},m(l,u){J(l,e,u),F(e,n)},p:Ze,d(l){l&&X(e)}}}function C0(o){let e,t=o[18]+"",n;return{c(){e=ee("option"),n=be(t),e.__value=o[17],Vi(e,e.__value)},m(l,u){J(l,e,u),F(e,n)},p:Ze,d(l){l&&X(e)}}}function E0(o){let e,t=o[18]+"",n;return{c(){e=ee("option"),n=be(t),e.__value=o[17],Vi(e,e.__value)},m(l,u){J(l,e,u),F(e,n)},p:Ze,d(l){l&&X(e)}}}function L0(o){let e,t=o[18]+"",n;return{c(){e=ee("option"),n=be(t),e.__value=o[17],Vi(e,e.__value)},m(l,u){J(l,e,u),F(e,n)},p:Ze,d(l){l&&X(e)}}}function J5(o){let e,t,n,l,u,d,a,g=o[5]&&T0(o);return{c(){e=ee("label"),t=ee("input"),n=be(`
    Route network`),l=we(),g&&g.c(),u=Ei(),Pe(t,"type","checkbox")},m(b,k){J(b,e,k),F(e,t),t.checked=o[5],F(e,n),J(b,l,k),g&&g.m(b,k),J(b,u,k),d||(a=ft(t,"change",o[11]),d=!0)},p(b,k){k[0]&32&&(t.checked=b[5]),b[5]?g?g.p(b,k):(g=T0(b),g.c(),g.m(u.parentNode,u)):g&&(g.d(1),g=null)},d(b){b&&(X(e),X(l),X(u)),g&&g.d(b),d=!1,a()}}}function M0(o){let e,t,n,l,u=o[16][`${o[17]}_fastest_bicycle`].toLocaleString()+"",d,a,g,b=o[16][`${o[17]}_fastest_bicycle_go_dutch`].toLocaleString()+"",k,S,L,P=o[16][`${o[17]}_fastest_bicycle_ebike`].toLocaleString()+"",R,Z;return{c(){e=ee("tr"),t=ee("th"),t.textContent=`${o[18]}`,n=we(),l=ee("td"),d=be(u),a=we(),g=ee("td"),k=be(b),S=we(),L=ee("td"),R=be(P),Z=we()},m($,H){J($,e,H),F(e,t),F(e,n),F(e,l),F(l,d),F(e,a),F(e,g),F(g,k),F(e,S),F(e,L),F(L,R),F(e,Z)},p($,H){H[0]&65536&&u!==(u=$[16][`${$[17]}_fastest_bicycle`].toLocaleString()+"")&&pt(d,u),H[0]&65536&&b!==(b=$[16][`${$[17]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&pt(k,b),H[0]&65536&&P!==(P=$[16][`${$[17]}_fastest_bicycle_ebike`].toLocaleString()+"")&&pt(R,P)},d($){$&&X(e)}}}function A0(o){let e,t,n,l,u=o[16][`${o[17]}_quietest_bicycle`].toLocaleString()+"",d,a,g,b=o[16][`${o[17]}_quietest_bicycle_go_dutch`].toLocaleString()+"",k,S,L,P=o[16][`${o[17]}_quietest_bicycle_ebike`].toLocaleString()+"",R,Z;return{c(){e=ee("tr"),t=ee("th"),t.textContent=`${o[18]}`,n=we(),l=ee("td"),d=be(u),a=we(),g=ee("td"),k=be(b),S=we(),L=ee("td"),R=be(P),Z=we()},m($,H){J($,e,H),F(e,t),F(e,n),F(e,l),F(l,d),F(e,a),F(e,g),F(g,k),F(e,S),F(e,L),F(L,R),F(e,Z)},p($,H){H[0]&65536&&u!==(u=$[16][`${$[17]}_quietest_bicycle`].toLocaleString()+"")&&pt(d,u),H[0]&65536&&b!==(b=$[16][`${$[17]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&pt(k,b),H[0]&65536&&P!==(P=$[16][`${$[17]}_quietest_bicycle_ebike`].toLocaleString()+"")&&pt(R,P)},d($){$&&X(e)}}}function Y5(o){let e,t,n,l=o[16][o[4]].toLocaleString()+"",u,d,a,g,b=o[16].gradient+"",k,S,L,P,R,Z=o[16].quietness+"",$,H,G,K,le,Se,Le,te,Y,ue,fe,ce,ae,We,Ee,ze,rt,it=bi(o[7]),Qe=[];for(let ut=0;ut<it.length;ut+=1)Qe[ut]=M0(v0(o,it,ut));let Ft=bi(o[7]),jt=[];for(let ut=0;ut<Ft.length;ut+=1)jt[ut]=A0(b0(o,Ft,ut));return{c(){e=ee("div"),t=ee("p"),n=be("Cyclists: "),u=be(l),d=we(),a=ee("p"),g=be("Gradient: "),k=be(b),S=be("%"),L=we(),P=ee("p"),R=be("Cycle-friendliness: "),$=be(Z),H=be("%"),G=we(),K=ee("details"),le=ee("summary"),le.textContent="All network details",Se=we(),Le=ee("p"),Le.textContent="Fast/Direct network",te=we(),Y=ee("table"),ue=ee("tr"),ue.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",fe=we();for(let ut=0;ut<Qe.length;ut+=1)Qe[ut].c();ce=we(),ae=ee("p"),ae.textContent="Quiet/Indirect network",We=we(),Ee=ee("table"),ze=ee("tr"),ze.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",rt=we();for(let ut=0;ut<jt.length;ut+=1)jt[ut].c();mi(e,"max-width","30vw"),mi(e,"max-height","60vh"),mi(e,"overflow","auto")},m(ut,et){J(ut,e,et),F(e,t),F(t,n),F(t,u),F(e,d),F(e,a),F(a,g),F(a,k),F(a,S),F(e,L),F(e,P),F(P,R),F(P,$),F(P,H),F(e,G),F(e,K),F(K,le),F(K,Se),F(K,Le),F(K,te),F(K,Y),F(Y,ue),F(Y,fe);for(let at=0;at<Qe.length;at+=1)Qe[at]&&Qe[at].m(Y,null);F(K,ce),F(K,ae),F(K,We),F(K,Ee),F(Ee,ze),F(Ee,rt);for(let at=0;at<jt.length;at+=1)jt[at]&&jt[at].m(Ee,null)},p(ut,et){if(et[0]&65552&&l!==(l=ut[16][ut[4]].toLocaleString()+"")&&pt(u,l),et[0]&65536&&b!==(b=ut[16].gradient+"")&&pt(k,b),et[0]&65536&&Z!==(Z=ut[16].quietness+"")&&pt($,Z),et[0]&65664){it=bi(ut[7]);let at;for(at=0;at<it.length;at+=1){const Bt=v0(ut,it,at);Qe[at]?Qe[at].p(Bt,et):(Qe[at]=M0(Bt),Qe[at].c(),Qe[at].m(Y,null))}for(;at<Qe.length;at+=1)Qe[at].d(1);Qe.length=it.length}if(et[0]&65664){Ft=bi(ut[7]);let at;for(at=0;at<Ft.length;at+=1){const Bt=b0(ut,Ft,at);jt[at]?jt[at].p(Bt,et):(jt[at]=A0(Bt),jt[at].c(),jt[at].m(Ee,null))}for(;at<jt.length;at+=1)jt[at].d(1);jt.length=Ft.length}},d(ut){ut&&X(e),Bn(Qe,ut),Bn(jt,ut)}}}function Q5(o){let e,t;return e=new mr({props:{openOn:"click",$$slots:{default:[Y5,({props:n})=>({16:n}),({props:n})=>[n?65536:0]]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l[0]&65552|l[1]&1&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function eT(o){let e,t;return e=new vn({props:{sourceLayer:"rnet",paint:{"line-color":o[6],"line-width":Nd(o[4])},layout:{visibility:o[5]?"visible":"none"},hoverCursor:"pointer",$$slots:{default:[Q5]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l[0]&80&&(u.paint={"line-color":n[6],"line-width":Nd(n[4])}),l[0]&32&&(u.layout={visibility:n[5]?"visible":"none"}),l[0]&16|l[1]&1&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function tT(o){let e,t,n,l;return e=new eo({props:{name:"route network",$$slots:{default:[J5]},$$scope:{ctx:o}}}),n=new oh({props:{url:`pmtiles://${bc("route_network.pmtiles")}`,$$slots:{default:[eT]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment),t=we(),Ve(n.$$.fragment)},m(u,d){je(e,u,d),J(u,t,d),je(n,u,d),l=!0},p(u,d){const a={};d[0]&47|d[1]&1&&(a.$$scope={dirty:d,ctx:u}),e.$set(a);const g={};d[0]&112|d[1]&1&&(g.$$scope={dirty:d,ctx:u}),n.$set(g)},i(u){l||(ne(e.$$.fragment,u),ne(n.$$.fragment,u),l=!0)},o(u){he(e.$$.fragment,u),he(n.$$.fragment,u),l=!1},d(u){u&&X(t),Ue(e,u),Ue(n,u)}}}function iT(o,e,t){let n,l,u=!1,d="all",a="bicycle_go_dutch",g="fastest",b="flow",k=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],S=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],L=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],P=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]];function R(){u=this.checked,t(5,u)}function Z(){d=gs(this),t(0,d),t(7,k)}function $(){a=gs(this),t(1,a),t(8,S)}function H(){g=gs(this),t(2,g),t(9,L)}function G(){b=gs(this),t(3,b),t(10,P)}return o.$$.update=()=>{o.$$.dirty[0]&7&&t(4,n=`${d}_${g}_${a}`),o.$$.dirty[0]&24&&t(6,l={none:"#304ce7",flow:Qp(n),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:W1}[b])},[d,a,g,b,n,u,l,k,S,L,P,R,Z,$,H,G]}class nT extends Wt{constructor(e){super(),Gt(this,e,iT,tT,Vt,{},null,[-1,-1])}}function P0(o){let e,t,n,l,u,d,a,g,b,k,S;return{c(){e=ee("button"),e.textContent="Import core network",t=we(),n=ee("label"),l=ee("input"),u=be(`
      Show actual core network`),d=we(),a=ee("label"),g=ee("input"),b=be(`
      Show map-matched core network`),Pe(e,"class","outline"),Pe(l,"type","checkbox"),Pe(g,"type","checkbox")},m(L,P){J(L,e,P),J(L,t,P),J(L,n,P),F(n,l),l.checked=o[2],F(n,u),J(L,d,P),J(L,a,P),F(a,g),g.checked=o[3],F(a,b),k||(S=[ft(e,"click",o[5]),ft(l,"change",o[7]),ft(g,"change",o[8])],k=!0)},p(L,P){P&4&&(l.checked=L[2]),P&8&&(g.checked=L[3])},d(L){L&&(X(e),X(t),X(n),X(d),X(a)),k=!1,an(S)}}}function rT(o){let e,t,n,l,u,d,a,g=o[0]&&P0(o);return{c(){e=ee("label"),t=ee("input"),n=be(`
    Core network`),l=we(),g&&g.c(),u=Ei(),Pe(t,"type","checkbox")},m(b,k){J(b,e,k),F(e,t),t.checked=o[0],F(e,n),J(b,l,k),g&&g.m(b,k),J(b,u,k),d||(a=ft(t,"change",o[6]),d=!0)},p(b,k){k&1&&(t.checked=b[0]),b[0]?g?g.p(b,k):(g=P0(b),g.c(),g.m(u.parentNode,u)):g&&(g.d(1),g=null)},d(b){b&&(X(e),X(l),X(u)),g&&g.d(b),d=!1,a()}}}function oT(o){let e,t=o[11].all_fastest_bicycle_go_dutch+"",n;return{c(){e=be("Go Dutch value "),n=be(t)},m(l,u){J(l,e,u),J(l,n,u)},p(l,u){u&2048&&t!==(t=l[11].all_fastest_bicycle_go_dutch+"")&&pt(n,t)},d(l){l&&(X(e),X(n))}}}function sT(o){let e,t;return e=new mr({props:{openOn:"hover",$$slots:{default:[oT,({props:n})=>({11:n}),({props:n})=>n?2048:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&6144&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function aT(o){let e,t;return e=new vn({props:{sourceLayer:"coherent_networks",paint:{"line-color":ba(["get","road_function"],{Primary:"#c00000",Secondary:"#e97132","Local Access":"#ffc000","Long Distance":"#4ea72e"},"cyan"),"line-width":2},layout:{visibility:o[0]&&o[2]?"visible":"none"},$$slots:{default:[sT]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&5&&(u.layout={visibility:n[0]&&n[2]?"visible":"none"}),l&4096&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function z0(o){let e,t,n,l={ctx:o,current:null,token:null,hasCatch:!1,pending:hT,then:cT,catch:lT,value:10,blocks:[,,,]};return Ar(t=o[4].renderCoreNetwork(),l),{c(){e=Ei(),l.block.c()},m(u,d){J(u,e,d),l.block.m(u,l.anchor=d),l.mount=()=>e.parentNode,l.anchor=e,n=!0},p(u,d){o=u,l.ctx=o,d&16&&t!==(t=o[4].renderCoreNetwork())&&Ar(t,l)||pa(l,o,d)},i(u){n||(ne(l.block),n=!0)},o(u){for(let d=0;d<3;d+=1){const a=l.blocks[d];he(a)}n=!1},d(u){u&&X(e),l.block.d(u),l.token=null,l=null}}}function lT(o){return{c:Ze,m:Ze,p:Ze,i:Ze,o:Ze,d:Ze}}function cT(o){let e,t;return e=new bn({props:{data:o[10],generateId:!0,$$slots:{default:[uT]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&16&&(u.data=n[10]),l&4105&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function uT(o){let e,t;return e=new vn({props:{paint:{"line-color":Dp,"line-width":10,"line-opacity":.5},layout:{visibility:o[0]&&o[3]?"visible":"none"}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&9&&(u.layout={visibility:n[0]&&n[3]?"visible":"none"}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function hT(o){return{c:Ze,m:Ze,p:Ze,i:Ze,o:Ze,d:Ze}}function dT(o){let e,t,n,l,u,d;e=new eo({props:{name:"core network",$$slots:{default:[rT]},$$scope:{ctx:o}}}),n=new oh({props:{url:`pmtiles://${bc("core_network.pmtiles")}`,$$slots:{default:[aT]},$$scope:{ctx:o}}});let a=o[4]&&o[1]&&z0(o);return{c(){Ve(e.$$.fragment),t=we(),Ve(n.$$.fragment),l=we(),a&&a.c(),u=Ei()},m(g,b){je(e,g,b),J(g,t,b),je(n,g,b),J(g,l,b),a&&a.m(g,b),J(g,u,b),d=!0},p(g,[b]){const k={};b&4109&&(k.$$scope={dirty:b,ctx:g}),e.$set(k);const S={};b&4101&&(S.$$scope={dirty:b,ctx:g}),n.$set(S),g[4]&&g[1]?a?(a.p(g,b),b&18&&ne(a,1)):(a=z0(g),a.c(),ne(a,1),a.m(u.parentNode,u)):a&&(ui(),he(a,1,1,()=>{a=null}),hi())},i(g){d||(ne(e.$$.fragment,g),ne(n.$$.fragment,g),ne(a),d=!0)},o(g){he(e.$$.fragment,g),he(n.$$.fragment,g),he(a),d=!1},d(g){g&&(X(t),X(l),X(u)),Ue(e,g),Ue(n,g),a&&a.d(g)}}}function fT(o,e,t){let n,l;bt(o,eh,P=>t(9,n=P)),bt(o,In,P=>t(4,l=P));let u=!1,d=!1,a=!0,g=!0;async function b(){if(l){let P=l.importCoreNetwork(),R=P==1?"route segment":"route segments";await th(),oi(eh,n+=1,n),window.alert(`Imported ${P} ${R}`)}}function k(){u=this.checked,t(0,u)}function S(){a=this.checked,t(2,a)}function L(){g=this.checked,t(3,g)}return o.$$.update=()=>{o.$$.dirty&1&&u&&t(1,d=!0)},[u,d,a,g,l,b,k,S,L]}class pT extends Wt{constructor(e){super(),Gt(this,e,fT,dT,Vt,{})}}function mT(o){let e,t;return e=new vn({props:{paint:{"line-width":3,"line-color":["case",["==",["get","kind"],"severance"],"red","blue"]}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p:Ze,i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function _T(o){let e,t;return e=new bn({props:{data:o[0],generateId:!0,$$slots:{default:[mT]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.data=n[0]),l&32&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function gT(o,e,t){let n;bt(o,In,g=>t(3,n=g));let{kind:l}=e,{hovered:u}=e,d={type:"FeatureCollection",features:[]};async function a(g){n&&g?g.properties.reachable?t(0,d=await n.debugReachablePath(l,g.properties.idx)):t(0,d=await n.debugUnreachablePath(l,g.properties.idx)):t(0,d={type:"FeatureCollection",features:[]})}return o.$$set=g=>{"kind"in g&&t(1,l=g.kind),"hovered"in g&&t(2,u=g.hovered)},o.$$.update=()=>{o.$$.dirty&4&&a(u)},[d,l,u]}class em extends Wt{constructor(e){super(),Gt(this,e,gT,_T,Vt,{kind:1,hovered:2})}}function D0(o){let e,t,n,l=o[3].toLocaleString()+"",u,d,a=o[0].features.length.toLocaleString()+"",g,b,k=Vn(o[3],o[0].features.length)+"",S,L,P,R,Z,$,H;return R=new Qa({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=ee("button"),e.textContent="Recalculate",t=we(),n=ee("p"),u=be(l),d=be(" / "),g=be(a),b=be(" ("),S=be(k),L=be(") reachable"),P=we(),Ve(R.$$.fragment),Pe(e,"class","outline")},m(G,K){J(G,e,K),J(G,t,K),J(G,n,K),F(n,u),F(n,d),F(n,g),F(n,b),F(n,S),F(n,L),J(G,P,K),je(R,G,K),Z=!0,$||(H=ft(e,"click",o[4]),$=!0)},p(G,K){(!Z||K&8)&&l!==(l=G[3].toLocaleString()+"")&&pt(u,l),(!Z||K&1)&&a!==(a=G[0].features.length.toLocaleString()+"")&&pt(g,a),(!Z||K&9)&&k!==(k=Vn(G[3],G[0].features.length)+"")&&pt(S,k)},i(G){Z||(ne(R.$$.fragment,G),Z=!0)},o(G){he(R.$$.fragment,G),Z=!1},d(G){G&&(X(e),X(t),X(n),X(P)),Ue(R,G),$=!1,H()}}}function yT(o){let e,t,n,l,u,d,a,g,b=o[1]&&D0(o);return{c(){e=ee("label"),t=ee("input"),n=be(`
    Schools`),l=we(),b&&b.c(),u=Ei(),Pe(t,"type","checkbox")},m(k,S){J(k,e,S),F(e,t),t.checked=o[1],F(e,n),J(k,l,S),b&&b.m(k,S),J(k,u,S),d=!0,a||(g=ft(t,"change",o[5]),a=!0)},p(k,S){S&2&&(t.checked=k[1]),k[1]?b?(b.p(k,S),S&2&&ne(b,1)):(b=D0(k),b.c(),ne(b,1),b.m(u.parentNode,u)):b&&(ui(),he(b,1,1,()=>{b=null}),hi())},i(k){d||(ne(b),d=!0)},o(k){he(b),d=!1},d(k){k&&(X(e),X(l),X(u)),b&&b.d(k),a=!1,g()}}}function bT(o){let e=o[8].name+"",t,n,l=o[8].kind+"",u,d,a=o[8].pupils+"",g,b,k=o[8].reachable?"is":"is not",S,L;return{c(){t=be(e),n=be(" is a "),u=be(l),d=be(" school with "),g=be(a),b=be(" pupils. It "),S=be(k),L=be(" reachable.")},m(P,R){J(P,t,R),J(P,n,R),J(P,u,R),J(P,d,R),J(P,g,R),J(P,b,R),J(P,S,R),J(P,L,R)},p(P,R){R&256&&e!==(e=P[8].name+"")&&pt(t,e),R&256&&l!==(l=P[8].kind+"")&&pt(u,l),R&256&&a!==(a=P[8].pupils+"")&&pt(g,a),R&256&&k!==(k=P[8].reachable?"is":"is not")&&pt(S,k)},d(P){P&&(X(t),X(n),X(u),X(d),X(g),X(b),X(S),X(L))}}}function vT(o){let e,t;return e=new mr({props:{openOn:"hover",$$slots:{default:[bT,({props:n})=>({8:n}),({props:n})=>n?256:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&768&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function wT(o){let e,t,n;function l(d){o[6](d)}let u={manageHoverState:!0,paint:{"circle-color":["case",["get","reachable"],"purple","red"],"circle-radius":Jn(5,8)},layout:{visibility:o[1]?"visible":"none"},$$slots:{default:[vT]},$$scope:{ctx:o}};return o[2]!==void 0&&(u.hovered=o[2]),e=new Xp({props:u}),Ai.push(()=>Zn(e,"hovered",l)),{c(){Ve(e.$$.fragment)},m(d,a){je(e,d,a),n=!0},p(d,a){const g={};a&2&&(g.layout={visibility:d[1]?"visible":"none"}),a&512&&(g.$$scope={dirty:a,ctx:d}),!t&&a&4&&(t=!0,g.hovered=d[2],qn(()=>t=!1)),e.$set(g)},i(d){n||(ne(e.$$.fragment,d),n=!0)},o(d){he(e.$$.fragment,d),n=!1},d(d){Ue(e,d)}}}function xT(o){let e,t,n,l,u,d;return e=new eo({props:{name:"schools",$$slots:{default:[yT]},$$scope:{ctx:o}}}),n=new bn({props:{data:o[0],generateId:!0,$$slots:{default:[wT]},$$scope:{ctx:o}}}),u=new em({props:{kind:"schools",hovered:o[2]}}),{c(){Ve(e.$$.fragment),t=we(),Ve(n.$$.fragment),l=we(),Ve(u.$$.fragment)},m(a,g){je(e,a,g),J(a,t,g),je(n,a,g),J(a,l,g),je(u,a,g),d=!0},p(a,[g]){const b={};g&523&&(b.$$scope={dirty:g,ctx:a}),e.$set(b);const k={};g&1&&(k.data=a[0]),g&518&&(k.$$scope={dirty:g,ctx:a}),n.$set(k);const S={};g&4&&(S.hovered=a[2]),u.$set(S)},i(a){d||(ne(e.$$.fragment,a),ne(n.$$.fragment,a),ne(u.$$.fragment,a),d=!0)},o(a){he(e.$$.fragment,a),he(n.$$.fragment,a),he(u.$$.fragment,a),d=!1},d(a){a&&(X(t),X(l)),Ue(e,a),Ue(n,a),Ue(u,a)}}}function kT(o,e,t){let n,l,u;bt(o,Ad,S=>t(1,l=S)),bt(o,In,S=>t(7,u=S));let d={type:"FeatureCollection",features:[]},a;async function g(){u&&t(0,d=await u.getSchools())}function b(){l=this.checked,Ad.set(l)}function k(S){a=S,t(2,a)}return o.$$.update=()=>{o.$$.dirty&3&&l&&d.features.length==0&&g(),o.$$.dirty&1&&t(3,n=d.features.filter(S=>S.properties.reachable).length)},[d,l,a,n,g,b,k]}class ST extends Wt{constructor(e){super(),Gt(this,e,kT,xT,Vt,{})}}function R0(o){let e,t,n,l=o[3].toLocaleString()+"",u,d,a=o[0].features.length.toLocaleString()+"",g,b,k=Vn(o[3],o[0].features.length)+"",S,L,P,R,Z,$,H;return R=new Qa({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=ee("button"),e.textContent="Recalculate",t=we(),n=ee("p"),u=be(l),d=be(" / "),g=be(a),b=be(" ("),S=be(k),L=be(") reachable"),P=we(),Ve(R.$$.fragment),Pe(e,"class","outline")},m(G,K){J(G,e,K),J(G,t,K),J(G,n,K),F(n,u),F(n,d),F(n,g),F(n,b),F(n,S),F(n,L),J(G,P,K),je(R,G,K),Z=!0,$||(H=ft(e,"click",o[4]),$=!0)},p(G,K){(!Z||K&8)&&l!==(l=G[3].toLocaleString()+"")&&pt(u,l),(!Z||K&1)&&a!==(a=G[0].features.length.toLocaleString()+"")&&pt(g,a),(!Z||K&9)&&k!==(k=Vn(G[3],G[0].features.length)+"")&&pt(S,k)},i(G){Z||(ne(R.$$.fragment,G),Z=!0)},o(G){he(R.$$.fragment,G),Z=!1},d(G){G&&(X(e),X(t),X(n),X(P)),Ue(R,G),$=!1,H()}}}function TT(o){let e,t,n,l,u,d,a,g,b=o[1]&&R0(o);return{c(){e=ee("label"),t=ee("input"),n=be(`
    Town centres`),l=we(),b&&b.c(),u=Ei(),Pe(t,"type","checkbox")},m(k,S){J(k,e,S),F(e,t),t.checked=o[1],F(e,n),J(k,l,S),b&&b.m(k,S),J(k,u,S),d=!0,a||(g=ft(t,"change",o[5]),a=!0)},p(k,S){S&2&&(t.checked=k[1]),k[1]?b?(b.p(k,S),S&2&&ne(b,1)):(b=R0(k),b.c(),ne(b,1),b.m(u.parentNode,u)):b&&(ui(),he(b,1,1,()=>{b=null}),hi())},i(k){d||(ne(b),d=!0)},o(k){he(b),d=!1},d(k){k&&(X(e),X(l),X(u)),b&&b.d(k),a=!1,g()}}}function IT(o){let e,t=(o[8].name||"")+"",n,l,u=o[8].reachable?"is":"is not",d,a;return{c(){e=be("Town centre "),n=be(t),l=we(),d=be(u),a=be(" reachable.")},m(g,b){J(g,e,b),J(g,n,b),J(g,l,b),J(g,d,b),J(g,a,b)},p(g,b){b&256&&t!==(t=(g[8].name||"")+"")&&pt(n,t),b&256&&u!==(u=g[8].reachable?"is":"is not")&&pt(d,u)},d(g){g&&(X(e),X(n),X(l),X(d),X(a))}}}function CT(o){let e,t;return e=new mr({props:{openOn:"hover",$$slots:{default:[IT,({props:n})=>({8:n}),({props:n})=>n?256:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&768&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function ET(o){let e,t,n;function l(d){o[6](d)}let u={manageHoverState:!0,paint:{"fill-color":["case",["get","reachable"],"purple","red"],"fill-opacity":Jn(.7,.9)},layout:{visibility:o[1]?"visible":"none"},$$slots:{default:[CT]},$$scope:{ctx:o}};return o[2]!==void 0&&(u.hovered=o[2]),e=new gc({props:u}),Ai.push(()=>Zn(e,"hovered",l)),{c(){Ve(e.$$.fragment)},m(d,a){je(e,d,a),n=!0},p(d,a){const g={};a&2&&(g.layout={visibility:d[1]?"visible":"none"}),a&512&&(g.$$scope={dirty:a,ctx:d}),!t&&a&4&&(t=!0,g.hovered=d[2],qn(()=>t=!1)),e.$set(g)},i(d){n||(ne(e.$$.fragment,d),n=!0)},o(d){he(e.$$.fragment,d),n=!1},d(d){Ue(e,d)}}}function LT(o){let e,t,n,l,u,d;return e=new eo({props:{name:"town centres",$$slots:{default:[TT]},$$scope:{ctx:o}}}),n=new bn({props:{data:o[0],generateId:!0,$$slots:{default:[ET]},$$scope:{ctx:o}}}),u=new em({props:{kind:"town_centres",hovered:o[2]}}),{c(){Ve(e.$$.fragment),t=we(),Ve(n.$$.fragment),l=we(),Ve(u.$$.fragment)},m(a,g){je(e,a,g),J(a,t,g),je(n,a,g),J(a,l,g),je(u,a,g),d=!0},p(a,[g]){const b={};g&523&&(b.$$scope={dirty:g,ctx:a}),e.$set(b);const k={};g&1&&(k.data=a[0]),g&518&&(k.$$scope={dirty:g,ctx:a}),n.$set(k);const S={};g&4&&(S.hovered=a[2]),u.$set(S)},i(a){d||(ne(e.$$.fragment,a),ne(n.$$.fragment,a),ne(u.$$.fragment,a),d=!0)},o(a){he(e.$$.fragment,a),he(n.$$.fragment,a),he(u.$$.fragment,a),d=!1},d(a){a&&(X(t),X(l)),Ue(e,a),Ue(n,a),Ue(u,a)}}}function MT(o,e,t){let n,l,u;bt(o,zd,S=>t(1,l=S)),bt(o,In,S=>t(7,u=S));let d={type:"FeatureCollection",features:[]},a;async function g(){u&&t(0,d=await u.getTownCentres())}function b(){l=this.checked,zd.set(l)}function k(S){a=S,t(2,a)}return o.$$.update=()=>{o.$$.dirty&3&&l&&d.features.length==0&&g(),o.$$.dirty&1&&t(3,n=d.features.filter(S=>S.properties.reachable).length)},[d,l,a,n,g,b,k]}class AT extends Wt{constructor(e){super(),Gt(this,e,MT,LT,Vt,{})}}function F0(o){let e,t,n,l=o[3].toLocaleString()+"",u,d,a=o[0].features.length.toLocaleString()+"",g,b,k=Vn(o[3],o[0].features.length)+"",S,L,P,R,Z,$,H;return R=new Qa({props:{colors:{Reachable:"purple","Not reachable":"red"}}}),{c(){e=ee("button"),e.textContent="Recalculate",t=we(),n=ee("p"),u=be(l),d=be(" / "),g=be(a),b=be(" ("),S=be(k),L=be(") reachable"),P=we(),Ve(R.$$.fragment),Pe(e,"class","outline")},m(G,K){J(G,e,K),J(G,t,K),J(G,n,K),F(n,u),F(n,d),F(n,g),F(n,b),F(n,S),F(n,L),J(G,P,K),je(R,G,K),Z=!0,$||(H=ft(e,"click",o[4]),$=!0)},p(G,K){(!Z||K&8)&&l!==(l=G[3].toLocaleString()+"")&&pt(u,l),(!Z||K&1)&&a!==(a=G[0].features.length.toLocaleString()+"")&&pt(g,a),(!Z||K&9)&&k!==(k=Vn(G[3],G[0].features.length)+"")&&pt(S,k)},i(G){Z||(ne(R.$$.fragment,G),Z=!0)},o(G){he(R.$$.fragment,G),Z=!1},d(G){G&&(X(e),X(t),X(n),X(P)),Ue(R,G),$=!1,H()}}}function PT(o){let e,t,n,l,u,d,a,g,b=o[1]&&F0(o);return{c(){e=ee("label"),t=ee("input"),n=be(`
    GPs and hospitals`),l=we(),b&&b.c(),u=Ei(),Pe(t,"type","checkbox")},m(k,S){J(k,e,S),F(e,t),t.checked=o[1],F(e,n),J(k,l,S),b&&b.m(k,S),J(k,u,S),d=!0,a||(g=ft(t,"change",o[5]),a=!0)},p(k,S){S&2&&(t.checked=k[1]),k[1]?b?(b.p(k,S),S&2&&ne(b,1)):(b=F0(k),b.c(),ne(b,1),b.m(u.parentNode,u)):b&&(ui(),he(b,1,1,()=>{b=null}),hi())},i(k){d||(ne(b),d=!0)},o(k){he(b),d=!1},d(k){k&&(X(e),X(l),X(u)),b&&b.d(k),a=!1,g()}}}function zT(o){let e=o[8].name+"",t,n,l=o[8].kind+"",u,d,a=o[8].reachable?"is":"is not",g,b;return{c(){t=be(e),n=be(" is a "),u=be(l),d=be(". It "),g=be(a),b=be(" reachable.")},m(k,S){J(k,t,S),J(k,n,S),J(k,u,S),J(k,d,S),J(k,g,S),J(k,b,S)},p(k,S){S&256&&e!==(e=k[8].name+"")&&pt(t,e),S&256&&l!==(l=k[8].kind+"")&&pt(u,l),S&256&&a!==(a=k[8].reachable?"is":"is not")&&pt(g,a)},d(k){k&&(X(t),X(n),X(u),X(d),X(g),X(b))}}}function DT(o){let e,t;return e=new mr({props:{openOn:"hover",$$slots:{default:[zT,({props:n})=>({8:n}),({props:n})=>n?256:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&768&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function RT(o){let e,t,n;function l(d){o[6](d)}let u={manageHoverState:!0,paint:{"circle-color":["case",["get","reachable"],"purple","red"],"circle-radius":Jn(5,8)},layout:{visibility:o[1]?"visible":"none"},$$slots:{default:[DT]},$$scope:{ctx:o}};return o[2]!==void 0&&(u.hovered=o[2]),e=new Xp({props:u}),Ai.push(()=>Zn(e,"hovered",l)),{c(){Ve(e.$$.fragment)},m(d,a){je(e,d,a),n=!0},p(d,a){const g={};a&2&&(g.layout={visibility:d[1]?"visible":"none"}),a&512&&(g.$$scope={dirty:a,ctx:d}),!t&&a&4&&(t=!0,g.hovered=d[2],qn(()=>t=!1)),e.$set(g)},i(d){n||(ne(e.$$.fragment,d),n=!0)},o(d){he(e.$$.fragment,d),n=!1},d(d){Ue(e,d)}}}function FT(o){let e,t,n,l,u,d;return e=new eo({props:{name:"gp hospitals",$$slots:{default:[PT]},$$scope:{ctx:o}}}),n=new bn({props:{data:o[0],generateId:!0,$$slots:{default:[RT]},$$scope:{ctx:o}}}),u=new em({props:{kind:"gp_hospitals",hovered:o[2]}}),{c(){Ve(e.$$.fragment),t=we(),Ve(n.$$.fragment),l=we(),Ve(u.$$.fragment)},m(a,g){je(e,a,g),J(a,t,g),je(n,a,g),J(a,l,g),je(u,a,g),d=!0},p(a,[g]){const b={};g&523&&(b.$$scope={dirty:g,ctx:a}),e.$set(b);const k={};g&1&&(k.data=a[0]),g&518&&(k.$$scope={dirty:g,ctx:a}),n.$set(k);const S={};g&4&&(S.hovered=a[2]),u.$set(S)},i(a){d||(ne(e.$$.fragment,a),ne(n.$$.fragment,a),ne(u.$$.fragment,a),d=!0)},o(a){he(e.$$.fragment,a),he(n.$$.fragment,a),he(u.$$.fragment,a),d=!1},d(a){a&&(X(t),X(l)),Ue(e,a),Ue(n,a),Ue(u,a)}}}function BT(o,e,t){let n,l,u;bt(o,Pd,S=>t(1,l=S)),bt(o,In,S=>t(7,u=S));let d={type:"FeatureCollection",features:[]},a;async function g(){u&&t(0,d=await u.getGpHospitals())}function b(){l=this.checked,Pd.set(l)}function k(S){a=S,t(2,a)}return o.$$.update=()=>{o.$$.dirty&3&&l&&d.features.length==0&&g(),o.$$.dirty&1&&t(3,n=d.features.filter(S=>S.properties.reachable).length)},[d,l,a,n,g,b,k]}class OT extends Wt{constructor(e){super(),Gt(this,e,BT,FT,Vt,{})}}function NT(o){let e,t,n,l,u;return{c(){e=ee("label"),t=ee("input"),n=be(`
    Urban areas`),Pe(t,"type","checkbox")},m(d,a){J(d,e,a),F(e,t),t.checked=o[0],F(e,n),l||(u=ft(t,"change",o[1]),l=!0)},p(d,a){a&1&&(t.checked=d[0])},d(d){d&&X(e),l=!1,u()}}}function jT(o){let e,t;return e=new gc({props:{sourceLayer:"urban_areas",manageHoverState:!0,paint:{"fill-color":"black","fill-opacity":Jn(1,.5)},layout:{visibility:o[0]?"visible":"none"}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.layout={visibility:n[0]?"visible":"none"}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function UT(o){let e,t,n,l;return e=new eo({props:{name:"urban areas",$$slots:{default:[NT]},$$scope:{ctx:o}}}),n=new oh({props:{url:`pmtiles://${bc("urban_areas.pmtiles")}`,$$slots:{default:[jT]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment),t=we(),Ve(n.$$.fragment)},m(u,d){je(e,u,d),J(u,t,d),je(n,u,d),l=!0},p(u,[d]){const a={};d&5&&(a.$$scope={dirty:d,ctx:u}),e.$set(a);const g={};d&5&&(g.$$scope={dirty:d,ctx:u}),n.$set(g)},i(u){l||(ne(e.$$.fragment,u),ne(n.$$.fragment,u),l=!0)},o(u){he(e.$$.fragment,u),he(n.$$.fragment,u),l=!1},d(u){u&&X(t),Ue(e,u),Ue(n,u)}}}function $T(o,e,t){let n=!1;function l(){n=this.checked,t(0,n)}return[n,l]}class VT extends Wt{constructor(e){super(),Gt(this,e,$T,UT,Vt,{})}}function B0(o){let e,t,n,l,u,d;return n=new Qa({props:{colors:o[3]}}),{c(){e=ee("button"),e.textContent="Recalculate",t=we(),Ve(n.$$.fragment),Pe(e,"class","outline")},m(a,g){J(a,e,g),J(a,t,g),je(n,a,g),l=!0,u||(d=ft(e,"click",o[2]),u=!0)},p:Ze,i(a){l||(ne(n.$$.fragment,a),l=!0)},o(a){he(n.$$.fragment,a),l=!1},d(a){a&&(X(e),X(t)),Ue(n,a),u=!1,d()}}}function qT(o){let e,t,n,l,u,d,a,g,b=o[0]&&B0(o);return{c(){e=ee("label"),t=ee("input"),n=be(`
    Reachable network`),l=we(),b&&b.c(),u=Ei(),Pe(t,"type","checkbox")},m(k,S){J(k,e,S),F(e,t),t.checked=o[0],F(e,n),J(k,l,S),b&&b.m(k,S),J(k,u,S),d=!0,a||(g=ft(t,"change",o[4]),a=!0)},p(k,S){S&1&&(t.checked=k[0]),k[0]?b?(b.p(k,S),S&1&&ne(b,1)):(b=B0(k),b.c(),ne(b,1),b.m(u.parentNode,u)):b&&(ui(),he(b,1,1,()=>{b=null}),hi())},i(k){d||(ne(b),d=!0)},o(k){he(b),d=!1},d(k){k&&(X(e),X(l),X(u)),b&&b.d(k),a=!1,g()}}}function ZT(o){let e,t;return e=new vn({props:{layout:{visibility:o[0]?"visible":"none"},paint:{"line-width":Jn(5,7),"line-color":ba(["get","kind"],o[3],"black"),"line-opacity":.8},manageHoverState:!0}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.layout={visibility:n[0]?"visible":"none"}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function GT(o){let e,t,n,l;return e=new eo({props:{name:"reachable network",$$slots:{default:[qT]},$$scope:{ctx:o}}}),n=new bn({props:{data:o[1],generateId:!0,$$slots:{default:[ZT]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment),t=we(),Ve(n.$$.fragment)},m(u,d){je(e,u,d),J(u,t,d),je(n,u,d),l=!0},p(u,[d]){const a={};d&65&&(a.$$scope={dirty:d,ctx:u}),e.$set(a);const g={};d&2&&(g.data=u[1]),d&65&&(g.$$scope={dirty:d,ctx:u}),n.$set(g)},i(u){l||(ne(e.$$.fragment,u),ne(n.$$.fragment,u),l=!0)},o(u){he(e.$$.fragment,u),he(n.$$.fragment,u),l=!1},d(u){u&&X(t),Ue(e,u),Ue(n,u)}}}function WT(o,e,t){let n;bt(o,In,b=>t(5,n=b));let l=!1,u={type:"FeatureCollection",features:[]};async function d(){t(1,u=await n.renderReachableNetwork())}let a={network:"green",reachable:"purple",severance:"red"};function g(){l=this.checked,t(0,l)}return o.$$.update=()=>{o.$$.dirty&3&&l&&u.features.length==0&&d()},[l,u,d,a,g]}class HT extends Wt{constructor(e){super(),Gt(this,e,WT,GT,Vt,{})}}function O0(o){let e,t,n,l,u,d;return n=new Qa({props:{colors:Yp}}),{c(){e=ee("button"),e.textContent="Recalculate",t=we(),Ve(n.$$.fragment),Pe(e,"class","outline")},m(a,g){J(a,e,g),J(a,t,g),je(n,a,g),l=!0,u||(d=ft(e,"click",o[2]),u=!0)},p:Ze,i(a){l||(ne(n.$$.fragment,a),l=!0)},o(a){he(n.$$.fragment,a),l=!1},d(a){a&&(X(e),X(t)),Ue(n,a),u=!1,d()}}}function XT(o){let e,t,n,l,u,d,a,g,b=o[1]&&O0(o);return{c(){e=ee("label"),t=ee("input"),n=be(`
    Level of Service`),l=we(),b&&b.c(),u=Ei(),Pe(t,"type","checkbox")},m(k,S){J(k,e,S),F(e,t),t.checked=o[1],F(e,n),J(k,l,S),b&&b.m(k,S),J(k,u,S),d=!0,a||(g=ft(t,"change",o[3]),a=!0)},p(k,S){S&2&&(t.checked=k[1]),k[1]?b?(b.p(k,S),S&2&&ne(b,1)):(b=O0(k),b.c(),ne(b,1),b.m(u.parentNode,u)):b&&(ui(),he(b,1,1,()=>{b=null}),hi())},i(k){d||(ne(b),d=!0)},o(k){he(b),d=!1},d(k){k&&(X(e),X(l),X(u)),b&&b.d(k),a=!1,g()}}}function KT(o){let e,t,n,l,u,d=o[5].los+"",a,g,b,k,S,L,P=uc[o[5].infra_type][0]+"",R,Z,$,H,G,K,le=o[5].speed+"",Se,Le,te,Y,ue,fe,ce=o[5].traffic.toLocaleString()+"",ae;return{c(){e=ee("table"),t=ee("tr"),n=ee("th"),n.textContent="Level of Service",l=we(),u=ee("td"),a=be(d),g=we(),b=ee("tr"),k=ee("th"),k.textContent="Infrastructure type",S=we(),L=ee("td"),R=be(P),Z=we(),$=ee("tr"),H=ee("th"),H.textContent="Speed (mph)",G=we(),K=ee("td"),Se=be(le),Le=we(),te=ee("tr"),Y=ee("th"),Y.textContent="Estimated daily traffic volume",ue=we(),fe=ee("td"),ae=be(ce)},m(We,Ee){J(We,e,Ee),F(e,t),F(t,n),F(t,l),F(t,u),F(u,a),F(e,g),F(e,b),F(b,k),F(b,S),F(b,L),F(L,R),F(e,Z),F(e,$),F($,H),F($,G),F($,K),F(K,Se),F(e,Le),F(e,te),F(te,Y),F(te,ue),F(te,fe),F(fe,ae)},p(We,Ee){Ee&32&&d!==(d=We[5].los+"")&&pt(a,d),Ee&32&&P!==(P=uc[We[5].infra_type][0]+"")&&pt(R,P),Ee&32&&le!==(le=We[5].speed+"")&&pt(Se,le),Ee&32&&ce!==(ce=We[5].traffic.toLocaleString()+"")&&pt(ae,ce)},d(We){We&&X(e)}}}function JT(o){let e,t;return e=new mr({props:{openOn:"hover",$$slots:{default:[KT,({props:n})=>({5:n}),({props:n})=>n?32:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&96&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function YT(o){let e,t;return e=new vn({props:{layout:{visibility:o[1]?"visible":"none"},paint:{"line-width":Jn(5,7),"line-color":Rp,"line-opacity":.8},manageHoverState:!0,$$slots:{default:[JT]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&2&&(u.layout={visibility:n[1]?"visible":"none"}),l&64&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function QT(o){let e,t,n,l;return e=new eo({props:{name:"level of service",$$slots:{default:[XT]},$$scope:{ctx:o}}}),n=new bn({props:{data:o[0],generateId:!0,$$slots:{default:[YT]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment),t=we(),Ve(n.$$.fragment)},m(u,d){je(e,u,d),J(u,t,d),je(n,u,d),l=!0},p(u,[d]){const a={};d&66&&(a.$$scope={dirty:d,ctx:u}),e.$set(a);const g={};d&1&&(g.data=u[0]),d&66&&(g.$$scope={dirty:d,ctx:u}),n.$set(g)},i(u){l||(ne(e.$$.fragment,u),ne(n.$$.fragment,u),l=!0)},o(u){he(e.$$.fragment,u),he(n.$$.fragment,u),l=!1},d(u){u&&X(t),Ue(e,u),Ue(n,u)}}}function eI(o,e,t){let n;bt(o,In,g=>t(4,n=g));let l={type:"FeatureCollection",features:[]},u=!1;async function d(){n&&t(0,l=await n.renderLevelOfService())}function a(){u=this.checked,t(1,u)}return o.$$.update=()=>{o.$$.dirty&3&&u&&l.features.length==0&&d()},[l,u,d,a]}class tI extends Wt{constructor(e){super(),Gt(this,e,eI,QT,Vt,{})}}function N0(o){let e,t,n,l,u,d,a,g,b,k,S,L;return e=new Kp({props:{colorScale:o[5],limits:o[6]}}),{c(){Ve(e.$$.fragment),t=we(),n=ee("label"),l=ee("input"),u=be(`
      Show actual data`),d=we(),a=ee("label"),g=ee("input"),b=be(`
      Show map-matched data`),Pe(l,"type","checkbox"),Pe(g,"type","checkbox")},m(P,R){je(e,P,R),J(P,t,R),J(P,n,R),F(n,l),l.checked=o[2],F(n,u),J(P,d,R),J(P,a,R),F(a,g),g.checked=o[3],F(a,b),k=!0,S||(L=[ft(l,"change",o[8]),ft(g,"change",o[9])],S=!0)},p(P,R){R&4&&(l.checked=P[2]),R&8&&(g.checked=P[3])},i(P){k||(ne(e.$$.fragment,P),k=!0)},o(P){he(e.$$.fragment,P),k=!1},d(P){P&&(X(t),X(n),X(d),X(a)),Ue(e,P),S=!1,an(L)}}}function iI(o){let e,t,n,l,u,d,a,g,b=o[0]&&N0(o);return{c(){e=ee("label"),t=ee("input"),n=be(`
    Estimated traffic volume`),l=we(),b&&b.c(),u=Ei(),Pe(t,"type","checkbox")},m(k,S){J(k,e,S),F(e,t),t.checked=o[0],F(e,n),J(k,l,S),b&&b.m(k,S),J(k,u,S),d=!0,a||(g=ft(t,"change",o[7]),a=!0)},p(k,S){S&1&&(t.checked=k[0]),k[0]?b?(b.p(k,S),S&1&&ne(b,1)):(b=N0(k),b.c(),ne(b,1),b.m(u.parentNode,u)):b&&(ui(),he(b,1,1,()=>{b=null}),hi())},i(k){d||(ne(b),d=!0)},o(k){he(b),d=!1},d(k){k&&(X(e),X(l),X(u)),b&&b.d(k),a=!1,g()}}}function nI(o){let e,t;return e=new vn({props:{sourceLayer:"cbd_layer",filter:["has","Traffic volume category"],paint:{"line-color":ba(["get","Traffic volume category"],{"0 to 1999":"#27918d","2000 to 3999":"#ffaa33","4000+":"#440154"},"cyan"),"line-width":5},layout:{visibility:o[0]&&o[2]?"visible":"none"}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&5&&(u.layout={visibility:n[0]&&n[2]?"visible":"none"}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function j0(o){let e,t,n,l={ctx:o,current:null,token:null,hasCatch:!1,pending:cI,then:oI,catch:rI,value:10,blocks:[,,,]};return Ar(t=o[4].renderLevelOfService(),l),{c(){e=Ei(),l.block.c()},m(u,d){J(u,e,d),l.block.m(u,l.anchor=d),l.mount=()=>e.parentNode,l.anchor=e,n=!0},p(u,d){o=u,l.ctx=o,d&16&&t!==(t=o[4].renderLevelOfService())&&Ar(t,l)||pa(l,o,d)},i(u){n||(ne(l.block),n=!0)},o(u){for(let d=0;d<3;d+=1){const a=l.blocks[d];he(a)}n=!1},d(u){u&&X(e),l.block.d(u),l.token=null,l=null}}}function rI(o){return{c:Ze,m:Ze,p:Ze,i:Ze,o:Ze,d:Ze}}function oI(o){let e,t;return e=new bn({props:{data:o[10],generateId:!0,$$slots:{default:[lI]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&16&&(u.data=n[10]),l&4105&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function sI(o){let e,t=o[11].traffic.toLocaleString()+"",n;return{c(){e=ee("p"),n=be(t)},m(l,u){J(l,e,u),F(e,n)},p(l,u){u&2048&&t!==(t=l[11].traffic.toLocaleString()+"")&&pt(n,t)},d(l){l&&X(e)}}}function aI(o){let e,t;return e=new mr({props:{openOn:"hover",$$slots:{default:[sI,({props:n})=>({11:n}),({props:n})=>n?2048:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&6144&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function lI(o){let e,t;return e=new vn({props:{layout:{visibility:o[0]&&o[3]?"visible":"none"},paint:{"line-width":Ed(["get","traffic"],o[6],[1,2,3]),"line-color":Ed(["get","traffic"],o[6],o[5]),"line-opacity":.8},manageHoverState:!0,$$slots:{default:[aI]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&9&&(u.layout={visibility:n[0]&&n[3]?"visible":"none"}),l&4096&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function cI(o){return{c:Ze,m:Ze,p:Ze,i:Ze,o:Ze,d:Ze}}function uI(o){let e,t,n,l,u,d;e=new eo({props:{name:"traffic volume",$$slots:{default:[iI]},$$scope:{ctx:o}}}),n=new oh({props:{url:`pmtiles://${bc("cbd.pmtiles")}`,$$slots:{default:[nI]},$$scope:{ctx:o}}});let a=o[4]&&o[1]&&j0(o);return{c(){Ve(e.$$.fragment),t=we(),Ve(n.$$.fragment),l=we(),a&&a.c(),u=Ei()},m(g,b){je(e,g,b),J(g,t,b),je(n,g,b),J(g,l,b),a&&a.m(g,b),J(g,u,b),d=!0},p(g,[b]){const k={};b&4109&&(k.$$scope={dirty:b,ctx:g}),e.$set(k);const S={};b&4101&&(S.$$scope={dirty:b,ctx:g}),n.$set(S),g[4]&&g[1]?a?(a.p(g,b),b&18&&ne(a,1)):(a=j0(g),a.c(),ne(a,1),a.m(u.parentNode,u)):a&&(ui(),he(a,1,1,()=>{a=null}),hi())},i(g){d||(ne(e.$$.fragment,g),ne(n.$$.fragment,g),ne(a),d=!0)},o(g){he(e.$$.fragment,g),he(n.$$.fragment,g),he(a),d=!1},d(g){g&&(X(t),X(l),X(u)),Ue(e,g),Ue(n,g),a&&a.d(g)}}}function hI(o,e,t){let n;bt(o,In,P=>t(4,n=P));let l=!1,u=!1,d=["#27918d","#ffaa33","#440154"],a=[0,2e3,4e3,1e4],g=!0,b=!0;function k(){l=this.checked,t(0,l)}function S(){g=this.checked,t(2,g)}function L(){b=this.checked,t(3,b)}return o.$$.update=()=>{o.$$.dirty&1&&l&&t(1,u=!0)},[l,u,g,b,n,d,a,k,S,L]}class dI extends Wt{constructor(e){super(),Gt(this,e,hI,uI,Vt,{})}}function fI(o){let e,t,n,l,u;return{c(){e=ee("label"),t=ee("input"),n=be(`
    Gradient`),Pe(t,"type","checkbox")},m(d,a){J(d,e,a),F(e,t),t.checked=o[0],F(e,n),l||(u=ft(t,"change",o[3]),l=!0)},p(d,a){a&1&&(t.checked=d[0])},d(d){d&&X(e),l=!1,u()}}}function U0(o){let e,t,n,l={ctx:o,current:null,token:null,hasCatch:!1,pending:bI,then:mI,catch:pI,value:4,blocks:[,,,]};return Ar(t=o[2].renderLevelOfService(),l),{c(){e=Ei(),l.block.c()},m(u,d){J(u,e,d),l.block.m(u,l.anchor=d),l.mount=()=>e.parentNode,l.anchor=e,n=!0},p(u,d){o=u,l.ctx=o,d&4&&t!==(t=o[2].renderLevelOfService())&&Ar(t,l)||pa(l,o,d)},i(u){n||(ne(l.block),n=!0)},o(u){for(let d=0;d<3;d+=1){const a=l.blocks[d];he(a)}n=!1},d(u){u&&X(e),l.block.d(u),l.token=null,l=null}}}function pI(o){return{c:Ze,m:Ze,p:Ze,i:Ze,o:Ze,d:Ze}}function mI(o){let e,t;return e=new bn({props:{data:o[4],generateId:!0,$$slots:{default:[yI]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&4&&(u.data=n[4]),l&65&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function _I(o){let e,t=o[5].gradient.toFixed(1)+"",n,l;return{c(){e=ee("p"),n=be(t),l=be("%")},m(u,d){J(u,e,d),F(e,n),F(e,l)},p(u,d){d&32&&t!==(t=u[5].gradient.toFixed(1)+"")&&pt(n,t)},d(u){u&&X(e)}}}function gI(o){let e,t;return e=new mr({props:{openOn:"hover",$$slots:{default:[_I,({props:n})=>({5:n}),({props:n})=>n?32:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&96&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function yI(o){let e,t;return e=new vn({props:{layout:{visibility:o[0]?"visible":"none"},paint:{"line-width":Jn(3,5),"line-color":W1()},manageHoverState:!0,$$slots:{default:[gI]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.layout={visibility:n[0]?"visible":"none"}),l&64&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function bI(o){return{c:Ze,m:Ze,p:Ze,i:Ze,o:Ze,d:Ze}}function vI(o){let e,t,n,l;e=new eo({props:{name:"gradient",$$slots:{default:[fI]},$$scope:{ctx:o}}});let u=o[2]&&o[1]&&U0(o);return{c(){Ve(e.$$.fragment),t=we(),u&&u.c(),n=Ei()},m(d,a){je(e,d,a),J(d,t,a),u&&u.m(d,a),J(d,n,a),l=!0},p(d,[a]){const g={};a&65&&(g.$$scope={dirty:a,ctx:d}),e.$set(g),d[2]&&d[1]?u?(u.p(d,a),a&6&&ne(u,1)):(u=U0(d),u.c(),ne(u,1),u.m(n.parentNode,n)):u&&(ui(),he(u,1,1,()=>{u=null}),hi())},i(d){l||(ne(e.$$.fragment,d),ne(u),l=!0)},o(d){he(e.$$.fragment,d),he(u),l=!1},d(d){d&&(X(t),X(n)),Ue(e,d),u&&u.d(d)}}}function wI(o,e,t){let n;bt(o,In,a=>t(2,n=a));let l=!1,u=!1;function d(){l=this.checked,t(0,l)}return o.$$.update=()=>{o.$$.dirty&1&&l&&t(1,u=!0)},[l,u,n,d]}class xI extends Wt{constructor(e){super(),Gt(this,e,wI,vI,Vt,{})}}function $0(o){let e,t,n,l,u,d=o[3].toLocaleString()+"",a,g,b=o[0].features.length.toLocaleString()+"",k,S,L=o[2].toLocaleString()+"",P,R,Z=o[4].toLocaleString()+"",$,H,G=Vn(o[2],o[4])+"",K,le,Se,Le,te,Y,ue,fe,ce;return Le=new Kp({props:{colorScale:o[6],limits:o[7]}}),{c(){e=ee("button"),e.textContent="Recalculate",t=we(),n=ee("p"),n.textContent="Only the top 20%ile most deprived zones are shown",l=we(),u=ee("p"),a=be(d),g=be(" / "),k=be(b),S=be(` zones
      reachable. That's `),P=be(L),R=be(" / "),$=be(Z),H=be(`
      (`),K=be(G),le=be(") of the population."),Se=we(),Ve(Le.$$.fragment),te=we(),Y=ee("p"),Y.textContent=`Darker colours are more deprived. Zones with a red outline are not
      reachable by the current network.`,Pe(e,"class","outline")},m(ae,We){J(ae,e,We),J(ae,t,We),J(ae,n,We),J(ae,l,We),J(ae,u,We),F(u,a),F(u,g),F(u,k),F(u,S),F(u,P),F(u,R),F(u,$),F(u,H),F(u,K),F(u,le),J(ae,Se,We),je(Le,ae,We),J(ae,te,We),J(ae,Y,We),ue=!0,fe||(ce=ft(e,"click",o[5]),fe=!0)},p(ae,We){(!ue||We&8)&&d!==(d=ae[3].toLocaleString()+"")&&pt(a,d),(!ue||We&1)&&b!==(b=ae[0].features.length.toLocaleString()+"")&&pt(k,b),(!ue||We&4)&&L!==(L=ae[2].toLocaleString()+"")&&pt(P,L),(!ue||We&16)&&Z!==(Z=ae[4].toLocaleString()+"")&&pt($,Z),(!ue||We&20)&&G!==(G=Vn(ae[2],ae[4])+"")&&pt(K,G)},i(ae){ue||(ne(Le.$$.fragment,ae),ue=!0)},o(ae){he(Le.$$.fragment,ae),ue=!1},d(ae){ae&&(X(e),X(t),X(n),X(l),X(u),X(Se),X(te),X(Y)),Ue(Le,ae),fe=!1,ce()}}}function kI(o){let e,t,n,l,u,d,a,g,b=o[1]&&$0(o);return{c(){e=ee("label"),t=ee("input"),n=be(`
    SIMD`),l=we(),b&&b.c(),u=Ei(),Pe(t,"type","checkbox")},m(k,S){J(k,e,S),F(e,t),t.checked=o[1],F(e,n),J(k,l,S),b&&b.m(k,S),J(k,u,S),d=!0,a||(g=ft(t,"change",o[8]),a=!0)},p(k,S){S&2&&(t.checked=k[1]),k[1]?b?(b.p(k,S),S&2&&ne(b,1)):(b=$0(k),b.c(),ne(b,1),b.m(u.parentNode,u)):b&&(ui(),he(b,1,1,()=>{b=null}),hi())},i(k){d||(ne(b),d=!0)},o(k){he(b),d=!1},d(k){k&&(X(e),X(l),X(u)),b&&b.d(k),a=!1,g()}}}function SI(o){let e,t,n=o[10].id+"",l,u,d=o[10].reachable?"is":"is not",a,g,b=o[10].population.toLocaleString()+"",k,S,L=o[10].imd_rank+"",P,R,Z=o[10].imd_percentile+"",$,H;return{c(){e=ee("p"),t=be("Data zone "),l=be(n),u=we(),a=be(d),g=be(" reachable. It has "),k=be(b),S=be(`
        people, and a SIMD rank of `),P=be(L),R=be(", putting it in the "),$=be(Z),H=be(`
        percentile.`)},m(G,K){J(G,e,K),F(e,t),F(e,l),F(e,u),F(e,a),F(e,g),F(e,k),F(e,S),F(e,P),F(e,R),F(e,$),F(e,H)},p(G,K){K&1024&&n!==(n=G[10].id+"")&&pt(l,n),K&1024&&d!==(d=G[10].reachable?"is":"is not")&&pt(a,d),K&1024&&b!==(b=G[10].population.toLocaleString()+"")&&pt(k,b),K&1024&&L!==(L=G[10].imd_rank+"")&&pt(P,L),K&1024&&Z!==(Z=G[10].imd_percentile+"")&&pt($,Z)},d(G){G&&X(e)}}}function TI(o){let e,t;return e=new mr({props:{openOn:"hover",$$slots:{default:[SI,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&3072&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function II(o){let e,t,n,l;return e=new gc({props:{manageHoverState:!0,paint:{"fill-color":Ed(["get","imd_percentile"],o[7],o[6]),"fill-opacity":Jn(.7,.9)},layout:{visibility:o[1]?"visible":"none"},$$slots:{default:[TI]},$$scope:{ctx:o}}}),n=new vn({props:{filter:["!",["get","reachable"]],paint:{"line-color":"red","line-width":3},layout:{visibility:o[1]?"visible":"none"}}}),{c(){Ve(e.$$.fragment),t=we(),Ve(n.$$.fragment)},m(u,d){je(e,u,d),J(u,t,d),je(n,u,d),l=!0},p(u,d){const a={};d&2&&(a.layout={visibility:u[1]?"visible":"none"}),d&2048&&(a.$$scope={dirty:d,ctx:u}),e.$set(a);const g={};d&2&&(g.layout={visibility:u[1]?"visible":"none"}),n.$set(g)},i(u){l||(ne(e.$$.fragment,u),ne(n.$$.fragment,u),l=!0)},o(u){he(e.$$.fragment,u),he(n.$$.fragment,u),l=!1},d(u){u&&X(t),Ue(e,u),Ue(n,u)}}}function CI(o){let e,t,n,l;return e=new eo({props:{name:"simd",$$slots:{default:[kI]},$$scope:{ctx:o}}}),n=new bn({props:{data:o[0],generateId:!0,$$slots:{default:[II]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment),t=we(),Ve(n.$$.fragment)},m(u,d){je(e,u,d),J(u,t,d),je(n,u,d),l=!0},p(u,[d]){const a={};d&2079&&(a.$$scope={dirty:d,ctx:u}),e.$set(a);const g={};d&1&&(g.data=u[0]),d&2050&&(g.$$scope={dirty:d,ctx:u}),n.$set(g)},i(u){l||(ne(e.$$.fragment,u),ne(n.$$.fragment,u),l=!0)},o(u){he(e.$$.fragment,u),he(n.$$.fragment,u),l=!1},d(u){u&&X(t),Ue(e,u),Ue(n,u)}}}function EI(o,e,t){let n,l,u,d,a;bt(o,Dd,P=>t(1,d=P)),bt(o,In,P=>t(9,a=P));let g={type:"FeatureCollection",features:[]};async function b(){if(a){let P=await a.getDataZones();P.features=P.features.filter(R=>R.properties.imd_percentile<=20),t(0,g=P)}}let k=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],S=[0,4,8,12,16,20];function L(){d=this.checked,Dd.set(d)}return o.$$.update=()=>{o.$$.dirty&3&&d&&g.features.length==0&&b(),o.$$.dirty&1&&t(4,n=Od(g.features.map(P=>P.properties.population))),o.$$.dirty&1&&t(3,l=g.features.filter(P=>P.properties.reachable).length),o.$$.dirty&1&&t(2,u=Od(g.features.filter(P=>P.properties.reachable).map(P=>P.properties.population)))},[g,d,u,l,n,b,k,S,L]}class LI extends Wt{constructor(e){super(),Gt(this,e,EI,CI,Vt,{})}}function V0(o){let e,t,n,l=o[3].toLocaleString()+"",u,d,a=o[0].features.length.toLocaleString()+"",g,b,k=o[2].toLocaleString()+"",S,L,P=o[4].toLocaleString()+"",R,Z,$=Vn(o[2],o[4])+"",H,G,K,le,Se,Le,te,Y,ue;return le=new Kp({props:{colorScale:o[6],limits:o[7]}}),{c(){e=ee("button"),e.textContent="Recalculate",t=we(),n=ee("p"),u=be(l),d=be(" / "),g=be(a),b=be(` zones
      reachable. That's `),S=be(k),L=be(" / "),R=be(P),Z=be(`
      (`),H=be($),G=be(") of the population."),K=we(),Ve(le.$$.fragment),Se=we(),Le=ee("p"),Le.textContent=`Darker colours are denser. Zones with a red outline are not reachable by
      the current network. Only the top 3 densest quintiles are shown.`,Pe(e,"class","outline")},m(fe,ce){J(fe,e,ce),J(fe,t,ce),J(fe,n,ce),F(n,u),F(n,d),F(n,g),F(n,b),F(n,S),F(n,L),F(n,R),F(n,Z),F(n,H),F(n,G),J(fe,K,ce),je(le,fe,ce),J(fe,Se,ce),J(fe,Le,ce),te=!0,Y||(ue=ft(e,"click",o[5]),Y=!0)},p(fe,ce){(!te||ce&8)&&l!==(l=fe[3].toLocaleString()+"")&&pt(u,l),(!te||ce&1)&&a!==(a=fe[0].features.length.toLocaleString()+"")&&pt(g,a),(!te||ce&4)&&k!==(k=fe[2].toLocaleString()+"")&&pt(S,k),(!te||ce&16)&&P!==(P=fe[4].toLocaleString()+"")&&pt(R,P),(!te||ce&20)&&$!==($=Vn(fe[2],fe[4])+"")&&pt(H,$)},i(fe){te||(ne(le.$$.fragment,fe),te=!0)},o(fe){he(le.$$.fragment,fe),te=!1},d(fe){fe&&(X(e),X(t),X(n),X(K),X(Se),X(Le)),Ue(le,fe),Y=!1,ue()}}}function MI(o){let e,t,n,l,u,d,a,g,b=o[1]&&V0(o);return{c(){e=ee("label"),t=ee("input"),n=be(`
    Population`),l=we(),b&&b.c(),u=Ei(),Pe(t,"type","checkbox")},m(k,S){J(k,e,S),F(e,t),t.checked=o[1],F(e,n),J(k,l,S),b&&b.m(k,S),J(k,u,S),d=!0,a||(g=ft(t,"change",o[9]),a=!0)},p(k,S){S&2&&(t.checked=k[1]),k[1]?b?(b.p(k,S),S&2&&ne(b,1)):(b=V0(k),b.c(),ne(b,1),b.m(u.parentNode,u)):b&&(ui(),he(b,1,1,()=>{b=null}),hi())},i(k){d||(ne(b),d=!0)},o(k){he(b),d=!1},d(k){k&&(X(e),X(l),X(u)),b&&b.d(k),a=!1,g()}}}function AI(o){let e,t,n=o[11].id+"",l,u,d=o[11].reachable?"is":"is not",a,g,b=o[11].population.toLocaleString()+"",k,S,L=Math.round(o[11].population/o[11].area_km2).toLocaleString()+"",P,R,Z=o[11].density_quintile+"",$,H;return{c(){e=ee("p"),t=be("Data zone "),l=be(n),u=we(),a=be(d),g=be(" reachable. It has "),k=be(b),S=be(`
        people, with a density of `),P=be(L),R=be(" people per square kilometer, putting it in quintile "),$=be(Z),H=be(`
        for this study area.`),mi(e,"max-width","30vw")},m(G,K){J(G,e,K),F(e,t),F(e,l),F(e,u),F(e,a),F(e,g),F(e,k),F(e,S),F(e,P),F(e,R),F(e,$),F(e,H)},p(G,K){K&2048&&n!==(n=G[11].id+"")&&pt(l,n),K&2048&&d!==(d=G[11].reachable?"is":"is not")&&pt(a,d),K&2048&&b!==(b=G[11].population.toLocaleString()+"")&&pt(k,b),K&2048&&L!==(L=Math.round(G[11].population/G[11].area_km2).toLocaleString()+"")&&pt(P,L),K&2048&&Z!==(Z=G[11].density_quintile+"")&&pt($,Z)},d(G){G&&X(e)}}}function PI(o){let e,t;return e=new mr({props:{openOn:"hover",$$slots:{default:[AI,({props:n})=>({11:n}),({props:n})=>n?2048:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&6144&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function zI(o){let e,t,n,l;return e=new gc({props:{manageHoverState:!0,paint:{"fill-color":Ed(["get","density_quintile"],o[7],o[6]),"fill-opacity":o[8]},layout:{visibility:o[1]?"visible":"none"},$$slots:{default:[PI]},$$scope:{ctx:o}}}),n=new vn({props:{filter:["!",["get","reachable"]],paint:{"line-color":"red","line-width":3},layout:{visibility:o[1]?"visible":"none"}}}),{c(){Ve(e.$$.fragment),t=we(),Ve(n.$$.fragment)},m(u,d){je(e,u,d),J(u,t,d),je(n,u,d),l=!0},p(u,d){const a={};d&2&&(a.layout={visibility:u[1]?"visible":"none"}),d&4096&&(a.$$scope={dirty:d,ctx:u}),e.$set(a);const g={};d&2&&(g.layout={visibility:u[1]?"visible":"none"}),n.$set(g)},i(u){l||(ne(e.$$.fragment,u),ne(n.$$.fragment,u),l=!0)},o(u){he(e.$$.fragment,u),he(n.$$.fragment,u),l=!1},d(u){u&&X(t),Ue(e,u),Ue(n,u)}}}function DI(o){let e,t,n,l;return e=new eo({props:{name:"population density",$$slots:{default:[MI]},$$scope:{ctx:o}}}),n=new bn({props:{data:o[0],generateId:!0,$$slots:{default:[zI]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment),t=we(),Ve(n.$$.fragment)},m(u,d){je(e,u,d),J(u,t,d),je(n,u,d),l=!0},p(u,[d]){const a={};d&4127&&(a.$$scope={dirty:d,ctx:u}),e.$set(a);const g={};d&1&&(g.data=u[0]),d&4098&&(g.$$scope={dirty:d,ctx:u}),n.$set(g)},i(u){l||(ne(e.$$.fragment,u),ne(n.$$.fragment,u),l=!0)},o(u){he(e.$$.fragment,u),he(n.$$.fragment,u),l=!1},d(u){u&&X(t),Ue(e,u),Ue(n,u)}}}function RI(o,e,t){let n,l,u,d,a;bt(o,Rd,R=>t(1,d=R)),bt(o,In,R=>t(10,a=R));let g={type:"FeatureCollection",features:[]};async function b(){a&&t(0,g=await a.getDataZones())}let k=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],S=[0,1,2,3,4,5],L=Jn(["case",["<",["get","density_quintile"],4],.5,0],.9);function P(){d=this.checked,Rd.set(d)}return o.$$.update=()=>{o.$$.dirty&3&&d&&g.features.length==0&&b(),o.$$.dirty&1&&t(4,n=Od(g.features.map(R=>R.properties.population))),o.$$.dirty&1&&t(3,l=g.features.filter(R=>R.properties.reachable).length),o.$$.dirty&1&&t(2,u=Od(g.features.filter(R=>R.properties.reachable).map(R=>R.properties.population)))},[g,d,u,l,n,b,k,S,L,P]}class FI extends Wt{constructor(e){super(),Gt(this,e,RI,DI,Vt,{})}}function q0(o){let e,t,n,l,u,d,a,g,b,k,S,L,P,R,Z,$,H,G,K,le=o[0].total_quintile_sums.length>0&&Z0(o);return{c(){e=ee("div"),t=ee("button"),t.textContent="Recalculate",n=we(),l=ee("label"),u=ee("input"),d=be(`
        Only show routes covered by current edits`),a=we(),g=ee("label"),b=be(`Only show quintile:
        `),k=ee("select"),S=ee("option"),S.textContent="Show all",L=ee("option"),L.textContent="1",P=ee("option"),P.textContent="2",R=ee("option"),R.textContent="3",Z=ee("option"),Z.textContent="4",$=ee("option"),$.textContent="5",H=we(),le&&le.c(),Pe(t,"class","outline"),Pe(u,"type","checkbox"),S.__value="",Vi(S,S.__value),L.__value="1",Vi(L,L.__value),P.__value="2",Vi(P,P.__value),R.__value="3",Vi(R,R.__value),Z.__value="4",Vi(Z,Z.__value),$.__value="5",Vi($,$.__value),o[3]===void 0&&Co(()=>o[7].call(k)),mi(e,"border","1px solid black"),mi(e,"padding","4px")},m(Se,Le){J(Se,e,Le),F(e,t),F(e,n),F(e,l),F(l,u),u.checked=o[2],F(l,d),F(e,a),F(e,g),F(g,b),F(g,k),F(k,S),F(k,L),F(k,P),F(k,R),F(k,Z),F(k,$),lr(k,o[3],!0),F(e,H),le&&le.m(e,null),G||(K=[ft(t,"click",o[4]),ft(u,"change",o[6]),ft(k,"change",o[7])],G=!0)},p(Se,Le){Le&4&&(u.checked=Se[2]),Le&8&&lr(k,Se[3]),Se[0].total_quintile_sums.length>0?le?le.p(Se,Le):(le=Z0(Se),le.c(),le.m(e,null)):le&&(le.d(1),le=null)},d(Se){Se&&X(e),le&&le.d(),G=!1,an(K)}}}function Z0(o){let e,t,n,l,u,d=Vn(o[0].covered_quintile_sums[0],o[0].total_quintile_sums[0])+"",a,g,b,k,S=Vn(o[0].covered_quintile_sums[1],o[0].total_quintile_sums[1])+"",L,P,R,Z,$=Vn(o[0].covered_quintile_sums[2],o[0].total_quintile_sums[2])+"",H,G,K,le,Se=Vn(o[0].covered_quintile_sums[3],o[0].total_quintile_sums[3])+"",Le,te,Y,ue,fe=Vn(o[0].covered_quintile_sums[4],o[0].total_quintile_sums[4])+"",ce;return{c(){e=ee("p"),e.textContent="Flow covered by current edits",t=we(),n=ee("ul"),l=ee("li"),u=be("Quintile 1: "),a=be(d),g=we(),b=ee("li"),k=be("Quintile 2: "),L=be(S),P=we(),R=ee("li"),Z=be("Quintile 3: "),H=be($),G=we(),K=ee("li"),le=be("Quintile 4: "),Le=be(Se),te=we(),Y=ee("li"),ue=be("Quintile 5: "),ce=be(fe)},m(ae,We){J(ae,e,We),J(ae,t,We),J(ae,n,We),F(n,l),F(l,u),F(l,a),F(n,g),F(n,b),F(b,k),F(b,L),F(n,P),F(n,R),F(R,Z),F(R,H),F(n,G),F(n,K),F(K,le),F(K,Le),F(n,te),F(n,Y),F(Y,ue),F(Y,ce)},p(ae,We){We&1&&d!==(d=Vn(ae[0].covered_quintile_sums[0],ae[0].total_quintile_sums[0])+"")&&pt(a,d),We&1&&S!==(S=Vn(ae[0].covered_quintile_sums[1],ae[0].total_quintile_sums[1])+"")&&pt(L,S),We&1&&$!==($=Vn(ae[0].covered_quintile_sums[2],ae[0].total_quintile_sums[2])+"")&&pt(H,$),We&1&&Se!==(Se=Vn(ae[0].covered_quintile_sums[3],ae[0].total_quintile_sums[3])+"")&&pt(Le,Se),We&1&&fe!==(fe=Vn(ae[0].covered_quintile_sums[4],ae[0].total_quintile_sums[4])+"")&&pt(ce,fe)},d(ae){ae&&(X(e),X(t),X(n))}}}function BI(o){let e,t,n,l,u,d,a,g=o[1]&&q0(o);return{c(){e=ee("label"),t=ee("input"),n=be(`
    High NPT route coverage`),l=we(),g&&g.c(),u=Ei(),Pe(t,"type","checkbox")},m(b,k){J(b,e,k),F(e,t),t.checked=o[1],F(e,n),J(b,l,k),g&&g.m(b,k),J(b,u,k),d||(a=ft(t,"change",o[5]),d=!0)},p(b,k){k&2&&(t.checked=b[1]),b[1]?g?g.p(b,k):(g=q0(b),g.c(),g.m(u.parentNode,u)):g&&(g.d(1),g=null)},d(b){b&&(X(e),X(l),X(u)),g&&g.d(b),d=!1,a()}}}function OI(o){let e,t=o[9].flow.toLocaleString()+"",n,l,u=o[9].quintile+"",d,a,g=o[9].covered+"",b;return{c(){e=be("Flow "),n=be(t),l=be(" is in quintile "),d=be(u),a=be(`,
      covered `),b=be(g)},m(k,S){J(k,e,S),J(k,n,S),J(k,l,S),J(k,d,S),J(k,a,S),J(k,b,S)},p(k,S){S&512&&t!==(t=k[9].flow.toLocaleString()+"")&&pt(n,t),S&512&&u!==(u=k[9].quintile+"")&&pt(d,u),S&512&&g!==(g=k[9].covered+"")&&pt(b,g)},d(k){k&&(X(e),X(n),X(l),X(d),X(a),X(b))}}}function NI(o){let e,t;return e=new mr({props:{openOn:"hover",$$slots:{default:[OI,({props:n})=>({9:n}),({props:n})=>n?512:0]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&1536&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function jI(o){let e,t;return e=new vn({props:{layout:{visibility:o[1]?"visible":"none"},filter:G0(o[2],o[3]),paint:{"line-width":Nd("flow"),"line-color":Qp("flow")},$$slots:{default:[NI]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&2&&(u.layout={visibility:n[1]?"visible":"none"}),l&12&&(u.filter=G0(n[2],n[3])),l&1024&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function UI(o){let e,t,n,l;return e=new eo({props:{name:"high npt route coverage",$$slots:{default:[BI]},$$scope:{ctx:o}}}),n=new bn({props:{data:o[0],$$slots:{default:[jI]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment),t=we(),Ve(n.$$.fragment)},m(u,d){je(e,u,d),J(u,t,d),je(n,u,d),l=!0},p(u,[d]){const a={};d&1039&&(a.$$scope={dirty:d,ctx:u}),e.$set(a);const g={};d&1&&(g.data=u[0]),d&1038&&(g.$$scope={dirty:d,ctx:u}),n.$set(g)},i(u){l||(ne(e.$$.fragment,u),ne(n.$$.fragment,u),l=!0)},o(u){he(e.$$.fragment,u),he(n.$$.fragment,u),l=!1},d(u){u&&X(t),Ue(e,u),Ue(n,u)}}}function G0(o,e){let t=["all"];return o&&t.push(["get","covered"]),e.length>0&&t.push(["==",["get","quintile"],parseInt(e)]),t}function $I(o,e,t){let n,l;bt(o,rc,L=>t(1,n=L)),bt(o,In,L=>t(8,l=L));let u=!1,d="",a={type:"FeatureCollection",features:[],covered_quintile_sums:[],total_quintile_sums:[]};async function g(){l&&t(0,a=await l.renderPrecalculatedFlows())}function b(){n=this.checked,rc.set(n)}function k(){u=this.checked,t(2,u)}function S(){d=gs(this),t(3,d)}return o.$$.update=()=>{o.$$.dirty&3&&n&&a.features.length==0&&g()},[a,n,u,d,g,b,k,S]}class VI extends Wt{constructor(e){super(),Gt(this,e,$I,UI,Vt,{})}}function qI(o){let e,t;return e=new Xp({props:{paint:{"circle-color":"purple","circle-radius":5},layout:{visibility:o[1]&&o[2].kind=="edit-route"?"visible":"none"}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&6&&(u.layout={visibility:n[1]&&n[2].kind=="edit-route"?"visible":"none"}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function ZI(o){let e,t;return e=new bn({props:{data:o[0],$$slots:{default:[qI]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.data=n[0]),l&38&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function GI(o,e,t){let n,l,u;bt(o,zp,g=>t(1,n=g)),bt(o,In,g=>t(3,l=g)),bt(o,sn,g=>t(2,u=g));let d={type:"FeatureCollection",features:[]};async function a(){l&&t(0,d=await l.getMajorJunctions())}return o.$$.update=()=>{o.$$.dirty&3&&n&&d.features.length==0&&a()},[d,n,u]}class WI extends Wt{constructor(e){super(),Gt(this,e,GI,ZI,Vt,{})}}function HI(o){let e,t,n,l,u,d,a,g,b,k,S,L,P,R,Z,$,H,G,K,le,Se,Le,te,Y,ue,fe,ce,ae,We,Ee;return e=new K5({}),n=new nT({}),u=new VI({}),a=new pT({}),b=new ST({}),S=new AT({}),P=new OT({}),Z=new VT({}),H=new tI({}),K=new dI({}),Se=new xI({}),te=new HT({}),ue=new LI({}),ce=new FI({}),We=new WI({}),{c(){Ve(e.$$.fragment),t=we(),Ve(n.$$.fragment),l=we(),Ve(u.$$.fragment),d=we(),Ve(a.$$.fragment),g=we(),Ve(b.$$.fragment),k=we(),Ve(S.$$.fragment),L=we(),Ve(P.$$.fragment),R=we(),Ve(Z.$$.fragment),$=we(),Ve(H.$$.fragment),G=we(),Ve(K.$$.fragment),le=we(),Ve(Se.$$.fragment),Le=we(),Ve(te.$$.fragment),Y=we(),Ve(ue.$$.fragment),fe=we(),Ve(ce.$$.fragment),ae=we(),Ve(We.$$.fragment)},m(ze,rt){je(e,ze,rt),J(ze,t,rt),je(n,ze,rt),J(ze,l,rt),je(u,ze,rt),J(ze,d,rt),je(a,ze,rt),J(ze,g,rt),je(b,ze,rt),J(ze,k,rt),je(S,ze,rt),J(ze,L,rt),je(P,ze,rt),J(ze,R,rt),je(Z,ze,rt),J(ze,$,rt),je(H,ze,rt),J(ze,G,rt),je(K,ze,rt),J(ze,le,rt),je(Se,ze,rt),J(ze,Le,rt),je(te,ze,rt),J(ze,Y,rt),je(ue,ze,rt),J(ze,fe,rt),je(ce,ze,rt),J(ze,ae,rt),je(We,ze,rt),Ee=!0},p:Ze,i(ze){Ee||(ne(e.$$.fragment,ze),ne(n.$$.fragment,ze),ne(u.$$.fragment,ze),ne(a.$$.fragment,ze),ne(b.$$.fragment,ze),ne(S.$$.fragment,ze),ne(P.$$.fragment,ze),ne(Z.$$.fragment,ze),ne(H.$$.fragment,ze),ne(K.$$.fragment,ze),ne(Se.$$.fragment,ze),ne(te.$$.fragment,ze),ne(ue.$$.fragment,ze),ne(ce.$$.fragment,ze),ne(We.$$.fragment,ze),Ee=!0)},o(ze){he(e.$$.fragment,ze),he(n.$$.fragment,ze),he(u.$$.fragment,ze),he(a.$$.fragment,ze),he(b.$$.fragment,ze),he(S.$$.fragment,ze),he(P.$$.fragment,ze),he(Z.$$.fragment,ze),he(H.$$.fragment,ze),he(K.$$.fragment,ze),he(Se.$$.fragment,ze),he(te.$$.fragment,ze),he(ue.$$.fragment,ze),he(ce.$$.fragment,ze),he(We.$$.fragment,ze),Ee=!1},d(ze){ze&&(X(t),X(l),X(d),X(g),X(k),X(L),X(R),X($),X(G),X(le),X(Le),X(Y),X(fe),X(ae)),Ue(e,ze),Ue(n,ze),Ue(u,ze),Ue(a,ze),Ue(b,ze),Ue(S,ze),Ue(P,ze),Ue(Z,ze),Ue(H,ze),Ue(K,ze),Ue(Se,ze),Ue(te,ze),Ue(ue,ze),Ue(ce,ze),Ue(We,ze)}}}class XI extends Wt{constructor(e){super(),Gt(this,e,null,HI,Vt,{})}}function KI(o){let e,t,n;return t=new D5({}),{c(){e=ee("div"),Ve(t.$$.fragment),Pe(e,"slot","top")},m(l,u){J(l,e,u),je(t,e,null),n=!0},p:Ze,i(l){n||(ne(t.$$.fragment,l),n=!0)},o(l){he(t.$$.fragment,l),n=!1},d(l){l&&X(e),Ue(t)}}}function JI(o){let e,t;return{c(){e=ee("div"),t=ee("div"),Pe(e,"slot","left")},m(n,l){J(n,e,l),F(e,t),o[15](t)},p:Ze,d(n){n&&X(e),o[15](null)}}}function YI(o){let e,t;return e=new O2({props:{map:o[0],apiKey:U1,country:"gb"}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.map=n[0]),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function W0(o){let e,t,n,l,u,d,a,g,b={ctx:o,current:null,token:null,hasCatch:!1,pending:iC,then:eC,catch:QI,value:21,blocks:[,,,]};Ar(e=o[5].getInvertedBoundary(),b),n=new XI({});const k=[lC,aC,sC,oC,rC,nC],S=[];function L(P,R){return P[7].kind=="main"?0:P[7].kind=="edit-route"&&P[0]?1:P[7].kind=="evaluate-route"?2:P[7].kind=="evaluate-od"?3:P[7].kind=="debug-network"?4:P[7].kind=="debug-mesh-density"?5:-1}return~(u=L(o))&&(d=S[u]=k[u](o)),{c(){b.block.c(),t=we(),Ve(n.$$.fragment),l=we(),d&&d.c(),a=Ei()},m(P,R){b.block.m(P,b.anchor=R),b.mount=()=>t.parentNode,b.anchor=t,J(P,t,R),je(n,P,R),J(P,l,R),~u&&S[u].m(P,R),J(P,a,R),g=!0},p(P,R){o=P,b.ctx=o,R&32&&e!==(e=o[5].getInvertedBoundary())&&Ar(e,b)||pa(b,o,R);let Z=u;u=L(o),u===Z?~u&&S[u].p(o,R):(d&&(ui(),he(S[Z],1,1,()=>{S[Z]=null}),hi()),~u?(d=S[u],d?d.p(o,R):(d=S[u]=k[u](o),d.c()),ne(d,1),d.m(a.parentNode,a)):d=null)},i(P){g||(ne(b.block),ne(n.$$.fragment,P),ne(d),g=!0)},o(P){for(let R=0;R<3;R+=1){const Z=b.blocks[R];he(Z)}he(n.$$.fragment,P),he(d),g=!1},d(P){P&&(X(t),X(l),X(a)),b.block.d(P),b.token=null,b=null,Ue(n,P),~u&&S[u].d(P)}}}function QI(o){return{c:Ze,m:Ze,p:Ze,i:Ze,o:Ze,d:Ze}}function eC(o){let e,t;return e=new bn({props:{data:o[21],$$slots:{default:[tC]},$$scope:{ctx:o}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&32&&(u.data=n[21]),l&4194304&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function tC(o){let e,t;return e=new gc({props:{paint:{"fill-color":"black","fill-opacity":.3}}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p:Ze,i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function iC(o){return{c:Ze,m:Ze,p:Ze,i:Ze,o:Ze,d:Ze}}function nC(o){let e,t;return e=new A4({}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p:Ze,i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function rC(o){let e,t;return e=new x4({}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p:Ze,i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function oC(o){let e,t;return e=new I5({}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p:Ze,i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function sC(o){let e,t;return e=new y5({props:{prevMode:o[7].prevMode,browse:o[7].browse}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&128&&(u.prevMode=n[7].prevMode),l&128&&(u.browse=n[7].browse),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function aC(o){let e,t;return e=new e5({props:{id:o[7].id,map:o[0]}}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p(n,l){const u={};l&128&&(u.id=n[7].id),l&1&&(u.map=n[0]),e.$set(u)},i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function lC(o){let e,t;return e=new iS({}),{c(){Ve(e.$$.fragment)},m(n,l){je(e,n,l),t=!0},p:Ze,i(n){t||(ne(e.$$.fragment,n),t=!0)},o(n){he(e.$$.fragment,n),t=!1},d(n){Ue(e,n)}}}function cC(o){let e,t,n,l,u,d,a,g=YI(o);t=new cS({});let b=o[5]&&W0(o);return{c(){g&&g.c(),e=we(),Ve(t.$$.fragment),n=we(),l=ee("div"),u=we(),b&&b.c(),d=Ei()},m(k,S){g&&g.m(k,S),J(k,e,S),je(t,k,S),J(k,n,S),J(k,l,S),o[12](l),J(k,u,S),b&&b.m(k,S),J(k,d,S),a=!0},p(k,S){g.p(k,S),k[5]?b?(b.p(k,S),S&32&&ne(b,1)):(b=W0(k),b.c(),ne(b,1),b.m(d.parentNode,d)):b&&(ui(),he(b,1,1,()=>{b=null}),hi())},i(k){a||(ne(g),ne(t.$$.fragment,k),ne(b),a=!0)},o(k){he(g),he(t.$$.fragment,k),he(b),a=!1},d(k){k&&(X(e),X(n),X(l),X(u),X(d)),g&&g.d(k),Ue(t,k),o[12](null),b&&b.d(k)}}}function uC(o){let e,t,n,l;function u(a){o[13](a)}let d={style:`https://api.maptiler.com/maps/streets-v2/style.json?key=${U1}`,standardControls:!0,$$slots:{default:[cC]},$$scope:{ctx:o}};return o[0]!==void 0&&(d.map=o[0]),t=new x3({props:d}),Ai.push(()=>Zn(t,"map",u)),t.$on("error",o[14]),{c(){e=ee("div"),Ve(t.$$.fragment),Pe(e,"slot","main"),mi(e,"position","relative"),mi(e,"width","100%"),mi(e,"height","100%")},m(a,g){J(a,e,g),je(t,e,null),l=!0},p(a,g){const b={};g&4194469&&(b.$$scope={dirty:g,ctx:a}),!n&&g&1&&(n=!0,b.map=a[0],qn(()=>n=!1)),t.$set(b)},i(a){l||(ne(t.$$.fragment,a),l=!0)},o(a){he(t.$$.fragment,a),l=!1},d(a){a&&X(e),Ue(t)}}}function hC(o){let e,t;return{c(){e=ee("div"),t=ee("div"),Pe(e,"slot","right")},m(n,l){J(n,e,l),F(e,t),o[11](t)},p:Ze,d(n){n&&X(e),o[11](null)}}}function dC(o){let e,t,n,l,u,d;return document.title=e="Network Planning Workspace - "+o[6],n=new V3({props:{loading:o[4]}}),u=new R3({props:{$$slots:{right:[hC],main:[uC],left:[JI],top:[KI]},$$scope:{ctx:o}}}),{c(){t=we(),Ve(n.$$.fragment),l=we(),Ve(u.$$.fragment)},m(a,g){J(a,t,g),je(n,a,g),J(a,l,g),je(u,a,g),d=!0},p(a,[g]){(!d||g&64)&&e!==(e="Network Planning Workspace - "+a[6])&&(document.title=e);const b={};g&16&&(b.loading=a[4]),n.$set(b);const k={};g&4194479&&(k.$$scope={dirty:g,ctx:a}),u.$set(k)},i(a){d||(ne(n.$$.fragment,a),ne(u.$$.fragment,a),d=!0)},o(a){he(n.$$.fragment,a),he(u.$$.fragment,a),d=!1},d(a){a&&(X(t),X(l)),Ue(n,a),Ue(u,a)}}}function pd(o,e,t){return e+o*(t-e)}function fC(o,e,t){let n,l,u,d,a,g,b,k,S,L;bt(o,Cp,Y=>t(8,n=Y)),bt(o,Ep,Y=>t(9,l=Y)),bt(o,Ip,Y=>t(10,u=Y)),bt(o,In,Y=>t(5,d=Y)),bt(o,Bd,Y=>t(16,a=Y)),bt(o,Ya,Y=>t(17,g=Y)),bt(o,aa,Y=>t(18,b=Y)),bt(o,Md,Y=>t(6,k=Y)),bt(o,Ap,Y=>t(19,S=Y)),bt(o,sn,Y=>t(7,L=Y));let P="",R;fc(async()=>{await G1();let Y=new URLSearchParams(window.location.search);oi(Md,k=Y.get("boundary")||"LAD_City of Edinburgh",k),t(4,P=`Loading ${k}`);let ue=new u4,fe=await fetch(`areas/${k}.bin`);fe.ok?(console.log("Using locally hosted files"),oi(Ap,S=!1,S)):(console.log("Using remote hosted files"),fe=await fetch(bc(`areas/${k}.bin`)));let ce=await fe.arrayBuffer();try{await ue.loadFile(new Uint8Array(ce))}catch(Ee){window.alert(`Couldn't load: ${Ee}`)}let ae=window.localStorage.getItem(`tmp-npt-editor/${k}`);if(ae)try{await ue.loadSavefile(ae)}catch(Ee){window.alert(`Couldn't restore saved state: ${Ee}`)}t(4,P="");let We=await ue.getBounds();oi(aa,b={lng:pd(.4,We[0],We[2]),lat:pd(.4,We[1],We[3])},b),oi(Ya,g={lng:pd(.6,We[0],We[2]),lat:pd(.6,We[1],We[3])},g),oi(Bd,a=new SS(R,ue.toRouteSnapper(),Mi(lc()),Mi(!0),Mi(0)),a),In.set(ue),await Z()});async function Z(){R&&d&&R.fitBounds(await d.getBounds(),{animate:!1})}let $,H,G;function K(Y){Ai[Y?"unshift":"push"](()=>{G=Y,t(3,G),t(8,n)})}function le(Y){Ai[Y?"unshift":"push"](()=>{H=Y,t(2,H),t(9,l)})}function Se(Y){R=Y,t(0,R)}const Le=Y=>{console.log(Y.detail.error)};function te(Y){Ai[Y?"unshift":"push"](()=>{$=Y,t(1,$),t(10,u)})}return o.$$.update=()=>{o.$$.dirty&1&&R&&h4.set(R),o.$$.dirty&1026&&$&&u&&(t(1,$.innerHTML="",$),$.appendChild(u)),o.$$.dirty&516&&H&&l&&(t(2,H.innerHTML="",H),H.appendChild(l)),o.$$.dirty&264&&G&&n&&(t(3,G.innerHTML="",G),G.appendChild(n))},[R,$,H,G,P,d,k,L,n,l,u,K,le,Se,Le,te]}class pC extends Wt{constructor(e){super(),Gt(this,e,fC,dC,Vt,{})}}new pC({target:document.getElementById("app")});
